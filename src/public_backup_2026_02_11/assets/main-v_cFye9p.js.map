{"version":3,"mappings":"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AAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;A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AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;;AAAA;AAAA;AAAA;AAAA;;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;;AAAA;AAAA;AAAA;AAAA;;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;;AAAA;AAAA;AAAA;AAAA;;AAAA;AAAA;AAAA;AAAA;AAAA;;AAAA;AAAA;AAAA;AAAA;AAAA;;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;;AAAA;AAAA;AAAA;AAAA;;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;;AAAA;AAAA;AAAA;;AAAA;AAAA;AAAA;;AAAA;AAAA;AAAA;AAAA;;AAAA;AAAA;AAAA;;AAAA;AAAA;AAAA;AAAA;AAAA;;AAAA;AAAA;AAAA;;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;;AAAA;AAAA;AAAA;;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;;AAAA;AAAA;AAAA;AAAA;;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;;AAAA;AAAA;AAAA;AAAA;AAAA;;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA,2CAwuBkCA,EAAW,YAAc,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A;AAAA;AAAA;AAAA;AAAA;;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;;AAAA;AAAA;AAAA;AAAA;;AAAA;AAAA;AAAA;AAAA;;AAAA;AAAA;AAAA;AAAA;AAAA;;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;;AAAA;AAAA;AAAA;;AAAA;AAAA;AAAA;AAAA;AAAA;;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;;AAAA;AAAA;AAAA;;AAAA;AAAA;AAAA;AAAA;AAAA;;AAAA;AAAA;AAAA;AAAA;;AAAA;AAAA;AAAA;AAAA;AAAA;;AAAA;AAAA;AAAA;AAAA;AAAA;;AAAA;AAAA;AAAA;AAAA;;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;;AAAA;AAAA;AAAA;;AAAA;AAAA;AAAA;AAAA;;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;;AAAA;AAAA;AAAA;;AAAA;AAAA;AAAA;;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;;AAAA;AAAA;AAAA;AAAA;;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;;AAAA;AAAA;AAAA;;AAAA;AAAA;AAAA;;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;;AAAA;AAAA;AAAA;;AAAA;AAAA;AAAA;AAAA;AAAA;;AAAA;AAAA;AAAA;;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;;AAAA;AAAA;AAAA;AAAA;AAAA;;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;;AAAA;AAAA;AAAA;AAAA;;AAAA;AAAA;AAAA;AAAA;;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;;AAAA;AAAA;AAAA;;AAAA;AAAA;AAAA;AAAA;AAAA;;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;;AAAA;AAAA;AAAA;AAAA;;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;;AAAA;AAAA;AAAA;AAAA;AAAA;;AAAA;AAAA;AAAA;;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;;AAAA;AAAA;AAAA;AAAA;AAAA;;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;;AAAA;AAAA;AAAA;AAAA;;AAAA;AAAA;AAAA;AAAA;;AAAA;AAAA;AAAA;AAAA;AAAA;;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;;AAAA;AAAA;AAAA;AAAA;;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;;AAAA;AAAA;AAAA;;AAAA;AAAA;AAAA;AAAA;AAAA;;AAAA;AAAA;AAAA;AAAA;AAAA;;AAAA;AAAA;AAAA;AAAA;AAAA;;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;;AAAA;AAAA;AAAA;AAAA;;AAAA;AAAA;AAAA;AAAA;;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;;AAAA;AAAA;AAAA;AAAA;AAAA;;AAAA;AAAA;AAAA;AAAA;;AAAA;AAAA;AAAA;AAAA;AAAA;;AAAA;AAAA;AAAA;AAAA;;AAAA;AAAA;AAAA;AAAA;AAAA;;AAAA;AAAA;AAAA;AAAA;;AAAA;AAAA;AAAA;AAAA;;AAAA;AAAA;AAAA;AAAA;;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;;AAAA;AAAA;AAAA;AAAA;;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;;AAAA;AAAA;AAAA,YAilBZyuF,EACJ,aAAap5B,CAAQ,YACrB,SAASx8B,CAAQ,SACrB;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;;AAAA;AAAA,yCAUqC6hC,EAASr9B,GAAWixB,GAAS,MAAQ,EAAE,EAAI,aAAa;AAAA,uCAC1DoM,GAAUpM,GAAS,aAAejxB,GAAWixB,EAAQ,YAAY,EAAI,kBAAkB;AAAA;;AAAA,UAGpHoM,EAAS;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA,UASP,EAAE;AAAA;AAAA;;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA,qEA+CuDr9B,GAAWixB,GAAS,MAAQ,EAAE,CAAC;AAAA;;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA,sIAckCA,GAAS,MAAQ,CAAC4/B,GAAc,KAAK,GAAK,EAAE,eAAiB5/B,EAAQ,IAAI,EAAIjxB,GAAWixB,EAAQ,IAAI,EAAI,EAAE;AAAA;;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA,8DAUlLjxB,GAAWixB,GAAS,OAAS,EAAE,CAAC;AAAA;;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA,4DAUlCjxB,GAAWixB,GAAS,OAAS,EAAE,CAAC;AAAA;;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA,oEAUxBjxB,GAAWixB,GAAS,cAAgBA,GAAS,SAAW,EAAE,CAAC;AAAA;;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA,+DAUhEjxB,GAAWixB,GAAS,UAAY,EAAE,CAAC;AAAA;;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA,iEAUjCjxB,GAAWixB,GAAS,UAAYA,GAAS,WAAaA,GAAS,WAAaA,GAAS,YAAc,EAAE,CAAC;AAAA;AAAA;;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA,kEAWrGjxB,GAAWixB,GAAS,YAAc,EAAE,CAAC;AAAA;;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA,gEAWvCjxB,GAAWixB,GAAS,UAAY,EAAE,CAAC;AAAA;;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA,4DAUvCjxB,GAAWixB,GAAS,UAAY,EAAE,CAAC;AAAA;AAAA;AAAA;;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA,+DAYhCA,GAAS,SAAS,KAAK,IAAI,GAAK,EAAE;AAAA;AAAA;;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA,kGAWCjxB,GAAWixB,GAAS,OAAS,EAAE,CAAC;AAAA;;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA,4DAUtEA,GAAS,MAAM,KAAK,IAAI,GAAK,EAAE;AAAA;AAAA;AAAA;AAAA;AAAA;;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;;AAAA;AAAA;AAAA;AAAA,UAsCjFoM,EAAS;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA,UAOP,EAAE;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA,YAQFA,EAAS,eAAiB,gBAAgB;AAAA;AAAA;AAAA;AAAA,IAM7C16D,CACT,CAKA,eAAeouF,GAAgBpuF,EAAwB4U,EAAkC,CACvF,GAAI,CACF,KAAM,CAAC85E,EAAaC,EAAcC,EAAa/jC,EAAUgkC,EAAgBC,CAAY,EAAI,MAAM,QAAQ,IAAI,CACzG7rF,EAAK,IAAoC,iBAAiB2R,CAAS,WAAW,EAAE,MAAM,KAAO,CAAE,KAAM,CAAE,SAAU,EAAC,GAAM,EACxH3R,EAAK,IAA0C,iBAAiB2R,CAAS,gBAAgB,EAAE,MAAM,KAAO,CAAE,KAAM,CAAE,cAAe,EAAC,GAAM,EACxI3R,EAAK,IAAuC,iBAAiB2R,CAAS,WAAW,EAAE,MAAM,KAAO,CAAE,KAAM,CAAE,WAAY,EAAC,GAAM,EAC7H3R,EAAK,IAA+B,qBAAqB,EAAE,MAAM,KAAO,CAAE,KAAM,CAAE,MAAO,EAAC,GAAM,EAChGA,EAAK,IAAkD,eAAe,EAAE,MAAM,KAAO,CAAE,KAAM,CAAE,SAAU,EAAC,GAAM,EAChHA,EAAK,IAAyE,gBAAgB,EAAE,MAAM,KAAO,CAAE,KAAM,CAAE,UAAW,EAAC,GAAM,EAC1I,EAED6qF,GAAkBY,EAAY,MAAM,UAAY,GAChDX,GAAmBY,EAAa,MAAM,eAAiB,GACvDX,GAAkBY,EAAY,MAAM,YAAc,GAClDV,GAAgBrjC,EAAS,MAAM,OAAS,GACxCojC,GAAcY,EAAe,MAAM,UAAY,GAC/C,MAAME,EAAYD,EAAa,MAAM,WAAa,GAGlDE,GAAuBhvF,EAAW+uF,CAAS,EAG3CE,GAAmBjvF,CAAS,EAC5BkvF,GAAmBlvF,CAAS,EAC5BmvF,GAAoBnvF,CAAS,EAC7BovF,GAAuBpvF,CAAS,EAGhCqvF,GAAgBrvF,CAAS,CAC3B,OAASyC,EAAO,CACd,QAAQ,MAAM,+BAAgCA,CAAK,CACrD,CACF,CAKA,eAAe4rF,GAAkBruF,EAAuC,CACtE,GAAI,CAEFkuF,IADiB,MAAMjrF,EAAK,IAA+B,qBAAqB,GACvD,MAAM,OAAS,GACxCgsF,GAAmBjvF,CAAS,CAC9B,MAAQ,CACNkuF,GAAgB,EAClB,CACF,CAKA,eAAeK,GAAcvuF,EAAuC,CAClE,GAAI,CAEF,MAAM+uF,GADW,MAAM9rF,EAAK,IAAyE,gBAAgB,GAC1F,MAAM,WAAa,GAC9C+rF,GAAuBhvF,EAAW+uF,CAAS,CAC7C,MAAQ,CAER,CACF,CAKA,eAAeT,GAAgBtuF,EAAuC,CACpE,GAAI,CAEFiuF,IADiB,MAAMhrF,EAAK,IAAkD,eAAe,GACtE,MAAM,UAAY,GACzCisF,GAAmBlvF,CAAS,CAC9B,MAAQ,CACNiuF,GAAc,EAChB,CACF,CAKA,SAASe,GAAuBhvF,EAAwB+uF,EAAuE,CAC7H,MAAMO,EAAWtvF,EAAU,cAAc,mBAAmB,EAC5D,GAAI,CAACsvF,EAAU,OAEf,MAAMC,EAAYD,EAAS,QAAQ,SAAW,GAGxClpE,EAA4C,GAClD,UAAWopE,KAAMT,EAAW,CAC1B,MAAMU,EAASD,EAAG,KAAK,SAAS,GAAG,EAAIA,EAAG,KAAK,MAAM,GAAG,EAAE,CAAC,EAAI,QAC1DppE,EAAQqpE,CAAM,IAAGrpE,EAAQqpE,CAAM,EAAI,IACxCrpE,EAAQqpE,CAAM,EAAE,KAAKD,CAAE,CACzB,CAGA,MAAME,EAAgB,OAAO,KAAKtpE,CAAO,EAAE,OAE3CkpE,EAAS,UAAY;AAAA;AAAA,MAEjBI,EAAc,IAAID,GAAU;AAAA,yBACTA,CAAM;AAAA,UACrBrpE,EAAQqpE,CAAM,EAAE,IAAID,GAAM;AAAA,2BACTnyD,GAAWmyD,EAAG,IAAI,CAAC,KAAKD,IAAcC,EAAG,KAAO,WAAa,EAAE;AAAA,cAC5EnyD,GAAWmyD,EAAG,MAAQA,EAAG,IAAI,CAAC,KAAKA,EAAG,UAAU;AAAA;AAAA,SAErD,EAAE,KAAK,EAAE,CAAC;AAAA;AAAA,KAEd,EAAE,KAAK,EAAE,CAAC;AAAA,GAEf,CAKA,SAASP,GAAmBjvF,EAA8B,CACxD,MAAMu9B,EAAav9B,EAAU,cAAc,eAAe,EACpD6tD,EAAc7tD,EAAU,cAAc,sBAAsB,EAClE,GAAI,CAACu9B,EAAY,OAEjB,MAAMP,EAAc6wD,IAAgB,KAC9B8B,EAAe3yD,GAAe,CAACkxD,GAAc,KAAKx+E,GAAKA,EAAE,eAAiBstB,GAAettB,EAAE,OAASstB,CAAW,EAErHO,EAAW,UAAY;AAAA;AAAA,MAEnB2wD,GAAc,OAAOx+E,GAAKA,EAAE,SAAS,EAAE,IAAIA,GAAK;AAAA,uBAC/B2tB,GAAW3tB,EAAE,cAAgBA,EAAE,IAAI,CAAC,KAAKstB,IAAgBttB,EAAE,cAAgBstB,IAAgBttB,EAAE,KAAO,WAAa,EAAE;AAAA,UAChI2tB,GAAW3tB,EAAE,cAAgBA,EAAE,IAAI,CAAC;AAAA;AAAA,KAEzC,EAAE,KAAK,EAAE,CAAC;AAAA,iCACkBigF,EAAe,WAAa,EAAE;AAAA,IAIzDA,GAAgB9hC,IAClBA,EAAY,UAAU,OAAO,QAAQ,EACrCA,EAAY,MAAQ7wB,GAItB3G,EAAGkH,EAAY,SAAU,IAAM,CAC7B,MAAMywB,EAAWzwB,EAAW,QAAU,aACtCswB,EAAY,UAAU,OAAO,SAAU,CAACG,CAAQ,EAC5CA,GACFH,EAAY,OAEhB,CAAC,CACH,CAKA,SAASqhC,GAAmBlvF,EAA8B,CACxD,MAAM4vF,EAAgB5vF,EAAU,cAAc,gBAAgB,EAC9D,GAAI,CAAC4vF,EAAe,OAEpB,GAAI3B,GAAY,SAAW,EAAG,CAC5B2B,EAAc,UAAY,gEAC1B,MACF,CAEA,MAAMC,EAAgB,IAAI,IAAI/B,GAAgB,IAAIrjF,GAAKA,EAAE,EAAE,CAAC,EAE5DmlF,EAAc,UAAY3B,GAAY,IAAIhoF,GAAW;AAAA;AAAA,sFAE+BA,EAAQ,EAAE;AAAA,eACjF4pF,EAAc,IAAI5pF,EAAQ,EAAE,EAAI,UAAY,EAAE;AAAA,eAC9Co3B,GAAWp3B,EAAQ,IAAI,CAAC;AAAA,QAC/B6nF,GAAgB,KAAKrjF,GAAKA,EAAE,KAAOxE,EAAQ,EAAE,GAAG,WAAa,6CAA+C,EAAE;AAAA;AAAA,GAEnH,EAAE,KAAK,EAAE,EAEVjG,EAAU,cAAc,iBAAiB,EAAG,YAAc,OAAO6vF,EAAc,IAAI,CACrF,CAKA,SAASV,GAAoBnvF,EAA8B,CACzD,MAAM4vF,EAAgB5vF,EAAU,cAAc,iBAAiB,EAC/D,GAAK4vF,EAEL,IAAI7B,GAAiB,SAAW,EAAG,CACjC6B,EAAc,UAAY;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA,MAQ1B,MACF,CAEAA,EAAc,UAAY7B,GAAiB,IAAI+B,GAAY,CACzD,MAAMxhC,EAAUwhC,EAAS,WACnBj3D,EAAWy1B,EAAUlxB,GAAYkxB,EAAQ,IAAI,EAAI,IAEvD,MAAO;AAAA,4CACiCwhC,EAAS,EAAE;AAAA;AAAA,YAE3CxhC,GAAS,WACX,aAAaA,EAAQ,UAAU,YAC/Bz1B,CACJ;AAAA;AAAA;AAAA,gBAGUwE,GAAWixB,GAAS,MAAQ,SAAS,CAAC;AAAA,eACvCjxB,GAAWixB,GAAS,cAAgBA,GAAS,MAAQ,EAAE,CAAC;AAAA;AAAA,sCAEjCyhC,GAAmBD,EAAS,iBAAiB,CAAC;AAAA;AAAA,KAGlF,CAAC,EAAE,KAAK,EAAE,EAEV9vF,EAAU,cAAc,kBAAkB,EAAG,YAAc,OAAO+tF,GAAiB,MAAM,EAC3F,CAKA,SAASqB,GAAuBpvF,EAA8B,CAC5D,MAAMgwF,EAAWhwF,EAAU,cAAc,oBAAoB,EAC7D,GAAKgwF,EAEL,IAAIhC,GAAgB,SAAW,EAAG,CAChCgC,EAAS,UAAY;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA,MAQrB,MACF,CAEAA,EAAS,UAAYhC,GAAgB,IAAIiC,GAAY;AAAA,gCACvBA,EAAS,aAAa;AAAA,mCACnBxgC,GAAWwgC,EAAS,WAAW,CAAC;AAAA,sCAC7B5yD,GAAW4yD,EAAS,WAAW,CAAC;AAAA;AAAA,GAEnE,EAAE,KAAK,EAAE,EACZ,CAKA,SAASZ,GAAgBrvF,EAA8B,CACrD,MAAMkwF,EAAgBlwF,EAAU,cAAc,iBAAiB,EACzDmwF,EAAiBnwF,EAAU,cAAc,kBAAkB,EAE7DkwF,IAAeA,EAAc,YAAc,OAAOpC,GAAgB,MAAM,GACxEqC,IAAgBA,EAAe,YAAc,OAAOpC,GAAiB,MAAM,EACjF,CAKA,SAASS,GAAWxuF,EAAwB+3B,EAAgC,CAC1E,KAAM,CAAE,KAAAt4B,EAAM,QAAA6uD,EAAS,OAAArxB,EAAQ,SAAAq0B,GAAav5B,EACtC2iC,EAASj7D,IAAS,OAGlBkB,EAAWX,EAAU,cAAc,oBAAoB,EACzDW,GACF01B,EAAG11B,EAAyB,QAAS,IAAM+2B,EAAW8E,EAAQ,CAAC,EAIjE,MAAMN,EAAYl8B,EAAU,cAAc,qBAAqB,EAC3Dk8B,GACF7F,EAAG6F,EAA0B,QAAS,IAAMxE,EAAW8E,EAAQ,CAAC,EAIlE,MAAM7C,EAAO35B,EAAU,iBAAiB,kBAAkB,EAC1D25B,EAAK,QAAQ3C,GAAO,CAClBX,EAAGW,EAAoB,QAAS,IAAM,CACpC2C,EAAK,QAAQmU,GAAKA,EAAE,UAAU,OAAO,QAAQ,CAAC,EAC9C9W,EAAI,UAAU,IAAI,QAAQ,EAE1B,MAAMkD,EAAQlD,EAAI,aAAa,UAAU,EACzCh3B,EAAU,iBAAiB,kBAAkB,EAAE,QAAQgsD,GAAW,CAChEA,EAAQ,UAAU,OAAO,SAAUA,EAAQ,KAAO,WAAW9xB,CAAK,EAAE,CACtE,CAAC,CACH,CAAC,CACH,CAAC,EAGD,MAAM6D,EAAU/9B,EAAU,cAAc,mBAAmB,EACvD+9B,GACF1H,EAAG0H,EAAS,QAAS,SAAY,CAC/B,MAAMuY,EAAOt2C,EAAU,cAAc,eAAe,EACpD,GAAI,CAACs2C,EAAK,gBAAiB,CACzBA,EAAK,iBACL,MACF,CAEA,MAAMic,EAAYjvD,IAAgBtD,EAAU,cAAc,IAAIsD,EAAE,EAAE,GAAwB,MAAM,QAAU,GAGpGi6B,EAAav9B,EAAU,cAAc,eAAe,EACpDowF,EAAkBpwF,EAAU,cAAc,sBAAsB,EAChEsV,EAAOioB,EAAW,QAAU,aAAe6yD,EAAgB,MAAM,OAAS7yD,EAAW,MAErF8yD,EAAY99B,EAAS,cAAc,EACnC+9B,EAAOD,EAAYA,EAAU,MAAM,GAAG,EAAE,IAAIviD,IAAKA,GAAE,MAAM,EAAE,OAAO,OAAO,EAAI,GAG7EyiD,EAAeh+B,EAAS,iBAAiB,EACzCi+B,EAAUD,EAAeA,EAAa,MAAM,GAAG,EAAE,IAAIx/E,IAAKA,GAAE,MAAM,EAAE,OAAO,OAAO,EAAI,GAEtF0/E,EAAuB,CAC3B,GAAIniC,GAAS,IAAM,WAAW,KAAK,KAAK,GACxC,KAAMiE,EAAS,cAAc,EAC7B,MAAOA,EAAS,eAAe,GAAK,OACpC,MAAOA,EAAS,eAAe,GAAK,OACpC,aAAcA,EAAS,sBAAsB,GAAK,OAClD,QAASA,EAAS,sBAAsB,GAAK,OAC7C,KAAMj9C,GAAQ,OACd,WAAYi9C,EAAS,oBAAoB,GAAK,OAC9C,SAAUA,EAAS,kBAAkB,GAAK,OAC1C,SAAUA,EAAS,kBAAkB,GAAK,OAC1C,SAAUA,EAAS,kBAAkB,GAAK,OAC1C,SAAUA,EAAS,oBAAoB,GAAK,OAC5C,UAAWA,EAAS,oBAAoB,GAAK,OAC7C,QAASi+B,EAAQ,OAAS,EAAIA,EAAU,OACxC,MAAOj+B,EAAS,eAAe,GAAK,OACpC,KAAM+9B,EAAK,OAAS,EAAIA,EAAO,QAI3BI,EAA6B,GACnC1wF,EAAU,iBAAiB,uCAAuC,EAAE,QAAQwD,IAAS,CACnFktF,EAAiB,KAAMltF,GAA2B,KAAK,CACzD,CAAC,EAEDu6B,EAAQ,SAAW,GACnBA,EAAQ,YAAc,YAEtB,GAAI,CACF,IAAI4yD,GAAiBriC,GAAS,GAE9B,GAAIoM,EACF,MAAMz3D,EAAK,IAAI,iBAAiBqrD,EAAS,EAAE,GAAImiC,CAAW,EAC1DtwF,EAAM,QAAQ,iBAAiB,MAC1B,CACL,MAAM2B,GAAW,MAAMmB,EAAK,KAAqB,gBAAiBwtF,CAAW,EAC7EA,EAAY,GAAK3uF,GAAS,KAAK,GAC/B6uF,GAAiB7uF,GAAS,KAAK,GAC/B3B,EAAM,QAAQ,iBAAiB,CACjC,CAGA,GAAIwwF,IAAkBD,EAAiB,QAAU,EAC/C,GAAI,CACF,MAAMztF,EAAK,KAAK,iBAAiB0tF,EAAc,iBAAkB,CAC/D,WAAYD,CAAA,CACb,CACH,OAAS76B,GAAK,CACZ,QAAQ,KAAK,uCAAwCA,EAAG,CAC1D,CAGF54B,IAASwzD,CAAW,EACpB/4D,EAAW8E,EAAQ,CACrB,MAAQ,CACNr8B,EAAM,MAAM,wBAAwB,CACtC,SACE49B,EAAQ,SAAW,GACnBA,EAAQ,UAAY;AAAA;AAAA;AAAA;AAAA,YAIhB28B,EAAS,eAAiB,gBAAgB;AAAA,SAEhD,CACF,CAAC,EAIH,MAAMrO,EAAYrsD,EAAU,cAAc,qBAAqB,EAC3DqsD,GAAaqO,GACfrkC,EAAGg2B,EAA0B,QAAS,SAAY,CAUhD,GATkB,MAAMvwB,GACtB,oCAAoCwyB,EAAS,IAAI,KACjD,CACE,MAAO,iBACP,YAAa,SACb,aAAc,aAChB,EAIA,GAAI,CACF,MAAMrrD,EAAK,OAAO,iBAAiBqrD,EAAS,EAAE,EAAE,EAChDnuD,EAAM,QAAQ,iBAAiB,EAC/BmxD,IAAWhD,EAAS,EAAE,EACtB52B,EAAW8E,EAAQ,CACrB,MAAQ,CACNr8B,EAAM,MAAM,0BAA0B,CACxC,CAEJ,CAAC,EAIH,MAAMywF,EAAY5wF,EAAU,cAAc,gBAAgB,EACtD4wF,GAAal2B,GACfrkC,EAAGu6D,EAA0B,QAAS,SAAY,CAChDzwF,EAAM,KAAK,gCAAgC,EAC3C,GAAI,CACF,MAAM8C,EAAK,KAAK,iBAAiBqrD,EAAS,EAAE,SAAS,EACrDnuD,EAAM,QAAQ,iCAAiC,EAE/Cu3B,EAAW8E,EAAQ,EACnB,MAAM16B,EAAW,MAAMmB,EAAK,IAA0B,iBAAiBqrD,EAAS,EAAE,EAAE,EACpF6/B,GAAiB,CAAE,GAAGp2D,EAAO,QAASj2B,EAAS,KAAK,QAAS,CAC/D,MAAQ,CACN3B,EAAM,MAAM,sBAAsB,CACpC,CACF,CAAC,EAIH,MAAM0wF,EAAiB7wF,EAAU,cAAc,mBAAmB,EAC9D6wF,GAAkBviC,GAAS,IAC7Bj4B,EAAGw6D,EAA+B,QAAS,IAAM,CAC/CC,GAAsB9wF,EAAWsuD,EAAQ,EAAS,CACpD,CAAC,EAIH,MAAMjB,EAAYrtD,EAAU,cAAc,eAAe,EACnD+wF,EAAW/wF,EAAU,cAAc,uBAAuB,EAC1DgxF,EAAahxF,EAAU,cAAc,sBAAsB,EAC3DixF,EAAYjxF,EAAU,cAAc,qBAAqB,EAE3DqtD,GAAa2jC,GACf36D,EAAGg3B,EAAW,QAAS,IAAM,CAC3B2jC,EAAW,YAAc3jC,EAAU,OAAS,cAE5C,MAAM6jC,EAASlxF,EAAU,cAAc,uBAAuB,EAC9D,GAAIkxF,GAAU,CAACA,EAAO,cAAc,KAAK,EAAG,CAC1C,MAAMxJ,EAAOwJ,EAAO,cAAc,MAAM,EACpCxJ,IAAMA,EAAK,YAActqD,GAAYiwB,EAAU,OAAS,GAAG,EACjE,CACF,CAAC,EAGC0jC,GAAYE,GACd56D,EAAG06D,EAAU,QAAS,IAAM,CAC1BE,EAAU,YAAcF,EAAS,OAAS,kBAC5C,CAAC,EAIH,MAAMI,EAAiBnxF,EAAU,cAAc,qBAAqB,EAC9DoxF,EAAkBpxF,EAAU,cAAc,uBAAuB,EAEnEmxF,GAAkBC,GACpB/6D,EAAG86D,EAAgB,QAAS,IAAM,CAChC,MAAM1vF,EAAM0vF,EAAe,MAAM,OACjC,GAAI1vF,EAAK,CAEP,MAAMq9D,EAAM,IAAI,MAChBA,EAAI,OAAS,IAAM,CACjBsyB,EAAgB,UAAY;AAAA,wBACd3vF,CAAG;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA,WAQnB,EACAq9D,EAAI,QAAU,IAAM,CAElB,MAAMuyB,EAAerxF,EAAU,cAAc,eAAe,GAAwB,OAAS,IAC7FoxF,EAAgB,UAAY;AAAA,oBAClBh0D,GAAYi0D,CAAW,CAAC;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA,WAQpC,EACAvyB,EAAI,IAAMr9D,CACZ,KAAO,CAEL,MAAM4vF,EAAerxF,EAAU,cAAc,eAAe,GAAwB,OAAS,IAC7FoxF,EAAgB,UAAY;AAAA,kBAClBh0D,GAAYi0D,CAAW,CAAC;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA,SAQpC,CACF,CAAC,CAEL,CAKA,eAAeP,GAAsBQ,EAA8B18E,EAAmBmjB,EAAyC,CAE7H,IAAIw5D,EAA2E,GAC/E,GAAI,CAEFA,IADiB,MAAMtuF,EAAK,IAAyE,eAAe,GACtF,MAAM,UAAY,IAAI,OAAO0Q,GAAKA,EAAE,KAAOiB,CAAS,CACpF,MAAQ,CACNzU,EAAM,MAAM,yBAAyB,EACrC,MACF,CAEA,GAAIoxF,EAAkB,SAAW,EAAG,CAClCpxF,EAAM,KAAK,sDAAsD,EACjE,MACF,CAGA,MAAMytD,EAAU13B,EAAc,MAAO,CAAE,UAAW,0BAA2B,EAC7E03B,EAAQ,UAAY;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA,YAoIV2jC,EAAkB,IAAI59E,GAAK;AAAA,6BACVA,EAAE,EAAE,KAAK0pB,GAAW1pB,EAAE,IAAI,CAAC,GAAGA,EAAE,aAAe,KAAK0pB,GAAW1pB,EAAE,YAAY,CAAC,IAAM,EAAE;AAAA,WACxG,EAAE,KAAK,EAAE,CAAC;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA,IAuBnB,SAAS,KAAK,YAAYi6C,CAAO,EAGjC,MAAM1xB,EAAY0xB,EAAQ,cAAc,iBAAiB,EACnD7vB,EAAU6vB,EAAQ,cAAc,eAAe,EAC/C4jC,EAAgB5jC,EAAQ,cAAc,qBAAqB,EAC3D6jC,EAAa7jC,EAAQ,cAAc,kBAAkB,EAGrDT,EAAc,IAAMS,EAAQ,SAElCv3B,EAAG6F,EAA0B,QAASixB,CAAW,EACjD92B,EAAGu3B,EAAS,QAAU53C,GAAa,CAC7BA,EAAE,SAAW43C,GAAST,EAAA,CAC5B,CAAC,EAGD92B,EAAG0H,EAAS,QAAS,SAAY,CAC/B,MAAM2zD,EAAcF,EAAc,MAC5BG,EAAeF,EAAW,MAEhC,GAAI,CAACC,GAAe,CAACC,EAAc,CACjCxxF,EAAM,MAAM,oDAAoD,EAChE,MACF,CAEA49B,EAAQ,SAAW,GACnBA,EAAQ,YAAc,YAEtB,GAAI,CACF,MAAM96B,EAAK,KAAK,iBAAiB2R,CAAS,iBAAkB,CAC1D,YAAA88E,EACA,KAAMC,CAAA,CACP,EAEDxxF,EAAM,QAAQ,oBAAoB,EAClCgtD,EAAA,EAIA4gC,IADqB,MAAM9qF,EAAK,IAA0C,iBAAiB2R,CAAS,gBAAgB,GACpF,MAAM,eAAiB,GACvDu6E,GAAoBmC,CAAe,EACnCjC,GAAgBiC,CAAe,CACjC,OAAS7uF,EAAgB,CACvB,MAAMrC,EAAUqC,aAAiB,MAAQA,EAAM,QAAU,6BACzDtC,EAAM,MAAMC,CAAO,EACnB29B,EAAQ,SAAW,GACnBA,EAAQ,YAAc,kBACxB,CACF,CAAC,CACH,CAGA,SAASX,GAAYlpB,EAAsB,CACzC,OAAOA,EACJ,MAAM,GAAG,EACT,IAAI4kB,GAAKA,EAAE,CAAC,CAAC,EACb,KAAK,EAAE,EACP,cACA,MAAM,EAAG,CAAC,GAAK,GACpB,CAEA,SAASuE,GAAWr7B,EAAsB,CACxC,MAAMi8B,EAAM,SAAS,cAAc,KAAK,EACxC,OAAAA,EAAI,YAAcj8B,EACXi8B,EAAI,SACb,CAEA,SAAS8xD,GAAmB1vF,EAAsB,CAQhD,MAPsC,CACpC,WAAY,aACZ,QAAS,UACT,WAAY,aACZ,MAAO,QACP,YAAa,eAEFA,CAAI,GAAKA,EAAK,QAAQ,KAAM,GAAG,CAC9C,CAEA,SAASovD,GAAWqH,EAAyB,CAC3C,MAAM/wB,EAAO,IAAI,KAAK+wB,CAAO,EAEvBlH,MADU,OACG,UAAY7pB,EAAK,UAC9B6rD,EAAW,KAAK,MAAMhiC,GAAU,IAAO,GAAK,GAAK,GAAG,EAE1D,OAAIgiC,IAAa,EAAU,QACvBA,IAAa,EAAU,YACvBA,EAAW,EAAU,GAAGA,CAAQ,YAE7B7rD,EAAK,mBAAmB,QAAS,CAAE,MAAO,QAAS,IAAK,UAAW,KAAM,UAAW,CAC7F,CCltDA,MAAMvJ,GAAW,aAqBjB,IAAIq1D,GAA+B,GAKnC,eAAsBC,GAAc/5D,EAAsC,CACxE,KAAM,CAAE,UAAAhyB,EAAW,SAAAgsF,EAAU,SAAAC,EAAU,aAAAC,GAAiBl6D,EAGlDoF,EAAW,SAAS,cAAc,mBAAmBX,EAAQ,IAAI,EACnEW,KAAmB,SAEvB,MAAMlrB,EAAUikB,EAAc,MAAO,CAAE,UAAW,qBAAsB,EACxEjkB,EAAQ,UAAY,qDAGpB,MAAMmpB,EAASlF,EAAc,MAAO,CAAE,UAAW,eAAgB,EAE3Do2B,EAAYp2B,EAAc,SAAU,CACxC,UAAW,kBACX,YAAa,gBACd,EAEKv1B,EAAWu1B,EAAc,SAAU,CACvC,UAAW,oBACX,YAAa,QACd,EAEDG,EAAG11B,EAAU,QAAS,IAAM+2B,EAAW8E,EAAQ,CAAC,EAChDnG,EAAGi2B,EAAW,QAAS,IAAM,CAC3B50B,EAAW8E,EAAQ,EACnBu1D,IAAA,CACF,CAAC,EAED32D,EAAO,YAAYz6B,CAAQ,EAC3By6B,EAAO,YAAYkxB,CAAS,EAG5B,MAAMjxB,EAAQP,GAAY,CACxB,GAAI0B,GACJ,MAAO,eACP,QAAAvqB,EACA,KAAM,KACN,OAAAmpB,CAAA,CACD,EAED,SAAS,KAAK,YAAYC,CAAK,EAC/B7D,GAAUgF,EAAQ,EAGlB,GAAI,CAEFq1D,IADiB,MAAM5uF,EAAK,IAAkB,iBAAiB8C,CAAS,UAAU,GACxD,KAC1BmsF,GAAcjgF,EAAS8lB,CAAK,CAC9B,MAAQ,CACN9lB,EAAQ,UAAY,sDACtB,CACF,CAKA,SAASigF,GAAclyF,EAAwB+3B,EAA6B,CAC1E,GAAI85D,GAAe,SAAW,EAAG,CAC/B7xF,EAAU,UAAY;AAAA;AAAA;AAAA;AAAA;AAAA,MAMtB,MACF,CAEAA,EAAU,UAAY;AAAA;AAAA,QAEhB6xF,GAAe,IAAItmC,GAAU4mC,GAAiB5mC,CAAM,CAAC,EAAE,KAAK,EAAE,CAAC;AAAA;AAAA,IAKrEvrD,EAAU,iBAAiB,cAAc,EAAE,QAAQ0qD,GAAQ,CACzD,MAAMxnC,EAAWwnC,EAAK,aAAa,gBAAgB,EACnD,GAAI,CAACxnC,EAAU,OAEf,MAAMqoC,EAASsmC,GAAe,KAAKh/E,GAAKA,EAAE,KAAOqQ,CAAQ,EACzD,GAAI,CAACqoC,EAAQ,OAGb,MAAMhuB,EAAamtB,EAAK,cAAc,cAAc,EAChDntB,GACFlH,EAAGkH,EAAY,SAAU,SAAY,CACnC,MAAMqvB,EAAUrvB,EAAW,MAC3B,GAAI,CACF,MAAMt6B,EAAK,MAAM,iBAAiB80B,EAAM,SAAS,YAAY7U,CAAQ,GAAI,CAAE,KAAM0pC,CAAA,CAAS,EAC1FrB,EAAO,KAAOqB,EACdzsD,EAAM,QAAQ,cAAc,EAC5B43B,EAAM,eAAe7U,EAAU0pC,CAAO,CACxC,MAAQ,CACNrvB,EAAW,MAAQguB,EAAO,IAC5B,CACF,CAAC,EAIH,MAAM6mC,EAAY1nC,EAAK,cAAc,aAAa,EAC9C0nC,GACF/7D,EAAG+7D,EAA0B,QAAS,SAAY,CAChD,KAAM,CAAE,QAAAt2D,CAAA,EAAY,MAAA2yB,GAAA,wBAAA3yB,CAAA,QAAM,2BAAAm3B,EAAA,EAA0B,eAAAn3B,CAAA,WAUpD,GATkB,MAAMA,EACtB,UAAUyvB,EAAO,IAAI,sBACrB,CACE,MAAO,gBACP,YAAa,SACb,aAAc,aAChB,EAIA,GAAI,CACF,MAAMtoD,EAAK,OAAO,iBAAiB80B,EAAM,SAAS,YAAY7U,CAAQ,EAAE,EACxE2uE,GAAiBA,GAAe,OAAOh/E,GAAKA,EAAE,KAAOqQ,CAAQ,EAC7DgvE,GAAclyF,EAAW+3B,CAAK,EAC9B53B,EAAM,QAAQ,gBAAgB,EAC9B43B,EAAM,WAAW7U,CAAQ,CAC3B,MAAQ,CAER,CAEJ,CAAC,CAEL,CAAC,CACH,CAKA,SAASivE,GAAiB5mC,EAA4B,CACpD,MAAM1yB,EAAW0yB,EAAO,KACrB,MAAM,GAAG,EACT,IAAIzyB,GAAKA,EAAE,CAAC,CAAC,EACb,KAAK,EAAE,EACP,cACA,MAAM,EAAG,CAAC,EAEPu5D,EAAe9mC,EAAO,OAAS,aAErC,MAAO;AAAA,+CACsCA,EAAO,EAAE;AAAA;AAAA,UAE9CA,EAAO,UACT,aAAaA,EAAO,SAAS,UAAUluB,GAAWkuB,EAAO,IAAI,CAAC,KAC9D1yB,CACJ;AAAA;AAAA;AAAA,mCAG+BwE,GAAWkuB,EAAO,IAAI,CAAC;AAAA,oCACtBluB,GAAWkuB,EAAO,KAAK,CAAC;AAAA;AAAA;AAAA,UAGlD8mC,EACF,mDACA;AAAA,sCAC8B9mC,EAAO,OAAS,QAAU,WAAa,EAAE;AAAA,uCACxCA,EAAO,OAAS,SAAW,WAAa,EAAE;AAAA,sBAE7E;AAAA;AAAA;AAAA,UAGO8mC,EAEH,GADA,mFAEJ;AAAA;AAAA;AAAA,GAIJ,CAKA,SAASh1D,GAAWr7B,EAAsB,CACxC,MAAMi8B,EAAM,SAAS,cAAc,KAAK,EACxC,OAAAA,EAAI,YAAcj8B,EACXi8B,EAAI,SACb,CC7MA,MAAMzB,GAAW,eAwBjB,IAAI81D,GAAiC,GAK9B,SAAS9lC,GAAgBz0B,EAA+B,CAC7D,KAAM,CAAE,UAAAhyB,EAAW,aAAAwsF,CAAA,EAAiBx6D,EAG9BoF,EAAW,SAAS,cAAc,mBAAmBX,EAAQ,IAAI,EACnEW,KAAmB,SAEvB,MAAMlrB,EAAUikB,EAAc,MAAO,CAAE,UAAW,uBAAwB,EAE1EjkB,EAAQ,UAAY;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA,IA2QpB,IAAIqyE,EAAY,MACZkO,EAAkC,KAGtC,MAAMp3D,EAASlF,EAAc,MAAO,CAAE,UAAW,eAAgB,EAE3DgG,EAAYhG,EAAc,SAAU,CACxC,UAAW,oBACX,YAAa,SACd,EAEKu8D,EAAUv8D,EAAc,SAAU,CACtC,UAAW,kBACX,YAAa,kBACd,EAEDG,EAAG6F,EAAW,QAAS,IAAMxE,EAAW8E,EAAQ,CAAC,EAGjDnG,EAAGo8D,EAAS,QAAS,SAAY,CAC/B,GAAInO,IAAc,MAAO,OAEzB,MAAMhuC,EAAOrkC,EAAQ,cAAc,cAAc,EACjD,GAAI,CAACqkC,EAAK,gBAAiB,CACzBA,EAAK,iBACL,MACF,CACA,MAAM3uC,EAASsK,EAAQ,cAAc,eAAe,EAAuB,MAAM,OAC3EqD,EAAQrD,EAAQ,cAAc,cAAc,EAAwB,MACpE7R,EAAW6R,EAAQ,cAAc,iBAAiB,EAA0B,MAAM,OAExFwgF,EAAQ,SAAW,GACnBA,EAAQ,YAAc,aAEtB,MAAMn2B,EAAWrqD,EAAQ,cAAc,eAAe,EAEtD,GAAI,EACe,MAAMhP,EAAK,KAAgD,iBAAiB8C,CAAS,WAAY,CAChH,MAAA4B,EACA,KAAA2N,EACA,QAASlV,GAAW,OACrB,GAEY,KAAK,YAChBk8D,EAAS,YAAc,8BAA8B30D,CAAK,GAC1D20D,EAAS,UAAU,OAAO,OAAO,EACjCA,EAAS,UAAU,IAAI,MAAM,IAE7BA,EAAS,YAAc,4EACvBA,EAAS,UAAU,IAAI,QAAS,MAAM,GAGxCn8D,EAAM,QAAQ,sBAAsBwH,CAAK,EAAE,EAC3C4qF,IAAe5qF,CAAK,EACpB,WAAW,IAAM+vB,EAAW8E,EAAQ,EAAG,IAAI,CAC7C,MAAQ,CACN8/B,EAAS,YAAc,8BACvBA,EAAS,UAAU,IAAI,QAAS,MAAM,CACxC,SACEm2B,EAAQ,SAAW,GACnBA,EAAQ,YAAc,iBACxB,CACF,CAAC,EAEDr3D,EAAO,YAAYc,CAAS,EAC5Bd,EAAO,YAAYq3D,CAAO,EAG1B,WAAW,IAAM,CACf,MAAMC,EAAezgF,EAAQ,cAAc,iBAAiB,EACtD0gF,EAAgB1gF,EAAQ,cAAc,kBAAkB,EACxDqqD,EAAWrqD,EAAQ,cAAc,uBAAuB,EAG1DygF,GACFr8D,EAAGq8D,EAAc,QAAS,SAAY,CACpC,GAAI,CAACF,EAAiB,CACpBryF,EAAM,MAAM,yBAAyB,EACrC,MACF,CAEA,MAAMmV,EAAQrD,EAAQ,cAAc,sBAAsB,EAAwB,MAElFygF,EAAa,SAAW,GACxBA,EAAa,UAAY,0CAEzB,GAAI,CAEF,MAAMzvF,EAAK,KAAK,iBAAiB8C,CAAS,uBAAwB,CAChE,WAAYysF,EAAgB,GAC5B,KAAAl9E,CAAA,CACD,EAEDgnD,EAAS,YAAc,KAAKk2B,EAAgB,IAAI,iBAChDl2B,EAAS,UAAU,OAAO,OAAO,EACjCA,EAAS,UAAU,IAAI,MAAM,EAE7Bn8D,EAAM,QAAQ,GAAGqyF,EAAgB,IAAI,gBAAgB,EACrDD,IAAeC,EAAgB,OAASA,EAAgB,IAAI,EAC5D,WAAW,IAAM96D,EAAW8E,EAAQ,EAAG,GAAI,CAC7C,OAAS/5B,EAAY,CACnB,MAAMP,EAAMO,GAAO,UAAU,MAAM,OAAS,uBAC5C65D,EAAS,YAAcp6D,EACvBo6D,EAAS,UAAU,IAAI,QAAS,MAAM,EACtCn8D,EAAM,MAAM+B,CAAG,CACjB,SACEwwF,EAAa,SAAW,GACxBA,EAAa,UAAY;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA,WAS3B,CACF,CAAC,EAICC,GACFt8D,EAAGs8D,EAAe,QAAS,SAAY,CACrC,GAAI,CAACH,GAAmB,CAACA,EAAgB,MAAO,CAC9CryF,EAAM,MAAM,+CAA+C,EAC3D,MACF,CAEA,MAAMmV,EAAQrD,EAAQ,cAAc,sBAAsB,EAAwB,MAElF0gF,EAAc,SAAW,GACzBA,EAAc,UAAY,2CAE1B,GAAI,EACe,MAAM1vF,EAAK,KAAgD,iBAAiB8C,CAAS,WAAY,CAChH,MAAOysF,EAAgB,MACvB,KAAAl9E,CAAA,CACD,GAEY,KAAK,YAChBgnD,EAAS,YAAc,8BAA8Bk2B,EAAgB,KAAK,GAC1El2B,EAAS,UAAU,OAAO,OAAO,EACjCA,EAAS,UAAU,IAAI,MAAM,IAE7BA,EAAS,YAAc,mDACvBA,EAAS,UAAU,IAAI,QAAS,MAAM,GAGxCn8D,EAAM,QAAQ,sBAAsBqyF,EAAgB,IAAI,EAAE,EAC1DD,IAAeC,EAAgB,KAAK,EACpC,WAAW,IAAM96D,EAAW8E,EAAQ,EAAG,IAAI,CAC7C,MAAQ,CACN8/B,EAAS,YAAc,4BACvBA,EAAS,UAAU,IAAI,QAAS,MAAM,CACxC,SACEq2B,EAAc,SAAW,GACzBA,EAAc,UAAY;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA,WAO5B,CACF,CAAC,CAEL,EAAG,CAAC,EAGJ,MAAMt3D,EAAQP,GAAY,CACxB,GAAI0B,GACJ,MAAO,qBACP,QAAAvqB,EACA,KAAM,KACN,OAAAmpB,CAAA,CACD,EAED,SAAS,KAAK,YAAYC,CAAK,EAC/B7D,GAAUgF,EAAQ,EAGlBo2D,GAAmB3gF,EAASlM,CAAS,EAGrC,MAAM8sF,EAAU5gF,EAAQ,iBAAiB,iBAAiB,EAC1D4gF,EAAQ,QAAQ94D,GAAO,CACrB1D,EAAG0D,EAAoB,QAAS,IAAM,CACpC,MAAMG,EAAQH,EAAI,aAAa,UAAU,GAAK,MAC9CuqD,EAAYpqD,EAEZ24D,EAAQ,QAAQjxD,GAAKA,EAAE,UAAU,OAAO,QAAQ,CAAC,EACjD7H,EAAI,UAAU,IAAI,QAAQ,EAE1B9nB,EAAQ,iBAAiB,qBAAqB,EAAE,QAAQ+kB,GAAO,CAC7DA,EAAI,UAAU,OAAO,SAAUA,EAAI,KAAO,OAAOkD,CAAK,EAAE,CAC1D,CAAC,CACH,CAAC,CACH,CAAC,EAGD44D,GAAa7gF,EAASlM,EAAYuoD,GAAY,CAC5CkkC,EAAkBlkC,CACpB,CAAC,EAGD,WAAW,IAAM,CACf,MAAMykC,EAAU9gF,EAAQ,cAAc,gBAAgB,EAClD8gF,GACF18D,EAAG08D,EAAwB,QAAS,IAAM,CACxC,MAAMC,EAAY/gF,EAAQ,cAAc,cAAc,EACtD,UAAU,UAAU,UAAU+gF,EAAU,KAAK,EAAE,KAAK,IAAM,CACxD7yF,EAAM,QAAQ,0BAA0B,CAC1C,CAAC,EAAE,MAAM,IAAM,CAEb6yF,EAAU,SACV,SAAS,YAAY,MAAM,EAC3B7yF,EAAM,QAAQ,aAAa,CAC7B,CAAC,CACH,CAAC,CAEL,EAAG,CAAC,CACN,CAKA,eAAeyyF,GAAmB5yF,EAAwB+F,EAAkC,CAC1F,MAAMitF,EAAYhzF,EAAU,cAAc,cAAc,EAExD,GAAI,CACF,MAAM8B,EAAW,MAAMmB,EAAK,IAA4C,iBAAiB8C,CAAS,eAAe,EACjHitF,EAAU,MAAQlxF,EAAS,KAAK,MAAQA,EAAS,KAAK,YAAc,oBACtE,MAAQ,CAEN,GAAI,CACF,MAAMA,EAAW,MAAMmB,EAAK,KAA8C,iBAAiB8C,CAAS,WAAY,CAC9G,MAAO,GACP,KAAM,SACN,mBAAoB,GACrB,EACGjE,EAAS,KAAK,WAChBkxF,EAAU,MAAQlxF,EAAS,KAAK,WAEhCkxF,EAAU,MAAQ,8BAEtB,MAAQ,CACNA,EAAU,MAAQ,8BACpB,CACF,CACF,CAKA,eAAeC,GAAmBltF,EAAkC,CAClE,GAAI,CAEFusF,IADiB,MAAMrvF,EAAK,IAAkC,iBAAiB8C,CAAS,UAAU,GACzE,KAAK,SAAW,EAC3C,OAAStD,EAAO,CACd,QAAQ,KAAK,gDAAiDA,CAAK,EACnE6vF,GAAgB,EAClB,CACF,CAKA,eAAeQ,GAAa9yF,EAAwB+F,EAAmBmtF,EAA4D,CACjI,MAAMlqB,EAAShpE,EAAU,cAAc,gBAAgB,EACvD,GAAKgpE,EAEL,GAAI,CAEF,MAAMiqB,GAAmBltF,CAAS,EAGlC,MAAM0D,GADW,MAAMxG,EAAK,IAA6B,eAAe,GAC9C,KAAK,UAAY,GAGrCkwF,EAAmB,IAAI,IAC3Bb,GACG,OAAOz/E,GAAKA,EAAE,iBAAiB,EAC/B,IAAIA,GAAKA,EAAE,iBAAiB,GAK3B0+E,EAAoB9nF,EAAS,OAAOkK,GAAK,CAACw/E,EAAiB,IAAIx/E,EAAE,EAAE,CAAC,EAE1E,GAAI49E,EAAkB,SAAW,EAAG,CAClCvoB,EAAO,UAAY;AAAA;AAAA,YAEbmqB,EAAiB,KAAO,EACxB,yCACA,oBAAoB;AAAA;AAAA;AAAA;AAAA,QAK1B,MACF,CAEAnqB,EAAO,UAAYuoB,EAAkB,IAAIjjC,GAAW,CAClD,MAAMz1B,EAAWy1B,EAAQ,KAAK,MAAM,GAAG,EAAE,IAAIx1B,GAAKA,EAAE,CAAC,CAAC,EAAE,KAAK,EAAE,EAAE,UAAU,EAAG,CAAC,EAAE,cAC3EiE,EAAYuxB,EAAQ,YAAcA,EAAQ,UAC1C8kC,EAAW,CAAC,CAAC9kC,EAAQ,MACrB+kC,EAAW,CAAC/kC,EAAQ,MAAOA,EAAQ,YAAY,EAAE,OAAO,OAAO,EAAE,KAAK,KAAK,GAAKA,EAAQ,MAAQ,WAEtG,MAAO;AAAA,iDACoCA,EAAQ,EAAE,qBAAqB8kC,CAAQ;AAAA,6DAC3B9kC,EAAQ,EAAE;AAAA;AAAA;AAAA,cAGzDvxB,EAAY,aAAaA,CAAS,UAAUM,GAAWixB,EAAQ,IAAI,CAAC,KAAOz1B,CAAQ;AAAA;AAAA;AAAA,wCAGzDwE,GAAWixB,EAAQ,IAAI,CAAC;AAAA,yCACvBjxB,GAAWg2D,CAAQ,CAAC,GAAID,EAAiE,GAAtD,mDAAwD;AAAA;AAAA;AAAA,OAIhI,CAAC,EAAE,KAAK,EAAE,EAGV,MAAM9yF,EAAU0oE,EAAO,iBAAiB,iBAAiB,EACzD1oE,EAAQ,QAAQivC,GAAU,CACxBlZ,EAAGkZ,EAAuB,QAAS,IAAM,CACvCjvC,EAAQ,QAAQggC,GAAKA,EAAE,UAAU,OAAO,UAAU,CAAC,EACnDiP,EAAO,UAAU,IAAI,UAAU,EAE/B,MAAM36B,EAAY26B,EAAO,aAAa,SAAS,EACzCijD,EAAkBjB,EAAkB,QAAU59E,EAAE,KAAOiB,CAAS,GAAK,KAC3Es+E,EAASV,CAAe,CAC1B,CAAC,CACH,CAAC,CACH,MAAgB,CACdxpB,EAAO,UAAY;AAAA;AAAA;AAAA;AAAA,KAKrB,CACF,CAKA,SAAS3rC,GAAWr7B,EAAsB,CACxC,MAAMi8B,EAAM,SAAS,cAAc,KAAK,EACxC,OAAAA,EAAI,YAAcj8B,EACXi8B,EAAI,SACb,wHChpBMzB,GAAW,aAmBX82D,GAAqB,CACzB,iBACA,YACA,WACA,gBACA,iBACA,aACA,eACA,iBACA,gBACA,cACA,kBACA,eACA,cACA,aACF,EAKO,SAASC,GAAcx7D,EAA6B,CACzD,KAAM,CAAE,KAAAt4B,EAAM,KAAA6V,EAAM,qBAAAk+E,EAAuBF,GAAoB,OAAAr2D,EAAQ,SAAAq0B,GAAav5B,EAC9E2iC,EAASj7D,IAAS,QAAU6V,GAAM,GAClCqlD,EAASl7D,IAAS,OAGlB09B,EAAW,SAAS,cAAc,mBAAmBX,EAAQ,IAAI,EACnEW,KAAmB,SAEvB,MAAMlrB,EAAUikB,EAAc,MAAO,CAAE,UAAW,qBAAsB,EAExE,GAAIykC,GAAUrlD,EACZrD,EAAQ,UAAY;AAAA;AAAA;AAAA,+DAGuCqD,EAAK,OAAS,SAAS;AAAA;AAAA,kBAEpE+nB,GAAW/nB,EAAK,IAAI,CAAC;AAAA,cACzBA,EAAK,YAAc,yBAAyB+nB,GAAW/nB,EAAK,WAAW,CAAC,OAAS,EAAE;AAAA;AAAA;AAAA;AAAA;AAAA,6BAKpEA,EAAK,YAAY,MAAM;AAAA;AAAA,cAEtCA,EAAK,YAAY,IAAI7K,GAAK;AAAA,6CACKgpF,GAAiBhpF,CAAC,CAAC;AAAA,aACnD,EAAE,KAAK,EAAE,CAAC;AAAA;AAAA;AAAA;AAAA,UAIb6K,EAAK,UAAY,mFAAqF,EAAE;AAAA;AAAA,UAGzG,CACL,MAAMo+E,EAAkBp+E,GAAM,aAAe,GAE7CrD,EAAQ,UAAY;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA,4BAMIqD,GAAM,MAAQ,EAAE;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA,4BAMhBA,GAAM,OAAS,SAAS;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA,sEAOkBA,GAAM,aAAe,EAAE;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA,cAM/Ek+E,EAAqB,IAAI/oF,GAAK;AAAA;AAAA,mEAEuBA,CAAC;AAAA,yBAC3CipF,EAAgB,SAASjpF,CAAC,EAAI,UAAY,EAAE;AAAA,wBAC7CgpF,GAAiBhpF,CAAC,CAAC;AAAA;AAAA,aAE9B,EAAE,KAAK,EAAE,CAAC;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA,MAYnB,WAAW,IAAM,CACf,MAAMkpF,EAAY1hF,EAAQ,cAAc,4BAA4B,EAC9D2hF,EAAa3hF,EAAQ,cAAc,6BAA6B,EAElE0hF,GACFt9D,EAAGs9D,EAA0B,QAAS,IAAM,CAC1C1hF,EAAQ,iBAAiB,sBAAsB,EAAE,QAAQ6rB,GAAM,CAC5DA,EAAwB,QAAU,EACrC,CAAC,CACH,CAAC,EAGC81D,GACFv9D,EAAGu9D,EAA2B,QAAS,IAAM,CAC3C3hF,EAAQ,iBAAiB,sBAAsB,EAAE,QAAQ6rB,GAAM,CAC5DA,EAAwB,QAAU,EACrC,CAAC,CACH,CAAC,CAEL,EAAG,CAAC,CACN,CAGA,MAAM1C,EAASlF,EAAc,MAAO,CAAE,UAAW,eAAgB,EAEjE,GAAIykC,EAAQ,CACV,MAAM9L,EAAU34B,EAAc,SAAU,CACtC,UAAW,kBACX,YAAa,OACd,EAEKv1B,EAAWu1B,EAAc,SAAU,CACvC,UAAW,oBACX,YAAa,QACd,EAEDG,EAAG11B,EAAU,QAAS,IAAM+2B,EAAW8E,EAAQ,CAAC,EAE3ClnB,GAAM,YACT+gB,EAAGw4B,EAAS,QAAS,IAAM,CACzBn3B,EAAW8E,EAAQ,EACnB+2D,GAAc,CAAE,GAAGx7D,EAAO,KAAM,OAAQ,CAC1C,CAAC,EACDqD,EAAO,YAAYyzB,CAAO,GAG5BzzB,EAAO,YAAYz6B,CAAQ,CAC7B,KAAO,CACL,MAAMu7B,EAAYhG,EAAc,SAAU,CACxC,UAAW,oBACX,YAAa,SACd,EAEK6H,EAAU7H,EAAc,SAAU,CACtC,UAAW,kBACX,YAAawkC,EAAS,eAAiB,cACxC,EAmDD,GAjDArkC,EAAG6F,EAAW,QAAS,IAAMxE,EAAW8E,EAAQ,CAAC,EAEjDnG,EAAG0H,EAAS,QAAS,SAAY,CAC/B,MAAMuY,EAAOrkC,EAAQ,cAAc,YAAY,EAC/C,GAAI,CAACqkC,EAAK,gBAAiB,CACzBA,EAAK,iBACL,MACF,CAEA,MAAMpiC,EAAQjC,EAAQ,cAAc,YAAY,EAAuB,MAAM,OACvEtN,EAAesN,EAAQ,cAAc,mBAAmB,EAA0B,MAAM,OACxFm2D,EAASn2D,EAAQ,cAAc,aAAa,EAAuB,MAEnE8R,EAAwB,GAC9B9R,EAAQ,iBAAiB,8BAA8B,EAAE,QAAQ6rB,GAAM,CACrE/Z,EAAY,KAAM+Z,EAAwB,KAAK,CACjD,CAAC,EAED,MAAM+1D,EAAiB,CACrB,GAAIv+E,GAAM,IAAM,QAAQ,KAAK,KAAK,GAClC,KAAApB,EACA,YAAavP,GAAe,OAC5B,MAAAyjE,EACA,YAAArkD,CAAA,EAGFga,EAAQ,SAAW,GACnBA,EAAQ,YAAc,YAEtB,GAAI,CACF,GAAI28B,EACF,MAAMz3D,EAAK,IAAI,cAAcqS,EAAM,EAAE,GAAIu+E,CAAQ,EACjD1zF,EAAM,QAAQ,cAAc,MACvB,CACL,MAAM2B,EAAW,MAAMmB,EAAK,KAAqB,aAAc4wF,CAAQ,EACvEA,EAAS,GAAK/xF,EAAS,KAAK,GAC5B3B,EAAM,QAAQ,cAAc,CAC9B,CAEA88B,IAAS42D,CAAQ,EACjBn8D,EAAW8E,EAAQ,CACrB,MAAQ,CAER,SACEuB,EAAQ,SAAW,GACnBA,EAAQ,YAAc28B,EAAS,eAAiB,aAClD,CACF,CAAC,EAEGA,GAAU,CAACplD,GAAM,UAAW,CAC9B,MAAM+2C,EAAYn2B,EAAc,SAAU,CACxC,UAAW,iBACX,YAAa,SACd,EAEDG,EAAGg2B,EAAW,QAAS,SAAY,CACjC,KAAM,CAAE,QAAAvwB,CAAA,EAAY,MAAA2yB,GAAA,wBAAA3yB,CAAA,QAAM,2BAAAm3B,EAAA,EAA0B,eAAAn3B,CAAA,WAUpD,GATkB,MAAMA,EACtB,wCAAwCxmB,EAAM,IAAI,UAClD,CACE,MAAO,cACP,YAAa,SACb,aAAc,aAChB,EAIA,GAAI,CACF,MAAMrS,EAAK,OAAO,cAAcqS,EAAM,EAAE,EAAE,EAC1CnV,EAAM,QAAQ,cAAc,EAC5BmxD,IAAWh8C,EAAM,EAAE,EACnBoiB,EAAW8E,EAAQ,CACrB,MAAQ,CAER,CAEJ,CAAC,EAEDpB,EAAO,YAAYixB,CAAS,CAC9B,CAEAjxB,EAAO,YAAYc,CAAS,EAC5Bd,EAAO,YAAY2C,CAAO,CAC5B,CAGA,MAAM1C,EAAQP,GAAY,CACxB,GAAI0B,GACJ,MAAOm+B,EAAS,eAAkBD,EAAS,YAAc,WACzD,QAAAzoD,EACA,KAAM,KACN,OAAAmpB,CAAA,CACD,EAED,SAAS,KAAK,YAAYC,CAAK,EAC/B7D,GAAUgF,EAAQ,CACpB,CAKA,SAASi3D,GAAiBK,EAA4B,CACpD,OAAOA,EACJ,QAAQ,IAAK,IAAI,EACjB,MAAM,MAAM,EACZ,IAAIC,GAAQA,EAAK,OAAO,CAAC,EAAE,cAAgBA,EAAK,MAAM,CAAC,CAAC,EACxD,KAAK,GAAG,CACb,CAKA,SAAS12D,GAAWr7B,EAAsB,CACxC,MAAMi8B,EAAM,SAAS,cAAc,KAAK,EACxC,OAAAA,EAAI,YAAcj8B,EACXi8B,EAAI,SACb,CCpSA,MAAMzB,GAAW,eAcV,SAASw3D,GAAgBj8D,EAA0B,GAAU,CAClE,KAAM,CAAE,cAAAk8D,EAAgB,OAAQ,aAAAC,EAAe,OAAUn8D,EAGnDoF,EAAW,SAAS,cAAc,mBAAmBX,EAAQ,IAAI,EACnEW,KAAmB,SAEvB,MAAMlrB,EAAUikB,EAAc,MAAO,CAAE,UAAW,uBAAwB,EAE1EjkB,EAAQ,UAAY;AAAA;AAAA;AAAA;AAAA;AAAA,qCAKeiiF,IAAiB,MAAQ,WAAa,EAAE;AAAA,kEACXA,IAAiB,MAAQ,UAAY,EAAE;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA,qCAMpEA,IAAiB,YAAc,WAAa,EAAE;AAAA,wEACXA,IAAiB,YAAc,UAAY,EAAE;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA,qCAMhFA,IAAiB,QAAU,WAAa,EAAE;AAAA,oEACXA,IAAiB,QAAU,UAAY,EAAE;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA,qCAMxEA,IAAiB,UAAY,WAAa,EAAE;AAAA,sEACXA,IAAiB,UAAY,UAAY,EAAE;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA,qCAM5EA,IAAiB,YAAc,WAAa,EAAE;AAAA,wEACXA,IAAiB,YAAc,UAAY,EAAE;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA,qCAMhFA,IAAiB,WAAa,WAAa,EAAE;AAAA,uEACXA,IAAiB,WAAa,UAAY,EAAE;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA,qCAY9ED,IAAkB,OAAS,WAAa,EAAE;AAAA,oEACXA,IAAkB,OAAS,UAAY,EAAE;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA,qCAOxEA,IAAkB,MAAQ,WAAa,EAAE;AAAA,mEACXA,IAAkB,MAAQ,UAAY,EAAE;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA,qCAOtEA,IAAkB,WAAa,WAAa,EAAE;AAAA,wEACXA,IAAkB,WAAa,UAAY,EAAE;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA,qCAOhFA,IAAkB,MAAQ,WAAa,EAAE;AAAA,mEACXA,IAAkB,MAAQ,UAAY,EAAE;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA,IAazGhiF,EAAQ,iBAAiB,mBAAmB,EAAE,QAAQzO,GAAS,CAC7D6yB,EAAG7yB,EAAsB,SAAU,IAAM,CACvC,MAAM2wF,EAAS3wF,EAA2B,KAC1CyO,EAAQ,iBAAiB,UAAUkiF,CAAK,IAAI,EAAE,QAAQlgC,GAAS,CAC7D,MAAMvJ,EAAOuJ,EAAM,QAAQ,aAAa,EACpCvJ,IACGuJ,EAA2B,QAC9B39B,GAASo0B,EAAqB,UAAU,EAExCl0B,GAAYk0B,EAAqB,UAAU,EAGjD,CAAC,CACH,CAAC,CACH,CAAC,EAGD,MAAMtvB,EAASlF,EAAc,MAAO,CAAE,UAAW,eAAgB,EAE3DgG,EAAYhG,EAAc,SAAU,CACxC,UAAW,oBACX,YAAa,SACd,EAEKk+D,EAAYl+D,EAAc,SAAU,CACxC,UAAW,kBACX,YAAa,SACd,EAEDG,EAAG6F,EAAW,QAAS,IAAMxE,EAAW8E,EAAQ,CAAC,EAEjDnG,EAAG+9D,EAAW,QAAS,SAAY,CACjC,MAAM5/E,EAAUvC,EAAQ,cAAc,gCAAgC,GAAwB,MACxFoiF,EAASpiF,EAAQ,cAAc,+BAA+B,GAAwB,MAE5FmiF,EAAU,SAAW,GACrBA,EAAU,YAAc,eAExB,GAAI,CACF,MAAME,GAAc9/E,EAAQ6/E,CAAK,EACjCt8D,EAAM,WAAWvjB,EAAQ6/E,CAAK,EAC9B38D,EAAW8E,EAAQ,CACrB,MAAQ,CAER,SACE43D,EAAU,SAAW,GACrBA,EAAU,YAAc,QAC1B,CACF,CAAC,EAEDh5D,EAAO,YAAYc,CAAS,EAC5Bd,EAAO,YAAYg5D,CAAS,EAG5B,MAAM/4D,EAAQP,GAAY,CACxB,GAAI0B,GACJ,MAAO,cACP,QAAAvqB,EACA,KAAM,KACN,OAAAmpB,CAAA,CACD,EAED,SAAS,KAAK,YAAYC,CAAK,EAC/B7D,GAAUgF,EAAQ,CACpB,CAKA,eAAe83D,GAAc9/E,EAAsB6/E,EAAmC,CACpF,MAAMtuF,EAAYe,EAAS,WAAW,iBACtC,GAAI,CAACf,EAAW,CACd5F,EAAM,MAAM,qBAAqB,EACjC,MACF,CAEA,GAAI,CACF,MAAM2B,EAAW,MAAMmB,EAAK,IAAa,iBAAiB8C,CAAS,UAAW,CAC5E,QAAS,CACP,OAAUwuF,GAAe//E,CAAM,EACjC,CACD,EAGKC,EAAO+/E,GAAW1yF,EAAS,KAAM0S,CAAM,EACvC/S,EAAM,IAAI,gBAAgBgT,CAAI,EAC9B1D,EAAI,SAAS,cAAc,GAAG,EACpCA,EAAE,KAAOtP,EACTsP,EAAE,SAAW,WAAWsjF,CAAK,IAAI,IAAI,OAAO,cAAc,MAAM,GAAG,EAAE,CAAC,CAAC,IAAII,GAAajgF,CAAM,CAAC,GAC/FzD,EAAE,QACF,IAAI,gBAAgBtP,CAAG,EAEvBtB,EAAM,QAAQ,kBAAkB,CAClC,MAAQ,CACN,MAAAA,EAAM,MAAM,eAAe,EACrB,IAAI,MAAM,eAAe,CACjC,CACF,CAKA,SAASo0F,GAAe//E,EAA8B,CACpD,OAAQA,EAAA,CACN,IAAK,OAAQ,MAAO,mBACpB,IAAK,MAAO,MAAO,WACnB,IAAK,WAAY,MAAO,gBACxB,IAAK,MAAO,MAAO,kBAEvB,CAKA,SAASigF,GAAajgF,EAA8B,CAClD,OAAQA,EAAA,CACN,IAAK,OAAQ,MAAO,OACpB,IAAK,MAAO,MAAO,MACnB,IAAK,WAAY,MAAO,KACxB,IAAK,MAAO,MAAO,MAEvB,CAKA,SAASggF,GAAWvyF,EAAeuS,EAA4B,CAC7D,IAAIvC,EACA5R,EAEJ,OAAQmU,EAAA,CACN,IAAK,OACHvC,EAAU,KAAK,UAAUhQ,EAAM,KAAM,CAAC,EACtC5B,EAAO,mBACP,MACF,IAAK,MACH4R,EAAU,OAAOhQ,GAAS,SAAWA,EAAO,KAAK,UAAUA,CAAI,EAC/D5B,EAAO,WACP,MACF,IAAK,WACH4R,EAAU,OAAOhQ,GAAS,SAAWA,EAAO,KAAK,UAAUA,EAAM,KAAM,CAAC,EACxE5B,EAAO,gBACP,MACF,IAAK,MAEH4R,EAAU,OAAOhQ,GAAS,SAAWA,EAAO,GAC5C5B,EAAO,kBACP,MAGJ,OAAO,IAAI,KAAK,CAAC4R,CAAO,EAAG,CAAE,KAAA5R,EAAM,CACrC,CCtQA,MAAMm8B,GAAW,oBAkBjB,IAAIk4D,GAA4B,GAC5BC,GAAc,GACdC,GAAwB,GACxBC,GAAwB,GACxBC,GAAmB,GACnBC,GAAmB,GAKhB,SAASC,GAAoBj9D,EAA8B,GAAU,CAC1E,KAAM,CACJ,OAAAk9D,EAAS,MACT,SAAA3Y,EAAW,GACX,QAAAW,EAAU,GAAK,KAAO,KACtB,SAAAiY,EACA,WAAAr4E,CAAA,EACEkb,EAEJ28D,GAAc,GACdC,GAAc,GACdG,GAAmB,GACnBC,GAAmB,GAGnB,MAAM53D,EAAW,SAAS,cAAc,mBAAmBX,EAAQ,IAAI,EACnEW,KAAmB,SAEvB,MAAMlrB,EAAUikB,EAAc,MAAO,CAAE,UAAW,4BAA6B,EAE/E,SAASi/D,GAAe,CACtB,MAAMC,EAAgBR,GAAY,IAAIxvF,GAAK,kBAAkBA,EAAE,EAAE,KAAKA,EAAE,KAAO0vF,GAAmB,WAAa,EAAE,IAAIz3D,GAAWj4B,EAAE,IAAI,CAAC,WAAW,EAAE,KAAK,EAAE,EACrJiwF,EAAgBR,GAAY,OAAS,kBAAkB9jF,EAAE,EAAE,KAAKA,EAAE,KAAOgkF,GAAmB,WAAa,EAAE,IAAI13D,IAAYtsB,EAAE,SAAWA,EAAE,MAAQ,OAAOA,EAAE,EAAE,GAAG,MAAM,EAAG,EAAE,CAAC,CAAC,IAAIA,EAAE,SAAWA,EAAE,MAAQ,IAAI,OAAS,GAAK,IAAM,EAAE,WAAW,EAAE,KAAK,EAAE,EAE5PkB,EAAQ,UAAY;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA,YAOZqqE,EAAW,gCAAkC,kBAAkB;AAAA,YAC/DW,EAAU,UAAUvsB,GAAeusB,CAAO,CAAC,GAAK,EAAE;AAAA;AAAA,6CAEjBgY,IAAW,MAAQ,WAAWA,CAAM,IAAM,EAAE,IAAI3Y,EAAW,WAAa,EAAE;AAAA;;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA,gBASvG8Y,CAAa;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA,gBAObC,CAAa;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA,QAOrBX,GAAY,OAAS,EAAI;AAAA;AAAA,uBAEVA,GAAY,MAAM;AAAA,YAC7BA,GAAY,IAAI1tE,GAAKsuE,GAAetuE,CAAC,CAAC,EAAE,KAAK,EAAE,CAAC;AAAA;AAAA,QAElD,EAAE;AAAA,MAGRuuE,EAAA,EACAC,EAAA,EACAC,EAAA,CACF,CAEA,SAASF,GAAqB,CAC5B,MAAMG,EAAWzjF,EAAQ,cAAc,YAAY,EAC7CwqE,EAAYxqE,EAAQ,cAAc,aAAa,EAEjD,CAACyjF,GAAY,CAACjZ,IAGlBpmD,EAAGq/D,EAAU,QAAS,IAAMjZ,EAAU,OAAO,EAG7CpmD,EAAGomD,EAAW,SAAU,IAAM,CACxBA,EAAU,QACZkZ,GAAS,MAAM,KAAKlZ,EAAU,KAAK,EAAGQ,CAAO,EAC7CkY,EAAA,EAEJ,CAAC,EAGD9+D,EAAGq/D,EAAU,WAAa1/E,GAAM,CAC9BA,EAAE,iBACFsgB,GAASo/D,EAAU,WAAW,CAChC,CAAC,EAEDr/D,EAAGq/D,EAAU,YAAa,IAAM,CAC9Bl/D,GAAYk/D,EAAU,WAAW,CACnC,CAAC,EAEDr/D,EAAGq/D,EAAU,OAAS1/E,GAAM,CAC1BA,EAAE,iBACFwgB,GAAYk/D,EAAU,WAAW,EAEjC,MAAME,EAAM5/E,EAAgB,aACxB4/E,GAAI,QACND,GAAS,MAAM,KAAKC,EAAG,KAAK,EAAG3Y,CAAO,EACtCkY,EAAA,EAEJ,CAAC,EACH,CAEA,SAASK,GAAsB,CAC7BvjF,EAAQ,iBAAiB,wBAAwB,EAAE,QAAQ8nB,GAAO,CAChE1D,EAAG0D,EAAoB,QAAS,IAAM,CACpC,MAAM87D,EAAS97D,EAAI,aAAa,cAAc,EAC1C87D,IACFnB,GAAcA,GAAY,OAAO1tE,GAAKA,EAAE,KAAO6uE,CAAM,EACrDV,EAAA,EAEJ,CAAC,CACH,CAAC,CACH,CAEA,eAAeW,GAA6B,CAC1C,GAAI,CACFlB,GAAc,MAAMjzB,GAAA,CACtB,MAAQ,CACNizB,GAAc,EAChB,CACF,CAEA,eAAemB,EAAqB/lF,EAAiC,CACnE,GAAI,CACF6kF,GAAc,MAAM9kF,GAAW,OAAWC,GAAY,MAAS,CACjE,MAAQ,CACN6kF,GAAc,EAChB,CACF,CAEA,SAASY,GAAgC,CACvC,MAAM3xB,EAAe7xD,EAAQ,cAAc,uBAAuB,EAC5D+jF,EAAe/jF,EAAQ,cAAc,uBAAuB,EAC9D6xD,GACFztC,EAAGytC,EAAc,SAAU,SAAY,CACrCgxB,GAAmBhxB,EAAa,OAAS,GACzCixB,GAAmB,GACnB,MAAMgB,EAAqBjB,EAAgB,EAC3CK,EAAA,CACF,CAAC,EAECa,GACF3/D,EAAG2/D,EAAc,SAAU,IAAM,CAC/BjB,GAAmBiB,EAAa,OAAS,EAC3C,CAAC,CAEL,CAEAb,EAAA,EACAW,IAAc,KAAK,IAAMX,GAAQ,EAGjC,MAAM/5D,EAASlF,EAAc,MAAO,CAAE,UAAW,eAAgB,EAE3DgG,EAAYhG,EAAc,SAAU,CACxC,UAAW,oBACX,YAAa,SACd,EAEK6mD,EAAY7mD,EAAc,SAAU,CACxC,UAAW,kBACX,YAAa,SACd,EAEDG,EAAG6F,EAAW,QAAS,IAAM,CAC3B,GAAIy4D,GAAa,CACfx0F,EAAM,QAAQ,oBAAoB,EAClC,MACF,CACAu3B,EAAW8E,EAAQ,CACrB,CAAC,EAEDnG,EAAG0mD,EAAW,QAAS,SAAY,CACjC,GAAI2X,GAAY,SAAW,EAAG,CAC5Bv0F,EAAM,QAAQ,mBAAmB,EACjC,MACF,CAEA,GAAI,CAAAw0F,GAEJ,CAAAA,GAAc,GACd5X,EAAU,SAAW,GACrBA,EAAU,YAAc,eAExB,GAAI,CACF,GAAImY,EAAU,CACZ,MAAMt/E,EAAQ8+E,GAAY,IAAI1tE,GAAKA,EAAE,IAAI,EACzC,MAAMkuE,EAASt/E,CAAK,EAGpB8+E,GAAY,QAAQ1tE,GAAK,CACvBA,EAAE,OAAS,YACXA,EAAE,SAAW,GACf,CAAC,CACH,MAEE,MAAMrR,GAAY++E,GAAaS,CAAM,EAGvCh1F,EAAM,QAAQ,iBAAiB,EAC/B0c,IAAa63E,EAAW,EACxBh9D,EAAW8E,EAAQ,CACrB,MAAgB,CACdr8B,EAAM,MAAM,eAAe,CAC7B,SACEw0F,GAAc,GACd5X,EAAU,SAAW,GACrBA,EAAU,YAAc,SACxBoY,EAAA,CACF,EACF,CAAC,EAED/5D,EAAO,YAAYc,CAAS,EAC5Bd,EAAO,YAAY2hD,CAAS,EAG5B,MAAM1hD,EAAQP,GAAY,CACxB,GAAI0B,GACJ,MAAO,eACP,QAAAvqB,EACA,KAAM,KACN,OAAAmpB,CAAA,CACD,EAED,SAAS,KAAK,YAAYC,CAAK,EAC/B7D,GAAUgF,EAAQ,CACpB,CAKA,SAASm5D,GAAS//E,EAAeqnE,EAAuB,CACtDrnE,EAAM,QAAQ3K,GAAQ,CACpB,GAAIA,EAAK,KAAOgyE,EAAS,CACvB98E,EAAM,MAAM,GAAG8K,EAAK,IAAI,mBAAmB,EAC3C,MACF,CAGIypF,GAAY,KAAK1tE,GAAKA,EAAE,KAAK,OAAS/b,EAAK,MAAQ+b,EAAE,KAAK,OAAS/b,EAAK,IAAI,GAIhFypF,GAAY,KAAK,CACf,GAAI,QAAQ,KAAK,KAAK,IAAI,KAAK,SAAS,SAAS,EAAE,EAAE,MAAM,CAAC,CAAC,GAC7D,KAAAzpF,EACA,SAAU,EACV,OAAQ,UACT,CACH,CAAC,CACH,CAKA,SAASqqF,GAAetxF,EAA0B,CAChD,MAAMixD,EAAOkoB,GAAYn5E,EAAK,KAAK,IAAI,EAGvC,MAAO;AAAA,8BAFaA,EAAK,MAGc,mBAAmBA,EAAK,EAAE;AAAA,gCACnCixD,CAAI;AAAA;AAAA,iCAEH53B,GAAWr5B,EAAK,KAAK,IAAI,CAAC;AAAA,iCAC1B0sD,GAAe1sD,EAAK,KAAK,IAAI,CAAC;AAAA,UACrDA,EAAK,SAAW,YAAc;AAAA;AAAA,4DAEoBA,EAAK,QAAQ;AAAA;AAAA,UAE7D,EAAE;AAAA,UACJA,EAAK,MAAQ,2BAA2Bq5B,GAAWr5B,EAAK,KAAK,CAAC,SAAW,EAAE;AAAA;AAAA;AAAA,UAG3EA,EAAK,SAAW,YAAc,IAAM,EAAE;AAAA,UACtCA,EAAK,SAAW,QAAU,IAAM,EAAE;AAAA,UAClCA,EAAK,SAAW,UAAY;AAAA,iFAC2CA,EAAK,EAAE;AAAA,UAC5E,EAAE;AAAA;AAAA;AAAA,GAId,CAKA,eAAe2R,GACbC,EACAqgF,EACe,CACf,UAAWhrF,KAAQ2K,EAAO,CACxB3K,EAAK,OAAS,YACdgrF,EAAA,EAEA,GAAI,CACF,MAAM/qF,EAAW,IAAI,SACrBA,EAAS,OAAO,OAAQD,EAAK,IAAI,EAC7B6pF,IAAkB5pF,EAAS,OAAO,WAAY4pF,EAAgB,EAC9DC,IAAkB7pF,EAAS,OAAO,WAAY6pF,EAAgB,EAElE,MAAMj/E,EAAM,IAAI,eAEhB,MAAM,IAAI,QAAc,CAAChT,EAASiT,IAAW,CAC3CD,EAAI,OAAO,iBAAiB,WAAaE,GAAM,CACzCA,EAAE,mBACJ/K,EAAK,SAAW,KAAK,MAAO+K,EAAE,OAASA,EAAE,MAAS,GAAG,EACrDigF,EAAA,EAEJ,CAAC,EAEDngF,EAAI,iBAAiB,OAAQ,IAAM,CAC7BA,EAAI,QAAU,KAAOA,EAAI,OAAS,KACpC7K,EAAK,OAAS,YACdA,EAAK,SAAW,IAChBnI,EAAA,IAEAmI,EAAK,OAAS,QACdA,EAAK,MAAQ,gBACb8K,EAAO,IAAI,MAAM,eAAe,CAAC,EAErC,CAAC,EAEDD,EAAI,iBAAiB,QAAS,IAAM,CAClC7K,EAAK,OAAS,QACdA,EAAK,MAAQ,gBACb8K,EAAO,IAAI,MAAM,eAAe,CAAC,CACnC,CAAC,EAEDD,EAAI,KAAK,OAAQ,aAAa,EAC9BA,EAAI,KAAK5K,CAAQ,CACnB,CAAC,CACH,MAAQ,CACND,EAAK,OAAS,OAChB,CAEAgrF,EAAA,CACF,CACF,CAKA,SAAS9Y,GAAYM,EAA0B,CAC7C,OAAIA,EAAS,WAAW,QAAQ,EAAU,MACtCA,EAAS,WAAW,QAAQ,EAAU,KACtCA,EAAS,WAAW,QAAQ,EAAU,KACtCA,EAAS,SAAS,KAAK,EAAU,KACjCA,EAAS,SAAS,MAAM,GAAKA,EAAS,SAAS,UAAU,EAAU,KACnEA,EAAS,SAAS,OAAO,GAAKA,EAAS,SAAS,OAAO,EAAU,KACjEA,EAAS,SAAS,cAAc,GAAKA,EAAS,SAAS,YAAY,EAAU,MAC7EA,EAAS,SAAS,KAAK,GAAKA,EAAS,SAAS,SAAS,EAAU,KACjEA,EAAS,SAAS,MAAM,EAAU,KAC/B,IACT,CAKA,SAASpgD,GAAWr7B,EAAsB,CACxC,MAAMi8B,EAAM,SAAS,cAAc,KAAK,EACxC,OAAAA,EAAI,YAAcj8B,EACXi8B,EAAI,SACb,4HC9YMzB,GAAW,kBAOV,SAAS05D,IAA2B,CAEzC,MAAM/4D,EAAW,SAAS,cAAc,mBAAmBX,EAAQ,IAAI,EACnEW,KAAmB,SAEvB,MAAMlrB,EAAUikB,EAAc,MAAO,CAAE,UAAW,0BAA2B,EAE7E,IAAI0D,EAAqB,OAEzB,SAASu7D,GAAe,CACtBljF,EAAQ,UAAY;AAAA;AAAA,iCAES2nB,IAAe,OAAS,SAAW,EAAE;AAAA,iCACrCA,IAAe,OAAS,SAAW,EAAE;AAAA,iCACrCA,IAAe,QAAU,SAAW,EAAE;AAAA,iCACtCA,IAAe,MAAQ,SAAW,EAAE;AAAA;AAAA;AAAA,UAG3Du8D,GAAiBv8D,CAAU,CAAC;AAAA;AAAA,MAKlC3nB,EAAQ,iBAAiB,UAAU,EAAE,QAAQ+kB,GAAO,CAClDX,EAAGW,EAAoB,QAAS,IAAM,CACpC4C,EAAa5C,EAAI,aAAa,UAAU,EACxCm+D,EAAA,CACF,CAAC,CACH,CAAC,EAGDiB,GAAYnkF,CAAO,CACrB,CAEAkjF,EAAA,EAGA,MAAM/5D,EAASlF,EAAc,MAAO,CAAE,UAAW,eAAgB,EAC3Dv1B,EAAWu1B,EAAc,SAAU,CACvC,UAAW,oBACX,YAAa,QACd,EACDG,EAAG11B,EAAU,QAAS,IAAM+2B,EAAW8E,EAAQ,CAAC,EAChDpB,EAAO,YAAYz6B,CAAQ,EAG3B,MAAM06B,EAAQP,GAAY,CACxB,GAAI0B,GACJ,MAAO,kBACP,QAAAvqB,EACA,KAAM,KACN,OAAAmpB,CAAA,CACD,EAED,SAAS,KAAK,YAAYC,CAAK,EAC/B7D,GAAUgF,EAAQ,CACpB,CAKA,SAAS25D,GAAiBn/D,EAAqB,CAC7C,OAAQA,EAAA,CACN,IAAK,OACH,OAAOq/D,GAAA,EACT,IAAK,OACH,OAAOC,GAAA,EACT,IAAK,QACH,OAAOC,GAAA,EACT,IAAK,MACH,OAAOC,GAAA,CAAa,CAE1B,CAKA,SAASH,IAAwB,CAC/B,MAAMI,EAAW3vF,EAAS,WACpB4vF,EAAY1sF,GAAU,WACtB2sF,EAAU9+D,GAAQ,WAExB,MAAO;AAAA;AAAA;AAAA,gCAGuB,KAAK,UAAU,CAC3C,UAAW4+D,EAAS,iBACpB,KAAMA,EAAS,aAAa,MAC5B,eAAgBA,EAAS,gBACxB,KAAM,CAAC,CAAC;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA,oCAMuBC,EAAU,UAAU,MAAM;AAAA,gCAC9BA,EAAU,MAAM,MAAM;AAAA,kCACpBA,EAAU,QAAQ,MAAM;AAAA,oCACtBA,EAAU,UAAU,MAAM;AAAA,mCAC3BA,EAAU,SAAS,MAAM;AAAA,wCACpBA,EAAU,YAAY,MAAM;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA,gCAMpC,KAAK,UAAU,CAC3C,WAAYC,EAAQ,WACpB,QAASA,EAAQ,eACjB,YAAaA,EAAQ,YACrB,UAAWA,EAAQ,WAClB,KAAM,CAAC,CAAC;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA,qCAMwB,UAAU,UAAU,MAAM,EAAG,EAAE,CAAC;AAAA,iCACpC,OAAO,UAAU,IAAI,OAAO,WAAW;AAAA,gCACxC,SAAS,gBAAgB,aAAa,YAAY,CAAC;AAAA;AAAA;AAAA,GAInF,CAKA,SAASL,IAAwB,CAC/B,MAAO;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA,oCAa2B,KAAK,MAAM,YAAY,KAAK,CAAC;AAAA,iCAChCM,IAAgB;AAAA;AAAA;AAAA,GAIjD,CAKA,SAASL,IAAyB,CAChC,MAAMh4D,EAAO,OAAO,KAAK,YAAY,EAC/Bs4D,EAAYt4D,EAAK,OAAO,CAACu4D,EAAKhzF,IAAQgzF,GAAO,aAAa,QAAQhzF,CAAG,GAAG,QAAU,GAAI,CAAC,EAE7F,MAAO;AAAA;AAAA;AAAA,kBAGSy6B,EAAK,MAAM,YAAYw4D,GAAYF,EAAY,CAAC,CAAC;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA,UAMzDt4D,EAAK,IAAIz6B,GAAO;AAAA;AAAA,wCAEcA,CAAG;AAAA,yCACFizF,IAAa,aAAa,QAAQjzF,CAAG,GAAG,QAAU,GAAK,CAAC,CAAC;AAAA,mFACfA,CAAG;AAAA;AAAA,SAE7E,EAAE,KAAK,EAAE,CAAC;AAAA;AAAA;AAAA,GAInB,CAKA,SAAS0yF,IAAuB,CAC9B,MAAO;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA,GA2BT,CAKA,SAASJ,GAAYp2F,EAA8B,CACjDA,EAAU,iBAAiB,eAAe,EAAE,QAAQU,GAAM,CACxD,MAAM4E,EAAS5E,EAAG,aAAa,aAAa,EAE5C21B,EAAG31B,EAAmB,QAAS,SAAY,CACzC,OAAQ4E,EAAA,CACN,IAAK,gBACH,QAAQ,QACRnF,EAAM,QAAQ,iBAAiB,EAC/B,MAEF,IAAK,YACH,QAAQ,MAAM,mBAAmB,EACjC,QAAQ,IAAI,OAAQ2G,EAAS,UAAU,EACvC,QAAQ,IAAI,QAASkD,GAAU,UAAU,EACzC,QAAQ,IAAI,MAAO6tB,GAAQ,UAAU,EACrC,QAAQ,WACR13B,EAAM,QAAQ,yBAAyB,EACvC,MAEF,IAAK,gBACH,aAAa,QACbA,EAAM,QAAQ,iBAAiB,EAC/B,SAAS,SACT,MAEF,IAAK,iBACH,MAAM8B,EAAO,CAAE,GAAG,cACZwS,EAAO,IAAI,KAAK,CAAC,KAAK,UAAUxS,EAAM,KAAM,CAAC,CAAC,EAAG,CAAE,KAAM,mBAAoB,EAC7ER,EAAM,IAAI,gBAAgBgT,CAAI,EAC9B1D,EAAI,SAAS,cAAc,GAAG,EACpCA,EAAE,KAAOtP,EACTsP,EAAE,SAAW,2BACbA,EAAE,QACF5Q,EAAM,QAAQ,kBAAkB,EAChC,MAEF,IAAK,aACH,MAAM2D,EAAMpD,EAAG,aAAa,UAAU,EAClCoD,IACF,aAAa,WAAWA,CAAG,EAC3B3D,EAAM,QAAQ,YAAY2D,CAAG,EAAE,EAC/BoyF,GAAA,GAEF,MAEF,IAAK,WACH,MAAMc,GAAQh3F,CAAS,EACvB,MAEN,CAAC,CACH,CAAC,CACH,CAKA,eAAeg3F,GAAQh3F,EAAuC,CAC5D,MAAMi3F,EAAUj3F,EAAU,cAAc,aAAa,EAAwB,MACvEohF,EAAYphF,EAAU,cAAc,eAAe,EAAuB,MAC1Ek3F,EAAYl3F,EAAU,cAAc,WAAW,EAA0B,MACzEm3F,EAAan3F,EAAU,cAAc,eAAe,EAE1Dm3F,EAAW,YAAc,aAEzB,GAAI,CACF,MAAM72F,EAAuB,CAAE,OAAA22F,CAAA,EAC3BC,GAAYD,IAAW,QACzB32F,EAAQ,KAAO42F,EACf52F,EAAQ,QAAU,CAAE,eAAgB,qBAGtC,MAAM8+B,EAAQ,YAAY,MACpBt9B,EAAW,MAAMyB,GAAiB69E,EAAU9gF,CAAO,EACnD82F,EAAU,KAAK,MAAM,YAAY,MAAQh4D,CAAK,EAC9Cn9B,EAAO,MAAMH,EAAS,OAAO,MAAM,IAAMA,EAAS,MAAM,EAE9Dq1F,EAAW,YAAc,WAAWr1F,EAAS,MAAM,KAAKs1F,CAAO;;AAAA,EAAU,KAAK,UAAUn1F,EAAM,KAAM,CAAC,CAAC,EACxG,OAASQ,EAAO,CACd00F,EAAW,YAAc,UAAU10F,aAAiB,MAAQA,EAAM,QAAU,eAAe,EAC7F,CACF,CAKA,SAASm0F,IAAyB,CAChC,MAAMS,EAAO,YACb,OAAIA,EAAK,OACAN,GAAYM,EAAK,OAAO,cAAc,EAExC,KACT,CAKA,SAASN,GAAYpmC,EAAuB,CAC1C,GAAIA,IAAU,EAAG,MAAO,MACxB,MAAMhtD,EAAI,KACJ2zF,EAAQ,CAAC,IAAK,KAAM,KAAM,IAAI,EAC9B9sF,EAAI,KAAK,MAAM,KAAK,IAAImmD,CAAK,EAAI,KAAK,IAAIhtD,CAAC,CAAC,EAClD,OAAO,YAAYgtD,EAAQ,KAAK,IAAIhtD,EAAG6G,CAAC,GAAG,QAAQ,CAAC,CAAC,EAAI,IAAM8sF,EAAM9sF,CAAC,CACxE,CCvUA,MAAMgyB,GAAW,kBAUX+6D,GAAkC,CACtC,CACE,MAAO,UACP,UAAW,CACT,CAAE,KAAM,CAAC,OAAQ,GAAG,EAAG,YAAa,oBACpC,CAAE,KAAM,CAAC,OAAQ,QAAS,GAAG,EAAG,YAAa,QAC7C,CAAE,KAAM,CAAC,OAAQ,GAAG,EAAG,YAAa,qBACpC,CAAE,KAAM,CAAC,KAAK,EAAG,YAAa,wBAC9B,CAAE,KAAM,CAAC,GAAG,EAAG,YAAa,iBAAiB,CAC/C,EAEF,CACE,MAAO,aACP,UAAW,CACT,CAAE,KAAM,CAAC,OAAQ,GAAG,EAAG,YAAa,mBACpC,CAAE,KAAM,CAAC,OAAQ,GAAG,EAAG,YAAa,cACpC,CAAE,KAAM,CAAC,OAAQ,GAAG,EAAG,YAAa,yBACpC,CAAE,KAAM,CAAC,OAAQ,GAAG,EAAG,YAAa,kBACpC,CAAE,KAAM,CAAC,OAAQ,GAAG,EAAG,YAAa,iBAAiB,CACvD,EAEF,CACE,MAAO,UACP,UAAW,CACT,CAAE,KAAM,CAAC,OAAQ,GAAG,EAAG,YAAa,gBACpC,CAAE,KAAM,CAAC,OAAQ,GAAG,EAAG,YAAa,YACpC,CAAE,KAAM,CAAC,OAAQ,GAAG,EAAG,YAAa,eACpC,CAAE,KAAM,CAAC,OAAQ,QAAS,GAAG,EAAG,YAAa,eAAe,CAC9D,EAEF,CACE,MAAO,OACP,UAAW,CACT,CAAE,KAAM,CAAC,OAAO,EAAG,YAAa,gBAChC,CAAE,KAAM,CAAC,QAAS,OAAO,EAAG,YAAa,YACzC,CAAE,KAAM,CAAC,GAAG,EAAG,YAAa,mBAAmB,CACjD,CAEJ,EAKO,SAASC,IAA2B,CAEzC,MAAMr6D,EAAW,SAAS,cAAc,mBAAmBX,EAAQ,IAAI,EACnEW,KAAmB,SAEvB,MAAMlrB,EAAUikB,EAAc,MAAO,CAAE,UAAW,0BAA2B,EAGvEuhE,EAAsBtyF,GAAU,SAEtC8M,EAAQ,UAAY;AAAA;AAAA,QAEdslF,GAAe,IAAIpD,GAAS;AAAA;AAAA,gBAEpBA,EAAM,KAAK;AAAA;AAAA,cAEbA,EAAM,UAAU,IAAI/uF,GAAK;AAAA;AAAA;AAAA,oBAGnBA,EAAE,KAAK,IAAIzB,GAAK,QAAQA,CAAC,QAAQ,EAAE,KAAK,KAAK,CAAC;AAAA;AAAA,6CAErByB,EAAE,WAAW;AAAA;AAAA,aAE7C,EAAE,KAAK,EAAE,CAAC;AAAA;AAAA;AAAA,OAGhB,EAAE,KAAK,EAAE,CAAC;AAAA;AAAA;AAAA,MAGXqyF,EAAoB,OAAS,EAAI;AAAA;AAAA;AAAA;AAAA,YAI3BA,EAAoB,IAAIryF,GAAK,CACrC,MAAMm5B,EAAiB,GACvB,OAAIn5B,EAAE,MAAMm5B,EAAK,KAAK,MAAM,EACxBn5B,EAAE,OAAOm5B,EAAK,KAAK,OAAO,EAC1Bn5B,EAAE,KAAKm5B,EAAK,KAAK,KAAK,EACtBn5B,EAAE,MAAMm5B,EAAK,KAAK,KAAK,EAC3BA,EAAK,KAAKn5B,EAAE,IAAI,aAAa,EAEtB;AAAA;AAAA;AAAA,oBAGSm5B,EAAK,IAAI56B,GAAK,QAAQA,CAAC,QAAQ,EAAE,KAAK,KAAK,CAAC;AAAA;AAAA,6CAEnByB,EAAE,WAAW;AAAA;AAAA,aAGxD,CAAC,EAAE,KAAK,EAAE,CAAC;AAAA;AAAA;AAAA,MAGL,EAAE;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA,IAUR,MAAMg2B,EAASlF,EAAc,MAAO,CAAE,UAAW,eAAgB,EAE3Dv1B,EAAWu1B,EAAc,SAAU,CACvC,UAAW,kBACX,YAAa,SACd,EAEDG,EAAG11B,EAAU,QAAS,IAAM+2B,EAAW8E,EAAQ,CAAC,EAChDpB,EAAO,YAAYz6B,CAAQ,EAG3B,MAAM06B,EAAQP,GAAY,CACxB,GAAI0B,GACJ,MAAO,qBACP,QAAAvqB,EACA,KAAM,KACN,OAAAmpB,CAAA,CACD,EAED,SAAS,KAAK,YAAYC,CAAK,EAC/B7D,GAAUgF,EAAQ,CACpB,CCtIA,MAAMA,GAAW,sBAqBjB,IAAIk7D,GAAgC,GAChC16B,GAA2B,MAK/B,eAAsB26B,GAAuB5/D,EAAiC,GAAmB,CAC/FilC,GAAS,MAGT,MAAM7/B,EAAW,SAAS,cAAc,mBAAmBX,EAAQ,IAAI,EACnEW,KAAmB,SAEvB,MAAMlrB,EAAUikB,EAAc,MAAO,CAAE,UAAW,8BAA+B,EACjFjkB,EAAQ,UAAY,sDAGpB,MAAMmpB,EAASlF,EAAc,MAAO,CAAE,UAAW,eAAgB,EAE3D0hE,EAAa1hE,EAAc,SAAU,CACzC,UAAW,oBACX,YAAa,gBACd,EAEKv1B,EAAWu1B,EAAc,SAAU,CACvC,UAAW,kBACX,YAAa,QACd,EAEDG,EAAGuhE,EAAY,QAAS,SAAY,CAClC,GAAI,CACF,MAAM30F,EAAK,KAAK,kCAAkC,EAClDy0F,GAAc,QAAQ5+D,GAAKA,EAAE,KAAO,EAAI,EACxCq8D,EAAA,EACAh1F,EAAM,QAAQ,oBAAoB,EAClC43B,EAAM,iBACR,MAAQ,CAER,CACF,CAAC,EAED1B,EAAG11B,EAAU,QAAS,IAAM+2B,EAAW8E,EAAQ,CAAC,EAEhDpB,EAAO,YAAYw8D,CAAU,EAC7Bx8D,EAAO,YAAYz6B,CAAQ,EAG3B,MAAM06B,EAAQP,GAAY,CACxB,GAAI0B,GACJ,MAAO,gBACP,QAAAvqB,EACA,KAAM,KACN,OAAAmpB,CAAA,CACD,EAED,SAAS,KAAK,YAAYC,CAAK,EAC/B7D,GAAUgF,EAAQ,EAGlB,GAAI,CAEFk7D,IADiB,MAAMz0F,EAAK,IAAoB,oBAAoB,GAC3C,KACzBkyF,EAAA,CACF,MAAQ,CACNljF,EAAQ,UAAY,uDACtB,CAEA,SAASkjF,GAAe,CACtB,MAAMl4B,EAAWD,KAAW,SACxB06B,GAAc,OAAO5+D,GAAK,CAACA,EAAE,IAAI,EACjC4+D,GAEEG,EAAcH,GAAc,UAAY,CAAC5+D,EAAE,IAAI,EAAE,OAEvD7mB,EAAQ,UAAY;AAAA;AAAA;AAAA,sCAGc+qD,KAAW,MAAQ,SAAW,EAAE;AAAA,mBACnD06B,GAAc,MAAM;AAAA;AAAA,sCAED16B,KAAW,SAAW,SAAW,EAAE;AAAA,sBACnD66B,CAAW;AAAA;AAAA;AAAA;AAAA;AAAA,QAKzB56B,EAAS,SAAW,EAAI;AAAA;AAAA;AAAA,eAGjBD,KAAW,SAAW,0BAA4B,sBAAsB;AAAA;AAAA,QAE7E;AAAA;AAAA,YAEEC,EAAS,IAAInkC,GAAKg/D,GAAmBh/D,CAAC,CAAC,EAAE,KAAK,EAAE,CAAC;AAAA;AAAA,OAEtD;AAAA,MAIH7mB,EAAQ,iBAAiB,aAAa,EAAE,QAAQ+kB,GAAO,CACrDX,EAAGW,EAAoB,QAAS,IAAM,CACpCgmC,GAAShmC,EAAI,aAAa,aAAa,EACvCm+D,EAAA,CACF,CAAC,CACH,CAAC,EAGDljF,EAAQ,iBAAiB,oBAAoB,EAAE,QAAQjO,GAAQ,CAC7D,MAAMV,EAAKU,EAAK,aAAa,sBAAsB,EAC7C+zF,EAAeL,GAAc,KAAK5+D,GAAKA,EAAE,KAAOx1B,CAAE,EAEpDy0F,GACF1hE,EAAGryB,EAAqB,QAAS,SAAY,CAE3C,GAAI,CAAC+zF,EAAa,KAChB,GAAI,CACF,MAAM90F,EAAK,MAAM,sBAAsBK,CAAE,OAAO,EAChDy0F,EAAa,KAAO,GACpBvhE,GAAYxyB,EAAqB,QAAQ,CAC3C,MAAQ,CAER,CAGF+zB,EAAM,sBAAsBggE,CAAY,EAGpCA,EAAa,MACfrgE,EAAW8E,EAAQ,CAGvB,CAAC,CAEL,CAAC,CACH,CACF,CAKA,SAASs7D,GAAmBC,EAAoC,CAC9D,MAAM9iC,EAAO+iC,GAAoBD,EAAa,IAAI,EAElD,MAAO;AAAA,oCAC2BA,EAAa,KAAO,GAAK,QAAQ;AAAA,iCACpCA,EAAa,EAAE;AAAA,sCACVA,EAAa,IAAI,KAAK9iC,CAAI;AAAA;AAAA,0CAEtB53B,GAAW06D,EAAa,KAAK,CAAC;AAAA,4CAC5B16D,GAAW06D,EAAa,OAAO,CAAC;AAAA;AAAA,YAEhEA,EAAa,MAAQ,oCAAoC16D,GAAW06D,EAAa,MAAM,IAAI,CAAC,aAAe,EAAE;AAAA,4CAC7EpoC,GAAmBooC,EAAa,SAAS,CAAC;AAAA;AAAA;AAAA,QAG7EA,EAAa,KAAgD,GAAzC,sCAA2C;AAAA;AAAA,GAGxE,CAKA,SAASC,GAAoB33F,EAAoC,CAC/D,OAAQA,EAAA,CACN,IAAK,OAAQ,MAAO,KACpB,IAAK,UAAW,MAAO,IACvB,IAAK,UAAW,MAAO,KACvB,IAAK,QAAS,MAAO,IACrB,IAAK,UAAW,MAAO,KACvB,IAAK,SAAU,MAAO,KACtB,QAAS,MAAO,KAEpB,CAKA,SAASg9B,GAAWr7B,EAAsB,CACxC,MAAMi8B,EAAM,SAAS,cAAc,KAAK,EACxC,OAAAA,EAAI,YAAcj8B,EACXi8B,EAAI,SACb,CC3MA,MAAMzB,GAAW,cAyBV,SAASy7D,GAAelgE,EAA8B,CAC3D,KAAM,CAAE,KAAAt4B,EAAM,MAAAkI,EAAO,OAAAuwF,CAAA,EAAWngE,EAG1BoF,EAAW,SAAS,cAAc,mBAAmBX,EAAQ,IAAI,EACnEW,KAAmB,SAEvB,MAAMlrB,EAAUikB,EAAc,MAAO,CAAE,UAAW,sBAAuB,EAEzE,GAAIz2B,IAAS,QAAUkI,EACrBsK,EAAQ,UAAY;AAAA;AAAA;AAAA,uCAGeorB,GAAW11B,EAAM,OAAO,CAAC;AAAA;AAAA;AAAA,wBAGxC01B,GAAW11B,EAAM,KAAK,IAAI,CAAC;AAAA,6CACN01B,GAAW11B,EAAM,KAAK,KAAK,CAAC;AAAA;AAAA;AAAA,oBAGrDA,EAAM,GAAG,IAAI+H,GAAK2tB,GAAW3tB,EAAE,MAAQA,EAAE,KAAK,CAAC,EAAE,KAAK,IAAI,CAAC;AAAA;AAAA,cAEjE/H,EAAM,IAAI,OAAS;AAAA;AAAA,sBAEXA,EAAM,GAAG,IAAI+H,GAAK2tB,GAAW3tB,EAAE,MAAQA,EAAE,KAAK,CAAC,EAAE,KAAK,IAAI,CAAC;AAAA;AAAA,cAEjE,EAAE;AAAA,sCACoBigD,GAAmBhoD,EAAM,IAAI,CAAC;AAAA;AAAA;AAAA;AAAA;AAAA,YAKxDA,EAAM,UAAY01B,GAAW11B,EAAM,IAAI,EAAE,QAAQ,MAAO,MAAM,CAAC;AAAA;AAAA;AAAA,UAGjEA,EAAM,aAAa,OAAS;AAAA;AAAA,+BAEPA,EAAM,YAAY,MAAM;AAAA;AAAA,gBAEvCA,EAAM,YAAY,IAAIoJ,GAAK;AAAA;AAAA;AAAA,kDAGOssB,GAAWtsB,EAAE,IAAI,CAAC;AAAA,kDAClBgmF,GAAYhmF,EAAE,IAAI,CAAC;AAAA;AAAA,eAEtD,EAAE,KAAK,EAAE,CAAC;AAAA;AAAA;AAAA,UAGb,EAAE;AAAA;AAAA,UAEJpJ,EAAM,QAAQ,OAAS;AAAA;AAAA,0BAEPA,EAAM,OAAO,MAAM;AAAA,cAC/BA,EAAM,OAAO,IAAImmC,GAAK;AAAA;AAAA;AAAA,4BAGRzQ,GAAWyQ,EAAE,KAAK,IAAI,CAAC;AAAA,0BACzB6hB,GAAmB7hB,EAAE,IAAI,CAAC;AAAA;AAAA,8CAENzQ,GAAWyQ,EAAE,KAAK,MAAM,EAAG,GAAG,CAAC,CAAC;AAAA;AAAA,aAEjE,EAAE,KAAK,EAAE,CAAC;AAAA;AAAA,UAEX,EAAE;AAAA;AAAA,UAGL,CAEL,MAAMqqD,EAAU14F,IAAS,SAAWkI,EAC9BywF,EAAUD,EAAUxwF,EAAM,KAAK,MAAQ,GACvC0wF,EAAeF,EAAU,OAAOxwF,EAAM,OAAO,GAAK,GAExDsK,EAAQ,UAAY;AAAA;AAAA;AAAA;AAAA;AAAA,0BAKEmmF,CAAO;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA,0BAaP/6D,GAAWg7D,CAAY,CAAC;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA,0DAOQF,EAAU;;AAAA;AAAA,KAAexwF,EAAM,IAAI,KAAKA,EAAM,KAAK,IAAI;AAAA,EAAYA,EAAM,IAAI,GAAK,EAAE;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA,MAe1I,WAAW,IAAM,CACf,MAAM2wF,EAAOrmF,EAAQ,cAAc,kBAAkB,EAC/CzO,EAAQyO,EAAQ,cAAc,mBAAmB,EAEnDqmF,GAAQ90F,IACV6yB,EAAGiiE,EAAM,QAAS,IAAM90F,EAAM,OAAO,EACrC6yB,EAAG7yB,EAAO,SAAU,IAAM,CAExB,GAAIA,EAAM,MAAO,CACf,MAAM+0F,EAAUtmF,EAAQ,cAAc,sBAAsB,EAC5DsmF,EAAQ,UAAY,MAAM,KAAK/0F,EAAM,KAAK,EACvC,IAAIwjB,GAAK,gCAAgCqW,GAAWrW,EAAE,IAAI,CAAC,QAAQ,EACnE,KAAK,EAAE,CACZ,CACF,CAAC,EAEL,EAAG,CAAC,CACN,CAGA,MAAMoU,EAASlF,EAAc,MAAO,CAAE,UAAW,eAAgB,EAEjE,GAAIz2B,IAAS,OAAQ,CACnB,MAAM+4F,EAAWtiE,EAAc,SAAU,CACvC,UAAW,kBACX,YAAa,QACd,EAEKuiE,EAAaviE,EAAc,SAAU,CACzC,UAAW,oBACX,YAAa,UACd,EAEKv1B,EAAWu1B,EAAc,SAAU,CACvC,UAAW,oBACX,YAAa,QACd,EAEDG,EAAGmiE,EAAU,QAAS,IAAM,CAC1B9gE,EAAW8E,EAAQ,EACnBy7D,GAAe,CAAE,GAAGlgE,EAAO,KAAM,QAAS,CAC5C,CAAC,EAED1B,EAAGoiE,EAAY,QAAS,IAAM,CAE5Bt4F,EAAM,KAAK,yBAAyB,CACtC,CAAC,EAEDk2B,EAAG11B,EAAU,QAAS,IAAM+2B,EAAW8E,EAAQ,CAAC,EAEhDpB,EAAO,YAAYz6B,CAAQ,EAC3By6B,EAAO,YAAYq9D,CAAU,EAC7Br9D,EAAO,YAAYo9D,CAAQ,CAC7B,KAAO,CACL,MAAMt8D,EAAYhG,EAAc,SAAU,CACxC,UAAW,oBACX,YAAa,SACd,EAEKu8D,EAAUv8D,EAAc,SAAU,CACtC,UAAW,kBACX,YAAa,OACd,EAEDG,EAAG6F,EAAW,QAAS,IAAMxE,EAAW8E,EAAQ,CAAC,EAEjDnG,EAAGo8D,EAAS,QAAS,SAAY,CAC/B,MAAMn8C,EAAOrkC,EAAQ,cAAc,aAAa,EAChD,GAAI,CAACqkC,EAAK,gBAAiB,CACzBA,EAAK,iBACL,MACF,CAEA,MAAMoiD,EAAMzmF,EAAQ,cAAc,WAAW,EAAuB,MAC9D0mF,EAAM1mF,EAAQ,cAAc,WAAW,EAAuB,MAC9D2mF,EAAW3mF,EAAQ,cAAc,gBAAgB,EAAuB,MACxE/O,EAAQ+O,EAAQ,cAAc,aAAa,EAA0B,MAErE4mF,EAA4B,CAChC,GAAIH,EAAG,MAAM,GAAG,EAAE,IAAI1iF,IAAM,CAAE,KAAM,GAAI,MAAOA,EAAE,QAAS,EAC1D,GAAI2iF,EAAKA,EAAG,MAAM,GAAG,EAAE,IAAI3iF,IAAM,CAAE,KAAM,GAAI,MAAOA,EAAE,MAAK,EAAI,EAAI,OACnE,QAAA4iF,EACA,KAAA11F,CAAA,EAGFuvF,EAAQ,SAAW,GACnBA,EAAQ,YAAc,aAEtB,GAAI,CACEyF,EACF,MAAMA,EAAOW,CAAS,EAEtB,MAAM51F,EAAK,KAAK,mBAAoB41F,CAAS,EAE/C14F,EAAM,QAAQ,YAAY,EAC1Bu3B,EAAW8E,EAAQ,CACrB,MAAQ,CAER,SACEi2D,EAAQ,SAAW,GACnBA,EAAQ,YAAc,MACxB,CACF,CAAC,EAEDr3D,EAAO,YAAYc,CAAS,EAC5Bd,EAAO,YAAYq3D,CAAO,CAC5B,CAGA,MAAMp3D,EAAQP,GAAY,CACxB,GAAI0B,GACJ,MAAO/8B,IAAS,OAAS,QAAWA,IAAS,QAAU,QAAU,gBACjE,QAAAwS,EACA,KAAM,KACN,OAAAmpB,CAAA,CACD,EAED,SAAS,KAAK,YAAYC,CAAK,EAC/B7D,GAAUgF,EAAQ,CACpB,CAKA,SAASu6D,GAAYpmC,EAAuB,CAC1C,GAAIA,IAAU,EAAG,MAAO,MACxB,MAAMhtD,EAAI,KACJ2zF,EAAQ,CAAC,IAAK,KAAM,IAAI,EACxB9sF,EAAI,KAAK,MAAM,KAAK,IAAImmD,CAAK,EAAI,KAAK,IAAIhtD,CAAC,CAAC,EAClD,OAAO,YAAYgtD,EAAQ,KAAK,IAAIhtD,EAAG6G,CAAC,GAAG,QAAQ,CAAC,CAAC,EAAI,IAAM8sF,EAAM9sF,CAAC,CACxE,CAKA,SAAS6yB,GAAWr7B,EAAsB,CACxC,MAAMi8B,EAAM,SAAS,cAAc,KAAK,EACxC,OAAAA,EAAI,YAAcj8B,EACXi8B,EAAI,SACb,CCnQA,MAAMx4B,GAAqB,CACzB,WAAY,IACZ,aAAc,IACd,YAAa,IACf,EAGMC,OAAiC,IAKvC,SAASC,IAAe,CACtBD,GAAU,QAAQlG,GAAMA,EAAA,CAAI,CAC9B,CAKO,SAASs5F,GAAcx1F,EAAYy1F,EAAc/4F,EAAmBK,EAAmC,CAC5GoF,GAAM,OAAO,IAAInC,EAAI,CAAE,GAAAA,EAAI,MAAAy1F,EAAO,UAAA/4F,EAAW,KAAAK,EAAM,EACnDsF,GAAA,CACF,CAKO,SAASqzF,GAAS11F,EAA0B,CACjD,OAAOmC,GAAM,OAAO,IAAInC,CAAE,GAAG,OAAS,IACxC,CAKO,SAAS21F,GAAa31F,EAAkB,CAC7C,MAAMq/E,EAAWl9E,GAAM,OAAO,IAAInC,CAAE,EAChCq/E,GAAU,OACZA,EAAS,MAAM,UAEjBl9E,GAAM,OAAO,OAAOnC,CAAE,EACtBqC,GAAA,CACF,CAKO,SAASuzF,GAAgB51F,EAAYrB,EAAqB,CAC/D,MAAM0gF,EAAWl9E,GAAM,OAAO,IAAInC,CAAE,EAChCq/E,GAAU,QACZA,EAAS,MAAM,KAAO1gF,EACtB0gF,EAAS,MAAM,SAEnB,CAKO,SAASwW,GAAgB71F,EAAY06E,EAAkBh+E,EAAyB,CACrFyF,GAAM,SAAS,IAAInC,EAAI,CAAE,GAAAA,EAAI,QAAA06E,EAAS,UAAAh+E,EAAW,EACjD2F,GAAA,CACF,CAKO,SAASyzF,GAAW91F,EAA4B,CACrD,OAAOmC,GAAM,SAAS,IAAInC,CAAE,GAAG,SAAW,IAC5C,CAKO,SAAS+1F,GAAe/1F,EAAkB,CAC/C,MAAMq/E,EAAWl9E,GAAM,SAAS,IAAInC,CAAE,EAClCq/E,GAAU,SAAW,OAAQA,EAAS,QAAqC,SAAY,YACxFA,EAAS,QAAoC,UAEhDl9E,GAAM,SAAS,OAAOnC,CAAE,EACxBqC,GAAA,CACF,CAKO,SAAS2zF,GAAeh2F,EAAyB,CACtDmC,GAAM,YAAcnC,EACpBqC,GAAA,CACF,CAKO,SAAS4zF,IAAwB,CACtC,OAAO,MAAM,KAAK9zF,GAAM,OAAO,MAAM,CACvC,CAKO,SAAS+zF,IAA0B,CACxC,OAAO,MAAM,KAAK/zF,GAAM,SAAS,MAAM,CACzC,CAKO,SAASg0F,IAAmB,CACjCh0F,GAAM,OAAO,QAASk9E,GAAa,CAC7BA,EAAS,OACXA,EAAS,MAAM,SAEnB,CAAC,EACDl9E,GAAM,SAAS,QAASk9E,GAAa,CAC/BA,EAAS,SAAW,OAAQA,EAAS,QAAqC,SAAY,YACvFA,EAAS,QAAoC,SAElD,CAAC,EACDl9E,GAAM,OAAO,QACbA,GAAM,SAAS,QACfA,GAAM,YAAc,KACpBE,GAAA,CACF,CAKO,SAASE,GAAUhG,EAAkC,CAC1D6F,UAAU,IAAI7F,CAAQ,EACf,IAAM6F,GAAU,OAAO7F,CAAQ,CACxC,CAGO,MAAM65F,GAAc,CACzB,cAAAZ,GACA,SAAAE,GACA,aAAAC,GACA,gBAAAC,GACA,gBAAAC,GACA,WAAAC,GACA,eAAAC,GACA,eAAAC,GACA,YAAAC,GACA,cAAAC,GACA,WAAAC,GAAA,UACA5zF,EACF,ECpKM22B,GAAW,cA+BV,SAASm9D,GAAe5hE,EAA8B,CAC3D,KAAM,CAAE,MAAAgD,EAAQ,aAAc,MAAAhhB,EAAO,MAAAC,EAAO,YAAA4/E,EAAa,YAAAC,GAAgB9hE,EAGnEoF,EAAW,SAAS,cAAc,mBAAmBX,EAAQ,IAAI,EACnEW,KAAmB,SAEvB,MAAMlrB,EAAUikB,EAAc,MAAO,CAAE,UAAW,sBAAuB,EAEzEjkB,EAAQ,UAAY;AAAA;AAAA;AAAA,uBAGC8H,EAAM,MAAM;AAAA,uBACZC,EAAM,MAAM;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA,QAgB3B8/E,GAAe//E,CAAK,EAAE,IAAI1Z,GAAQ;AAAA;AAAA,8DAEoB05F,GAAa15F,CAAI,CAAC;AAAA,YACpEA,CAAI;AAAA;AAAA,OAET,EAAE,KAAK,EAAE,CAAC;AAAA;AAAA,IAKf,MAAM+6B,EAASlF,EAAc,MAAO,CAAE,UAAW,eAAgB,EAE3Dk+D,EAAYl+D,EAAc,SAAU,CACxC,UAAW,oBACX,YAAa,eACd,EAEKv1B,EAAWu1B,EAAc,SAAU,CACvC,UAAW,kBACX,YAAa,QACd,EAEDG,EAAG+9D,EAAW,QAAS,IAAM,CAE3B,MAAMzsB,EAAS11D,EAAQ,cAAc,QAAQ,EAC7C,GAAI01D,EAAQ,CACV,MAAMhU,EAAO,SAAS,cAAc,GAAG,EACvCA,EAAK,SAAW,YAChBA,EAAK,KAAOgU,EAAO,YACnBhU,EAAK,OACP,MACExzD,EAAM,QAAQ,oBAAoB,CAEtC,CAAC,EAEDk2B,EAAG11B,EAAU,QAAS,IAAM,CAE1B+4F,GAAY,eAAe,aAAa,EACxChiE,EAAW8E,EAAQ,CACrB,CAAC,EAEDpB,EAAO,YAAYg5D,CAAS,EAC5Bh5D,EAAO,YAAYz6B,CAAQ,EAG3B,MAAM06B,EAAQP,GAAY,CACxB,GAAI0B,GACJ,MAAAzB,EACA,QAAA9oB,EACA,KAAM,KACN,OAAAmpB,CAAA,CACD,EAED,SAAS,KAAK,YAAYC,CAAK,EAC/B7D,GAAUgF,EAAQ,EAGlB,WAAW,IAAM,CACfw9D,GAAgB/nF,EAAS8H,EAAOC,EAAO4/E,EAAaC,CAAW,EAC/DI,GAAahoF,CAAO,CACtB,EAAG,GAAG,CACR,CAKA,SAAS+nF,GACPh6F,EACA+Z,EACAC,EACA4/E,EACAC,EACM,CACN,MAAMhc,EAAiB79E,EAAU,cAAc,kBAAkB,EAGjE,GAAI,OAAQ,OAAwC,IAAQ,IAAa,CACvE69E,EAAe,UAAY;AAAA;AAAA;AAAA;AAAA,2BAIJ9jE,EAAM,MAAM;AAAA,gBACvBA,EAAM,MAAM,EAAG,EAAE,EAAE,OAAS,OAAO+e,EAAE,KAAK,KAAKA,EAAE,MAAQ,SAAS,QAAQ,EAAE,KAAK,EAAE,CAAC;AAAA,YACxF/e,EAAM,OAAS,GAAK,gCAAgCA,EAAM,OAAS,EAAE,YAAc,EAAE;AAAA;AAAA;AAAA,2BAGtEC,EAAM,MAAM;AAAA,gBACvBA,EAAM,MAAM,EAAG,EAAE,EAAE,IAAIhE,GAAK,OAAOA,EAAE,IAAI,MAAMA,EAAE,EAAE,GAAGA,EAAE,MAAQ,KAAKA,EAAE,KAAK,IAAM,EAAE,OAAO,EAAE,KAAK,EAAE,CAAC;AAAA,YACzGgE,EAAM,OAAS,GAAK,gCAAgCA,EAAM,OAAS,EAAE,YAAc,EAAE;AAAA;AAAA;AAAA;AAAA,MAK7F,MACF,CAEA,MAAMkgF,EAAO,OAA4D,IAGnE/b,EAAW,IAAI+b,EAAI,QACvBngF,EAAM,IAAI+e,IAAM,CACd,GAAIA,EAAE,GACN,MAAOA,EAAE,MACT,MAAOA,EAAE,OAASihE,GAAajhE,EAAE,IAAI,EACrC,KAAMA,EAAE,MAAQ,IAChB,GAGEulD,EAAW,IAAI6b,EAAI,QACvBlgF,EAAM,IAAIhE,IAAM,CACd,GAAIA,EAAE,GACN,KAAMA,EAAE,KACR,GAAIA,EAAE,GACN,MAAOA,EAAE,MACT,MAAOA,EAAE,OACT,GAGE1V,EAAU,CACd,MAAO,CACL,MAAO,MACP,KAAM,CAAE,MAAO,UAAW,KAAM,IAChC,YAAa,GAEf,MAAO,CACL,OAAQ,KACR,MAAO,CAAE,MAAO,UAAW,UAAW,WACtC,KAAM,CAAE,MAAO,UAAW,KAAM,GAAG,EAErC,QAAS,CACP,QAAS,GACT,cAAe,CAAE,WAAY,IAAI,EAEnC,YAAa,CACX,MAAO,GACP,aAAc,IAChB,EAGFu9E,EAAe,UAAY,GAC3B,MAAMG,EAAU,IAAIkc,EAAI,QAAQrc,EAAgB,CAAE,MAAOM,EAAU,MAAOE,CAAA,EAAY/9E,CAAO,EAG7Fo5F,GAAY,gBAAgB,cAAe1b,EAAS,kBAAkB,EAGlE4b,GACF5b,EAAQ,GAAG,QAAU/wE,GAAgC,CACnD,GAAIA,EAAO,MAAM,OAAS,EAAG,CAC3B,MAAMumB,EAAOzZ,EAAM,KAAK+e,GAAKA,EAAE,KAAO7rB,EAAO,MAAM,CAAC,CAAC,EACjDumB,KAAkBA,CAAI,CAC5B,CACF,CAAC,EAGCqmE,GACF7b,EAAQ,GAAG,QAAU/wE,GAAgC,CACnD,GAAIA,EAAO,MAAM,OAAS,EAAG,CAC3B,MAAMktF,EAAOngF,EAAM,KAAKhE,GAAKA,EAAE,KAAO/I,EAAO,MAAM,CAAC,CAAC,EACjDktF,KAAkBA,CAAI,CAC5B,CACF,CAAC,CAEL,CAKA,SAASF,GAAaj6F,EAA8B,CAClD,MAAMg+E,EAAU0b,GAAY,WAAW,aAAa,EAK/C1b,GAELh+E,EAAU,iBAAiB,eAAe,EAAE,QAAQ+5B,GAAO,CACzD1D,EAAG0D,EAAoB,QAAS,IAAM,CAGpC,OAFeA,EAAI,aAAa,aAAa,EAErC,CACN,IAAK,UACHikD,EAAQ,SAAS,CAAE,MAAO,IAAK,EAC/B,MACF,IAAK,WACHA,EAAQ,SAAS,CAAE,MAAO,GAAK,EAC/B,MACF,IAAK,MACHA,EAAQ,QACR,MACF,IAAK,aACH,MAAMH,EAAiB79E,EAAU,cAAc,kBAAkB,EAC7D69E,GACFA,EAAe,sBAEjB,MAEN,CAAC,CACH,CAAC,CACH,CAKA,SAASic,GAAe//E,EAA8B,CACpD,MAAMqgF,EAAQ,IAAI,IAAIrgF,EAAM,IAAI,GAAK,EAAE,MAAQ,SAAS,CAAC,EACzD,OAAO,MAAM,KAAKqgF,CAAK,CACzB,CAKA,SAASL,GAAa15F,EAAuB,CAC3C,MAAMmhE,EAAiC,CACrC,OAAQ,UACR,aAAc,UACd,SAAU,UACV,MAAO,UACP,SAAU,UACV,QAAS,WAEX,OAAOA,EAAOnhE,GAAQ,SAAS,GAAKmhE,EAAO,OAC7C,CCzRA,MAAMhlC,GAAW,gBAyBjB,IAAI7T,GAA0B,GAC1B0xE,GAAO,EACPC,GAAU,GACV5xB,GAAU,GAKd,eAAsB6xB,GAAiBxiE,EAA2B,GAAmB,CACnF,KAAM,CAAE,WAAAxZ,EAAY,SAAApE,EAAU,MAAA4gB,EAAQ,UAAW,UAAAy/D,GAAcziE,EAE/DpP,GAAU,GACV0xE,GAAO,EACPC,GAAU,GAGV,MAAMn9D,EAAW,SAAS,cAAc,mBAAmBX,EAAQ,IAAI,EACnEW,KAAmB,SAEvB,MAAMlrB,EAAUikB,EAAc,MAAO,CAAE,UAAW,wBAAyB,EAC3EjkB,EAAQ,UAAY,gDAGpB,MAAMmpB,EAASlF,EAAc,MAAO,CAAE,UAAW,eAAgB,EAE3Dv1B,EAAWu1B,EAAc,SAAU,CACvC,UAAW,kBACX,YAAa,QACd,EAEDG,EAAG11B,EAAU,QAAS,IAAM+2B,EAAW8E,EAAQ,CAAC,EAChDpB,EAAO,YAAYz6B,CAAQ,EAG3B,MAAM06B,EAAQP,GAAY,CACxB,GAAI0B,GACJ,MAAAzB,EACA,QAAA9oB,EACA,KAAM,KACN,OAAAmpB,CAAA,CACD,EAED,SAAS,KAAK,YAAYC,CAAK,EAC/B7D,GAAUgF,EAAQ,EAGlB,MAAMi+D,GAAYxoF,EAASsM,EAAYpE,EAAUqgF,CAAS,CAC5D,CAKA,eAAeC,GACbz6F,EACAue,EACApE,EACAqgF,EACe,CACf,GAAI,EAAA9xB,IAAW,CAAC4xB,IAEhB,CAAA5xB,GAAU,GAEV,GAAI,CACF,MAAMz7D,EAAS,IAAI,gBAAgB,CAAE,KAAM,OAAOotF,EAAI,EAAG,MAAO,KAAM,EAClE97E,GAAYtR,EAAO,IAAI,aAAcsR,CAAU,EAC/CpE,GAAUlN,EAAO,IAAI,WAAYkN,CAAQ,EAE7C,MAAMrY,EAAW,MAAMmB,EAAK,IAC1B,gBAAgBgK,CAAM,IAGxB0b,GAAU,CAAC,GAAGA,GAAS,GAAG7mB,EAAS,KAAK,OAAO,EAC/Cw4F,GAAUx4F,EAAS,KAAK,QACxBu4F,KAEAlF,GAAOn1F,EAAWw6F,CAAS,CAC7B,MAAQ,CACNx6F,EAAU,UAAY,iDACxB,SACE0oE,GAAU,EACZ,EACF,CAKA,SAASysB,GAAOn1F,EAAwBw6F,EAAiD,CACvF,GAAI7xE,GAAQ,SAAW,EAAG,CACxB3oB,EAAU,UAAY;AAAA;AAAA;AAAA;AAAA;AAAA,MAMtB,MACF,CAGA,MAAMomB,EAAU84D,GAAYv2D,EAAO,EAEnC3oB,EAAU,UAAY;AAAA;AAAA,QAEhB,OAAO,QAAQomB,CAAO,EAAE,IAAI,CAAC,CAAC2f,EAAMy6C,CAAK,IAAM;AAAA;AAAA,sCAEjBz6C,CAAI;AAAA,YAC9By6C,EAAM,IAAI9oC,GAASgjD,GAAYhjD,CAAK,CAAC,EAAE,KAAK,EAAE,CAAC;AAAA;AAAA,OAEpD,EAAE,KAAK,EAAE,CAAC;AAAA;AAAA,MAEX4iD,GAAU;AAAA;AAAA;AAAA;AAAA,MAIR,EAAE;AAAA,IAIR,MAAMK,EAAc36F,EAAU,cAAc,2BAA2B,EACnE26F,GACFtkE,EAAGskE,EAA4B,QAAS,SAAY,CAClD,MAAMF,GAAYz6F,EAAW,OAAW,OAAWw6F,CAAS,CAC9D,CAAC,EAICA,GACFx6F,EAAU,iBAAiB,yBAAyB,EAAE,QAAQ+5B,GAAO,CACnE1D,EAAG0D,EAAoB,QAAS,SAAY,CAC1C,MAAM6gE,EAAU7gE,EAAI,aAAa,eAAe,EAC1C2d,EAAQ/uB,GAAQ,KAAK3S,GAAKA,EAAE,KAAO4kF,CAAO,EAChD,GAAIljD,EAAO,CACT,KAAM,CAAE,QAAA5b,CAAA,EAAY,MAAA2yB,GAAA,wBAAA3yB,CAAA,QAAM,2BAAAm3B,EAAA,EAA0B,eAAAn3B,CAAA,WAClC,MAAMA,EACtB,iDACA,CAAE,MAAO,UAAW,YAAa,UAAU,GAG3C0+D,EAAU9iD,CAAK,CAEnB,CACF,CAAC,CACH,CAAC,EAIH13C,EAAU,iBAAiB,wBAAwB,EAAE,QAAQ+5B,GAAO,CAClE1D,EAAG0D,EAAoB,QAAS,IAAM,CACpC,MAAM8gE,EAAY9gE,EAAI,QAAQ,gBAAgB,GAAG,cAAc,kBAAkB,EAC7E8gE,IACFA,EAAU,UAAU,OAAO,UAAU,EACrC9gE,EAAI,YAAc8gE,EAAU,UAAU,SAAS,UAAU,EAAI,eAAiB,eAElF,CAAC,CACH,CAAC,CACH,CAKA,SAASH,GAAYhjD,EAA6B,CAChD,MAAMojD,EAAsC,CAC1C,OAAQ,IACR,OAAQ,KACR,OAAQ,MACR,QAAS,MAGLC,EAAuC,CAC3C,OAAQ,UACR,OAAQ,OACR,OAAQ,SACR,QAAS,WAGLC,EAAatjD,EAAM,SAAW,OAAO,KAAKA,EAAM,OAAO,EAAE,OAAS,EAExE,MAAO;AAAA,gCACuBqjD,EAAarjD,EAAM,MAAM,CAAC,oBAAoBA,EAAM,EAAE;AAAA,kCACpDojD,EAAYpjD,EAAM,MAAM,CAAC;AAAA;AAAA;AAAA,oBAGvCA,EAAM,MAAM,IAAI;AAAA,YACxBA,EAAM,MAAM;AAAA,sCACcA,EAAM,UAAU;AAAA,YAC1CA,EAAM,WAAa,IAAIra,GAAWqa,EAAM,UAAU,CAAC,IAAM,EAAE;AAAA;AAAA,oCAEnCiY,GAAmBjY,EAAM,SAAS,CAAC;AAAA;AAAA,UAE7DsjD,EAAa;AAAA;AAAA,cAET,OAAO,QAAQtjD,EAAM,OAAQ,EAAE,IAAI,CAAC,CAACrJ,EAAO4sD,CAAM,IAAM;AAAA;AAAA,6CAEzB5sD,CAAK;AAAA,2CACP6sD,GAAYD,EAAO,GAAG,CAAC;AAAA;AAAA,2CAEvBC,GAAYD,EAAO,GAAG,CAAC;AAAA;AAAA,aAErD,EAAE,KAAK,EAAE,CAAC;AAAA;AAAA;AAAA,UAGX,EAAE;AAAA;AAAA,UAEJvjD,EAAM,SAAW,SAAW;AAAA,0FACoDA,EAAM,EAAE;AAAA;AAAA;AAAA,UAGtF,EAAE;AAAA;AAAA;AAAA,GAId,CAKA,SAASwnC,GAAYsB,EAAuD,CAC1E,MAAMvoB,EAAyC,GAE/C,OAAAuoB,EAAM,QAAQx8E,GAAQ,CACpB,MAAM+hC,EAAO,IAAI,KAAK/hC,EAAK,SAAS,EAAE,qBACjCi0D,EAAOlyB,CAAI,IACdkyB,EAAOlyB,CAAI,EAAI,IAEjBkyB,EAAOlyB,CAAI,EAAE,KAAK/hC,CAAI,CACxB,CAAC,EAEMi0D,CACT,CAKA,SAASijC,GAAYh3F,EAAwB,CAC3C,OAAIA,GAAU,KAAoC,UAC9C,OAAOA,GAAU,SAAiB,KAAK,UAAUA,CAAK,EACnD,OAAOA,CAAK,CACrB,CAKA,SAASm5B,GAAWr7B,EAAsB,CACxC,MAAMi8B,EAAM,SAAS,cAAc,KAAK,EACxC,OAAAA,EAAI,YAAcj8B,EACXi8B,EAAI,SACb,CC5QA,MAAMzB,GAAW,gBAwBjB,IAAIiuC,GAAsB,GAK1B,eAAsB0wB,GAAiBpjE,EAAyC,CAC9E,KAAM,CAAE,WAAAxZ,EAAY,SAAApE,EAAU,WAAAihF,EAAY,eAAAC,GAAmBtjE,EAE7D0yC,GAAW,GAGX,MAAMttC,EAAW,SAAS,cAAc,mBAAmBX,EAAQ,IAAI,EACnEW,KAAmB,SAEvB,MAAMlrB,EAAUikB,EAAc,MAAO,CAAE,UAAW,wBAAyB,EAC3EjkB,EAAQ,UAAY,iDAGpB,MAAMmpB,EAASlF,EAAc,MAAO,CAAE,UAAW,8BAA+B,EAChFkF,EAAO,UAAY;AAAA;AAAA;AAAA;AAAA;AAAA,IAQnB,MAAMC,EAAQP,GAAY,CACxB,GAAI0B,GACJ,MAAO4+D,EAAa,gBAAgBA,CAAU,IAAM,WACpD,QAAAnpF,EACA,KAAM,KACN,OAAAmpB,CAAA,CACD,EAED,SAAS,KAAK,YAAYC,CAAK,EAC/B7D,GAAUgF,EAAQ,EAGlB,MAAMsvB,EAAY1wB,EAAO,cAAc,iBAAiB,EAClD53B,EAAQ43B,EAAO,cAAc,gBAAgB,EAEnD/E,EAAGy1B,EAAW,QAAS,SAAY,CACjC,MAAM9pD,EAAOwB,EAAM,MAAM,OACzB,GAAI,CAACxB,EAAM,CACT7B,EAAM,QAAQ,wBAAwB,EACtC,MACF,CAEA2rD,EAAU,SAAW,GACrBA,EAAU,YAAc,aAExB,GAAI,CACF,MAAMhqD,EAAW,MAAMmB,EAAK,KAAc,QAAQsb,CAAU,IAAIpE,CAAQ,YAAa,CACnF,QAASnY,CAAA,CACV,EAEDyoE,GAAS,QAAQ3oE,EAAS,IAAI,EAC9B0B,EAAM,MAAQ,GACd2xF,GAAOljF,EAAS8lB,CAAK,EACrBsjE,IAAiBv5F,EAAS,IAAI,EAC9B3B,EAAM,QAAQ,eAAe,CAC/B,MAAQ,CAER,SACE2rD,EAAU,SAAW,GACrBA,EAAU,YAAc,MAC1B,CACF,CAAC,EAGDz1B,EAAG7yB,EAAO,UAAYwS,GAAM,CACtBA,EAAE,MAAQ,SAAWA,EAAE,SACzB81C,EAAU,OAEd,CAAC,EAGD,GAAI,CAEF2e,IADiB,MAAMxnE,EAAK,IAAe,QAAQsb,CAAU,IAAIpE,CAAQ,WAAW,GAChE,KACpBg7E,GAAOljF,EAAS8lB,CAAK,CACvB,MAAQ,CACN9lB,EAAQ,UAAY,kDACtB,CACF,CAKA,SAASkjF,GAAOn1F,EAAwB+3B,EAAgC,CACtE,GAAI0yC,GAAS,SAAW,EAAG,CACzBzqE,EAAU,UAAY;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA,MAOtB,MACF,CAEAA,EAAU,UAAY;AAAA;AAAA,QAEhByqE,GAAS,IAAI92D,GAAKq3D,GAAcr3D,EAAGokB,CAAK,CAAC,EAAE,KAAK,EAAE,CAAC;AAAA;AAAA,IAKzDujE,GAAmBt7F,EAAW+3B,CAAK,CACrC,CAKA,SAASizC,GAAcD,EAAkBhzC,EAA0B3d,EAAQ,EAAW,CAEpF,MAAMmhF,EADcz0F,EAAS,WAAW,aACV,KAAOikE,EAAQ,OAAO,GAC9ClyC,EAAWkyC,EAAQ,OAAO,KAC7B,MAAM,GAAG,EACT,IAAIjyC,GAAKA,EAAE,CAAC,CAAC,EACb,KAAK,EAAE,EACP,cACA,MAAM,EAAG,CAAC,EAEb,MAAO;AAAA,0BACiB1e,EAAQ,EAAI,QAAU,EAAE,sBAAsB2wD,EAAQ,EAAE,4BAA4B3wD,EAAQ,EAAE;AAAA;AAAA,UAE9G2wD,EAAQ,OAAO,OACjB,aAAaA,EAAQ,OAAO,MAAM,UAAU1tC,GAAW0tC,EAAQ,OAAO,IAAI,CAAC,KAC3ElyC,CACJ;AAAA;AAAA;AAAA;AAAA,2CAIuCwE,GAAW0tC,EAAQ,OAAO,IAAI,CAAC;AAAA,uCACnCpb,GAAmBob,EAAQ,SAAS,CAAC;AAAA,YAChEA,EAAQ,OAAS,+CAAiD,EAAE;AAAA;AAAA,uCAEzC1tC,GAAW0tC,EAAQ,OAAO,CAAC;AAAA;AAAA,0EAEQA,EAAQ,EAAE;AAAA,YACxEwwB,EAAW;AAAA,2EACoDxwB,EAAQ,EAAE;AAAA,yFACIA,EAAQ,EAAE;AAAA,YACrF,EAAE;AAAA;AAAA;AAAA;AAAA,MAIVA,EAAQ,SAAS,IAAIr7D,GAAKs7D,GAAct7D,EAAGqoB,EAAO3d,EAAQ,CAAC,CAAC,EAAE,KAAK,EAAE,GAAK,EAAE;AAAA,GAElF,CAKA,SAASkhF,GAAmBt7F,EAAwB+3B,EAAgC,CAClF/3B,EAAU,iBAAiB,eAAe,EAAE,QAAQ+5B,GAAO,CACzD,MAAMz0B,EAASy0B,EAAI,aAAa,aAAa,EACvCvX,EAAYuX,EAAI,aAAa,iBAAiB,EAEpD1D,EAAG0D,EAAoB,QAAS,SAAY,CAC1C,MAAMgxC,EAAUywB,GAAY/wB,GAAUjoD,CAAU,EAChD,GAAKuoD,EAEL,OAAQzlE,EAAA,CACN,IAAK,QAEH,MAAMm2F,EAAiB1hE,EAAI,QAAQ,UAAU,GAAG,cAAc,eAAe,EAC7E,GAAI0hE,GAAkB,CAACA,EAAe,cAAc,cAAc,EAAG,CACnE,MAAMC,EAAaxlE,EAAc,MAAO,CAAE,UAAW,cAAe,EACpEwlE,EAAW,UAAY;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA,cAQvBD,EAAe,YAAYC,CAAU,EAErC,MAAMx/D,EAAYw/D,EAAW,cAAc,eAAe,EACpD5vC,EAAY4vC,EAAW,cAAc,eAAe,EACpDnlC,EAAWmlC,EAAW,cAAc,UAAU,EAEpDrlE,EAAG6F,EAA0B,QAAS,IAAMw/D,EAAW,QAAQ,EAC/DrlE,EAAGy1B,EAA0B,QAAS,SAAY,CAChD,MAAM9pD,EAAOu0D,EAAS,MAAM,OAC5B,GAAKv0D,EAEL,GAAI,CACF,MAAMF,EAAW,MAAMmB,EAAK,KAC1B,QAAQ80B,EAAM,UAAU,IAAIA,EAAM,QAAQ,aAAavV,CAAS,WAChE,CAAE,QAASxgB,CAAA,CAAK,EAGb+oE,EAAQ,UAASA,EAAQ,QAAU,IACxCA,EAAQ,QAAQ,KAAKjpE,EAAS,IAAI,EAClCqzF,GAAOn1F,EAAW+3B,CAAK,CACzB,MAAQ,CAER,CACF,CAAC,EAEDw+B,EAAS,OACX,CACA,MAEF,IAAK,OAEH,MAAM6F,EAAYriC,EAAI,QAAQ,UAAU,GAAG,cAAc,kBAAkB,EAC3E,GAAIqiC,EAAW,CACb,MAAM4Q,EAAejC,EAAQ,QAC7B3O,EAAU,UAAY;AAAA,gDACc/+B,GAAW2vC,CAAY,CAAC;AAAA;AAAA;AAAA;AAAA;AAAA,cAO5D,MAAMzW,EAAW6F,EAAU,cAAc,UAAU,EAC7ClgC,EAAYkgC,EAAU,cAAc,cAAc,EAClDr+B,EAAUq+B,EAAU,cAAc,YAAY,EAEpD/lC,EAAG6F,EAA0B,QAAS,IAAM,CAC1CkgC,EAAU,YAAc4Q,CAC1B,CAAC,EAED32C,EAAG0H,EAAwB,QAAS,SAAY,CAC9C,MAAM49D,EAAUplC,EAAS,MAAM,OAC/B,GAAKolC,EAEL,GAAI,CACF,MAAM14F,EAAK,MACT,QAAQ80B,EAAM,UAAU,IAAIA,EAAM,QAAQ,aAAavV,CAAS,GAChE,CAAE,QAASm5E,CAAA,CAAQ,EAErB5wB,EAAQ,QAAU4wB,EAClB5wB,EAAQ,OAAS,GACjBoqB,GAAOn1F,EAAW+3B,CAAK,CACzB,MAAQ,CAER,CACF,CAAC,EAEDw+B,EAAS,OACX,CACA,MAEF,IAAK,SACH,KAAM,CAAE,QAAAz6B,CAAA,EAAY,MAAA2yB,GAAA,wBAAA3yB,CAAA,QAAM,2BAAAm3B,EAAA,EAAiB,eAAAn3B,CAAA,WAO3C,GANkB,MAAMA,EAAQ,uBAAwB,CACtD,MAAO,iBACP,YAAa,SACb,aAAc,aACf,EAGC,GAAI,CACF,MAAM74B,EAAK,OACT,QAAQ80B,EAAM,UAAU,IAAIA,EAAM,QAAQ,aAAavV,CAAS,IAElEo5E,GAAcnxB,GAAUjoD,CAAU,EAClC2yE,GAAOn1F,EAAW+3B,CAAK,EACvB53B,EAAM,QAAQ,iBAAiB,CACjC,MAAQ,CAER,CAEF,MAEN,CAAC,CACH,CAAC,CACH,CAKA,SAASq7F,GAAYlwF,EAAiBhI,EAAiC,CACrE,UAAWynE,KAAWz/D,EAAM,CAC1B,GAAIy/D,EAAQ,KAAOznE,EAAI,OAAOynE,EAC9B,GAAIA,EAAQ,QAAS,CACnB,MAAM8wB,EAAQL,GAAYzwB,EAAQ,QAASznE,CAAE,EAC7C,GAAIu4F,EAAO,OAAOA,CACpB,CACF,CAEF,CAKA,SAASD,GAActwF,EAAiBhI,EAAqB,CAC3D,MAAMjC,EAAQiK,EAAK,UAAUqI,GAAKA,EAAE,KAAOrQ,CAAE,EAC7C,GAAIjC,IAAU,GACZ,OAAAiK,EAAK,OAAOjK,EAAO,CAAC,EACb,GAGT,UAAW0pE,KAAWz/D,EACpB,GAAIy/D,EAAQ,SAAW6wB,GAAc7wB,EAAQ,QAASznE,CAAE,EACtD,MAAO,GAGX,MAAO,EACT,CAKA,SAAS+5B,GAAWr7B,EAAsB,CACxC,MAAMi8B,EAAM,SAAS,cAAc,KAAK,EACxC,OAAAA,EAAI,YAAcj8B,EACXi8B,EAAI,SACb,CClVA,MAAMzB,GAAW,gBAejB,IAAIstB,GAAkC,GAClCgyC,GAAqC,KACrCC,GAAqC,KAKlC,SAASC,GAAiBjkE,EAA2B,GAAU,CACpE+xB,GAAe/xB,EAEf,MAAM9lB,EAAUo4C,GAAA,EAEVhvB,EAAQP,GAAY,CACxB,GAAI0B,GACJ,MAAO,GACP,KAAM,KACN,QAAAvqB,EACA,QAAS8lB,EAAM,QAChB,EAEDsD,EAAM,UAAU,IAAI,uBAAuB,EAE3C,MAAMC,EAAeD,EAAM,cAAc,gBAAgB,EACrDC,GACFA,EAAa,UAAU,IAAI,uBAAuB,EAEpD,MAAMkvB,EAAcnvB,EAAM,cAAc,eAAe,EACnDmvB,GACFA,EAAY,UAAU,IAAI,QAAQ,EAGpC,SAAS,KAAK,YAAYnvB,CAAK,EAC/B7D,GAAUgF,EAAQ,EAElBy/D,GAAYhqF,CAAO,CACrB,CAKA,SAASo4C,IAAkC,CACzC,MAAMrqD,EAAYk2B,EAAc,MAAO,CAAE,UAAW,qBAAsB,EAE1E,OAAAl2B,EAAU,UAAY;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;A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","names":["ThemeService","saved","effective","fn","mode","modes","nextIndex","newTheme","callback","theme","ICONS","container","TOAST_LIMIT","ensureContainer","toast","message","type","options","root","duration","first","el","closeBtn","close","getCurrentProjectId","setProjectIdGetter","getter","config","requestInterceptors","responseInterceptors","addRequestInterceptor","interceptor","index","api","path","attempt","url","finalOptions","timeoutMs","controller","timeoutId","response","contentType","text","data","msg","ApiError","retryAfter","sleep","errorMessage","extractErrorMessage","result","error","rawMessage","fallback","obj","ms","resolve","status","details","http","body","configureApi","newConfig","getProjectHeaders","id","fetchWithProject","input","init","headers","k","v","getItem","key","defaultValue","item","setItem","value","removeItem","clear","hasItem","getKeys","storage","ShortcutService","shortcutStr","handler","description","parts","syntheticEvent","shortcut","event","target","shortcutOrKey","enabled","shortcuts","s","UndoService","action","undoManager","initialState","state","listeners","notify","getState","subscribe","setCurrentProjectId","projectId","setCurrentProject","project","setCurrentUser","user","setAuthConfigured","configured","setConfig","setLoading","isLoading","setError","setOnline","online","reset","initAppStore","appStore","isInitialized","authCheckPromise","checkAuthStatus","checkSession","authUser","mapAuthUserToUser","initAuth","login","credentials","register","logout","forgotPassword","email","resetPassword","password","accessToken","refreshSession","requestLoginCode","verifyLoginCode","code","getOTPConfig","confirmEmail","resendConfirmation","profile","metadata","isAuthenticated","isAuthInitialized","getCurrentUser","onAuthRequired","triggerAuthRequired","auth","setQuestions","questions","setRisks","risks","setActions","actions","setDecisions","decisions","setFacts","facts","setContacts","contacts","setChatHistory","chatHistory","addChatMessage","setProjects","projects","clearChatHistory","dataStore","getProjects","getCurrentProject","createProject","updateProject","currentProject","deleteProject","activateProject","i","p","cachedProject","minimalProject","prev","setDefaultProject","getProjectStats","exportProject","importProject","file","formData","initProjects","defaultProject","listCompanies","list","getCompany","createCompany","updateCompany","deleteCompany","analyzeCompany","getTemplate","companyId","updateTemplate","html","generateTemplate","res","getDashboard","getStats","getTrends","days","getHealth","getInsights","getAlerts","loadDashboardData","dashboard","health","insights","alerts","dashboardService","getQuestions","filters","params","query","getQuestion","createQuestion","updateQuestion","deleteQuestion","reason","answerQuestion","getQuestionsByPerson","getQuestionsByTeam","suggestAssignee","reopenQuestion","dismissQuestion","deferQuestion","until","submitAnswerFeedback","wasUseful","feedback","getQuestionStats","now","sevenDaysAgo","q","questionsService","getRisks","getRisk","getDeletedRisks","restoreRisk","getRiskEvents","getRisksByCategory","createRisk","updateRisk","deleteRisk","calculateRiskScore","impact","likelihood","impactScores","likelihoodScores","suggestRisk","owners","getRiskMatrixData","matrix","r","risk","risksService","normalizeAction","row","getActions","sprintId","decisionId","getAction","createAction","payload","raw","updateAction","deleteAction","getDeletedActions","restoreAction","suggestAssignees","suggestTaskFromDescription","getActionEvents","isOverdue","getActionStats","a","getActionsReport","getSimilarActions","getUserStories","addUserStory","getUserStory","updateUserStory","actionsService","getDecisions","getDecision","getDeletedDecisions","restoreDecision","getDecisionEvents","getSimilarDecisions","limit","runDecisionCheck","detectConflicts","suggest","content","rationale","suggestOwner","createDecision","updateDecision","deleteDecision","approveDecision","approvedBy","rejectDecision","decisionsService","sendMessage","request","m","userMessage","assistantMessage","ask","sotChat","getBriefing","refresh","getBriefingHistory","getWeeklyReport","generateExecutiveSummary","getChatHistory","addToHistory","chatService","getContacts","c","getContact","createContact","updateContact","deleteContact","getContactStats","findContactByName","name","getDuplicates","mergeContacts","contactIds","enrichContact","exportContacts","format","blob","getContactWithAssociations","addContactToProject","contactId","removeContactFromProject","getContactProjects","getTeams","getTeam","createTeam","updateTeam","deleteTeam","addTeamMember","teamId","role","isLead","removeTeamMember","contactsService","teamsService","uploadFiles","files","onProgress","xhr","reject","e","uploadWithExtraction","getProcessingStatus","getDocuments","statusOrOptions","queryString","getDocument","deleteDocument","restoreDocument","reprocessDocument","getDocumentSummary","getKnowledgeBase","category","addKnowledgeItem","searchKnowledge","getConversations","getConversation","parseConversationPreview","importConversation","deleteConversation","reembedConversation","bulkDeleteDocuments","ids","bulkReprocessDocuments","bulkExportDocuments","downloadBulkExport","documentsService","getKnowledgeStatus","exportKnowledgeMarkdown","exportKnowledgeJson","regenerateKnowledge","synthesizeKnowledge","topic","knowledgeService","conversationsService","getEmails","getEmail","getEmailThread","threadId","markAsRead","markAsUnread","starEmail","unstarEmail","archiveEmail","deleteEmail","sendEmail","draft","saveDraft","generateAIResponse","emailId","tone","generateSummary","categorizeEmail","getEmailStats","syncEmails","getById","getNeedingResponse","markResponded","generateResponse","emailsService","getVisualizationData","nodesResponse","edgesResponse","nodes","edges","getGraph","getEntityGraph","entityId","depth","getRelatedEntities","getOntologySchema","getOntologyEntities","getOntologyRelations","getOntologySuggestions","approveOntologySuggestion","suggestionId","rejectOntologySuggestion","getOntologyTypeStats","getOntologySyncStatus","forceOntologySync","runLLMAnalysis","autoApproveHighConfidence","threshold","getOntologyChanges","migrateOntologyToSupabase","getBackgroundWorkerStatus","triggerBackgroundAnalysis","getBackgroundWorkerLog","getOntologyJobs","toggleOntologyJob","jobId","extractOntologyFromGraph","validateOntologyCompliance","getOntologyDiff","findUnusedOntologyTypes","mergeOntology","cleanupOntology","getFalkorDBBrowserInfo","listAllFalkorDBGraphs","syncFalkorDBGraphs","dryRun","deleteFalkorDBGraph","graphName","getCommunities","getCentrality","getBridges","graphRAGQuery","streamGraphRAGQuery","onChunk","onComplete","onError","reader","decoder","fullResponse","done","lines","line","parsed","multiHopQuery","explainConnection","nodeId1","nodeId2","summarizeSelection","nodeIds","naturalLanguageFilter","filterText","suggestRelated","nodeId","executeCypher","cypher","getQueryTemplates","schema","pattern","getProjectGraphs","getCrossProjectEntities","entityType","saveQueryHistory","getQueryHistory","toggleQueryFavorite","queryId","deleteQueryHistory","saveView","view","getSavedViews","updateView","viewId","updates","deleteView","addBookmark","bookmark","getBookmarks","updateBookmark","bookmarkId","removeBookmark","createAnnotation","annotation","getAnnotations","updateAnnotation","annotationId","deleteAnnotation","saveChatMessage","getChatSessions","sessionId","toggleChatPin","messageId","createSnapshot","snapshot","getSnapshots","getSnapshot","snapshotId","compareSnapshots","snapshotId1","snapshotId2","deleteSnapshot","getTimeline","events","getEntityTimeline","getCosts","getCostSummary","period","normalized","d","getRecentCostRequests","getCostsPricing","getCostsBudget","limitUsd","alertThresholdPercent","setCostsBudget","getLLMConfig","graphService","timelineService","costsService","getNotifications","getUnreadCount","markAllAsRead","deleteNotification","getComments","addComment","parentId","updateComment","commentId","deleteComment","addReaction","emoji","removeReaction","createComment","resolveComment","getProjectMembers","inviteMember","updateMemberRole","memberId","removeMember","notificationsService","commentsService","getInvites","membersService","getUserSettings","updateUserSettings","settings","getProjectSettings","updateProjectSettings","getAPIKeys","createAPIKey","permissions","revokeAPIKey","getWebhooks","createWebhook","webhook","updateWebhook","deleteWebhook","testWebhook","getAuditLogs","exportAuditLogs","userSettingsService","projectSettingsService","apiKeysService","webhooksService","auditService","getProfile","updateProfile","currentUser","uploadAvatar","removeAvatar","changePassword","deleteAccount","getActivity","getSessions","revokeSession","revokeAllSessions","profileService","getFacts","getFact","createFact","updateFact","deleteFact","getDeletedFacts","restoreFact","verifyFact","runFactCheck","getFactsByCategory","grouped","fact","getFactsBySource","source","getFactsByDocument","documentId","getFactEvents","factId","getSimilarFacts","searchFacts","getFactStats","stats","f","factsService","getWebhook","regenerateWebhook","toggleWebhook","isActive","getTranscripts","getTranscriptsSummary","assignProject","transcriptId","skipTranscript","retryTranscript","processTranscript","getMappings","deleteMapping","mappingId","getQuarantinedTranscripts","getAvailableMeetings","importAvailableMeetings","meetingIds","generateAvailableMeetingSummary","meetingId","formatStatus","formatDuration","minutes","hours","mins","entries","setPrototypeOf","isFrozen","getPrototypeOf","getOwnPropertyDescriptor","freeze","seal","create","apply","construct","x","func","thisArg","_len","args","_key","Func","_len2","_key2","arrayForEach","unapply","arrayLastIndexOf","arrayPop","arrayPush","arraySplice","stringToLowerCase","stringToString","stringMatch","stringReplace","stringIndexOf","stringTrim","objectHasOwnProperty","regExpTest","typeErrorCreate","unconstruct","_len3","_key3","_len4","_key4","addToSet","set","array","transformCaseFunc","l","element","lcElement","cleanArray","clone","object","newObject","property","lookupGetter","prop","desc","fallbackValue","html$1","svg$1","svgFilters","svgDisallowed","mathMl$1","mathMlDisallowed","svg","mathMl","xml","MUSTACHE_EXPR","ERB_EXPR","TMPLIT_EXPR","DATA_ATTR","ARIA_ATTR","IS_ALLOWED_URI","IS_SCRIPT_OR_DATA","ATTR_WHITESPACE","DOCTYPE_NAME","CUSTOM_ELEMENT","EXPRESSIONS","NODE_TYPE","getGlobal","_createTrustedTypesPolicy","trustedTypes","purifyHostElement","suffix","ATTR_NAME","policyName","scriptUrl","_createHooksMap","createDOMPurify","window","DOMPurify","document","originalDocument","currentScript","DocumentFragment","HTMLTemplateElement","Node","Element","NodeFilter","NamedNodeMap","HTMLFormElement","DOMParser","ElementPrototype","cloneNode","remove","getNextSibling","getChildNodes","getParentNode","template","trustedTypesPolicy","emptyHTML","implementation","createNodeIterator","createDocumentFragment","getElementsByTagName","importNode","hooks","IS_ALLOWED_URI$1","ALLOWED_TAGS","DEFAULT_ALLOWED_TAGS","ALLOWED_ATTR","DEFAULT_ALLOWED_ATTR","CUSTOM_ELEMENT_HANDLING","FORBID_TAGS","FORBID_ATTR","EXTRA_ELEMENT_HANDLING","ALLOW_ARIA_ATTR","ALLOW_DATA_ATTR","ALLOW_UNKNOWN_PROTOCOLS","ALLOW_SELF_CLOSE_IN_ATTR","SAFE_FOR_TEMPLATES","SAFE_FOR_XML","WHOLE_DOCUMENT","SET_CONFIG","FORCE_BODY","RETURN_DOM","RETURN_DOM_FRAGMENT","RETURN_TRUSTED_TYPE","SANITIZE_DOM","SANITIZE_NAMED_PROPS","SANITIZE_NAMED_PROPS_PREFIX","KEEP_CONTENT","IN_PLACE","USE_PROFILES","FORBID_CONTENTS","DEFAULT_FORBID_CONTENTS","DATA_URI_TAGS","DEFAULT_DATA_URI_TAGS","URI_SAFE_ATTRIBUTES","DEFAULT_URI_SAFE_ATTRIBUTES","MATHML_NAMESPACE","SVG_NAMESPACE","HTML_NAMESPACE","NAMESPACE","IS_EMPTY_INPUT","ALLOWED_NAMESPACES","DEFAULT_ALLOWED_NAMESPACES","MATHML_TEXT_INTEGRATION_POINTS","HTML_INTEGRATION_POINTS","COMMON_SVG_AND_HTML_ELEMENTS","PARSER_MEDIA_TYPE","SUPPORTED_PARSER_MEDIA_TYPES","DEFAULT_PARSER_MEDIA_TYPE","CONFIG","formElement","isRegexOrFunction","testValue","_parseConfig","cfg","ALL_SVG_TAGS","ALL_MATHML_TAGS","_checkValidNamespace","parent","tagName","parentTagName","_forceRemove","node","_removeAttribute","_initDocument","dirty","doc","leadingWhitespace","matches","dirtyPayload","_createNodeIterator","_isClobbered","_isNode","_executeHooks","currentNode","hook","_sanitizeElements","_isBasicCustomElement","parentNode","childNodes","childCount","childClone","expr","_isValidAttribute","lcTag","lcName","_sanitizeAttributes","attributes","hookEvent","attr","namespaceURI","attrValue","initValue","_sanitizeShadowDOM","fragment","shadowNode","shadowIterator","importedNode","returnNode","nodeIterator","serializedHTML","tag","entryPoint","hookFunction","createElement","children","child","on","addClass","classes","removeClass","createThemeToggle","button","updateButton","getThemeIcon","mountThemeToggle","selector","setTab","tab","setDevTab","setSotView","setSelectedPerson","person","toggleSidebar","setSidebarOpen","open","openModal","modalId","closeModal","setSearchQuery","toggleFilter","uiStore","createHeader","props","header","logoSection","actionsSection","projectSelector","createProjectSelector","themeToggle","userMenu","createUserMenu","mobileMenuBtn","onProjectChange","dropdown","projectName","isOpen","initials","n","updateDropdown","settingsBtn","shortcutsBtn","logoutBtn","closeDropdown","mountHeader","defaultTabs","adminTab","getTabsForUser","createTabButton","rebuildNavigation","nav","tabs","currentTab","createSidebar","sidebar","btn","initialActiveBtn","updateTabBadge","tabId","count","badge","mountSidebar","containerInstance","getToastContainer","position","createToastElement","icons","dismissToast","showToastInContainer","activeModals","createModal","title","size","closable","onClose","onOpen","footer","modal","modalContent","footerEl","closeAllModals","_","isModalOpen","updateModalContent","updateModalTitle","titleEl","confirm","confirmText","cancelText","confirmClass","cancelBtn","confirmBtn","alert","okBtn","prompt","placeholder","MODAL_ID","PERMISSION_CATEGORIES","ROLE_DEFAULTS","showMemberPermissionsModal","userId","userName","userEmail","avatarUrl","currentRole","onSave","selectedPermissions","existing","getInitials","escapeHtml","cat","roleSelect","defaults","updateCheckboxes","checkbox","updateItemStyles","checkboxes","allChecked","cb","saveBtn","selected","div","$constructor","initializer","inst","def","proto","keys","Parent","Definition","_a","$ZodAsyncError","$ZodEncodeError","globalConfig","getEnumValues","numericValues","jsonStringifyReplacer","cached","nullish","cleanRegex","start","end","EVALUATING","defineLazy","assignProp","mergeDefs","defs","mergedDescriptors","descriptors","esc","str","slugify","captureStackTrace","_args","isObject","allowsEval","F","isPlainObject","o","ctor","prot","shallowClone","propertyKeyTypes","escapeRegex","cl","normalizeParams","_params","optionalKeys","shape","pick","mask","currDef","checks","newShape","omit","extend","existingShape","_shape","safeExtend","merge","b","partial","Class","oldShape","required","aborted","startIndex","prefixIssues","issues","iss","unwrapMessage","finalizeIssue","ctx","full","getLengthableOrigin","issue","util.jsonStringifyReplacer","$ZodError","$ZodRealError","flattenError","mapper","fieldErrors","formErrors","sub","formatError","processError","curr","_parse","_Err","_ctx","core.$ZodAsyncError","util.finalizeIssue","core.config","util.captureStackTrace","_parseAsync","_safeParse","errors.$ZodError","safeParse","errors.$ZodRealError","_safeParseAsync","safeParseAsync","_encode","_decode","_encodeAsync","_decodeAsync","_safeEncode","_safeDecode","_safeEncodeAsync","_safeDecodeAsync","cuid","cuid2","ulid","xid","ksuid","nanoid","guid","uuid","version","_emoji","ipv4","ipv6","cidrv4","cidrv6","base64","base64url","e164","dateSource","date","timeSource","hhmm","time","datetime","opts","timeRegex","string","regex","lowercase","uppercase","$ZodCheck","core.$constructor","$ZodCheckMaxLength","val","util.nullish","origin","util.getLengthableOrigin","$ZodCheckMinLength","$ZodCheckLengthEquals","bag","length","tooBig","$ZodCheckStringFormat","_b","$ZodCheckRegex","$ZodCheckLowerCase","regexes.lowercase","$ZodCheckUpperCase","regexes.uppercase","$ZodCheckIncludes","escapedRegex","util.escapeRegex","$ZodCheckStartsWith","$ZodCheckEndsWith","$ZodCheckOverwrite","Doc","arg","minIndent","dedented","$ZodType","ch","runChecks","isAborted","util.aborted","asyncResult","currLen","handleCanaryResult","canary","checkResult","util.defineLazy","$ZodString","regexes.string","$ZodStringFormat","checks.$ZodCheckStringFormat","$ZodGUID","regexes.guid","$ZodUUID","regexes.uuid","$ZodEmail","regexes.email","$ZodURL","trimmed","$ZodEmoji","regexes.emoji","$ZodNanoID","regexes.nanoid","$ZodCUID","regexes.cuid","$ZodCUID2","regexes.cuid2","$ZodULID","regexes.ulid","$ZodXID","regexes.xid","$ZodKSUID","regexes.ksuid","$ZodISODateTime","regexes.datetime","$ZodISODate","regexes.date","$ZodISOTime","regexes.time","$ZodISODuration","regexes.duration","$ZodIPv4","regexes.ipv4","$ZodIPv6","regexes.ipv6","$ZodCIDRv4","regexes.cidrv4","$ZodCIDRv6","regexes.cidrv6","address","prefix","prefixNum","isValidBase64","$ZodBase64","regexes.base64","isValidBase64URL","regexes.base64url","padded","$ZodBase64URL","$ZodE164","regexes.e164","isValidJWT","token","algorithm","tokensParts","parsedHeader","$ZodJWT","$ZodUnknown","$ZodNever","handleArrayResult","final","util.prefixIssues","$ZodArray","proms","handlePropertyResult","isOptionalOut","normalizeDef","okeys","util.optionalKeys","handleCatchall","unrecognized","keySet","_catchall","t","$ZodObject","sh","newSh","_normalized","util.cached","propValues","field","util.isObject","catchall","$ZodObjectJIT","superParse","generateFastpass","parseStr","util.esc","counter","fastpass","jit","core.globalConfig","fastEnabled","util.allowsEval","handleUnionResults","results","nonaborted","$ZodUnion","option","patterns","util.cleanRegex","single","async","$ZodIntersection","left","right","handleIntersectionResults","mergeValues","util.isPlainObject","bKeys","sharedKeys","newObj","sharedValue","newArray","itemA","itemB","unrecKeys","unrecIssue","bothKeys","merged","$ZodEnum","values","util.getEnumValues","valuesSet","util.propertyKeyTypes","$ZodTransform","core.$ZodEncodeError","_out","output","handleOptionalResult","$ZodOptional","$ZodExactOptional","$ZodNullable","$ZodDefault","handleDefaultResult","$ZodPrefault","$ZodNonOptional","handleNonOptionalResult","$ZodCatch","$ZodPipe","handlePipeResult","next","$ZodReadonly","handleReadonlyResult","$ZodCustom","checks.$ZodCheck","handleRefineResult","_iss","util.issue","$ZodRegistry","_meta","meta","pm","registry","globalRegistry","_string","util.normalizeParams","_email","_guid","_uuid","_uuidv4","_uuidv6","_uuidv7","_url","_nanoid","_cuid","_cuid2","_ulid","_xid","_ksuid","_ipv4","_ipv6","_cidrv4","_cidrv6","_base64","_base64url","_e164","_jwt","_isoDateTime","_isoDate","_isoTime","_isoDuration","_unknown","_never","_maxLength","maximum","checks.$ZodCheckMaxLength","_minLength","minimum","checks.$ZodCheckMinLength","_length","checks.$ZodCheckLengthEquals","_regex","checks.$ZodCheckRegex","_lowercase","checks.$ZodCheckLowerCase","_uppercase","checks.$ZodCheckUpperCase","_includes","includes","checks.$ZodCheckIncludes","_startsWith","checks.$ZodCheckStartsWith","_endsWith","checks.$ZodCheckEndsWith","_overwrite","tx","checks.$ZodCheckOverwrite","_normalize","form","_trim","_toLowerCase","_toUpperCase","_slugify","util.slugify","_array","_refine","_superRefine","_check","_issue","initializeContext","process","seen","overrideSchema","_json","processor","isTransforming","extractDefs","idToSchema","entry","makeURI","defsSegment","externalId","uriGenerator","defUriPrefix","defId","extractToDef","ref","ext","finalize","flattenRef","zodSchema","_cached","refSeen","refSchema","parentSeen","finalized","createStandardJSONSchemaMethod","_schema","createToJSONSchemaMethod","processors","io","libraryOptions","formatMap","stringProcessor","json","contentEncoding","regexes","neverProcessor","unknownProcessor","enumProcessor","customProcessor","transformProcessor","arrayProcessor","objectProcessor","allKeys","requiredKeys","unionProcessor","isExclusive","intersectionProcessor","isSimpleIntersection","allOf","nullableProcessor","inner","nonoptionalProcessor","defaultProcessor","prefaultProcessor","catchProcessor","catchValue","pipeProcessor","innerType","readonlyProcessor","optionalProcessor","ZodISODateTime","core.$ZodISODateTime","schemas.ZodStringFormat","core._isoDateTime","ZodISODate","core.$ZodISODate","core._isoDate","ZodISOTime","core.$ZodISOTime","core._isoTime","ZodISODuration","core.$ZodISODuration","core._isoDuration","core.formatError","core.flattenError","ZodRealError","parse","core._parse","parseAsync","core._parseAsync","core._safeParse","core._safeParseAsync","encode","core._encode","decode","core._decode","encodeAsync","core._encodeAsync","decodeAsync","core._decodeAsync","safeEncode","core._safeEncode","safeDecode","core._safeDecode","safeEncodeAsync","core._safeEncodeAsync","safeDecodeAsync","core._safeDecodeAsync","ZodType","core.$ZodType","util.mergeDefs","core.clone","reg","parse.parse","parse.safeParse","parse.parseAsync","parse.safeParseAsync","parse.encode","parse.decode","parse.encodeAsync","parse.decodeAsync","parse.safeEncode","parse.safeDecode","parse.safeEncodeAsync","parse.safeDecodeAsync","check","refine","refinement","superRefine","checks.overwrite","optional","exactOptional","nullable","nonoptional","union","intersection","pipe","transform","_default","prefault","_catch","readonly","core.globalRegistry","_ZodString","core.$ZodString","processors.stringProcessor","checks.regex","checks.includes","checks.startsWith","checks.endsWith","checks.minLength","checks.maxLength","checks.length","checks.lowercase","checks.uppercase","checks.trim","checks.normalize","checks.toLowerCase","checks.toUpperCase","checks.slugify","ZodString","core._email","ZodEmail","core._url","ZodURL","core._jwt","ZodJWT","core._emoji","ZodEmoji","core._guid","ZodGUID","core._uuid","ZodUUID","core._uuidv4","core._uuidv6","core._uuidv7","core._nanoid","ZodNanoID","core._cuid","ZodCUID","core._cuid2","ZodCUID2","core._ulid","ZodULID","core._base64","ZodBase64","core._base64url","ZodBase64URL","core._xid","ZodXID","core._ksuid","ZodKSUID","core._ipv4","ZodIPv4","core._ipv6","ZodIPv6","core._cidrv4","ZodCIDRv4","core._cidrv6","ZodCIDRv6","core._e164","ZodE164","iso.datetime","iso.date","iso.time","iso.duration","core._string","ZodStringFormat","core.$ZodStringFormat","core.$ZodEmail","core.$ZodGUID","core.$ZodUUID","core.$ZodURL","core.$ZodEmoji","core.$ZodNanoID","core.$ZodCUID","core.$ZodCUID2","core.$ZodULID","core.$ZodXID","core.$ZodKSUID","core.$ZodIPv4","core.$ZodIPv6","core.$ZodCIDRv4","core.$ZodCIDRv6","core.$ZodBase64","core.$ZodBase64URL","core.$ZodE164","core.$ZodJWT","ZodUnknown","core.$ZodUnknown","processors.unknownProcessor","unknown","core._unknown","ZodNever","core.$ZodNever","processors.neverProcessor","never","core._never","ZodArray","core.$ZodArray","processors.arrayProcessor","minLength","maxLength","len","core._array","ZodObject","core.$ZodObjectJIT","processors.objectProcessor","_enum","incoming","util.extend","util.safeExtend","other","util.merge","util.pick","util.omit","util.partial","ZodOptional","util.required","ZodNonOptional","ZodUnion","core.$ZodUnion","processors.unionProcessor","ZodIntersection","core.$ZodIntersection","processors.intersectionProcessor","ZodEnum","core.$ZodEnum","processors.enumProcessor","newEntries","ZodTransform","core.$ZodTransform","processors.transformProcessor","core.$ZodOptional","processors.optionalProcessor","ZodExactOptional","core.$ZodExactOptional","ZodNullable","core.$ZodNullable","processors.nullableProcessor","ZodDefault","core.$ZodDefault","processors.defaultProcessor","util.shallowClone","ZodPrefault","core.$ZodPrefault","processors.prefaultProcessor","core.$ZodNonOptional","processors.nonoptionalProcessor","ZodCatch","core.$ZodCatch","processors.catchProcessor","ZodPipe","core.$ZodPipe","processors.pipeProcessor","in_","out","ZodReadonly","core.$ZodReadonly","processors.readonlyProcessor","ZodCustom","core.$ZodCustom","processors.customProcessor","core._refine","core._superRefine","projectSchema","z.object","z.string","currentProps","inlineOnCancel","projectMembers","projectRoles","projectConfig","projectContacts","showProjectModal","createModalContent","loadProjectData","renderCreateForm","modalHeader","closeOrInlineCancel","card","projectRes","membersRes","rolesRes","configRes","contactsRes","contactsData","renderEditForm","bindCreateEvents","renderMembersList","renderRolesList","getConfigValue","bindEditEvents","member","isOwner","part","companySelect","companies","projectData","validation","submitBtn","loadProjects","section","companySelectEdit","currentCompanyId","projectForm","descEl","deleteBtn","inviteBtn","inviteFirstBtn","showInviteModal","addRoleBtn","showAddRoleDialog","select","newRole","membersList","bindMemberEvents","configForm","showEditUserRoleDialog","existingDialog","dialog","closeDialog","enhanceBtn","nameInput","contextInput","descInput","roleName","roleContext","loadProjectRoles","rolesGrid","overlay","customInput","promptTextarea","selectedOption","isCustom","roleSelectValue","userRole","userRolePrompt","linkedContactId","memberIndex","contact","handleEscape","showInvite","__vitePreload","InviteModal","initProjectSelector","newBtn","editBtn","loadProjectsIntoSelector","selectProject","updateSelectorOptions","projectList","currentProjectId","currentValue","onChange","wrapper","defaultOption","formatNumber","locale","formatDate","formatDateTime","formatRelativeTime","diffMs","diffSec","diffMin","diffHour","diffDay","futureDays","yesterday","isSameDay","startOfWeek","getStartOfWeek","startOfLastWeek","d1","d2","day","formatFileSize","bytes","units","formatCurrency","currency","currentSuggestions","showQuestionModal","question","onDismiss","renderQuestionView","createFooterButtons","getModalTitle","onDelete","createBtn","handleCreate","handleEdit","dismissBtn","handleDismiss","saveAnswerBtn","handleAnswer","answerBtn","reopenBtn","handleReopen","suggestBtn","loadAssigneeSuggestions","showAnswerField","suggestionsContainer","suggestion","assigneeInput","getValue","warning","newQuestion","updated","answerInput","sourceSelect","followupInput","answer","followupQuestions","questionId","Modal","QuestionDetailView","entities","topics","provenance","onUpdate","backLink","aiSuggestBtn","checkAnswersBtn","dismissMenu","link","closeMenu","deferBtn","undeferBtn","feedbackYes","feedbackNo","radio","opt","showAnswererPickerBtn","clearAnswererBtn","answererPicker","filterInput","otherInput","display","clearBtn","showBtn","picker","buttons","chainContent","similarContent","similar","timelineContent","icon","eventType","panel","showAllBtn","photoUrl","roleDisplay","scoreColor","selectBtn","idx","previousAssignedTo","previousStatus","assignmentEl","err","prevContact","hideBtn","timeoutMessage","retryBtn","score","showPickerBtn","changeBtn","searchInput","relevant","textarea","answererSelect","contextAnsweredBy","contextAnsweredByName","followups","previousQuestion","area","dateStr","createQuestionDetailView","currentFilter","currentView","createQuestionsPanel","filterSelect","loadQuestions","viewTabs","addBtn","generateBtn","showGenerateForTeamDialog","updateCount","renderByStatus","renderGrouped","slaHours","created","deadline","createQuestionCard","bindCardEvents","groups","groupName","allQuestions","qs","priorityClass","statusClass","slaBreached","autoDetected","hasAnswer","hasRequesterRole","getPhotoUrl","renderAvatar","cssClass","requesterName","requesterRole","requesterContactId","requesterPhotoUrl","assigneePhotoUrl","showQuestionDetailView","containerEl","panelContent","detailView","updatedQuestion","targetQuestion","currentSource","selectedRole","allRoles","questionCount","configSection","selectedBadge","genOverlay","genContent","getRoleIcon","loadRoles","roles","roleMap","showConfig","generateQuestions","countVal","countEl","showRiskModal","isEdit","isView","riskDesc","riskProb","riskCreated","riskOwner","impactEl","probEl","contentText","ownerEl","mitigationEl","owner","riskData","iso","getScoreColor","getRiskEventIcon","getRiskEventDescription","ev","actor","changes","toStr","fromStr","createRiskDetailView","viewContent","editForm","cancelEditBtn","contentEl","likelihoodEl","statusEl","deleteInEditBtn","ownerPickerTrigger","ownerPickerDropdown","ownerPickerValue","ownerHiddenInput","ownerPickerList","ownerPickerSearch","editFormContacts","renderOwnerPickerList","filter","filtered","editAiSuggestBtn","editSuggestionsPanel","mitigation","roleOrReason","assignBtn","applyMitigationBtn","h","lastMitigation","suggestionsPanel","docLink","timelineEl","viewContacts","riskContactPicker","riskContactList","riskContactSearch","renderRiskContactGrid","getContactPhotoUrl","showRiskPicker","wasHidden","changeOwnerBtn","findContactByOwner","byExact","byPartial","byAlias","aLower","u","roleEl","avatarEl","img","riskDetailProps","createRisksPanel","updatedRisk","currentSearch","showMatrix","lastLoadedRisks","loadRisks","searchTimeout","matrixBtn","matrixContainer","risksToShow","renderRiskMatrix","refreshRemovedSection","deleted","truncate","restoreBtn","filterRisksBySearch","lower","renderRisksBySource","renderRisks","byStatus","statuses","createRiskCard","bindRiskCards","bySource","src","IMPACT_BAR_COLOR","barColor","ownerChipHtml","sourceChip","activeRisks","getSeverity","impactLevel","likelihoodLevel","counts","severity","total","mitigated","getPercent","conicStops","currentDeg","colors","level","degrees","getSprints","getSprint","createSprint","generateSprintTasks","applySprintGeneration","getSprintReport","analyzeSprintReport","getSprintBusinessReport","generateSprintReportDocument","generateSprintReportPresentation","taskText","dueDateText","createdText","parentStoryRef","sizeEstimate","descriptionText","dodList","acList","showActionModal","due","dod","ac","dodStr","acStr","completeBtn","contentVal","parentStoryIdEl","dependsOnEl","parentStoryId","dependsOn","cardEl","cid","stories","parentSelect","sprints","sprintSelect","depSelect","currentId","newStoryBtn","pointsInput","story_points","story","editStoryBtn","storyId","newTitle","runGenerateFromDraft","btnLabel","parentRef","genBtn","regenBtn","requesterTrigger","requesterDropdown","requesterValue","requesterList","requesterSearch","requesterContactIdInput","requesterNameInput","requesterContacts","renderRequesterList","closeRequesterDropdown","removed","removeListeners","clickHandler","keyHandler","showCreateSprintModal","onSuccess","createdSprint","proposedNewTasks","existingActionIds","existingCheckboxes","getVal","step2","applyBtn","start_date","end_date","existingDetails","newList","existingList","checked","selectedExisting","STATUS_COLORS","capitalize","createBreakdownChart","byAssignee","height","showAssignee","statusEntries","assigneeEntries","chartId","statusCanvas","statusLabels","statusValues","statusKeys","initBarChart","assigneeCanvas","palette","canvas","labels","colorFn","renderFallbackBars","Chart","max","bars","label","pct","color","wrap","showSprintReportModal","sprintName","reportData","loadReport","loading","errEl","report","summaryEl","pointsLine","chartEl","listEl","exportReportAsPdf","sprint","aiEl","bizEl","aiHtml","bizHtml","w","exportPdfBtn","docOptions","pptOptions","docBtn","pptBtn","isDoc","openHtmlInNewTab","forPdf","printScript","style","includeAnalysis","includeBusiness","aiContent","bizContent","createCommentsThread","submitComment","loadComments","comments","renderComments","thread","topLevel","replies","repliesByParent","comment","renderComment","bindCommentEvents","isOwn","replyForm","selectState","selectCurrentProject","getActionEventIcon","getActionEventDescription","textFields","normalizeDefinitionOfDone","getDescriptionBodyHtml","_assigneeStr","dlParts","dlHtml","descHtml","dodHtml","acHtml","createActionDetailView","onDecisionClick","currentAction","task","assignee","refineAiBtn","userInput","refreshDescriptionAndTimeline","bindDodToggles","bodyEl","li","previousDone","renderTimeline","hasRestore","snapshotAttr","originalText","taskEl","refreshDecisionSection","displayEl","linkBtn","unlinkBtn","commentsMount","commentsThread","similarMount","chosen","pickerEl","renderDecisionList","previousAction","decisionTitle","newLink","assigneePickerTrigger","assigneePickerDropdown","assigneePickerValue","assigneeHiddenInput","assigneePickerList","assigneePickerSearch","renderAssigneePickerList","requesterPickerTrigger","requesterPickerDropdown","requesterPickerValue","requesterPickerList","requesterPickerSearch","renderRequesterPickerList","editAssigneeHiddenInput","editAssigneePickerValue","suggested_assignees","findContactByAssignee","priorityEl","assigneeEl","dueEl","requesterContactIdEl","requesterNameEl","doDelete","docId","actionContactPicker","actionContactList","actionContactSearch","renderActionContactGrid","previousAssignee","assignmentCard","chgBtn","showActionPicker","pickBtn","findContactByRequester","byId","requesterDisplay","requesterContact","actionDetailProps","createActionsPanel","updatedAction","currentSprintId","currentViewMode","loadActions","createSprintBtn","refreshRemovedActionsSection","refreshReportStrip","refreshSprintDetailHeader","reportBtn","strip","bySprint","sprintParts","sprintFilter","renderGroupedBySprint","renderGroupedByStory","renderActions","noSprint","sid","sprintList","groupActions","createGroupSection","noSprintSection","byStory","noStory","noStorySection","onHeaderClick","renderActionCards","findContactById","priorityBarColor","buildActionCardHtml","bindActionCards","priority","assigneeChipHtml","requestedBy","requestedByContactId","requesterChipHtml","dueChip","reload","viewLink","showDecisionModal","decision","viewImpact","viewSummary","modalContacts","renderMadeByDisplay","madeBy","madeByDisplay","madeByInput","chooseBtn","showModalPicker","modalPicker","renderModalContactGrid","modalContactSearch","modalContactList","currentMadeBy","decisionContent","decisionImpact","decisionSummary","hintEl","approveBtn","rejectBtn","updateStatus","decisionData","apiPayload","createDecisionDetailView","onActionClick","renderEditFormOwnerDisplay","currentOwnerName","rationaleEl","madeByEl","viewContentText","viewRationale","statusBadge","badges","impactPill","oldPill","currentOwnerEl","chBtn","showOwnerPicker","ownerPicker","ownerList","ownerSearch","renderOwnerContactGrid","currentEl","showOwnerPickerBtn","editOwnerDisplay","editMadeByInput","editContactPicker","editContactList","editContactSearch","showEditOwnerPicker","renderEditFormContactGrid","ownerAiSuggestBtn","ownerSuggestionsPanel","suggested_owners","rationaleAiSuggestBtn","actorLabel","similarEl","implementingTasksEl","actionId","decisionDetailProps","createDecisionsPanel","clickedDecision","loadDecisions","checkConflictsBtn","checkConflicts","conflicts","createConflictCard","bindConflictCards","keepId","discardId","filterDecisionsBySearch","renderDecisionsBySource","renderDecisions","createDecisionCard","bindDecisionCards","STATUS_BAR_COLOR","createFactDetailView","onFactClick","verifyFactBtn","verifyBtn","showFactModal","FactModal","CATEGORIES","factDetailProps","createFactsPanel","clickedFact","loadFacts","conflictsBtn","showAddFactModal","categoryFilter","rawFacts","renderFactsBySource","renderFacts","refreshRemovedFactsSection","conflictsContainer","emptyAddBtn","factsByCategory","catFacts","createFactCard","newPanel","CATEGORY_BAR_COLOR","categoryClass","confidencePct","renderConflicts","conflict","keepLeftBtn","keepRightBtn","resolveConflict","keep","toDelete","toKeep","createStatsCard","trendHtml","getTrendArrow","direction","updateStatsCard","subValue","valueEl","subEl","createStatsGrid","grid","stat","createHealthIndicator","showFactors","indicator","createHealthBadge","getHealthColor","getHealthStatus","METRIC_COLORS","createTrendChart","metrics","initChart","renderFallbackChart","datasets","metric","maxValue","IMPACTS","LIKELIHOODS","CELL_COLORS","createRiskMatrix","onCellClick","groupRisksByCell","cellRisks","cell","createRiskSummary","summary","bySeverity","fileQueue","createFileUploader","allowedTypes","maxFileSize","multiple","uploader","dropzone","fileInput","queueContainer","actionsContainer","statusContainer","addFilesToQueue","updateQueueUI","uploadBtn","checkProcessingStatus","maxSize","qf","getFileIcon","pendingFiles","progress","pollProcessingStatus","renderProcessingStatus","pollingInterval","mimeType","NODE_COLORS","createKnowledgeGraph","initGraph","graphContainer","statsContainer","loadStats","network","createVisNetwork","bindToolbarEvents","visNodes","getNodeSize","visEdges","showNodeDetails","connections","matchingNode","refreshBtn","fitBtn","detailsContainer","renderStats","createTimeline","daysSelect","loadTimeline","filterBtns","filterEvents","groupByDate","dayEvents","formatTime","visibleEvents","currentQuery","selectedIndex","TYPE_ICONS","initGlobalSearch","createSearchModal","toggleSearch","backdrop","resultsContainer","closeSearch","debounceSearch","handleKeydown","openSearch","updateSelection","selectResult","performSearch","renderResults","performLocalSearch","groupByType","items","navigateToResult","selectedIds","createBulkActionsBar","bar","getActionsForType","clearSelection","updateBar","bindActionButtons","common","performBulkAction","operation","endpoint","toggleSelection","selectItem","deselectItem","getSelectedIds","isSelected","createBulkCheckbox","createSyncStatus","loadSyncDetails","checkSyncStatus","updateIndicator","infoContainer","deadLettersContainer","deadLetters","dl","createSyncIndicator","checkMiniStatus","dot","CommandPaletteComponent","searchIcon","navItem","lastSection","sectionTitle","instance","initCommandPalette","S","isValidUrl","renderBreadcrumbs","initCompaniesPanel","contentWrapper","renderList","breadcrumbsContainer","analyzedAt","analyzed","analyzeLabel","analyzedBadge","loadList","showListView","bindListEvents","showForm","company","crumbs","listLink","fd","logoUrl","websiteUrl","linkedinUrl","templatesBtn","showTemplateEditor","currentType","activeTab","links","editor","loadBtn","iframe","themeList","codeTabBtn","themeTabBtn","codeTab","themeTab","processTemplateForPreview","processed","primary","secondary","mockData","updatePreview","rawHtml","processedHtml","debounceTimer","extractAndRenderTheme","switchTab","styleMatch","rootMatch","cleanContent","varRegex","match","vars","isColor","inputs","newVal","updateVariable","css","re","setType","REPORT_SECTION_LABELS","showDetailView","ba","hasReport","identityKey","otherKeys","activeSectionKey","logoBlock","baPrimary","baSecondary","colorBlock","cleanLabel","reanalyzeBtn","contentArea","sidebarItems","renderActiveContent","rawText","formattedText","span","analyzeBtn","detailBtn","origText","getSettingsMarkup","currentTheme","initialTab","pageMode","closeButtonHtml","showSettingsModal","modalOverlay","bindSettingsEvents","onSaveSuccess","companiesSection","closeButton","isOverlay","closeAction","manageCompaniesButton","companiesTab","targetSection","themeSelect","currentSteps","cancelCallback","showProcessingModal","steps","onCancel","allowCancel","renderContent","createFooter","step","renderStep","calculateOverallProgress","statusIcon","completed","running","runningProgress","closeProcessingModal","updateProcessingStep","stepId","stepIndex","addProcessingStep","setProcessingSteps","isProcessingModalOpen","currentMode","otpEmail","resendCooldown","resendTimer","showAuthModal","renderAuthContent","getTitle","firstInput","renderLoginForm","renderRegisterForm","renderForgotForm","renderResetForm","renderOTPRequestForm","renderOTPVerifyForm","renderEmailConfirmForm","handleLogin","bindModeLinks","passwordInput","updatePasswordStrength","handleRegister","handleForgot","handleReset","handleOTPRequest","maskedEmail","hiddenInput","resendBtn","setupOTPInputs","startResendCooldown","handleResendCode","handleOTPVerify","handleEmailConfirm","updateHiddenValue","digits","inp","digit","errorEl","setFormLoading","hideError","showError","responseData","username","displayName","btnText","btnLoading","elementId","strengthEl","strength","calculatePasswordStrength","closeAuthModal","showCompaniesModal","listViewBodyHtml","aiContext","primaryColor","secondaryColor","reportSectionKeys","reportHtml","currentContact","contactProjects","contactRelations","contactActivity","allProjects","roleTemplates","showContactModal","loadContactData","loadRoleTemplates","loadAllProjects","loadTimezones","bindEvents","hasPhoto","projectsRes","relationsRes","activityRes","allProjectsRes","timezonesRes","timezones","renderTimezoneDropdown","renderRoleDropdown","renderProjectsList","renderRelationsList","renderActivityTimeline","updateTabCounts","tzSelect","currentTz","tz","region","sortedRegions","isCustomRole","listContainer","associatedIds","relation","formatRelationType","timeline","activity","projectsCount","relationsCount","customRoleInput","tagsInput","tags","aliasesInput","aliases","contactData","selectedProjects","savedContactId","enrichBtn","addRelationBtn","showAddRelationDialog","orgInput","headerName","headerOrg","avatar","avatarUrlInput","avatarContainer","currentName","parentContainer","availableContacts","contactSelect","typeSelect","toContactId","relationType","diffDays","currentMembers","showTeamModal","onInvite","onRemove","onRoleChange","renderMembers","renderMemberCard","removeBtn","isSuperadmin","cachedMembers","onInviteSent","selectedContact","sendBtn","btnAddDirect","btnSendInvite","generateInviteLink","tabBtns","loadContacts","copyBtn","linkInput","loadProjectMembers","onSelect","linkedContactIds","hasEmail","subtitle","defaultPermissions","showRoleModal","availablePermissions","formatPermission","rolePermissions","selectAll","selectNone","roleData","permission","word","showExportModal","defaultFormat","defaultScope","group","exportBtn","scope","performExport","getContentType","createBlob","getExtension","uploadQueue","isUploading","sprintsList","actionsList","selectedSprintId","selectedActionId","showFileUploadModal","accept","onUpload","render","sprintOptions","actionOptions","renderFileItem","bindDropZone","bindFileItems","bindSprintTaskSelectors","dropZone","addFiles","dt","fileId","loadSprints","loadActionsForSprint","actionSelect","rerender","showDeveloperModal","renderTabContent","bindActions","renderInfoTab","renderLogsTab","renderCacheTab","renderApiTab","appState","dataState","uiState","getMemoryUsage","totalSize","acc","formatBytes","testApi","method","bodyText","responseEl","elapsed","perf","sizes","shortcutGroups","showShortcutsModal","registeredShortcuts","notifications","showNotificationsModal","markAllBtn","unreadCount","renderNotification","notification","getNotificationIcon","showEmailModal","onSend","isReply","replyTo","replySubject","zone","preview","replyBtn","forwardBtn","to","cc","subject","emailData","registerChart","chart","getChart","destroyChart","updateChartData","registerNetwork","getNetwork","destroyNetwork","setActiveChart","getChartIds","getNetworkIds","destroyAll","chartsStore","showGraphModal","onNodeClick","onEdgeClick","getUniqueTypes","getTypeColor","initializeGraph","bindControls","vis","edge","types","page","hasMore","showHistoryModal","onRestore","loadHistory","renderEntry","loadMoreBtn","entryId","changesEl","actionIcons","actionColors","hasChanges","change","formatValue","showCommentModal","entityName","onCommentAdded","bindCommentActions","isAuthor","findComment","replyContainer","replyInput","newText","removeComment","found","currentProfile","cachedTimezones","showProfileModal","loadProfile","bindOptions","apiProfile","renderProfile","generateFallbackAvatar","generateTimezoneOptions","loadSessions","loadKrispIntegration","avatarInput","avatarDisplay","profileForm","passwordForm","currentPassword","newPassword","confirmPassword","deleteAccountBtn","revokeAllBtn","sessions","session","regionOrder","aIdx","bIdx","diff","isSuperAdmin","krispService.getWebhook","krispService.getTranscriptsSummary","enableBtn","toggleSecretBtn","secretInput","mcpImportBtn","showKrispManager","toggleBtn","newState","krispService.toggleWebhook","regenerateBtn","krispService.regenerateWebhook","viewTranscriptsBtn","closeProfileModal","initProfilePage","isViewMode","savedFact","verifiedFact","closeFactModal","currentBriefing","showHistory","createBriefingPanel","loadBriefing","historyBtn","historyContainer","briefing","renderBriefing","renderMarkdown","history","historyItem","showHistoryDetail","backBtn","createNotificationsDropdown","trigger","toggleDropdown","loadNotifications","updateBadge","loadUnreadCount","renderNotifications","getIcon","initNotificationsDropdown","createMembersPanel","loadMembers","loadPendingInvites","members","invites","invite","ErrorBoundary","setAnalyzing","analyzing","setProfiles","profiles","setSelectedProfile","setTeamAnalysis","analysis","setRelationships","relationships","setGraphData","setSubtab","subtab","loadProfiles","personId","analyzeProfile","updatedProfiles","loadTeamAnalysis","analyzeTeam","forceReanalysis","loadRelationships","loadGraphData","loadAll","teamAnalysisStore","tabName","questionsRes","risksRes","actionsRes","decisionsRes","undo","redo","initLegacyBridge","startViewTransition","registerShortcuts","configureApiClient","initializeUI","updateThemeButton","userAvatar","userDropdown","loginBtn","components.showAuthModal","updateAuthUI","refreshData","clearProjectScopedState","updateDashboard","components.showShortcutsModal","devToolsBtn","components.showDeveloperModal","profileBtn","notificationsContainer","sotTabs","loadSotContent","menuToggle","newContactBtn","components.showContactModal","components.showFileUploadModal","initializeSidebarActions","newProjectBtn","editProjectBtn","showNoProjectState","contactsSubtabs","refreshDashboardBtn","initializePanels","initializeDropZones","dashboardContainer","refreshDashboardPanel","createDashboard","statId","chatContainer","createChat","emailsContainer","createEmailsPanel","contactsContainer","createContactsPanel","teamsContainer","createTeamsPanel","rolesContainer","renderRolesPanel","filesContainer","createDocumentsPanel","showDocumentPreviewModal","orgChartContainer","createOrgChart","costsContainer","createCostsDashboard","createHistoryPanel","exportHistory","dropzones","showEmailComposer","showConversationComposer","showTranscriptComposer","handleDroppedFiles","dataTransfer","addPendingFiles","fileNames","VALID_TABS","getTabFromUrl","updateUrlForTab","replace","newPath","initRouting","updateUrl","profileContainer","ProfileModal","projectsContainer","initProjectsPage","settingsContainer","initSettingsPage","adminContainer","initAdminPanel","hasContent","createGraphExplorer","explorer","timelineContainer","createTimelinePanel","QuestionDetailView$1","teamAnalysisContainer","createTeamAnalysis","setupTeamAnalysisSubtabs","teamAnalysisStore2","teamAnalysis","firstOrDefault","base","statsGrid","dashboardContent","activeQuestions","questionsPanel","factsPanel","decisionsPanel","risksPanel","actionsPanel","updatePendingFilesUI","processBtn","exportKnowledgeBtn","knowledge","exportKnowledgeClipboard","exportQuestionsBtn","exportQuestionsClipboard","copyOverdueBtn","overdueActions","dueDate","overdueQuestions","createdAt","overdue","cleanOrphanBtn","components.confirm","resetDataBtn","authBlocker","adminNavBtn","fallbackAvatar","components"],"ignoreList":[26,35,36,37,38,39,40,41,42,43,44,45,46,47,48,49,50,51],"sources":["../../frontend/src/services/theme.ts","../../frontend/src/services/toast.ts","../../frontend/src/services/api.ts","../../frontend/src/services/storage.ts","../../frontend/src/services/shortcuts.ts","../../frontend/src/services/undo.ts","../../frontend/src/stores/app.ts","../../frontend/src/services/auth.ts","../../frontend/src/stores/data.ts","../../frontend/src/services/projects.ts","../../frontend/src/services/companies.ts","../../frontend/src/services/dashboard.ts","../../frontend/src/services/questions.ts","../../frontend/src/services/risks.ts","../../frontend/src/services/actions.ts","../../frontend/src/services/decisions.ts","../../frontend/src/services/chat.ts","../../frontend/src/services/contacts.ts","../../frontend/src/services/documents.ts","../../frontend/src/services/emails.ts","../../frontend/src/services/graph.ts","../../frontend/src/services/notifications.ts","../../frontend/src/services/settings.ts","../../frontend/src/services/profile.ts","../../frontend/src/services/facts.ts","../../frontend/src/services/krisp.ts","../../../node_modules/dompurify/dist/purify.es.mjs","../../frontend/src/lib/dom.ts","../../frontend/src/components/ThemeToggle.ts","../../frontend/src/stores/ui.ts","../../frontend/src/components/Header.ts","../../frontend/src/components/Sidebar.ts","../../frontend/src/components/Toast.ts","../../frontend/src/components/Modal.ts","../../frontend/src/components/modals/MemberPermissionsModal.ts","../../../node_modules/zod/v4/core/core.js","../../../node_modules/zod/v4/core/util.js","../../../node_modules/zod/v4/core/errors.js","../../../node_modules/zod/v4/core/parse.js","../../../node_modules/zod/v4/core/regexes.js","../../../node_modules/zod/v4/core/checks.js","../../../node_modules/zod/v4/core/doc.js","../../../node_modules/zod/v4/core/versions.js","../../../node_modules/zod/v4/core/schemas.js","../../../node_modules/zod/v4/core/registries.js","../../../node_modules/zod/v4/core/api.js","../../../node_modules/zod/v4/core/to-json-schema.js","../../../node_modules/zod/v4/core/json-schema-processors.js","../../../node_modules/zod/v4/classic/iso.js","../../../node_modules/zod/v4/classic/errors.js","../../../node_modules/zod/v4/classic/parse.js","../../../node_modules/zod/v4/classic/schemas.js","../../frontend/schemas/project.ts","../../frontend/src/components/modals/ProjectModal.ts","../../frontend/src/components/ProjectSelector.ts","../../frontend/src/lib/format.ts","../../frontend/src/components/modals/QuestionModal.ts","../../frontend/src/components/questions/QuestionDetailView.ts","../../frontend/src/components/sot/QuestionsPanel.ts","../../frontend/src/components/modals/RiskModal.ts","../../frontend/src/components/risks/RiskDetailView.ts","../../frontend/src/components/sot/RisksPanel.ts","../../frontend/src/services/sprints.ts","../../frontend/src/components/modals/ActionModal.ts","../../frontend/src/components/sprints/CreateSprintModal.ts","../../frontend/src/components/widgets/BreakdownChart.ts","../../frontend/src/components/sprints/SprintReportModal.ts","../../frontend/src/components/CommentsThread.ts","../../frontend/src/stores/selectors.ts","../../frontend/src/components/actions/ActionDetailView.ts","../../frontend/src/components/sot/ActionsPanel.ts","../../frontend/src/components/modals/DecisionModal.ts","../../frontend/src/components/decisions/DecisionDetailView.ts","../../frontend/src/components/sot/DecisionsPanel.ts","../../frontend/src/components/facts/FactDetailView.ts","../../frontend/src/components/sot/FactsPanel.ts","../../frontend/src/components/widgets/StatsCard.ts","../../frontend/src/components/widgets/HealthIndicator.ts","../../frontend/src/components/widgets/TrendChart.ts","../../frontend/src/components/widgets/RiskMatrix.ts","../../frontend/src/components/FileUploader.ts","../../frontend/src/components/KnowledgeGraph.ts","../../frontend/src/components/Timeline.ts","../../frontend/src/components/GlobalSearch.ts","../../frontend/src/components/BulkActions.ts","../../frontend/src/components/SyncStatus.ts","../../frontend/src/components/CommandPalette.ts","../../frontend/src/components/settings/CompaniesPanel.ts","../../frontend/src/components/modals/SettingsModal.ts","../../frontend/src/components/modals/ProcessingModal.ts","../../frontend/src/components/modals/AuthModal.ts","../../frontend/src/components/modals/CompaniesModal.ts","../../frontend/src/components/modals/ContactModal.ts","../../frontend/src/components/modals/TeamModal.ts","../../frontend/src/components/modals/InviteModal.ts","../../frontend/src/components/modals/RoleModal.ts","../../frontend/src/components/modals/ExportModal.ts","../../frontend/src/components/modals/FileUploadModal.ts","../../frontend/src/components/modals/DeveloperModal.ts","../../frontend/src/components/modals/ShortcutsModal.ts","../../frontend/src/components/modals/NotificationsModal.ts","../../frontend/src/components/modals/EmailModal.ts","../../frontend/src/stores/charts.ts","../../frontend/src/components/modals/GraphModal.ts","../../frontend/src/components/modals/HistoryModal.ts","../../frontend/src/components/modals/CommentModal.ts","../../frontend/src/components/modals/ProfileModal.ts","../../frontend/src/components/modals/FactModal.ts","../../frontend/src/components/BriefingPanel.ts","../../frontend/src/components/NotificationsDropdown.ts","../../frontend/src/components/MembersPanel.ts","../../frontend/src/components/ErrorBoundary.ts","../../frontend/src/stores/teamAnalysis.ts","../../frontend/src/lib/legacy-bridge.ts","../../frontend/src/lib/transitions.ts","../../frontend/src/main.ts"],"sourcesContent":["/**\r\n * Theme Service\r\n * Manages dark/light/system theme with auto-detection\r\n */\r\n\r\nexport type ThemeMode = 'light' | 'dark' | 'system';\r\nexport type EffectiveTheme = 'light' | 'dark';\r\n\r\nclass ThemeService {\r\n  private mode: ThemeMode;\r\n  private listeners: Set<(theme: EffectiveTheme) => void> = new Set();\r\n  private mediaQuery: MediaQueryList;\r\n\r\n  constructor() {\r\n    this.mode = this.getSavedTheme();\r\n    this.mediaQuery = window.matchMedia('(prefers-color-scheme: light)');\r\n    this.apply();\r\n    this.watchSystemChanges();\r\n  }\r\n\r\n  /**\r\n   * Get saved theme from localStorage or default to 'system'\r\n   */\r\n  private getSavedTheme(): ThemeMode {\r\n    const saved = localStorage.getItem('theme');\r\n    if (saved === 'light' || saved === 'dark' || saved === 'system') {\r\n      return saved;\r\n    }\r\n    return 'system';\r\n  }\r\n\r\n  /**\r\n   * Get the system's preferred color scheme\r\n   */\r\n  private getSystemTheme(): EffectiveTheme {\r\n    return this.mediaQuery.matches ? 'light' : 'dark';\r\n  }\r\n\r\n  /**\r\n   * Watch for system theme changes\r\n   */\r\n  private watchSystemChanges(): void {\r\n    this.mediaQuery.addEventListener('change', () => {\r\n      if (this.mode === 'system') {\r\n        this.apply();\r\n      }\r\n    });\r\n  }\r\n\r\n  /**\r\n   * Get the effective theme (resolving 'system' to actual theme)\r\n   */\r\n  getEffective(): EffectiveTheme {\r\n    if (this.mode === 'system') {\r\n      return this.getSystemTheme();\r\n    }\r\n    return this.mode;\r\n  }\r\n\r\n  /**\r\n   * Get the current mode setting\r\n   */\r\n  getMode(): ThemeMode {\r\n    return this.mode;\r\n  }\r\n\r\n  /**\r\n   * Apply the current theme to the document\r\n   */\r\n  apply(): void {\r\n    const effective = this.getEffective();\r\n    document.documentElement.setAttribute('data-theme', effective);\r\n    \r\n    // Notify listeners\r\n    this.listeners.forEach(fn => fn(effective));\r\n  }\r\n\r\n  /**\r\n   * Set theme mode directly\r\n   */\r\n  set(mode: ThemeMode): void {\r\n    this.mode = mode;\r\n    localStorage.setItem('theme', mode);\r\n    this.apply();\r\n  }\r\n\r\n  /**\r\n   * Cycle through themes: light -> dark -> system -> light\r\n   */\r\n  cycle(): ThemeMode {\r\n    const modes: ThemeMode[] = ['light', 'dark', 'system'];\r\n    const currentIndex = modes.indexOf(this.mode);\r\n    const nextIndex = (currentIndex + 1) % modes.length;\r\n    this.set(modes[nextIndex]);\r\n    return this.mode;\r\n  }\r\n\r\n  /**\r\n   * Toggle between light and dark (ignores system)\r\n   */\r\n  toggle(): EffectiveTheme {\r\n    const effective = this.getEffective();\r\n    const newTheme: EffectiveTheme = effective === 'dark' ? 'light' : 'dark';\r\n    this.set(newTheme);\r\n    return newTheme;\r\n  }\r\n\r\n  /**\r\n   * Subscribe to theme changes\r\n   */\r\n  onChange(callback: (theme: EffectiveTheme) => void): () => void {\r\n    this.listeners.add(callback);\r\n    return () => this.listeners.delete(callback);\r\n  }\r\n\r\n  /**\r\n   * Get icon for current theme mode\r\n   */\r\n  getIcon(): string {\r\n    switch (this.mode) {\r\n      case 'light': return '';\r\n      case 'dark': return '';\r\n      case 'system': return '';\r\n    }\r\n  }\r\n\r\n  /**\r\n   * Get label for current theme mode\r\n   */\r\n  getLabel(): string {\r\n    switch (this.mode) {\r\n      case 'light': return 'Light';\r\n      case 'dark': return 'Dark';\r\n      case 'system': return 'System';\r\n    }\r\n  }\r\n}\r\n\r\n// Export singleton instance\r\nexport const theme = new ThemeService();\r\n\r\n// Export class for testing\r\nexport { ThemeService };\r\n","/**\r\n * SOTA Toast Service\r\n * Replaces basic alerts with a stacked, animated toast system\r\n */\r\n\r\nexport type ToastType = 'success' | 'error' | 'warning' | 'info';\r\n\r\ninterface ToastOptions {\r\n  duration?: number;\r\n  title?: string;\r\n  action?: {\r\n    label: string;\r\n    onClick: () => void;\r\n  };\r\n}\r\n\r\nconst ICONS = {\r\n  success: `<svg class=\"w-5 h-5 text-green-500\" fill=\"none\" viewBox=\"0 0 24 24\" stroke=\"currentColor\"><path stroke-linecap=\"round\" stroke-linejoin=\"round\" stroke-width=\"2\" d=\"M5 13l4 4L19 7\"/></svg>`,\r\n  error: `<svg class=\"w-5 h-5 text-red-500\" fill=\"none\" viewBox=\"0 0 24 24\" stroke=\"currentColor\"><path stroke-linecap=\"round\" stroke-linejoin=\"round\" stroke-width=\"2\" d=\"M6 18L18 6M6 6l12 12\"/></svg>`,\r\n  warning: `<svg class=\"w-5 h-5 text-yellow-500\" fill=\"none\" viewBox=\"0 0 24 24\" stroke=\"currentColor\"><path stroke-linecap=\"round\" stroke-linejoin=\"round\" stroke-width=\"2\" d=\"M12 9v2m0 4h.01m-6.938 4h13.856c1.54 0 2.502-1.667 1.732-3L13.732 4c-.77-1.333-2.694-1.333-3.464 0L3.34 16c-.77 1.333.192 3 1.732 3z\"/></svg>`,\r\n  info: `<svg class=\"w-5 h-5 text-blue-500\" fill=\"none\" viewBox=\"0 0 24 24\" stroke=\"currentColor\"><path stroke-linecap=\"round\" stroke-linejoin=\"round\" stroke-width=\"2\" d=\"M13 16h-1v-4h-1m1-4h.01M21 12a9 9 0 11-18 0 9 9 0 0118 0z\"/></svg>`\r\n};\r\n\r\nlet container: HTMLElement | null = null;\r\nconst TOAST_LIMIT = 5;\r\n\r\nfunction ensureContainer() {\r\n  if (!container) {\r\n    container = document.createElement('div');\r\n    container.className = 'toast-container';\r\n    document.body.appendChild(container);\r\n  }\r\n  return container;\r\n}\r\n\r\nexport const toast = {\r\n  show(message: string, type: ToastType = 'info', options: ToastOptions = {}) {\r\n    const root = ensureContainer();\r\n    const duration = options.duration || 4000;\r\n\r\n    // Limit visible toasts\r\n    if (root.children.length >= TOAST_LIMIT) {\r\n      const first = root.firstElementChild;\r\n      if (first) {\r\n        first.classList.add('toast-leaving');\r\n        setTimeout(() => first.remove(), 200);\r\n      }\r\n    }\r\n\r\n    const el = document.createElement('div');\r\n    el.className = `toast-sota ${type}`;\r\n    el.innerHTML = `\r\n      <div class=\"toast-icon\">${ICONS[type]}</div>\r\n      <div class=\"toast-content\">\r\n        ${options.title ? `<div class=\"toast-title\">${options.title}</div>` : ''}\r\n        <p class=\"toast-message\">${message}</p>\r\n      </div>\r\n      <button class=\"toast-close\" aria-label=\"Close\">\r\n        <svg width=\"14\" height=\"14\" viewBox=\"0 0 24 24\" fill=\"none\" stroke=\"currentColor\" stroke-width=\"2\"><path d=\"M18 6L6 18M6 6l12 12\"/></svg>\r\n      </button>\r\n    `;\r\n\r\n    // Close Handler\r\n    const closeBtn = el.querySelector('.toast-close');\r\n    const close = () => {\r\n      el.classList.add('toast-leaving');\r\n      setTimeout(() => {\r\n        if (el.parentElement) el.remove();\r\n      }, 200);\r\n    };\r\n    closeBtn?.addEventListener('click', close);\r\n\r\n    // Auto dismiss\r\n    if (duration > 0) {\r\n      setTimeout(close, duration);\r\n    }\r\n\r\n    root.appendChild(el);\r\n  },\r\n\r\n  success(message: string, options?: ToastOptions) {\r\n    this.show(message, 'success', options);\r\n  },\r\n\r\n  error(message: string, options?: ToastOptions) {\r\n    this.show(message, 'error', options);\r\n  },\r\n\r\n  warning(message: string, options?: ToastOptions) {\r\n    this.show(message, 'warning', options);\r\n  },\r\n\r\n  info(message: string, options?: ToastOptions) {\r\n    this.show(message, 'info', options);\r\n  }\r\n};\r\n","/**\r\n * API Service\r\n * Centralized HTTP client with error handling\r\n */\r\n\r\nimport { toast } from './toast';\r\n\r\nlet getCurrentProjectId: (() => string | null) | null = null;\r\nexport function setProjectIdGetter(getter: () => string | null): void {\r\n  getCurrentProjectId = getter;\r\n}\r\n\r\nexport interface ApiResponse<T = unknown> {\r\n  data: T;\r\n  ok: boolean;\r\n  status: number;\r\n  statusText: string;\r\n}\r\n\r\n/**\r\n * API client configuration\r\n */\r\ninterface ApiConfig {\r\n  baseUrl: string;\r\n  defaultHeaders: Record<string, string>;\r\n  showErrorToasts: boolean;\r\n  timeout: number;\r\n  retryCount: number;\r\n  retryDelay: number;\r\n  onUnauthorized?: () => void;\r\n  onForbidden?: () => void;\r\n}\r\n\r\nconst config: ApiConfig = {\r\n  baseUrl: '',\r\n  defaultHeaders: {\r\n    'Content-Type': 'application/json',\r\n  },\r\n  showErrorToasts: true,\r\n  timeout: 30000, // 30 seconds\r\n  retryCount: 2, // Retry failed requests up to 2 times\r\n  retryDelay: 1000, // Start with 1 second delay\r\n};\r\n\r\n// Request interceptors\r\ntype RequestInterceptor = (options: RequestInit) => RequestInit | Promise<RequestInit>;\r\ntype ResponseInterceptor = (response: ApiResponse<unknown>) => ApiResponse<unknown> | Promise<ApiResponse<unknown>>;\r\n\r\nconst requestInterceptors: RequestInterceptor[] = [];\r\nconst responseInterceptors: ResponseInterceptor[] = [];\r\n\r\n/**\r\n * Add request interceptor\r\n */\r\nexport function addRequestInterceptor(interceptor: RequestInterceptor): () => void {\r\n  requestInterceptors.push(interceptor);\r\n  return () => {\r\n    const index = requestInterceptors.indexOf(interceptor);\r\n    if (index > -1) requestInterceptors.splice(index, 1);\r\n  };\r\n}\r\n\r\n/**\r\n * Add response interceptor\r\n */\r\nexport function addResponseInterceptor(interceptor: ResponseInterceptor): () => void {\r\n  responseInterceptors.push(interceptor);\r\n  return () => {\r\n    const index = responseInterceptors.indexOf(interceptor);\r\n    if (index > -1) responseInterceptors.splice(index, 1);\r\n  };\r\n}\r\n\r\n/**\r\n * Make an API request with proper error handling\r\n */\r\nexport async function api<T = unknown>(\r\n  path: string,\r\n  options: RequestInit = {},\r\n  attempt = 0\r\n): Promise<ApiResponse<T>> {\r\n  const url = `${config.baseUrl}${path}`;\r\n\r\n  // Apply request interceptors\r\n  let finalOptions: RequestInit = {\r\n    ...options,\r\n    headers: {\r\n      ...config.defaultHeaders,\r\n      ...options.headers,\r\n    },\r\n  };\r\n\r\n  for (const interceptor of requestInterceptors) {\r\n    finalOptions = await interceptor(finalOptions);\r\n  }\r\n\r\n  // Per-request timeout (optional); do not pass timeout to fetch\r\n  const optsWithTimeout = finalOptions as RequestInit & { timeout?: number };\r\n  const timeoutMs = optsWithTimeout.timeout ?? config.timeout;\r\n  delete (finalOptions as RequestInit & { timeout?: number }).timeout;\r\n\r\n  // Create abort controller for timeout\r\n  const controller = new AbortController();\r\n  const timeoutId = setTimeout(() => controller.abort(), timeoutMs);\r\n\r\n  try {\r\n    const response = await fetch(url, {\r\n      ...finalOptions,\r\n      signal: controller.signal,\r\n      credentials: 'include', // Include cookies for authentication\r\n    });\r\n\r\n    clearTimeout(timeoutId);\r\n\r\n    const contentType = (response.headers.get('content-type') || '').toLowerCase();\r\n    const text = await response.text();\r\n    let data: T;\r\n    if (contentType.includes('application/json') && text) {\r\n      try {\r\n        data = JSON.parse(text) as T;\r\n      } catch {\r\n        const msg = 'Invalid server response (not JSON). You may be seeing an error page or wrong endpoint.';\r\n        if (config.showErrorToasts) toast.error(msg);\r\n        throw new ApiError(msg, response.status || 0);\r\n      }\r\n    } else {\r\n      data = text as unknown as T;\r\n    }\r\n\r\n    if (!response.ok) {\r\n      // Handle specific HTTP errors\r\n      switch (response.status) {\r\n        case 401:\r\n          if (config.onUnauthorized) {\r\n            config.onUnauthorized();\r\n          }\r\n          break;\r\n        case 403:\r\n          if (config.onForbidden) {\r\n            config.onForbidden();\r\n          }\r\n          break;\r\n        case 429:\r\n          // Rate limited - auto retry with exponential backoff\r\n          if (attempt < 3) {\r\n            const retryAfter = parseInt(response.headers.get('Retry-After') || '5', 10);\r\n            await sleep(retryAfter * 1000);\r\n            return api<T>(path, options, attempt + 1);\r\n          }\r\n          break;\r\n        case 503:\r\n        case 504:\r\n          // Service unavailable - retry\r\n          if (attempt < config.retryCount) {\r\n            await sleep(config.retryDelay * Math.pow(2, attempt));\r\n            return api<T>(path, options, attempt + 1);\r\n          }\r\n          break;\r\n      }\r\n\r\n      const errorMessage = extractErrorMessage(data, response.statusText);\r\n\r\n      if (config.showErrorToasts) {\r\n        toast.error(errorMessage);\r\n      }\r\n\r\n      throw new ApiError(errorMessage, response.status, data);\r\n    }\r\n\r\n    let result: ApiResponse<T> = {\r\n      data,\r\n      ok: true,\r\n      status: response.status,\r\n      statusText: response.statusText,\r\n    };\r\n\r\n    // Apply response interceptors\r\n    for (const interceptor of responseInterceptors) {\r\n      result = await interceptor(result) as ApiResponse<T>;\r\n    }\r\n\r\n    return result;\r\n  } catch (error) {\r\n    clearTimeout(timeoutId);\r\n\r\n    if (error instanceof ApiError) {\r\n      throw error;\r\n    }\r\n\r\n    // Abort error (timeout)\r\n    if (error instanceof DOMException && error.name === 'AbortError') {\r\n      const message = 'Request timed out';\r\n      if (config.showErrorToasts) {\r\n        toast.error(message);\r\n      }\r\n      throw new ApiError(message, 0);\r\n    }\r\n\r\n    // Network or other error - retry if configured\r\n    if (attempt < config.retryCount) {\r\n      await sleep(config.retryDelay * Math.pow(2, attempt));\r\n      return api<T>(path, options, attempt + 1);\r\n    }\r\n\r\n    const rawMessage = error instanceof Error ? error.message : 'Network error';\r\n    const isJsonParseError = rawMessage.includes('JSON') || rawMessage.includes('Unexpected token');\r\n    const message = isJsonParseError\r\n      ? 'Invalid server response. Check that the server is running and the URL is correct.'\r\n      : rawMessage;\r\n    if (config.showErrorToasts) {\r\n      toast.error(`Connection error: ${message}`);\r\n    }\r\n    throw new ApiError(message, 0);\r\n  }\r\n}\r\n\r\n/**\r\n * Extract error message from response data\r\n */\r\nfunction extractErrorMessage(data: unknown, fallback: string): string {\r\n  if (typeof data === 'object' && data !== null) {\r\n    const obj = data as Record<string, unknown>;\r\n    return String(obj.error || obj.message || obj.detail || fallback);\r\n  }\r\n  return fallback || 'Request failed';\r\n}\r\n\r\n/**\r\n * Sleep helper\r\n */\r\nfunction sleep(ms: number): Promise<void> {\r\n  return new Promise(resolve => setTimeout(resolve, ms));\r\n}\r\n\r\n/**\r\n * Custom API Error class\r\n */\r\nclass ApiError extends Error {\r\n  status: number;\r\n  details?: unknown;\r\n\r\n  constructor(message: string, status: number, details?: unknown) {\r\n    super(message);\r\n    this.name = 'ApiError';\r\n    this.status = status;\r\n    this.details = details;\r\n  }\r\n}\r\n\r\n/**\r\n * Convenience methods\r\n */\r\nexport const http = {\r\n  get: <T = unknown>(path: string, options?: RequestInit & { timeout?: number }) =>\r\n    api<T>(path, { ...options, method: 'GET' }),\r\n\r\n  post: <T = unknown>(path: string, body?: unknown, options?: RequestInit & { timeout?: number }) =>\r\n    api<T>(path, {\r\n      ...options,\r\n      method: 'POST',\r\n      body: body ? JSON.stringify(body) : undefined,\r\n    }),\r\n\r\n  put: <T = unknown>(path: string, body?: unknown, options?: RequestInit & { timeout?: number }) =>\r\n    api<T>(path, {\r\n      ...options,\r\n      method: 'PUT',\r\n      body: body ? JSON.stringify(body) : undefined,\r\n    }),\r\n\r\n  patch: <T = unknown>(path: string, body?: unknown, options?: RequestInit & { timeout?: number }) =>\r\n    api<T>(path, {\r\n      ...options,\r\n      method: 'PATCH',\r\n      body: body ? JSON.stringify(body) : undefined,\r\n    }),\r\n\r\n  delete: <T = unknown>(path: string, options?: RequestInit & { timeout?: number }) =>\r\n    api<T>(path, { ...options, method: 'DELETE' }),\r\n};\r\n\r\n/**\r\n * Configure API client\r\n */\r\nexport function configureApi(newConfig: Partial<ApiConfig>): void {\r\n  Object.assign(config, newConfig);\r\n}\r\n\r\nexport { ApiError };\r\n\r\n/**\r\n * Returns headers that include X-Project-Id for project-scoped API calls.\r\n * Use with raw fetch when the response is not JSON (e.g. blob, stream).\r\n */\r\nexport function getProjectHeaders(): Record<string, string> {\r\n  const id = getCurrentProjectId?.() ?? null;\r\n  return id ? { 'X-Project-Id': id } : {};\r\n}\r\n\r\n/**\r\n * fetch with X-Project-Id and credentials for project-scoped endpoints.\r\n * Use instead of raw fetch when the route is project-scoped (e.g. export, upload, graph sync).\r\n */\r\nexport async function fetchWithProject(\r\n  input: RequestInfo | URL,\r\n  init?: RequestInit\r\n): Promise<Response> {\r\n  const headers = new Headers(init?.headers);\r\n  Object.entries(getProjectHeaders()).forEach(([k, v]) => headers.set(k, v));\r\n  return fetch(input, { ...init, headers, credentials: 'include' });\r\n}\r\n","/**\r\n * Storage Service\r\n * Wrapper for localStorage with type safety and JSON handling\r\n */\r\n\r\n/**\r\n * Get item from localStorage with JSON parsing.\r\n * Never throws: returns defaultValue if storage is blocked (e.g. Tracking Prevention) or parse fails.\r\n */\r\nexport function getItem<T>(key: string, defaultValue: T): T {\r\n  try {\r\n    const item = localStorage.getItem(key);\r\n    if (item === null) {\r\n      return defaultValue;\r\n    }\r\n    return JSON.parse(item) as T;\r\n  } catch {\r\n    return defaultValue;\r\n  }\r\n}\r\n\r\n/**\r\n * Set item in localStorage with JSON serialization.\r\n * Never throws: no-op if storage is blocked (e.g. Tracking Prevention).\r\n */\r\nexport function setItem<T>(key: string, value: T): void {\r\n  try {\r\n    localStorage.setItem(key, JSON.stringify(value));\r\n  } catch {\r\n    // Storage blocked or quota exceeded - ignore\r\n  }\r\n}\r\n\r\n/**\r\n * Remove item from localStorage. Never throws; no-op if storage is blocked.\r\n */\r\nexport function removeItem(key: string): void {\r\n  try {\r\n    localStorage.removeItem(key);\r\n  } catch {\r\n    // ignore\r\n  }\r\n}\r\n\r\n/**\r\n * Clear all localStorage. Never throws; no-op if storage is blocked.\r\n */\r\nexport function clear(): void {\r\n  try {\r\n    localStorage.clear();\r\n  } catch {\r\n    // ignore\r\n  }\r\n}\r\n\r\n/**\r\n * Check if key exists in localStorage. Returns false if storage is blocked.\r\n */\r\nexport function hasItem(key: string): boolean {\r\n  try {\r\n    return localStorage.getItem(key) !== null;\r\n  } catch {\r\n    return false;\r\n  }\r\n}\r\n\r\n/**\r\n * Get all keys in localStorage. Returns [] if storage is blocked.\r\n */\r\nexport function getKeys(): string[] {\r\n  try {\r\n    return Object.keys(localStorage);\r\n  } catch {\r\n    return [];\r\n  }\r\n}\r\n\r\n/**\r\n * Storage namespace export\r\n */\r\nexport const storage = {\r\n  get: getItem,\r\n  set: setItem,\r\n  remove: removeItem,\r\n  clear,\r\n  has: hasItem,\r\n  keys: getKeys,\r\n};\r\n","/**\r\n * Keyboard Shortcuts Service\r\n * Manages global keyboard shortcuts\r\n */\r\n\r\nexport interface Shortcut {\r\n  key: string;\r\n  ctrl?: boolean;\r\n  shift?: boolean;\r\n  alt?: boolean;\r\n  meta?: boolean;\r\n  description: string;\r\n  handler: () => void;\r\n}\r\n\r\n// Type for string-based shortcut registration (e.g., 'mod+k', 'ctrl+shift+s')\r\nexport type ShortcutHandler = (event: KeyboardEvent) => void;\r\n\r\nclass ShortcutService {\r\n  private shortcuts: Map<string, Shortcut> = new Map();\r\n  private enabled = true;\r\n  private isMac = typeof navigator !== 'undefined' && /Mac|iPod|iPhone|iPad/.test(navigator.platform);\r\n\r\n  constructor() {\r\n    this.handleKeydown = this.handleKeydown.bind(this);\r\n    document.addEventListener('keydown', this.handleKeydown);\r\n  }\r\n\r\n  /**\r\n   * Parse string shortcut to Shortcut object\r\n   * Supports: 'mod+k' (cmd on Mac, ctrl on others), 'ctrl+shift+s', '/', 'Escape'\r\n   */\r\n  private parseShortcut(shortcutStr: string, handler: ShortcutHandler, description = ''): Shortcut {\r\n    const parts = shortcutStr.toLowerCase().split('+');\r\n    const key = parts.pop() || shortcutStr;\r\n    \r\n    const shortcut: Shortcut = {\r\n      key,\r\n      ctrl: parts.includes('ctrl') || (parts.includes('mod') && !this.isMac),\r\n      shift: parts.includes('shift'),\r\n      alt: parts.includes('alt'),\r\n      meta: parts.includes('meta') || (parts.includes('mod') && this.isMac),\r\n      description,\r\n      handler: () => {\r\n        // Create a synthetic event for backwards compatibility\r\n        const syntheticEvent = new KeyboardEvent('keydown', { key });\r\n        handler(syntheticEvent);\r\n      },\r\n    };\r\n\r\n    return shortcut;\r\n  }\r\n\r\n  /**\r\n   * Generate unique key for shortcut\r\n   */\r\n  private getShortcutKey(shortcut: Omit<Shortcut, 'description' | 'handler'>): string {\r\n    const parts: string[] = [];\r\n    if (shortcut.ctrl) parts.push('ctrl');\r\n    if (shortcut.shift) parts.push('shift');\r\n    if (shortcut.alt) parts.push('alt');\r\n    if (shortcut.meta) parts.push('meta');\r\n    if (shortcut.key) {\r\n      parts.push(shortcut.key.toLowerCase());\r\n    }\r\n    return parts.join('+');\r\n  }\r\n\r\n  /**\r\n   * Handle keydown events\r\n   */\r\n  private handleKeydown(event: KeyboardEvent): void {\r\n    if (!this.enabled) return;\r\n\r\n    // Don't trigger shortcuts when typing in input fields\r\n    const target = event.target as HTMLElement;\r\n    if (target.tagName === 'INPUT' || target.tagName === 'TEXTAREA' || target.isContentEditable) {\r\n      // Allow Escape in input fields\r\n      if (event.key !== 'Escape') {\r\n        return;\r\n      }\r\n    }\r\n\r\n    const key = this.getShortcutKey({\r\n      key: event.key,\r\n      ctrl: event.ctrlKey,\r\n      shift: event.shiftKey,\r\n      alt: event.altKey,\r\n      meta: event.metaKey,\r\n    });\r\n\r\n    const shortcut = this.shortcuts.get(key);\r\n    if (shortcut) {\r\n      event.preventDefault();\r\n      shortcut.handler();\r\n    }\r\n  }\r\n\r\n  /**\r\n   * Register a keyboard shortcut\r\n   * Supports both object format and string format:\r\n   * - Object: { key: 'k', ctrl: true, handler: () => {}, description: 'Search' }\r\n   * - String: register('mod+k', (e) => {}, 'Search')\r\n   */\r\n  register(shortcutOrKey: Shortcut | string, handler?: ShortcutHandler, description?: string): () => void {\r\n    let shortcut: Shortcut;\r\n    \r\n    if (typeof shortcutOrKey === 'string') {\r\n      if (!handler) {\r\n        throw new Error('Handler is required when using string shortcut format');\r\n      }\r\n      shortcut = this.parseShortcut(shortcutOrKey, handler, description || '');\r\n    } else {\r\n      shortcut = shortcutOrKey;\r\n    }\r\n    \r\n    const key = this.getShortcutKey(shortcut);\r\n    this.shortcuts.set(key, shortcut);\r\n    \r\n    // Return unregister function\r\n    return () => this.shortcuts.delete(key);\r\n  }\r\n\r\n  /**\r\n   * Unregister a shortcut by key combination\r\n   */\r\n  unregister(shortcut: Omit<Shortcut, 'description' | 'handler'>): void {\r\n    const key = this.getShortcutKey(shortcut);\r\n    this.shortcuts.delete(key);\r\n  }\r\n\r\n  /**\r\n   * Enable/disable all shortcuts\r\n   */\r\n  setEnabled(enabled: boolean): void {\r\n    this.enabled = enabled;\r\n  }\r\n\r\n  /**\r\n   * Get all registered shortcuts\r\n   */\r\n  getAll(): Shortcut[] {\r\n    return Array.from(this.shortcuts.values());\r\n  }\r\n\r\n  /**\r\n   * Show shortcuts help modal\r\n   */\r\n  showHelp(): void {\r\n    const shortcuts = this.getAll();\r\n    console.log('Keyboard Shortcuts:');\r\n    shortcuts.forEach(s => {\r\n      const parts: string[] = [];\r\n      if (s.ctrl) parts.push('Ctrl');\r\n      if (s.shift) parts.push('Shift');\r\n      if (s.alt) parts.push('Alt');\r\n      if (s.meta) parts.push('Cmd');\r\n      parts.push(s.key.toUpperCase());\r\n      console.log(`  ${parts.join('+')} - ${s.description}`);\r\n    });\r\n  }\r\n\r\n  /**\r\n   * Destroy service and remove event listener\r\n   */\r\n  destroy(): void {\r\n    document.removeEventListener('keydown', this.handleKeydown);\r\n    this.shortcuts.clear();\r\n  }\r\n}\r\n\r\n// Export singleton\r\nexport const shortcuts = new ShortcutService();\r\n\r\n// Export class for testing\r\nexport { ShortcutService };\r\n","/**\r\n * Undo Service\r\n * Manages undo/redo stack for operations\r\n */\r\n\r\nexport interface UndoAction {\r\n  id?: string;\r\n  type?: string;\r\n  description: string;\r\n  undo: () => Promise<void> | void;\r\n  redo?: () => Promise<void> | void;\r\n  timestamp: number;\r\n}\r\n\r\nclass UndoService {\r\n  private undoStack: UndoAction[] = [];\r\n  private redoStack: UndoAction[] = [];\r\n  private maxSize = 50;\r\n  private listeners: Set<() => void> = new Set();\r\n\r\n  /**\r\n   * Push a new action to the undo stack\r\n   */\r\n  push(action: Omit<UndoAction, 'timestamp'>): void {\r\n    this.undoStack.push({\r\n      ...action,\r\n      timestamp: Date.now(),\r\n    });\r\n\r\n    // Clear redo stack on new action\r\n    this.redoStack = [];\r\n\r\n    // Limit stack size\r\n    if (this.undoStack.length > this.maxSize) {\r\n      this.undoStack.shift();\r\n    }\r\n\r\n    this.notify();\r\n  }\r\n\r\n  /**\r\n   * Undo the last action\r\n   */\r\n  async undo(): Promise<boolean> {\r\n    const action = this.undoStack.pop();\r\n    if (!action) return false;\r\n\r\n    try {\r\n      await action.undo();\r\n      this.redoStack.push(action);\r\n      this.notify();\r\n      return true;\r\n    } catch (error) {\r\n      console.error('Undo failed:', error);\r\n      // Put action back on stack\r\n      this.undoStack.push(action);\r\n      return false;\r\n    }\r\n  }\r\n\r\n  /**\r\n   * Redo the last undone action\r\n   */\r\n  async redo(): Promise<boolean> {\r\n    const action = this.redoStack.pop();\r\n    if (!action || !action.redo) return false;\r\n\r\n    try {\r\n      await action.redo();\r\n      this.undoStack.push(action);\r\n      this.notify();\r\n      return true;\r\n    } catch (error) {\r\n      console.error('Redo failed:', error);\r\n      // Put action back on stack\r\n      this.redoStack.push(action);\r\n      return false;\r\n    }\r\n  }\r\n\r\n  /**\r\n   * Check if undo is available\r\n   */\r\n  canUndo(): boolean {\r\n    return this.undoStack.length > 0;\r\n  }\r\n\r\n  /**\r\n   * Check if redo is available\r\n   */\r\n  canRedo(): boolean {\r\n    return this.redoStack.length > 0;\r\n  }\r\n\r\n  /**\r\n   * Get last undoable action description\r\n   */\r\n  getUndoDescription(): string | null {\r\n    const action = this.undoStack[this.undoStack.length - 1];\r\n    return action?.description ?? null;\r\n  }\r\n\r\n  /**\r\n   * Get last redoable action description\r\n   */\r\n  getRedoDescription(): string | null {\r\n    const action = this.redoStack[this.redoStack.length - 1];\r\n    return action?.description ?? null;\r\n  }\r\n\r\n  /**\r\n   * Clear all undo/redo history\r\n   */\r\n  clear(): void {\r\n    this.undoStack = [];\r\n    this.redoStack = [];\r\n    this.notify();\r\n  }\r\n\r\n  /**\r\n   * Subscribe to changes\r\n   */\r\n  onChange(callback: () => void): () => void {\r\n    this.listeners.add(callback);\r\n    return () => this.listeners.delete(callback);\r\n  }\r\n\r\n  /**\r\n   * Notify listeners of changes\r\n   */\r\n  private notify(): void {\r\n    this.listeners.forEach(fn => fn());\r\n  }\r\n\r\n  /**\r\n   * Get stack sizes for debugging\r\n   */\r\n  getState(): { undoCount: number; redoCount: number } {\r\n    return {\r\n      undoCount: this.undoStack.length,\r\n      redoCount: this.redoStack.length,\r\n    };\r\n  }\r\n}\r\n\r\n// Export singleton\r\nexport const undoManager = new UndoService();\r\n\r\n// Export class for testing\r\nexport { UndoService };\r\n","/**\r\n * App Store\r\n * Core application state\r\n */\r\n\r\nimport { storage } from '../services/storage';\r\n\r\n// Types\r\nexport interface User {\r\n  id: string;\r\n  email: string;\r\n  role: 'superadmin' | 'admin' | 'member';\r\n  name?: string;\r\n  avatar?: string;\r\n}\r\n\r\nexport interface Project {\r\n  id: string;\r\n  name: string;\r\n  description?: string;\r\n  status?: 'active' | 'archived' | 'completed';\r\n  createdAt?: string;\r\n  updatedAt?: string;\r\n  ownerId?: string;\r\n  settings?: Record<string, unknown>;\r\n}\r\n\r\nexport interface ProjectConfig {\r\n  aiProvider?: string;\r\n  aiModel?: string;\r\n  language?: string;\r\n  timezone?: string;\r\n  analyticsEnabled?: boolean;\r\n  errorReportingEnabled?: boolean;\r\n  aiImprovementEnabled?: boolean;\r\n}\r\n\r\nexport interface AppState {\r\n  readonly currentProjectId: string | null;\r\n  readonly currentProject: Project | null;\r\n  readonly currentUser: User | null;\r\n  readonly authConfigured: boolean;\r\n  readonly config: ProjectConfig;\r\n  readonly isLoading: boolean;\r\n  readonly error: string | null;\r\n  readonly isOnline: boolean;\r\n  readonly version: string;\r\n}\r\n\r\n// Initial state\r\nconst initialState: AppState = {\r\n  currentProjectId: storage.get('currentProjectId', null),\r\n  currentProject: storage.get('currentProject', null),\r\n  currentUser: null,\r\n  authConfigured: false,\r\n  config: {},\r\n  isLoading: false,\r\n  error: null,\r\n  isOnline: navigator.onLine,\r\n  version: '1.0.0',\r\n};\r\n\r\n// State\r\nlet state: AppState = { ...initialState };\r\n\r\n// Listeners\r\nconst listeners: Set<(state: AppState) => void> = new Set();\r\n\r\n/**\r\n * Notify all listeners of state change\r\n */\r\nfunction notify(): void {\r\n  listeners.forEach(fn => fn(state));\r\n}\r\n\r\n/**\r\n * Get current state\r\n */\r\nexport function getState(): AppState {\r\n  return state;\r\n}\r\n\r\n/**\r\n * Subscribe to state changes\r\n */\r\nexport function subscribe(callback: (state: AppState) => void): () => void {\r\n  listeners.add(callback);\r\n  return () => listeners.delete(callback);\r\n}\r\n\r\n/**\r\n * Set current project by ID only\r\n */\r\nexport function setCurrentProjectId(projectId: string | null): void {\r\n  state = { ...state, currentProjectId: projectId };\r\n  if (projectId) {\r\n    storage.set('currentProjectId', projectId);\r\n  } else {\r\n    storage.remove('currentProjectId');\r\n    storage.remove('currentProject');\r\n    state = { ...state, currentProject: null };\r\n  }\r\n  notify();\r\n}\r\n\r\n/**\r\n * Set current project (full object)\r\n */\r\nexport function setCurrentProject(project: Project | null): void {\r\n  state = {\r\n    ...state,\r\n    currentProject: project,\r\n    currentProjectId: project?.id || null,\r\n  };\r\n  if (project) {\r\n    storage.set('currentProject', project);\r\n    storage.set('currentProjectId', project.id);\r\n  } else {\r\n    storage.remove('currentProject');\r\n    storage.remove('currentProjectId');\r\n  }\r\n  notify();\r\n}\r\n\r\n/**\r\n * Set current user\r\n */\r\nexport function setCurrentUser(user: User | null): void {\r\n  state = { ...state, currentUser: user };\r\n  notify();\r\n}\r\n\r\n/**\r\n * Set auth configured status\r\n */\r\nexport function setAuthConfigured(configured: boolean): void {\r\n  state = { ...state, authConfigured: configured };\r\n  notify();\r\n}\r\n\r\n/**\r\n * Set project config\r\n */\r\nexport function setConfig(config: Partial<ProjectConfig>): void {\r\n  state = { ...state, config: { ...state.config, ...config } };\r\n  notify();\r\n}\r\n\r\n/**\r\n * Set loading state\r\n */\r\nexport function setLoading(isLoading: boolean): void {\r\n  state = { ...state, isLoading };\r\n  notify();\r\n}\r\n\r\n/**\r\n * Set error\r\n */\r\nexport function setError(error: string | null): void {\r\n  state = { ...state, error };\r\n  notify();\r\n}\r\n\r\n/**\r\n * Set online status\r\n */\r\nexport function setOnline(online: boolean): void {\r\n  state = { ...state, isOnline: online };\r\n  notify();\r\n}\r\n\r\n/**\r\n * Reset to initial state\r\n */\r\nexport function reset(): void {\r\n  state = { ...initialState };\r\n  notify();\r\n}\r\n\r\n/**\r\n * Initialize app store\r\n * Sets up online/offline listeners\r\n */\r\nexport function initAppStore(): void {\r\n  window.addEventListener('online', () => setOnline(true));\r\n  window.addEventListener('offline', () => setOnline(false));\r\n}\r\n\r\n// Export as namespace\r\nexport const appStore = {\r\n  getState,\r\n  subscribe,\r\n  setCurrentProject,\r\n  setCurrentProjectId,\r\n  setCurrentUser,\r\n  setAuthConfigured,\r\n  setConfig,\r\n  setLoading,\r\n  setError,\r\n  setOnline,\r\n  reset,\r\n  init: initAppStore,\r\n};\r\n","/**\r\n * Auth Service\r\n * Handles authentication state and API calls\r\n */\r\n\r\nimport { http } from './api';\r\nimport { appStore, User } from '../stores/app';\r\nimport { toast } from './toast';\r\n\r\n// Types\r\nexport interface AuthStatus {\r\n  configured: boolean;\r\n  url?: string;\r\n}\r\n\r\nexport interface LoginRequest {\r\n  email: string;\r\n  password: string;\r\n}\r\n\r\nexport interface OTPRequestResponse {\r\n  success: boolean;\r\n  message?: string;\r\n  expiresInMinutes?: number;\r\n  config?: OTPConfig;\r\n  retryAfter?: number;\r\n}\r\n\r\nexport interface OTPVerifyResponse {\r\n  success: boolean;\r\n  user?: AuthUser;\r\n  redirectTo?: string;\r\n  error?: string;\r\n  attemptsRemaining?: number;\r\n  needsEmailVerification?: boolean;\r\n  fallbackToPassword?: boolean;\r\n}\r\n\r\nexport interface OTPConfig {\r\n  codeLength: number;\r\n  expirationMinutes: number;\r\n  resendCooldownSeconds: number;\r\n}\r\n\r\nexport interface RegisterRequest {\r\n  email: string;\r\n  password: string;\r\n  username?: string;\r\n  display_name?: string;\r\n}\r\n\r\nexport interface AuthUser {\r\n  id: string;\r\n  email: string;\r\n  email_confirmed_at?: string | null;\r\n  created_at: string;\r\n  updated_at: string;\r\n  user_metadata?: {\r\n    username?: string;\r\n    display_name?: string;\r\n  };\r\n  profile?: UserProfile | null;\r\n}\r\n\r\nexport interface UserProfile {\r\n  id: string;\r\n  username?: string;\r\n  display_name?: string;\r\n  avatar_url?: string;\r\n  timezone?: string;\r\n  preferences?: Record<string, unknown>;\r\n  role?: 'user' | 'admin' | 'superadmin'; // Application role from user_profiles table\r\n}\r\n\r\nexport interface LoginResponse {\r\n  success: boolean;\r\n  user: AuthUser;\r\n}\r\n\r\nexport interface RegisterResponse {\r\n  success: boolean;\r\n  user: AuthUser;\r\n  session?: {\r\n    access_token: string;\r\n    refresh_token: string;\r\n    expires_at: number;\r\n  };\r\n  needsEmailVerification: boolean;\r\n}\r\n\r\nexport interface MeResponse {\r\n  authenticated: boolean;\r\n  user: AuthUser | null;\r\n}\r\n\r\n// Auth state\r\nlet isInitialized = false;\r\nlet authCheckPromise: Promise<boolean> | null = null;\r\n\r\n/**\r\n * Check if authentication is configured (Supabase)\r\n */\r\nexport async function checkAuthStatus(): Promise<AuthStatus> {\r\n  try {\r\n    const response = await http.get<AuthStatus>('/api/auth/status');\r\n    const configured = response.data.configured;\r\n    appStore.setAuthConfigured(configured);\r\n    return response.data;\r\n  } catch {\r\n    appStore.setAuthConfigured(false);\r\n    return { configured: false };\r\n  }\r\n}\r\n\r\n/**\r\n * Check current session and get user\r\n */\r\nexport async function checkSession(): Promise<User | null> {\r\n  try {\r\n    const response = await http.get<MeResponse>('/api/auth/me');\r\n    \r\n    if (response.data.authenticated && response.data.user) {\r\n      const authUser = response.data.user;\r\n      const user = mapAuthUserToUser(authUser);\r\n      appStore.setCurrentUser(user);\r\n      return user;\r\n    }\r\n    \r\n    appStore.setCurrentUser(null);\r\n    return null;\r\n  } catch {\r\n    appStore.setCurrentUser(null);\r\n    return null;\r\n  }\r\n}\r\n\r\n/**\r\n * Initialize auth - check status and session\r\n * When Supabase is configured, always requires valid authentication\r\n */\r\nexport async function initAuth(): Promise<boolean> {\r\n  // Prevent multiple simultaneous checks\r\n  if (authCheckPromise) {\r\n    return authCheckPromise;\r\n  }\r\n\r\n  authCheckPromise = (async () => {\r\n    try {\r\n      // Check if auth is configured\r\n      const status = await checkAuthStatus();\r\n      \r\n      if (!status.configured) {\r\n        // Auth not configured - allow guest mode\r\n        isInitialized = true;\r\n        return false;\r\n      }\r\n\r\n      // Auth is configured - check current session\r\n      // If session is invalid, user MUST login\r\n      const user = await checkSession();\r\n      isInitialized = true;\r\n      \r\n      if (!user) {\r\n        // No valid session - clear any stale user data\r\n        appStore.setCurrentUser(null);\r\n        console.log(' Supabase configured but no valid session - login required');\r\n        return false;\r\n      }\r\n      \r\n      return true;\r\n    } catch {\r\n      // Auth check failed - clear user and require login\r\n      appStore.setCurrentUser(null);\r\n      isInitialized = true;\r\n      return false;\r\n    } finally {\r\n      authCheckPromise = null;\r\n    }\r\n  })();\r\n\r\n  return authCheckPromise;\r\n}\r\n\r\n/**\r\n * Login with email and password\r\n */\r\nexport async function login(credentials: LoginRequest): Promise<User> {\r\n  const response = await http.post<LoginResponse>('/api/auth/login', credentials);\r\n  \r\n  if (!response.data.success) {\r\n    throw new Error('Login failed');\r\n  }\r\n\r\n  const user = mapAuthUserToUser(response.data.user);\r\n  appStore.setCurrentUser(user);\r\n  return user;\r\n}\r\n\r\n/**\r\n * Register new account\r\n */\r\nexport async function register(data: RegisterRequest): Promise<{ user: User; needsEmailVerification: boolean }> {\r\n  // Validate password length (min 12 chars as per server)\r\n  if (data.password.length < 12) {\r\n    throw new Error('Password must be at least 12 characters');\r\n  }\r\n\r\n  // Validate username if provided\r\n  if (data.username && data.username.length < 3) {\r\n    throw new Error('Username must be at least 3 characters');\r\n  }\r\n\r\n  if (data.username && !/^[a-zA-Z0-9_]+$/.test(data.username)) {\r\n    throw new Error('Username can only contain letters, numbers, and underscores');\r\n  }\r\n\r\n  const response = await http.post<RegisterResponse>('/api/auth/register', data);\r\n  \r\n  if (!response.data.success) {\r\n    throw new Error('Registration failed');\r\n  }\r\n\r\n  const user = mapAuthUserToUser(response.data.user);\r\n  \r\n  // Only set user if no email verification required\r\n  if (!response.data.needsEmailVerification) {\r\n    appStore.setCurrentUser(user);\r\n  }\r\n\r\n  return { \r\n    user, \r\n    needsEmailVerification: response.data.needsEmailVerification \r\n  };\r\n}\r\n\r\n/**\r\n * Logout current user\r\n */\r\nexport async function logout(): Promise<void> {\r\n  try {\r\n    await http.post('/api/auth/logout');\r\n  } catch {\r\n    // Ignore logout errors - clear local state anyway\r\n  }\r\n  \r\n  appStore.setCurrentUser(null);\r\n  appStore.setCurrentProject(null);\r\n}\r\n\r\n/**\r\n * Request password reset\r\n */\r\nexport async function forgotPassword(email: string): Promise<void> {\r\n  await http.post('/api/auth/forgot-password', { email });\r\n  // Always succeeds - doesn't reveal if email exists\r\n}\r\n\r\n/**\r\n * Reset password with token\r\n */\r\nexport async function resetPassword(password: string, accessToken: string): Promise<void> {\r\n  if (password.length < 12) {\r\n    throw new Error('Password must be at least 12 characters');\r\n  }\r\n\r\n  const response = await http.post<{ success: boolean }>('/api/auth/reset-password', {\r\n    password,\r\n    access_token: accessToken,\r\n  });\r\n\r\n  if (!response.data.success) {\r\n    throw new Error('Password reset failed');\r\n  }\r\n}\r\n\r\n/**\r\n * Refresh session token\r\n */\r\nexport async function refreshSession(): Promise<boolean> {\r\n  try {\r\n    const response = await http.post<{ success: boolean }>('/api/auth/refresh');\r\n    return response.data.success;\r\n  } catch {\r\n    return false;\r\n  }\r\n}\r\n\r\n/**\r\n * Request OTP code for passwordless login\r\n */\r\nexport async function requestLoginCode(email: string): Promise<OTPRequestResponse> {\r\n  const response = await http.post<OTPRequestResponse>('/api/auth/otp/request', { email });\r\n  return response.data;\r\n}\r\n\r\n/**\r\n * Verify OTP code and complete login\r\n */\r\nexport async function verifyLoginCode(email: string, code: string): Promise<User> {\r\n  const response = await http.post<OTPVerifyResponse>('/api/auth/otp/verify', { email, code });\r\n  \r\n  if (!response.data.success) {\r\n    const error = new Error(response.data.error || 'Verification failed') as Error & {\r\n      attemptsRemaining?: number;\r\n      needsEmailVerification?: boolean;\r\n      fallbackToPassword?: boolean;\r\n    };\r\n    error.attemptsRemaining = response.data.attemptsRemaining;\r\n    error.needsEmailVerification = response.data.needsEmailVerification;\r\n    error.fallbackToPassword = response.data.fallbackToPassword;\r\n    throw error;\r\n  }\r\n  \r\n  // Handle redirect if needed (magic link flow)\r\n  if (response.data.redirectTo) {\r\n    window.location.href = response.data.redirectTo;\r\n    throw new Error('Redirecting...');\r\n  }\r\n  \r\n  if (!response.data.user) {\r\n    throw new Error('Login completed but no user data received');\r\n  }\r\n  \r\n  const user = mapAuthUserToUser(response.data.user);\r\n  appStore.setCurrentUser(user);\r\n  return user;\r\n}\r\n\r\n/**\r\n * Get OTP configuration\r\n */\r\nexport async function getOTPConfig(): Promise<OTPConfig> {\r\n  try {\r\n    const response = await http.get<OTPConfig>('/api/auth/otp/config');\r\n    return response.data;\r\n  } catch {\r\n    // Return defaults if API fails\r\n    return {\r\n      codeLength: 6,\r\n      expirationMinutes: 10,\r\n      resendCooldownSeconds: 60\r\n    };\r\n  }\r\n}\r\n\r\n/**\r\n * Confirm email with code\r\n */\r\nexport async function confirmEmail(email: string, code: string): Promise<void> {\r\n  const response = await http.post<{ success: boolean; message?: string; error?: string }>('/api/auth/confirm-email', { email, code });\r\n  \r\n  if (!response.data.success) {\r\n    throw new Error(response.data.error || 'Confirmation failed');\r\n  }\r\n}\r\n\r\n/**\r\n * Resend email confirmation code\r\n */\r\nexport async function resendConfirmation(email: string): Promise<{ expiresInMinutes?: number }> {\r\n  const response = await http.post<{ success: boolean; message?: string; expiresInMinutes?: number; error?: string; retryAfter?: number }>('/api/auth/resend-confirmation', { email });\r\n  \r\n  if (!response.data.success) {\r\n    const error = new Error(response.data.error || 'Failed to resend confirmation') as Error & { retryAfter?: number };\r\n    error.retryAfter = response.data.retryAfter;\r\n    throw error;\r\n  }\r\n  \r\n  return { expiresInMinutes: response.data.expiresInMinutes };\r\n}\r\n\r\n/**\r\n * Map AuthUser to app User type\r\n * Note: role here is the APPLICATION role (superadmin/user) from user_profiles,\r\n * NOT the project role (owner/admin/write/read) from project_members\r\n */\r\nfunction mapAuthUserToUser(authUser: AuthUser): User {\r\n  const profile = authUser.profile;\r\n  const metadata = authUser.user_metadata || {};\r\n\r\n  return {\r\n    id: authUser.id,\r\n    email: authUser.email,\r\n    name: profile?.display_name || metadata.display_name || metadata.username || authUser.email.split('@')[0],\r\n    avatar: profile?.avatar_url,\r\n    role: profile?.role === 'superadmin' ? 'superadmin' : (profile?.role === 'admin' ? 'admin' : 'member'), // Map to app roles\r\n  };\r\n}\r\n\r\n/**\r\n * Check if user is authenticated\r\n */\r\nexport function isAuthenticated(): boolean {\r\n  return appStore.getState().currentUser !== null;\r\n}\r\n\r\n/**\r\n * Check if auth is initialized\r\n */\r\nexport function isAuthInitialized(): boolean {\r\n  return isInitialized;\r\n}\r\n\r\n/**\r\n * Get current user\r\n */\r\nexport function getCurrentUser(): User | null {\r\n  return appStore.getState().currentUser;\r\n}\r\n\r\n/**\r\n * Listen for auth required events\r\n */\r\nexport function onAuthRequired(callback: () => void): () => void {\r\n  const handler = () => callback();\r\n  window.addEventListener('godmode:auth-required', handler);\r\n  return () => window.removeEventListener('godmode:auth-required', handler);\r\n}\r\n\r\n/**\r\n * Trigger auth required event\r\n */\r\nexport function triggerAuthRequired(): void {\r\n  window.dispatchEvent(new CustomEvent('godmode:auth-required'));\r\n}\r\n\r\n// Export as namespace\r\nexport const auth = {\r\n  checkStatus: checkAuthStatus,\r\n  checkSession,\r\n  init: initAuth,\r\n  login,\r\n  register,\r\n  logout,\r\n  forgotPassword,\r\n  resetPassword,\r\n  refreshSession,\r\n  isAuthenticated,\r\n  isInitialized: isAuthInitialized,\r\n  getCurrentUser,\r\n  onAuthRequired,\r\n  triggerAuthRequired,\r\n  // OTP / Magic Code\r\n  requestLoginCode,\r\n  verifyLoginCode,\r\n  getOTPConfig,\r\n  confirmEmail,\r\n  resendConfirmation,\r\n};\r\n","/**\r\n * Data Store\r\n * Application data cache\r\n */\r\n\r\nimport type { Fact } from '../services/facts';\r\n\r\n// Types\r\nexport interface Question {\r\n  id: string;\r\n  content: string;  // Primary field (API uses this)\r\n  question?: string;  // Legacy field for backwards compatibility\r\n  context?: string;\r\n  answer?: string;\r\n  answer_source?: string;\r\n  status: 'open' | 'answered' | 'dismissed' | 'pending' | 'assigned' | 'resolved' | 'reopened' | 'closed' | 'deferred';\r\n  priority: 'critical' | 'high' | 'medium' | 'low';\r\n  category?: string;\r\n  source?: string;\r\n  source_file?: string;\r\n  created_at?: string;  // API format\r\n  createdAt?: string;   // Legacy format\r\n  updated_at?: string;  // API format\r\n  updatedAt?: string;   // Legacy format\r\n  assigned_to?: string;\r\n  answered_by_contact_id?: string;\r\n  answered_by_name?: string;\r\n  follow_up_to?: string;\r\n  // SOTA fields\r\n  sla_hours?: number;\r\n  sla_breached?: boolean;\r\n  extracted_entities?: Array<{ type: string; name: string; entity_id?: string; confidence?: number }>;\r\n  extracted_topics?: Array<{ name: string; type?: string; confidence?: number }>;\r\n}\r\n\r\nexport interface Risk {\r\n  id: string | number;\r\n  content?: string;\r\n  description?: string;\r\n  impact: 'high' | 'medium' | 'low' | 'critical';\r\n  probability?: 'high' | 'medium' | 'low';\r\n  likelihood?: 'high' | 'medium' | 'low';\r\n  mitigation?: string;\r\n  owner?: string;\r\n  status: 'open' | 'mitigating' | 'mitigated' | 'accepted' | 'closed';\r\n  createdAt?: string;\r\n  created_at?: string;\r\n}\r\n\r\nexport interface Action {\r\n  id: string;\r\n  task: string;\r\n  assignee?: string;\r\n  dueDate?: string;\r\n  status: 'pending' | 'in_progress' | 'completed' | 'cancelled';\r\n  priority: 'high' | 'medium' | 'low';\r\n  createdAt: string;\r\n}\r\n\r\nexport interface Decision {\r\n  id: string | number;\r\n  decision: string;\r\n  content?: string;\r\n  rationale?: string;\r\n  madeBy?: string;\r\n  made_by?: string;\r\n  madeAt: string;\r\n  decided_at?: string;\r\n  status: 'proposed' | 'approved' | 'rejected' | 'deferred' | 'active' | 'superseded' | 'revoked';\r\n  source?: string;\r\n  source_file?: string;\r\n  owner?: string;\r\n  [key: string]: unknown; // Allow additional properties\r\n}\r\n\r\nexport interface Contact {\r\n  id: string;\r\n  name: string;\r\n  email?: string;\r\n  phone?: string;\r\n  company?: string;\r\n  organization?: string;\r\n  role?: string;\r\n  rolePrompt?: string;\r\n  department?: string;\r\n  linkedin?: string;\r\n  timezone?: string;\r\n  location?: string;\r\n  photoUrl?: string;\r\n  avatarUrl?: string;\r\n  photo_url?: string;\r\n  avatar_url?: string;\r\n  notes?: string;\r\n  tags?: string[];\r\n  aliases?: string[];\r\n  isFavorite?: boolean;\r\n  is_favorite?: boolean;\r\n}\r\n\r\nexport interface ChatSource {\r\n  id: string;\r\n  type: string;\r\n  score: number;\r\n  rrfScore?: number;\r\n  semanticScore?: number;\r\n  keywordScore?: number;\r\n  sourceCount?: number;\r\n  source?: string;\r\n  contactName?: string;\r\n  contactRole?: string;\r\n  avatarUrl?: string;\r\n}\r\n\r\nexport interface ChatRAGInfo {\r\n  method: string;\r\n  vectorResults: number;\r\n  graphResults: number;\r\n  fusedResults: number;\r\n  usedHyDE: boolean;\r\n  entityFilter?: string[];\r\n}\r\n\r\nexport interface ChatMessage {\r\n  id: string;\r\n  role: 'user' | 'assistant' | 'system';\r\n  content: string;\r\n  timestamp: string;\r\n  sources?: ChatSource[] | string[];\r\n  queryType?: string;\r\n  confidence?: 'high' | 'medium' | 'low';\r\n  contextQuality?: string;\r\n  rag?: ChatRAGInfo;\r\n}\r\n\r\nexport interface DataState {\r\n  questions: Question[];\r\n  risks: Risk[];\r\n  actions: Action[];\r\n  decisions: Decision[];\r\n  facts: Fact[];\r\n  contacts: Contact[];\r\n  chatHistory: ChatMessage[];\r\n  projects: Array<{ id: string; name: string }>;\r\n  lastUpdated: Record<string, number>;\r\n}\r\n\r\n// Initial state\r\nconst initialState: DataState = {\r\n  questions: [],\r\n  risks: [],\r\n  actions: [],\r\n  decisions: [],\r\n  facts: [],\r\n  contacts: [],\r\n  chatHistory: [],\r\n  projects: [],\r\n  lastUpdated: {},\r\n};\r\n\r\n// State\r\nlet state: DataState = { ...initialState };\r\n\r\n// Listeners\r\nconst listeners: Set<(state: DataState) => void> = new Set();\r\n\r\n/**\r\n * Notify all listeners\r\n */\r\nfunction notify(): void {\r\n  listeners.forEach(fn => fn(state));\r\n}\r\n\r\n/**\r\n * Get current state\r\n */\r\nexport function getState(): DataState {\r\n  return state;\r\n}\r\n\r\n/**\r\n * Subscribe to state changes\r\n */\r\nexport function subscribe(callback: (state: DataState) => void): () => void {\r\n  listeners.add(callback);\r\n  return () => listeners.delete(callback);\r\n}\r\n\r\n/**\r\n * Set questions\r\n */\r\nexport function setQuestions(questions: Question[]): void {\r\n  state = { \r\n    ...state, \r\n    questions,\r\n    lastUpdated: { ...state.lastUpdated, questions: Date.now() }\r\n  };\r\n  notify();\r\n}\r\n\r\n/**\r\n * Set risks\r\n */\r\nexport function setRisks(risks: Risk[]): void {\r\n  state = { \r\n    ...state, \r\n    risks,\r\n    lastUpdated: { ...state.lastUpdated, risks: Date.now() }\r\n  };\r\n  notify();\r\n}\r\n\r\n/**\r\n * Set actions\r\n */\r\nexport function setActions(actions: Action[]): void {\r\n  state = { \r\n    ...state, \r\n    actions,\r\n    lastUpdated: { ...state.lastUpdated, actions: Date.now() }\r\n  };\r\n  notify();\r\n}\r\n\r\n/**\r\n * Set decisions\r\n */\r\nexport function setDecisions(decisions: Decision[]): void {\r\n  state = { \r\n    ...state, \r\n    decisions,\r\n    lastUpdated: { ...state.lastUpdated, decisions: Date.now() }\r\n  };\r\n  notify();\r\n}\r\n\r\n/**\r\n * Set facts\r\n */\r\nexport function setFacts(facts: Fact[]): void {\r\n  state = { \r\n    ...state, \r\n    facts,\r\n    lastUpdated: { ...state.lastUpdated, facts: Date.now() }\r\n  };\r\n  notify();\r\n}\r\n\r\n/**\r\n * Set contacts\r\n */\r\nexport function setContacts(contacts: Contact[]): void {\r\n  state = { \r\n    ...state, \r\n    contacts,\r\n    lastUpdated: { ...state.lastUpdated, contacts: Date.now() }\r\n  };\r\n  notify();\r\n}\r\n\r\n/**\r\n * Set chat history\r\n */\r\nexport function setChatHistory(chatHistory: ChatMessage[]): void {\r\n  state = { ...state, chatHistory };\r\n  notify();\r\n}\r\n\r\n/**\r\n * Add chat message\r\n */\r\nexport function addChatMessage(message: ChatMessage): void {\r\n  state = { ...state, chatHistory: [...state.chatHistory, message] };\r\n  notify();\r\n}\r\n\r\n/**\r\n * Set projects\r\n */\r\nexport function setProjects(projects: Array<{ id: string; name: string }>): void {\r\n  state = { \r\n    ...state, \r\n    projects,\r\n    lastUpdated: { ...state.lastUpdated, projects: Date.now() }\r\n  };\r\n  notify();\r\n}\r\n\r\n/**\r\n * Clear chat history\r\n */\r\nexport function clearChatHistory(): void {\r\n  state = { ...state, chatHistory: [] };\r\n  notify();\r\n}\r\n\r\n/**\r\n * Reset to initial state\r\n */\r\nexport function reset(): void {\r\n  state = { ...initialState };\r\n  notify();\r\n}\r\n\r\n// Export as namespace\r\nexport const dataStore = {\r\n  getState,\r\n  subscribe,\r\n  setQuestions,\r\n  setRisks,\r\n  setActions,\r\n  setDecisions,\r\n  setFacts,\r\n  setContacts,\r\n  setChatHistory,\r\n  addChatMessage,\r\n  setProjects,\r\n  clearChatHistory,\r\n  reset,\r\n};\r\n","/**\n * Projects Service\n * Handles project CRUD operations and state\n */\n\nimport { http, fetchWithProject } from './api';\nimport { appStore, Project } from '../stores/app';\nimport { dataStore } from '../stores/data';\nimport { toast } from './toast';\n\n// Types\nexport interface ProjectListItem {\n  id: string;\n  name: string;\n  isDefault?: boolean;\n  createdAt?: string;\n  updatedAt?: string;\n}\n\nexport interface CreateProjectRequest {\n  name: string;\n  description?: string;\n  userRole?: string;\n  userRolePrompt?: string;\n}\n\nexport interface UpdateProjectRequest {\n  name?: string;\n  description?: string;\n  userRole?: string;\n  userRolePrompt?: string;\n  isDefault?: boolean;\n}\n\nexport interface ProjectStats {\n  members?: number;\n  comments?: number;\n  recentActivity?: number;\n  facts?: number;\n  questions?: number;\n  documents?: number;\n  decisions?: number;\n  risks?: number;\n  actions?: number;\n  people?: number;\n}\n\n/**\n * Get all projects\n */\nexport async function getProjects(): Promise<ProjectListItem[]> {\n  try {\n    const response = await http.get<{ projects: ProjectListItem[] }>('/api/projects');\n    const projects = response.data.projects || [];\n    dataStore.setProjects(projects);\n    return projects;\n  } catch {\n    return [];\n  }\n}\n\n/**\n * Get current/active project\n */\nexport async function getCurrentProject(): Promise<Project | null> {\n  try {\n    const response = await http.get<{ project: Project }>('/api/projects/current');\n    const project = response.data.project;\n    if (project) {\n      appStore.setCurrentProject(project);\n      return project;\n    }\n    return null;\n  } catch {\n    return null;\n  }\n}\n\n/**\n * Create a new project\n */\nexport async function createProject(data: CreateProjectRequest): Promise<Project> {\n  const response = await http.post<{ id: string; name?: string }>('/api/projects', data);\n\n  const project: Project = {\n    id: response.data.id,\n    name: data.name,\n    description: data.description,\n  };\n\n  // Refresh projects list\n  await getProjects();\n\n  return project;\n}\n\n/**\n * Update a project\n */\nexport async function updateProject(id: string, data: UpdateProjectRequest): Promise<void> {\n  await http.put(`/api/projects/${id}`, data);\n\n  // Update local state if it's the current project\n  const currentProject = appStore.getState().currentProject;\n  if (currentProject?.id === id) {\n    appStore.setCurrentProject({\n      ...currentProject,\n      ...data,\n    });\n  }\n\n  // Refresh projects list\n  await getProjects();\n}\n\n/**\n * Delete a project\n */\nexport async function deleteProject(id: string): Promise<void> {\n  await http.delete(`/api/projects/${id}`);\n\n  // Clear current project if it was deleted\n  if (appStore.getState().currentProjectId === id) {\n    appStore.setCurrentProject(null);\n  }\n\n  // Refresh projects list\n  await getProjects();\n}\n\n/**\n * Activate/switch to a project\n */\n/**\n * Activate/switch to a project\n */\nexport async function activateProject(id: string): Promise<Project | null> {\n  try {\n    // 1. Optimistic update\n    appStore.setCurrentProjectId(id);\n\n    // 2. Call activation API\n    await http.put(`/api/projects/${id}/activate`);\n\n    // 3. Poll for confirmation (max 5 attempts, 500ms intervals)\n    let project = null;\n    for (let i = 0; i < 5; i++) {\n      const response = await http.get<{ project: Project }>('/api/projects/current');\n      const p = response.data.project;\n\n      if (p && p.id === id) {\n        project = p;\n        break;\n      }\n      await new Promise(resolve => setTimeout(resolve, 500));\n    }\n\n    if (project) {\n      // Success: Update full project object\n      appStore.setCurrentProject(project);\n      return project;\n    } else {\n      // Fallback: If polling failed, try creating a minimal project object from cache if available\n      const cachedProject = dataStore.getState().projects.find(p => p.id === id);\n      if (cachedProject) {\n        const minimalProject: Project = {\n          id: cachedProject.id,\n          name: cachedProject.name\n        };\n        appStore.setCurrentProject(minimalProject);\n        return minimalProject;\n      }\n\n      console.warn(`[Projects] Activation timed out or inconsistent state for ${id}`);\n      // Even if we timed out, we stay on the requested ID optimistically if it didn't error\n      return null;\n    }\n\n  } catch (error) {\n    console.error('[Projects] Activation failed', error);\n    // Revert on error\n    const prev = appStore.getState().currentProject;\n    appStore.setCurrentProject(prev);\n    return null;\n  }\n}\n\n/**\n * Set a project as default\n */\nexport async function setDefaultProject(id: string): Promise<void> {\n  await http.post(`/api/projects/${id}/set-default`);\n  await getProjects();\n}\n\n/**\n * Get project statistics\n */\nexport async function getProjectStats(id: string): Promise<ProjectStats> {\n  try {\n    const response = await http.get<{ stats: ProjectStats }>(`/api/projects/${id}/stats`);\n    return response.data.stats || {};\n  } catch {\n    return {};\n  }\n}\n\n/**\n * Export project data\n */\nexport async function exportProject(id: string): Promise<Blob> {\n  const response = await fetchWithProject(`/api/projects/${id}/export`);\n  if (!response.ok) {\n    throw new Error('Failed to export project');\n  }\n  return response.blob();\n}\n\n/**\n * Import project data\n */\nexport async function importProject(file: File): Promise<Project> {\n  const formData = new FormData();\n  formData.append('file', file);\n\n  const response = await fetchWithProject('/api/projects/import', {\n    method: 'POST',\n    body: formData,\n  });\n\n  if (!response.ok) {\n    const error = await response.json().catch(() => ({ error: 'Import failed' }));\n    throw new Error(error.error || 'Import failed');\n  }\n\n  const data = await response.json();\n  await getProjects();\n\n  return data.project;\n}\n\n/**\n * Initialize projects - load list and set current\n */\nexport async function initProjects(): Promise<void> {\n  // Load all projects\n  await getProjects();\n\n  // Try to get current project from server\n  const current = await getCurrentProject();\n\n  // If no current project, try to find default or first project\n  if (!current) {\n    const projects = dataStore.getState().projects;\n    if (projects.length > 0) {\n      const defaultProject = projects.find(p => (p as { isDefault?: boolean }).isDefault) || projects[0];\n      await activateProject(defaultProject.id);\n    }\n  }\n}\n\n// Export as namespace\nexport const projects = {\n  getAll: getProjects,\n  getCurrent: getCurrentProject,\n  create: createProject,\n  update: updateProject,\n  delete: deleteProject,\n  activate: activateProject,\n  setDefault: setDefaultProject,\n  getStats: getProjectStats,\n  export: exportProject,\n  import: importProject,\n  init: initProjects,\n};\n","/**\r\n * Companies Service\r\n * CRUD and templates for company profiles (branding, A4/PPT)\r\n */\r\n\r\nimport { http } from './api';\r\n\r\nexport interface AnalysisReport {\r\n  ficha_identidade?: string;\r\n  visao_geral?: string;\r\n  produtos_servicos?: string;\r\n  publico_alvo?: string;\r\n  equipa_lideranca?: string;\r\n  presenca_digital?: string;\r\n  analise_competitiva?: string;\r\n  indicadores_crescimento?: string;\r\n  swot?: string;\r\n  conclusoes?: string;\r\n}\r\n\r\nexport interface BrandAssets {\r\n  primary_color?: string;\r\n  secondary_color?: string;\r\n  ai_context?: string;\r\n  analyzed_at?: string;\r\n  analysis_report?: AnalysisReport;\r\n}\r\n\r\nexport interface Company {\r\n  id: string;\r\n  name: string;\r\n  description?: string | null;\r\n  logo_url?: string | null;\r\n  website_url?: string | null;\r\n  linkedin_url?: string | null;\r\n  owner_id: string;\r\n  brand_assets?: BrandAssets;\r\n  a4_template_html?: string | null;\r\n  ppt_template_html?: string | null;\r\n  created_at?: string;\r\n  updated_at?: string;\r\n}\r\n\r\nexport interface CreateCompanyRequest {\r\n  name: string;\r\n  description?: string;\r\n  logo_url?: string;\r\n  website_url?: string;\r\n  linkedin_url?: string;\r\n}\r\n\r\nexport interface UpdateCompanyRequest {\r\n  name?: string;\r\n  description?: string;\r\n  logo_url?: string;\r\n  website_url?: string;\r\n  linkedin_url?: string;\r\n  brand_assets?: BrandAssets;\r\n}\r\n\r\nexport async function listCompanies(): Promise<Company[]> {\r\n  try {\r\n    const res = await http.get<{ companies?: Company[] }>('/api/companies');\r\n    const list = res.data?.companies;\r\n    return Array.isArray(list) ? list : [];\r\n  } catch {\r\n    return [];\r\n  }\r\n}\r\n\r\nexport async function getCompany(id: string): Promise<Company | null> {\r\n  try {\r\n    const res = await http.get<{ company: Company }>(`/api/companies/${id}`);\r\n    return res.data?.company ?? null;\r\n  } catch {\r\n    return null;\r\n  }\r\n}\r\n\r\nexport async function createCompany(data: CreateCompanyRequest): Promise<Company> {\r\n  const res = await http.post<{ company: Company }>('/api/companies', data);\r\n  return res.data.company;\r\n}\r\n\r\nexport async function updateCompany(id: string, data: UpdateCompanyRequest): Promise<Company> {\r\n  const res = await http.put<{ company: Company }>(`/api/companies/${id}`, data);\r\n  return res.data.company;\r\n}\r\n\r\nexport async function deleteCompany(id: string): Promise<void> {\r\n  await http.delete(`/api/companies/${id}`);\r\n}\r\n\r\nexport async function analyzeCompany(id: string): Promise<Company> {\r\n  const res = await http.post<{ company: Company }>(`/api/companies/${id}/analyze`, {}, { timeout: 300000 });\r\n  return res.data.company;\r\n}\r\n\r\nexport type TemplateType = 'a4' | 'ppt';\r\n\r\nexport async function getTemplate(companyId: string, type: TemplateType): Promise<string> {\r\n  const res = await http.get<{ html: string }>(`/api/companies/${companyId}/templates/${type}`);\r\n  return res.data?.html ?? '';\r\n}\r\n\r\nexport async function updateTemplate(companyId: string, type: TemplateType, html: string): Promise<void> {\r\n  await http.put(`/api/companies/${companyId}/templates/${type}`, { html });\r\n}\r\n\r\nexport async function generateTemplate(companyId: string, type: TemplateType): Promise<{ html: string; company: Company }> {\r\n  const res = await http.post<{ html: string; company: Company }>(`/api/companies/${companyId}/templates/generate`, { type }, { timeout: 300000 });\r\n  return { html: res.data.html, company: res.data.company };\r\n}\r\n","/**\r\n * Dashboard Service\r\n * Fetches dashboard data, stats, trends, and health metrics\r\n */\r\n\r\nimport { http } from './api';\r\n\r\n// Types\r\nexport interface DashboardData {\r\n  documents: {\r\n    total: number;\r\n    processed: number;\r\n    pending: number;\r\n  };\r\n  totalFacts: number;\r\n  factsByCategory?: Record<string, number>;\r\n  factsVerifiedCount?: number;\r\n  totalQuestions: number;\r\n  totalDecisions: number;\r\n  totalRisks: number;\r\n  totalActions: number;\r\n  totalPeople: number;\r\n  questionsByPriority: {\r\n    critical: number;\r\n    high: number;\r\n    medium: number;\r\n    resolved: number;\r\n  };\r\n  risksByImpact: {\r\n    high: number;\r\n    medium: number;\r\n    low: number;\r\n  };\r\n  overdueActions: number;\r\n  overdueItems: Array<{\r\n    id: string;\r\n    content: string;\r\n    assignee?: string;\r\n    due_date?: string;\r\n  }>;\r\n  questionAging: {\r\n    fresh: number;    // 0-3 days\r\n    aging: number;    // 4-7 days\r\n    stale: number;    // 8-14 days\r\n    critical: number; // 14+ days\r\n  };\r\n  oldestQuestions: Array<{\r\n    id: string;\r\n    content: string;\r\n    created_at: string;\r\n    priority?: string;\r\n  }>;\r\n  trends?: TrendData;\r\n  trendInsights?: Record<string, unknown>;\r\n}\r\n\r\nexport interface TrendData {\r\n  hasTrends: boolean;\r\n  periodDays: number;\r\n  compareDate: string;\r\n  facts: TrendMetric;\r\n  questions: TrendMetric;\r\n  risks: TrendMetric;\r\n  actions: TrendMetric;\r\n  decisions: TrendMetric;\r\n}\r\n\r\nexport interface TrendMetric {\r\n  current: number;\r\n  previous: number;\r\n  delta: number;\r\n  direction: 'up' | 'down' | 'stable';\r\n  sentiment: 'positive' | 'negative' | 'neutral';\r\n}\r\n\r\nexport interface TrendHistory {\r\n  date: string;\r\n  facts: number;\r\n  questions: number;\r\n  risks: number;\r\n  actions: number;\r\n  decisions: number;\r\n  // Index signature for dynamic access\r\n  [key: string]: string | number;\r\n}\r\n\r\nexport interface HealthData {\r\n  score: number; // 0-100\r\n  status: 'Healthy' | 'Good' | 'Needs Attention' | 'At Risk' | 'Critical';\r\n  color: string;\r\n  factors: Array<{\r\n    type: 'positive' | 'negative';\r\n    factor: string;\r\n    impact: number;\r\n    detail: string;\r\n  }>;\r\n  calculatedAt: string;\r\n}\r\n\r\nexport interface Insight {\r\n  type: 'warning' | 'alert' | 'info' | 'positive';\r\n  icon: string;\r\n  title: string;\r\n  message: string;\r\n  suggestion: string;\r\n  category: 'workload' | 'risk' | 'timeline' | 'knowledge' | 'progress';\r\n}\r\n\r\nexport interface Alert {\r\n  severity: 'critical' | 'high' | 'warning';\r\n  type: 'action' | 'risk' | 'question';\r\n  title: string;\r\n  message: string;\r\n  owner?: string;\r\n  assignee?: string;\r\n  id: string | number;\r\n}\r\n\r\n/**\r\n * Get full dashboard data\r\n */\r\nexport async function getDashboard(): Promise<DashboardData | null> {\r\n  try {\r\n    const response = await http.get<DashboardData>('/api/dashboard');\r\n    return response.data;\r\n  } catch {\r\n    return null;\r\n  }\r\n}\r\n\r\n/**\r\n * Get basic stats\r\n */\r\nexport async function getStats(): Promise<{\r\n  documents: { total: number; processed: number; pending: number };\r\n  facts: number;\r\n  questions: { total: number; pending: number; resolved: number; critical: number };\r\n  decisions: number;\r\n  risks: number;\r\n  people: number;\r\n} | null> {\r\n  try {\r\n    const response = await http.get('/api/stats');\r\n    return response.data as {\r\n      documents: { total: number; processed: number; pending: number };\r\n      facts: number;\r\n      questions: { total: number; pending: number; resolved: number; critical: number };\r\n      decisions: number;\r\n      risks: number;\r\n      people: number;\r\n    };\r\n  } catch {\r\n    return null;\r\n  }\r\n}\r\n\r\n/**\r\n * Get trends data\r\n */\r\nexport async function getTrends(days = 7): Promise<{\r\n  trends: TrendData;\r\n  history: TrendHistory[];\r\n} | null> {\r\n  try {\r\n    const response = await http.get<{ trends: TrendData; history: TrendHistory[] }>(`/api/trends?days=${days}`);\r\n    return response.data;\r\n  } catch {\r\n    return null;\r\n  }\r\n}\r\n\r\n/**\r\n * Get health score\r\n */\r\nexport async function getHealth(): Promise<HealthData | null> {\r\n  try {\r\n    const response = await http.get<HealthData>('/api/sot/health');\r\n    return response.data;\r\n  } catch {\r\n    return null;\r\n  }\r\n}\r\n\r\n/**\r\n * Get insights\r\n */\r\nexport async function getInsights(): Promise<Insight[]> {\r\n  try {\r\n    const response = await http.get<{ insights: Insight[] }>('/api/sot/insights');\r\n    return response.data.insights || [];\r\n  } catch {\r\n    return [];\r\n  }\r\n}\r\n\r\n/**\r\n * Get alerts\r\n */\r\nexport async function getAlerts(): Promise<Alert[]> {\r\n  try {\r\n    const response = await http.get<{ alerts: Alert[] }>('/api/sot/alerts');\r\n    return response.data.alerts || [];\r\n  } catch {\r\n    return [];\r\n  }\r\n}\r\n\r\n/**\r\n * Load all dashboard data in parallel\r\n */\r\nexport async function loadDashboardData(): Promise<{\r\n  dashboard: DashboardData | null;\r\n  health: HealthData | null;\r\n  insights: Insight[];\r\n  alerts: Alert[];\r\n}> {\r\n  const [dashboard, health, insights, alerts] = await Promise.all([\r\n    getDashboard(),\r\n    getHealth(),\r\n    getInsights(),\r\n    getAlerts(),\r\n  ]);\r\n\r\n  return { dashboard, health, insights, alerts };\r\n}\r\n\r\n// Export as namespace\r\nexport const dashboardService = {\r\n  getDashboard,\r\n  getStats,\r\n  getTrends,\r\n  getHealth,\r\n  getInsights,\r\n  getAlerts,\r\n  loadAll: loadDashboardData,\r\n};\r\n","/**\n * Questions Service\n * Handles question CRUD, answering, and AI suggestions\n */\n\nimport { http } from './api';\n\n// Types\nexport interface Question {\n  id: string | number;\n  content: string;\n  context?: string;\n  priority: 'low' | 'medium' | 'high' | 'critical';\n  status: 'pending' | 'assigned' | 'resolved' | 'reopened' | 'dismissed' | 'open' | 'answered' | 'closed' | 'deferred';\n  assigned_to?: string;\n  assigned_at?: string;\n  answer?: string;\n  answer_source?: 'manual' | 'manual-edit' | 'auto-detected' | 'document' | 'ai';\n  answered_at?: string;\n  answered_by_contact_id?: string;\n  answered_by_name?: string;\n  answer_provenance?: {\n    sources: Array<{ type: string; id?: string; content: string; confidence: number }>;\n    synthesis_method?: string;\n  };\n  category?: string;\n  source_file?: string;\n  created_at: string;\n  updated_at?: string;\n  resolved_at?: string;\n  previous_answer?: string;\n  edit_history?: Array<{\n    answer: string;\n    edited_at: string;\n  }>;\n  cached_suggestions?: AssigneeSuggestion[];\n  suggestions_generated_at?: string;\n  why?: string;\n  confidence?: number;\n  // SOTA fields\n  extracted_entities?: Array<{ type: string; name: string; entity_id?: string; confidence?: number }>;\n  extracted_topics?: Array<{ name: string; type?: string; confidence?: number }>;\n  sla_hours?: number;\n  sla_breached?: boolean;\n  sla_breached_at?: string;\n  follow_up_to?: string;\n  generation_source?: 'manual' | 'extracted' | 'template' | 'ai_generated';\n  cluster_id?: number;\n  cluster_label?: string;\n  // Dismissed tracking\n  dismissed_at?: string;\n  dismissed_by?: string;\n  dismissed_reason?: 'duplicate' | 'not_relevant' | 'out_of_scope' | 'answered_elsewhere' | 'no_longer_needed' | 'other';\n  // Deferred tracking\n  deferred_at?: string;\n  deferred_by?: string;\n  deferred_until?: string;\n  deferred_reason?: string;\n  // Reopened tracking\n  reopened_at?: string;\n  reopened_by?: string;\n  reopened_reason?: string;\n  reopen_count?: number;\n  // Resolution type\n  resolution_type?: 'answered_manual' | 'answered_auto' | 'answered_ai' | 'dismissed' | 'merged' | 'superseded';\n  // Merged/Superseded\n  merged_into_id?: string;\n  superseded_by_id?: string;\n  // Usefulness feedback\n  was_useful?: boolean;\n  usefulness_feedback?: string;\n  // Requester role - who the question is FROM (their perspective)\n  requester_role?: string;\n  requester_role_prompt?: string;\n  requester_contact_id?: string;\n  requester_name?: string;\n}\n\nexport interface CreateQuestionRequest {\n  content: string;\n  priority?: 'low' | 'medium' | 'high' | 'critical';\n  assigned_to?: string;\n  context?: string;\n  skipDedup?: boolean;\n}\n\nexport interface UpdateQuestionRequest {\n  content?: string;\n  context?: string;\n  priority?: 'low' | 'medium' | 'high' | 'critical';\n  status?: 'pending' | 'assigned' | 'resolved' | 'reopened' | 'dismissed';\n  assigned_to?: string;\n  category?: string;\n  reopen_reason?: string;\n  dismissed_reason?: string;\n}\n\nexport interface AnswerQuestionRequest {\n  answer: string;\n  source?: 'manual' | 'manual-edit' | 'auto-detected' | 'document' | 'ai';\n  followupQuestions?: string;\n  answeredByContactId?: string;\n  answeredByName?: string;\n  answerProvenance?: {\n    sources: Array<{ type: string; id?: string; content: string; confidence: number }>;\n    synthesis_method?: string;\n  };\n}\n\nexport interface AssigneeSuggestion {\n  person: string;\n  score: number;\n  reason: string;\n  contactId?: string;\n  role?: string;\n  organization?: string;\n  method: string;\n}\n\nexport interface CreateQuestionResponse {\n  success: boolean;\n  id?: number;\n  action?: string;\n  duplicate?: boolean;\n  existingId?: number;\n  similarity?: number;\n  message?: string;\n}\n\nexport interface AnswerQuestionResponse {\n  success: boolean;\n  question: Question;\n  followupsCreated: number;\n  message: string;\n}\n\nexport interface SuggestAssigneeResponse {\n  suggestions: AssigneeSuggestion[];\n  category: string;\n  method: string;\n  cached: boolean;\n  cachedAt?: string;\n}\n\n/**\n * Get all questions\n */\nexport async function getQuestions(filters?: {\n  status?: string;\n  priority?: string;\n}): Promise<Question[]> {\n  try {\n    const params = new URLSearchParams();\n    if (filters?.status) params.set('status', filters.status);\n    if (filters?.priority) params.set('priority', filters.priority);\n\n    const query = params.toString();\n    const url = query ? `/api/questions?${query}` : '/api/questions';\n\n    // ... existing getQuestions ...\n    const response = await http.get<{ questions: Question[] }>(url);\n    return response.data.questions || [];\n  } catch {\n    return [];\n  }\n}\n\n/**\n * Get a single question by ID\n */\nexport async function getQuestion(id: string | number): Promise<Question | null> {\n  try {\n    const response = await http.get<{ question: Question }>(`/api/questions/${id}`);\n    return response.data.question || null;\n  } catch {\n    return null;\n  }\n}\n\n/**\n * Create a new question\n */\nexport async function createQuestion(data: CreateQuestionRequest): Promise<CreateQuestionResponse> {\n  const response = await http.post<CreateQuestionResponse>('/api/questions', data);\n  return response.data;\n}\n\n/**\n * Update a question\n */\nexport async function updateQuestion(id: string | number, data: UpdateQuestionRequest): Promise<Question> {\n  const response = await http.put<{ question: Question }>(`/api/questions/${id}`, data);\n  return response.data.question;\n}\n\n/**\n * Delete/dismiss a question\n */\nexport async function deleteQuestion(id: string | number, reason?: string): Promise<void> {\n  await http.delete(`/api/questions/${id}`, {\n    body: JSON.stringify({ reason }),\n  });\n}\n\n/**\n * Answer a question\n */\nexport async function answerQuestion(\n  id: string | number,\n  data: AnswerQuestionRequest\n): Promise<AnswerQuestionResponse> {\n  const response = await http.post<AnswerQuestionResponse>(`/api/questions/${id}/answer`, data);\n  return response.data;\n}\n\n/**\n * Get questions grouped by person\n */\nexport async function getQuestionsByPerson(): Promise<Record<string, Question[]>> {\n  try {\n    const response = await http.get<{ questionsByPerson: Record<string, Question[]> }>('/api/questions/by-person');\n    return response.data.questionsByPerson || {};\n  } catch {\n    return {};\n  }\n}\n\n/**\n * Get questions grouped by team/category\n */\nexport async function getQuestionsByTeam(): Promise<Record<string, Question[]>> {\n  try {\n    const response = await http.get<{ questionsByTeam: Record<string, Question[]> }>('/api/questions/by-team');\n    return response.data.questionsByTeam || {};\n  } catch {\n    return {};\n  }\n}\n\n/**\n * Get AI-powered assignee suggestions\n */\nexport async function suggestAssignee(options: {\n  content?: string;\n  id?: string | number;\n  useAI?: boolean;\n  refresh?: boolean;\n}): Promise<SuggestAssigneeResponse> {\n  const params = new URLSearchParams();\n  if (options.content) params.set('content', options.content);\n  if (options.id) params.set('id', String(options.id));\n  if (options.useAI === false) params.set('ai', 'false');\n  if (options.refresh) params.set('refresh', 'true');\n\n  const response = await http.get<SuggestAssigneeResponse>(\n    `/api/questions/suggest-assignee?${params.toString()}`,\n    { signal: AbortSignal.timeout(90000) }\n  );\n  return response.data;\n}\n\n/**\n * Reopen a resolved question\n */\nexport async function reopenQuestion(id: string | number, reason: string): Promise<Question> {\n  const response = await http.post<{ question: Question }>(`/api/questions/${id}/reopen`, { reason });\n  return response.data.question;\n}\n\n/**\n * Dismiss a question (permanently close without answer)\n */\nexport async function dismissQuestion(\n  id: string | number,\n  reason: 'duplicate' | 'not_relevant' | 'out_of_scope' | 'answered_elsewhere' | 'no_longer_needed' | 'other',\n  details?: string\n): Promise<Question> {\n  const response = await http.post<{ question: Question }>(`/api/questions/${id}/dismiss`, {\n    reason,\n    details\n  });\n  return response.data.question;\n}\n\n/**\n * Defer a question (postpone for later)\n */\nexport async function deferQuestion(\n  id: string | number,\n  until: string | Date,\n  reason?: string\n): Promise<Question> {\n  const response = await http.post<{ question: Question }>(`/api/questions/${id}/defer`, {\n    until: typeof until === 'string' ? until : until.toISOString(),\n    reason\n  });\n  return response.data.question;\n}\n\n/**\n * Merge a question into another\n */\nexport async function mergeQuestion(\n  sourceId: string | number,\n  targetId: string | number\n): Promise<{ source: Question; target: Question }> {\n  const response = await http.post<{ source: Question; target: Question }>(\n    `/api/questions/${sourceId}/merge`,\n    { targetId }\n  );\n  return response.data;\n}\n\n/**\n * Submit feedback on an answer\n */\nexport async function submitAnswerFeedback(\n  id: string | number,\n  wasUseful: boolean,\n  feedback?: string\n): Promise<Question> {\n  const response = await http.post<{ question: Question }>(`/api/questions/${id}/feedback`, {\n    wasUseful,\n    feedback\n  });\n  return response.data.question;\n}\n\n/**\n * Get deferred questions that are due\n */\nexport async function getDueDeferredQuestions(): Promise<Question[]> {\n  try {\n    const response = await http.get<{ questions: Question[] }>('/api/questions/deferred/due');\n    return response.data.questions || [];\n  } catch {\n    return [];\n  }\n}\n\n/**\n * Get question lifecycle stats\n */\nexport async function getLifecycleStats(): Promise<Record<string, number>> {\n  try {\n    const response = await http.get<{ stats: Record<string, number> }>('/api/questions/stats/lifecycle');\n    return response.data.stats || {};\n  } catch {\n    return {};\n  }\n}\n\n/**\n * Get question statistics\n */\nexport function getQuestionStats(questions: Question[]): {\n  total: number;\n  pending: number;\n  assigned: number;\n  resolved: number;\n  critical: number;\n  overdue: number;\n} {\n  const now = new Date();\n  const sevenDaysAgo = new Date(now.getTime() - 7 * 24 * 60 * 60 * 1000);\n\n  return {\n    total: questions.length,\n    pending: questions.filter(q => q.status === 'pending').length,\n    assigned: questions.filter(q => q.status === 'assigned').length,\n    resolved: questions.filter(q => q.status === 'resolved').length,\n    critical: questions.filter(q => q.priority === 'critical' && q.status !== 'resolved').length,\n    overdue: questions.filter(q => {\n      if (q.status === 'resolved') return false;\n      const created = new Date(q.created_at);\n      return created < sevenDaysAgo;\n    }).length,\n  };\n}\n\n// Export as namespace\nexport const questionsService = {\n  getAll: getQuestions,\n  get: getQuestion,\n  create: createQuestion,\n  update: updateQuestion,\n  delete: deleteQuestion,\n  answer: answerQuestion,\n  getByPerson: getQuestionsByPerson,\n  getByTeam: getQuestionsByTeam,\n  suggestAssignee,\n  reopen: reopenQuestion,\n  getStats: getQuestionStats,\n  dismissQuestion,\n  deferQuestion,\n  submitAnswerFeedback,\n};\n","/**\r\n * Risks Service\r\n * Handles risk CRUD operations\r\n */\r\n\r\nimport { http } from './api';\r\n\r\nexport interface Risk {\r\n  id: string | number;\r\n  content: string;\r\n  title?: string;\r\n  description?: string;\r\n  impact: 'low' | 'medium' | 'high' | 'critical';\r\n  likelihood: 'low' | 'medium' | 'high';\r\n  mitigation?: string;\r\n  contingency?: string;\r\n  status: 'open' | 'mitigating' | 'mitigated' | 'accepted' | 'closed';\r\n  owner?: string;\r\n  category?: 'technical' | 'schedule' | 'budget' | 'resource' | 'scope' | 'external' | 'other';\r\n  source_file?: string;\r\n  source_document_id?: string;\r\n  generation_source?: 'extracted' | 'quick_capture' | 'manual' | 'import';\r\n  created_at: string;\r\n  updated_at?: string;\r\n  deleted_at?: string | null;\r\n}\r\n\r\nexport interface RiskEvent {\r\n  id: string;\r\n  risk_id: string;\r\n  event_type: string;\r\n  event_data?: Record<string, unknown>;\r\n  actor_name?: string;\r\n  created_at: string;\r\n}\r\n\r\nexport interface CreateRiskRequest {\r\n  content: string;\r\n  title?: string;\r\n  impact?: 'low' | 'medium' | 'high' | 'critical';\r\n  likelihood?: 'low' | 'medium' | 'high';\r\n  mitigation?: string;\r\n  owner?: string;\r\n  category?: string;\r\n}\r\n\r\nexport interface UpdateRiskRequest {\r\n  content?: string;\r\n  title?: string;\r\n  impact?: 'low' | 'medium' | 'high' | 'critical';\r\n  likelihood?: 'low' | 'medium' | 'high';\r\n  mitigation?: string;\r\n  contingency?: string;\r\n  status?: 'open' | 'mitigating' | 'mitigated' | 'accepted' | 'closed';\r\n  owner?: string;\r\n  category?: string;\r\n}\r\n\r\n/**\r\n * Get all risks\r\n */\r\nexport async function getRisks(status?: string): Promise<Risk[]> {\r\n  try {\r\n    const url = status ? `/api/risks?status=${status}` : '/api/risks';\r\n    const response = await http.get<{ risks: Risk[] }>(url);\r\n    return response.data.risks || [];\r\n  } catch {\r\n    return [];\r\n  }\r\n}\r\n\r\n/**\r\n * Get a single risk by id\r\n */\r\nexport async function getRisk(id: string | number): Promise<Risk | null> {\r\n  try {\r\n    const response = await http.get<{ risk: Risk }>(`/api/risks/${id}`);\r\n    return response.data.risk ?? null;\r\n  } catch {\r\n    return null;\r\n  }\r\n}\r\n\r\n/**\r\n * Get soft-deleted risks (for restore)\r\n */\r\nexport async function getDeletedRisks(): Promise<Risk[]> {\r\n  try {\r\n    const response = await http.get<{ risks: Risk[] }>('/api/risks/deleted');\r\n    return response.data.risks || [];\r\n  } catch {\r\n    return [];\r\n  }\r\n}\r\n\r\n/**\r\n * Restore a soft-deleted risk\r\n */\r\nexport async function restoreRisk(id: string | number): Promise<Risk> {\r\n  const response = await http.post<{ risk: Risk }>(`/api/risks/${id}/restore`, {});\r\n  return response.data.risk;\r\n}\r\n\r\n/**\r\n * Get risk timeline events\r\n */\r\nexport async function getRiskEvents(id: string | number): Promise<RiskEvent[]> {\r\n  try {\r\n    const response = await http.get<{ events: RiskEvent[] }>(`/api/risks/${id}/events`);\r\n    return response.data.events || [];\r\n  } catch {\r\n    return [];\r\n  }\r\n}\r\n\r\n/**\r\n * Get risks grouped by category\r\n */\r\nexport async function getRisksByCategory(): Promise<Record<string, Risk[]>> {\r\n  try {\r\n    const response = await http.get<{ risksByCategory: Record<string, Risk[]> }>('/api/risks/by-category');\r\n    return response.data.risksByCategory || {};\r\n  } catch {\r\n    return {};\r\n  }\r\n}\r\n\r\n/**\r\n * Create a new risk\r\n */\r\nexport async function createRisk(data: CreateRiskRequest): Promise<Risk> {\r\n  const response = await http.post<{ risk: Risk; id: string | number }>('/api/risks', data);\r\n  return response.data.risk || { ...data, id: response.data.id, status: 'open', created_at: new Date().toISOString() } as Risk;\r\n}\r\n\r\n/**\r\n * Update a risk\r\n */\r\nexport async function updateRisk(id: string | number, data: UpdateRiskRequest): Promise<Risk> {\r\n  const response = await http.put<{ risk: Risk }>(`/api/risks/${id}`, data);\r\n  return response.data.risk;\r\n}\r\n\r\n/**\r\n * Delete a risk\r\n */\r\nexport async function deleteRisk(id: string | number): Promise<void> {\r\n  await http.delete(`/api/risks/${id}`);\r\n}\r\n\r\n/**\r\n * Calculate risk score (impact x likelihood)\r\n */\r\nexport function calculateRiskScore(impact: string, likelihood: string): number {\r\n  const impactScores: Record<string, number> = { low: 1, medium: 2, high: 3, critical: 4 };\r\n  const likelihoodScores: Record<string, number> = { low: 1, medium: 2, high: 3 };\r\n  return (impactScores[impact] || 2) * (likelihoodScores[likelihood] || 2);\r\n}\r\n\r\n/**\r\n * AI suggest owner and mitigation from risk content\r\n */\r\nexport interface RiskOwnerSuggestion {\r\n  name: string;\r\n  reason: string;\r\n  score?: number;\r\n}\r\n\r\nexport async function suggestRisk(options: { content: string; impact?: string; likelihood?: string; probability?: string }): Promise<{\r\n  suggested_owner: string;\r\n  suggested_mitigation: string;\r\n  suggested_owners: RiskOwnerSuggestion[];\r\n}> {\r\n  const response = await http.post<{\r\n    suggested_owner?: string;\r\n    suggested_mitigation?: string;\r\n    suggested_owners?: RiskOwnerSuggestion[];\r\n    error?: string;\r\n  }>('/api/risks/suggest', {\r\n    content: options.content?.trim() || '',\r\n    impact: options.impact || 'medium',\r\n    likelihood: options.likelihood ?? options.probability ?? 'medium',\r\n  });\r\n  if (response.data.error) throw new Error(response.data.error);\r\n  const owners = Array.isArray(response.data.suggested_owners) ? response.data.suggested_owners : [];\r\n  return {\r\n    suggested_owner: response.data.suggested_owner ?? (owners[0]?.name ?? ''),\r\n    suggested_mitigation: response.data.suggested_mitigation ?? '',\r\n    suggested_owners: owners,\r\n  };\r\n}\r\n\r\n/**\r\n * Get risk matrix data\r\n */\r\nexport function getRiskMatrixData(risks: Risk[]): Record<string, Risk[]> {\r\n  const matrix: Record<string, Risk[]> = {};\r\n  \r\n  risks.filter(r => r.status !== 'mitigated' && r.status !== 'closed').forEach(risk => {\r\n    const impact = (risk.impact || '').toString().toLowerCase();\r\n    const likelihood = (risk.likelihood || '').toString().toLowerCase();\r\n    const key = `${impact}-${likelihood}`;\r\n    if (!matrix[key]) matrix[key] = [];\r\n    matrix[key].push(risk);\r\n  });\r\n  \r\n  return matrix;\r\n}\r\n\r\nexport const risksService = {\r\n  getAll: getRisks,\r\n  get: getRisk,\r\n  getByCategory: getRisksByCategory,\r\n  getDeleted: getDeletedRisks,\r\n  restore: restoreRisk,\r\n  getEvents: getRiskEvents,\r\n  suggest: suggestRisk,\r\n  create: createRisk,\r\n  update: updateRisk,\r\n  delete: deleteRisk,\r\n  calculateScore: calculateRiskScore,\r\n  getMatrixData: getRiskMatrixData,\r\n};\r\n","/**\n * Actions Service\n * Handles action item CRUD operations\n */\n\nimport { http } from './api';\n\n/** API returns task, owner, deadline (action_items table). We expose content, assignee, due_date for UI. DevOps Sprint Board fields included. */\nexport interface Action {\n  id: string | number;\n  /** UI: use content; API may return task (title of the task - concrete action) */\n  content?: string;\n  task?: string;\n  status: 'pending' | 'in_progress' | 'completed' | 'cancelled';\n  /** UI: use assignee; API may return owner */\n  assignee?: string;\n  owner?: string;\n  /** UI: use due_date; API may return deadline */\n  due_date?: string;\n  deadline?: string;\n  priority?: 'low' | 'medium' | 'high' | 'critical';\n  source_file?: string;\n  source_document_id?: string;\n  depends_on?: string[];\n  blocked_by?: string[];\n  created_at: string;\n  updated_at?: string;\n  completed_at?: string;\n  /** Parent User Story reference e.g. US-102 */\n  parent_story_ref?: string;\n  /** Parent User Story UUID (from user_stories table) */\n  parent_story_id?: string;\n  /** Estimate e.g. 1 day, 8h (max 8h per task) */\n  size_estimate?: string;\n  /** Technical description / implementation notes */\n  description?: string;\n  /** Definition of Done checklist (strings or { text, done } for checkmarks) */\n  definition_of_done?: (string | { text: string; done?: boolean })[];\n  /** Acceptance criteria checklist */\n  acceptance_criteria?: string[];\n  /** How the action was created: extracted, quick_capture, manual, import, sprint_generated */\n  generation_source?: 'extracted' | 'quick_capture' | 'manual' | 'import' | 'sprint_generated';\n  source_email_id?: string;\n  source_type?: 'transcript' | 'email' | 'manual';\n  requested_by?: string;\n  requested_by_contact_id?: string;\n  supporting_document_ids?: string[];\n  /** Sprint this task belongs to */\n  sprint_id?: string;\n  sprint_name?: string;\n  /** Optional task points for velocity/breakdown */\n  task_points?: number;\n  /** Optional decision this task implements / is driven by */\n  decision_id?: string | null;\n}\n\nexport interface CreateActionRequest {\n  content: string;\n  status?: 'pending' | 'in_progress' | 'completed' | 'cancelled';\n  assignee?: string;\n  due_date?: string;\n  priority?: 'low' | 'medium' | 'high' | 'critical';\n  parent_story_ref?: string;\n  parent_story_id?: string;\n  size_estimate?: string;\n  description?: string;\n  definition_of_done?: string[];\n  acceptance_criteria?: string[];\n  depends_on?: string[];\n  generation_source?: 'extracted' | 'quick_capture' | 'manual' | 'import';\n  source_document_id?: string;\n  source_email_id?: string;\n  source_type?: 'transcript' | 'email' | 'manual';\n  requested_by?: string;\n  requested_by_contact_id?: string;\n  supporting_document_ids?: string[];\n  sprint_id?: string;\n  task_points?: number;\n  decision_id?: string | null;\n}\n\nexport interface UpdateActionRequest {\n  content?: string;\n  task?: string;\n  status?: 'pending' | 'in_progress' | 'completed' | 'cancelled';\n  assignee?: string;\n  owner?: string;\n  due_date?: string;\n  deadline?: string;\n  priority?: 'low' | 'medium' | 'high' | 'critical';\n  depends_on?: string[];\n  blocked_by?: string[];\n  parent_story_ref?: string;\n  parent_story_id?: string;\n  size_estimate?: string;\n  description?: string;\n  definition_of_done?: (string | { text: string; done?: boolean })[];\n  acceptance_criteria?: string[];\n  source_email_id?: string;\n  source_type?: 'transcript' | 'email' | 'manual';\n  requested_by?: string;\n  requested_by_contact_id?: string;\n  supporting_document_ids?: string[];\n  sprint_id?: string;\n  task_points?: number;\n  decision_id?: string | null;\n  /** Backend: emit refined_with_ai event and store snapshot for rollback */\n  refined_with_ai?: boolean;\n  /** Backend: restore action from a previous snapshot (e.g. from timeline) */\n  restore_snapshot?: { content?: string; task?: string; description?: string; definition_of_done?: (string | { text: string; done?: boolean })[]; acceptance_criteria?: string[]; size_estimate?: string };\n}\n\n/** Normalize API row (task, owner, deadline) to UI shape (content, assignee, due_date); preserve sprint board fields */\nfunction normalizeAction(row: Record<string, unknown>): Action {\n  return {\n    ...row,\n    content: (row.content ?? row.task) as string,\n    assignee: (row.assignee ?? row.owner) as string | undefined,\n    due_date: (row.due_date ?? row.deadline) as string | undefined,\n    definition_of_done: Array.isArray(row.definition_of_done) ? row.definition_of_done as (string | { text: string; done?: boolean })[] : [],\n    acceptance_criteria: Array.isArray(row.acceptance_criteria) ? row.acceptance_criteria as string[] : [],\n    depends_on: Array.isArray(row.depends_on) ? row.depends_on as string[] : [],\n    sprint_id: row.sprint_id as string | undefined,\n    sprint_name: (row.sprint_name ?? (row.sprints as { name?: string })?.name ?? (row.sprint as { name?: string })?.name) as string | undefined,\n  } as Action;\n}\n\n/**\n * Get all actions (optionally filter by status, sprint, or decision)\n */\nexport async function getActions(status?: string, sprintId?: string, decisionId?: string | null): Promise<Action[]> {\n  try {\n    const params = new URLSearchParams();\n    if (status) params.set('status', status);\n    if (sprintId) params.set('sprint_id', sprintId);\n    if (decisionId) params.set('decision_id', decisionId);\n    const q = params.toString();\n    const url = q ? `/api/actions?${q}` : '/api/actions';\n    const response = await http.get<{ actions: Record<string, unknown>[] }>(url);\n    const raw = response.data.actions || [];\n    return raw.map(normalizeAction);\n  } catch {\n    return [];\n  }\n}\n\n/**\n * Get a single action by ID\n */\nexport async function getAction(id: string | number): Promise<Action | null> {\n  try {\n    const response = await http.get<{ action: Record<string, unknown> }>(`/api/actions/${id}`);\n    return response.data.action ? normalizeAction(response.data.action) : null;\n  } catch {\n    return null;\n  }\n}\n\n/**\n * Create a new action\n */\nexport async function createAction(data: CreateActionRequest): Promise<Action> {\n  const payload = {\n    content: data.content,\n    task: data.content,\n    assignee: data.assignee,\n    owner: data.assignee,\n    due_date: data.due_date,\n    deadline: data.due_date,\n    status: data.status,\n    priority: data.priority,\n    parent_story_ref: data.parent_story_ref,\n    parent_story_id: data.parent_story_id,\n    size_estimate: data.size_estimate,\n    description: data.description,\n    definition_of_done: data.definition_of_done,\n    acceptance_criteria: data.acceptance_criteria,\n    depends_on: data.depends_on,\n    generation_source: data.generation_source,\n    source_document_id: data.source_document_id,\n    source_email_id: data.source_email_id,\n    source_type: data.source_type,\n    requested_by: data.requested_by,\n    requested_by_contact_id: data.requested_by_contact_id,\n    supporting_document_ids: data.supporting_document_ids,\n    sprint_id: data.sprint_id,\n    task_points: data.task_points,\n    decision_id: data.decision_id ?? null,\n  };\n  const response = await http.post<{ action: Record<string, unknown>; id: string | number }>('/api/actions', payload);\n  const raw = response.data.action || { ...payload, id: response.data.id, created_at: new Date().toISOString() };\n  return normalizeAction(raw);\n}\n\n/**\n * Update an action\n */\nexport async function updateAction(id: string | number, data: UpdateActionRequest): Promise<Action> {\n  const payload: Record<string, unknown> = {\n    task: data.content ?? data.task,\n    owner: data.assignee ?? data.owner,\n    deadline: data.due_date ?? data.deadline,\n    parent_story_ref: data.parent_story_ref,\n    parent_story_id: data.parent_story_id,\n    size_estimate: data.size_estimate,\n    description: data.description,\n    definition_of_done: data.definition_of_done,\n    acceptance_criteria: data.acceptance_criteria,\n    depends_on: data.depends_on,\n    sprint_id: data.sprint_id,\n    task_points: data.task_points,\n    status: data.status,\n    priority: data.priority,\n    decision_id: data.decision_id !== undefined ? data.decision_id : undefined,\n  };\n  if (data.refined_with_ai === true) payload.refined_with_ai = true;\n  if (data.restore_snapshot != null) payload.restore_snapshot = data.restore_snapshot;\n  const response = await http.put<{ action: Record<string, unknown> }>(`/api/actions/${id}`, payload);\n  const raw = response.data.action;\n  return raw ? normalizeAction(raw) : {} as Action;\n}\n\n/**\n * Delete an action\n */\nexport async function deleteAction(id: string | number): Promise<void> {\n  await http.delete(`/api/actions/${id}`);\n}\n\n/**\n * List soft-deleted actions (for restore)\n */\nexport async function getDeletedActions(): Promise<Action[]> {\n  try {\n    const response = await http.get<{ actions: Record<string, unknown>[] }>('/api/actions/deleted');\n    const raw = response.data.actions || [];\n    return raw.map(normalizeAction);\n  } catch {\n    return [];\n  }\n}\n\n/**\n * Restore a soft-deleted action (syncs back to graph)\n */\nexport async function restoreAction(id: string | number): Promise<Action> {\n  const response = await http.post<{ action: Record<string, unknown> }>(`/api/actions/${id}/restore`, {});\n  return normalizeAction(response.data.action || {});\n}\n\nexport interface ActionEvent {\n  id: string;\n  action_id: string;\n  event_type: string;\n  event_data?: Record<string, unknown>;\n  actor_name?: string;\n  created_at: string;\n}\n\nexport interface ActionAssigneeSuggestion {\n  name: string;\n  reason?: string;\n  score?: number;\n}\n\n/**\n * Suggest assignees for an action from task content (AI + project contacts).\n */\nexport async function suggestAssignees(options: { content: string }): Promise<{ suggested_assignees: ActionAssigneeSuggestion[] }> {\n  try {\n    const response = await http.post<{ suggested_assignees: ActionAssigneeSuggestion[] }>('/api/actions/suggest', {\n      content: (options.content || '').trim(),\n    });\n    return {\n      suggested_assignees: Array.isArray(response.data.suggested_assignees) ? response.data.suggested_assignees : [],\n    };\n  } catch {\n    return { suggested_assignees: [] };\n  }\n}\n\nexport interface SuggestTaskResult {\n  task: string;\n  description: string;\n  size_estimate: string;\n  definition_of_done: string[];\n  acceptance_criteria: string[];\n}\n\n/**\n * Generate full task structure from a short description (AI using Sprint Board prompt from Admin).\n */\nexport async function suggestTaskFromDescription(options: {\n  user_input: string;\n  parent_story_ref?: string;\n}): Promise<SuggestTaskResult> {\n  const response = await http.post<SuggestTaskResult>('/api/actions/suggest-task', {\n    user_input: (options.user_input || '').trim(),\n    parent_story_ref: options.parent_story_ref || '',\n  });\n  return {\n    task: response.data.task || '',\n    description: response.data.description || '',\n    size_estimate: response.data.size_estimate || '1 day',\n    definition_of_done: Array.isArray(response.data.definition_of_done) ? response.data.definition_of_done : [],\n    acceptance_criteria: Array.isArray(response.data.acceptance_criteria) ? response.data.acceptance_criteria : [],\n  };\n}\n\n/**\n * Get action timeline events\n */\nexport async function getActionEvents(id: string | number): Promise<ActionEvent[]> {\n  try {\n    const response = await http.get<{ events: ActionEvent[] }>(`/api/actions/${id}/events`);\n    return response.data.events || [];\n  } catch {\n    return [];\n  }\n}\n\n/**\n * Check if action is overdue\n */\nexport function isOverdue(action: Action): boolean {\n  if (!action.due_date || action.status === 'completed' || action.status === 'cancelled') {\n    return false;\n  }\n  return new Date(action.due_date) < new Date();\n}\n\n/**\n * Get action statistics\n */\nexport function getActionStats(actions: Action[]): {\n  total: number;\n  pending: number;\n  inProgress: number;\n  completed: number;\n  overdue: number;\n} {\n  return {\n    total: actions.length,\n    pending: actions.filter(a => a.status === 'pending').length,\n    inProgress: actions.filter(a => a.status === 'in_progress').length,\n    completed: actions.filter(a => a.status === 'completed').length,\n    overdue: actions.filter(a => isOverdue(a)).length,\n  };\n}\n\nexport interface BySprintEntry {\n  count: number;\n  name: string;\n}\n\n/**\n * Get actions report (by_status, by_assignee, by_sprint)\n */\nexport async function getActionsReport(): Promise<{\n  by_status: Record<string, number>;\n  by_assignee: Record<string, number>;\n  by_sprint: Record<string, BySprintEntry>;\n}> {\n  try {\n    const response = await http.get<{\n      by_status: Record<string, number>;\n      by_assignee: Record<string, number>;\n      by_sprint: Record<string, BySprintEntry>;\n    }>('/api/actions/report');\n    return {\n      by_status: response.data?.by_status || {},\n      by_assignee: response.data?.by_assignee || {},\n      by_sprint: response.data?.by_sprint || {},\n    };\n  } catch {\n    return { by_status: {}, by_assignee: {}, by_sprint: {} };\n  }\n}\n\n/**\n * Get semantically similar actions (requires embeddings)\n */\nexport async function getSimilarActions(id: string | number): Promise<Action[]> {\n  try {\n    const response = await http.get<{ similar: Action[] }>(`/api/actions/${id}/similar`);\n    return response.data?.similar || [];\n  } catch {\n    return [];\n  }\n}\n\nexport interface UserStory {\n  id: string;\n  title: string;\n  description?: string;\n  status?: string;\n  acceptance_criteria?: string[];\n  created_at?: string;\n  story_points?: number;\n}\n\nexport async function getUserStories(status?: string): Promise<UserStory[]> {\n  try {\n    const url = status ? `/api/user-stories?status=${status}` : '/api/user-stories';\n    const response = await http.get<{ user_stories: UserStory[] }>(url);\n    return response.data.user_stories || [];\n  } catch {\n    return [];\n  }\n}\n\nexport async function addUserStory(data: { title: string; description?: string; status?: string; story_points?: number }): Promise<UserStory> {\n  const response = await http.post<{ user_story: UserStory; id: string }>('/api/user-stories', data);\n  return response.data.user_story || { id: response.data.id, ...data };\n}\n\nexport async function getUserStory(id: string): Promise<UserStory | null> {\n  try {\n    const response = await http.get<{ user_story: UserStory }>(`/api/user-stories/${id}`);\n    return response.data?.user_story ?? null;\n  } catch {\n    return null;\n  }\n}\n\nexport async function updateUserStory(\n  id: string,\n  data: { title?: string; description?: string; status?: string; story_points?: number | null; acceptance_criteria?: string[] }\n): Promise<UserStory> {\n  const response = await http.put<{ user_story: UserStory }>(`/api/user-stories/${id}`, data);\n  return response.data.user_story;\n}\n\nexport const actionsService = {\n  getAll: getActions,\n  get: getAction,\n  create: createAction,\n  update: updateAction,\n  delete: deleteAction,\n  getDeletedActions,\n  restoreAction,\n  getEvents: getActionEvents,\n  suggest: suggestAssignees,\n  suggestTaskFromDescription,\n  getUserStories,\n  getUserStory,\n  addUserStory,\n  updateUserStory,\n  isOverdue,\n  getStats: getActionStats,\n  getReport: getActionsReport,\n  getSimilar: getSimilarActions,\n};\n","/**\r\n * Decisions Service\r\n * Handles decision CRUD operations\r\n */\r\n\r\nimport { http } from './api';\r\n\r\nexport interface Decision {\r\n  id: string | number;\r\n  content: string;\r\n  status: 'proposed' | 'approved' | 'rejected' | 'deferred' | 'active' | 'superseded' | 'revoked';\r\n  rationale?: string;\r\n  made_by?: string;\r\n  approved_by?: string;\r\n  decided_at?: string;\r\n  impact?: 'low' | 'medium' | 'high';\r\n  reversible?: boolean;\r\n  source?: string;\r\n  source_file?: string;\r\n  source_document_id?: string;\r\n  owner?: string;\r\n  context?: string;\r\n  decision_date?: string;\r\n  generation_source?: 'extracted' | 'quick_capture' | 'manual' | 'import';\r\n  created_at: string;\r\n  updated_at?: string;\r\n  summary?: string;\r\n}\r\n\r\nexport interface DecisionSuggestResponse {\r\n  rationale: string;\r\n  impact: 'high' | 'medium' | 'low';\r\n  impact_summary: string;\r\n  summary: string;\r\n}\r\n\r\nexport interface DecisionOwnerSuggestion {\r\n  name: string;\r\n  reason?: string;\r\n  score?: number;\r\n}\r\n\r\nexport interface DecisionEvent {\r\n  id: string;\r\n  decision_id: string;\r\n  event_type: string;\r\n  event_data?: Record<string, unknown>;\r\n  actor_user_id?: string;\r\n  actor_name?: string;\r\n  created_at: string;\r\n}\r\n\r\nexport interface DecisionConflict {\r\n  decisionId1: string | number;\r\n  decisionId2: string | number;\r\n  decision1: Decision;\r\n  decision2: Decision;\r\n  conflictType: string;\r\n  description?: string;\r\n  reason?: string;\r\n  confidence?: number;\r\n}\r\n\r\nexport interface SimilarDecisionItem {\r\n  decision: Decision;\r\n  similarityScore: number;\r\n}\r\n\r\nexport interface CreateDecisionRequest {\r\n  content: string;\r\n  status?: 'proposed' | 'approved' | 'rejected' | 'deferred';\r\n  rationale?: string;\r\n  made_by?: string;\r\n  impact?: 'low' | 'medium' | 'high';\r\n  summary?: string;\r\n}\r\n\r\nexport interface UpdateDecisionRequest {\r\n  content?: string;\r\n  status?: 'proposed' | 'approved' | 'rejected' | 'deferred' | 'active' | 'superseded' | 'revoked';\r\n  rationale?: string;\r\n  made_by?: string;\r\n  approved_by?: string;\r\n  decided_at?: string;\r\n  impact?: 'low' | 'medium' | 'high';\r\n  reversible?: boolean;\r\n  summary?: string;\r\n}\r\n\r\n/**\r\n * Get all decisions\r\n */\r\nexport async function getDecisions(status?: string): Promise<Decision[]> {\r\n  try {\r\n    const url = status ? `/api/decisions?status=${status}` : '/api/decisions';\r\n    const response = await http.get<{ decisions: Decision[] }>(url);\r\n    return response.data.decisions || [];\r\n  } catch {\r\n    return [];\r\n  }\r\n}\r\n\r\n/**\r\n * Get a single decision\r\n */\r\nexport async function getDecision(id: string | number): Promise<Decision | null> {\r\n  try {\r\n    const response = await http.get<{ decision: Decision }>(`/api/decisions/${id}`);\r\n    return response.data.decision;\r\n  } catch {\r\n    return null;\r\n  }\r\n}\r\n\r\n/**\r\n * List soft-deleted decisions (for restore / undo)\r\n */\r\nexport async function getDeletedDecisions(): Promise<Decision[]> {\r\n  try {\r\n    const response = await http.get<{ decisions: Decision[] }>('/api/decisions/deleted');\r\n    return response.data.decisions || [];\r\n  } catch {\r\n    return [];\r\n  }\r\n}\r\n\r\n/**\r\n * Restore a soft-deleted decision\r\n */\r\nexport async function restoreDecision(id: string | number): Promise<Decision> {\r\n  const response = await http.post<{ decision: Decision }>(`/api/decisions/${id}/restore`, {});\r\n  return response.data.decision;\r\n}\r\n\r\n/**\r\n * Get decision events (timeline)\r\n */\r\nexport async function getDecisionEvents(decisionId: string | number): Promise<DecisionEvent[]> {\r\n  try {\r\n    const response = await http.get<{ events: DecisionEvent[] }>(`/api/decisions/${decisionId}/events`);\r\n    return response.data.events || [];\r\n  } catch {\r\n    return [];\r\n  }\r\n}\r\n\r\n/**\r\n * Get similar decisions\r\n */\r\nexport async function getSimilarDecisions(decisionId: string | number, limit = 10): Promise<SimilarDecisionItem[]> {\r\n  try {\r\n    const params = new URLSearchParams();\r\n    if (limit !== 10) params.set('limit', String(limit));\r\n    const query = params.toString();\r\n    const url = query ? `/api/decisions/${decisionId}/similar?${query}` : `/api/decisions/${decisionId}/similar`;\r\n    const response = await http.get<{ similar: SimilarDecisionItem[] }>(url);\r\n    return response.data.similar || [];\r\n  } catch {\r\n    return [];\r\n  }\r\n}\r\n\r\n/**\r\n * Run decision-check (AI conflict detection, records events)\r\n */\r\nexport async function runDecisionCheck(): Promise<{ ok: boolean; conflicts: DecisionConflict[]; analyzed_decisions: number; events_recorded: number }> {\r\n  const response = await http.post<{ ok: boolean; conflicts: DecisionConflict[]; analyzed_decisions: number; events_recorded: number }>('/api/decision-check/run', {});\r\n  return response.data;\r\n}\r\n\r\n/**\r\n * Detect conflicts between decisions (no events recorded)\r\n */\r\nexport async function detectConflicts(): Promise<DecisionConflict[]> {\r\n  try {\r\n    const response = await http.get<{ conflicts: DecisionConflict[] }>('/api/conflicts/decisions');\r\n    return response.data.conflicts || [];\r\n  } catch {\r\n    return [];\r\n  }\r\n}\r\n\r\n/**\r\n * AI suggest: rationale, impact, impact_summary, one-line summary from decision content\r\n */\r\nexport async function suggest(content: string, rationale?: string): Promise<DecisionSuggestResponse> {\r\n  const response = await http.post<DecisionSuggestResponse>('/api/decisions/suggest', {\r\n    content: content.trim(),\r\n    rationale: rationale?.trim() || '',\r\n  });\r\n  return response.data;\r\n}\r\n\r\n/**\r\n * AI suggest owner (made_by) from decision content; backend uses project contacts only.\r\n */\r\nexport async function suggestOwner(content: string, rationale?: string): Promise<{ suggested_owners: DecisionOwnerSuggestion[] }> {\r\n  const response = await http.post<{ suggested_owners: DecisionOwnerSuggestion[] }>('/api/decisions/suggest-owner', {\r\n    content: content.trim(),\r\n    rationale: rationale?.trim() || '',\r\n  });\r\n  return response.data;\r\n}\r\n\r\n/**\r\n * Create a new decision\r\n */\r\nexport async function createDecision(data: CreateDecisionRequest): Promise<Decision> {\r\n  const response = await http.post<{ decision: Decision; id: string | number }>('/api/decisions', data);\r\n  return response.data.decision || { ...data, id: response.data.id, status: data.status || 'proposed', created_at: new Date().toISOString() } as Decision;\r\n}\r\n\r\n/**\r\n * Update a decision\r\n */\r\nexport async function updateDecision(id: string | number, data: UpdateDecisionRequest): Promise<Decision> {\r\n  const response = await http.put<{ decision: Decision }>(`/api/decisions/${id}`, data);\r\n  return response.data.decision;\r\n}\r\n\r\n/**\r\n * Delete a decision\r\n */\r\nexport async function deleteDecision(id: string | number): Promise<void> {\r\n  await http.delete(`/api/decisions/${id}`);\r\n}\r\n\r\n/**\r\n * Approve a decision\r\n */\r\nexport async function approveDecision(id: string | number, approvedBy: string): Promise<Decision> {\r\n  return updateDecision(id, {\r\n    status: 'approved',\r\n    approved_by: approvedBy,\r\n    decided_at: new Date().toISOString(),\r\n  });\r\n}\r\n\r\n/**\r\n * Reject a decision\r\n */\r\nexport async function rejectDecision(id: string | number, rationale?: string): Promise<Decision> {\r\n  return updateDecision(id, {\r\n    status: 'rejected',\r\n    rationale,\r\n    decided_at: new Date().toISOString(),\r\n  });\r\n}\r\n\r\nexport const decisionsService = {\r\n  getAll: getDecisions,\r\n  get: getDecision,\r\n  create: createDecision,\r\n  update: updateDecision,\r\n  delete: deleteDecision,\r\n  approve: approveDecision,\r\n  reject: rejectDecision,\r\n  getDeletedDecisions,\r\n  restore: restoreDecision,\r\n  getEvents: getDecisionEvents,\r\n  getSimilarDecisions,\r\n  runDecisionCheck,\r\n  detectConflicts,\r\n  suggest,\r\n  suggestOwner,\r\n};\r\n","/**\r\n * Chat Service\r\n * Handles chat and AI interactions\r\n */\r\n\r\nimport { http } from './api';\r\n\r\nexport interface ChatMessage {\r\n  id: string;\r\n  role: 'user' | 'assistant' | 'system';\r\n  content: string;\r\n  timestamp: string;\r\n  sources?: ChatSource[];\r\n  contextQuality?: 'high' | 'medium' | 'low' | 'none';\r\n}\r\n\r\nexport interface ChatSource {\r\n  type: 'fact' | 'document' | 'question' | 'decision';\r\n  id: string | number;\r\n  title?: string;\r\n  excerpt?: string;\r\n}\r\n\r\nexport interface ChatRequest {\r\n  message: string;\r\n  context?: string;\r\n  history?: Array<{ role: string; content: string }>;\r\n  semantic?: boolean;\r\n  deepReasoning?: boolean;\r\n}\r\n\r\nexport interface ChatResponse {\r\n  message: string;\r\n  response: string;\r\n  sources: ChatSource[];\r\n  contextQuality: 'high' | 'medium' | 'low' | 'none';\r\n}\r\n\r\nexport interface AskRequest {\r\n  question: string;\r\n  model?: string;\r\n}\r\n\r\nexport interface AskResponse {\r\n  question: string;\r\n  answer: string;\r\n  sources: {\r\n    facts: number;\r\n    questions: number;\r\n    decisions: number;\r\n    knowledgeItems: number;\r\n  };\r\n}\r\n\r\nexport interface SotChatRequest {\r\n  message: string;\r\n  model?: string;\r\n}\r\n\r\nexport interface SotChatResponse {\r\n  response: string;\r\n  model: string;\r\n  healthScore: number;\r\n}\r\n\r\nexport interface BriefingResponse {\r\n  briefing: string;\r\n  analysis: string;\r\n  generated_at: string;\r\n  stats: Record<string, number>;\r\n  cached: boolean;\r\n  cacheSource?: 'supabase' | 'memory';\r\n}\r\n\r\nexport interface BriefingHistoryItem {\r\n  id: string;\r\n  briefing: string;\r\n  generated_at: string;\r\n}\r\n\r\n// Type alias for backwards compatibility\r\nexport type Briefing = BriefingResponse;\r\n\r\n// Chat history for context\r\nlet chatHistory: ChatMessage[] = [];\r\n\r\n/**\r\n * Send a chat message\r\n */\r\nexport async function sendMessage(request: ChatRequest): Promise<ChatResponse> {\r\n  const response = await http.post<ChatResponse>('/api/chat', {\r\n    message: request.message,\r\n    context: request.context,\r\n    history: request.history || chatHistory.slice(-10).map(m => ({\r\n      role: m.role,\r\n      content: m.content,\r\n    })),\r\n    semantic: request.semantic ?? true,\r\n    deepReasoning: request.deepReasoning ?? false,\r\n  });\r\n\r\n  // Add to history\r\n  const userMessage: ChatMessage = {\r\n    id: `msg-${Date.now()}-user`,\r\n    role: 'user',\r\n    content: request.message,\r\n    timestamp: new Date().toISOString(),\r\n  };\r\n\r\n  const assistantMessage: ChatMessage = {\r\n    id: `msg-${Date.now()}-assistant`,\r\n    role: 'assistant',\r\n    content: response.data.response,\r\n    timestamp: new Date().toISOString(),\r\n    sources: response.data.sources,\r\n    contextQuality: response.data.contextQuality,\r\n  };\r\n\r\n  chatHistory.push(userMessage, assistantMessage);\r\n\r\n  return response.data;\r\n}\r\n\r\n/**\r\n * Ask a question about the knowledge base\r\n */\r\nexport async function ask(request: AskRequest): Promise<AskResponse> {\r\n  const response = await http.post<AskResponse>('/api/ask', request);\r\n  return response.data;\r\n}\r\n\r\n/**\r\n * Chat with SOT context\r\n */\r\nexport async function sotChat(request: SotChatRequest): Promise<SotChatResponse> {\r\n  const response = await http.post<SotChatResponse>('/api/sot/chat', request);\r\n  return response.data;\r\n}\r\n\r\n/**\r\n * Get daily briefing\r\n */\r\nexport async function getBriefing(refresh = false): Promise<BriefingResponse> {\r\n  const url = refresh ? '/api/briefing?refresh=true' : '/api/briefing';\r\n  const response = await http.get<BriefingResponse>(url);\r\n  return response.data;\r\n}\r\n\r\n/**\r\n * Get briefing history\r\n */\r\nexport async function getBriefingHistory(limit = 30): Promise<BriefingHistoryItem[]> {\r\n  const response = await http.get<{ history: BriefingHistoryItem[]; total: number }>(`/api/briefing/history?limit=${limit}`);\r\n  return response.data.history || [];\r\n}\r\n\r\n/**\r\n * Get weekly report\r\n */\r\nexport async function getWeeklyReport(): Promise<string> {\r\n  const response = await http.get<string>('/api/reports/weekly');\r\n  return typeof response.data === 'string' ? response.data : '';\r\n}\r\n\r\n/**\r\n * Generate executive summary\r\n */\r\nexport async function generateExecutiveSummary(): Promise<string> {\r\n  const response = await http.post<{ summary: string }>('/api/sot/executive-summary');\r\n  return response.data.summary || '';\r\n}\r\n\r\n/**\r\n * Get chat history\r\n */\r\nexport function getChatHistory(): ChatMessage[] {\r\n  return [...chatHistory];\r\n}\r\n\r\n/**\r\n * Clear chat history\r\n */\r\nexport function clearChatHistory(): void {\r\n  chatHistory = [];\r\n}\r\n\r\n/**\r\n * Add message to history\r\n */\r\nexport function addToHistory(message: ChatMessage): void {\r\n  chatHistory.push(message);\r\n}\r\n\r\nexport const chatService = {\r\n  send: sendMessage,\r\n  ask,\r\n  sotChat,\r\n  getBriefing,\r\n  getBriefingHistory,\r\n  getWeeklyReport,\r\n  generateExecutiveSummary,\r\n  getHistory: getChatHistory,\r\n  clearHistory: clearChatHistory,\r\n  addToHistory,\r\n};\r\n","/**\r\n * Contacts Service\r\n * Handles contact and team CRUD operations\r\n */\r\n\r\nimport { http, fetchWithProject } from './api';\r\n\r\nexport interface Contact {\r\n  id: string;\r\n  name: string;\r\n  email?: string;\r\n  phone?: string;\r\n  organization?: string;\r\n  company?: string;\r\n  role?: string;\r\n  rolePrompt?: string;\r\n  department?: string;\r\n  linkedin?: string;\r\n  timezone?: string;\r\n  location?: string;\r\n  photoUrl?: string;\r\n  avatarUrl?: string;\r\n  photo_url?: string;\r\n  avatar_url?: string;\r\n  tags?: string[];\r\n  notes?: string;\r\n  aliases?: string[];\r\n  isFavorite?: boolean;\r\n  is_favorite?: boolean;\r\n  relationships?: Array<{\r\n    contactId: string;\r\n    type: 'reports_to' | 'works_with' | 'manages' | 'collaborates';\r\n  }>;\r\n  activity?: Array<{\r\n    type: 'conversation' | 'document' | 'transcript';\r\n    id: string;\r\n    title: string;\r\n    date: string;\r\n  }>;\r\n  teams?: Array<{\r\n    id: string;\r\n    name: string;\r\n    color: string;\r\n  }>;\r\n  created_at: string;\r\n  updated_at?: string;\r\n}\r\n\r\nexport interface Team {\r\n  id: string;\r\n  name: string;\r\n  description?: string;\r\n  color?: string;\r\n  team_type?: 'team' | 'department' | 'organization' | 'group';\r\n  memberCount?: number;\r\n  memberDetails?: Array<{\r\n    contactId: string;\r\n    name: string;\r\n    role: string;\r\n    isLead: boolean;\r\n  }>;\r\n  created_at: string;\r\n}\r\n\r\nexport interface CreateContactRequest {\r\n  name: string;\r\n  email?: string;\r\n  phone?: string;\r\n  organization?: string;\r\n  role?: string;\r\n  department?: string;\r\n  tags?: string[];\r\n  notes?: string;\r\n}\r\n\r\nexport interface UpdateContactRequest {\r\n  name?: string;\r\n  email?: string;\r\n  phone?: string;\r\n  organization?: string;\r\n  role?: string;\r\n  rolePrompt?: string;\r\n  department?: string;\r\n  linkedin?: string;\r\n  timezone?: string;\r\n  photoUrl?: string;\r\n  tags?: string[];\r\n  notes?: string;\r\n  aliases?: string[];\r\n}\r\n\r\nexport interface CreateTeamRequest {\r\n  name: string;\r\n  description?: string;\r\n  color?: string;\r\n  team_type?: 'team' | 'department' | 'organization' | 'group';\r\n}\r\n\r\n/**\r\n * Get all contacts\r\n */\r\nexport async function getContacts(filters?: {\r\n  organization?: string;\r\n  tag?: string;\r\n  search?: string;\r\n}): Promise<{ contacts: Contact[]; total: number }> {\r\n  try {\r\n    const params = new URLSearchParams();\r\n    if (filters?.organization) params.set('organization', filters.organization);\r\n    if (filters?.tag) params.set('tag', filters.tag);\r\n    if (filters?.search) params.set('search', filters.search);\r\n    \r\n    const query = params.toString();\r\n    const url = query ? `/api/contacts?${query}` : '/api/contacts';\r\n    \r\n    const response = await http.get<{ contacts: Contact[]; total: number }>(url);\r\n    const rawContacts = response.data.contacts || [];\r\n    \r\n    // Normalize field names (API uses snake_case, frontend uses camelCase)\r\n    const contacts = rawContacts.map(c => ({\r\n      ...c,\r\n      photoUrl: c.photo_url || c.avatar_url || c.photoUrl || c.avatarUrl,\r\n      avatarUrl: c.avatar_url || c.photo_url || c.avatarUrl || c.photoUrl,\r\n      isFavorite: c.is_favorite ?? c.isFavorite ?? false,\r\n      company: c.organization || c.company,\r\n    }));\r\n    \r\n    return { contacts, total: response.data.total || contacts.length };\r\n  } catch (error) {\r\n    console.error('[ContactsService] Failed to get contacts:', error);\r\n    return { contacts: [], total: 0 };\r\n  }\r\n}\r\n\r\n/**\r\n * Get a single contact\r\n */\r\nexport async function getContact(id: string): Promise<Contact | null> {\r\n  try {\r\n    const response = await http.get<{ contact: Contact }>(`/api/contacts/${id}`);\r\n    return response.data.contact;\r\n  } catch {\r\n    return null;\r\n  }\r\n}\r\n\r\n/**\r\n * Create a new contact\r\n */\r\nexport async function createContact(data: CreateContactRequest): Promise<Contact> {\r\n  const response = await http.post<{ id: string; ok: boolean }>('/api/contacts', data);\r\n  return { ...data, id: response.data.id, created_at: new Date().toISOString() } as Contact;\r\n}\r\n\r\n/**\r\n * Update a contact\r\n */\r\nexport async function updateContact(id: string, data: UpdateContactRequest): Promise<void> {\r\n  await http.put(`/api/contacts/${id}`, data);\r\n}\r\n\r\n/**\r\n * Delete a contact\r\n */\r\nexport async function deleteContact(id: string): Promise<void> {\r\n  await http.delete(`/api/contacts/${id}`);\r\n}\r\n\r\n/**\r\n * Get contact stats\r\n */\r\nexport async function getContactStats(): Promise<Record<string, number>> {\r\n  const response = await http.get<{ ok: boolean } & Record<string, number>>('/api/contacts/stats');\r\n  return response.data;\r\n}\r\n\r\n/**\r\n * Find contact by name\r\n */\r\nexport async function findContactByName(name: string): Promise<Contact | null> {\r\n  try {\r\n    const response = await http.get<{ found: boolean; contact: Contact | null }>(`/api/contacts/find-by-name?name=${encodeURIComponent(name)}`);\r\n    return response.data.found ? response.data.contact : null;\r\n  } catch {\r\n    return null;\r\n  }\r\n}\r\n\r\n/**\r\n * Get duplicate contacts\r\n */\r\nexport async function getDuplicates(): Promise<{ duplicates: Contact[][]; groups: number }> {\r\n  const response = await http.get<{ duplicates: Contact[][]; groups: number }>('/api/contacts/duplicates');\r\n  return response.data;\r\n}\r\n\r\n/**\r\n * Merge contacts\r\n */\r\nexport async function mergeContacts(contactIds: string[]): Promise<string> {\r\n  const response = await http.post<{ mergedId: string }>('/api/contacts/merge', { contactIds });\r\n  return response.data.mergedId;\r\n}\r\n\r\n/**\r\n * Enrich contact with AI\r\n */\r\nexport async function enrichContact(id: string): Promise<{\r\n  role?: string;\r\n  department?: string;\r\n  tags?: string[];\r\n  additionalNotes?: string;\r\n}> {\r\n  const response = await http.post<{ suggestions: Record<string, unknown> }>(`/api/contacts/${id}/enrich`);\r\n  return response.data.suggestions as {\r\n    role?: string;\r\n    department?: string;\r\n    tags?: string[];\r\n    additionalNotes?: string;\r\n  };\r\n}\r\n\r\n/**\r\n * Export contacts in specified format\r\n */\r\nexport async function exportContacts(format: 'json' | 'csv' = 'json'): Promise<void> {\r\n  try {\r\n    const response = await fetchWithProject(`/api/contacts/export?format=${format}`);\r\n    if (!response.ok) throw new Error('Export failed');\r\n    \r\n    const blob = await response.blob();\r\n    const url = URL.createObjectURL(blob);\r\n    const a = document.createElement('a');\r\n    a.href = url;\r\n    a.download = `contacts-export.${format}`;\r\n    document.body.appendChild(a);\r\n    a.click();\r\n    document.body.removeChild(a);\r\n    URL.revokeObjectURL(url);\r\n  } catch (error) {\r\n    console.error('Export failed:', error);\r\n    throw error;\r\n  }\r\n}\r\n\r\n/**\r\n * Get contact with all associations (teams, projects)\r\n */\r\nexport async function getContactWithAssociations(id: string): Promise<Contact & {\r\n  projects?: Array<{ id: string; name: string; role?: string; isPrimary?: boolean }>;\r\n} | null> {\r\n  try {\r\n    const response = await http.get<{ \r\n      contact: Contact & { \r\n        projects?: Array<{ id: string; name: string; role?: string; isPrimary?: boolean }> \r\n      } \r\n    }>(`/api/contacts/${id}/associations`);\r\n    return response.data.contact;\r\n  } catch {\r\n    // Fallback to regular get if associations endpoint not available\r\n    return getContact(id);\r\n  }\r\n}\r\n\r\n/**\r\n * Add contact to a project\r\n */\r\nexport async function addContactToProject(contactId: string, projectId: string, options?: {\r\n  role?: string;\r\n  isPrimary?: boolean;\r\n}): Promise<void> {\r\n  await http.post(`/api/contacts/${contactId}/projects`, { projectId, ...options });\r\n}\r\n\r\n/**\r\n * Remove contact from a project\r\n */\r\nexport async function removeContactFromProject(contactId: string, projectId: string): Promise<void> {\r\n  await http.delete(`/api/contacts/${contactId}/projects/${projectId}`);\r\n}\r\n\r\n/**\r\n * Get projects a contact belongs to\r\n */\r\nexport async function getContactProjects(contactId: string): Promise<Array<{\r\n  id: string;\r\n  name: string;\r\n  role?: string;\r\n  isPrimary?: boolean;\r\n}>> {\r\n  try {\r\n    const response = await http.get<{ projects: Array<{ id: string; name: string; role?: string; isPrimary?: boolean }> }>(\r\n      `/api/contacts/${contactId}/projects`\r\n    );\r\n    return response.data.projects || [];\r\n  } catch {\r\n    return [];\r\n  }\r\n}\r\n\r\n/**\r\n * Get all teams\r\n */\r\nexport async function getTeams(): Promise<Team[]> {\r\n  try {\r\n    const response = await http.get<{ teams: Team[] }>('/api/teams');\r\n    return response.data.teams || [];\r\n  } catch {\r\n    return [];\r\n  }\r\n}\r\n\r\n/**\r\n * Get a single team with members\r\n */\r\nexport async function getTeam(id: string): Promise<{ team: Team; members: Contact[] } | null> {\r\n  try {\r\n    const response = await http.get<{ team: Team; members: Contact[] }>(`/api/teams/${id}`);\r\n    return response.data;\r\n  } catch {\r\n    return null;\r\n  }\r\n}\r\n\r\n/**\r\n * Create a new team\r\n */\r\nexport async function createTeam(data: CreateTeamRequest): Promise<Team> {\r\n  const response = await http.post<{ id: string; ok: boolean }>('/api/teams', data);\r\n  return { ...data, id: response.data.id, created_at: new Date().toISOString() } as Team;\r\n}\r\n\r\n/**\r\n * Update a team\r\n */\r\nexport async function updateTeam(id: string, data: Partial<CreateTeamRequest>): Promise<void> {\r\n  await http.put(`/api/teams/${id}`, data);\r\n}\r\n\r\n/**\r\n * Delete a team\r\n */\r\nexport async function deleteTeam(id: string): Promise<void> {\r\n  await http.delete(`/api/teams/${id}`);\r\n}\r\n\r\n/**\r\n * Add member to team\r\n */\r\nexport async function addTeamMember(teamId: string, contactId: string, role?: string, isLead = false): Promise<void> {\r\n  await http.post(`/api/teams/${teamId}/members`, { contactId, role, isLead });\r\n}\r\n\r\n/**\r\n * Remove member from team\r\n */\r\nexport async function removeTeamMember(teamId: string, contactId: string): Promise<void> {\r\n  await http.delete(`/api/teams/${teamId}/members/${contactId}`);\r\n}\r\n\r\nexport const contactsService = {\r\n  getAll: getContacts,\r\n  get: getContact,\r\n  create: createContact,\r\n  update: updateContact,\r\n  delete: deleteContact,\r\n  getStats: getContactStats,\r\n  findByName: findContactByName,\r\n  getDuplicates,\r\n  merge: mergeContacts,\r\n  mergeContacts,\r\n  enrich: enrichContact,\r\n  export: exportContacts,\r\n  getWithAssociations: getContactWithAssociations,\r\n  addToProject: addContactToProject,\r\n  removeFromProject: removeContactFromProject,\r\n  getProjects: getContactProjects,\r\n};\r\n\r\nexport const teamsService = {\r\n  getAll: getTeams,\r\n  get: getTeam,\r\n  create: createTeam,\r\n  update: updateTeam,\r\n  delete: deleteTeam,\r\n  addMember: addTeamMember,\r\n  removeMember: removeTeamMember,\r\n};\r\n","/**\r\n * Documents Service\r\n * Handles file upload, processing, and document management\r\n */\r\n\r\nimport { http, fetchWithProject } from './api';\r\nimport { toast } from './toast';\r\n\r\nexport interface Document {\r\n  id: string;\r\n  filename: string;\r\n  originalName: string;\r\n  mimeType: string;\r\n  size: number;\r\n  path?: string;\r\n  content?: string;\r\n  summary?: string;\r\n  metadata?: Record<string, unknown>;\r\n  status: 'pending' | 'processing' | 'processed' | 'failed';\r\n  processingError?: string;\r\n  facts_count?: number;\r\n  questions_count?: number;\r\n  created_at: string;\r\n  processed_at?: string;\r\n}\r\n\r\nexport interface UploadResult {\r\n  success: boolean;\r\n  files: Array<{\r\n    filename: string;\r\n    id: string;\r\n    size: number;\r\n    status: string;\r\n  }>;\r\n  totalSize: number;\r\n  processingStarted: boolean;\r\n}\r\n\r\nexport interface ProcessingStatus {\r\n  isProcessing: boolean;\r\n  queueLength: number;\r\n  completedCount: number;\r\n  errorCount: number;\r\n  pendingFiles: string[];\r\n  processingFile?: string;\r\n  completedFiles: string[];\r\n  errors: Array<{ file: string; error: string }>;\r\n}\r\n\r\nexport interface EmbeddingStatus {\r\n  total: number;\r\n  totalChunks?: number;\r\n  embedded: number;\r\n  pending: number;\r\n  failed?: number;\r\n  model?: string;\r\n  models: string[];\r\n  available_embedding_models?: string[];\r\n  lastUpdated?: string;\r\n}\r\n\r\nexport interface KnowledgeItem {\r\n  id: string;\r\n  content: string;\r\n  category?: string;\r\n  source?: string;\r\n  embedding?: number[];\r\n  created_at: string;\r\n}\r\n\r\nexport interface Conversation {\r\n  id: string;\r\n  participants: string[];\r\n  subject?: string;\r\n  summary?: string;\r\n  messages: Array<{\r\n    from: string;\r\n    content: string;\r\n    timestamp: string;\r\n  }>;\r\n  source_file?: string;\r\n  created_at: string;\r\n}\r\n\r\n/**\r\n * Upload files\r\n */\r\nexport async function uploadFiles(files: File[], onProgress?: (progress: number) => void): Promise<UploadResult> {\r\n  const formData = new FormData();\r\n  files.forEach(file => {\r\n    formData.append('files', file);\r\n  });\r\n\r\n  const xhr = new XMLHttpRequest();\r\n  \r\n  return new Promise((resolve, reject) => {\r\n    xhr.upload.addEventListener('progress', (e) => {\r\n      if (e.lengthComputable && onProgress) {\r\n        onProgress(Math.round((e.loaded / e.total) * 100));\r\n      }\r\n    });\r\n\r\n    xhr.addEventListener('load', () => {\r\n      if (xhr.status >= 200 && xhr.status < 300) {\r\n        try {\r\n          resolve(JSON.parse(xhr.responseText));\r\n        } catch {\r\n          reject(new Error('Invalid response'));\r\n        }\r\n      } else {\r\n        reject(new Error(`Upload failed: ${xhr.statusText}`));\r\n      }\r\n    });\r\n\r\n    xhr.addEventListener('error', () => {\r\n      reject(new Error('Upload failed'));\r\n    });\r\n\r\n    xhr.open('POST', '/api/upload');\r\n    xhr.send(formData);\r\n  });\r\n}\r\n\r\n/**\r\n * Upload single file with text extraction\r\n */\r\nexport async function uploadWithExtraction(file: File): Promise<{\r\n  id: string;\r\n  text: string;\r\n  pageCount?: number;\r\n}> {\r\n  const formData = new FormData();\r\n  formData.append('file', file);\r\n\r\n  const response = await fetchWithProject('/api/upload-extract', {\r\n    method: 'POST',\r\n    body: formData,\r\n  });\r\n\r\n  if (!response.ok) {\r\n    throw new Error('Upload failed');\r\n  }\r\n\r\n  return response.json();\r\n}\r\n\r\n/**\r\n * Get processing status\r\n */\r\nexport async function getProcessingStatus(): Promise<ProcessingStatus> {\r\n  const response = await http.get<ProcessingStatus>('/api/processing-status');\r\n  return response.data;\r\n}\r\n\r\nexport interface DocumentsResponse {\r\n  documents: Document[];\r\n  total: number;\r\n  limit?: number;\r\n  offset?: number;\r\n  hasMore?: boolean;\r\n  statuses: {\r\n    processed: number;\r\n    pending: number;\r\n    processing?: number;\r\n    failed: number;\r\n    deleted?: number;\r\n  };\r\n}\r\n\r\n/**\r\n * Get all documents with optional status filter\r\n */\r\nexport interface GetDocumentsOptions {\r\n  status?: string;\r\n  type?: string; // documents, transcripts, emails, images\r\n  search?: string;\r\n  sort?: 'created_at' | 'updated_at' | 'filename';\r\n  order?: 'asc' | 'desc';\r\n  limit?: number;\r\n  offset?: number;\r\n}\r\n\r\nexport async function getDocuments(statusOrOptions?: string | GetDocumentsOptions): Promise<DocumentsResponse> {\r\n  try {\r\n    // Handle both legacy (status string) and new options object\r\n    const options: GetDocumentsOptions = typeof statusOrOptions === 'string' \r\n      ? { status: statusOrOptions }\r\n      : statusOrOptions || {};\r\n    \r\n    const params = new URLSearchParams();\r\n    if (options.status && options.status !== 'all') params.set('status', options.status);\r\n    if (options.type && options.type !== 'all') params.set('type', options.type);\r\n    if (options.search) params.set('search', options.search);\r\n    if (options.sort) params.set('sort', options.sort);\r\n    if (options.order) params.set('order', options.order);\r\n    if (options.limit) params.set('limit', String(options.limit));\r\n    if (options.offset) params.set('offset', String(options.offset));\r\n    \r\n    const queryString = params.toString();\r\n    const url = queryString ? `/api/documents?${queryString}` : '/api/documents';\r\n    \r\n    const response = await http.get<DocumentsResponse>(url);\r\n    return {\r\n      documents: response.data.documents || [],\r\n      total: response.data.total || 0,\r\n      limit: response.data.limit,\r\n      offset: response.data.offset,\r\n      hasMore: response.data.hasMore,\r\n      statuses: response.data.statuses || { processed: 0, pending: 0, failed: 0, deleted: 0 }\r\n    };\r\n  } catch {\r\n    return { documents: [], total: 0, statuses: { processed: 0, pending: 0, failed: 0, deleted: 0 } };\r\n  }\r\n}\r\n\r\n/**\r\n * Get a single document\r\n */\r\nexport async function getDocument(id: string): Promise<Document | null> {\r\n  try {\r\n    const response = await http.get<{ document: Document }>(`/api/documents/${id}`);\r\n    return response.data.document;\r\n  } catch {\r\n    return null;\r\n  }\r\n}\r\n\r\n/**\r\n * Delete a document\r\n */\r\nexport async function deleteDocument(id: string, options?: { softDelete?: boolean }): Promise<void> {\r\n  const params = options?.softDelete ? '?soft=true' : '';\r\n  await http.delete(`/api/documents/${id}${params}`);\r\n}\r\n\r\n/**\r\n * Restore a soft-deleted document\r\n */\r\nexport async function restoreDocument(id: string): Promise<void> {\r\n  await http.post(`/api/documents/${id}/restore`);\r\n  toast.success('Document restored');\r\n}\r\n\r\n/**\r\n * Reprocess a document\r\n */\r\nexport async function reprocessDocument(id: string): Promise<void> {\r\n  await http.post(`/api/documents/${id}/reprocess`);\r\n  toast.info('Document queued for reprocessing');\r\n}\r\n\r\n/**\r\n * Get document summary\r\n */\r\nexport async function getDocumentSummary(id: string): Promise<string> {\r\n  const response = await http.get<{ summary: string }>(`/api/documents/${id}/summary`);\r\n  return response.data.summary || '';\r\n}\r\n\r\n/**\r\n * Get knowledge base items\r\n */\r\nexport async function getKnowledgeBase(category?: string): Promise<KnowledgeItem[]> {\r\n  try {\r\n    const url = category ? `/api/knowledge?category=${category}` : '/api/knowledge';\r\n    const response = await http.get<{ items: KnowledgeItem[] }>(url);\r\n    return response.data.items || [];\r\n  } catch {\r\n    return [];\r\n  }\r\n}\r\n\r\n/**\r\n * Add knowledge item\r\n */\r\nexport async function addKnowledgeItem(content: string, category?: string): Promise<KnowledgeItem> {\r\n  const response = await http.post<{ item: KnowledgeItem; id: string }>('/api/knowledge', {\r\n    content,\r\n    category,\r\n  });\r\n  return response.data.item || { id: response.data.id, content, category, created_at: new Date().toISOString() };\r\n}\r\n\r\n/**\r\n * Search knowledge base\r\n */\r\nexport async function searchKnowledge(query: string, limit = 10): Promise<KnowledgeItem[]> {\r\n  const response = await http.get<{ results: KnowledgeItem[] }>(`/api/knowledge/search?q=${encodeURIComponent(query)}&limit=${limit}`);\r\n  return response.data.results || [];\r\n}\r\n\r\n/**\r\n * Get conversations\r\n */\r\nexport async function getConversations(): Promise<Conversation[]> {\r\n  try {\r\n    const response = await http.get<{ conversations: Conversation[] }>('/api/conversations');\r\n    return response.data.conversations || [];\r\n  } catch {\r\n    return [];\r\n  }\r\n}\r\n\r\n/**\r\n * Get a single conversation\r\n */\r\nexport async function getConversation(id: string): Promise<Conversation | null> {\r\n  try {\r\n    const response = await http.get<{ conversation: Conversation }>(`/api/conversations/${id}`);\r\n    return response.data.conversation;\r\n  } catch {\r\n    return null;\r\n  }\r\n}\r\n\r\n/**\r\n * Parse conversation preview (without saving)\r\n */\r\nexport async function parseConversationPreview(text: string): Promise<{\r\n  message_count: number;\r\n  participants: string[];\r\n  format: string;\r\n  preview: unknown[];\r\n}> {\r\n  const response = await http.post<{\r\n    message_count: number;\r\n    participants: string[];\r\n    format: string;\r\n    preview: unknown[];\r\n  }>('/api/conversations/parse', { text });\r\n  return response.data;\r\n}\r\n\r\n/**\r\n * Import a conversation\r\n */\r\nexport async function importConversation(text: string, options?: { \r\n  skipAI?: boolean; \r\n  formatHint?: string;\r\n  meta?: Record<string, unknown>;\r\n}): Promise<Conversation> {\r\n  const response = await http.post<{ conversation: Conversation }>('/api/conversations', { \r\n    text, \r\n    ...options \r\n  });\r\n  return response.data.conversation;\r\n}\r\n\r\n/**\r\n * Delete a conversation\r\n */\r\nexport async function deleteConversation(id: string): Promise<void> {\r\n  await http.delete(`/api/conversations/${id}`);\r\n}\r\n\r\n/**\r\n * Re-embed a conversation (regenerate embeddings)\r\n */\r\nexport async function reembedConversation(id: string): Promise<void> {\r\n  await http.post(`/api/conversations/${id}/reembed`);\r\n}\r\n\r\n// ==================== Bulk Operations ====================\r\n\r\n/**\r\n * Bulk delete documents\r\n */\r\nexport async function bulkDeleteDocuments(ids: string[]): Promise<{ deleted: number; errors: Array<{ id: string; error: string }> }> {\r\n  const response = await http.post<{ deleted: number; errors: Array<{ id: string; error: string }> }>('/api/documents/bulk/delete', { ids });\r\n  return response.data;\r\n}\r\n\r\n/**\r\n * Bulk reprocess documents\r\n */\r\nexport async function bulkReprocessDocuments(ids: string[]): Promise<{ success: boolean; message: string; ids: string[] }> {\r\n  const response = await http.post<{ success: boolean; message: string; ids: string[] }>('/api/documents/bulk/reprocess', { ids });\r\n  return response.data;\r\n}\r\n\r\n/**\r\n * Bulk export documents as ZIP\r\n */\r\nexport async function bulkExportDocuments(ids: string[], format: 'original' | 'markdown' = 'original'): Promise<Blob> {\r\n  const response = await fetchWithProject('/api/documents/bulk/export', {\r\n    method: 'POST',\r\n    headers: { 'Content-Type': 'application/json' },\r\n    body: JSON.stringify({ ids, format }),\r\n  });\r\n  \r\n  if (!response.ok) {\r\n    throw new Error('Failed to export documents');\r\n  }\r\n  \r\n  return response.blob();\r\n}\r\n\r\n/**\r\n * Download bulk export\r\n */\r\nexport async function downloadBulkExport(ids: string[], format: 'original' | 'markdown' = 'original'): Promise<void> {\r\n  const blob = await bulkExportDocuments(ids, format);\r\n  const url = URL.createObjectURL(blob);\r\n  const a = document.createElement('a');\r\n  a.href = url;\r\n  a.download = `documents_export_${Date.now()}.zip`;\r\n  document.body.appendChild(a);\r\n  a.click();\r\n  document.body.removeChild(a);\r\n  URL.revokeObjectURL(url);\r\n}\r\n\r\nexport const documentsService = {\r\n  upload: uploadFiles,\r\n  uploadWithExtraction,\r\n  getProcessingStatus,\r\n  getAll: getDocuments,\r\n  get: getDocument,\r\n  delete: deleteDocument,\r\n  restore: restoreDocument,\r\n  reprocess: reprocessDocument,\r\n  getSummary: getDocumentSummary,\r\n  // Bulk operations\r\n  bulkDelete: bulkDeleteDocuments,\r\n  bulkReprocess: bulkReprocessDocuments,\r\n  bulkExport: bulkExportDocuments,\r\n  downloadBulkExport,\r\n};\r\n\r\n// Additional knowledge functions\r\nasync function getKnowledgeStatus(): Promise<{\r\n  total: number;\r\n  embedded: number;\r\n  pending: number;\r\n  models: string[];\r\n}> {\r\n  try {\r\n    const response = await http.get<{ status: { total: number; embedded: number; pending: number; models: string[] } }>('/api/knowledge/status');\r\n    return response.data.status;\r\n  } catch {\r\n    return { total: 0, embedded: 0, pending: 0, models: [] };\r\n  }\r\n}\r\n\r\nasync function exportKnowledgeMarkdown(): Promise<string> {\r\n  const response = await http.get<{ markdown: string }>('/api/knowledge/export?format=markdown');\r\n  return response.data.markdown || '';\r\n}\r\n\r\nasync function exportKnowledgeJson(): Promise<KnowledgeItem[]> {\r\n  const response = await http.get<{ items: KnowledgeItem[] }>('/api/knowledge/export?format=json');\r\n  return response.data.items || [];\r\n}\r\n\r\nasync function regenerateKnowledge(): Promise<{ success: boolean; processed: number }> {\r\n  const response = await http.post<{ success: boolean; processed: number }>('/api/knowledge/regenerate');\r\n  return response.data;\r\n}\r\n\r\nasync function synthesizeKnowledge(topic?: string): Promise<{ summary: string; sources: string[] }> {\r\n  const response = await http.post<{ summary: string; sources: string[] }>('/api/knowledge/synthesize', { topic });\r\n  return response.data;\r\n}\r\n\r\nexport const knowledgeService = {\r\n  getAll: getKnowledgeBase,\r\n  add: addKnowledgeItem,\r\n  search: searchKnowledge,\r\n  getStatus: getKnowledgeStatus,\r\n  exportMarkdown: exportKnowledgeMarkdown,\r\n  exportJson: exportKnowledgeJson,\r\n  regenerate: regenerateKnowledge,\r\n  synthesize: synthesizeKnowledge,\r\n};\r\n\r\nexport const conversationsService = {\r\n  getAll: getConversations,\r\n  get: getConversation,\r\n  getById: getConversation, // Alias\r\n  parsePreview: parseConversationPreview,\r\n  import: importConversation,\r\n  delete: deleteConversation,\r\n  reembed: reembedConversation,\r\n};\r\n","/**\r\n * Emails Service\r\n * Handles email management and AI responses\r\n */\r\n\r\nimport { http } from './api';\r\n\r\nexport interface Email {\r\n  id: string;\r\n  message_id?: string;\r\n  from: string;\r\n  from_name?: string;\r\n  from_email?: string;\r\n  to: string[];\r\n  cc?: string[];\r\n  bcc?: string[];\r\n  subject: string;\r\n  body: string;\r\n  body_text?: string;\r\n  body_html?: string;\r\n  date: string;\r\n  thread_id?: string;\r\n  labels?: string[];\r\n  is_read: boolean;\r\n  read?: boolean; // Alias for is_read\r\n  is_starred: boolean;\r\n  has_attachments: boolean;\r\n  attachments?: Array<{\r\n    filename: string;\r\n    mimeType: string;\r\n    size: number;\r\n  }>;\r\n  // Direction and response tracking\r\n  direction?: 'inbound' | 'outbound' | 'internal';\r\n  requires_response?: boolean;\r\n  response_sent?: boolean;\r\n  response_drafted?: boolean;\r\n  draft_response?: string;\r\n  // AI fields\r\n  ai_summary?: string;\r\n  ai_category?: string;\r\n  ai_sentiment?: 'positive' | 'neutral' | 'negative';\r\n  ai_priority?: 'low' | 'medium' | 'high' | 'urgent';\r\n  created_at: string;\r\n}\r\n\r\nexport interface EmailThread {\r\n  id: string;\r\n  subject: string;\r\n  participants: string[];\r\n  message_count: number;\r\n  last_message_date: string;\r\n  messages: Email[];\r\n  summary?: string;\r\n}\r\n\r\nexport interface DraftEmail {\r\n  to: string[];\r\n  cc?: string[];\r\n  bcc?: string[];\r\n  subject: string;\r\n  body: string;\r\n  replyTo?: string;\r\n  threadId?: string;\r\n}\r\n\r\nexport interface AIResponseSuggestion {\r\n  tone: 'professional' | 'friendly' | 'formal' | 'brief';\r\n  response: string;\r\n  confidence: number;\r\n}\r\n\r\n/**\r\n * Get all emails\r\n */\r\nexport async function getEmails(filters?: {\r\n  folder?: string;\r\n  label?: string;\r\n  unread?: boolean;\r\n  starred?: boolean;\r\n  search?: string;\r\n  limit?: number;\r\n  offset?: number;\r\n  direction?: 'inbound' | 'outbound' | 'internal';\r\n}): Promise<{ emails: Email[]; total: number }> {\r\n  try {\r\n    const params = new URLSearchParams();\r\n    if (filters?.folder) params.set('folder', filters.folder);\r\n    if (filters?.label) params.set('label', filters.label);\r\n    if (filters?.unread) params.set('unread', 'true');\r\n    if (filters?.starred) params.set('starred', 'true');\r\n    if (filters?.search) params.set('search', filters.search);\r\n    if (filters?.limit) params.set('limit', String(filters.limit));\r\n    if (filters?.offset) params.set('offset', String(filters.offset));\r\n\r\n    const query = params.toString();\r\n    const url = query ? `/api/emails?${query}` : '/api/emails';\r\n    \r\n    const response = await http.get<{ emails: Email[]; total: number }>(url);\r\n    return response.data;\r\n  } catch {\r\n    return { emails: [], total: 0 };\r\n  }\r\n}\r\n\r\n/**\r\n * Get a single email\r\n */\r\nexport async function getEmail(id: string): Promise<Email | null> {\r\n  try {\r\n    const response = await http.get<{ email: Email }>(`/api/emails/${id}`);\r\n    return response.data.email;\r\n  } catch {\r\n    return null;\r\n  }\r\n}\r\n\r\n/**\r\n * Get email thread\r\n */\r\nexport async function getEmailThread(threadId: string): Promise<EmailThread | null> {\r\n  try {\r\n    const response = await http.get<{ thread: EmailThread }>(`/api/emails/thread/${threadId}`);\r\n    return response.data.thread;\r\n  } catch {\r\n    return null;\r\n  }\r\n}\r\n\r\n/**\r\n * Mark email as read\r\n */\r\nexport async function markAsRead(id: string): Promise<void> {\r\n  await http.put(`/api/emails/${id}/read`);\r\n}\r\n\r\n/**\r\n * Mark email as unread\r\n */\r\nexport async function markAsUnread(id: string): Promise<void> {\r\n  await http.put(`/api/emails/${id}/unread`);\r\n}\r\n\r\n/**\r\n * Star an email\r\n */\r\nexport async function starEmail(id: string): Promise<void> {\r\n  await http.put(`/api/emails/${id}/star`);\r\n}\r\n\r\n/**\r\n * Unstar an email\r\n */\r\nexport async function unstarEmail(id: string): Promise<void> {\r\n  await http.put(`/api/emails/${id}/unstar`);\r\n}\r\n\r\n/**\r\n * Archive an email\r\n */\r\nexport async function archiveEmail(id: string): Promise<void> {\r\n  await http.put(`/api/emails/${id}/archive`);\r\n}\r\n\r\n/**\r\n * Delete an email\r\n */\r\nexport async function deleteEmail(id: string): Promise<void> {\r\n  await http.delete(`/api/emails/${id}`);\r\n}\r\n\r\n/**\r\n * Send an email\r\n */\r\nexport async function sendEmail(draft: DraftEmail): Promise<{ success: boolean; messageId: string }> {\r\n  const response = await http.post<{ success: boolean; messageId: string }>('/api/emails/send', draft);\r\n  return response.data;\r\n}\r\n\r\n/**\r\n * Save as draft\r\n */\r\nexport async function saveDraft(draft: DraftEmail): Promise<{ id: string }> {\r\n  const response = await http.post<{ id: string }>('/api/emails/draft', draft);\r\n  return response.data;\r\n}\r\n\r\n/**\r\n * Generate AI response\r\n */\r\nexport async function generateAIResponse(emailId: string, tone?: string): Promise<AIResponseSuggestion[]> {\r\n  const response = await http.post<{ suggestions: AIResponseSuggestion[] }>(`/api/emails/${emailId}/ai-response`, {\r\n    tone,\r\n  });\r\n  return response.data.suggestions || [];\r\n}\r\n\r\n/**\r\n * Generate AI summary of email\r\n */\r\nexport async function generateSummary(emailId: string): Promise<string> {\r\n  const response = await http.post<{ summary: string }>(`/api/emails/${emailId}/summarize`);\r\n  return response.data.summary || '';\r\n}\r\n\r\n/**\r\n * Categorize email with AI\r\n */\r\nexport async function categorizeEmail(emailId: string): Promise<{\r\n  category: string;\r\n  priority: string;\r\n  sentiment: string;\r\n}> {\r\n  const response = await http.post<{\r\n    category: string;\r\n    priority: string;\r\n    sentiment: string;\r\n  }>(`/api/emails/${emailId}/categorize`);\r\n  return response.data;\r\n}\r\n\r\n/**\r\n * Get email stats\r\n */\r\nexport async function getEmailStats(): Promise<{\r\n  total: number;\r\n  unread: number;\r\n  starred: number;\r\n  today: number;\r\n  byCategory: Record<string, number>;\r\n}> {\r\n  const response = await http.get<{\r\n    total: number;\r\n    unread: number;\r\n    starred: number;\r\n    today: number;\r\n    byCategory: Record<string, number>;\r\n  }>('/api/emails/stats');\r\n  return response.data;\r\n}\r\n\r\n/**\r\n * Sync emails from provider\r\n */\r\nexport async function syncEmails(): Promise<{ synced: number; errors: number }> {\r\n  const response = await http.post<{ synced: number; errors: number }>('/api/emails/sync');\r\n  return response.data;\r\n}\r\n\r\n/**\r\n * Get email by ID (alias for get)\r\n */\r\nexport async function getById(id: string): Promise<Email | null> {\r\n  return getEmail(id);\r\n}\r\n\r\n/**\r\n * Get emails needing response\r\n */\r\nexport async function getNeedingResponse(): Promise<Email[]> {\r\n  try {\r\n    const response = await http.get<{ emails: Email[] }>('/api/emails?requires_response=true&response_sent=false');\r\n    return response.data.emails || [];\r\n  } catch {\r\n    return [];\r\n  }\r\n}\r\n\r\n/**\r\n * Mark email as responded\r\n */\r\nexport async function markResponded(id: string): Promise<void> {\r\n  await http.put(`/api/emails/${id}/responded`);\r\n}\r\n\r\n/**\r\n * Generate response (alias for generateAIResponse)\r\n */\r\nexport async function generateResponse(emailId: string, tone?: string): Promise<AIResponseSuggestion[]> {\r\n  return generateAIResponse(emailId, tone);\r\n}\r\n\r\nexport const emailsService = {\r\n  getAll: getEmails,\r\n  get: getEmail,\r\n  getById,\r\n  getThread: getEmailThread,\r\n  markAsRead,\r\n  markAsUnread,\r\n  star: starEmail,\r\n  unstar: unstarEmail,\r\n  archive: archiveEmail,\r\n  delete: deleteEmail,\r\n  send: sendEmail,\r\n  saveDraft,\r\n  generateAIResponse,\r\n  generateResponse,\r\n  generateSummary,\r\n  categorize: categorizeEmail,\r\n  getStats: getEmailStats,\r\n  sync: syncEmails,\r\n  getNeedingResponse,\r\n  markResponded,\r\n};\r\n","/**\r\n * Graph Service - SOTA Knowledge Graph UI\r\n * Handles knowledge graph, visualization, GraphRAG, analytics, and Supabase persistence\r\n */\r\n\r\nimport { http, fetchWithProject } from './api';\r\n\r\n// ============================================\r\n// TYPES - Graph Data\r\n// ============================================\r\n\r\nexport interface GraphNode {\r\n  id: string;\r\n  label: string;\r\n  name?: string;\r\n  type: string;\r\n  properties?: Record<string, unknown>;\r\n  // Avatar/visual properties\r\n  avatarUrl?: string;\r\n  photoUrl?: string;\r\n  role?: string;\r\n  organization?: string;\r\n  department?: string;\r\n  email?: string;\r\n  // Graph metrics\r\n  connections?: number;\r\n  centrality?: number;\r\n  communityId?: number;\r\n  // Position (for saved layouts)\r\n  x?: number;\r\n  y?: number;\r\n}\r\n\r\nexport interface GraphEdge {\r\n  id: string;\r\n  source: string;\r\n  target: string;\r\n  label: string;\r\n  type: string;\r\n  weight?: number;\r\n  properties?: Record<string, unknown>;\r\n}\r\n\r\nexport interface GraphData {\r\n  nodes: GraphNode[];\r\n  edges: GraphEdge[];\r\n  stats?: GraphStats;\r\n}\r\n\r\nexport interface GraphStats {\r\n  nodeCount: number;\r\n  edgeCount: number;\r\n  density?: number;\r\n  nodeTypes?: Record<string, number>;\r\n  edgeTypes?: Record<string, number>;\r\n  avgConnections?: number;\r\n  communities?: number;\r\n  graphName?: string;\r\n  connected?: boolean;\r\n}\r\n\r\n// ============================================\r\n// TYPES - Ontology\r\n// ============================================\r\n\r\nexport interface OntologyEntityType {\r\n  name: string;\r\n  label: string;\r\n  description?: string;\r\n  icon?: string;\r\n  color?: string;\r\n  sharedEntity?: boolean;\r\n  properties?: Array<{\r\n    name: string;\r\n    type: string;\r\n    required?: boolean;\r\n    searchable?: boolean;\r\n  }>;\r\n  examples?: string[];\r\n}\r\n\r\nexport interface OntologyRelationType {\r\n  name: string;\r\n  label?: string;\r\n  description?: string;\r\n  fromTypes: string[];\r\n  toTypes: string[];\r\n  properties?: Array<{\r\n    name: string;\r\n    type: string;\r\n  }>;\r\n}\r\n\r\nexport interface OntologySchema {\r\n  version: string;\r\n  entityTypes: Record<string, OntologyEntityType>;\r\n  relationTypes: Record<string, OntologyRelationType>;\r\n  queryPatterns?: Record<string, { cypher: string; description: string }>;\r\n}\r\n\r\nexport interface OntologySuggestion {\r\n  id: string;\r\n  type: 'entity' | 'relation';\r\n  name: string;\r\n  description?: string;\r\n  fromTypes?: string[];\r\n  toTypes?: string[];\r\n  properties?: string[];\r\n  source?: string;\r\n  example?: string;\r\n  status: 'pending' | 'approved' | 'rejected';\r\n  createdAt: string;\r\n}\r\n\r\n// ============================================\r\n// TYPES - Analytics\r\n// ============================================\r\n\r\nexport interface Community {\r\n  id: number;\r\n  size: number;\r\n  members: Array<{ id: string; name: string; type: string }>;\r\n  types?: Record<string, number>;\r\n  hub?: { id: string; name: string };\r\n}\r\n\r\nexport interface CentralityMetrics {\r\n  topNodes: Array<{\r\n    id: string;\r\n    name: string;\r\n    type: string;\r\n    connections: number;\r\n    centrality: number;\r\n    avatarUrl?: string;\r\n  }>;\r\n}\r\n\r\nexport interface BridgeNode {\r\n  id: string;\r\n  name: string;\r\n  org1?: string;\r\n  org2?: string;\r\n  connects: number;\r\n}\r\n\r\nexport interface GraphInsight {\r\n  type: string;\r\n  title: string;\r\n  description: string;\r\n  importance: 'low' | 'medium' | 'high';\r\n  relatedNodes?: string[];\r\n}\r\n\r\n// ============================================\r\n// TYPES - GraphRAG\r\n// ============================================\r\n\r\nexport interface GraphRAGResponse {\r\n  ok: boolean;\r\n  answer: string;\r\n  sources: Array<{\r\n    type: string;\r\n    content: string;\r\n    id?: string;\r\n  }>;\r\n  queryType: 'structural' | 'semantic' | 'hybrid';\r\n  cypherGenerated?: string;\r\n  reasoningChain?: Array<{\r\n    step: string;\r\n    input: string;\r\n    output: unknown;\r\n    reasoning?: string;\r\n  }>;\r\n  highlightedNodes?: string[];\r\n  latencyMs: number;\r\n  confidence?: number;\r\n  cached?: boolean;\r\n}\r\n\r\nexport interface MultiHopResult {\r\n  answer: string;\r\n  reasoningChain: Array<{\r\n    step: string;\r\n    input: string;\r\n    output: unknown;\r\n    reasoning?: string;\r\n  }>;\r\n  subQueries?: Array<{ query: string; result: unknown }>;\r\n  confidence: number;\r\n}\r\n\r\n// ============================================\r\n// TYPES - Query\r\n// ============================================\r\n\r\nexport interface CypherQueryResult {\r\n  ok: boolean;\r\n  results: Array<Record<string, unknown>>;\r\n  columns?: string[];\r\n  executionTimeMs?: number;\r\n  error?: string;\r\n}\r\n\r\n// ============================================\r\n// TYPES - Supabase Persistence\r\n// ============================================\r\n\r\nexport interface GraphQueryHistory {\r\n  id: string;\r\n  project_id: string;\r\n  user_id: string;\r\n  query_type: 'cypher' | 'natural_language' | 'visual' | 'template';\r\n  query_text: string;\r\n  query_name?: string;\r\n  generated_cypher?: string;\r\n  result_count?: number;\r\n  execution_time_ms?: number;\r\n  is_favorite: boolean;\r\n  tags?: string[];\r\n  metadata?: Record<string, unknown>;\r\n  created_at: string;\r\n}\r\n\r\nexport interface GraphSavedView {\r\n  id: string;\r\n  project_id: string;\r\n  user_id: string;\r\n  name: string;\r\n  description?: string;\r\n  view_config: {\r\n    filters?: {\r\n      entityTypes?: string[];\r\n      communityIds?: number[];\r\n      dateRange?: { start?: string; end?: string };\r\n    };\r\n    layout?: {\r\n      type: 'physics' | 'hierarchical' | 'manual';\r\n      positions?: Record<string, { x: number; y: number }>;\r\n    };\r\n    zoom?: { scale: number; position: { x: number; y: number } };\r\n    selectedNodes?: string[];\r\n    highlightedPaths?: string[][];\r\n    communityColors?: Record<number, string>;\r\n    showLabels?: boolean;\r\n    showEdgeLabels?: boolean;\r\n  };\r\n  thumbnail_url?: string;\r\n  is_default: boolean;\r\n  is_shared: boolean;\r\n  created_at: string;\r\n  updated_at: string;\r\n}\r\n\r\nexport interface GraphBookmark {\r\n  id: string;\r\n  project_id: string;\r\n  user_id: string;\r\n  node_id: string;\r\n  node_type: string;\r\n  node_label: string;\r\n  node_avatar_url?: string;\r\n  note?: string;\r\n  color?: string;\r\n  sort_order: number;\r\n  created_at: string;\r\n}\r\n\r\nexport interface GraphAnnotation {\r\n  id: string;\r\n  project_id: string;\r\n  user_id: string;\r\n  target_type: 'node' | 'edge' | 'path' | 'region';\r\n  target_id: string;\r\n  target_label?: string;\r\n  content: string;\r\n  annotation_type: 'note' | 'warning' | 'highlight' | 'question' | 'todo';\r\n  color?: string;\r\n  icon?: string;\r\n  is_shared: boolean;\r\n  is_resolved: boolean;\r\n  resolved_at?: string;\r\n  resolved_by?: string;\r\n  metadata?: Record<string, unknown>;\r\n  created_at: string;\r\n  updated_at: string;\r\n}\r\n\r\nexport interface GraphChatMessage {\r\n  id: string;\r\n  project_id: string;\r\n  user_id: string;\r\n  session_id: string;\r\n  role: 'user' | 'assistant' | 'system';\r\n  content: string;\r\n  metadata?: {\r\n    queryType?: string;\r\n    cypherGenerated?: string;\r\n    sources?: unknown[];\r\n    reasoningChain?: unknown[];\r\n    highlightedNodes?: string[];\r\n    executionTimeMs?: number;\r\n    confidence?: number;\r\n    isVoiceInput?: boolean;\r\n  };\r\n  is_pinned: boolean;\r\n  created_at: string;\r\n}\r\n\r\nexport interface GraphSnapshot {\r\n  id: string;\r\n  project_id: string;\r\n  user_id: string;\r\n  name: string;\r\n  description?: string;\r\n  snapshot_type: 'manual' | 'auto' | 'milestone' | 'before_change';\r\n  snapshot_data: {\r\n    nodes: GraphNode[];\r\n    edges: GraphEdge[];\r\n    stats: GraphStats;\r\n    communities?: Community[];\r\n    capturedAt: string;\r\n  };\r\n  node_count: number;\r\n  edge_count: number;\r\n  file_size_bytes?: number;\r\n  is_baseline: boolean;\r\n  tags?: string[];\r\n  created_at: string;\r\n}\r\n\r\n// ============================================\r\n// TYPES - Timeline & Costs (existing)\r\n// ============================================\r\n\r\nexport interface TimelineEvent {\r\n  id: string;\r\n  date: string;\r\n  title: string;\r\n  description?: string;\r\n  content?: string;\r\n  type: 'fact' | 'question' | 'question_answered' | 'decision' | 'risk' | 'action' | 'action_completed' | 'deadline' | 'document' | 'transcript' | 'email' | 'conversation' | 'chat_session';\r\n  entity_id?: string;\r\n  entity_type?: string;\r\n  metadata?: Record<string, unknown>;\r\n  importance?: 'low' | 'medium' | 'high';\r\n  user?: string;\r\n  actor?: string;\r\n  owner?: string;\r\n  icon?: string;\r\n  color?: string;\r\n  status?: string;\r\n}\r\n\r\nexport interface TimelineData {\r\n  events: TimelineEvent[];\r\n  startDate: string;\r\n  endDate: string;\r\n  totalEvents: number;\r\n}\r\n\r\nexport interface LLMCost {\r\n  id: string;\r\n  provider: string;\r\n  model: string;\r\n  operation: string;\r\n  tokens_input: number;\r\n  tokens_output: number;\r\n  cost: number;\r\n  timestamp: string;\r\n  metadata?: Record<string, unknown>;\r\n}\r\n\r\nexport interface CostSummary {\r\n  total: number;\r\n  byProvider: Record<string, number>;\r\n  byModel: Record<string, number>;\r\n  byOperation: Record<string, number>;\r\n  byContext?: Record<string, number>;\r\n  period: { start: string; end: string };\r\n  dailyBreakdown: Array<{ date: string; cost: number; calls: number }>;\r\n  totalInputTokens?: number;\r\n  totalOutputTokens?: number;\r\n  previousPeriodCost?: number | null;\r\n  percentChange?: number | null;\r\n  budgetLimit?: number | null;\r\n  budgetUsedPercent?: number | null;\r\n  budgetAlertTriggered?: boolean;\r\n}\r\n\r\n// ============================================\r\n// GRAPH DATA FUNCTIONS\r\n// ============================================\r\n\r\n/**\r\n * Get visualization data for vis-network\r\n */\r\nexport async function getVisualizationData(options?: {\r\n  types?: string[];\r\n  limit?: number;\r\n  communityId?: number;\r\n}): Promise<{ nodes: GraphNode[]; edges: GraphEdge[] }> {\r\n  try {\r\n    const params = new URLSearchParams();\r\n    if (options?.types?.length) params.set('types', options.types.join(','));\r\n    if (options?.limit) params.set('limit', String(options.limit));\r\n    if (options?.communityId !== undefined) params.set('communityId', String(options.communityId));\r\n\r\n    // First try to get nodes\r\n    const nodesResponse = await http.get<{ ok: boolean; nodes?: GraphNode[]; results?: unknown[] }>(\r\n      `/api/graph/nodes?${params.toString()}`\r\n    );\r\n\r\n    // Then get relationships\r\n    const edgesResponse = await http.get<{ ok: boolean; relationships?: GraphEdge[]; results?: unknown[] }>(\r\n      `/api/graph/relationships?${params.toString()}`\r\n    );\r\n\r\n    const nodes = nodesResponse.data.nodes || nodesResponse.data.results?.map((item) => {\r\n      const r = item as Record<string, unknown>;\r\n      return {\r\n        id: String(r.id || r.nodeId || ''),\r\n        label: String(r.name || r.label || r.title || (r.content as string)?.substring(0, 50) || ''),\r\n        name: String(r.name || ''),\r\n        type: String(r.type || r.label || 'Unknown'),\r\n        avatarUrl: (r.avatarUrl || r.avatar_url || r.photoUrl || r.photo_url) as string | undefined,\r\n        role: r.role as string | undefined,\r\n        organization: r.organization as string | undefined,\r\n        properties: r,\r\n      };\r\n    }) || [];\r\n\r\n    // Map relationships to expected format (from/to -> source/target)\r\n    const rawEdges = edgesResponse.data.relationships || edgesResponse.data.results || [];\r\n    const edges = rawEdges.map((item) => {\r\n      const r = item as Record<string, unknown>;\r\n      return {\r\n        id: String(r.id || `${r.from || r.source}-${r.to || r.target}-${r.type}`),\r\n        source: String(r.from || r.source || ''),\r\n        target: String(r.to || r.target || ''),\r\n        label: String(r.type || r.label || ''),\r\n        type: String(r.type || ''),\r\n      };\r\n    });\r\n\r\n    return { nodes: nodes as GraphNode[], edges: edges as GraphEdge[] };\r\n  } catch (error) {\r\n    console.error('[GraphService] getVisualizationData error:', error);\r\n    return { nodes: [], edges: [] };\r\n  }\r\n}\r\n\r\n/**\r\n * Get graph statistics\r\n */\r\nexport async function getStats(): Promise<GraphStats> {\r\n  try {\r\n    const response = await http.get<{\r\n      ok: boolean;\r\n      stats?: GraphStats;\r\n      nodes?: number;\r\n      relationships?: number;\r\n      enabled?: boolean;\r\n      connected?: boolean;\r\n      graphName?: string;\r\n    }>('/api/graph/status');\r\n\r\n    if (response.data.stats) {\r\n      return {\r\n        ...response.data.stats,\r\n        graphName: response.data.graphName,\r\n        connected: response.data.connected,\r\n      };\r\n    }\r\n\r\n    return {\r\n      nodeCount: response.data.nodes || 0,\r\n      edgeCount: response.data.relationships || 0,\r\n      graphName: response.data.graphName,\r\n      connected: response.data.connected,\r\n    };\r\n  } catch {\r\n    return { nodeCount: 0, edgeCount: 0, connected: false };\r\n  }\r\n}\r\n\r\n/**\r\n * Get knowledge graph data (legacy)\r\n */\r\nexport async function getGraph(options?: {\r\n  type?: string;\r\n  depth?: number;\r\n  limit?: number;\r\n}): Promise<GraphData> {\r\n  try {\r\n    const params = new URLSearchParams();\r\n    if (options?.type) params.set('type', options.type);\r\n    if (options?.depth) params.set('depth', String(options.depth));\r\n    if (options?.limit) params.set('limit', String(options.limit));\r\n\r\n    const query = params.toString();\r\n    const url = query ? `/api/graph?${query}` : '/api/graph';\r\n\r\n    const response = await http.get<GraphData>(url);\r\n    return response.data;\r\n  } catch {\r\n    return { nodes: [], edges: [] };\r\n  }\r\n}\r\n\r\n/**\r\n * Get entity graph (centered on a specific entity)\r\n */\r\nexport async function getEntityGraph(entityId: string, depth = 2): Promise<GraphData> {\r\n  try {\r\n    const response = await http.get<GraphData>(`/api/graph/entity/${entityId}?depth=${depth}`);\r\n    return response.data;\r\n  } catch {\r\n    return { nodes: [], edges: [] };\r\n  }\r\n}\r\n\r\n/**\r\n * Get related entities\r\n */\r\nexport async function getRelatedEntities(entityId: string): Promise<GraphNode[]> {\r\n  try {\r\n    const response = await http.get<{ related: GraphNode[] }>(`/api/graph/related/${entityId}`);\r\n    return response.data.related || [];\r\n  } catch {\r\n    return [];\r\n  }\r\n}\r\n\r\n// ============================================\r\n// ONTOLOGY FUNCTIONS\r\n// ============================================\r\n\r\n/**\r\n * Get full ontology schema\r\n */\r\nexport async function getOntologySchema(): Promise<OntologySchema | null> {\r\n  try {\r\n    const response = await http.get<{ ok: boolean; schema: OntologySchema }>('/api/ontology/schema');\r\n    return response.data.schema || null;\r\n  } catch {\r\n    return null;\r\n  }\r\n}\r\n\r\n/**\r\n * Get entity types\r\n */\r\nexport async function getOntologyEntities(): Promise<OntologyEntityType[]> {\r\n  try {\r\n    const response = await http.get<{ ok: boolean; entityTypes: OntologyEntityType[] }>('/api/ontology/entities');\r\n    return response.data.entityTypes || [];\r\n  } catch {\r\n    return [];\r\n  }\r\n}\r\n\r\n/**\r\n * Get relation types\r\n */\r\nexport async function getOntologyRelations(): Promise<OntologyRelationType[]> {\r\n  try {\r\n    const response = await http.get<{ ok: boolean; relationTypes: OntologyRelationType[] }>('/api/ontology/relations');\r\n    return response.data.relationTypes || [];\r\n  } catch {\r\n    return [];\r\n  }\r\n}\r\n\r\n/**\r\n * Get ontology suggestions\r\n */\r\nexport async function getOntologySuggestions(): Promise<OntologySuggestion[]> {\r\n  try {\r\n    const response = await http.get<{ ok: boolean; suggestions: OntologySuggestion[] }>('/api/ontology/suggestions');\r\n    return response.data.suggestions || [];\r\n  } catch {\r\n    return [];\r\n  }\r\n}\r\n\r\n/**\r\n * Approve ontology suggestion\r\n */\r\nexport async function approveOntologySuggestion(suggestionId: string): Promise<boolean> {\r\n  try {\r\n    const response = await http.post<{ ok: boolean }>(`/api/ontology/suggestions/${suggestionId}/approve`, {});\r\n    return response.data.ok;\r\n  } catch {\r\n    return false;\r\n  }\r\n}\r\n\r\n/**\r\n * Reject ontology suggestion\r\n */\r\nexport async function rejectOntologySuggestion(suggestionId: string): Promise<boolean> {\r\n  try {\r\n    const response = await http.post<{ ok: boolean }>(`/api/ontology/suggestions/${suggestionId}/reject`, {});\r\n    return response.data.ok;\r\n  } catch {\r\n    return false;\r\n  }\r\n}\r\n\r\n// ============================================\r\n// SOTA v2.0 - ONTOLOGY MANAGEMENT\r\n// ============================================\r\n\r\nexport interface OntologyTypeStats {\r\n  entities: Record<string, { count: number; inOntology: boolean }>;\r\n  relations: Record<string, { count: number; inOntology: boolean }>;\r\n  unused: { entities: string[]; relations: string[] };\r\n  notInOntology: { entities: string[]; relations: string[] };\r\n}\r\n\r\nexport interface OntologySyncStatus {\r\n  isListening: boolean;\r\n  syncInProgress: boolean;\r\n  lastSyncAt: string | null;\r\n  pendingChanges: number;\r\n  ontologySource: 'supabase' | 'file' | null;\r\n  graphConnected: boolean;\r\n}\r\n\r\nexport interface OntologyChange {\r\n  id: string;\r\n  change_type: string;\r\n  target_type: string;\r\n  target_name: string;\r\n  old_definition: unknown;\r\n  new_definition: unknown;\r\n  diff: { added: unknown; removed: unknown; modified: unknown } | null;\r\n  reason: string | null;\r\n  source: string;\r\n  changed_at: string;\r\n  changed_by: string | null;\r\n}\r\n\r\nexport interface LLMAnalysisResult {\r\n  analysis: {\r\n    missingInOntology: Array<{ name: string; type: string; count: number; description: string; confidence: number }>;\r\n    unusedInOntology: Array<{ name: string; type: string }>;\r\n    suggestedRelations: Array<{ from: string; to: string; name: string; description: string }>;\r\n    suggestedInferenceRules: Array<{ name: string; description: string; pattern: string }>;\r\n    summary: string;\r\n  };\r\n  suggestions: OntologySuggestion[];\r\n  summary: string;\r\n}\r\n\r\n/**\r\n * Get type usage statistics from the graph\r\n */\r\nexport async function getOntologyTypeStats(): Promise<OntologyTypeStats | null> {\r\n  try {\r\n    const response = await http.get<{ ok: boolean; stats: OntologyTypeStats }>('/api/ontology/stats');\r\n    return response.data.stats || null;\r\n  } catch {\r\n    return null;\r\n  }\r\n}\r\n\r\n/**\r\n * Get ontology sync status (Supabase Graph)\r\n */\r\nexport async function getOntologySyncStatus(): Promise<OntologySyncStatus | null> {\r\n  try {\r\n    const response = await http.get<{ ok: boolean; status: OntologySyncStatus }>('/api/ontology/sync/status');\r\n    return response.data.status || null;\r\n  } catch {\r\n    return null;\r\n  }\r\n}\r\n\r\n/**\r\n * Force sync ontology to graph\r\n */\r\nexport async function forceOntologySync(): Promise<{ ok: boolean; results?: unknown; error?: string }> {\r\n  try {\r\n    const response = await http.post<{ ok: boolean; results?: unknown; error?: string }>('/api/ontology/sync/force', {});\r\n    return response.data;\r\n  } catch (e) {\r\n    return { ok: false, error: String(e) };\r\n  }\r\n}\r\n\r\n/**\r\n * Trigger LLM analysis of graph vs ontology\r\n */\r\nexport async function runLLMAnalysis(): Promise<LLMAnalysisResult | null> {\r\n  try {\r\n    const response = await http.post<{ ok: boolean } & LLMAnalysisResult>('/api/ontology/analyze', {});\r\n    if (response.data.ok) {\r\n      return response.data;\r\n    }\r\n    return null;\r\n  } catch {\r\n    return null;\r\n  }\r\n}\r\n\r\n/**\r\n * Auto-approve high confidence suggestions\r\n */\r\nexport async function autoApproveHighConfidence(threshold = 0.85): Promise<{ approved: number; skipped: number }> {\r\n  try {\r\n    const response = await http.post<{ ok: boolean; approved: number; skipped: number }>(\r\n      '/api/ontology/suggestions/auto-approve',\r\n      { threshold }\r\n    );\r\n    return { approved: response.data.approved || 0, skipped: response.data.skipped || 0 };\r\n  } catch {\r\n    return { approved: 0, skipped: 0 };\r\n  }\r\n}\r\n\r\n/**\r\n * Get ontology change history (audit trail)\r\n */\r\nexport async function getOntologyChanges(options: {\r\n  targetType?: string;\r\n  targetName?: string;\r\n  limit?: number;\r\n} = {}): Promise<OntologyChange[]> {\r\n  try {\r\n    const params = new URLSearchParams();\r\n    if (options.targetType) params.append('targetType', options.targetType);\r\n    if (options.targetName) params.append('targetName', options.targetName);\r\n    if (options.limit) params.append('limit', String(options.limit));\r\n\r\n    const response = await http.get<{ ok: boolean; changes: OntologyChange[] }>(\r\n      `/api/ontology/changes?${params.toString()}`\r\n    );\r\n    return response.data.changes || [];\r\n  } catch {\r\n    return [];\r\n  }\r\n}\r\n\r\n/**\r\n * Migrate schema.json to Supabase\r\n */\r\nexport async function migrateOntologyToSupabase(): Promise<{ success: boolean; counts?: unknown; error?: string }> {\r\n  try {\r\n    const response = await http.post<{ success: boolean; counts?: unknown; error?: string }>(\r\n      '/api/ontology/migrate',\r\n      {}\r\n    );\r\n    return response.data;\r\n  } catch (e) {\r\n    return { success: false, error: String(e) };\r\n  }\r\n}\r\n\r\n// ============================================\r\n// SOTA v2.1 - BACKGROUND WORKER\r\n// ============================================\r\n\r\nexport interface BackgroundWorkerStatus {\r\n  isRunning: boolean;\r\n  hasPendingAnalysis: boolean;\r\n  lastRun: Record<string, string>;\r\n  graphConnected: boolean;\r\n  llmConfigured: boolean;\r\n  thresholds: {\r\n    autoApprove: number;\r\n    minNodesForAnalysis: number;\r\n    analysisDebounceMs: number;\r\n  };\r\n}\r\n\r\nexport interface BackgroundWorkerStats {\r\n  totalExecutions: number;\r\n  byType: Record<string, number>;\r\n  byStatus: { completed: number; failed: number };\r\n  avgDuration: number;\r\n}\r\n\r\nexport interface BackgroundJobExecution {\r\n  type: string;\r\n  startedAt: string;\r\n  completedAt?: string;\r\n  status: string;\r\n  duration?: number;\r\n  results?: unknown;\r\n  error?: string;\r\n}\r\n\r\nexport interface OntologyJob {\r\n  id: string;\r\n  name: string;\r\n  type: string;\r\n  schedule: string;\r\n  enabled: boolean;\r\n  lastRun: string | null;\r\n  nextRun: string | null;\r\n  runCount: number;\r\n}\r\n\r\n/**\r\n * Get background worker status\r\n */\r\nexport async function getBackgroundWorkerStatus(): Promise<{ status: BackgroundWorkerStatus; stats: BackgroundWorkerStats } | null> {\r\n  try {\r\n    const response = await http.get<{ ok: boolean; status: BackgroundWorkerStatus; stats: BackgroundWorkerStats }>(\r\n      '/api/ontology/worker/status'\r\n    );\r\n    if (response.data.ok) {\r\n      return { status: response.data.status, stats: response.data.stats };\r\n    }\r\n    return null;\r\n  } catch {\r\n    return null;\r\n  }\r\n}\r\n\r\n/**\r\n * Trigger background analysis manually\r\n */\r\nexport async function triggerBackgroundAnalysis(\r\n  type: 'full' | 'inference' | 'dedup' | 'auto_approve' | 'gaps',\r\n  config: Record<string, unknown> = {}\r\n): Promise<BackgroundJobExecution | null> {\r\n  try {\r\n    const response = await http.post<{ ok: boolean } & BackgroundJobExecution>(\r\n      '/api/ontology/worker/trigger',\r\n      { type, config }\r\n    );\r\n    if (response.data.ok) {\r\n      return response.data;\r\n    }\r\n    return null;\r\n  } catch {\r\n    return null;\r\n  }\r\n}\r\n\r\n/**\r\n * Get background worker execution log\r\n */\r\nexport async function getBackgroundWorkerLog(options: {\r\n  type?: string;\r\n  status?: string;\r\n  limit?: number;\r\n} = {}): Promise<BackgroundJobExecution[]> {\r\n  try {\r\n    const params = new URLSearchParams();\r\n    if (options.type) params.append('type', options.type);\r\n    if (options.status) params.append('status', options.status);\r\n    if (options.limit) params.append('limit', String(options.limit));\r\n\r\n    const response = await http.get<{ ok: boolean; log: BackgroundJobExecution[] }>(\r\n      `/api/ontology/worker/log?${params.toString()}`\r\n    );\r\n    return response.data.log || [];\r\n  } catch {\r\n    return [];\r\n  }\r\n}\r\n\r\n/**\r\n * Get ontology-related scheduled jobs\r\n */\r\nexport async function getOntologyJobs(): Promise<OntologyJob[]> {\r\n  try {\r\n    const response = await http.get<{ ok: boolean; jobs: OntologyJob[] }>('/api/ontology/jobs');\r\n    return response.data.jobs || [];\r\n  } catch {\r\n    return [];\r\n  }\r\n}\r\n\r\n/**\r\n * Toggle an ontology job (enable/disable)\r\n */\r\nexport async function toggleOntologyJob(jobId: string, enabled?: boolean): Promise<OntologyJob | null> {\r\n  try {\r\n    const response = await http.post<{ ok: boolean; job: OntologyJob }>(\r\n      `/api/ontology/jobs/${jobId}/toggle`,\r\n      { enabled }\r\n    );\r\n    if (response.data.ok) {\r\n      return response.data.job;\r\n    }\r\n    return null;\r\n  } catch {\r\n    return null;\r\n  }\r\n}\r\n\r\n// ============================================\r\n// ONTOLOGY EXTRACTOR (SOTA v2.1)\r\n// ============================================\r\n\r\nexport interface ExtractedOntology {\r\n  version: string;\r\n  extractedAt: string;\r\n  entityTypes: Record<string, {\r\n    label: string;\r\n    description: string;\r\n    properties: Record<string, { type: string; required: boolean; searchable: boolean }>;\r\n    nodeCount: number;\r\n    extractedFrom: string;\r\n  }>;\r\n  relationTypes: Record<string, {\r\n    label: string;\r\n    description: string;\r\n    fromTypes: string[];\r\n    toTypes: string[];\r\n    edgeCount: number;\r\n    extractedFrom: string;\r\n  }>;\r\n}\r\n\r\nexport interface ComplianceResult {\r\n  valid: boolean;\r\n  score: number;\r\n  issues: Array<{\r\n    type: string;\r\n    severity: 'error' | 'warning' | 'info';\r\n    message: string;\r\n    label?: string;\r\n    count?: number;\r\n    suggestion?: string;\r\n  }>;\r\n  stats: {\r\n    totalNodes: number;\r\n    validNodes: number;\r\n    invalidNodes: number;\r\n    unknownTypeNodes: number;\r\n    totalRelationships: number;\r\n    validRelationships: number;\r\n    invalidRelationships: number;\r\n    unknownTypeRelationships: number;\r\n    missingRequiredProperties: number;\r\n    invalidPropertyTypes: number;\r\n  };\r\n}\r\n\r\nexport interface OntologyDiff {\r\n  entitiesOnlyInA: string[];\r\n  entitiesOnlyInB: string[];\r\n  entitiesInBoth: string[];\r\n  relationsOnlyInA: string[];\r\n  relationsOnlyInB: string[];\r\n  relationsInBoth: string[];\r\n}\r\n\r\nexport interface GraphBrowserInfo {\r\n  browserUrl: string;\r\n  isCloud: boolean;\r\n  host: string;\r\n  note: string;\r\n}\r\n\r\n// Alias for backward compatibility\r\nexport type FalkorDBBrowserInfo = GraphBrowserInfo;\r\n\r\n/**\r\n * Extract ontology from graph\r\n */\r\nexport async function extractOntologyFromGraph(): Promise<{ ok: boolean; ontology?: ExtractedOntology; stats?: Record<string, number>; error?: string }> {\r\n  try {\r\n    const response = await http.get<{ ok: boolean; ontology?: ExtractedOntology; stats?: Record<string, number>; error?: string }>('/api/ontology/extract-from-graph');\r\n    return response.data;\r\n  } catch {\r\n    return { ok: false, error: 'Failed to extract ontology' };\r\n  }\r\n}\r\n\r\n/**\r\n * Validate graph compliance against ontology\r\n */\r\nexport async function validateOntologyCompliance(): Promise<ComplianceResult | null> {\r\n  try {\r\n    const response = await http.get<{ ok: boolean } & ComplianceResult>('/api/ontology/validate-compliance');\r\n    if (response.data.ok) {\r\n      return response.data;\r\n    }\r\n    return null;\r\n  } catch {\r\n    return null;\r\n  }\r\n}\r\n\r\n/**\r\n * Get diff between current ontology and graph\r\n */\r\nexport async function getOntologyDiff(): Promise<{ diff: OntologyDiff; extractedOntology: ExtractedOntology } | null> {\r\n  try {\r\n    const response = await http.get<{ ok: boolean; diff: OntologyDiff; extractedOntology: ExtractedOntology }>('/api/ontology/diff');\r\n    if (response.data.ok) {\r\n      return { diff: response.data.diff, extractedOntology: response.data.extractedOntology };\r\n    }\r\n    return null;\r\n  } catch {\r\n    return null;\r\n  }\r\n}\r\n\r\n/**\r\n * Find unused types in ontology\r\n */\r\nexport async function findUnusedOntologyTypes(): Promise<{ entities: string[]; relations: string[] }> {\r\n  try {\r\n    const response = await http.get<{ ok: boolean; unused: { entities: string[]; relations: string[] } }>('/api/ontology/unused-types');\r\n    return response.data.unused || { entities: [], relations: [] };\r\n  } catch {\r\n    return { entities: [], relations: [] };\r\n  }\r\n}\r\n\r\n/**\r\n * Merge extracted ontology with current\r\n */\r\nexport async function mergeOntology(options: {\r\n  ontology?: ExtractedOntology;\r\n  mergeProperties?: boolean;\r\n  mergeEndpoints?: boolean;\r\n  save?: boolean\r\n}): Promise<{ ok: boolean; changes?: Array<{ type: string; name: string }>; saved?: boolean }> {\r\n  try {\r\n    const response = await http.post<{ ok: boolean; changes: Array<{ type: string; name: string }>; saved: boolean }>('/api/ontology/merge', options);\r\n    return response.data;\r\n  } catch {\r\n    return { ok: false };\r\n  }\r\n}\r\n\r\n/**\r\n * Cleanup orphan ontology types\r\n */\r\nexport async function cleanupOntology(options: {\r\n  discardEntitiesWithoutRelations?: boolean;\r\n  discardRelationsWithoutEntities?: boolean;\r\n  save?: boolean;\r\n}): Promise<{ ok: boolean; discardedEntities?: Array<{ name: string }>; discardedRelations?: Array<{ name: string }> }> {\r\n  try {\r\n    const response = await http.post<{ ok: boolean; discardedEntities: Array<{ name: string }>; discardedRelations: Array<{ name: string }> }>('/api/ontology/cleanup', options);\r\n    return response.data;\r\n  } catch {\r\n    return { ok: false };\r\n  }\r\n}\r\n\r\n/**\r\n * Get Graph Browser URL info (legacy - kept for compatibility)\r\n */\r\nexport async function getFalkorDBBrowserInfo(): Promise<FalkorDBBrowserInfo | null> {\r\n  try {\r\n    const response = await http.get<{ ok: boolean } & FalkorDBBrowserInfo>('/api/graph/falkordb-browser');\r\n    if (response.data.ok) {\r\n      return response.data;\r\n    }\r\n    return null;\r\n  } catch {\r\n    return null;\r\n  }\r\n}\r\n\r\nexport interface FalkorDBGraphSyncResult {\r\n  ok: boolean;\r\n  error?: string;\r\n  graphs: string[];\r\n  validGraphs: string[];\r\n  orphanGraphs: string[];\r\n  deleted: string[];\r\n  dryRun: boolean;\r\n}\r\n\r\n/**\r\n * List all graphs in FalkorDB\r\n */\r\nexport async function listAllFalkorDBGraphs(): Promise<{ ok: boolean; graphs: string[] }> {\r\n  try {\r\n    const response = await http.get<{ ok: boolean; graphs: string[] }>('/api/graph/list-all');\r\n    return response.data;\r\n  } catch {\r\n    return { ok: false, graphs: [] };\r\n  }\r\n}\r\n\r\n/**\r\n * Sync graphs with Supabase projects (cleanup orphans)\r\n * @param dryRun - If true, only report what would be deleted without actually deleting\r\n */\r\nexport async function syncFalkorDBGraphs(dryRun = false): Promise<FalkorDBGraphSyncResult> {\r\n  try {\r\n    const response = await http.post<FalkorDBGraphSyncResult>('/api/graph/sync-projects', { dryRun });\r\n    return response.data;\r\n  } catch {\r\n    return { ok: false, error: 'Request failed', graphs: [], validGraphs: [], orphanGraphs: [], deleted: [], dryRun };\r\n  }\r\n}\r\n\r\n/**\r\n * Delete a specific graph\r\n */\r\nexport async function deleteFalkorDBGraph(graphName: string): Promise<{ ok: boolean; error?: string }> {\r\n  try {\r\n    const response = await http.delete<{ ok: boolean; error?: string }>(`/api/graph/delete/${encodeURIComponent(graphName)}`);\r\n    return response.data;\r\n  } catch {\r\n    return { ok: false, error: 'Request failed' };\r\n  }\r\n}\r\n\r\n// ============================================\r\n// ANALYTICS FUNCTIONS\r\n// ============================================\r\n\r\n/**\r\n * Get detected communities\r\n */\r\nexport async function getCommunities(): Promise<Community[]> {\r\n  try {\r\n    const response = await http.get<{ ok: boolean; communities: Community[] }>('/api/graphrag/communities');\r\n    return response.data.communities || [];\r\n  } catch {\r\n    return [];\r\n  }\r\n}\r\n\r\n/**\r\n * Get centrality metrics\r\n */\r\nexport async function getCentrality(): Promise<CentralityMetrics> {\r\n  try {\r\n    const response = await http.get<{ ok: boolean; centrality: CentralityMetrics }>('/api/graphrag/centrality');\r\n    return response.data.centrality || { topNodes: [] };\r\n  } catch {\r\n    return { topNodes: [] };\r\n  }\r\n}\r\n\r\n/**\r\n * Get bridge nodes\r\n */\r\nexport async function getBridges(): Promise<BridgeNode[]> {\r\n  try {\r\n    const response = await http.get<{ ok: boolean; bridges: BridgeNode[] }>('/api/graphrag/bridges');\r\n    return response.data.bridges || [];\r\n  } catch {\r\n    return [];\r\n  }\r\n}\r\n\r\n/**\r\n * Get AI-generated insights\r\n */\r\nexport async function getInsights(): Promise<GraphInsight[]> {\r\n  try {\r\n    const response = await http.get<{ ok: boolean; insights: GraphInsight[] }>('/api/graph/insights');\r\n    return response.data.insights || [];\r\n  } catch {\r\n    return [];\r\n  }\r\n}\r\n\r\n// ============================================\r\n// GRAPHRAG / AI FUNCTIONS\r\n// ============================================\r\n\r\n/**\r\n * Query using GraphRAG\r\n */\r\nexport async function graphRAGQuery(query: string, options?: {\r\n  noCache?: boolean;\r\n}): Promise<GraphRAGResponse> {\r\n  try {\r\n    const response = await http.post<GraphRAGResponse>('/api/graphrag/query', {\r\n      query,\r\n      noCache: options?.noCache,\r\n    });\r\n    return response.data;\r\n  } catch (error) {\r\n    return {\r\n      ok: false,\r\n      answer: 'Failed to process query',\r\n      sources: [],\r\n      queryType: 'hybrid',\r\n      latencyMs: 0,\r\n    };\r\n  }\r\n}\r\n\r\n/**\r\n * Stream GraphRAG response (for AI Copilot)\r\n */\r\nexport function streamGraphRAGQuery(\r\n  query: string,\r\n  onChunk: (chunk: string) => void,\r\n  onComplete: (response: GraphRAGResponse) => void,\r\n  onError: (error: Error) => void\r\n): () => void {\r\n  const controller = new AbortController();\r\n\r\n  fetchWithProject('/api/graphrag/stream', {\r\n    method: 'POST',\r\n    headers: { 'Content-Type': 'application/json' },\r\n    body: JSON.stringify({ query }),\r\n    signal: controller.signal,\r\n  })\r\n    .then(async (response) => {\r\n      if (!response.ok) throw new Error('Stream request failed');\r\n\r\n      const reader = response.body?.getReader();\r\n      if (!reader) throw new Error('No reader available');\r\n\r\n      const decoder = new TextDecoder();\r\n      let fullResponse = '';\r\n\r\n      while (true) {\r\n        const { done, value } = await reader.read();\r\n        if (done) break;\r\n\r\n        const chunk = decoder.decode(value, { stream: true });\r\n        const lines = chunk.split('\\n');\r\n\r\n        for (const line of lines) {\r\n          if (line.startsWith('data: ')) {\r\n            const data = line.slice(6);\r\n            if (data === '[DONE]') {\r\n              onComplete({\r\n                ok: true,\r\n                answer: fullResponse,\r\n                sources: [],\r\n                queryType: 'hybrid',\r\n                latencyMs: 0,\r\n              });\r\n              return;\r\n            }\r\n            try {\r\n              const parsed = JSON.parse(data);\r\n              if (parsed.content) {\r\n                fullResponse += parsed.content;\r\n                onChunk(parsed.content);\r\n              }\r\n            } catch {\r\n              // Not JSON, treat as raw text\r\n              fullResponse += data;\r\n              onChunk(data);\r\n            }\r\n          }\r\n        }\r\n      }\r\n    })\r\n    .catch((error) => {\r\n      if (error.name !== 'AbortError') {\r\n        onError(error);\r\n      }\r\n    });\r\n\r\n  return () => controller.abort();\r\n}\r\n\r\n/**\r\n * Multi-hop reasoning query\r\n */\r\nexport async function multiHopQuery(query: string): Promise<MultiHopResult> {\r\n  try {\r\n    const response = await http.post<{ ok: boolean } & MultiHopResult>('/api/graphrag/multihop', { query });\r\n    return response.data;\r\n  } catch {\r\n    return {\r\n      answer: 'Failed to process multi-hop query',\r\n      reasoningChain: [],\r\n      confidence: 0,\r\n    };\r\n  }\r\n}\r\n\r\n/**\r\n * Explain connection between two nodes (LLM-powered)\r\n */\r\nexport async function explainConnection(nodeId1: string, nodeId2: string): Promise<{\r\n  explanation: string;\r\n  paths: Array<{ nodes: string[]; relationships: string[] }>;\r\n  facts: string[];\r\n}> {\r\n  try {\r\n    const response = await http.post<{\r\n      ok: boolean;\r\n      explanation: string;\r\n      paths: Array<{ nodes: string[]; relationships: string[] }>;\r\n      facts: string[];\r\n    }>('/api/graphrag/explain', { nodeId1, nodeId2 });\r\n    return response.data;\r\n  } catch {\r\n    return { explanation: 'Unable to explain connection', paths: [], facts: [] };\r\n  }\r\n}\r\n\r\n/**\r\n * Summarize selected nodes (LLM-powered)\r\n */\r\nexport async function summarizeSelection(nodeIds: string[]): Promise<{\r\n  summary: string;\r\n  insights: string[];\r\n  suggestedActions: string[];\r\n}> {\r\n  try {\r\n    const response = await http.post<{\r\n      ok: boolean;\r\n      summary: string;\r\n      insights: string[];\r\n      suggestedActions: string[];\r\n    }>('/api/graphrag/summarize', { nodeIds });\r\n    return response.data;\r\n  } catch {\r\n    return { summary: 'Unable to generate summary', insights: [], suggestedActions: [] };\r\n  }\r\n}\r\n\r\n/**\r\n * Natural language filter (LLM-powered)\r\n */\r\nexport async function naturalLanguageFilter(filterText: string): Promise<{\r\n  filters: {\r\n    entityTypes?: string[];\r\n    properties?: Record<string, unknown>;\r\n    cypher?: string;\r\n  };\r\n  explanation: string;\r\n}> {\r\n  try {\r\n    const response = await http.post<{\r\n      ok: boolean;\r\n      filters: {\r\n        entityTypes?: string[];\r\n        properties?: Record<string, unknown>;\r\n        cypher?: string;\r\n      };\r\n      explanation: string;\r\n    }>('/api/graphrag/filter', { filterText });\r\n    return response.data;\r\n  } catch {\r\n    return { filters: {}, explanation: 'Unable to parse filter' };\r\n  }\r\n}\r\n\r\n/**\r\n * Suggest related nodes to explore\r\n */\r\nexport async function suggestRelated(nodeId: string): Promise<Array<{\r\n  node: GraphNode;\r\n  reason: string;\r\n  relevance: number;\r\n}>> {\r\n  try {\r\n    const response = await http.post<{\r\n      ok: boolean;\r\n      suggestions: Array<{ node: GraphNode; reason: string; relevance: number }>;\r\n    }>('/api/graphrag/suggest-related', { nodeId });\r\n    return response.data.suggestions || [];\r\n  } catch {\r\n    return [];\r\n  }\r\n}\r\n\r\n// ============================================\r\n// CYPHER QUERY FUNCTIONS\r\n// ============================================\r\n\r\n/**\r\n * Execute raw Cypher query\r\n */\r\nexport async function executeCypher(cypher: string): Promise<CypherQueryResult> {\r\n  try {\r\n    const response = await http.post<CypherQueryResult>('/api/graph/query', { cypher });\r\n    return response.data;\r\n  } catch (error) {\r\n    return {\r\n      ok: false,\r\n      results: [],\r\n      error: error instanceof Error ? error.message : 'Query failed',\r\n    };\r\n  }\r\n}\r\n\r\n/**\r\n * Get query templates\r\n */\r\nexport async function getQueryTemplates(): Promise<Array<{\r\n  id: string;\r\n  name: string;\r\n  description: string;\r\n  cypher: string;\r\n  category: string;\r\n}>> {\r\n  try {\r\n    const schema = await getOntologySchema();\r\n    if (!schema?.queryPatterns) return [];\r\n\r\n    return Object.entries(schema.queryPatterns).map(([id, pattern]) => ({\r\n      id,\r\n      name: id.replace(/_/g, ' ').replace(/\\b\\w/g, c => c.toUpperCase()),\r\n      description: pattern.description,\r\n      cypher: pattern.cypher,\r\n      category: 'ontology',\r\n    }));\r\n  } catch {\r\n    return [];\r\n  }\r\n}\r\n\r\n// ============================================\r\n// CROSS-PROJECT FUNCTIONS\r\n// ============================================\r\n\r\n/**\r\n * Get list of project graphs\r\n */\r\nexport async function getProjectGraphs(): Promise<Array<{\r\n  graphName: string;\r\n  projectId: string;\r\n  projectName: string;\r\n  nodeCount?: number;\r\n  edgeCount?: number;\r\n}>> {\r\n  try {\r\n    const response = await http.get<{\r\n      ok: boolean; graphs: Array<{\r\n        graphName: string;\r\n        projectId: string;\r\n        projectName: string;\r\n        nodeCount?: number;\r\n        edgeCount?: number;\r\n      }>\r\n    }>('/api/graph/projects');\r\n    return response.data.graphs || [];\r\n  } catch {\r\n    return [];\r\n  }\r\n}\r\n\r\n/**\r\n * Get cross-project entity (shared entities)\r\n */\r\nexport async function getCrossProjectEntities(entityType: string): Promise<Array<{\r\n  entity: GraphNode;\r\n  projects: Array<{ id: string; name: string }>;\r\n}>> {\r\n  try {\r\n    const response = await http.get<{\r\n      ok: boolean;\r\n      entities: Array<{ entity: GraphNode; projects: Array<{ id: string; name: string }> }>;\r\n    }>(`/api/graph/cross-project/${entityType}`);\r\n    return response.data.entities || [];\r\n  } catch {\r\n    return [];\r\n  }\r\n}\r\n\r\n// ============================================\r\n// SUPABASE PERSISTENCE - Query History\r\n// ============================================\r\n\r\n/**\r\n * Save query to history\r\n */\r\nexport async function saveQueryHistory(query: Omit<GraphQueryHistory, 'id' | 'project_id' | 'user_id' | 'created_at'>): Promise<GraphQueryHistory | null> {\r\n  try {\r\n    const response = await http.post<{ ok: boolean; query: GraphQueryHistory }>('/api/graph/queries', query);\r\n    return response.data.query || null;\r\n  } catch {\r\n    return null;\r\n  }\r\n}\r\n\r\n/**\r\n * Get query history\r\n */\r\nexport async function getQueryHistory(options?: {\r\n  limit?: number;\r\n  favoritesOnly?: boolean;\r\n}): Promise<GraphQueryHistory[]> {\r\n  try {\r\n    const params = new URLSearchParams();\r\n    if (options?.limit) params.set('limit', String(options.limit));\r\n    if (options?.favoritesOnly) params.set('favorites', 'true');\r\n\r\n    const response = await http.get<{ ok: boolean; queries: GraphQueryHistory[] }>(\r\n      `/api/graph/queries?${params.toString()}`\r\n    );\r\n    return response.data.queries || [];\r\n  } catch {\r\n    return [];\r\n  }\r\n}\r\n\r\n/**\r\n * Toggle query favorite\r\n */\r\nexport async function toggleQueryFavorite(queryId: string): Promise<boolean> {\r\n  try {\r\n    const response = await http.patch<{ ok: boolean }>(`/api/graph/queries/${queryId}/favorite`, {});\r\n    return response.data.ok;\r\n  } catch {\r\n    return false;\r\n  }\r\n}\r\n\r\n/**\r\n * Delete query from history\r\n */\r\nexport async function deleteQueryHistory(queryId: string): Promise<boolean> {\r\n  try {\r\n    const response = await http.delete<{ ok: boolean }>(`/api/graph/queries/${queryId}`);\r\n    return response.data.ok;\r\n  } catch {\r\n    return false;\r\n  }\r\n}\r\n\r\n// ============================================\r\n// SUPABASE PERSISTENCE - Saved Views\r\n// ============================================\r\n\r\n/**\r\n * Save current view\r\n */\r\nexport async function saveView(view: Omit<GraphSavedView, 'id' | 'project_id' | 'user_id' | 'created_at' | 'updated_at'>): Promise<GraphSavedView | null> {\r\n  try {\r\n    const response = await http.post<{ ok: boolean; view: GraphSavedView }>('/api/graph/views', view);\r\n    return response.data.view || null;\r\n  } catch {\r\n    return null;\r\n  }\r\n}\r\n\r\n/**\r\n * Get saved views\r\n */\r\nexport async function getSavedViews(): Promise<GraphSavedView[]> {\r\n  try {\r\n    const response = await http.get<{ ok: boolean; views: GraphSavedView[] }>('/api/graph/views');\r\n    return response.data.views || [];\r\n  } catch {\r\n    return [];\r\n  }\r\n}\r\n\r\n/**\r\n * Update saved view\r\n */\r\nexport async function updateView(viewId: string, updates: Partial<GraphSavedView>): Promise<boolean> {\r\n  try {\r\n    const response = await http.patch<{ ok: boolean }>(`/api/graph/views/${viewId}`, updates);\r\n    return response.data.ok;\r\n  } catch {\r\n    return false;\r\n  }\r\n}\r\n\r\n/**\r\n * Delete saved view\r\n */\r\nexport async function deleteView(viewId: string): Promise<boolean> {\r\n  try {\r\n    const response = await http.delete<{ ok: boolean }>(`/api/graph/views/${viewId}`);\r\n    return response.data.ok;\r\n  } catch {\r\n    return false;\r\n  }\r\n}\r\n\r\n// ============================================\r\n// SUPABASE PERSISTENCE - Bookmarks\r\n// ============================================\r\n\r\n/**\r\n * Add bookmark\r\n */\r\nexport async function addBookmark(bookmark: Omit<GraphBookmark, 'id' | 'project_id' | 'user_id' | 'created_at'>): Promise<GraphBookmark | null> {\r\n  try {\r\n    const response = await http.post<{ ok: boolean; bookmark: GraphBookmark }>('/api/graph/bookmarks', bookmark);\r\n    return response.data.bookmark || null;\r\n  } catch {\r\n    return null;\r\n  }\r\n}\r\n\r\n/**\r\n * Get bookmarks\r\n */\r\nexport async function getBookmarks(): Promise<GraphBookmark[]> {\r\n  try {\r\n    const response = await http.get<{ ok: boolean; bookmarks: GraphBookmark[] }>('/api/graph/bookmarks');\r\n    return response.data.bookmarks || [];\r\n  } catch {\r\n    return [];\r\n  }\r\n}\r\n\r\n/**\r\n * Update bookmark\r\n */\r\nexport async function updateBookmark(bookmarkId: string, updates: Partial<GraphBookmark>): Promise<boolean> {\r\n  try {\r\n    const response = await http.patch<{ ok: boolean }>(`/api/graph/bookmarks/${bookmarkId}`, updates);\r\n    return response.data.ok;\r\n  } catch {\r\n    return false;\r\n  }\r\n}\r\n\r\n/**\r\n * Remove bookmark\r\n */\r\nexport async function removeBookmark(bookmarkId: string): Promise<boolean> {\r\n  try {\r\n    const response = await http.delete<{ ok: boolean }>(`/api/graph/bookmarks/${bookmarkId}`);\r\n    return response.data.ok;\r\n  } catch {\r\n    return false;\r\n  }\r\n}\r\n\r\n// ============================================\r\n// SUPABASE PERSISTENCE - Annotations\r\n// ============================================\r\n\r\n/**\r\n * Create annotation\r\n */\r\nexport async function createAnnotation(annotation: Omit<GraphAnnotation, 'id' | 'project_id' | 'user_id' | 'created_at' | 'updated_at'>): Promise<GraphAnnotation | null> {\r\n  try {\r\n    const response = await http.post<{ ok: boolean; annotation: GraphAnnotation }>('/api/graph/annotations', annotation);\r\n    return response.data.annotation || null;\r\n  } catch {\r\n    return null;\r\n  }\r\n}\r\n\r\n/**\r\n * Get annotations\r\n */\r\nexport async function getAnnotations(options?: {\r\n  targetType?: string;\r\n  targetId?: string;\r\n  includeShared?: boolean;\r\n}): Promise<GraphAnnotation[]> {\r\n  try {\r\n    const params = new URLSearchParams();\r\n    if (options?.targetType) params.set('targetType', options.targetType);\r\n    if (options?.targetId) params.set('targetId', options.targetId);\r\n    if (options?.includeShared) params.set('includeShared', 'true');\r\n\r\n    const response = await http.get<{ ok: boolean; annotations: GraphAnnotation[] }>(\r\n      `/api/graph/annotations?${params.toString()}`\r\n    );\r\n    return response.data.annotations || [];\r\n  } catch {\r\n    return [];\r\n  }\r\n}\r\n\r\n/**\r\n * Update annotation\r\n */\r\nexport async function updateAnnotation(annotationId: string, updates: Partial<GraphAnnotation>): Promise<boolean> {\r\n  try {\r\n    const response = await http.patch<{ ok: boolean }>(`/api/graph/annotations/${annotationId}`, updates);\r\n    return response.data.ok;\r\n  } catch {\r\n    return false;\r\n  }\r\n}\r\n\r\n/**\r\n * Delete annotation\r\n */\r\nexport async function deleteAnnotation(annotationId: string): Promise<boolean> {\r\n  try {\r\n    const response = await http.delete<{ ok: boolean }>(`/api/graph/annotations/${annotationId}`);\r\n    return response.data.ok;\r\n  } catch {\r\n    return false;\r\n  }\r\n}\r\n\r\n// ============================================\r\n// SUPABASE PERSISTENCE - Chat History\r\n// ============================================\r\n\r\n/**\r\n * Save chat message\r\n */\r\nexport async function saveChatMessage(message: Omit<GraphChatMessage, 'id' | 'project_id' | 'user_id' | 'created_at'>): Promise<GraphChatMessage | null> {\r\n  try {\r\n    const response = await http.post<{ ok: boolean; message: GraphChatMessage }>('/api/graph/chat', message);\r\n    return response.data.message || null;\r\n  } catch {\r\n    return null;\r\n  }\r\n}\r\n\r\n/**\r\n * Get chat sessions\r\n */\r\nexport async function getChatSessions(): Promise<Array<{\r\n  sessionId: string;\r\n  firstMessage: string;\r\n  messageCount: number;\r\n  lastActivity: string;\r\n}>> {\r\n  try {\r\n    const response = await http.get<{\r\n      ok: boolean;\r\n      sessions: Array<{\r\n        sessionId: string;\r\n        firstMessage: string;\r\n        messageCount: number;\r\n        lastActivity: string;\r\n      }>;\r\n    }>('/api/graph/chat/sessions');\r\n    return response.data.sessions || [];\r\n  } catch {\r\n    return [];\r\n  }\r\n}\r\n\r\n/**\r\n * Get chat history for session\r\n */\r\nexport async function getChatHistory(sessionId: string): Promise<GraphChatMessage[]> {\r\n  try {\r\n    const response = await http.get<{ ok: boolean; messages: GraphChatMessage[] }>(\r\n      `/api/graph/chat/session/${sessionId}`\r\n    );\r\n    return response.data.messages || [];\r\n  } catch {\r\n    return [];\r\n  }\r\n}\r\n\r\n/**\r\n * Toggle message pin\r\n */\r\nexport async function toggleChatPin(messageId: string): Promise<boolean> {\r\n  try {\r\n    const response = await http.patch<{ ok: boolean }>(`/api/graph/chat/${messageId}/pin`, {});\r\n    return response.data.ok;\r\n  } catch {\r\n    return false;\r\n  }\r\n}\r\n\r\n// ============================================\r\n// SUPABASE PERSISTENCE - Snapshots\r\n// ============================================\r\n\r\n/**\r\n * Create snapshot\r\n */\r\nexport async function createSnapshot(snapshot: Omit<GraphSnapshot, 'id' | 'project_id' | 'user_id' | 'created_at'>): Promise<GraphSnapshot | null> {\r\n  try {\r\n    const response = await http.post<{ ok: boolean; snapshot: GraphSnapshot }>('/api/graph/snapshots', snapshot);\r\n    return response.data.snapshot || null;\r\n  } catch {\r\n    return null;\r\n  }\r\n}\r\n\r\n/**\r\n * Get snapshots\r\n */\r\nexport async function getSnapshots(): Promise<GraphSnapshot[]> {\r\n  try {\r\n    const response = await http.get<{ ok: boolean; snapshots: GraphSnapshot[] }>('/api/graph/snapshots');\r\n    return response.data.snapshots || [];\r\n  } catch {\r\n    return [];\r\n  }\r\n}\r\n\r\n/**\r\n * Get snapshot by ID\r\n */\r\nexport async function getSnapshot(snapshotId: string): Promise<GraphSnapshot | null> {\r\n  try {\r\n    const response = await http.get<{ ok: boolean; snapshot: GraphSnapshot }>(`/api/graph/snapshots/${snapshotId}`);\r\n    return response.data.snapshot || null;\r\n  } catch {\r\n    return null;\r\n  }\r\n}\r\n\r\n/**\r\n * Compare snapshots\r\n */\r\nexport async function compareSnapshots(snapshotId1: string, snapshotId2: string): Promise<{\r\n  diff: {\r\n    nodesAdded: GraphNode[];\r\n    nodesRemoved: GraphNode[];\r\n    edgesAdded: GraphEdge[];\r\n    edgesRemoved: GraphEdge[];\r\n    statsComparison: {\r\n      nodeCountDiff: number;\r\n      edgeCountDiff: number;\r\n    };\r\n  };\r\n}> {\r\n  try {\r\n    const response = await http.get<{\r\n      ok: boolean;\r\n      diff: {\r\n        nodesAdded: GraphNode[];\r\n        nodesRemoved: GraphNode[];\r\n        edgesAdded: GraphEdge[];\r\n        edgesRemoved: GraphEdge[];\r\n        statsComparison: { nodeCountDiff: number; edgeCountDiff: number };\r\n      };\r\n    }>(`/api/graph/snapshots/compare?id1=${snapshotId1}&id2=${snapshotId2}`);\r\n    return response.data;\r\n  } catch {\r\n    return {\r\n      diff: {\r\n        nodesAdded: [],\r\n        nodesRemoved: [],\r\n        edgesAdded: [],\r\n        edgesRemoved: [],\r\n        statsComparison: { nodeCountDiff: 0, edgeCountDiff: 0 },\r\n      },\r\n    };\r\n  }\r\n}\r\n\r\n/**\r\n * Delete snapshot\r\n */\r\nexport async function deleteSnapshot(snapshotId: string): Promise<boolean> {\r\n  try {\r\n    const response = await http.delete<{ ok: boolean }>(`/api/graph/snapshots/${snapshotId}`);\r\n    return response.data.ok;\r\n  } catch {\r\n    return false;\r\n  }\r\n}\r\n\r\n// ============================================\r\n// TIMELINE FUNCTIONS (existing)\r\n// ============================================\r\n\r\nexport async function getTimeline(options?: {\r\n  startDate?: string;\r\n  endDate?: string;\r\n  types?: string[];\r\n  limit?: number;\r\n}): Promise<TimelineData> {\r\n  try {\r\n    const params = new URLSearchParams();\r\n    if (options?.startDate) params.set('startDate', options.startDate);\r\n    if (options?.endDate) params.set('endDate', options.endDate);\r\n    if (options?.types?.length) params.set('types', options.types.join(','));\r\n    if (options?.limit) params.set('limit', String(options.limit));\r\n\r\n    const query = params.toString();\r\n    const url = query ? `/api/timeline?${query}` : '/api/timeline';\r\n\r\n    const response = await http.get<{\r\n      events?: Array<Record<string, unknown>>;\r\n      totalEvents?: number;\r\n      startDate?: string;\r\n      endDate?: string;\r\n    }>(url);\r\n\r\n    const raw = response.data.events || [];\r\n    const events: TimelineEvent[] = raw.map((e: Record<string, unknown>) => ({\r\n      id: String(e.id ?? ''),\r\n      date: String(e.date ?? ''),\r\n      title: String(e.title ?? ''),\r\n      description: e.content != null ? String(e.content) : undefined,\r\n      content: e.content != null ? String(e.content) : undefined,\r\n      type: (e.type as TimelineEvent['type']) ?? 'document',\r\n      entity_id: e.entity_id != null ? String(e.entity_id) : undefined,\r\n      entity_type: e.entity_type != null ? String(e.entity_type) : undefined,\r\n      metadata: (e.metadata as Record<string, unknown>) ?? undefined,\r\n      user: e.owner != null ? String(e.owner) : e.user as string | undefined,\r\n      actor: e.owner != null ? String(e.owner) : e.actor as string | undefined,\r\n      owner: e.owner != null ? String(e.owner) : undefined,\r\n      icon: e.icon as string | undefined,\r\n      color: e.color as string | undefined,\r\n      status: e.status as string | undefined,\r\n    }));\r\n\r\n    return {\r\n      events,\r\n      totalEvents: response.data.totalEvents ?? events.length,\r\n      startDate: response.data.startDate ?? '',\r\n      endDate: response.data.endDate ?? '',\r\n    };\r\n  } catch {\r\n    return { events: [], startDate: '', endDate: '', totalEvents: 0 };\r\n  }\r\n}\r\n\r\nexport async function getEntityTimeline(entityType: string, entityId: string): Promise<TimelineEvent[]> {\r\n  try {\r\n    const response = await http.get<{ events: TimelineEvent[] }>(`/api/timeline/${entityType}/${entityId}`);\r\n    return response.data.events || [];\r\n  } catch {\r\n    return [];\r\n  }\r\n}\r\n\r\n// ============================================\r\n// COST FUNCTIONS (existing)\r\n// ============================================\r\n\r\nexport async function getCosts(options?: {\r\n  startDate?: string;\r\n  endDate?: string;\r\n  provider?: string;\r\n  model?: string;\r\n}): Promise<LLMCost[]> {\r\n  try {\r\n    const params = new URLSearchParams();\r\n    if (options?.startDate) params.set('startDate', options.startDate);\r\n    if (options?.endDate) params.set('endDate', options.endDate);\r\n    if (options?.provider) params.set('provider', options.provider);\r\n    if (options?.model) params.set('model', options.model);\r\n\r\n    const query = params.toString();\r\n    const url = query ? `/api/costs?${query}` : '/api/costs';\r\n\r\n    const response = await http.get<{ costs: LLMCost[] }>(url);\r\n    return response.data.costs || [];\r\n  } catch {\r\n    return [];\r\n  }\r\n}\r\n\r\nexport async function getCostSummary(period?: 'day' | 'week' | 'month' | 'all'): Promise<CostSummary> {\r\n  try {\r\n    const url = period ? `/api/costs/summary?period=${period}` : '/api/costs/summary';\r\n    const response = await http.get<Record<string, unknown>>(url);\r\n    const raw = response.data;\r\n    if (!raw) {\r\n      return {\r\n        total: 0,\r\n        byProvider: {},\r\n        byModel: {},\r\n        byOperation: {},\r\n        period: { start: '', end: '' },\r\n        dailyBreakdown: [],\r\n      };\r\n    }\r\n    // Normalize snake_case from API to camelCase for frontend\r\n    const dailyBreakdown = (raw.dailyBreakdown ?? raw.daily_breakdown) as Array<{ date: string; cost: number; calls?: number; requests?: number }> | undefined;\r\n    const normalized = (dailyBreakdown ?? []).map((d) => ({\r\n      date: d.date,\r\n      cost: typeof d.cost === 'number' ? d.cost : parseFloat(String(d.cost)) || 0,\r\n      calls: d.calls ?? d.requests ?? 0,\r\n    }));\r\n    return {\r\n      total: typeof raw.total === 'number' ? raw.total : parseFloat(String(raw.total)) || 0,\r\n      byProvider: (raw.byProvider ?? raw.by_provider ?? {}) as Record<string, number>,\r\n      byModel: (raw.byModel ?? raw.by_model ?? {}) as Record<string, number>,\r\n      byOperation: (raw.byOperation ?? raw.by_operation ?? {}) as Record<string, number>,\r\n      byContext: (raw.byContext ?? raw.by_context) as Record<string, number> | undefined,\r\n      period: (raw.period ?? { start: '', end: '' }) as { start: string; end: string },\r\n      dailyBreakdown: normalized,\r\n      totalInputTokens: (raw.totalInputTokens ?? raw.total_input_tokens) as number | undefined,\r\n      totalOutputTokens: (raw.totalOutputTokens ?? raw.total_output_tokens) as number | undefined,\r\n      previousPeriodCost: (raw.previousPeriodCost ?? raw.previous_period_cost) as number | null | undefined,\r\n      percentChange: (raw.percentChange ?? raw.percent_change) as number | null | undefined,\r\n      budgetLimit: (raw.budgetLimit ?? raw.budget_limit) as number | null | undefined,\r\n      budgetUsedPercent: (raw.budgetUsedPercent ?? raw.budget_used_percent) as number | null | undefined,\r\n      budgetAlertTriggered: (raw.budgetAlertTriggered ?? raw.budget_alert_triggered) as boolean | undefined,\r\n    };\r\n  } catch {\r\n    return {\r\n      total: 0,\r\n      byProvider: {},\r\n      byModel: {},\r\n      byOperation: {},\r\n      period: { start: '', end: '' },\r\n      dailyBreakdown: [],\r\n    };\r\n  }\r\n}\r\n\r\nexport interface RecentCostRequest {\r\n  id: string;\r\n  timestamp: string;\r\n  provider: string;\r\n  model: string;\r\n  operation?: string;\r\n  request_type?: string | null;\r\n  input_tokens?: number;\r\n  output_tokens?: number;\r\n  cost?: number;\r\n  latency_ms?: number | null;\r\n  success?: boolean;\r\n}\r\n\r\nexport async function getRecentCostRequests(limit = 20): Promise<RecentCostRequest[]> {\r\n  try {\r\n    const response = await http.get<{ requests: RecentCostRequest[] }>(\r\n      `/api/costs/recent?limit=${limit}`\r\n    );\r\n    return response.data?.requests ?? [];\r\n  } catch {\r\n    return [];\r\n  }\r\n}\r\n\r\nexport interface PricingRow {\r\n  model: string;\r\n  inputPer1M: number;\r\n  outputPer1M: number;\r\n}\r\n\r\nexport async function getCostsPricing(): Promise<PricingRow[]> {\r\n  try {\r\n    const response = await http.get<{ pricing: PricingRow[] }>('/api/costs/pricing');\r\n    return response.data?.pricing ?? [];\r\n  } catch {\r\n    return [];\r\n  }\r\n}\r\n\r\nexport interface CostBudget {\r\n  period: 'week' | 'month';\r\n  limitUsd: number;\r\n  alertThresholdPercent: number;\r\n  notifiedAt?: string | null;\r\n}\r\n\r\nexport async function getCostsBudget(period: 'week' | 'month'): Promise<CostBudget | null> {\r\n  try {\r\n    const response = await http.get<{ budget: Record<string, unknown> | null }>(\r\n      `/api/costs/budget?period=${period}`\r\n    );\r\n    const raw = response.data?.budget;\r\n    if (!raw) return null;\r\n    const limitUsd = (raw.limitUsd ?? raw.limit_usd) as number | undefined;\r\n    const alertThresholdPercent = (raw.alertThresholdPercent ?? raw.alert_threshold_percent) as number | undefined;\r\n    if (limitUsd == null || !Number.isFinite(Number(limitUsd))) return null;\r\n    return {\r\n      period: (raw.period as 'week' | 'month') ?? period,\r\n      limitUsd: Number(limitUsd),\r\n      alertThresholdPercent: alertThresholdPercent != null ? Math.min(100, Math.max(0, Number(alertThresholdPercent))) : 80,\r\n      notifiedAt: (raw.notifiedAt ?? raw.notified_at) as string | null | undefined,\r\n    };\r\n  } catch {\r\n    return null;\r\n  }\r\n}\r\n\r\nexport async function setCostsBudget(\r\n  period: 'week' | 'month',\r\n  limitUsd: number,\r\n  alertThresholdPercent: number\r\n): Promise<void> {\r\n  await http.post('/api/costs/budget', {\r\n    period,\r\n    limitUsd,\r\n    alertThresholdPercent,\r\n  });\r\n}\r\n\r\nexport async function getLLMConfig(): Promise<{\r\n  provider: string;\r\n  model: string;\r\n  available: string[];\r\n  limits?: Record<string, number>;\r\n}> {\r\n  try {\r\n    const response = await http.get<{\r\n      provider: string;\r\n      model: string;\r\n      available: string[];\r\n      limits?: Record<string, number>;\r\n    }>('/api/llm/config');\r\n    return response.data;\r\n  } catch {\r\n    return { provider: 'unknown', model: 'unknown', available: [] };\r\n  }\r\n}\r\n\r\n// ============================================\r\n// SERVICE EXPORTS\r\n// ============================================\r\n\r\nexport const graphService = {\r\n  // Data\r\n  getVisualizationData,\r\n  getStats,\r\n  getGraph,\r\n  getEntityGraph,\r\n  getRelated: getRelatedEntities,\r\n\r\n  // Ontology\r\n  getOntologySchema,\r\n  getOntologyEntities,\r\n  getOntologyRelations,\r\n  getOntologySuggestions,\r\n  approveOntologySuggestion,\r\n  rejectOntologySuggestion,\r\n\r\n  // Ontology SOTA v2.0\r\n  getOntologyTypeStats,\r\n  getOntologySyncStatus,\r\n  forceOntologySync,\r\n  runLLMAnalysis,\r\n  autoApproveHighConfidence,\r\n  getOntologyChanges,\r\n  migrateOntologyToSupabase,\r\n\r\n  // Background Worker (SOTA v2.1)\r\n  getBackgroundWorkerStatus,\r\n  triggerBackgroundAnalysis,\r\n  getBackgroundWorkerLog,\r\n  getOntologyJobs,\r\n  toggleOntologyJob,\r\n\r\n  // Ontology Extractor (SOTA v2.1)\r\n  extractOntologyFromGraph,\r\n  validateOntologyCompliance,\r\n  getOntologyDiff,\r\n  findUnusedOntologyTypes,\r\n  mergeOntology,\r\n  cleanupOntology,\r\n  getFalkorDBBrowserInfo,\r\n\r\n  // Graph Management (legacy names kept for compatibility)\r\n  listAllFalkorDBGraphs,\r\n  syncFalkorDBGraphs,\r\n  deleteFalkorDBGraph,\r\n\r\n  // Analytics\r\n  getCommunities,\r\n  getCentrality,\r\n  getBridges,\r\n  getInsights,\r\n\r\n  // GraphRAG / AI\r\n  query: graphRAGQuery,\r\n  stream: streamGraphRAGQuery,\r\n  multiHop: multiHopQuery,\r\n  explainConnection,\r\n  summarizeSelection,\r\n  naturalLanguageFilter,\r\n  suggestRelated,\r\n\r\n  // Cypher\r\n  executeCypher,\r\n  getQueryTemplates,\r\n\r\n  // Cross-project\r\n  getProjectGraphs,\r\n  getCrossProjectEntities,\r\n\r\n  // Persistence - Queries\r\n  saveQueryHistory,\r\n  getQueryHistory,\r\n  toggleQueryFavorite,\r\n  deleteQueryHistory,\r\n\r\n  // Persistence - Views\r\n  saveView,\r\n  getSavedViews,\r\n  updateView,\r\n  deleteView,\r\n\r\n  // Persistence - Bookmarks\r\n  addBookmark,\r\n  getBookmarks,\r\n  updateBookmark,\r\n  removeBookmark,\r\n\r\n  // Persistence - Annotations\r\n  createAnnotation,\r\n  getAnnotations,\r\n  updateAnnotation,\r\n  deleteAnnotation,\r\n\r\n  // Persistence - Chat\r\n  saveChatMessage,\r\n  getChatSessions,\r\n  getChatHistory,\r\n  toggleChatPin,\r\n\r\n  // Persistence - Snapshots\r\n  createSnapshot,\r\n  getSnapshots,\r\n  getSnapshot,\r\n  compareSnapshots,\r\n  deleteSnapshot,\r\n};\r\n\r\nexport const timelineService = {\r\n  getAll: getTimeline,\r\n  getTimeline, // Direct export for backwards compatibility\r\n  getForEntity: getEntityTimeline,\r\n};\r\n\r\nexport const costsService = {\r\n  getAll: getCosts,\r\n  getSummary: getCostSummary,\r\n  getRecentRequests: getRecentCostRequests,\r\n  getPricing: getCostsPricing,\r\n  getBudget: getCostsBudget,\r\n  setBudget: setCostsBudget,\r\n  getLLMConfig,\r\n};\r\n","/**\r\n * Notifications Service\r\n * Handles notifications and collaboration features\r\n */\r\n\r\nimport { http } from './api';\r\n\r\nexport interface Notification {\r\n  id: string;\r\n  type: 'info' | 'warning' | 'success' | 'error' | 'mention' | 'assignment' | 'update' | 'reminder';\r\n  title: string;\r\n  message: string;\r\n  entity_type?: 'question' | 'risk' | 'action' | 'decision' | 'document' | 'contact' | 'project';\r\n  entity_id?: string;\r\n  is_read: boolean;\r\n  read?: boolean; // Alias for is_read\r\n  created_at: string;\r\n  read_at?: string;\r\n  action_url?: string;\r\n}\r\n\r\nexport interface Comment {\r\n  id: string;\r\n  entity_type: 'question' | 'risk' | 'action' | 'decision' | 'document' | 'contact';\r\n  entity_id: string;\r\n  content: string;\r\n  author: string;\r\n  author_id?: string;\r\n  user_id?: string;\r\n  user_name?: string;\r\n  mentions?: string[];\r\n  reactions?: Array<{\r\n    emoji: string;\r\n    users: string[];\r\n  }>;\r\n  parent_id?: string;\r\n  replies?: Comment[];\r\n  resolved?: boolean;\r\n  resolved_at?: string;\r\n  resolved_by?: string;\r\n  created_at: string;\r\n  updated_at?: string;\r\n  is_edited: boolean;\r\n}\r\n\r\nexport interface ProjectMember {\r\n  id: string;\r\n  user_id: string;\r\n  project_id: string;\r\n  role: 'owner' | 'admin' | 'editor' | 'viewer';\r\n  email: string;\r\n  name?: string;\r\n  avatar_url?: string;\r\n  joined_at: string;\r\n  invited_by?: string;\r\n  last_active?: string;\r\n}\r\n\r\n/**\r\n * Get all notifications\r\n */\r\nexport async function getNotifications(options?: {\r\n  unread?: boolean;\r\n  type?: string;\r\n  limit?: number;\r\n}): Promise<Notification[]> {\r\n  try {\r\n    const params = new URLSearchParams();\r\n    if (options?.unread) params.set('unread', 'true');\r\n    if (options?.type) params.set('type', options.type);\r\n    if (options?.limit) params.set('limit', String(options.limit));\r\n\r\n    const query = params.toString();\r\n    const url = query ? `/api/notifications?${query}` : '/api/notifications';\r\n\r\n    const response = await http.get<{ notifications: Notification[] }>(url);\r\n    return response.data.notifications || [];\r\n  } catch {\r\n    return [];\r\n  }\r\n}\r\n\r\n/**\r\n * Get unread count\r\n */\r\nexport async function getUnreadCount(): Promise<number> {\r\n  try {\r\n    const response = await http.get<{ count: number }>('/api/notifications/count');\r\n    return response.data.count || 0;\r\n  } catch {\r\n    return 0;\r\n  }\r\n}\r\n\r\n/**\r\n * Mark notification as read\r\n */\r\nexport async function markAsRead(id: string): Promise<void> {\r\n  await http.post(`/api/notifications/${id}/read`);\r\n}\r\n\r\n/**\r\n * Mark all as read\r\n */\r\nexport async function markAllAsRead(): Promise<void> {\r\n  await http.post('/api/notifications/read-all');\r\n}\r\n\r\n/**\r\n * Delete a notification\r\n */\r\nexport async function deleteNotification(id: string): Promise<void> {\r\n  await http.delete(`/api/notifications/${id}`);\r\n}\r\n\r\n/**\r\n * Get comments for an entity\r\n */\r\nexport async function getComments(entityType: string, entityId: string): Promise<Comment[]> {\r\n  try {\r\n    const response = await http.get<{ comments: Comment[] }>(`/api/comments/${entityType}/${entityId}`);\r\n    return response.data.comments || [];\r\n  } catch {\r\n    return [];\r\n  }\r\n}\r\n\r\n/**\r\n * Add a comment\r\n */\r\nexport async function addComment(entityType: string, entityId: string, content: string, parentId?: string): Promise<Comment> {\r\n  const response = await http.post<{ comment: Comment; id: string }>(`/api/comments/${entityType}/${entityId}`, {\r\n    content,\r\n    parentId,\r\n  });\r\n  return response.data.comment || {\r\n    id: response.data.id,\r\n    entity_type: entityType as Comment['entity_type'],\r\n    entity_id: entityId,\r\n    content,\r\n    author: 'You',\r\n    created_at: new Date().toISOString(),\r\n    is_edited: false,\r\n  };\r\n}\r\n\r\n/**\r\n * Update a comment\r\n */\r\nexport async function updateComment(commentId: string, content: string): Promise<void> {\r\n  await http.put(`/api/comments/${commentId}`, { content });\r\n}\r\n\r\n/**\r\n * Delete a comment\r\n */\r\nexport async function deleteComment(commentId: string): Promise<void> {\r\n  await http.delete(`/api/comments/${commentId}`);\r\n}\r\n\r\n/**\r\n * Add reaction to comment\r\n */\r\nexport async function addReaction(commentId: string, emoji: string): Promise<void> {\r\n  await http.post(`/api/comments/${commentId}/react`, { emoji });\r\n}\r\n\r\n/**\r\n * Remove reaction from comment\r\n */\r\nexport async function removeReaction(commentId: string, emoji: string): Promise<void> {\r\n  await http.delete(`/api/comments/${commentId}/react/${emoji}`);\r\n}\r\n\r\n/**\r\n * Create comment (alias for addComment)\r\n */\r\nexport async function createComment(entityType: string, entityId: string, content: string, parentId?: string): Promise<Comment> {\r\n  return addComment(entityType, entityId, content, parentId);\r\n}\r\n\r\n/**\r\n * Resolve a comment thread\r\n */\r\nexport async function resolveComment(commentId: string): Promise<void> {\r\n  await http.put(`/api/comments/${commentId}/resolve`);\r\n}\r\n\r\n/**\r\n * Get project members\r\n */\r\nexport async function getProjectMembers(projectId?: string): Promise<ProjectMember[]> {\r\n  try {\r\n    const url = projectId ? `/api/projects/${projectId}/members` : '/api/project/members';\r\n    const response = await http.get<{ members: ProjectMember[] }>(url);\r\n    return response.data.members || [];\r\n  } catch {\r\n    return [];\r\n  }\r\n}\r\n\r\n/**\r\n * Invite member to project\r\n */\r\nexport async function inviteMember(email: string, role: 'admin' | 'editor' | 'viewer', projectId?: string): Promise<{ success: boolean; inviteId: string }> {\r\n  const url = projectId ? `/api/projects/${projectId}/members` : '/api/project/members';\r\n  const response = await http.post<{ success: boolean; inviteId: string }>(url, { email, role });\r\n  return response.data;\r\n}\r\n\r\n/**\r\n * Update member role\r\n */\r\nexport async function updateMemberRole(memberId: string, role: 'admin' | 'editor' | 'viewer', projectId?: string): Promise<void> {\r\n  const url = projectId ? `/api/projects/${projectId}/members/${memberId}` : `/api/project/members/${memberId}`;\r\n  await http.put(url, { role });\r\n}\r\n\r\n/**\r\n * Remove member from project\r\n */\r\nexport async function removeMember(memberId: string, projectId?: string): Promise<void> {\r\n  const url = projectId ? `/api/projects/${projectId}/members/${memberId}` : `/api/project/members/${memberId}`;\r\n  await http.delete(url);\r\n}\r\n\r\nexport const notificationsService = {\r\n  getAll: getNotifications,\r\n  getUnreadCount,\r\n  markAsRead,\r\n  markRead: markAsRead, // Alias\r\n  markAllAsRead,\r\n  markAllRead: markAllAsRead, // Alias\r\n  delete: deleteNotification,\r\n};\r\n\r\nexport const commentsService = {\r\n  getAll: getComments,\r\n  add: addComment,\r\n  create: createComment,\r\n  update: updateComment,\r\n  delete: deleteComment,\r\n  addReaction,\r\n  removeReaction,\r\n  resolve: resolveComment,\r\n};\r\n\r\nexport interface PendingInvite {\r\n  id: string;\r\n  email: string;\r\n  role: 'admin' | 'editor' | 'viewer';\r\n  invited_at: string;\r\n  created_at?: string;\r\n  invited_by?: string;\r\n  status: 'pending' | 'accepted' | 'expired';\r\n}\r\n\r\n/**\r\n * Get pending invites for a project\r\n */\r\nexport async function getInvites(projectId?: string): Promise<PendingInvite[]> {\r\n  try {\r\n    const url = projectId ? `/api/projects/${projectId}/invites` : '/api/project/invites';\r\n    const response = await http.get<{ invites: PendingInvite[] }>(url);\r\n    return response.data.invites || [];\r\n  } catch {\r\n    return [];\r\n  }\r\n}\r\n\r\nexport const membersService = {\r\n  getAll: getProjectMembers,\r\n  invite: inviteMember,\r\n  updateRole: updateMemberRole,\r\n  remove: removeMember,\r\n  getInvites,\r\n};\r\n","/**\r\n * Settings Service\r\n * Handles user settings, API keys, webhooks, and audit logs\r\n */\r\n\r\nimport { http, fetchWithProject } from './api';\r\n\r\nexport interface UserSettings {\r\n  theme?: 'light' | 'dark' | 'system';\r\n  language?: string;\r\n  timezone?: string;\r\n  notifications?: {\r\n    email: boolean;\r\n    browser: boolean;\r\n    mentions: boolean;\r\n    updates: boolean;\r\n  };\r\n  display?: {\r\n    density: 'compact' | 'comfortable' | 'spacious';\r\n    sidebarCollapsed: boolean;\r\n  };\r\n  ai?: {\r\n    model?: string;\r\n    temperature?: number;\r\n    autoSuggest: boolean;\r\n  };\r\n}\r\n\r\nexport interface ProjectSettings {\r\n  name: string;\r\n  description?: string;\r\n  userRole?: string;\r\n  userRolePrompt?: string;\r\n  llm?: {\r\n    provider: string;\r\n    model: string;\r\n  };\r\n  processing?: {\r\n    autoExtractFacts: boolean;\r\n    autoCreateQuestions: boolean;\r\n    deduplication: boolean;\r\n  };\r\n  notifications?: {\r\n    dailyBriefing: boolean;\r\n    overdueAlerts: boolean;\r\n  };\r\n}\r\n\r\nexport interface APIKey {\r\n  id: string;\r\n  name: string;\r\n  key_prefix: string;\r\n  permissions: string[];\r\n  last_used?: string;\r\n  expires_at?: string;\r\n  created_at: string;\r\n  is_active: boolean;\r\n}\r\n\r\nexport interface Webhook {\r\n  id: string;\r\n  name: string;\r\n  url: string;\r\n  events: string[];\r\n  secret?: string;\r\n  is_active: boolean;\r\n  last_triggered?: string;\r\n  failure_count: number;\r\n  created_at: string;\r\n}\r\n\r\nexport interface AuditLogEntry {\r\n  id: string;\r\n  action: string;\r\n  entity_type: string;\r\n  entity_id: string;\r\n  user_id?: string;\r\n  user_email?: string;\r\n  changes?: Record<string, { old: unknown; new: unknown }>;\r\n  metadata?: Record<string, unknown>;\r\n  ip_address?: string;\r\n  user_agent?: string;\r\n  timestamp: string;\r\n}\r\n\r\n/**\r\n * Get user settings\r\n */\r\nexport async function getUserSettings(): Promise<UserSettings> {\r\n  try {\r\n    const response = await http.get<UserSettings>('/api/settings');\r\n    return response.data;\r\n  } catch {\r\n    return {};\r\n  }\r\n}\r\n\r\n/**\r\n * Update user settings\r\n */\r\nexport async function updateUserSettings(settings: Partial<UserSettings>): Promise<void> {\r\n  await http.put('/api/settings', settings);\r\n}\r\n\r\n/**\r\n * Get project settings\r\n */\r\nexport async function getProjectSettings(projectId?: string): Promise<ProjectSettings | null> {\r\n  try {\r\n    const url = projectId ? `/api/projects/${projectId}/settings` : '/api/project/settings';\r\n    const response = await http.get<{ settings: ProjectSettings }>(url);\r\n    return response.data.settings;\r\n  } catch {\r\n    return null;\r\n  }\r\n}\r\n\r\n/**\r\n * Update project settings\r\n */\r\nexport async function updateProjectSettings(settings: Partial<ProjectSettings>, projectId?: string): Promise<void> {\r\n  const url = projectId ? `/api/projects/${projectId}/settings` : '/api/project/settings';\r\n  await http.put(url, settings);\r\n}\r\n\r\n/**\r\n * Get API keys\r\n */\r\nexport async function getAPIKeys(): Promise<APIKey[]> {\r\n  try {\r\n    const response = await http.get<{ keys: APIKey[] }>('/api/api-keys');\r\n    return response.data.keys || [];\r\n  } catch {\r\n    return [];\r\n  }\r\n}\r\n\r\n/**\r\n * Create API key\r\n */\r\nexport async function createAPIKey(name: string, permissions: string[]): Promise<{ key: string; id: string }> {\r\n  const response = await http.post<{ key: string; id: string }>('/api/api-keys', { name, permissions });\r\n  return response.data;\r\n}\r\n\r\n/**\r\n * Revoke API key\r\n */\r\nexport async function revokeAPIKey(id: string): Promise<void> {\r\n  await http.delete(`/api/api-keys/${id}`);\r\n}\r\n\r\n/**\r\n * Get webhooks\r\n */\r\nexport async function getWebhooks(): Promise<Webhook[]> {\r\n  try {\r\n    const response = await http.get<{ webhooks: Webhook[] }>('/api/webhooks');\r\n    return response.data.webhooks || [];\r\n  } catch {\r\n    return [];\r\n  }\r\n}\r\n\r\n/**\r\n * Create webhook\r\n */\r\nexport async function createWebhook(webhook: {\r\n  name: string;\r\n  url: string;\r\n  events: string[];\r\n  secret?: string;\r\n}): Promise<Webhook> {\r\n  const response = await http.post<{ webhook: Webhook; id: string }>('/api/webhooks', webhook);\r\n  return response.data.webhook || { ...webhook, id: response.data.id, is_active: true, failure_count: 0, created_at: new Date().toISOString() };\r\n}\r\n\r\n/**\r\n * Update webhook\r\n */\r\nexport async function updateWebhook(id: string, updates: Partial<Webhook>): Promise<void> {\r\n  await http.put(`/api/webhooks/${id}`, updates);\r\n}\r\n\r\n/**\r\n * Delete webhook\r\n */\r\nexport async function deleteWebhook(id: string): Promise<void> {\r\n  await http.delete(`/api/webhooks/${id}`);\r\n}\r\n\r\n/**\r\n * Test webhook\r\n */\r\nexport async function testWebhook(id: string): Promise<{ success: boolean; status: number; response?: string }> {\r\n  const response = await http.post<{ success: boolean; status: number; response?: string }>(`/api/webhooks/${id}/test`);\r\n  return response.data;\r\n}\r\n\r\n/**\r\n * Get audit logs\r\n */\r\nexport async function getAuditLogs(options?: {\r\n  action?: string;\r\n  entity_type?: string;\r\n  user_id?: string;\r\n  startDate?: string;\r\n  endDate?: string;\r\n  limit?: number;\r\n  offset?: number;\r\n}): Promise<{ logs: AuditLogEntry[]; total: number }> {\r\n  try {\r\n    const params = new URLSearchParams();\r\n    if (options?.action) params.set('action', options.action);\r\n    if (options?.entity_type) params.set('entity_type', options.entity_type);\r\n    if (options?.user_id) params.set('user_id', options.user_id);\r\n    if (options?.startDate) params.set('startDate', options.startDate);\r\n    if (options?.endDate) params.set('endDate', options.endDate);\r\n    if (options?.limit) params.set('limit', String(options.limit));\r\n    if (options?.offset) params.set('offset', String(options.offset));\r\n\r\n    const query = params.toString();\r\n    const url = query ? `/api/audit?${query}` : '/api/audit';\r\n\r\n    const response = await http.get<{ logs: AuditLogEntry[]; total: number }>(url);\r\n    return response.data;\r\n  } catch {\r\n    return { logs: [], total: 0 };\r\n  }\r\n}\r\n\r\n/**\r\n * Export audit logs\r\n */\r\nexport async function exportAuditLogs(format: 'json' | 'csv', options?: {\r\n  startDate?: string;\r\n  endDate?: string;\r\n}): Promise<Blob> {\r\n  const params = new URLSearchParams();\r\n  params.set('format', format);\r\n  if (options?.startDate) params.set('startDate', options.startDate);\r\n  if (options?.endDate) params.set('endDate', options.endDate);\r\n\r\n  const response = await fetchWithProject(`/api/audit/export?${params.toString()}`);\r\n  if (!response.ok) throw new Error('Export failed');\r\n  return response.blob();\r\n}\r\n\r\nexport const userSettingsService = {\r\n  get: getUserSettings,\r\n  update: updateUserSettings,\r\n};\r\n\r\nexport const projectSettingsService = {\r\n  get: getProjectSettings,\r\n  update: updateProjectSettings,\r\n};\r\n\r\nexport const apiKeysService = {\r\n  getAll: getAPIKeys,\r\n  create: createAPIKey,\r\n  revoke: revokeAPIKey,\r\n};\r\n\r\nexport const webhooksService = {\r\n  getAll: getWebhooks,\r\n  create: createWebhook,\r\n  update: updateWebhook,\r\n  delete: deleteWebhook,\r\n  test: testWebhook,\r\n};\r\n\r\nexport const auditService = {\r\n  getAll: getAuditLogs,\r\n  export: exportAuditLogs,\r\n};\r\n","/**\n * Profile Service\n * Handles user profile management\n */\n\nimport { http, fetchWithProject } from './api';\nimport { appStore, User } from '../stores/app';\n\nexport interface UserProfile {\n  id: string;\n  email: string;\n  username?: string;\n  display_name?: string;\n  avatar_url?: string;\n  timezone?: string;\n  locale?: string;\n  bio?: string;\n  role?: 'user' | 'admin' | 'superadmin';\n  preferences?: Record<string, unknown>;\n  created_at: string;\n  updated_at?: string;\n}\n\nexport interface UpdateProfileRequest {\n  username?: string;\n  display_name?: string;\n  avatar_url?: string;\n  timezone?: string;\n  locale?: string;\n  bio?: string;\n  preferences?: Record<string, unknown>;\n}\n\nexport interface ChangePasswordRequest {\n  current_password: string;\n  new_password: string;\n}\n\n/**\n * Get current user profile\n */\nexport async function getProfile(): Promise<UserProfile | null> {\n  try {\n    const response = await http.get<{ profile: UserProfile }>('/api/profile');\n    return response.data.profile;\n  } catch {\n    return null;\n  }\n}\n\n/**\n * Update user profile\n */\nexport async function updateProfile(data: UpdateProfileRequest): Promise<UserProfile> {\n  const response = await http.put<{ profile: UserProfile }>('/api/profile', data);\n  \n  // Update app store with new user info\n  const currentUser = appStore.getState().currentUser;\n  if (currentUser) {\n    appStore.setCurrentUser({\n      ...currentUser,\n      name: data.display_name || currentUser.name,\n      avatar: data.avatar_url || currentUser.avatar,\n    });\n  }\n  \n  return response.data.profile;\n}\n\n/**\n * Upload avatar\n */\nexport async function uploadAvatar(file: File): Promise<string> {\n  const formData = new FormData();\n  formData.append('avatar', file);\n\n  const response = await fetchWithProject('/api/profile/avatar', {\n    method: 'POST',\n    body: formData,\n  });\n\n  if (!response.ok) {\n    throw new Error('Avatar upload failed');\n  }\n\n  const data = await response.json();\n  \n  // Update app store\n  const currentUser = appStore.getState().currentUser;\n  if (currentUser) {\n    appStore.setCurrentUser({\n      ...currentUser,\n      avatar: data.avatar_url,\n    });\n  }\n  \n  return data.avatar_url;\n}\n\n/**\n * Remove avatar\n */\nexport async function removeAvatar(): Promise<void> {\n  await http.delete('/api/profile/avatar');\n  \n  // Update app store\n  const currentUser = appStore.getState().currentUser;\n  if (currentUser) {\n    appStore.setCurrentUser({\n      ...currentUser,\n      avatar: undefined,\n    });\n  }\n}\n\n/**\n * Change password\n */\nexport async function changePassword(data: ChangePasswordRequest): Promise<void> {\n  if (data.new_password.length < 12) {\n    throw new Error('New password must be at least 12 characters');\n  }\n\n  await http.post('/api/profile/change-password', data);\n}\n\n/**\n * Delete account\n */\nexport async function deleteAccount(password: string): Promise<void> {\n  await http.post('/api/profile/delete', { password });\n  appStore.setCurrentUser(null);\n  appStore.setCurrentProject(null);\n}\n\n/**\n * Get user activity\n */\nexport async function getActivity(limit = 50): Promise<Array<{\n  type: string;\n  action: string;\n  entity_type: string;\n  entity_id: string;\n  timestamp: string;\n}>> {\n  try {\n    const response = await http.get<{ activities: Array<{\n      type: string;\n      action: string;\n      entity_type: string;\n      entity_id: string;\n      timestamp: string;\n    }> }>(`/api/profile/activity?limit=${limit}`);\n    return response.data.activities || [];\n  } catch {\n    return [];\n  }\n}\n\n/**\n * Get user sessions\n */\nexport async function getSessions(): Promise<Array<{\n  id: string;\n  device: string;\n  location?: string;\n  ip_address: string;\n  last_active: string;\n  is_current: boolean;\n}>> {\n  try {\n    const response = await http.get<{ sessions: Array<{\n      id: string;\n      device: string;\n      location?: string;\n      ip_address: string;\n      last_active: string;\n      is_current: boolean;\n    }> }>('/api/profile/sessions');\n    return response.data.sessions || [];\n  } catch {\n    return [];\n  }\n}\n\n/**\n * Revoke a session\n */\nexport async function revokeSession(sessionId: string): Promise<void> {\n  await http.delete(`/api/profile/sessions/${sessionId}`);\n}\n\n/**\n * Revoke all other sessions\n */\nexport async function revokeAllSessions(): Promise<void> {\n  await http.post('/api/profile/sessions/revoke-all');\n}\n\nexport const profileService = {\n  get: getProfile,\n  update: updateProfile,\n  uploadAvatar,\n  removeAvatar,\n  changePassword,\n  deleteAccount,\n  getActivity,\n  getSessions,\n  revokeSession,\n  revokeAllSessions,\n};\n","/**\r\n * Facts Service\r\n * Handles facts CRUD and conflict detection\r\n */\r\n\r\nimport { http } from './api';\r\n\r\nexport interface Fact {\r\n  id: string | number;\r\n  content: string;\r\n  source?: string;\r\n  source_file?: string;\r\n  source_document_id?: string;\r\n  category?: string;\r\n  confidence?: number;\r\n  verified?: boolean;\r\n  verified_by?: string;\r\n  verified_at?: string;\r\n  created_at: string;\r\n  updated_at?: string;\r\n}\r\n\r\nexport interface CreateFactRequest {\r\n  content: string;\r\n  source?: string;\r\n  category?: string;\r\n  verified?: boolean;\r\n}\r\n\r\nexport interface UpdateFactRequest {\r\n  content?: string;\r\n  source?: string;\r\n  category?: string;\r\n  verified?: boolean;\r\n}\r\n\r\nexport interface FactConflict {\r\n  factId1: string | number;\r\n  factId2: string | number;\r\n  fact1: Fact;\r\n  fact2: Fact;\r\n  conflictType: 'contradiction' | 'inconsistency' | 'outdated' | 'process';\r\n  description?: string;\r\n  reason?: string;\r\n  confidence?: number;\r\n}\r\n\r\n/**\r\n * Get all facts\r\n */\r\nexport async function getFacts(options?: {\r\n  limit?: number;\r\n  offset?: number;\r\n  search?: string;\r\n  category?: string;\r\n  verified?: boolean;\r\n}): Promise<{ facts: Fact[]; total: number }> {\r\n  try {\r\n    const params = new URLSearchParams();\r\n    if (options?.limit) params.set('limit', String(options.limit));\r\n    if (options?.offset) params.set('offset', String(options.offset));\r\n    if (options?.search) params.set('search', options.search);\r\n    if (options?.category) params.set('category', options.category);\r\n    if (options?.verified !== undefined) params.set('verified', String(options.verified));\r\n\r\n    const query = params.toString();\r\n    const url = query ? `/api/facts?${query}` : '/api/facts';\r\n\r\n    const response = await http.get<{ facts: Fact[]; total?: number }>(url);\r\n    return {\r\n      facts: response.data.facts || [],\r\n      total: response.data.total || response.data.facts?.length || 0,\r\n    };\r\n  } catch {\r\n    return { facts: [], total: 0 };\r\n  }\r\n}\r\n\r\n/**\r\n * Get a single fact\r\n */\r\nexport async function getFact(id: string | number): Promise<Fact | null> {\r\n  try {\r\n    const response = await http.get<{ fact: Fact }>(`/api/facts/${id}`);\r\n    return response.data.fact;\r\n  } catch {\r\n    return null;\r\n  }\r\n}\r\n\r\n/**\r\n * Create a new fact\r\n */\r\nexport async function createFact(data: CreateFactRequest): Promise<Fact> {\r\n  const response = await http.post<{ fact: Fact; id: string | number }>('/api/facts', data);\r\n  return response.data.fact || {\r\n    ...data,\r\n    id: response.data.id,\r\n    created_at: new Date().toISOString(),\r\n  } as Fact;\r\n}\r\n\r\n/**\r\n * Update a fact\r\n */\r\nexport async function updateFact(id: string | number, data: UpdateFactRequest): Promise<Fact> {\r\n  const response = await http.put<{ fact: Fact }>(`/api/facts/${id}`, data);\r\n  return response.data.fact;\r\n}\r\n\r\n/**\r\n * Delete a fact (soft delete; syncs removal to graph/FalkorDB)\r\n */\r\nexport async function deleteFact(id: string | number): Promise<void> {\r\n  await http.delete(`/api/facts/${id}`);\r\n}\r\n\r\n/**\r\n * List soft-deleted facts (for restore / undo)\r\n */\r\nexport async function getDeletedFacts(): Promise<Fact[]> {\r\n  try {\r\n    const response = await http.get<{ facts: Fact[] }>('/api/facts/deleted');\r\n    return response.data.facts || [];\r\n  } catch {\r\n    return [];\r\n  }\r\n}\r\n\r\n/**\r\n * Restore a soft-deleted fact (undo); syncs back to graph/FalkorDB\r\n */\r\nexport async function restoreFact(id: string | number): Promise<Fact> {\r\n  const response = await http.post<{ fact: Fact }>(`/api/facts/${id}/restore`, {});\r\n  return response.data.fact;\r\n}\r\n\r\n/**\r\n * Verify a fact\r\n */\r\nexport async function verifyFact(id: string | number): Promise<Fact> {\r\n  return updateFact(id, { verified: true });\r\n}\r\n\r\n/**\r\n * Run full fact-check (AI analysis, records conflict_detected events)\r\n */\r\nexport async function runFactCheck(): Promise<{ ok: boolean; conflicts: FactConflict[]; analyzed_facts: number; events_recorded: number }> {\r\n  const response = await http.post<{ ok: boolean; conflicts: FactConflict[]; analyzed_facts: number; events_recorded: number }>('/api/fact-check/run', {});\r\n  return response.data;\r\n}\r\n\r\n/**\r\n * Detect conflicts between facts\r\n */\r\nexport async function detectConflicts(): Promise<FactConflict[]> {\r\n  try {\r\n    const response = await http.get<{ conflicts: FactConflict[] }>('/api/conflicts');\r\n    return response.data.conflicts || [];\r\n  } catch {\r\n    return [];\r\n  }\r\n}\r\n\r\n/**\r\n * Get facts by category\r\n */\r\nexport async function getFactsByCategory(): Promise<Record<string, Fact[]>> {\r\n  try {\r\n    const { facts } = await getFacts({ limit: 1000 });\r\n    const grouped: Record<string, Fact[]> = {};\r\n    \r\n    facts.forEach(fact => {\r\n      const category = fact.category || 'Uncategorized';\r\n      if (!grouped[category]) grouped[category] = [];\r\n      grouped[category].push(fact);\r\n    });\r\n    \r\n    return grouped;\r\n  } catch {\r\n    return {};\r\n  }\r\n}\r\n\r\n/**\r\n * Get facts grouped by source (source_file or source)\r\n */\r\nexport async function getFactsBySource(): Promise<Record<string, Fact[]>> {\r\n  try {\r\n    const { facts } = await getFacts({ limit: 1000 });\r\n    const grouped: Record<string, Fact[]> = {};\r\n    \r\n    facts.forEach(fact => {\r\n      const source = fact.source_file || fact.source || 'Unknown source';\r\n      if (!grouped[source]) grouped[source] = [];\r\n      grouped[source].push(fact);\r\n    });\r\n    \r\n    return grouped;\r\n  } catch {\r\n    return {};\r\n  }\r\n}\r\n\r\n/**\r\n * Get facts by source document id\r\n */\r\nexport async function getFactsByDocument(documentId: string): Promise<Fact[]> {\r\n  try {\r\n    const params = new URLSearchParams({ document_id: documentId });\r\n    const response = await http.get<{ facts: Fact[] }>(`/api/facts?${params}`);\r\n    return response.data.facts || [];\r\n  } catch {\r\n    return [];\r\n  }\r\n}\r\n\r\nexport interface FactEvent {\r\n  id: string;\r\n  fact_id: string;\r\n  event_type: string;\r\n  event_data?: Record<string, unknown>;\r\n  actor_user_id?: string;\r\n  actor_name?: string;\r\n  created_at: string;\r\n}\r\n\r\n/**\r\n * Get fact events (timeline) for a fact\r\n */\r\nexport async function getFactEvents(factId: string | number): Promise<FactEvent[]> {\r\n  try {\r\n    const response = await http.get<{ events: FactEvent[] }>(`/api/facts/${factId}/events`);\r\n    return response.data.events || [];\r\n  } catch {\r\n    return [];\r\n  }\r\n}\r\n\r\nexport interface SimilarFactItem {\r\n  fact: Fact;\r\n  similarityScore: number;\r\n}\r\n\r\n/**\r\n * Get similar facts (from fact_similarities cache or computed)\r\n */\r\nexport async function getSimilarFacts(factId: string | number, limit = 10): Promise<SimilarFactItem[]> {\r\n  try {\r\n    const params = new URLSearchParams();\r\n    if (limit !== 10) params.set('limit', String(limit));\r\n    const query = params.toString();\r\n    const url = query ? `/api/facts/${factId}/similar?${query}` : `/api/facts/${factId}/similar`;\r\n    const response = await http.get<{ similar: SimilarFactItem[] }>(url);\r\n    return response.data.similar || [];\r\n  } catch {\r\n    return [];\r\n  }\r\n}\r\n\r\n/**\r\n * Search facts\r\n */\r\nexport async function searchFacts(query: string, limit = 20): Promise<Fact[]> {\r\n  const { facts } = await getFacts({ search: query, limit });\r\n  return facts;\r\n}\r\n\r\n/**\r\n * Get fact statistics\r\n */\r\nexport function getFactStats(facts: Fact[]): {\r\n  total: number;\r\n  verified: number;\r\n  unverified: number;\r\n  byCategory: Record<string, number>;\r\n} {\r\n  const stats = {\r\n    total: facts.length,\r\n    verified: facts.filter(f => f.verified).length,\r\n    unverified: facts.filter(f => !f.verified).length,\r\n    byCategory: {} as Record<string, number>,\r\n  };\r\n\r\n  facts.forEach(fact => {\r\n    const category = fact.category || 'Uncategorized';\r\n    stats.byCategory[category] = (stats.byCategory[category] || 0) + 1;\r\n  });\r\n\r\n  return stats;\r\n}\r\n\r\nexport const factsService = {\r\n  getAll: getFacts,\r\n  get: getFact,\r\n  create: createFact,\r\n  update: updateFact,\r\n  delete: deleteFact,\r\n  deleteFact, // Alias for backwards compatibility\r\n  verify: verifyFact,\r\n  verifyFact, // Alias for backwards compatibility\r\n  detectConflicts,\r\n  getByCategory: getFactsByCategory,\r\n  getBySource: getFactsBySource,\r\n  getByDocument: getFactsByDocument,\r\n  getEvents: getFactEvents,\r\n  getSimilarFacts,\r\n  search: searchFacts,\r\n  getStats: getFactStats,\r\n  getDeletedFacts,\r\n  restoreFact,\r\n  runFactCheck,\r\n};\r\n","/**\n * Krisp Integration Service\n * Handles Krisp AI Meeting Assistant integration\n */\n\nimport { http } from './api';\n\n// ==================== Types ====================\n\nexport interface KrispWebhook {\n  id: string;\n  user_id: string;\n  webhook_token: string;\n  webhook_secret: string;\n  webhook_url: string;\n  is_active: boolean;\n  events_enabled: string[];\n  last_event_at?: string;\n  total_events_received: number;\n  created_at: string;\n  updated_at: string;\n}\n\nexport interface KrispTranscript {\n  id: string;\n  user_id: string;\n  krisp_meeting_id: string;\n  source: 'webhook' | 'mcp_sync';\n  event_type: string;\n  krisp_title: string;\n  display_title?: string;\n  meeting_date: string;\n  duration_minutes?: number;\n  speakers: string[];\n  has_unidentified_speakers: boolean;\n  matched_project_id?: string;\n  project_confidence?: number;\n  project_candidates?: ProjectCandidate[];\n  status_reason?: string;\n  matched_contacts?: MatchedContact[];\n  transcript_text?: string;\n  action_items?: unknown[];\n  key_points?: unknown[];\n  notes?: unknown;\n  status: 'pending' | 'quarantine' | 'ambiguous' | 'matched' | 'processed' | 'failed' | 'skipped';\n  retry_count: number;\n  processed_document_id?: string;\n  received_at: string;\n  projects?: {\n    id: string;\n    name: string;\n    project_number: string;\n  };\n}\n\nexport interface ProjectCandidate {\n  projectId: string;\n  projectName: string;\n  projectNumber: string;\n  count: number;\n  percentage: number;\n}\n\nexport interface MatchedContact {\n  speaker: string;\n  contact_id: string | null;\n  contact_name: string | null;\n  action: string;\n  confidence: number;\n}\n\nexport interface KrispSpeakerMapping {\n  id: string;\n  user_id?: string;\n  project_id: string;\n  speaker_name: string;\n  contact_id: string;\n  is_global: boolean;\n  is_active: boolean;\n  confidence: number;\n  source: string;\n  contacts?: {\n    id: string;\n    name: string;\n  };\n}\n\nexport interface TranscriptsSummary {\n  total_count: number;\n  pending_count: number;\n  quarantine_count: number;\n  ambiguous_count: number;\n  processed_count: number;\n  failed_count: number;\n}\n\nexport interface QuarantineStats {\n  total: number;\n  quarantine: number;\n  ambiguous: number;\n  maxedOut: number;\n  readyForRetry: number;\n}\n\n// ==================== Webhook Management ====================\n\n/**\n * Get or create Krisp webhook configuration\n */\nexport async function getWebhook(): Promise<KrispWebhook | null> {\n  try {\n    const response = await http.get<{ webhook: KrispWebhook }>('/api/krisp/webhook');\n    return response.data.webhook;\n  } catch {\n    return null;\n  }\n}\n\n/**\n * Regenerate webhook credentials\n */\nexport async function regenerateWebhook(): Promise<KrispWebhook | null> {\n  try {\n    const response = await http.post<{ webhook: KrispWebhook }>('/api/krisp/webhook/regenerate');\n    return response.data.webhook;\n  } catch {\n    return null;\n  }\n}\n\n/**\n * Toggle webhook active status\n */\nexport async function toggleWebhook(isActive: boolean): Promise<boolean> {\n  try {\n    await http.put('/api/krisp/webhook/toggle', { is_active: isActive });\n    return true;\n  } catch {\n    return false;\n  }\n}\n\n/**\n * Update enabled events\n */\nexport async function updateEnabledEvents(events: string[]): Promise<string[]> {\n  const response = await http.put<{ events: string[] }>('/api/krisp/webhook/events', { events });\n  return response.data.events;\n}\n\n// ==================== Transcript Management ====================\n\n/**\n * Get transcripts with optional filtering\n */\nexport async function getTranscripts(options: {\n  status?: string | string[];\n  projectId?: string;\n  limit?: number;\n  offset?: number;\n} = {}): Promise<KrispTranscript[]> {\n  const params = new URLSearchParams();\n  \n  if (options.status) {\n    if (Array.isArray(options.status)) {\n      params.append('status', options.status.join(','));\n    } else {\n      params.append('status', options.status);\n    }\n  }\n  if (options.projectId) params.append('project_id', options.projectId);\n  if (options.limit) params.append('limit', String(options.limit));\n  if (options.offset) params.append('offset', String(options.offset));\n\n  const url = `/api/krisp/transcripts${params.toString() ? `?${params}` : ''}`;\n  const response = await http.get<{ transcripts: KrispTranscript[] }>(url);\n  return response.data.transcripts;\n}\n\n/**\n * Get transcript by ID\n */\nexport async function getTranscript(id: string): Promise<KrispTranscript | null> {\n  try {\n    const response = await http.get<{ transcript: KrispTranscript }>(`/api/krisp/transcripts/${id}`);\n    return response.data.transcript;\n  } catch {\n    return null;\n  }\n}\n\n/**\n * Get transcripts summary\n */\nexport async function getTranscriptsSummary(): Promise<TranscriptsSummary | null> {\n  try {\n    const response = await http.get<{ summary: TranscriptsSummary }>('/api/krisp/transcripts/summary');\n    return response.data.summary;\n  } catch {\n    return null;\n  }\n}\n\n/**\n * Assign transcript to a project\n */\nexport async function assignProject(transcriptId: string, projectId: string): Promise<boolean> {\n  try {\n    await http.post(`/api/krisp/transcripts/${transcriptId}/assign`, { project_id: projectId });\n    return true;\n  } catch {\n    return false;\n  }\n}\n\n/**\n * Skip/discard a transcript\n */\nexport async function skipTranscript(transcriptId: string, reason?: string): Promise<boolean> {\n  try {\n    await http.post(`/api/krisp/transcripts/${transcriptId}/skip`, { reason });\n    return true;\n  } catch {\n    return false;\n  }\n}\n\n/**\n * Force retry processing\n */\nexport async function retryTranscript(transcriptId: string): Promise<boolean> {\n  try {\n    await http.post(`/api/krisp/transcripts/${transcriptId}/retry`);\n    return true;\n  } catch {\n    return false;\n  }\n}\n\n/**\n * Process a MATCHED transcript (create document)\n */\nexport async function processTranscript(transcriptId: string): Promise<boolean> {\n  try {\n    await http.post(`/api/krisp/transcripts/${transcriptId}/process`);\n    return true;\n  } catch {\n    return false;\n  }\n}\n\n// ==================== Speaker Mappings ====================\n\n/**\n * Get speaker mappings\n */\nexport async function getMappings(): Promise<KrispSpeakerMapping[]> {\n  try {\n    const response = await http.get<{ mappings: KrispSpeakerMapping[] }>('/api/krisp/mappings');\n    return response.data.mappings;\n  } catch {\n    return [];\n  }\n}\n\n/**\n * Create speaker mapping\n */\nexport async function createMapping(\n  speakerName: string,\n  contactId: string,\n  projectId: string,\n  isGlobal = false\n): Promise<KrispSpeakerMapping | null> {\n  try {\n    const response = await http.post<{ mapping: KrispSpeakerMapping }>('/api/krisp/mappings', {\n      speaker_name: speakerName,\n      contact_id: contactId,\n      project_id: projectId,\n      is_global: isGlobal\n    });\n    return response.data.mapping;\n  } catch {\n    return null;\n  }\n}\n\n/**\n * Delete speaker mapping\n */\nexport async function deleteMapping(mappingId: string): Promise<boolean> {\n  try {\n    await http.delete(`/api/krisp/mappings/${mappingId}`);\n    return true;\n  } catch {\n    return false;\n  }\n}\n\n// ==================== AI Summary ====================\n\nexport interface TranscriptSummary {\n  title: string;\n  date?: string;\n  duration?: number;\n  speakers: string[];\n  topic?: string;\n  keyPoints: string[];\n  actionItems: string[];\n  decisions?: string[];\n  nextSteps?: string;\n  notes?: string;\n  source: 'krisp_metadata' | 'ai_generated' | 'excerpt_fallback' | 'no_content';\n}\n\nexport interface GenerateSummaryOptions {\n  forceRegenerate?: boolean;\n}\n\n/**\n * Generate AI summary of a transcript\n */\nexport async function generateSummary(\n  transcriptId: string, \n  options: GenerateSummaryOptions = {}\n): Promise<TranscriptSummary | null> {\n  try {\n    const response = await http.post<{ summary: TranscriptSummary }>(\n      `/api/krisp/transcripts/${transcriptId}/summary`,\n      { forceRegenerate: options.forceRegenerate || false }\n    );\n    return response.data.summary;\n  } catch {\n    return null;\n  }\n}\n\n// ==================== Quarantine ====================\n\n/**\n * Get quarantine statistics\n */\nexport async function getQuarantineStats(): Promise<QuarantineStats | null> {\n  try {\n    const response = await http.get<{ stats: QuarantineStats }>('/api/krisp/quarantine/stats');\n    return response.data.stats;\n  } catch {\n    return null;\n  }\n}\n\n/**\n * Get quarantined transcripts\n */\nexport async function getQuarantinedTranscripts(): Promise<KrispTranscript[]> {\n  return getTranscripts({ status: ['quarantine', 'ambiguous'] });\n}\n\n// ==================== MCP Import ====================\n\nexport interface McpMeeting {\n  meeting_id: string;\n  name: string;\n  date: string;\n  url?: string;\n  speakers?: string[];\n  attendees?: string[];\n  is_recurring?: boolean;\n  meeting_notes?: {\n    detailed_summary?: string;\n    key_points?: string[];\n    action_items?: string[];\n  };\n  transcript?: {\n    status?: string;\n    text?: string;\n  };\n}\n\nexport interface McpSearchFilters {\n  search?: string;\n  after?: string;\n  before?: string;\n  participantDomains?: string[];\n  limit?: number;\n  offset?: number;\n}\n\nexport interface ImportResult {\n  meetingId: string;\n  title?: string;\n  success: boolean;\n  transcriptId?: string;\n  error?: string;\n  duplicate?: boolean;\n}\n\nexport interface ImportResponse {\n  success: boolean;\n  results: ImportResult[];\n  imported: number;\n  skipped: number;\n  failed: number;\n}\n\nexport interface ImportHistoryItem {\n  id: string;\n  krisp_meeting_id: string;\n  krisp_title: string;\n  meeting_date: string;\n  status: string;\n  created_at: string;\n}\n\n/**\n * Check which meetings have already been imported\n */\nexport async function getImportedMeetingIds(meetingIds: string[]): Promise<string[]> {\n  if (!meetingIds.length) return [];\n  \n  try {\n    const response = await http.get<{ imported: string[] }>(\n      `/api/krisp/mcp/imported?ids=${meetingIds.join(',')}`\n    );\n    return response.data.imported;\n  } catch {\n    return [];\n  }\n}\n\n/**\n * Import meetings from MCP data\n */\nexport async function importMeetings(\n  meetings: McpMeeting[], \n  options: { forceReimport?: boolean } = {}\n): Promise<ImportResponse | null> {\n  try {\n    const response = await http.post<ImportResponse>('/api/krisp/mcp/import', {\n      meetings,\n      forceReimport: options.forceReimport\n    });\n    return response.data;\n  } catch {\n    return null;\n  }\n}\n\n/**\n * Import a single meeting\n */\nexport async function importMeeting(\n  meeting: McpMeeting,\n  options: { forceReimport?: boolean } = {}\n): Promise<ImportResult | null> {\n  const result = await importMeetings([meeting], options);\n  return result?.results[0] || null;\n}\n\n/**\n * Get import history\n */\nexport async function getImportHistory(\n  options: { limit?: number; offset?: number } = {}\n): Promise<ImportHistoryItem[]> {\n  try {\n    const params = new URLSearchParams();\n    if (options.limit) params.set('limit', String(options.limit));\n    if (options.offset) params.set('offset', String(options.offset));\n    \n    const url = `/api/krisp/mcp/history${params.toString() ? '?' + params.toString() : ''}`;\n    const response = await http.get<{ history: ImportHistoryItem[] }>(url);\n    return response.data.history;\n  } catch {\n    return [];\n  }\n}\n\n// ==================== Available Meetings (MCP Sync) ====================\n\nexport interface AvailableMeeting {\n  id: string;\n  user_id: string;\n  krisp_meeting_id: string;\n  meeting_name: string;\n  meeting_date: string;\n  meeting_url?: string;\n  is_recurring: boolean;\n  attendees: string[];\n  speakers: string[];\n  key_points: string[];\n  action_items: unknown[];\n  summary?: string;\n  is_imported: boolean;\n  imported_at?: string;\n  imported_transcript_id?: string;\n  first_seen_at: string;\n  last_synced_at: string;\n}\n\nexport interface AvailableMeetingsStats {\n  total_available: number;\n  total_imported: number;\n  total_pending: number;\n  oldest_meeting?: string;\n  newest_meeting?: string;\n  last_sync?: string;\n}\n\nexport interface AvailableMeetingsResponse {\n  meetings: AvailableMeeting[];\n  stats: AvailableMeetingsStats;\n}\n\nexport interface SyncMeetingsResponse {\n  success: boolean;\n  synced: number;\n  errors: number;\n}\n\nexport interface ImportAvailableResponse {\n  success: boolean;\n  imported: number;\n  errors: Array<{ meetingId: string; error: string }>;\n}\n\n/**\n * Get available meetings from catalog\n */\nexport async function getAvailableMeetings(options: {\n  limit?: number;\n  offset?: number;\n  showImported?: boolean;\n  startDate?: string;\n  endDate?: string;\n  search?: string;\n} = {}): Promise<AvailableMeetingsResponse | null> {\n  try {\n    const params = new URLSearchParams();\n    if (options.limit) params.set('limit', String(options.limit));\n    if (options.offset) params.set('offset', String(options.offset));\n    if (options.showImported === false) params.set('showImported', 'false');\n    if (options.startDate) params.set('startDate', options.startDate);\n    if (options.endDate) params.set('endDate', options.endDate);\n    if (options.search) params.set('search', options.search);\n    \n    const url = `/api/krisp/available${params.toString() ? '?' + params.toString() : ''}`;\n    const response = await http.get<AvailableMeetingsResponse>(url);\n    return response.data;\n  } catch {\n    return null;\n  }\n}\n\n/**\n * Sync meetings from MCP (called by Cursor agent)\n */\nexport async function syncMeetingsFromMcp(meetings: McpMeeting[]): Promise<SyncMeetingsResponse | null> {\n  try {\n    const response = await http.post<SyncMeetingsResponse>('/api/krisp/available/sync', { meetings });\n    return response.data;\n  } catch {\n    return null;\n  }\n}\n\n/**\n * Import selected available meetings\n */\nexport async function importAvailableMeetings(meetingIds: string[], projectId?: string): Promise<ImportAvailableResponse | null> {\n  try {\n    const response = await http.post<ImportAvailableResponse>('/api/krisp/available/import', { \n      meetingIds,\n      projectId \n    });\n    return response.data;\n  } catch {\n    return null;\n  }\n}\n\n/**\n * Get available meetings stats\n */\nexport async function getAvailableMeetingsStats(): Promise<AvailableMeetingsStats | null> {\n  try {\n    const response = await http.get<{ stats: AvailableMeetingsStats }>('/api/krisp/available/stats');\n    return response.data.stats;\n  } catch {\n    return null;\n  }\n}\n\n/**\n * AI Summary result interface\n */\nexport interface MeetingSummary {\n  key_points: string[];\n  action_items: string[];\n  excerpt: string;\n  speakers?: string[];\n  attendees?: string[];\n  meeting_date?: string;\n  mentioned_people?: string[];\n}\n\nexport interface GenerateSummaryResponse {\n  success: boolean;\n  summary?: MeetingSummary;\n  error?: string;\n}\n\n/**\n * Generate AI summary for a specific available meeting\n */\nexport async function generateAvailableMeetingSummary(meetingId: string): Promise<GenerateSummaryResponse | null> {\n  try {\n    const response = await http.post<GenerateSummaryResponse>('/api/krisp/available/summary', { meetingId });\n    return response.data;\n  } catch {\n    return null;\n  }\n}\n\n// ==================== Helpers ====================\n\n/**\n * Format transcript status for display\n */\nexport function formatStatus(status: KrispTranscript['status']): { label: string; color: string } {\n  const statusMap: Record<string, { label: string; color: string }> = {\n    pending: { label: 'Pending', color: 'blue' },\n    quarantine: { label: 'Quarantine', color: 'yellow' },\n    ambiguous: { label: 'Ambiguous', color: 'orange' },\n    matched: { label: 'Matched', color: 'cyan' },\n    processed: { label: 'Processed', color: 'green' },\n    failed: { label: 'Failed', color: 'red' },\n    skipped: { label: 'Skipped', color: 'gray' }\n  };\n  \n  return statusMap[status] || { label: status, color: 'gray' };\n}\n\n/**\n * Format duration for display\n */\nexport function formatDuration(minutes?: number): string {\n  if (!minutes) return '-';\n  \n  const hours = Math.floor(minutes / 60);\n  const mins = minutes % 60;\n  \n  if (hours > 0) {\n    return `${hours}h ${mins}m`;\n  }\n  return `${mins}m`;\n}\n\n/**\n * Check if transcript needs action\n */\nexport function needsAction(transcript: KrispTranscript): boolean {\n  return ['quarantine', 'ambiguous', 'failed'].includes(transcript.status);\n}\n\n/**\n * Get action items count\n */\nexport function getActionItemsCount(transcript: KrispTranscript): number {\n  if (Array.isArray(transcript.action_items)) {\n    return transcript.action_items.length;\n  }\n  return 0;\n}\n","/*! @license DOMPurify 3.3.1 | (c) Cure53 and other contributors | Released under the Apache license 2.0 and Mozilla Public License 2.0 | github.com/cure53/DOMPurify/blob/3.3.1/LICENSE */\n\nconst {\n  entries,\n  setPrototypeOf,\n  isFrozen,\n  getPrototypeOf,\n  getOwnPropertyDescriptor\n} = Object;\nlet {\n  freeze,\n  seal,\n  create\n} = Object; // eslint-disable-line import/no-mutable-exports\nlet {\n  apply,\n  construct\n} = typeof Reflect !== 'undefined' && Reflect;\nif (!freeze) {\n  freeze = function freeze(x) {\n    return x;\n  };\n}\nif (!seal) {\n  seal = function seal(x) {\n    return x;\n  };\n}\nif (!apply) {\n  apply = function apply(func, thisArg) {\n    for (var _len = arguments.length, args = new Array(_len > 2 ? _len - 2 : 0), _key = 2; _key < _len; _key++) {\n      args[_key - 2] = arguments[_key];\n    }\n    return func.apply(thisArg, args);\n  };\n}\nif (!construct) {\n  construct = function construct(Func) {\n    for (var _len2 = arguments.length, args = new Array(_len2 > 1 ? _len2 - 1 : 0), _key2 = 1; _key2 < _len2; _key2++) {\n      args[_key2 - 1] = arguments[_key2];\n    }\n    return new Func(...args);\n  };\n}\nconst arrayForEach = unapply(Array.prototype.forEach);\nconst arrayLastIndexOf = unapply(Array.prototype.lastIndexOf);\nconst arrayPop = unapply(Array.prototype.pop);\nconst arrayPush = unapply(Array.prototype.push);\nconst arraySplice = unapply(Array.prototype.splice);\nconst stringToLowerCase = unapply(String.prototype.toLowerCase);\nconst stringToString = unapply(String.prototype.toString);\nconst stringMatch = unapply(String.prototype.match);\nconst stringReplace = unapply(String.prototype.replace);\nconst stringIndexOf = unapply(String.prototype.indexOf);\nconst stringTrim = unapply(String.prototype.trim);\nconst objectHasOwnProperty = unapply(Object.prototype.hasOwnProperty);\nconst regExpTest = unapply(RegExp.prototype.test);\nconst typeErrorCreate = unconstruct(TypeError);\n/**\n * Creates a new function that calls the given function with a specified thisArg and arguments.\n *\n * @param func - The function to be wrapped and called.\n * @returns A new function that calls the given function with a specified thisArg and arguments.\n */\nfunction unapply(func) {\n  return function (thisArg) {\n    if (thisArg instanceof RegExp) {\n      thisArg.lastIndex = 0;\n    }\n    for (var _len3 = arguments.length, args = new Array(_len3 > 1 ? _len3 - 1 : 0), _key3 = 1; _key3 < _len3; _key3++) {\n      args[_key3 - 1] = arguments[_key3];\n    }\n    return apply(func, thisArg, args);\n  };\n}\n/**\n * Creates a new function that constructs an instance of the given constructor function with the provided arguments.\n *\n * @param func - The constructor function to be wrapped and called.\n * @returns A new function that constructs an instance of the given constructor function with the provided arguments.\n */\nfunction unconstruct(Func) {\n  return function () {\n    for (var _len4 = arguments.length, args = new Array(_len4), _key4 = 0; _key4 < _len4; _key4++) {\n      args[_key4] = arguments[_key4];\n    }\n    return construct(Func, args);\n  };\n}\n/**\n * Add properties to a lookup table\n *\n * @param set - The set to which elements will be added.\n * @param array - The array containing elements to be added to the set.\n * @param transformCaseFunc - An optional function to transform the case of each element before adding to the set.\n * @returns The modified set with added elements.\n */\nfunction addToSet(set, array) {\n  let transformCaseFunc = arguments.length > 2 && arguments[2] !== undefined ? arguments[2] : stringToLowerCase;\n  if (setPrototypeOf) {\n    // Make 'in' and truthy checks like Boolean(set.constructor)\n    // independent of any properties defined on Object.prototype.\n    // Prevent prototype setters from intercepting set as a this value.\n    setPrototypeOf(set, null);\n  }\n  let l = array.length;\n  while (l--) {\n    let element = array[l];\n    if (typeof element === 'string') {\n      const lcElement = transformCaseFunc(element);\n      if (lcElement !== element) {\n        // Config presets (e.g. tags.js, attrs.js) are immutable.\n        if (!isFrozen(array)) {\n          array[l] = lcElement;\n        }\n        element = lcElement;\n      }\n    }\n    set[element] = true;\n  }\n  return set;\n}\n/**\n * Clean up an array to harden against CSPP\n *\n * @param array - The array to be cleaned.\n * @returns The cleaned version of the array\n */\nfunction cleanArray(array) {\n  for (let index = 0; index < array.length; index++) {\n    const isPropertyExist = objectHasOwnProperty(array, index);\n    if (!isPropertyExist) {\n      array[index] = null;\n    }\n  }\n  return array;\n}\n/**\n * Shallow clone an object\n *\n * @param object - The object to be cloned.\n * @returns A new object that copies the original.\n */\nfunction clone(object) {\n  const newObject = create(null);\n  for (const [property, value] of entries(object)) {\n    const isPropertyExist = objectHasOwnProperty(object, property);\n    if (isPropertyExist) {\n      if (Array.isArray(value)) {\n        newObject[property] = cleanArray(value);\n      } else if (value && typeof value === 'object' && value.constructor === Object) {\n        newObject[property] = clone(value);\n      } else {\n        newObject[property] = value;\n      }\n    }\n  }\n  return newObject;\n}\n/**\n * This method automatically checks if the prop is function or getter and behaves accordingly.\n *\n * @param object - The object to look up the getter function in its prototype chain.\n * @param prop - The property name for which to find the getter function.\n * @returns The getter function found in the prototype chain or a fallback function.\n */\nfunction lookupGetter(object, prop) {\n  while (object !== null) {\n    const desc = getOwnPropertyDescriptor(object, prop);\n    if (desc) {\n      if (desc.get) {\n        return unapply(desc.get);\n      }\n      if (typeof desc.value === 'function') {\n        return unapply(desc.value);\n      }\n    }\n    object = getPrototypeOf(object);\n  }\n  function fallbackValue() {\n    return null;\n  }\n  return fallbackValue;\n}\n\nconst html$1 = freeze(['a', 'abbr', 'acronym', 'address', 'area', 'article', 'aside', 'audio', 'b', 'bdi', 'bdo', 'big', 'blink', 'blockquote', 'body', 'br', 'button', 'canvas', 'caption', 'center', 'cite', 'code', 'col', 'colgroup', 'content', 'data', 'datalist', 'dd', 'decorator', 'del', 'details', 'dfn', 'dialog', 'dir', 'div', 'dl', 'dt', 'element', 'em', 'fieldset', 'figcaption', 'figure', 'font', 'footer', 'form', 'h1', 'h2', 'h3', 'h4', 'h5', 'h6', 'head', 'header', 'hgroup', 'hr', 'html', 'i', 'img', 'input', 'ins', 'kbd', 'label', 'legend', 'li', 'main', 'map', 'mark', 'marquee', 'menu', 'menuitem', 'meter', 'nav', 'nobr', 'ol', 'optgroup', 'option', 'output', 'p', 'picture', 'pre', 'progress', 'q', 'rp', 'rt', 'ruby', 's', 'samp', 'search', 'section', 'select', 'shadow', 'slot', 'small', 'source', 'spacer', 'span', 'strike', 'strong', 'style', 'sub', 'summary', 'sup', 'table', 'tbody', 'td', 'template', 'textarea', 'tfoot', 'th', 'thead', 'time', 'tr', 'track', 'tt', 'u', 'ul', 'var', 'video', 'wbr']);\nconst svg$1 = freeze(['svg', 'a', 'altglyph', 'altglyphdef', 'altglyphitem', 'animatecolor', 'animatemotion', 'animatetransform', 'circle', 'clippath', 'defs', 'desc', 'ellipse', 'enterkeyhint', 'exportparts', 'filter', 'font', 'g', 'glyph', 'glyphref', 'hkern', 'image', 'inputmode', 'line', 'lineargradient', 'marker', 'mask', 'metadata', 'mpath', 'part', 'path', 'pattern', 'polygon', 'polyline', 'radialgradient', 'rect', 'stop', 'style', 'switch', 'symbol', 'text', 'textpath', 'title', 'tref', 'tspan', 'view', 'vkern']);\nconst svgFilters = freeze(['feBlend', 'feColorMatrix', 'feComponentTransfer', 'feComposite', 'feConvolveMatrix', 'feDiffuseLighting', 'feDisplacementMap', 'feDistantLight', 'feDropShadow', 'feFlood', 'feFuncA', 'feFuncB', 'feFuncG', 'feFuncR', 'feGaussianBlur', 'feImage', 'feMerge', 'feMergeNode', 'feMorphology', 'feOffset', 'fePointLight', 'feSpecularLighting', 'feSpotLight', 'feTile', 'feTurbulence']);\n// List of SVG elements that are disallowed by default.\n// We still need to know them so that we can do namespace\n// checks properly in case one wants to add them to\n// allow-list.\nconst svgDisallowed = freeze(['animate', 'color-profile', 'cursor', 'discard', 'font-face', 'font-face-format', 'font-face-name', 'font-face-src', 'font-face-uri', 'foreignobject', 'hatch', 'hatchpath', 'mesh', 'meshgradient', 'meshpatch', 'meshrow', 'missing-glyph', 'script', 'set', 'solidcolor', 'unknown', 'use']);\nconst mathMl$1 = freeze(['math', 'menclose', 'merror', 'mfenced', 'mfrac', 'mglyph', 'mi', 'mlabeledtr', 'mmultiscripts', 'mn', 'mo', 'mover', 'mpadded', 'mphantom', 'mroot', 'mrow', 'ms', 'mspace', 'msqrt', 'mstyle', 'msub', 'msup', 'msubsup', 'mtable', 'mtd', 'mtext', 'mtr', 'munder', 'munderover', 'mprescripts']);\n// Similarly to SVG, we want to know all MathML elements,\n// even those that we disallow by default.\nconst mathMlDisallowed = freeze(['maction', 'maligngroup', 'malignmark', 'mlongdiv', 'mscarries', 'mscarry', 'msgroup', 'mstack', 'msline', 'msrow', 'semantics', 'annotation', 'annotation-xml', 'mprescripts', 'none']);\nconst text = freeze(['#text']);\n\nconst html = freeze(['accept', 'action', 'align', 'alt', 'autocapitalize', 'autocomplete', 'autopictureinpicture', 'autoplay', 'background', 'bgcolor', 'border', 'capture', 'cellpadding', 'cellspacing', 'checked', 'cite', 'class', 'clear', 'color', 'cols', 'colspan', 'controls', 'controlslist', 'coords', 'crossorigin', 'datetime', 'decoding', 'default', 'dir', 'disabled', 'disablepictureinpicture', 'disableremoteplayback', 'download', 'draggable', 'enctype', 'enterkeyhint', 'exportparts', 'face', 'for', 'headers', 'height', 'hidden', 'high', 'href', 'hreflang', 'id', 'inert', 'inputmode', 'integrity', 'ismap', 'kind', 'label', 'lang', 'list', 'loading', 'loop', 'low', 'max', 'maxlength', 'media', 'method', 'min', 'minlength', 'multiple', 'muted', 'name', 'nonce', 'noshade', 'novalidate', 'nowrap', 'open', 'optimum', 'part', 'pattern', 'placeholder', 'playsinline', 'popover', 'popovertarget', 'popovertargetaction', 'poster', 'preload', 'pubdate', 'radiogroup', 'readonly', 'rel', 'required', 'rev', 'reversed', 'role', 'rows', 'rowspan', 'spellcheck', 'scope', 'selected', 'shape', 'size', 'sizes', 'slot', 'span', 'srclang', 'start', 'src', 'srcset', 'step', 'style', 'summary', 'tabindex', 'title', 'translate', 'type', 'usemap', 'valign', 'value', 'width', 'wrap', 'xmlns', 'slot']);\nconst svg = freeze(['accent-height', 'accumulate', 'additive', 'alignment-baseline', 'amplitude', 'ascent', 'attributename', 'attributetype', 'azimuth', 'basefrequency', 'baseline-shift', 'begin', 'bias', 'by', 'class', 'clip', 'clippathunits', 'clip-path', 'clip-rule', 'color', 'color-interpolation', 'color-interpolation-filters', 'color-profile', 'color-rendering', 'cx', 'cy', 'd', 'dx', 'dy', 'diffuseconstant', 'direction', 'display', 'divisor', 'dur', 'edgemode', 'elevation', 'end', 'exponent', 'fill', 'fill-opacity', 'fill-rule', 'filter', 'filterunits', 'flood-color', 'flood-opacity', 'font-family', 'font-size', 'font-size-adjust', 'font-stretch', 'font-style', 'font-variant', 'font-weight', 'fx', 'fy', 'g1', 'g2', 'glyph-name', 'glyphref', 'gradientunits', 'gradienttransform', 'height', 'href', 'id', 'image-rendering', 'in', 'in2', 'intercept', 'k', 'k1', 'k2', 'k3', 'k4', 'kerning', 'keypoints', 'keysplines', 'keytimes', 'lang', 'lengthadjust', 'letter-spacing', 'kernelmatrix', 'kernelunitlength', 'lighting-color', 'local', 'marker-end', 'marker-mid', 'marker-start', 'markerheight', 'markerunits', 'markerwidth', 'maskcontentunits', 'maskunits', 'max', 'mask', 'mask-type', 'media', 'method', 'mode', 'min', 'name', 'numoctaves', 'offset', 'operator', 'opacity', 'order', 'orient', 'orientation', 'origin', 'overflow', 'paint-order', 'path', 'pathlength', 'patterncontentunits', 'patterntransform', 'patternunits', 'points', 'preservealpha', 'preserveaspectratio', 'primitiveunits', 'r', 'rx', 'ry', 'radius', 'refx', 'refy', 'repeatcount', 'repeatdur', 'restart', 'result', 'rotate', 'scale', 'seed', 'shape-rendering', 'slope', 'specularconstant', 'specularexponent', 'spreadmethod', 'startoffset', 'stddeviation', 'stitchtiles', 'stop-color', 'stop-opacity', 'stroke-dasharray', 'stroke-dashoffset', 'stroke-linecap', 'stroke-linejoin', 'stroke-miterlimit', 'stroke-opacity', 'stroke', 'stroke-width', 'style', 'surfacescale', 'systemlanguage', 'tabindex', 'tablevalues', 'targetx', 'targety', 'transform', 'transform-origin', 'text-anchor', 'text-decoration', 'text-rendering', 'textlength', 'type', 'u1', 'u2', 'unicode', 'values', 'viewbox', 'visibility', 'version', 'vert-adv-y', 'vert-origin-x', 'vert-origin-y', 'width', 'word-spacing', 'wrap', 'writing-mode', 'xchannelselector', 'ychannelselector', 'x', 'x1', 'x2', 'xmlns', 'y', 'y1', 'y2', 'z', 'zoomandpan']);\nconst mathMl = freeze(['accent', 'accentunder', 'align', 'bevelled', 'close', 'columnsalign', 'columnlines', 'columnspan', 'denomalign', 'depth', 'dir', 'display', 'displaystyle', 'encoding', 'fence', 'frame', 'height', 'href', 'id', 'largeop', 'length', 'linethickness', 'lspace', 'lquote', 'mathbackground', 'mathcolor', 'mathsize', 'mathvariant', 'maxsize', 'minsize', 'movablelimits', 'notation', 'numalign', 'open', 'rowalign', 'rowlines', 'rowspacing', 'rowspan', 'rspace', 'rquote', 'scriptlevel', 'scriptminsize', 'scriptsizemultiplier', 'selection', 'separator', 'separators', 'stretchy', 'subscriptshift', 'supscriptshift', 'symmetric', 'voffset', 'width', 'xmlns']);\nconst xml = freeze(['xlink:href', 'xml:id', 'xlink:title', 'xml:space', 'xmlns:xlink']);\n\n// eslint-disable-next-line unicorn/better-regex\nconst MUSTACHE_EXPR = seal(/\\{\\{[\\w\\W]*|[\\w\\W]*\\}\\}/gm); // Specify template detection regex for SAFE_FOR_TEMPLATES mode\nconst ERB_EXPR = seal(/<%[\\w\\W]*|[\\w\\W]*%>/gm);\nconst TMPLIT_EXPR = seal(/\\$\\{[\\w\\W]*/gm); // eslint-disable-line unicorn/better-regex\nconst DATA_ATTR = seal(/^data-[\\-\\w.\\u00B7-\\uFFFF]+$/); // eslint-disable-line no-useless-escape\nconst ARIA_ATTR = seal(/^aria-[\\-\\w]+$/); // eslint-disable-line no-useless-escape\nconst IS_ALLOWED_URI = seal(/^(?:(?:(?:f|ht)tps?|mailto|tel|callto|sms|cid|xmpp|matrix):|[^a-z]|[a-z+.\\-]+(?:[^a-z+.\\-:]|$))/i // eslint-disable-line no-useless-escape\n);\nconst IS_SCRIPT_OR_DATA = seal(/^(?:\\w+script|data):/i);\nconst ATTR_WHITESPACE = seal(/[\\u0000-\\u0020\\u00A0\\u1680\\u180E\\u2000-\\u2029\\u205F\\u3000]/g // eslint-disable-line no-control-regex\n);\nconst DOCTYPE_NAME = seal(/^html$/i);\nconst CUSTOM_ELEMENT = seal(/^[a-z][.\\w]*(-[.\\w]+)+$/i);\n\nvar EXPRESSIONS = /*#__PURE__*/Object.freeze({\n  __proto__: null,\n  ARIA_ATTR: ARIA_ATTR,\n  ATTR_WHITESPACE: ATTR_WHITESPACE,\n  CUSTOM_ELEMENT: CUSTOM_ELEMENT,\n  DATA_ATTR: DATA_ATTR,\n  DOCTYPE_NAME: DOCTYPE_NAME,\n  ERB_EXPR: ERB_EXPR,\n  IS_ALLOWED_URI: IS_ALLOWED_URI,\n  IS_SCRIPT_OR_DATA: IS_SCRIPT_OR_DATA,\n  MUSTACHE_EXPR: MUSTACHE_EXPR,\n  TMPLIT_EXPR: TMPLIT_EXPR\n});\n\n/* eslint-disable @typescript-eslint/indent */\n// https://developer.mozilla.org/en-US/docs/Web/API/Node/nodeType\nconst NODE_TYPE = {\n  element: 1,\n  attribute: 2,\n  text: 3,\n  cdataSection: 4,\n  entityReference: 5,\n  // Deprecated\n  entityNode: 6,\n  // Deprecated\n  progressingInstruction: 7,\n  comment: 8,\n  document: 9,\n  documentType: 10,\n  documentFragment: 11,\n  notation: 12 // Deprecated\n};\nconst getGlobal = function getGlobal() {\n  return typeof window === 'undefined' ? null : window;\n};\n/**\n * Creates a no-op policy for internal use only.\n * Don't export this function outside this module!\n * @param trustedTypes The policy factory.\n * @param purifyHostElement The Script element used to load DOMPurify (to determine policy name suffix).\n * @return The policy created (or null, if Trusted Types\n * are not supported or creating the policy failed).\n */\nconst _createTrustedTypesPolicy = function _createTrustedTypesPolicy(trustedTypes, purifyHostElement) {\n  if (typeof trustedTypes !== 'object' || typeof trustedTypes.createPolicy !== 'function') {\n    return null;\n  }\n  // Allow the callers to control the unique policy name\n  // by adding a data-tt-policy-suffix to the script element with the DOMPurify.\n  // Policy creation with duplicate names throws in Trusted Types.\n  let suffix = null;\n  const ATTR_NAME = 'data-tt-policy-suffix';\n  if (purifyHostElement && purifyHostElement.hasAttribute(ATTR_NAME)) {\n    suffix = purifyHostElement.getAttribute(ATTR_NAME);\n  }\n  const policyName = 'dompurify' + (suffix ? '#' + suffix : '');\n  try {\n    return trustedTypes.createPolicy(policyName, {\n      createHTML(html) {\n        return html;\n      },\n      createScriptURL(scriptUrl) {\n        return scriptUrl;\n      }\n    });\n  } catch (_) {\n    // Policy creation failed (most likely another DOMPurify script has\n    // already run). Skip creating the policy, as this will only cause errors\n    // if TT are enforced.\n    console.warn('TrustedTypes policy ' + policyName + ' could not be created.');\n    return null;\n  }\n};\nconst _createHooksMap = function _createHooksMap() {\n  return {\n    afterSanitizeAttributes: [],\n    afterSanitizeElements: [],\n    afterSanitizeShadowDOM: [],\n    beforeSanitizeAttributes: [],\n    beforeSanitizeElements: [],\n    beforeSanitizeShadowDOM: [],\n    uponSanitizeAttribute: [],\n    uponSanitizeElement: [],\n    uponSanitizeShadowNode: []\n  };\n};\nfunction createDOMPurify() {\n  let window = arguments.length > 0 && arguments[0] !== undefined ? arguments[0] : getGlobal();\n  const DOMPurify = root => createDOMPurify(root);\n  DOMPurify.version = '3.3.1';\n  DOMPurify.removed = [];\n  if (!window || !window.document || window.document.nodeType !== NODE_TYPE.document || !window.Element) {\n    // Not running in a browser, provide a factory function\n    // so that you can pass your own Window\n    DOMPurify.isSupported = false;\n    return DOMPurify;\n  }\n  let {\n    document\n  } = window;\n  const originalDocument = document;\n  const currentScript = originalDocument.currentScript;\n  const {\n    DocumentFragment,\n    HTMLTemplateElement,\n    Node,\n    Element,\n    NodeFilter,\n    NamedNodeMap = window.NamedNodeMap || window.MozNamedAttrMap,\n    HTMLFormElement,\n    DOMParser,\n    trustedTypes\n  } = window;\n  const ElementPrototype = Element.prototype;\n  const cloneNode = lookupGetter(ElementPrototype, 'cloneNode');\n  const remove = lookupGetter(ElementPrototype, 'remove');\n  const getNextSibling = lookupGetter(ElementPrototype, 'nextSibling');\n  const getChildNodes = lookupGetter(ElementPrototype, 'childNodes');\n  const getParentNode = lookupGetter(ElementPrototype, 'parentNode');\n  // As per issue #47, the web-components registry is inherited by a\n  // new document created via createHTMLDocument. As per the spec\n  // (http://w3c.github.io/webcomponents/spec/custom/#creating-and-passing-registries)\n  // a new empty registry is used when creating a template contents owner\n  // document, so we use that as our parent document to ensure nothing\n  // is inherited.\n  if (typeof HTMLTemplateElement === 'function') {\n    const template = document.createElement('template');\n    if (template.content && template.content.ownerDocument) {\n      document = template.content.ownerDocument;\n    }\n  }\n  let trustedTypesPolicy;\n  let emptyHTML = '';\n  const {\n    implementation,\n    createNodeIterator,\n    createDocumentFragment,\n    getElementsByTagName\n  } = document;\n  const {\n    importNode\n  } = originalDocument;\n  let hooks = _createHooksMap();\n  /**\n   * Expose whether this browser supports running the full DOMPurify.\n   */\n  DOMPurify.isSupported = typeof entries === 'function' && typeof getParentNode === 'function' && implementation && implementation.createHTMLDocument !== undefined;\n  const {\n    MUSTACHE_EXPR,\n    ERB_EXPR,\n    TMPLIT_EXPR,\n    DATA_ATTR,\n    ARIA_ATTR,\n    IS_SCRIPT_OR_DATA,\n    ATTR_WHITESPACE,\n    CUSTOM_ELEMENT\n  } = EXPRESSIONS;\n  let {\n    IS_ALLOWED_URI: IS_ALLOWED_URI$1\n  } = EXPRESSIONS;\n  /**\n   * We consider the elements and attributes below to be safe. Ideally\n   * don't add any new ones but feel free to remove unwanted ones.\n   */\n  /* allowed element names */\n  let ALLOWED_TAGS = null;\n  const DEFAULT_ALLOWED_TAGS = addToSet({}, [...html$1, ...svg$1, ...svgFilters, ...mathMl$1, ...text]);\n  /* Allowed attribute names */\n  let ALLOWED_ATTR = null;\n  const DEFAULT_ALLOWED_ATTR = addToSet({}, [...html, ...svg, ...mathMl, ...xml]);\n  /*\n   * Configure how DOMPurify should handle custom elements and their attributes as well as customized built-in elements.\n   * @property {RegExp|Function|null} tagNameCheck one of [null, regexPattern, predicate]. Default: `null` (disallow any custom elements)\n   * @property {RegExp|Function|null} attributeNameCheck one of [null, regexPattern, predicate]. Default: `null` (disallow any attributes not on the allow list)\n   * @property {boolean} allowCustomizedBuiltInElements allow custom elements derived from built-ins if they pass CUSTOM_ELEMENT_HANDLING.tagNameCheck. Default: `false`.\n   */\n  let CUSTOM_ELEMENT_HANDLING = Object.seal(create(null, {\n    tagNameCheck: {\n      writable: true,\n      configurable: false,\n      enumerable: true,\n      value: null\n    },\n    attributeNameCheck: {\n      writable: true,\n      configurable: false,\n      enumerable: true,\n      value: null\n    },\n    allowCustomizedBuiltInElements: {\n      writable: true,\n      configurable: false,\n      enumerable: true,\n      value: false\n    }\n  }));\n  /* Explicitly forbidden tags (overrides ALLOWED_TAGS/ADD_TAGS) */\n  let FORBID_TAGS = null;\n  /* Explicitly forbidden attributes (overrides ALLOWED_ATTR/ADD_ATTR) */\n  let FORBID_ATTR = null;\n  /* Config object to store ADD_TAGS/ADD_ATTR functions (when used as functions) */\n  const EXTRA_ELEMENT_HANDLING = Object.seal(create(null, {\n    tagCheck: {\n      writable: true,\n      configurable: false,\n      enumerable: true,\n      value: null\n    },\n    attributeCheck: {\n      writable: true,\n      configurable: false,\n      enumerable: true,\n      value: null\n    }\n  }));\n  /* Decide if ARIA attributes are okay */\n  let ALLOW_ARIA_ATTR = true;\n  /* Decide if custom data attributes are okay */\n  let ALLOW_DATA_ATTR = true;\n  /* Decide if unknown protocols are okay */\n  let ALLOW_UNKNOWN_PROTOCOLS = false;\n  /* Decide if self-closing tags in attributes are allowed.\n   * Usually removed due to a mXSS issue in jQuery 3.0 */\n  let ALLOW_SELF_CLOSE_IN_ATTR = true;\n  /* Output should be safe for common template engines.\n   * This means, DOMPurify removes data attributes, mustaches and ERB\n   */\n  let SAFE_FOR_TEMPLATES = false;\n  /* Output should be safe even for XML used within HTML and alike.\n   * This means, DOMPurify removes comments when containing risky content.\n   */\n  let SAFE_FOR_XML = true;\n  /* Decide if document with <html>... should be returned */\n  let WHOLE_DOCUMENT = false;\n  /* Track whether config is already set on this instance of DOMPurify. */\n  let SET_CONFIG = false;\n  /* Decide if all elements (e.g. style, script) must be children of\n   * document.body. By default, browsers might move them to document.head */\n  let FORCE_BODY = false;\n  /* Decide if a DOM `HTMLBodyElement` should be returned, instead of a html\n   * string (or a TrustedHTML object if Trusted Types are supported).\n   * If `WHOLE_DOCUMENT` is enabled a `HTMLHtmlElement` will be returned instead\n   */\n  let RETURN_DOM = false;\n  /* Decide if a DOM `DocumentFragment` should be returned, instead of a html\n   * string  (or a TrustedHTML object if Trusted Types are supported) */\n  let RETURN_DOM_FRAGMENT = false;\n  /* Try to return a Trusted Type object instead of a string, return a string in\n   * case Trusted Types are not supported  */\n  let RETURN_TRUSTED_TYPE = false;\n  /* Output should be free from DOM clobbering attacks?\n   * This sanitizes markups named with colliding, clobberable built-in DOM APIs.\n   */\n  let SANITIZE_DOM = true;\n  /* Achieve full DOM Clobbering protection by isolating the namespace of named\n   * properties and JS variables, mitigating attacks that abuse the HTML/DOM spec rules.\n   *\n   * HTML/DOM spec rules that enable DOM Clobbering:\n   *   - Named Access on Window (7.3.3)\n   *   - DOM Tree Accessors (3.1.5)\n   *   - Form Element Parent-Child Relations (4.10.3)\n   *   - Iframe srcdoc / Nested WindowProxies (4.8.5)\n   *   - HTMLCollection (4.2.10.2)\n   *\n   * Namespace isolation is implemented by prefixing `id` and `name` attributes\n   * with a constant string, i.e., `user-content-`\n   */\n  let SANITIZE_NAMED_PROPS = false;\n  const SANITIZE_NAMED_PROPS_PREFIX = 'user-content-';\n  /* Keep element content when removing element? */\n  let KEEP_CONTENT = true;\n  /* If a `Node` is passed to sanitize(), then performs sanitization in-place instead\n   * of importing it into a new Document and returning a sanitized copy */\n  let IN_PLACE = false;\n  /* Allow usage of profiles like html, svg and mathMl */\n  let USE_PROFILES = {};\n  /* Tags to ignore content of when KEEP_CONTENT is true */\n  let FORBID_CONTENTS = null;\n  const DEFAULT_FORBID_CONTENTS = addToSet({}, ['annotation-xml', 'audio', 'colgroup', 'desc', 'foreignobject', 'head', 'iframe', 'math', 'mi', 'mn', 'mo', 'ms', 'mtext', 'noembed', 'noframes', 'noscript', 'plaintext', 'script', 'style', 'svg', 'template', 'thead', 'title', 'video', 'xmp']);\n  /* Tags that are safe for data: URIs */\n  let DATA_URI_TAGS = null;\n  const DEFAULT_DATA_URI_TAGS = addToSet({}, ['audio', 'video', 'img', 'source', 'image', 'track']);\n  /* Attributes safe for values like \"javascript:\" */\n  let URI_SAFE_ATTRIBUTES = null;\n  const DEFAULT_URI_SAFE_ATTRIBUTES = addToSet({}, ['alt', 'class', 'for', 'id', 'label', 'name', 'pattern', 'placeholder', 'role', 'summary', 'title', 'value', 'style', 'xmlns']);\n  const MATHML_NAMESPACE = 'http://www.w3.org/1998/Math/MathML';\n  const SVG_NAMESPACE = 'http://www.w3.org/2000/svg';\n  const HTML_NAMESPACE = 'http://www.w3.org/1999/xhtml';\n  /* Document namespace */\n  let NAMESPACE = HTML_NAMESPACE;\n  let IS_EMPTY_INPUT = false;\n  /* Allowed XHTML+XML namespaces */\n  let ALLOWED_NAMESPACES = null;\n  const DEFAULT_ALLOWED_NAMESPACES = addToSet({}, [MATHML_NAMESPACE, SVG_NAMESPACE, HTML_NAMESPACE], stringToString);\n  let MATHML_TEXT_INTEGRATION_POINTS = addToSet({}, ['mi', 'mo', 'mn', 'ms', 'mtext']);\n  let HTML_INTEGRATION_POINTS = addToSet({}, ['annotation-xml']);\n  // Certain elements are allowed in both SVG and HTML\n  // namespace. We need to specify them explicitly\n  // so that they don't get erroneously deleted from\n  // HTML namespace.\n  const COMMON_SVG_AND_HTML_ELEMENTS = addToSet({}, ['title', 'style', 'font', 'a', 'script']);\n  /* Parsing of strict XHTML documents */\n  let PARSER_MEDIA_TYPE = null;\n  const SUPPORTED_PARSER_MEDIA_TYPES = ['application/xhtml+xml', 'text/html'];\n  const DEFAULT_PARSER_MEDIA_TYPE = 'text/html';\n  let transformCaseFunc = null;\n  /* Keep a reference to config to pass to hooks */\n  let CONFIG = null;\n  /* Ideally, do not touch anything below this line */\n  /* ______________________________________________ */\n  const formElement = document.createElement('form');\n  const isRegexOrFunction = function isRegexOrFunction(testValue) {\n    return testValue instanceof RegExp || testValue instanceof Function;\n  };\n  /**\n   * _parseConfig\n   *\n   * @param cfg optional config literal\n   */\n  // eslint-disable-next-line complexity\n  const _parseConfig = function _parseConfig() {\n    let cfg = arguments.length > 0 && arguments[0] !== undefined ? arguments[0] : {};\n    if (CONFIG && CONFIG === cfg) {\n      return;\n    }\n    /* Shield configuration object from tampering */\n    if (!cfg || typeof cfg !== 'object') {\n      cfg = {};\n    }\n    /* Shield configuration object from prototype pollution */\n    cfg = clone(cfg);\n    PARSER_MEDIA_TYPE =\n    // eslint-disable-next-line unicorn/prefer-includes\n    SUPPORTED_PARSER_MEDIA_TYPES.indexOf(cfg.PARSER_MEDIA_TYPE) === -1 ? DEFAULT_PARSER_MEDIA_TYPE : cfg.PARSER_MEDIA_TYPE;\n    // HTML tags and attributes are not case-sensitive, converting to lowercase. Keeping XHTML as is.\n    transformCaseFunc = PARSER_MEDIA_TYPE === 'application/xhtml+xml' ? stringToString : stringToLowerCase;\n    /* Set configuration parameters */\n    ALLOWED_TAGS = objectHasOwnProperty(cfg, 'ALLOWED_TAGS') ? addToSet({}, cfg.ALLOWED_TAGS, transformCaseFunc) : DEFAULT_ALLOWED_TAGS;\n    ALLOWED_ATTR = objectHasOwnProperty(cfg, 'ALLOWED_ATTR') ? addToSet({}, cfg.ALLOWED_ATTR, transformCaseFunc) : DEFAULT_ALLOWED_ATTR;\n    ALLOWED_NAMESPACES = objectHasOwnProperty(cfg, 'ALLOWED_NAMESPACES') ? addToSet({}, cfg.ALLOWED_NAMESPACES, stringToString) : DEFAULT_ALLOWED_NAMESPACES;\n    URI_SAFE_ATTRIBUTES = objectHasOwnProperty(cfg, 'ADD_URI_SAFE_ATTR') ? addToSet(clone(DEFAULT_URI_SAFE_ATTRIBUTES), cfg.ADD_URI_SAFE_ATTR, transformCaseFunc) : DEFAULT_URI_SAFE_ATTRIBUTES;\n    DATA_URI_TAGS = objectHasOwnProperty(cfg, 'ADD_DATA_URI_TAGS') ? addToSet(clone(DEFAULT_DATA_URI_TAGS), cfg.ADD_DATA_URI_TAGS, transformCaseFunc) : DEFAULT_DATA_URI_TAGS;\n    FORBID_CONTENTS = objectHasOwnProperty(cfg, 'FORBID_CONTENTS') ? addToSet({}, cfg.FORBID_CONTENTS, transformCaseFunc) : DEFAULT_FORBID_CONTENTS;\n    FORBID_TAGS = objectHasOwnProperty(cfg, 'FORBID_TAGS') ? addToSet({}, cfg.FORBID_TAGS, transformCaseFunc) : clone({});\n    FORBID_ATTR = objectHasOwnProperty(cfg, 'FORBID_ATTR') ? addToSet({}, cfg.FORBID_ATTR, transformCaseFunc) : clone({});\n    USE_PROFILES = objectHasOwnProperty(cfg, 'USE_PROFILES') ? cfg.USE_PROFILES : false;\n    ALLOW_ARIA_ATTR = cfg.ALLOW_ARIA_ATTR !== false; // Default true\n    ALLOW_DATA_ATTR = cfg.ALLOW_DATA_ATTR !== false; // Default true\n    ALLOW_UNKNOWN_PROTOCOLS = cfg.ALLOW_UNKNOWN_PROTOCOLS || false; // Default false\n    ALLOW_SELF_CLOSE_IN_ATTR = cfg.ALLOW_SELF_CLOSE_IN_ATTR !== false; // Default true\n    SAFE_FOR_TEMPLATES = cfg.SAFE_FOR_TEMPLATES || false; // Default false\n    SAFE_FOR_XML = cfg.SAFE_FOR_XML !== false; // Default true\n    WHOLE_DOCUMENT = cfg.WHOLE_DOCUMENT || false; // Default false\n    RETURN_DOM = cfg.RETURN_DOM || false; // Default false\n    RETURN_DOM_FRAGMENT = cfg.RETURN_DOM_FRAGMENT || false; // Default false\n    RETURN_TRUSTED_TYPE = cfg.RETURN_TRUSTED_TYPE || false; // Default false\n    FORCE_BODY = cfg.FORCE_BODY || false; // Default false\n    SANITIZE_DOM = cfg.SANITIZE_DOM !== false; // Default true\n    SANITIZE_NAMED_PROPS = cfg.SANITIZE_NAMED_PROPS || false; // Default false\n    KEEP_CONTENT = cfg.KEEP_CONTENT !== false; // Default true\n    IN_PLACE = cfg.IN_PLACE || false; // Default false\n    IS_ALLOWED_URI$1 = cfg.ALLOWED_URI_REGEXP || IS_ALLOWED_URI;\n    NAMESPACE = cfg.NAMESPACE || HTML_NAMESPACE;\n    MATHML_TEXT_INTEGRATION_POINTS = cfg.MATHML_TEXT_INTEGRATION_POINTS || MATHML_TEXT_INTEGRATION_POINTS;\n    HTML_INTEGRATION_POINTS = cfg.HTML_INTEGRATION_POINTS || HTML_INTEGRATION_POINTS;\n    CUSTOM_ELEMENT_HANDLING = cfg.CUSTOM_ELEMENT_HANDLING || {};\n    if (cfg.CUSTOM_ELEMENT_HANDLING && isRegexOrFunction(cfg.CUSTOM_ELEMENT_HANDLING.tagNameCheck)) {\n      CUSTOM_ELEMENT_HANDLING.tagNameCheck = cfg.CUSTOM_ELEMENT_HANDLING.tagNameCheck;\n    }\n    if (cfg.CUSTOM_ELEMENT_HANDLING && isRegexOrFunction(cfg.CUSTOM_ELEMENT_HANDLING.attributeNameCheck)) {\n      CUSTOM_ELEMENT_HANDLING.attributeNameCheck = cfg.CUSTOM_ELEMENT_HANDLING.attributeNameCheck;\n    }\n    if (cfg.CUSTOM_ELEMENT_HANDLING && typeof cfg.CUSTOM_ELEMENT_HANDLING.allowCustomizedBuiltInElements === 'boolean') {\n      CUSTOM_ELEMENT_HANDLING.allowCustomizedBuiltInElements = cfg.CUSTOM_ELEMENT_HANDLING.allowCustomizedBuiltInElements;\n    }\n    if (SAFE_FOR_TEMPLATES) {\n      ALLOW_DATA_ATTR = false;\n    }\n    if (RETURN_DOM_FRAGMENT) {\n      RETURN_DOM = true;\n    }\n    /* Parse profile info */\n    if (USE_PROFILES) {\n      ALLOWED_TAGS = addToSet({}, text);\n      ALLOWED_ATTR = [];\n      if (USE_PROFILES.html === true) {\n        addToSet(ALLOWED_TAGS, html$1);\n        addToSet(ALLOWED_ATTR, html);\n      }\n      if (USE_PROFILES.svg === true) {\n        addToSet(ALLOWED_TAGS, svg$1);\n        addToSet(ALLOWED_ATTR, svg);\n        addToSet(ALLOWED_ATTR, xml);\n      }\n      if (USE_PROFILES.svgFilters === true) {\n        addToSet(ALLOWED_TAGS, svgFilters);\n        addToSet(ALLOWED_ATTR, svg);\n        addToSet(ALLOWED_ATTR, xml);\n      }\n      if (USE_PROFILES.mathMl === true) {\n        addToSet(ALLOWED_TAGS, mathMl$1);\n        addToSet(ALLOWED_ATTR, mathMl);\n        addToSet(ALLOWED_ATTR, xml);\n      }\n    }\n    /* Merge configuration parameters */\n    if (cfg.ADD_TAGS) {\n      if (typeof cfg.ADD_TAGS === 'function') {\n        EXTRA_ELEMENT_HANDLING.tagCheck = cfg.ADD_TAGS;\n      } else {\n        if (ALLOWED_TAGS === DEFAULT_ALLOWED_TAGS) {\n          ALLOWED_TAGS = clone(ALLOWED_TAGS);\n        }\n        addToSet(ALLOWED_TAGS, cfg.ADD_TAGS, transformCaseFunc);\n      }\n    }\n    if (cfg.ADD_ATTR) {\n      if (typeof cfg.ADD_ATTR === 'function') {\n        EXTRA_ELEMENT_HANDLING.attributeCheck = cfg.ADD_ATTR;\n      } else {\n        if (ALLOWED_ATTR === DEFAULT_ALLOWED_ATTR) {\n          ALLOWED_ATTR = clone(ALLOWED_ATTR);\n        }\n        addToSet(ALLOWED_ATTR, cfg.ADD_ATTR, transformCaseFunc);\n      }\n    }\n    if (cfg.ADD_URI_SAFE_ATTR) {\n      addToSet(URI_SAFE_ATTRIBUTES, cfg.ADD_URI_SAFE_ATTR, transformCaseFunc);\n    }\n    if (cfg.FORBID_CONTENTS) {\n      if (FORBID_CONTENTS === DEFAULT_FORBID_CONTENTS) {\n        FORBID_CONTENTS = clone(FORBID_CONTENTS);\n      }\n      addToSet(FORBID_CONTENTS, cfg.FORBID_CONTENTS, transformCaseFunc);\n    }\n    if (cfg.ADD_FORBID_CONTENTS) {\n      if (FORBID_CONTENTS === DEFAULT_FORBID_CONTENTS) {\n        FORBID_CONTENTS = clone(FORBID_CONTENTS);\n      }\n      addToSet(FORBID_CONTENTS, cfg.ADD_FORBID_CONTENTS, transformCaseFunc);\n    }\n    /* Add #text in case KEEP_CONTENT is set to true */\n    if (KEEP_CONTENT) {\n      ALLOWED_TAGS['#text'] = true;\n    }\n    /* Add html, head and body to ALLOWED_TAGS in case WHOLE_DOCUMENT is true */\n    if (WHOLE_DOCUMENT) {\n      addToSet(ALLOWED_TAGS, ['html', 'head', 'body']);\n    }\n    /* Add tbody to ALLOWED_TAGS in case tables are permitted, see #286, #365 */\n    if (ALLOWED_TAGS.table) {\n      addToSet(ALLOWED_TAGS, ['tbody']);\n      delete FORBID_TAGS.tbody;\n    }\n    if (cfg.TRUSTED_TYPES_POLICY) {\n      if (typeof cfg.TRUSTED_TYPES_POLICY.createHTML !== 'function') {\n        throw typeErrorCreate('TRUSTED_TYPES_POLICY configuration option must provide a \"createHTML\" hook.');\n      }\n      if (typeof cfg.TRUSTED_TYPES_POLICY.createScriptURL !== 'function') {\n        throw typeErrorCreate('TRUSTED_TYPES_POLICY configuration option must provide a \"createScriptURL\" hook.');\n      }\n      // Overwrite existing TrustedTypes policy.\n      trustedTypesPolicy = cfg.TRUSTED_TYPES_POLICY;\n      // Sign local variables required by `sanitize`.\n      emptyHTML = trustedTypesPolicy.createHTML('');\n    } else {\n      // Uninitialized policy, attempt to initialize the internal dompurify policy.\n      if (trustedTypesPolicy === undefined) {\n        trustedTypesPolicy = _createTrustedTypesPolicy(trustedTypes, currentScript);\n      }\n      // If creating the internal policy succeeded sign internal variables.\n      if (trustedTypesPolicy !== null && typeof emptyHTML === 'string') {\n        emptyHTML = trustedTypesPolicy.createHTML('');\n      }\n    }\n    // Prevent further manipulation of configuration.\n    // Not available in IE8, Safari 5, etc.\n    if (freeze) {\n      freeze(cfg);\n    }\n    CONFIG = cfg;\n  };\n  /* Keep track of all possible SVG and MathML tags\n   * so that we can perform the namespace checks\n   * correctly. */\n  const ALL_SVG_TAGS = addToSet({}, [...svg$1, ...svgFilters, ...svgDisallowed]);\n  const ALL_MATHML_TAGS = addToSet({}, [...mathMl$1, ...mathMlDisallowed]);\n  /**\n   * @param element a DOM element whose namespace is being checked\n   * @returns Return false if the element has a\n   *  namespace that a spec-compliant parser would never\n   *  return. Return true otherwise.\n   */\n  const _checkValidNamespace = function _checkValidNamespace(element) {\n    let parent = getParentNode(element);\n    // In JSDOM, if we're inside shadow DOM, then parentNode\n    // can be null. We just simulate parent in this case.\n    if (!parent || !parent.tagName) {\n      parent = {\n        namespaceURI: NAMESPACE,\n        tagName: 'template'\n      };\n    }\n    const tagName = stringToLowerCase(element.tagName);\n    const parentTagName = stringToLowerCase(parent.tagName);\n    if (!ALLOWED_NAMESPACES[element.namespaceURI]) {\n      return false;\n    }\n    if (element.namespaceURI === SVG_NAMESPACE) {\n      // The only way to switch from HTML namespace to SVG\n      // is via <svg>. If it happens via any other tag, then\n      // it should be killed.\n      if (parent.namespaceURI === HTML_NAMESPACE) {\n        return tagName === 'svg';\n      }\n      // The only way to switch from MathML to SVG is via`\n      // svg if parent is either <annotation-xml> or MathML\n      // text integration points.\n      if (parent.namespaceURI === MATHML_NAMESPACE) {\n        return tagName === 'svg' && (parentTagName === 'annotation-xml' || MATHML_TEXT_INTEGRATION_POINTS[parentTagName]);\n      }\n      // We only allow elements that are defined in SVG\n      // spec. All others are disallowed in SVG namespace.\n      return Boolean(ALL_SVG_TAGS[tagName]);\n    }\n    if (element.namespaceURI === MATHML_NAMESPACE) {\n      // The only way to switch from HTML namespace to MathML\n      // is via <math>. If it happens via any other tag, then\n      // it should be killed.\n      if (parent.namespaceURI === HTML_NAMESPACE) {\n        return tagName === 'math';\n      }\n      // The only way to switch from SVG to MathML is via\n      // <math> and HTML integration points\n      if (parent.namespaceURI === SVG_NAMESPACE) {\n        return tagName === 'math' && HTML_INTEGRATION_POINTS[parentTagName];\n      }\n      // We only allow elements that are defined in MathML\n      // spec. All others are disallowed in MathML namespace.\n      return Boolean(ALL_MATHML_TAGS[tagName]);\n    }\n    if (element.namespaceURI === HTML_NAMESPACE) {\n      // The only way to switch from SVG to HTML is via\n      // HTML integration points, and from MathML to HTML\n      // is via MathML text integration points\n      if (parent.namespaceURI === SVG_NAMESPACE && !HTML_INTEGRATION_POINTS[parentTagName]) {\n        return false;\n      }\n      if (parent.namespaceURI === MATHML_NAMESPACE && !MATHML_TEXT_INTEGRATION_POINTS[parentTagName]) {\n        return false;\n      }\n      // We disallow tags that are specific for MathML\n      // or SVG and should never appear in HTML namespace\n      return !ALL_MATHML_TAGS[tagName] && (COMMON_SVG_AND_HTML_ELEMENTS[tagName] || !ALL_SVG_TAGS[tagName]);\n    }\n    // For XHTML and XML documents that support custom namespaces\n    if (PARSER_MEDIA_TYPE === 'application/xhtml+xml' && ALLOWED_NAMESPACES[element.namespaceURI]) {\n      return true;\n    }\n    // The code should never reach this place (this means\n    // that the element somehow got namespace that is not\n    // HTML, SVG, MathML or allowed via ALLOWED_NAMESPACES).\n    // Return false just in case.\n    return false;\n  };\n  /**\n   * _forceRemove\n   *\n   * @param node a DOM node\n   */\n  const _forceRemove = function _forceRemove(node) {\n    arrayPush(DOMPurify.removed, {\n      element: node\n    });\n    try {\n      // eslint-disable-next-line unicorn/prefer-dom-node-remove\n      getParentNode(node).removeChild(node);\n    } catch (_) {\n      remove(node);\n    }\n  };\n  /**\n   * _removeAttribute\n   *\n   * @param name an Attribute name\n   * @param element a DOM node\n   */\n  const _removeAttribute = function _removeAttribute(name, element) {\n    try {\n      arrayPush(DOMPurify.removed, {\n        attribute: element.getAttributeNode(name),\n        from: element\n      });\n    } catch (_) {\n      arrayPush(DOMPurify.removed, {\n        attribute: null,\n        from: element\n      });\n    }\n    element.removeAttribute(name);\n    // We void attribute values for unremovable \"is\" attributes\n    if (name === 'is') {\n      if (RETURN_DOM || RETURN_DOM_FRAGMENT) {\n        try {\n          _forceRemove(element);\n        } catch (_) {}\n      } else {\n        try {\n          element.setAttribute(name, '');\n        } catch (_) {}\n      }\n    }\n  };\n  /**\n   * _initDocument\n   *\n   * @param dirty - a string of dirty markup\n   * @return a DOM, filled with the dirty markup\n   */\n  const _initDocument = function _initDocument(dirty) {\n    /* Create a HTML document */\n    let doc = null;\n    let leadingWhitespace = null;\n    if (FORCE_BODY) {\n      dirty = '<remove></remove>' + dirty;\n    } else {\n      /* If FORCE_BODY isn't used, leading whitespace needs to be preserved manually */\n      const matches = stringMatch(dirty, /^[\\r\\n\\t ]+/);\n      leadingWhitespace = matches && matches[0];\n    }\n    if (PARSER_MEDIA_TYPE === 'application/xhtml+xml' && NAMESPACE === HTML_NAMESPACE) {\n      // Root of XHTML doc must contain xmlns declaration (see https://www.w3.org/TR/xhtml1/normative.html#strict)\n      dirty = '<html xmlns=\"http://www.w3.org/1999/xhtml\"><head></head><body>' + dirty + '</body></html>';\n    }\n    const dirtyPayload = trustedTypesPolicy ? trustedTypesPolicy.createHTML(dirty) : dirty;\n    /*\n     * Use the DOMParser API by default, fallback later if needs be\n     * DOMParser not work for svg when has multiple root element.\n     */\n    if (NAMESPACE === HTML_NAMESPACE) {\n      try {\n        doc = new DOMParser().parseFromString(dirtyPayload, PARSER_MEDIA_TYPE);\n      } catch (_) {}\n    }\n    /* Use createHTMLDocument in case DOMParser is not available */\n    if (!doc || !doc.documentElement) {\n      doc = implementation.createDocument(NAMESPACE, 'template', null);\n      try {\n        doc.documentElement.innerHTML = IS_EMPTY_INPUT ? emptyHTML : dirtyPayload;\n      } catch (_) {\n        // Syntax error if dirtyPayload is invalid xml\n      }\n    }\n    const body = doc.body || doc.documentElement;\n    if (dirty && leadingWhitespace) {\n      body.insertBefore(document.createTextNode(leadingWhitespace), body.childNodes[0] || null);\n    }\n    /* Work on whole document or just its body */\n    if (NAMESPACE === HTML_NAMESPACE) {\n      return getElementsByTagName.call(doc, WHOLE_DOCUMENT ? 'html' : 'body')[0];\n    }\n    return WHOLE_DOCUMENT ? doc.documentElement : body;\n  };\n  /**\n   * Creates a NodeIterator object that you can use to traverse filtered lists of nodes or elements in a document.\n   *\n   * @param root The root element or node to start traversing on.\n   * @return The created NodeIterator\n   */\n  const _createNodeIterator = function _createNodeIterator(root) {\n    return createNodeIterator.call(root.ownerDocument || root, root,\n    // eslint-disable-next-line no-bitwise\n    NodeFilter.SHOW_ELEMENT | NodeFilter.SHOW_COMMENT | NodeFilter.SHOW_TEXT | NodeFilter.SHOW_PROCESSING_INSTRUCTION | NodeFilter.SHOW_CDATA_SECTION, null);\n  };\n  /**\n   * _isClobbered\n   *\n   * @param element element to check for clobbering attacks\n   * @return true if clobbered, false if safe\n   */\n  const _isClobbered = function _isClobbered(element) {\n    return element instanceof HTMLFormElement && (typeof element.nodeName !== 'string' || typeof element.textContent !== 'string' || typeof element.removeChild !== 'function' || !(element.attributes instanceof NamedNodeMap) || typeof element.removeAttribute !== 'function' || typeof element.setAttribute !== 'function' || typeof element.namespaceURI !== 'string' || typeof element.insertBefore !== 'function' || typeof element.hasChildNodes !== 'function');\n  };\n  /**\n   * Checks whether the given object is a DOM node.\n   *\n   * @param value object to check whether it's a DOM node\n   * @return true is object is a DOM node\n   */\n  const _isNode = function _isNode(value) {\n    return typeof Node === 'function' && value instanceof Node;\n  };\n  function _executeHooks(hooks, currentNode, data) {\n    arrayForEach(hooks, hook => {\n      hook.call(DOMPurify, currentNode, data, CONFIG);\n    });\n  }\n  /**\n   * _sanitizeElements\n   *\n   * @protect nodeName\n   * @protect textContent\n   * @protect removeChild\n   * @param currentNode to check for permission to exist\n   * @return true if node was killed, false if left alive\n   */\n  const _sanitizeElements = function _sanitizeElements(currentNode) {\n    let content = null;\n    /* Execute a hook if present */\n    _executeHooks(hooks.beforeSanitizeElements, currentNode, null);\n    /* Check if element is clobbered or can clobber */\n    if (_isClobbered(currentNode)) {\n      _forceRemove(currentNode);\n      return true;\n    }\n    /* Now let's check the element's type and name */\n    const tagName = transformCaseFunc(currentNode.nodeName);\n    /* Execute a hook if present */\n    _executeHooks(hooks.uponSanitizeElement, currentNode, {\n      tagName,\n      allowedTags: ALLOWED_TAGS\n    });\n    /* Detect mXSS attempts abusing namespace confusion */\n    if (SAFE_FOR_XML && currentNode.hasChildNodes() && !_isNode(currentNode.firstElementChild) && regExpTest(/<[/\\w!]/g, currentNode.innerHTML) && regExpTest(/<[/\\w!]/g, currentNode.textContent)) {\n      _forceRemove(currentNode);\n      return true;\n    }\n    /* Remove any occurrence of processing instructions */\n    if (currentNode.nodeType === NODE_TYPE.progressingInstruction) {\n      _forceRemove(currentNode);\n      return true;\n    }\n    /* Remove any kind of possibly harmful comments */\n    if (SAFE_FOR_XML && currentNode.nodeType === NODE_TYPE.comment && regExpTest(/<[/\\w]/g, currentNode.data)) {\n      _forceRemove(currentNode);\n      return true;\n    }\n    /* Remove element if anything forbids its presence */\n    if (!(EXTRA_ELEMENT_HANDLING.tagCheck instanceof Function && EXTRA_ELEMENT_HANDLING.tagCheck(tagName)) && (!ALLOWED_TAGS[tagName] || FORBID_TAGS[tagName])) {\n      /* Check if we have a custom element to handle */\n      if (!FORBID_TAGS[tagName] && _isBasicCustomElement(tagName)) {\n        if (CUSTOM_ELEMENT_HANDLING.tagNameCheck instanceof RegExp && regExpTest(CUSTOM_ELEMENT_HANDLING.tagNameCheck, tagName)) {\n          return false;\n        }\n        if (CUSTOM_ELEMENT_HANDLING.tagNameCheck instanceof Function && CUSTOM_ELEMENT_HANDLING.tagNameCheck(tagName)) {\n          return false;\n        }\n      }\n      /* Keep content except for bad-listed elements */\n      if (KEEP_CONTENT && !FORBID_CONTENTS[tagName]) {\n        const parentNode = getParentNode(currentNode) || currentNode.parentNode;\n        const childNodes = getChildNodes(currentNode) || currentNode.childNodes;\n        if (childNodes && parentNode) {\n          const childCount = childNodes.length;\n          for (let i = childCount - 1; i >= 0; --i) {\n            const childClone = cloneNode(childNodes[i], true);\n            childClone.__removalCount = (currentNode.__removalCount || 0) + 1;\n            parentNode.insertBefore(childClone, getNextSibling(currentNode));\n          }\n        }\n      }\n      _forceRemove(currentNode);\n      return true;\n    }\n    /* Check whether element has a valid namespace */\n    if (currentNode instanceof Element && !_checkValidNamespace(currentNode)) {\n      _forceRemove(currentNode);\n      return true;\n    }\n    /* Make sure that older browsers don't get fallback-tag mXSS */\n    if ((tagName === 'noscript' || tagName === 'noembed' || tagName === 'noframes') && regExpTest(/<\\/no(script|embed|frames)/i, currentNode.innerHTML)) {\n      _forceRemove(currentNode);\n      return true;\n    }\n    /* Sanitize element content to be template-safe */\n    if (SAFE_FOR_TEMPLATES && currentNode.nodeType === NODE_TYPE.text) {\n      /* Get the element's text content */\n      content = currentNode.textContent;\n      arrayForEach([MUSTACHE_EXPR, ERB_EXPR, TMPLIT_EXPR], expr => {\n        content = stringReplace(content, expr, ' ');\n      });\n      if (currentNode.textContent !== content) {\n        arrayPush(DOMPurify.removed, {\n          element: currentNode.cloneNode()\n        });\n        currentNode.textContent = content;\n      }\n    }\n    /* Execute a hook if present */\n    _executeHooks(hooks.afterSanitizeElements, currentNode, null);\n    return false;\n  };\n  /**\n   * _isValidAttribute\n   *\n   * @param lcTag Lowercase tag name of containing element.\n   * @param lcName Lowercase attribute name.\n   * @param value Attribute value.\n   * @return Returns true if `value` is valid, otherwise false.\n   */\n  // eslint-disable-next-line complexity\n  const _isValidAttribute = function _isValidAttribute(lcTag, lcName, value) {\n    /* Make sure attribute cannot clobber */\n    if (SANITIZE_DOM && (lcName === 'id' || lcName === 'name') && (value in document || value in formElement)) {\n      return false;\n    }\n    /* Allow valid data-* attributes: At least one character after \"-\"\n        (https://html.spec.whatwg.org/multipage/dom.html#embedding-custom-non-visible-data-with-the-data-*-attributes)\n        XML-compatible (https://html.spec.whatwg.org/multipage/infrastructure.html#xml-compatible and http://www.w3.org/TR/xml/#d0e804)\n        We don't need to check the value; it's always URI safe. */\n    if (ALLOW_DATA_ATTR && !FORBID_ATTR[lcName] && regExpTest(DATA_ATTR, lcName)) ; else if (ALLOW_ARIA_ATTR && regExpTest(ARIA_ATTR, lcName)) ; else if (EXTRA_ELEMENT_HANDLING.attributeCheck instanceof Function && EXTRA_ELEMENT_HANDLING.attributeCheck(lcName, lcTag)) ; else if (!ALLOWED_ATTR[lcName] || FORBID_ATTR[lcName]) {\n      if (\n      // First condition does a very basic check if a) it's basically a valid custom element tagname AND\n      // b) if the tagName passes whatever the user has configured for CUSTOM_ELEMENT_HANDLING.tagNameCheck\n      // and c) if the attribute name passes whatever the user has configured for CUSTOM_ELEMENT_HANDLING.attributeNameCheck\n      _isBasicCustomElement(lcTag) && (CUSTOM_ELEMENT_HANDLING.tagNameCheck instanceof RegExp && regExpTest(CUSTOM_ELEMENT_HANDLING.tagNameCheck, lcTag) || CUSTOM_ELEMENT_HANDLING.tagNameCheck instanceof Function && CUSTOM_ELEMENT_HANDLING.tagNameCheck(lcTag)) && (CUSTOM_ELEMENT_HANDLING.attributeNameCheck instanceof RegExp && regExpTest(CUSTOM_ELEMENT_HANDLING.attributeNameCheck, lcName) || CUSTOM_ELEMENT_HANDLING.attributeNameCheck instanceof Function && CUSTOM_ELEMENT_HANDLING.attributeNameCheck(lcName, lcTag)) ||\n      // Alternative, second condition checks if it's an `is`-attribute, AND\n      // the value passes whatever the user has configured for CUSTOM_ELEMENT_HANDLING.tagNameCheck\n      lcName === 'is' && CUSTOM_ELEMENT_HANDLING.allowCustomizedBuiltInElements && (CUSTOM_ELEMENT_HANDLING.tagNameCheck instanceof RegExp && regExpTest(CUSTOM_ELEMENT_HANDLING.tagNameCheck, value) || CUSTOM_ELEMENT_HANDLING.tagNameCheck instanceof Function && CUSTOM_ELEMENT_HANDLING.tagNameCheck(value))) ; else {\n        return false;\n      }\n      /* Check value is safe. First, is attr inert? If so, is safe */\n    } else if (URI_SAFE_ATTRIBUTES[lcName]) ; else if (regExpTest(IS_ALLOWED_URI$1, stringReplace(value, ATTR_WHITESPACE, ''))) ; else if ((lcName === 'src' || lcName === 'xlink:href' || lcName === 'href') && lcTag !== 'script' && stringIndexOf(value, 'data:') === 0 && DATA_URI_TAGS[lcTag]) ; else if (ALLOW_UNKNOWN_PROTOCOLS && !regExpTest(IS_SCRIPT_OR_DATA, stringReplace(value, ATTR_WHITESPACE, ''))) ; else if (value) {\n      return false;\n    } else ;\n    return true;\n  };\n  /**\n   * _isBasicCustomElement\n   * checks if at least one dash is included in tagName, and it's not the first char\n   * for more sophisticated checking see https://github.com/sindresorhus/validate-element-name\n   *\n   * @param tagName name of the tag of the node to sanitize\n   * @returns Returns true if the tag name meets the basic criteria for a custom element, otherwise false.\n   */\n  const _isBasicCustomElement = function _isBasicCustomElement(tagName) {\n    return tagName !== 'annotation-xml' && stringMatch(tagName, CUSTOM_ELEMENT);\n  };\n  /**\n   * _sanitizeAttributes\n   *\n   * @protect attributes\n   * @protect nodeName\n   * @protect removeAttribute\n   * @protect setAttribute\n   *\n   * @param currentNode to sanitize\n   */\n  const _sanitizeAttributes = function _sanitizeAttributes(currentNode) {\n    /* Execute a hook if present */\n    _executeHooks(hooks.beforeSanitizeAttributes, currentNode, null);\n    const {\n      attributes\n    } = currentNode;\n    /* Check if we have attributes; if not we might have a text node */\n    if (!attributes || _isClobbered(currentNode)) {\n      return;\n    }\n    const hookEvent = {\n      attrName: '',\n      attrValue: '',\n      keepAttr: true,\n      allowedAttributes: ALLOWED_ATTR,\n      forceKeepAttr: undefined\n    };\n    let l = attributes.length;\n    /* Go backwards over all attributes; safely remove bad ones */\n    while (l--) {\n      const attr = attributes[l];\n      const {\n        name,\n        namespaceURI,\n        value: attrValue\n      } = attr;\n      const lcName = transformCaseFunc(name);\n      const initValue = attrValue;\n      let value = name === 'value' ? initValue : stringTrim(initValue);\n      /* Execute a hook if present */\n      hookEvent.attrName = lcName;\n      hookEvent.attrValue = value;\n      hookEvent.keepAttr = true;\n      hookEvent.forceKeepAttr = undefined; // Allows developers to see this is a property they can set\n      _executeHooks(hooks.uponSanitizeAttribute, currentNode, hookEvent);\n      value = hookEvent.attrValue;\n      /* Full DOM Clobbering protection via namespace isolation,\n       * Prefix id and name attributes with `user-content-`\n       */\n      if (SANITIZE_NAMED_PROPS && (lcName === 'id' || lcName === 'name')) {\n        // Remove the attribute with this value\n        _removeAttribute(name, currentNode);\n        // Prefix the value and later re-create the attribute with the sanitized value\n        value = SANITIZE_NAMED_PROPS_PREFIX + value;\n      }\n      /* Work around a security issue with comments inside attributes */\n      if (SAFE_FOR_XML && regExpTest(/((--!?|])>)|<\\/(style|title|textarea)/i, value)) {\n        _removeAttribute(name, currentNode);\n        continue;\n      }\n      /* Make sure we cannot easily use animated hrefs, even if animations are allowed */\n      if (lcName === 'attributename' && stringMatch(value, 'href')) {\n        _removeAttribute(name, currentNode);\n        continue;\n      }\n      /* Did the hooks approve of the attribute? */\n      if (hookEvent.forceKeepAttr) {\n        continue;\n      }\n      /* Did the hooks approve of the attribute? */\n      if (!hookEvent.keepAttr) {\n        _removeAttribute(name, currentNode);\n        continue;\n      }\n      /* Work around a security issue in jQuery 3.0 */\n      if (!ALLOW_SELF_CLOSE_IN_ATTR && regExpTest(/\\/>/i, value)) {\n        _removeAttribute(name, currentNode);\n        continue;\n      }\n      /* Sanitize attribute content to be template-safe */\n      if (SAFE_FOR_TEMPLATES) {\n        arrayForEach([MUSTACHE_EXPR, ERB_EXPR, TMPLIT_EXPR], expr => {\n          value = stringReplace(value, expr, ' ');\n        });\n      }\n      /* Is `value` valid for this attribute? */\n      const lcTag = transformCaseFunc(currentNode.nodeName);\n      if (!_isValidAttribute(lcTag, lcName, value)) {\n        _removeAttribute(name, currentNode);\n        continue;\n      }\n      /* Handle attributes that require Trusted Types */\n      if (trustedTypesPolicy && typeof trustedTypes === 'object' && typeof trustedTypes.getAttributeType === 'function') {\n        if (namespaceURI) ; else {\n          switch (trustedTypes.getAttributeType(lcTag, lcName)) {\n            case 'TrustedHTML':\n              {\n                value = trustedTypesPolicy.createHTML(value);\n                break;\n              }\n            case 'TrustedScriptURL':\n              {\n                value = trustedTypesPolicy.createScriptURL(value);\n                break;\n              }\n          }\n        }\n      }\n      /* Handle invalid data-* attribute set by try-catching it */\n      if (value !== initValue) {\n        try {\n          if (namespaceURI) {\n            currentNode.setAttributeNS(namespaceURI, name, value);\n          } else {\n            /* Fallback to setAttribute() for browser-unrecognized namespaces e.g. \"x-schema\". */\n            currentNode.setAttribute(name, value);\n          }\n          if (_isClobbered(currentNode)) {\n            _forceRemove(currentNode);\n          } else {\n            arrayPop(DOMPurify.removed);\n          }\n        } catch (_) {\n          _removeAttribute(name, currentNode);\n        }\n      }\n    }\n    /* Execute a hook if present */\n    _executeHooks(hooks.afterSanitizeAttributes, currentNode, null);\n  };\n  /**\n   * _sanitizeShadowDOM\n   *\n   * @param fragment to iterate over recursively\n   */\n  const _sanitizeShadowDOM = function _sanitizeShadowDOM(fragment) {\n    let shadowNode = null;\n    const shadowIterator = _createNodeIterator(fragment);\n    /* Execute a hook if present */\n    _executeHooks(hooks.beforeSanitizeShadowDOM, fragment, null);\n    while (shadowNode = shadowIterator.nextNode()) {\n      /* Execute a hook if present */\n      _executeHooks(hooks.uponSanitizeShadowNode, shadowNode, null);\n      /* Sanitize tags and elements */\n      _sanitizeElements(shadowNode);\n      /* Check attributes next */\n      _sanitizeAttributes(shadowNode);\n      /* Deep shadow DOM detected */\n      if (shadowNode.content instanceof DocumentFragment) {\n        _sanitizeShadowDOM(shadowNode.content);\n      }\n    }\n    /* Execute a hook if present */\n    _executeHooks(hooks.afterSanitizeShadowDOM, fragment, null);\n  };\n  // eslint-disable-next-line complexity\n  DOMPurify.sanitize = function (dirty) {\n    let cfg = arguments.length > 1 && arguments[1] !== undefined ? arguments[1] : {};\n    let body = null;\n    let importedNode = null;\n    let currentNode = null;\n    let returnNode = null;\n    /* Make sure we have a string to sanitize.\n      DO NOT return early, as this will return the wrong type if\n      the user has requested a DOM object rather than a string */\n    IS_EMPTY_INPUT = !dirty;\n    if (IS_EMPTY_INPUT) {\n      dirty = '<!-->';\n    }\n    /* Stringify, in case dirty is an object */\n    if (typeof dirty !== 'string' && !_isNode(dirty)) {\n      if (typeof dirty.toString === 'function') {\n        dirty = dirty.toString();\n        if (typeof dirty !== 'string') {\n          throw typeErrorCreate('dirty is not a string, aborting');\n        }\n      } else {\n        throw typeErrorCreate('toString is not a function');\n      }\n    }\n    /* Return dirty HTML if DOMPurify cannot run */\n    if (!DOMPurify.isSupported) {\n      return dirty;\n    }\n    /* Assign config vars */\n    if (!SET_CONFIG) {\n      _parseConfig(cfg);\n    }\n    /* Clean up removed elements */\n    DOMPurify.removed = [];\n    /* Check if dirty is correctly typed for IN_PLACE */\n    if (typeof dirty === 'string') {\n      IN_PLACE = false;\n    }\n    if (IN_PLACE) {\n      /* Do some early pre-sanitization to avoid unsafe root nodes */\n      if (dirty.nodeName) {\n        const tagName = transformCaseFunc(dirty.nodeName);\n        if (!ALLOWED_TAGS[tagName] || FORBID_TAGS[tagName]) {\n          throw typeErrorCreate('root node is forbidden and cannot be sanitized in-place');\n        }\n      }\n    } else if (dirty instanceof Node) {\n      /* If dirty is a DOM element, append to an empty document to avoid\n         elements being stripped by the parser */\n      body = _initDocument('<!---->');\n      importedNode = body.ownerDocument.importNode(dirty, true);\n      if (importedNode.nodeType === NODE_TYPE.element && importedNode.nodeName === 'BODY') {\n        /* Node is already a body, use as is */\n        body = importedNode;\n      } else if (importedNode.nodeName === 'HTML') {\n        body = importedNode;\n      } else {\n        // eslint-disable-next-line unicorn/prefer-dom-node-append\n        body.appendChild(importedNode);\n      }\n    } else {\n      /* Exit directly if we have nothing to do */\n      if (!RETURN_DOM && !SAFE_FOR_TEMPLATES && !WHOLE_DOCUMENT &&\n      // eslint-disable-next-line unicorn/prefer-includes\n      dirty.indexOf('<') === -1) {\n        return trustedTypesPolicy && RETURN_TRUSTED_TYPE ? trustedTypesPolicy.createHTML(dirty) : dirty;\n      }\n      /* Initialize the document to work on */\n      body = _initDocument(dirty);\n      /* Check we have a DOM node from the data */\n      if (!body) {\n        return RETURN_DOM ? null : RETURN_TRUSTED_TYPE ? emptyHTML : '';\n      }\n    }\n    /* Remove first element node (ours) if FORCE_BODY is set */\n    if (body && FORCE_BODY) {\n      _forceRemove(body.firstChild);\n    }\n    /* Get node iterator */\n    const nodeIterator = _createNodeIterator(IN_PLACE ? dirty : body);\n    /* Now start iterating over the created document */\n    while (currentNode = nodeIterator.nextNode()) {\n      /* Sanitize tags and elements */\n      _sanitizeElements(currentNode);\n      /* Check attributes next */\n      _sanitizeAttributes(currentNode);\n      /* Shadow DOM detected, sanitize it */\n      if (currentNode.content instanceof DocumentFragment) {\n        _sanitizeShadowDOM(currentNode.content);\n      }\n    }\n    /* If we sanitized `dirty` in-place, return it. */\n    if (IN_PLACE) {\n      return dirty;\n    }\n    /* Return sanitized string or DOM */\n    if (RETURN_DOM) {\n      if (RETURN_DOM_FRAGMENT) {\n        returnNode = createDocumentFragment.call(body.ownerDocument);\n        while (body.firstChild) {\n          // eslint-disable-next-line unicorn/prefer-dom-node-append\n          returnNode.appendChild(body.firstChild);\n        }\n      } else {\n        returnNode = body;\n      }\n      if (ALLOWED_ATTR.shadowroot || ALLOWED_ATTR.shadowrootmode) {\n        /*\n          AdoptNode() is not used because internal state is not reset\n          (e.g. the past names map of a HTMLFormElement), this is safe\n          in theory but we would rather not risk another attack vector.\n          The state that is cloned by importNode() is explicitly defined\n          by the specs.\n        */\n        returnNode = importNode.call(originalDocument, returnNode, true);\n      }\n      return returnNode;\n    }\n    let serializedHTML = WHOLE_DOCUMENT ? body.outerHTML : body.innerHTML;\n    /* Serialize doctype if allowed */\n    if (WHOLE_DOCUMENT && ALLOWED_TAGS['!doctype'] && body.ownerDocument && body.ownerDocument.doctype && body.ownerDocument.doctype.name && regExpTest(DOCTYPE_NAME, body.ownerDocument.doctype.name)) {\n      serializedHTML = '<!DOCTYPE ' + body.ownerDocument.doctype.name + '>\\n' + serializedHTML;\n    }\n    /* Sanitize final string template-safe */\n    if (SAFE_FOR_TEMPLATES) {\n      arrayForEach([MUSTACHE_EXPR, ERB_EXPR, TMPLIT_EXPR], expr => {\n        serializedHTML = stringReplace(serializedHTML, expr, ' ');\n      });\n    }\n    return trustedTypesPolicy && RETURN_TRUSTED_TYPE ? trustedTypesPolicy.createHTML(serializedHTML) : serializedHTML;\n  };\n  DOMPurify.setConfig = function () {\n    let cfg = arguments.length > 0 && arguments[0] !== undefined ? arguments[0] : {};\n    _parseConfig(cfg);\n    SET_CONFIG = true;\n  };\n  DOMPurify.clearConfig = function () {\n    CONFIG = null;\n    SET_CONFIG = false;\n  };\n  DOMPurify.isValidAttribute = function (tag, attr, value) {\n    /* Initialize shared config vars if necessary. */\n    if (!CONFIG) {\n      _parseConfig({});\n    }\n    const lcTag = transformCaseFunc(tag);\n    const lcName = transformCaseFunc(attr);\n    return _isValidAttribute(lcTag, lcName, value);\n  };\n  DOMPurify.addHook = function (entryPoint, hookFunction) {\n    if (typeof hookFunction !== 'function') {\n      return;\n    }\n    arrayPush(hooks[entryPoint], hookFunction);\n  };\n  DOMPurify.removeHook = function (entryPoint, hookFunction) {\n    if (hookFunction !== undefined) {\n      const index = arrayLastIndexOf(hooks[entryPoint], hookFunction);\n      return index === -1 ? undefined : arraySplice(hooks[entryPoint], index, 1)[0];\n    }\n    return arrayPop(hooks[entryPoint]);\n  };\n  DOMPurify.removeHooks = function (entryPoint) {\n    hooks[entryPoint] = [];\n  };\n  DOMPurify.removeAllHooks = function () {\n    hooks = _createHooksMap();\n  };\n  return DOMPurify;\n}\nvar purify = createDOMPurify();\n\nexport { purify as default };\n//# sourceMappingURL=purify.es.mjs.map\n","/**\r\n * DOM Utilities\r\n * Helper functions for DOM manipulation\r\n */\r\n\r\n/**\r\n * Query selector with type safety\r\n */\r\nexport function $(selector: string, parent: ParentNode = document): HTMLElement | null {\r\n  return parent.querySelector(selector);\r\n}\r\n\r\n/**\r\n * Query selector all with type safety\r\n */\r\nexport function $$(selector: string, parent: ParentNode = document): HTMLElement[] {\r\n  return Array.from(parent.querySelectorAll(selector));\r\n}\r\n\r\n/**\r\n * Get element by ID with type safety\r\n */\r\nexport function $id<T extends HTMLElement = HTMLElement>(id: string): T | null {\r\n  return document.getElementById(id) as T | null;\r\n}\r\n\r\n/**\r\n * Create element with attributes\r\n */\r\nexport function createElement<K extends keyof HTMLElementTagNameMap>(\r\n  tag: K,\r\n  attributes?: Partial<Omit<HTMLElementTagNameMap[K], 'style'>> & { style?: string | Partial<CSSStyleDeclaration> } & Record<string, unknown>,\r\n  children?: (Node | string)[]\r\n): HTMLElementTagNameMap[K] {\r\n  const el = document.createElement(tag);\r\n\r\n  if (attributes) {\r\n    Object.entries(attributes).forEach(([key, value]) => {\r\n      if (key === 'className') {\r\n        el.className = value as string;\r\n      } else if (key === 'style') {\r\n        if (typeof value === 'object') {\r\n          Object.assign(el.style, value);\r\n        } else if (typeof value === 'string') {\r\n          el.style.cssText = value;\r\n        }\r\n      } else if (key.startsWith('data')) {\r\n        el.setAttribute(key.replace(/([A-Z])/g, '-$1').toLowerCase(), String(value));\r\n      } else {\r\n        (el as Record<string, unknown>)[key] = value;\r\n      }\r\n    });\r\n  }\r\n\r\n  if (children) {\r\n    children.forEach(child => {\r\n      if (typeof child === 'string') {\r\n        el.appendChild(document.createTextNode(child));\r\n      } else {\r\n        el.appendChild(child);\r\n      }\r\n    });\r\n  }\r\n\r\n  return el;\r\n}\r\n\r\n/**\r\n * Add event listener with cleanup\r\n */\r\nexport function on<K extends keyof HTMLElementEventMap>(\r\n  element: HTMLElement | Window | Document,\r\n  event: K,\r\n  handler: (e: HTMLElementEventMap[K]) => void,\r\n  options?: AddEventListenerOptions\r\n): () => void {\r\n  element.addEventListener(event, handler as EventListener, options);\r\n  return () => element.removeEventListener(event, handler as EventListener, options);\r\n}\r\n\r\n/**\r\n * Toggle class on element\r\n */\r\nexport function toggleClass(element: HTMLElement, className: string, force?: boolean): boolean {\r\n  return element.classList.toggle(className, force);\r\n}\r\n\r\n/**\r\n * Add multiple classes\r\n */\r\nexport function addClass(element: HTMLElement, ...classes: string[]): void {\r\n  element.classList.add(...classes);\r\n}\r\n\r\n/**\r\n * Remove multiple classes\r\n */\r\nexport function removeClass(element: HTMLElement, ...classes: string[]): void {\r\n  element.classList.remove(...classes);\r\n}\r\n\r\n/**\r\n * Check if element has class\r\n */\r\nexport function hasClass(element: HTMLElement, className: string): boolean {\r\n  return element.classList.contains(className);\r\n}\r\n\r\n/**\r\n * Set multiple attributes\r\n */\r\nexport function setAttributes(element: HTMLElement, attrs: Record<string, string>): void {\r\n  Object.entries(attrs).forEach(([key, value]) => {\r\n    element.setAttribute(key, value);\r\n  });\r\n}\r\n\r\n/**\r\n * Remove element from DOM\r\n */\r\nexport function remove(element: HTMLElement): void {\r\n  element.remove();\r\n}\r\n\r\n/**\r\n * Empty element contents\r\n */\r\nexport function empty(element: HTMLElement): void {\r\n  element.innerHTML = '';\r\n}\r\n\r\n/**\r\n * Set inner HTML safely using DOMPurify\r\n */\r\nimport DOMPurify from 'dompurify';\r\n\r\nexport function setHTML(element: HTMLElement, html: string): void {\r\n  element.innerHTML = DOMPurify.sanitize(html);\r\n}\r\n\r\n/**\r\n * Show element. Uses class 'hidden' when display is 'block'; otherwise sets style.display.\r\n */\r\nexport function show(element: HTMLElement, display = 'block'): void {\r\n  element.classList.remove('hidden');\r\n  if (display === 'block') {\r\n    element.style.removeProperty('display');\r\n  } else {\r\n    element.style.display = display;\r\n  }\r\n}\r\n\r\n/**\r\n * Hide element using class 'hidden' (display: none).\r\n */\r\nexport function hide(element: HTMLElement): void {\r\n  element.classList.add('hidden');\r\n}\r\n\r\n/**\r\n * Toggle element visibility. Uses class 'hidden' when display is 'block'.\r\n */\r\nexport function toggle(element: HTMLElement, visible?: boolean, display = 'block'): void {\r\n  if (visible === undefined) {\r\n    visible = element.classList.contains('hidden');\r\n  }\r\n  if (visible) {\r\n    show(element, display);\r\n  } else {\r\n    hide(element);\r\n  }\r\n}\r\n\r\n/**\r\n * Scroll element into view\r\n */\r\nexport function scrollIntoView(element: HTMLElement, options?: ScrollIntoViewOptions): void {\r\n  element.scrollIntoView({\r\n    behavior: 'smooth',\r\n    block: 'center',\r\n    ...options,\r\n  });\r\n}\r\n\r\n/**\r\n * Focus element with optional scroll\r\n */\r\nexport function focus(element: HTMLElement, preventScroll = false): void {\r\n  element.focus({ preventScroll });\r\n}\r\n\r\n/**\r\n * Wait for element to appear in DOM\r\n */\r\nexport function waitForElement(selector: string, timeout = 5000): Promise<HTMLElement> {\r\n  return new Promise((resolve, reject) => {\r\n    const element = $(selector);\r\n    if (element) {\r\n      resolve(element);\r\n      return;\r\n    }\r\n\r\n    const observer = new MutationObserver(() => {\r\n      const element = $(selector);\r\n      if (element) {\r\n        observer.disconnect();\r\n        resolve(element);\r\n      }\r\n    });\r\n\r\n    observer.observe(document.body, {\r\n      childList: true,\r\n      subtree: true,\r\n    });\r\n\r\n    setTimeout(() => {\r\n      observer.disconnect();\r\n      reject(new Error(`Element ${selector} not found within ${timeout}ms`));\r\n    }, timeout);\r\n  });\r\n}\r\n","/**\r\n * Theme Toggle Component\r\n * Button to cycle through theme modes (light/dark/system)\r\n */\r\n\r\nimport { theme } from '@services/theme';\r\nimport { toast } from '@services/toast';\r\nimport { createElement, on } from '@lib/dom';\r\n\r\n/**\r\n * Create theme toggle button element\r\n */\r\nexport function createThemeToggle(container?: HTMLElement): HTMLButtonElement {\r\n  const button = createElement('button', {\r\n    className: 'btn btn-ghost theme-toggle',\r\n    title: `Theme: ${theme.getLabel()} (Ctrl+Shift+T)`,\r\n  });\r\n\r\n  // Update button content\r\n  function updateButton(): void {\r\n    button.innerHTML = getThemeIcon();\r\n    button.title = `Theme: ${theme.getLabel()} (Ctrl+Shift+T)`;\r\n    button.setAttribute('data-theme-mode', theme.getMode());\r\n  }\r\n\r\n  // Get icon for current theme\r\n  function getThemeIcon(): string {\r\n    const mode = theme.getMode();\r\n    switch (mode) {\r\n      case 'light':\r\n        return `<svg width=\"20\" height=\"20\" viewBox=\"0 0 24 24\" fill=\"none\" stroke=\"currentColor\" stroke-width=\"2\">\r\n          <circle cx=\"12\" cy=\"12\" r=\"5\"/>\r\n          <path d=\"M12 1v2M12 21v2M4.22 4.22l1.42 1.42M18.36 18.36l1.42 1.42M1 12h2M21 12h2M4.22 19.78l1.42-1.42M18.36 5.64l1.42-1.42\"/>\r\n        </svg>`;\r\n      case 'dark':\r\n        return `<svg width=\"20\" height=\"20\" viewBox=\"0 0 24 24\" fill=\"none\" stroke=\"currentColor\" stroke-width=\"2\">\r\n          <path d=\"M21 12.79A9 9 0 1 1 11.21 3 7 7 0 0 0 21 12.79z\"/>\r\n        </svg>`;\r\n      case 'system':\r\n        return `<svg width=\"20\" height=\"20\" viewBox=\"0 0 24 24\" fill=\"none\" stroke=\"currentColor\" stroke-width=\"2\">\r\n          <rect x=\"2\" y=\"3\" width=\"20\" height=\"14\" rx=\"2\" ry=\"2\"/>\r\n          <line x1=\"8\" y1=\"21\" x2=\"16\" y2=\"21\"/>\r\n          <line x1=\"12\" y1=\"17\" x2=\"12\" y2=\"21\"/>\r\n        </svg>`;\r\n    }\r\n  }\r\n\r\n  // Handle click\r\n  on(button, 'click', () => {\r\n    theme.cycle();\r\n    updateButton();\r\n    toast.info(`Theme: ${theme.getLabel()}`);\r\n  });\r\n\r\n  // Subscribe to theme changes\r\n  theme.onChange(() => {\r\n    updateButton();\r\n  });\r\n\r\n  // Initial update\r\n  updateButton();\r\n\r\n  // Append to container if provided\r\n  if (container) {\r\n    container.appendChild(button);\r\n  }\r\n\r\n  return button;\r\n}\r\n\r\n/**\r\n * Mount theme toggle to existing element by selector\r\n */\r\nexport function mountThemeToggle(selector: string): HTMLButtonElement | null {\r\n  const container = document.querySelector(selector);\r\n  if (!container) {\r\n    console.warn(`ThemeToggle: Container not found: ${selector}`);\r\n    return null;\r\n  }\r\n  return createThemeToggle(container as HTMLElement);\r\n}\r\n\r\nexport default createThemeToggle;\r\n","/**\r\n * UI Store\r\n * User interface state\r\n */\r\n\r\n// Types\r\nexport type MainTab = 'dashboard' | 'chat' | 'sot' | 'timeline' | 'org' | 'files' | 'emails' | 'contacts' | 'team-analysis' | 'roles' | 'graph' | 'costs' | 'history' | 'profile' | 'settings' | 'admin' | 'projects';\r\nexport type SotView = 'questions' | 'facts' | 'risks' | 'actions' | 'decisions';\r\nexport type DevTab = 'info' | 'logs' | 'settings';\r\n\r\nexport interface SelectedPerson {\r\n  id: string;\r\n  name: string;\r\n  type: 'contact' | 'member';\r\n}\r\n\r\nexport interface UIState {\r\n  currentTab: MainTab;\r\n  currentDevTab: DevTab;\r\n  sotCurrentView: SotView;\r\n  selectedPerson: SelectedPerson | null;\r\n  sidebarOpen: boolean;\r\n  modalOpen: string | null;\r\n  searchQuery: string;\r\n  filterActive: boolean;\r\n}\r\n\r\n// Initial state\r\nconst initialState: UIState = {\r\n  currentTab: 'dashboard',\r\n  currentDevTab: 'info',\r\n  sotCurrentView: 'questions',\r\n  selectedPerson: null,\r\n  sidebarOpen: true,\r\n  modalOpen: null,\r\n  searchQuery: '',\r\n  filterActive: false,\r\n};\r\n\r\n// State\r\nlet state: UIState = { ...initialState };\r\n\r\n// Listeners\r\nconst listeners: Set<(state: UIState) => void> = new Set();\r\n\r\n/**\r\n * Notify all listeners\r\n */\r\nfunction notify(): void {\r\n  listeners.forEach(fn => fn(state));\r\n}\r\n\r\n/**\r\n * Get current state\r\n */\r\nexport function getState(): UIState {\r\n  return state;\r\n}\r\n\r\n/**\r\n * Subscribe to state changes\r\n */\r\nexport function subscribe(callback: (state: UIState) => void): () => void {\r\n  listeners.add(callback);\r\n  return () => listeners.delete(callback);\r\n}\r\n\r\n/**\r\n * Set main tab\r\n */\r\nexport function setTab(tab: MainTab): void {\r\n  state = { ...state, currentTab: tab };\r\n  notify();\r\n}\r\n\r\n/**\r\n * Set developer tab\r\n */\r\nexport function setDevTab(tab: DevTab): void {\r\n  state = { ...state, currentDevTab: tab };\r\n  notify();\r\n}\r\n\r\n/**\r\n * Set Source of Truth view\r\n */\r\nexport function setSotView(view: SotView): void {\r\n  state = { ...state, sotCurrentView: view };\r\n  notify();\r\n}\r\n\r\n/**\r\n * Set selected person\r\n */\r\nexport function setSelectedPerson(person: SelectedPerson | null): void {\r\n  state = { ...state, selectedPerson: person };\r\n  notify();\r\n}\r\n\r\n/**\r\n * Toggle sidebar\r\n */\r\nexport function toggleSidebar(): void {\r\n  state = { ...state, sidebarOpen: !state.sidebarOpen };\r\n  notify();\r\n}\r\n\r\n/**\r\n * Set sidebar open state\r\n */\r\nexport function setSidebarOpen(open: boolean): void {\r\n  state = { ...state, sidebarOpen: open };\r\n  notify();\r\n}\r\n\r\n/**\r\n * Open modal\r\n */\r\nexport function openModal(modalId: string): void {\r\n  state = { ...state, modalOpen: modalId };\r\n  notify();\r\n}\r\n\r\n/**\r\n * Close modal\r\n */\r\nexport function closeModal(): void {\r\n  state = { ...state, modalOpen: null };\r\n  notify();\r\n}\r\n\r\n/**\r\n * Set search query\r\n */\r\nexport function setSearchQuery(query: string): void {\r\n  state = { ...state, searchQuery: query };\r\n  notify();\r\n}\r\n\r\n/**\r\n * Toggle filter\r\n */\r\nexport function toggleFilter(): void {\r\n  state = { ...state, filterActive: !state.filterActive };\r\n  notify();\r\n}\r\n\r\n/**\r\n * Reset to initial state\r\n */\r\nexport function reset(): void {\r\n  state = { ...initialState };\r\n  notify();\r\n}\r\n\r\n// Export as namespace\r\nexport const uiStore = {\r\n  getState,\r\n  subscribe,\r\n  setTab,\r\n  setDevTab,\r\n  setSotView,\r\n  setSelectedPerson,\r\n  toggleSidebar,\r\n  setSidebarOpen,\r\n  openModal,\r\n  closeModal,\r\n  setSearchQuery,\r\n  toggleFilter,\r\n  reset,\r\n};\r\n","/**\r\n * Header Component\r\n * Main application header with project selector and user menu\r\n */\r\n\r\nimport { createElement, on, $, show, hide } from '@lib/dom';\r\nimport { appStore } from '@stores/app';\r\nimport { uiStore } from '@stores/ui';\r\nimport { theme } from '@services/theme';\r\nimport { createThemeToggle } from './ThemeToggle';\r\n\r\nexport interface HeaderProps {\r\n  onProjectChange?: (projectId: string) => void;\r\n  onLogout?: () => void;\r\n  onSettings?: () => void;\r\n}\r\n\r\n/**\r\n * Create header element\r\n */\r\nexport function createHeader(props: HeaderProps = {}): HTMLElement {\r\n  const header = createElement('header', { className: 'app-header' });\r\n\r\n  // Logo and title\r\n  const logoSection = createElement('div', { className: 'header-logo' });\r\n  logoSection.innerHTML = `\r\n    <span class=\"logo-icon\"></span>\r\n    <h1>GodMode</h1>\r\n  `;\r\n\r\n  // Actions section\r\n  const actionsSection = createElement('div', { className: 'header-actions' });\r\n\r\n  // Project selector\r\n  const projectSelector = createProjectSelector(props.onProjectChange);\r\n  actionsSection.appendChild(projectSelector);\r\n\r\n  // Theme toggle\r\n  const themeToggle = createThemeToggle();\r\n  actionsSection.appendChild(themeToggle);\r\n\r\n  // User menu\r\n  const userMenu = createUserMenu(props);\r\n  actionsSection.appendChild(userMenu);\r\n\r\n  // Mobile menu button\r\n  const mobileMenuBtn = createElement('button', {\r\n    className: 'mobile-menu-btn',\r\n    innerHTML: '',\r\n  });\r\n  on(mobileMenuBtn, 'click', () => {\r\n    uiStore.toggleSidebar();\r\n  });\r\n\r\n  header.appendChild(mobileMenuBtn);\r\n  header.appendChild(logoSection);\r\n  header.appendChild(actionsSection);\r\n\r\n  return header;\r\n}\r\n\r\n/**\r\n * Create project selector dropdown\r\n */\r\nfunction createProjectSelector(onProjectChange?: (projectId: string) => void): HTMLElement {\r\n  const container = createElement('div', { className: 'project-selector' });\r\n\r\n  const button = createElement('button', {\r\n    className: 'project-btn',\r\n  });\r\n\r\n  const dropdown = createElement('div', { className: 'project-dropdown' });\r\n\r\n  // Update button text\r\n  function updateButton(): void {\r\n    const state = appStore.getState();\r\n    const projectName = state.currentProjectId || 'Select Project';\r\n    button.innerHTML = `\r\n      <span class=\"project-name\">${projectName}</span>\r\n      <span class=\"dropdown-arrow\"></span>\r\n    `;\r\n  }\r\n\r\n  // Toggle dropdown\r\n  let isOpen = false;\r\n  on(button, 'click', (e) => {\r\n    e.stopPropagation();\r\n    isOpen = !isOpen;\r\n    dropdown.classList.toggle('show', isOpen);\r\n  });\r\n\r\n  // Close on outside click\r\n  on(document, 'click', () => {\r\n    isOpen = false;\r\n    dropdown.classList.remove('show');\r\n  });\r\n\r\n  // Subscribe to state changes\r\n  appStore.subscribe(() => {\r\n    updateButton();\r\n  });\r\n\r\n  // Initial update\r\n  updateButton();\r\n\r\n  container.appendChild(button);\r\n  container.appendChild(dropdown);\r\n\r\n  return container;\r\n}\r\n\r\n/**\r\n * Create user menu dropdown\r\n */\r\nfunction createUserMenu(props: HeaderProps): HTMLElement {\r\n  const container = createElement('div', { className: 'user-menu' });\r\n\r\n  const button = createElement('button', { className: 'user-menu-btn' });\r\n\r\n  const dropdown = createElement('div', { className: 'user-dropdown' });\r\n\r\n  // Update button\r\n  function updateButton(): void {\r\n    const state = appStore.getState();\r\n    const user = state.currentUser;\r\n    const initials = user?.name\r\n      ? user.name.split(' ').map(n => n[0]).join('').toUpperCase().slice(0, 2)\r\n      : user?.email?.[0]?.toUpperCase() || '?';\r\n\r\n    button.innerHTML = `\r\n      <div class=\"user-avatar\">${initials}</div>\r\n      <span class=\"user-name\">${user?.name || user?.email || 'Guest'}</span>\r\n    `;\r\n  }\r\n\r\n  // Update dropdown content\r\n  function updateDropdown(): void {\r\n    const state = appStore.getState();\r\n    const user = state.currentUser;\r\n\r\n    dropdown.innerHTML = `\r\n      <div class=\"user-dropdown-header\">\r\n        <strong>${user?.name || 'Guest'}</strong>\r\n        <span class=\"text-muted\">${user?.email || ''}</span>\r\n        ${user?.role ? `<span class=\"role-badge ${user.role}\">${user.role}</span>` : ''}\r\n      </div>\r\n      <div class=\"user-dropdown-items\">\r\n        <button data-action=\"settings\">\r\n          <span></span> Settings\r\n        </button>\r\n        <button data-action=\"shortcuts\">\r\n          <span></span> Shortcuts\r\n        </button>\r\n        <button data-action=\"logout\" class=\"text-error\">\r\n          <span></span> Logout\r\n        </button>\r\n      </div>\r\n    `;\r\n\r\n    // Bind action handlers\r\n    const settingsBtn = dropdown.querySelector('[data-action=\"settings\"]');\r\n    const shortcutsBtn = dropdown.querySelector('[data-action=\"shortcuts\"]');\r\n    const logoutBtn = dropdown.querySelector('[data-action=\"logout\"]');\r\n\r\n    if (settingsBtn) {\r\n      on(settingsBtn as HTMLElement, 'click', () => {\r\n        props.onSettings?.();\r\n        closeDropdown();\r\n      });\r\n    }\r\n\r\n    if (shortcutsBtn) {\r\n      on(shortcutsBtn as HTMLElement, 'click', () => {\r\n        // Show shortcuts modal\r\n        uiStore.openModal('shortcuts');\r\n        closeDropdown();\r\n      });\r\n    }\r\n\r\n    if (logoutBtn) {\r\n      on(logoutBtn as HTMLElement, 'click', () => {\r\n        props.onLogout?.();\r\n        closeDropdown();\r\n      });\r\n    }\r\n  }\r\n\r\n  // Toggle dropdown\r\n  let isOpen = false;\r\n  function closeDropdown(): void {\r\n    isOpen = false;\r\n    dropdown.classList.remove('show');\r\n  }\r\n\r\n  on(button, 'click', (e) => {\r\n    e.stopPropagation();\r\n    isOpen = !isOpen;\r\n    dropdown.classList.toggle('show', isOpen);\r\n    if (isOpen) {\r\n      updateDropdown();\r\n    }\r\n  });\r\n\r\n  // Close on outside click\r\n  on(document, 'click', closeDropdown);\r\n\r\n  // Subscribe to state changes\r\n  appStore.subscribe(updateButton);\r\n\r\n  // Initial update\r\n  updateButton();\r\n\r\n  container.appendChild(button);\r\n  container.appendChild(dropdown);\r\n\r\n  return container;\r\n}\r\n\r\n/**\r\n * Mount header to existing element\r\n */\r\nexport function mountHeader(selector: string, props: HeaderProps = {}): HTMLElement | null {\r\n  const container = document.querySelector(selector);\r\n  if (!container) {\r\n    console.warn(`Header: Container not found: ${selector}`);\r\n    return null;\r\n  }\r\n\r\n  const header = createHeader(props);\r\n  container.appendChild(header);\r\n  return header;\r\n}\r\n\r\nexport default createHeader;\r\n","/**\r\n * Sidebar Component\r\n * Navigation sidebar with tabs\r\n */\r\n\r\nimport { createElement, on, addClass, removeClass } from '@lib/dom';\r\nimport { uiStore, MainTab } from '@stores/ui';\r\nimport { appStore } from '@stores/app';\r\n\r\nexport interface SidebarTab {\r\n  id: MainTab;\r\n  label: string;\r\n  icon: string;\r\n  badge?: number;\r\n}\r\n\r\nexport interface SidebarProps {\r\n  tabs?: SidebarTab[];\r\n  onTabChange?: (tabId: MainTab) => void;\r\n}\r\n\r\nconst defaultTabs: SidebarTab[] = [\r\n  { id: 'dashboard', label: 'Dashboard', icon: '' },\r\n  { id: 'chat', label: 'Chat', icon: '' },\r\n  { id: 'sot', label: 'Source of Truth', icon: '' },\r\n  { id: 'timeline', label: 'Timeline', icon: '' },\r\n  { id: 'org', label: 'Org Chart', icon: '' },\r\n  { id: 'files', label: 'Files', icon: '' },\r\n  { id: 'emails', label: 'Emails', icon: '' },\r\n  { id: 'contacts', label: 'Contacts', icon: '' },\r\n  { id: 'roles', label: 'Roles', icon: '' },\r\n  { id: 'graph', label: 'Graph DB', icon: '' },\r\n  { id: 'costs', label: 'Costs', icon: '' },\r\n  { id: 'history', label: 'History', icon: '' },\r\n];\r\n\r\n// Admin tab - only shown for superadmin users\r\nconst adminTab: SidebarTab = { id: 'admin', label: 'Admin', icon: '' };\r\n\r\n/**\r\n * Get tabs based on user role\r\n */\r\nfunction getTabsForUser(): SidebarTab[] {\r\n  const state = appStore.getState();\r\n  const isSuperAdmin = state.currentUser?.role === 'superadmin';\r\n\r\n  if (isSuperAdmin) {\r\n    return [...defaultTabs, adminTab];\r\n  }\r\n  return defaultTabs;\r\n}\r\n\r\n/**\r\n * Create a tab button element\r\n */\r\nfunction createTabButton(tab: SidebarTab, props: SidebarProps): HTMLButtonElement {\r\n  const button = createElement('button', {\r\n    className: 'sidebar-tab',\r\n  }) as HTMLButtonElement;\r\n  button.setAttribute('data-tab', tab.id);\r\n\r\n  button.innerHTML = `\r\n    <span class=\"tab-icon\">${tab.icon}</span>\r\n    <span class=\"tab-label\">${tab.label}</span>\r\n    ${tab.badge ? `<span class=\"tab-badge\">${tab.badge}</span>` : ''}\r\n  `;\r\n\r\n  on(button, 'click', () => {\r\n    uiStore.setTab(tab.id);\r\n    props.onTabChange?.(tab.id);\r\n\r\n    // Close sidebar on mobile after selection\r\n    if (window.innerWidth < 768) {\r\n      uiStore.setSidebarOpen(false);\r\n    }\r\n  });\r\n\r\n  return button;\r\n}\r\n\r\n/**\r\n * Rebuild navigation tabs based on current user\r\n */\r\nfunction rebuildNavigation(nav: HTMLElement, props: SidebarProps): void {\r\n  const tabs = props.tabs || getTabsForUser();\r\n  const currentTab = uiStore.getState().currentTab;\r\n\r\n  // Clear existing tabs\r\n  nav.innerHTML = '';\r\n\r\n  // Add tabs\r\n  tabs.forEach(tab => {\r\n    const button = createTabButton(tab, props);\r\n    if (tab.id === currentTab) {\r\n      addClass(button, 'active');\r\n    }\r\n    nav.appendChild(button);\r\n  });\r\n}\r\n\r\n/**\r\n * Create sidebar element\r\n */\r\nexport function createSidebar(props: SidebarProps = {}): HTMLElement {\r\n  const sidebar = createElement('aside', { className: 'sidebar' });\r\n\r\n  // Close button for mobile\r\n  const closeBtn = createElement('button', {\r\n    className: 'sidebar-close-btn',\r\n    innerHTML: '',\r\n  });\r\n  on(closeBtn, 'click', () => {\r\n    uiStore.setSidebarOpen(false);\r\n  });\r\n  sidebar.appendChild(closeBtn);\r\n\r\n  // Navigation\r\n  const nav = createElement('nav', { className: 'sidebar-nav' });\r\n\r\n  // Initial build\r\n  rebuildNavigation(nav, props);\r\n\r\n  sidebar.appendChild(nav);\r\n\r\n  // Subscribe to app store to rebuild when user changes (for admin tab visibility)\r\n  appStore.subscribe(() => {\r\n    rebuildNavigation(nav, props);\r\n  });\r\n\r\n  // Subscribe to UI state changes\r\n  uiStore.subscribe((state) => {\r\n    // Update active tab\r\n    const buttons = nav.querySelectorAll('.sidebar-tab');\r\n    buttons.forEach(btn => {\r\n      const tabId = btn.getAttribute('data-tab');\r\n      if (tabId === state.currentTab) {\r\n        addClass(btn as HTMLElement, 'active');\r\n      } else {\r\n        removeClass(btn as HTMLElement, 'active');\r\n      }\r\n    });\r\n\r\n    // Update sidebar visibility (mobile)\r\n    if (state.sidebarOpen) {\r\n      addClass(sidebar, 'mobile-open');\r\n    } else {\r\n      removeClass(sidebar, 'mobile-open');\r\n    }\r\n  });\r\n\r\n  // Set initial active state\r\n  const initialState = uiStore.getState();\r\n  const initialActiveBtn = nav.querySelector(`[data-tab=\"${initialState.currentTab}\"]`);\r\n  if (initialActiveBtn) {\r\n    addClass(initialActiveBtn as HTMLElement, 'active');\r\n  }\r\n\r\n  return sidebar;\r\n}\r\n\r\n/**\r\n * Update tab badge\r\n */\r\nexport function updateTabBadge(tabId: MainTab, count: number | null): void {\r\n  const tab = document.querySelector(`.sidebar-tab[data-tab=\"${tabId}\"]`);\r\n  if (!tab) return;\r\n\r\n  let badge = tab.querySelector('.tab-badge');\r\n\r\n  if (count === null || count === 0) {\r\n    badge?.remove();\r\n    return;\r\n  }\r\n\r\n  if (!badge) {\r\n    badge = createElement('span', { className: 'tab-badge' });\r\n    tab.appendChild(badge);\r\n  }\r\n\r\n  badge.textContent = count > 99 ? '99+' : String(count);\r\n}\r\n\r\n/**\r\n * Mount sidebar to existing element\r\n */\r\nexport function mountSidebar(selector: string, props: SidebarProps = {}): HTMLElement | null {\r\n  const container = document.querySelector(selector);\r\n  if (!container) {\r\n    console.warn(`Sidebar: Container not found: ${selector}`);\r\n    return null;\r\n  }\r\n\r\n  const sidebar = createSidebar(props);\r\n  container.appendChild(sidebar);\r\n  return sidebar;\r\n}\r\n\r\nexport default createSidebar;\r\n","/**\r\n * Toast Container Component\r\n * Visual container for toast notifications\r\n */\r\n\r\nimport { createElement, on } from '@lib/dom';\r\n\r\nexport type ToastPosition = 'top-right' | 'top-left' | 'bottom-right' | 'bottom-left' | 'top-center' | 'bottom-center';\r\n\r\nexport interface ToastContainerProps {\r\n  position?: ToastPosition;\r\n  maxToasts?: number;\r\n}\r\n\r\nlet containerInstance: HTMLElement | null = null;\r\n\r\n/**\r\n * Get or create toast container\r\n */\r\nexport function getToastContainer(props: ToastContainerProps = {}): HTMLElement {\r\n  if (containerInstance) {\r\n    return containerInstance;\r\n  }\r\n\r\n  const position = props.position || 'bottom-right';\r\n  const container = createElement('div', {\r\n    className: `toast-container toast-${position}`,\r\n  });\r\n\r\n  // Container uses CSS classes for position (toast-container.toast-{position} in layout.css)\r\n\r\n  document.body.appendChild(container);\r\n  containerInstance = container;\r\n\r\n  return container;\r\n}\r\n\r\n/**\r\n * Create a toast element\r\n */\r\nexport function createToastElement(\r\n  message: string,\r\n  type: 'success' | 'error' | 'warning' | 'info' = 'info',\r\n  duration = 3000\r\n): HTMLElement {\r\n  const toast = createElement('div', {\r\n    className: `toast toast-${type} fade-in`,\r\n  });\r\n\r\n  const icons: Record<string, string> = {\r\n    success: '',\r\n    error: '',\r\n    warning: '',\r\n    info: '',\r\n  };\r\n\r\n  toast.innerHTML = `\r\n    <span class=\"toast-icon\">${icons[type]}</span>\r\n    <span class=\"toast-message\">${message}</span>\r\n  `;\r\n\r\n  // Click to dismiss\r\n  on(toast, 'click', () => {\r\n    dismissToast(toast);\r\n  });\r\n\r\n  // Auto dismiss\r\n  if (duration > 0) {\r\n    setTimeout(() => {\r\n      dismissToast(toast);\r\n    }, duration);\r\n  }\r\n\r\n  return toast;\r\n}\r\n\r\n/**\r\n * Dismiss a toast with animation\r\n */\r\nfunction dismissToast(toast: HTMLElement): void {\r\n  toast.classList.add('toast-dismiss');\r\n  setTimeout(() => {\r\n    toast.remove();\r\n  }, 300);\r\n}\r\n\r\n/**\r\n * Show a toast notification\r\n */\r\nexport function showToastInContainer(\r\n  message: string,\r\n  type: 'success' | 'error' | 'warning' | 'info' = 'info',\r\n  duration = 3000\r\n): HTMLElement {\r\n  const container = getToastContainer();\r\n  const toast = createToastElement(message, type, duration);\r\n  container.appendChild(toast);\r\n  return toast;\r\n}\r\n\r\nexport default getToastContainer;\r\n","/**\n * Modal Component\n * Reusable modal dialog\n */\n\nimport { createElement, on, addClass, removeClass, show, hide } from '@lib/dom';\nimport { uiStore } from '@stores/ui';\nimport { shortcuts } from '@services/shortcuts';\n\nexport interface ModalProps {\n  id: string;\n  title: string;\n  content?: string | HTMLElement;\n  size?: 'sm' | 'md' | 'lg' | 'xl' | 'full';\n  closable?: boolean;\n  onClose?: () => void;\n  onOpen?: () => void;\n  footer?: HTMLElement | null;\n}\n\n// Store active modals\nconst activeModals: Map<string, HTMLElement> = new Map();\n\n/**\n * Create modal element\n */\nexport function createModal(props: ModalProps): HTMLElement {\n  const {\n    id,\n    title,\n    content,\n    size = 'md',\n    closable = true,\n    onClose,\n    onOpen,\n    footer,\n  } = props;\n\n  // Backdrop\n  const modal = createElement('div', {\n    className: `modal modal-${size}`,\n  });\n  modal.setAttribute('data-modal-id', id);\n\n  // Content wrapper\n  const modalContent = createElement('div', { className: 'modal-content' });\n\n  // Header\n  const header = createElement('div', { className: 'modal-header' });\n  header.innerHTML = `<h3>${title}</h3>`;\n\n  if (closable) {\n    const closeBtn = createElement('button', {\n      className: 'modal-close',\n      innerHTML: '',\n    });\n    on(closeBtn, 'click', () => closeModal(id));\n    header.appendChild(closeBtn);\n  }\n\n  // Body\n  const body = createElement('div', { className: 'modal-body' });\n  if (typeof content === 'string') {\n    body.innerHTML = content;\n  } else if (content) {\n    body.appendChild(content);\n  }\n\n  // Footer\n  const footerEl = footer || createElement('div', { className: 'modal-footer' });\n\n  // Assemble\n  modalContent.appendChild(header);\n  modalContent.appendChild(body);\n  if (footer !== null) {\n    modalContent.appendChild(footerEl);\n  }\n  modal.appendChild(modalContent);\n\n  // Click backdrop to close\n  if (closable) {\n    on(modal, 'click', (e) => {\n      if (e.target === modal) {\n        closeModal(id);\n      }\n    });\n  }\n\n  // Store reference\n  activeModals.set(id, modal);\n\n  return modal;\n}\n\n/**\n * Open a modal by ID\n */\nexport function openModal(id: string): void {\n  const modal = activeModals.get(id) || document.querySelector(`[data-modal-id=\"${id}\"]`) as HTMLElement;\n  if (!modal) {\n    console.warn(`Modal not found: ${id}`);\n    return;\n  }\n\n  addClass(modal, 'open');\n  document.body.classList.add('modal-open');\n\n  // Update UI store\n  uiStore.openModal(id);\n\n  // Focus first input\n  setTimeout(() => {\n    const firstInput = modal.querySelector('input, textarea, select, button') as HTMLElement;\n    firstInput?.focus();\n  }, 100);\n}\n\n/**\n * Close a modal by ID\n */\nexport function closeModal(id: string): void {\n  const modal = activeModals.get(id) || document.querySelector(`[data-modal-id=\"${id}\"]`) as HTMLElement;\n  if (!modal) return;\n\n  removeClass(modal, 'open');\n  document.body.classList.remove('modal-open');\n\n  // Update UI store\n  uiStore.closeModal();\n}\n\n/**\n * Close all open modals\n */\nexport function closeAllModals(): void {\n  activeModals.forEach((_, id) => closeModal(id));\n}\n\n/**\n * Check if modal is open\n */\nexport function isModalOpen(id: string): boolean {\n  const modal = activeModals.get(id);\n  return modal?.classList.contains('open') || false;\n}\n\n/**\n * Update modal content\n */\nexport function updateModalContent(id: string, content: string | HTMLElement): void {\n  const modal = activeModals.get(id);\n  if (!modal) return;\n\n  const body = modal.querySelector('.modal-body');\n  if (!body) return;\n\n  if (typeof content === 'string') {\n    body.innerHTML = content;\n  } else {\n    body.innerHTML = '';\n    body.appendChild(content);\n  }\n}\n\n/**\n * Update modal title\n */\nexport function updateModalTitle(id: string, title: string): void {\n  const modal = activeModals.get(id);\n  if (!modal) return;\n\n  const titleEl = modal.querySelector('.modal-header h3');\n  if (titleEl) {\n    titleEl.textContent = title;\n  }\n}\n\n/**\n * Create and show a confirm dialog\n */\nexport function confirm(\n  message: string,\n  options: {\n    title?: string;\n    confirmText?: string;\n    cancelText?: string;\n    confirmClass?: string;\n  } = {}\n): Promise<boolean> {\n  return new Promise((resolve) => {\n    const {\n      title = 'Confirm',\n      confirmText = 'Confirm',\n      cancelText = 'Cancel',\n      confirmClass = 'btn-primary',\n    } = options;\n\n    const id = `confirm-${Date.now()}`;\n\n    const footer = createElement('div', { className: 'modal-footer' });\n\n    const cancelBtn = createElement('button', {\n      className: 'btn btn-secondary',\n      textContent: cancelText,\n    });\n\n    const confirmBtn = createElement('button', {\n      className: `btn ${confirmClass}`,\n      textContent: confirmText,\n    });\n\n    on(cancelBtn, 'click', () => {\n      closeModal(id);\n      modal.remove();\n      activeModals.delete(id);\n      resolve(false);\n    });\n\n    on(confirmBtn, 'click', () => {\n      closeModal(id);\n      modal.remove();\n      activeModals.delete(id);\n      resolve(true);\n    });\n\n    footer.appendChild(cancelBtn);\n    footer.appendChild(confirmBtn);\n\n    const modal = createModal({\n      id,\n      title,\n      content: `<p>${message}</p>`,\n      size: 'sm',\n      closable: true,\n      onClose: () => resolve(false),\n      footer,\n    });\n\n    document.body.appendChild(modal);\n    openModal(id);\n  });\n}\n\n/**\n * Create and show an alert dialog\n */\nexport function alert(message: string, title = 'Alert'): Promise<void> {\n  return new Promise((resolve) => {\n    const id = `alert-${Date.now()}`;\n\n    const footer = createElement('div', { className: 'modal-footer' });\n\n    const okBtn = createElement('button', {\n      className: 'btn btn-primary',\n      textContent: 'OK',\n    });\n\n    on(okBtn, 'click', () => {\n      closeModal(id);\n      modal.remove();\n      activeModals.delete(id);\n      resolve();\n    });\n\n    footer.appendChild(okBtn);\n\n    const modal = createModal({\n      id,\n      title,\n      content: `<p>${message}</p>`,\n      size: 'sm',\n      closable: true,\n      onClose: () => resolve(),\n      footer,\n    });\n\n    document.body.appendChild(modal);\n    openModal(id);\n  });\n}\n\n/**\n * Create and show a prompt dialog\n */\nexport function prompt(\n  message: string,\n  options: {\n    title?: string;\n    placeholder?: string;\n    defaultValue?: string;\n  } = {}\n): Promise<string | null> {\n  return new Promise((resolve) => {\n    const id = `prompt-${Date.now()}`;\n    const { title = 'Input', placeholder = '', defaultValue = '' } = options;\n\n    const content = createElement('div', { className: 'prompt-content' });\n    content.innerHTML = `\n      <p>${message}</p>\n      <input type=\"text\" class=\"prompt-input gm-w-full gm-p-2 gm-mt-2\" placeholder=\"${placeholder}\" value=\"${defaultValue}\">\n    `;\n\n    const footer = createElement('div', { className: 'modal-footer' });\n\n    const cancelBtn = createElement('button', {\n      className: 'btn btn-secondary',\n      textContent: 'Cancel',\n    });\n\n    const okBtn = createElement('button', {\n      className: 'btn btn-primary',\n      textContent: 'OK',\n    });\n\n    on(cancelBtn, 'click', () => {\n      closeModal(id);\n      modal.remove();\n      activeModals.delete(id);\n      resolve(null);\n    });\n\n    on(okBtn, 'click', () => {\n      const input = modal.querySelector('.prompt-input') as HTMLInputElement;\n      const value = input?.value || '';\n      closeModal(id);\n      modal.remove();\n      activeModals.delete(id);\n      resolve(value);\n    });\n\n    footer.appendChild(cancelBtn);\n    footer.appendChild(okBtn);\n\n    const modal = createModal({\n      id,\n      title,\n      content,\n      size: 'sm',\n      closable: true,\n      onClose: () => resolve(null),\n      footer,\n    });\n\n    document.body.appendChild(modal);\n    openModal(id);\n\n    // Focus input after modal opens\n    setTimeout(() => {\n      const input = modal.querySelector('.prompt-input') as HTMLInputElement;\n      input?.focus();\n    }, 100);\n  });\n}\n\n// Register Escape key to close modals\nshortcuts.register({\n  key: 'Escape',\n  description: 'Close modal',\n  handler: () => {\n    const state = uiStore.getState();\n    if (state.modalOpen) {\n      closeModal(state.modalOpen);\n    }\n  },\n});\n\nexport default createModal;\n","/**\r\n * Member Permissions Modal - SOTA Design\r\n * Edit granular permissions for a project member\r\n */\r\n\r\nimport { on } from '@lib/dom';\r\nimport { createModal, openModal, closeModal } from '@components/Modal';\r\nimport { http } from '@services/api';\r\nimport { toast } from '@services/toast';\r\n\r\nconst MODAL_ID = 'member-permissions-modal';\r\n\r\ninterface MemberPermissionsProps {\r\n  projectId: string;\r\n  userId: string;\r\n  userName: string;\r\n  userEmail: string;\r\n  avatarUrl?: string;\r\n  currentRole: string;\r\n  currentPermissions?: string[];\r\n  onSave?: () => void;\r\n}\r\n\r\n// Permission definitions organized by category\r\nconst PERMISSION_CATEGORIES = [\r\n  {\r\n    id: 'view',\r\n    name: 'View',\r\n    icon: '',\r\n    color: '#3b82f6',\r\n    permissions: [\r\n      { id: 'view:dashboard', name: 'Dashboard', desc: 'View project dashboard and stats' },\r\n      { id: 'view:chat', name: 'AI Chat', desc: 'Use the AI assistant' },\r\n      { id: 'view:sot', name: 'Source of Truth', desc: 'View decisions, risks, actions, questions' },\r\n      { id: 'view:contacts', name: 'Contacts', desc: 'View project contacts' },\r\n      { id: 'view:documents', name: 'Documents', desc: 'View uploaded documents' },\r\n      { id: 'view:emails', name: 'Emails', desc: 'View email history' },\r\n      { id: 'view:team', name: 'Team', desc: 'View team members' },\r\n    ],\r\n  },\r\n  {\r\n    id: 'comment',\r\n    name: 'Comment',\r\n    icon: '',\r\n    color: '#8b5cf6',\r\n    permissions: [\r\n      { id: 'comment:sot', name: 'Comment on Items', desc: 'Add comments to decisions, risks, etc.' },\r\n      { id: 'comment:documents', name: 'Comment on Docs', desc: 'Add comments to documents' },\r\n    ],\r\n  },\r\n  {\r\n    id: 'edit',\r\n    name: 'Edit',\r\n    icon: '',\r\n    color: '#10b981',\r\n    permissions: [\r\n      { id: 'edit:questions', name: 'Questions', desc: 'Create and edit questions' },\r\n      { id: 'edit:risks', name: 'Risks', desc: 'Create and edit risks' },\r\n      { id: 'edit:actions', name: 'Actions', desc: 'Create and edit actions' },\r\n      { id: 'edit:decisions', name: 'Decisions', desc: 'Create and edit decisions' },\r\n      { id: 'edit:contacts', name: 'Contacts', desc: 'Create and edit contacts' },\r\n      { id: 'edit:documents', name: 'Documents', desc: 'Upload and edit documents' },\r\n    ],\r\n  },\r\n  {\r\n    id: 'manage',\r\n    name: 'Manage',\r\n    icon: '',\r\n    color: '#f59e0b',\r\n    permissions: [\r\n      { id: 'manage:team', name: 'Team', desc: 'Invite and remove team members' },\r\n      { id: 'manage:roles', name: 'Roles', desc: 'Create and assign roles' },\r\n      { id: 'manage:settings', name: 'Settings', desc: 'Change project settings' },\r\n      { id: 'manage:integrations', name: 'Integrations', desc: 'Configure integrations' },\r\n    ],\r\n  },\r\n  {\r\n    id: 'delete',\r\n    name: 'Delete',\r\n    icon: '',\r\n    color: '#ef4444',\r\n    permissions: [\r\n      { id: 'delete:data', name: 'Delete Data', desc: 'Permanently delete items' },\r\n      { id: 'export:data', name: 'Export Data', desc: 'Export project data' },\r\n    ],\r\n  },\r\n];\r\n\r\n// Default permission sets for each role\r\nconst ROLE_DEFAULTS: Record<string, string[]> = {\r\n  viewer: [\r\n    'view:dashboard', 'view:chat', 'view:sot', 'view:contacts', 'view:documents', 'view:emails', 'view:team',\r\n  ],\r\n  editor: [\r\n    'view:dashboard', 'view:chat', 'view:sot', 'view:contacts', 'view:documents', 'view:emails', 'view:team',\r\n    'comment:sot', 'comment:documents',\r\n    'edit:questions', 'edit:risks', 'edit:actions', 'edit:decisions', 'edit:contacts', 'edit:documents',\r\n  ],\r\n  admin: [\r\n    'view:dashboard', 'view:chat', 'view:sot', 'view:contacts', 'view:documents', 'view:emails', 'view:team',\r\n    'comment:sot', 'comment:documents',\r\n    'edit:questions', 'edit:risks', 'edit:actions', 'edit:decisions', 'edit:contacts', 'edit:documents',\r\n    'manage:team', 'manage:roles', 'manage:settings', 'manage:integrations',\r\n    'delete:data', 'export:data',\r\n  ],\r\n  owner: [\r\n    'view:dashboard', 'view:chat', 'view:sot', 'view:contacts', 'view:documents', 'view:emails', 'view:team',\r\n    'comment:sot', 'comment:documents',\r\n    'edit:questions', 'edit:risks', 'edit:actions', 'edit:decisions', 'edit:contacts', 'edit:documents',\r\n    'manage:team', 'manage:roles', 'manage:settings', 'manage:integrations',\r\n    'delete:data', 'export:data',\r\n  ],\r\n};\r\n\r\n/**\r\n * Show member permissions modal\r\n */\r\nexport function showMemberPermissionsModal(props: MemberPermissionsProps): void {\r\n  const { projectId, userId, userName, userEmail, avatarUrl, currentRole, onSave } = props;\r\n\r\n  // Use current permissions or defaults for role\r\n  let selectedPermissions = new Set(props.currentPermissions || ROLE_DEFAULTS[currentRole] || []);\r\n\r\n  // Remove existing modal\r\n  const existing = document.querySelector(`[data-modal-id=\"${MODAL_ID}\"]`);\r\n  if (existing) existing.remove();\r\n\r\n  const content = document.createElement('div');\r\n  content.className = 'member-permissions-content';\r\n\r\n  content.innerHTML = `\r\n    <style>\r\n      .member-permissions-content {\r\n        padding: 0;\r\n      }\r\n      \r\n      .member-header {\r\n        display: flex;\r\n        align-items: center;\r\n        gap: 16px;\r\n        padding: 20px 24px;\r\n        background: linear-gradient(135deg, rgba(225,29,72,0.08) 0%, rgba(225,29,72,0.03) 100%);\r\n        border-bottom: 1px solid var(--border-color);\r\n      }\r\n      \r\n      .member-avatar {\r\n        width: 56px;\r\n        height: 56px;\r\n        border-radius: 50%;\r\n        background: linear-gradient(135deg, #e11d48 0%, #be123c 100%);\r\n        display: flex;\r\n        align-items: center;\r\n        justify-content: center;\r\n        color: white;\r\n        font-weight: 700;\r\n        font-size: 20px;\r\n        overflow: hidden;\r\n      }\r\n      \r\n      .member-avatar img {\r\n        width: 100%;\r\n        height: 100%;\r\n        object-fit: cover;\r\n      }\r\n      \r\n      .member-info h4 {\r\n        margin: 0 0 4px;\r\n        font-size: 18px;\r\n        font-weight: 600;\r\n        color: var(--text-primary);\r\n      }\r\n      \r\n      .member-info p {\r\n        margin: 0;\r\n        font-size: 13px;\r\n        color: var(--text-secondary);\r\n      }\r\n      \r\n      .role-selector {\r\n        margin-left: auto;\r\n        display: flex;\r\n        flex-direction: column;\r\n        align-items: flex-end;\r\n        gap: 4px;\r\n      }\r\n      \r\n      .role-selector label {\r\n        font-size: 11px;\r\n        color: var(--text-muted);\r\n        text-transform: uppercase;\r\n        letter-spacing: 0.5px;\r\n      }\r\n      \r\n      .role-selector select {\r\n        padding: 8px 32px 8px 12px;\r\n        border: 1px solid var(--border-color);\r\n        border-radius: 8px;\r\n        font-size: 14px;\r\n        font-weight: 500;\r\n        background: var(--bg-primary);\r\n        color: var(--text-primary);\r\n        cursor: pointer;\r\n      }\r\n      \r\n      .permissions-body {\r\n        padding: 24px;\r\n        max-height: 400px;\r\n        overflow-y: auto;\r\n      }\r\n      \r\n      .permission-category {\r\n        margin-bottom: 20px;\r\n      }\r\n      \r\n      .permission-category:last-child {\r\n        margin-bottom: 0;\r\n      }\r\n      \r\n      .category-header {\r\n        display: flex;\r\n        align-items: center;\r\n        gap: 8px;\r\n        margin-bottom: 12px;\r\n        padding-bottom: 8px;\r\n        border-bottom: 1px solid var(--border-color);\r\n      }\r\n      \r\n      .category-icon {\r\n        font-size: 16px;\r\n      }\r\n      \r\n      .category-name {\r\n        font-weight: 600;\r\n        color: var(--text-primary);\r\n        flex: 1;\r\n      }\r\n      \r\n      .category-toggle {\r\n        font-size: 11px;\r\n        padding: 4px 10px;\r\n        border: 1px solid var(--border-color);\r\n        border-radius: 6px;\r\n        background: transparent;\r\n        cursor: pointer;\r\n        color: var(--text-secondary);\r\n        transition: all 0.15s;\r\n      }\r\n      \r\n      .category-toggle:hover {\r\n        background: var(--bg-secondary);\r\n        border-color: #e11d48;\r\n        color: #e11d48;\r\n      }\r\n      \r\n      .permission-grid {\r\n        display: grid;\r\n        grid-template-columns: repeat(auto-fill, minmax(180px, 1fr));\r\n        gap: 8px;\r\n      }\r\n      \r\n      .permission-item {\r\n        display: flex;\r\n        align-items: flex-start;\r\n        gap: 10px;\r\n        padding: 10px 12px;\r\n        background: var(--bg-secondary);\r\n        border-radius: 10px;\r\n        cursor: pointer;\r\n        transition: all 0.15s;\r\n        border: 1px solid transparent;\r\n      }\r\n      \r\n      .permission-item:hover {\r\n        background: var(--bg-tertiary);\r\n      }\r\n      \r\n      .permission-item.selected {\r\n        background: linear-gradient(135deg, rgba(225,29,72,0.1) 0%, rgba(225,29,72,0.05) 100%);\r\n        border-color: rgba(225,29,72,0.3);\r\n      }\r\n      \r\n      .permission-item input {\r\n        margin-top: 2px;\r\n        accent-color: #e11d48;\r\n        width: 16px;\r\n        height: 16px;\r\n      }\r\n      \r\n      .permission-info {\r\n        flex: 1;\r\n        min-width: 0;\r\n      }\r\n      \r\n      .permission-name {\r\n        font-size: 13px;\r\n        font-weight: 500;\r\n        color: var(--text-primary);\r\n      }\r\n      \r\n      .permission-desc {\r\n        font-size: 11px;\r\n        color: var(--text-muted);\r\n        margin-top: 2px;\r\n      }\r\n      \r\n      .modal-actions {\r\n        display: flex;\r\n        gap: 12px;\r\n        justify-content: flex-end;\r\n        padding: 16px 24px;\r\n        border-top: 1px solid var(--border-color);\r\n        background: var(--bg-secondary);\r\n      }\r\n      \r\n      .btn {\r\n        padding: 10px 20px;\r\n        border-radius: 10px;\r\n        font-size: 14px;\r\n        font-weight: 600;\r\n        cursor: pointer;\r\n        transition: all 0.2s;\r\n        border: none;\r\n      }\r\n      \r\n      .btn-secondary {\r\n        background: var(--bg-primary);\r\n        color: var(--text-primary);\r\n        border: 1px solid var(--border-color);\r\n      }\r\n      \r\n      .btn-secondary:hover {\r\n        background: var(--bg-tertiary);\r\n      }\r\n      \r\n      .btn-primary {\r\n        background: linear-gradient(135deg, #e11d48 0%, #be123c 100%);\r\n        color: white;\r\n        box-shadow: 0 4px 14px rgba(225, 29, 72, 0.3);\r\n      }\r\n      \r\n      .btn-primary:hover {\r\n        transform: translateY(-1px);\r\n        box-shadow: 0 6px 20px rgba(225, 29, 72, 0.4);\r\n      }\r\n    </style>\r\n    \r\n    <div class=\"member-header\">\r\n      <div class=\"member-avatar\">\r\n        ${avatarUrl\r\n      ? `<img src=\"${avatarUrl}\" alt=\"\">`\r\n      : getInitials(userName || userEmail)}\r\n      </div>\r\n      <div class=\"member-info\">\r\n        <h4>${escapeHtml(userName || userEmail)}</h4>\r\n        <p>${escapeHtml(userEmail)}</p>\r\n      </div>\r\n      <div class=\"role-selector\">\r\n        <label>Base Role</label>\r\n        <select id=\"base-role\">\r\n          <option value=\"viewer\" ${currentRole === 'viewer' ? 'selected' : ''}>Viewer</option>\r\n          <option value=\"editor\" ${currentRole === 'editor' ? 'selected' : ''}>Editor</option>\r\n          <option value=\"admin\" ${currentRole === 'admin' ? 'selected' : ''}>Admin</option>\r\n          <option value=\"owner\" ${currentRole === 'owner' ? 'selected' : ''}>Owner</option>\r\n        </select>\r\n      </div>\r\n    </div>\r\n    \r\n    <div class=\"permissions-body\">\r\n      ${PERMISSION_CATEGORIES.map(cat => `\r\n        <div class=\"permission-category\" data-category=\"${cat.id}\">\r\n          <div class=\"category-header\">\r\n            <span class=\"category-icon\">${cat.icon}</span>\r\n            <span class=\"category-name\">${cat.name}</span>\r\n            <button type=\"button\" class=\"category-toggle\" data-action=\"toggle\">Toggle All</button>\r\n          </div>\r\n          <div class=\"permission-grid\">\r\n            ${cat.permissions.map(p => `\r\n              <label class=\"permission-item${selectedPermissions.has(p.id) ? ' selected' : ''}\">\r\n                <input type=\"checkbox\" name=\"permission\" value=\"${p.id}\" ${selectedPermissions.has(p.id) ? 'checked' : ''}>\r\n                <div class=\"permission-info\">\r\n                  <div class=\"permission-name\">${p.name}</div>\r\n                  <div class=\"permission-desc\">${p.desc}</div>\r\n                </div>\r\n              </label>\r\n            `).join('')}\r\n          </div>\r\n        </div>\r\n      `).join('')}\r\n    </div>\r\n    \r\n    <div class=\"modal-actions\">\r\n      <button type=\"button\" class=\"btn btn-secondary\" id=\"btn-cancel\">Cancel</button>\r\n      <button type=\"button\" class=\"btn btn-primary\" id=\"btn-save\">Save Permissions</button>\r\n    </div>\r\n  `;\r\n\r\n  // Bind events\r\n  setTimeout(() => {\r\n    // Base role change - apply defaults\r\n    const roleSelect = content.querySelector('#base-role') as HTMLSelectElement;\r\n    if (roleSelect) {\r\n      on(roleSelect, 'change', () => {\r\n        const role = roleSelect.value;\r\n        const defaults = ROLE_DEFAULTS[role] || [];\r\n        selectedPermissions = new Set(defaults);\r\n        updateCheckboxes(content, selectedPermissions);\r\n      });\r\n    }\r\n\r\n    // Permission checkbox changes\r\n    content.querySelectorAll('input[name=\"permission\"]').forEach(checkbox => {\r\n      on(checkbox as HTMLElement, 'change', () => {\r\n        const value = (checkbox as HTMLInputElement).value;\r\n        const checked = (checkbox as HTMLInputElement).checked;\r\n\r\n        if (checked) {\r\n          selectedPermissions.add(value);\r\n        } else {\r\n          selectedPermissions.delete(value);\r\n        }\r\n\r\n        updateItemStyles(content);\r\n      });\r\n    });\r\n\r\n    // Category toggle buttons\r\n    content.querySelectorAll('.category-toggle').forEach(btn => {\r\n      on(btn as HTMLElement, 'click', () => {\r\n        const category = btn.closest('.permission-category');\r\n        if (!category) return;\r\n\r\n        const checkboxes = category.querySelectorAll('input[name=\"permission\"]');\r\n        const allChecked = Array.from(checkboxes).every(cb => (cb as HTMLInputElement).checked);\r\n\r\n        checkboxes.forEach(cb => {\r\n          const input = cb as HTMLInputElement;\r\n          input.checked = !allChecked;\r\n          if (!allChecked) {\r\n            selectedPermissions.add(input.value);\r\n          } else {\r\n            selectedPermissions.delete(input.value);\r\n          }\r\n        });\r\n\r\n        updateItemStyles(content);\r\n      });\r\n    });\r\n\r\n    // Cancel button\r\n    const cancelBtn = content.querySelector('#btn-cancel');\r\n    if (cancelBtn) {\r\n      on(cancelBtn as HTMLElement, 'click', () => closeModal(MODAL_ID));\r\n    }\r\n\r\n    // Save button\r\n    const saveBtn = content.querySelector('#btn-save');\r\n    if (saveBtn) {\r\n      on(saveBtn as HTMLElement, 'click', async () => {\r\n        const role = roleSelect?.value || currentRole;\r\n        const permissions = Array.from(selectedPermissions);\r\n\r\n        (saveBtn as HTMLButtonElement).disabled = true;\r\n        saveBtn.textContent = 'Saving...';\r\n\r\n        try {\r\n          await http.put(`/api/projects/${projectId}/members/${userId}/permissions`, {\r\n            role,\r\n            permissions,\r\n          });\r\n\r\n          toast.success('Permissions updated');\r\n          closeModal(MODAL_ID);\r\n          onSave?.();\r\n        } catch (error) {\r\n          toast.error('Failed to update permissions');\r\n          (saveBtn as HTMLButtonElement).disabled = false;\r\n          saveBtn.textContent = 'Save Permissions';\r\n        }\r\n      });\r\n    }\r\n  }, 0);\r\n\r\n  // Create modal\r\n  const modal = createModal({\r\n    id: MODAL_ID,\r\n    title: 'Member Permissions',\r\n    content,\r\n    size: 'lg',\r\n  });\r\n\r\n  document.body.appendChild(modal);\r\n  openModal(MODAL_ID);\r\n}\r\n\r\n/**\r\n * Update checkboxes from selected set\r\n */\r\nfunction updateCheckboxes(container: HTMLElement, selected: Set<string>): void {\r\n  container.querySelectorAll('input[name=\"permission\"]').forEach(cb => {\r\n    const input = cb as HTMLInputElement;\r\n    input.checked = selected.has(input.value);\r\n  });\r\n  updateItemStyles(container);\r\n}\r\n\r\n/**\r\n * Update item styles based on selection\r\n */\r\nfunction updateItemStyles(container: HTMLElement): void {\r\n  container.querySelectorAll('.permission-item').forEach(item => {\r\n    const checkbox = item.querySelector('input[name=\"permission\"]') as HTMLInputElement;\r\n    item.classList.toggle('selected', checkbox?.checked || false);\r\n  });\r\n}\r\n\r\n/**\r\n * Get initials\r\n */\r\nfunction getInitials(name: string): string {\r\n  return name\r\n    .split(' ')\r\n    .map(n => n[0])\r\n    .join('')\r\n    .toUpperCase()\r\n    .slice(0, 2);\r\n}\r\n\r\n/**\r\n * Escape HTML\r\n */\r\nfunction escapeHtml(text: string): string {\r\n  const div = document.createElement('div');\r\n  div.textContent = text;\r\n  return div.innerHTML;\r\n}\r\n\r\nexport default showMemberPermissionsModal;\r\n","/** A special constant with type `never` */\nexport const NEVER = Object.freeze({\n    status: \"aborted\",\n});\nexport /*@__NO_SIDE_EFFECTS__*/ function $constructor(name, initializer, params) {\n    function init(inst, def) {\n        if (!inst._zod) {\n            Object.defineProperty(inst, \"_zod\", {\n                value: {\n                    def,\n                    constr: _,\n                    traits: new Set(),\n                },\n                enumerable: false,\n            });\n        }\n        if (inst._zod.traits.has(name)) {\n            return;\n        }\n        inst._zod.traits.add(name);\n        initializer(inst, def);\n        // support prototype modifications\n        const proto = _.prototype;\n        const keys = Object.keys(proto);\n        for (let i = 0; i < keys.length; i++) {\n            const k = keys[i];\n            if (!(k in inst)) {\n                inst[k] = proto[k].bind(inst);\n            }\n        }\n    }\n    // doesn't work if Parent has a constructor with arguments\n    const Parent = params?.Parent ?? Object;\n    class Definition extends Parent {\n    }\n    Object.defineProperty(Definition, \"name\", { value: name });\n    function _(def) {\n        var _a;\n        const inst = params?.Parent ? new Definition() : this;\n        init(inst, def);\n        (_a = inst._zod).deferred ?? (_a.deferred = []);\n        for (const fn of inst._zod.deferred) {\n            fn();\n        }\n        return inst;\n    }\n    Object.defineProperty(_, \"init\", { value: init });\n    Object.defineProperty(_, Symbol.hasInstance, {\n        value: (inst) => {\n            if (params?.Parent && inst instanceof params.Parent)\n                return true;\n            return inst?._zod?.traits?.has(name);\n        },\n    });\n    Object.defineProperty(_, \"name\", { value: name });\n    return _;\n}\n//////////////////////////////   UTILITIES   ///////////////////////////////////////\nexport const $brand = Symbol(\"zod_brand\");\nexport class $ZodAsyncError extends Error {\n    constructor() {\n        super(`Encountered Promise during synchronous parse. Use .parseAsync() instead.`);\n    }\n}\nexport class $ZodEncodeError extends Error {\n    constructor(name) {\n        super(`Encountered unidirectional transform during encode: ${name}`);\n        this.name = \"ZodEncodeError\";\n    }\n}\nexport const globalConfig = {};\nexport function config(newConfig) {\n    if (newConfig)\n        Object.assign(globalConfig, newConfig);\n    return globalConfig;\n}\n","// functions\nexport function assertEqual(val) {\n    return val;\n}\nexport function assertNotEqual(val) {\n    return val;\n}\nexport function assertIs(_arg) { }\nexport function assertNever(_x) {\n    throw new Error(\"Unexpected value in exhaustive check\");\n}\nexport function assert(_) { }\nexport function getEnumValues(entries) {\n    const numericValues = Object.values(entries).filter((v) => typeof v === \"number\");\n    const values = Object.entries(entries)\n        .filter(([k, _]) => numericValues.indexOf(+k) === -1)\n        .map(([_, v]) => v);\n    return values;\n}\nexport function joinValues(array, separator = \"|\") {\n    return array.map((val) => stringifyPrimitive(val)).join(separator);\n}\nexport function jsonStringifyReplacer(_, value) {\n    if (typeof value === \"bigint\")\n        return value.toString();\n    return value;\n}\nexport function cached(getter) {\n    const set = false;\n    return {\n        get value() {\n            if (!set) {\n                const value = getter();\n                Object.defineProperty(this, \"value\", { value });\n                return value;\n            }\n            throw new Error(\"cached value already set\");\n        },\n    };\n}\nexport function nullish(input) {\n    return input === null || input === undefined;\n}\nexport function cleanRegex(source) {\n    const start = source.startsWith(\"^\") ? 1 : 0;\n    const end = source.endsWith(\"$\") ? source.length - 1 : source.length;\n    return source.slice(start, end);\n}\nexport function floatSafeRemainder(val, step) {\n    const valDecCount = (val.toString().split(\".\")[1] || \"\").length;\n    const stepString = step.toString();\n    let stepDecCount = (stepString.split(\".\")[1] || \"\").length;\n    if (stepDecCount === 0 && /\\d?e-\\d?/.test(stepString)) {\n        const match = stepString.match(/\\d?e-(\\d?)/);\n        if (match?.[1]) {\n            stepDecCount = Number.parseInt(match[1]);\n        }\n    }\n    const decCount = valDecCount > stepDecCount ? valDecCount : stepDecCount;\n    const valInt = Number.parseInt(val.toFixed(decCount).replace(\".\", \"\"));\n    const stepInt = Number.parseInt(step.toFixed(decCount).replace(\".\", \"\"));\n    return (valInt % stepInt) / 10 ** decCount;\n}\nconst EVALUATING = Symbol(\"evaluating\");\nexport function defineLazy(object, key, getter) {\n    let value = undefined;\n    Object.defineProperty(object, key, {\n        get() {\n            if (value === EVALUATING) {\n                // Circular reference detected, return undefined to break the cycle\n                return undefined;\n            }\n            if (value === undefined) {\n                value = EVALUATING;\n                value = getter();\n            }\n            return value;\n        },\n        set(v) {\n            Object.defineProperty(object, key, {\n                value: v,\n                // configurable: true,\n            });\n            // object[key] = v;\n        },\n        configurable: true,\n    });\n}\nexport function objectClone(obj) {\n    return Object.create(Object.getPrototypeOf(obj), Object.getOwnPropertyDescriptors(obj));\n}\nexport function assignProp(target, prop, value) {\n    Object.defineProperty(target, prop, {\n        value,\n        writable: true,\n        enumerable: true,\n        configurable: true,\n    });\n}\nexport function mergeDefs(...defs) {\n    const mergedDescriptors = {};\n    for (const def of defs) {\n        const descriptors = Object.getOwnPropertyDescriptors(def);\n        Object.assign(mergedDescriptors, descriptors);\n    }\n    return Object.defineProperties({}, mergedDescriptors);\n}\nexport function cloneDef(schema) {\n    return mergeDefs(schema._zod.def);\n}\nexport function getElementAtPath(obj, path) {\n    if (!path)\n        return obj;\n    return path.reduce((acc, key) => acc?.[key], obj);\n}\nexport function promiseAllObject(promisesObj) {\n    const keys = Object.keys(promisesObj);\n    const promises = keys.map((key) => promisesObj[key]);\n    return Promise.all(promises).then((results) => {\n        const resolvedObj = {};\n        for (let i = 0; i < keys.length; i++) {\n            resolvedObj[keys[i]] = results[i];\n        }\n        return resolvedObj;\n    });\n}\nexport function randomString(length = 10) {\n    const chars = \"abcdefghijklmnopqrstuvwxyz\";\n    let str = \"\";\n    for (let i = 0; i < length; i++) {\n        str += chars[Math.floor(Math.random() * chars.length)];\n    }\n    return str;\n}\nexport function esc(str) {\n    return JSON.stringify(str);\n}\nexport function slugify(input) {\n    return input\n        .toLowerCase()\n        .trim()\n        .replace(/[^\\w\\s-]/g, \"\")\n        .replace(/[\\s_-]+/g, \"-\")\n        .replace(/^-+|-+$/g, \"\");\n}\nexport const captureStackTrace = (\"captureStackTrace\" in Error ? Error.captureStackTrace : (..._args) => { });\nexport function isObject(data) {\n    return typeof data === \"object\" && data !== null && !Array.isArray(data);\n}\nexport const allowsEval = cached(() => {\n    // @ts-ignore\n    if (typeof navigator !== \"undefined\" && navigator?.userAgent?.includes(\"Cloudflare\")) {\n        return false;\n    }\n    try {\n        const F = Function;\n        new F(\"\");\n        return true;\n    }\n    catch (_) {\n        return false;\n    }\n});\nexport function isPlainObject(o) {\n    if (isObject(o) === false)\n        return false;\n    // modified constructor\n    const ctor = o.constructor;\n    if (ctor === undefined)\n        return true;\n    if (typeof ctor !== \"function\")\n        return true;\n    // modified prototype\n    const prot = ctor.prototype;\n    if (isObject(prot) === false)\n        return false;\n    // ctor doesn't have static `isPrototypeOf`\n    if (Object.prototype.hasOwnProperty.call(prot, \"isPrototypeOf\") === false) {\n        return false;\n    }\n    return true;\n}\nexport function shallowClone(o) {\n    if (isPlainObject(o))\n        return { ...o };\n    if (Array.isArray(o))\n        return [...o];\n    return o;\n}\nexport function numKeys(data) {\n    let keyCount = 0;\n    for (const key in data) {\n        if (Object.prototype.hasOwnProperty.call(data, key)) {\n            keyCount++;\n        }\n    }\n    return keyCount;\n}\nexport const getParsedType = (data) => {\n    const t = typeof data;\n    switch (t) {\n        case \"undefined\":\n            return \"undefined\";\n        case \"string\":\n            return \"string\";\n        case \"number\":\n            return Number.isNaN(data) ? \"nan\" : \"number\";\n        case \"boolean\":\n            return \"boolean\";\n        case \"function\":\n            return \"function\";\n        case \"bigint\":\n            return \"bigint\";\n        case \"symbol\":\n            return \"symbol\";\n        case \"object\":\n            if (Array.isArray(data)) {\n                return \"array\";\n            }\n            if (data === null) {\n                return \"null\";\n            }\n            if (data.then && typeof data.then === \"function\" && data.catch && typeof data.catch === \"function\") {\n                return \"promise\";\n            }\n            if (typeof Map !== \"undefined\" && data instanceof Map) {\n                return \"map\";\n            }\n            if (typeof Set !== \"undefined\" && data instanceof Set) {\n                return \"set\";\n            }\n            if (typeof Date !== \"undefined\" && data instanceof Date) {\n                return \"date\";\n            }\n            // @ts-ignore\n            if (typeof File !== \"undefined\" && data instanceof File) {\n                return \"file\";\n            }\n            return \"object\";\n        default:\n            throw new Error(`Unknown data type: ${t}`);\n    }\n};\nexport const propertyKeyTypes = new Set([\"string\", \"number\", \"symbol\"]);\nexport const primitiveTypes = new Set([\"string\", \"number\", \"bigint\", \"boolean\", \"symbol\", \"undefined\"]);\nexport function escapeRegex(str) {\n    return str.replace(/[.*+?^${}()|[\\]\\\\]/g, \"\\\\$&\");\n}\n// zod-specific utils\nexport function clone(inst, def, params) {\n    const cl = new inst._zod.constr(def ?? inst._zod.def);\n    if (!def || params?.parent)\n        cl._zod.parent = inst;\n    return cl;\n}\nexport function normalizeParams(_params) {\n    const params = _params;\n    if (!params)\n        return {};\n    if (typeof params === \"string\")\n        return { error: () => params };\n    if (params?.message !== undefined) {\n        if (params?.error !== undefined)\n            throw new Error(\"Cannot specify both `message` and `error` params\");\n        params.error = params.message;\n    }\n    delete params.message;\n    if (typeof params.error === \"string\")\n        return { ...params, error: () => params.error };\n    return params;\n}\nexport function createTransparentProxy(getter) {\n    let target;\n    return new Proxy({}, {\n        get(_, prop, receiver) {\n            target ?? (target = getter());\n            return Reflect.get(target, prop, receiver);\n        },\n        set(_, prop, value, receiver) {\n            target ?? (target = getter());\n            return Reflect.set(target, prop, value, receiver);\n        },\n        has(_, prop) {\n            target ?? (target = getter());\n            return Reflect.has(target, prop);\n        },\n        deleteProperty(_, prop) {\n            target ?? (target = getter());\n            return Reflect.deleteProperty(target, prop);\n        },\n        ownKeys(_) {\n            target ?? (target = getter());\n            return Reflect.ownKeys(target);\n        },\n        getOwnPropertyDescriptor(_, prop) {\n            target ?? (target = getter());\n            return Reflect.getOwnPropertyDescriptor(target, prop);\n        },\n        defineProperty(_, prop, descriptor) {\n            target ?? (target = getter());\n            return Reflect.defineProperty(target, prop, descriptor);\n        },\n    });\n}\nexport function stringifyPrimitive(value) {\n    if (typeof value === \"bigint\")\n        return value.toString() + \"n\";\n    if (typeof value === \"string\")\n        return `\"${value}\"`;\n    return `${value}`;\n}\nexport function optionalKeys(shape) {\n    return Object.keys(shape).filter((k) => {\n        return shape[k]._zod.optin === \"optional\" && shape[k]._zod.optout === \"optional\";\n    });\n}\nexport const NUMBER_FORMAT_RANGES = {\n    safeint: [Number.MIN_SAFE_INTEGER, Number.MAX_SAFE_INTEGER],\n    int32: [-2147483648, 2147483647],\n    uint32: [0, 4294967295],\n    float32: [-3.4028234663852886e38, 3.4028234663852886e38],\n    float64: [-Number.MAX_VALUE, Number.MAX_VALUE],\n};\nexport const BIGINT_FORMAT_RANGES = {\n    int64: [/* @__PURE__*/ BigInt(\"-9223372036854775808\"), /* @__PURE__*/ BigInt(\"9223372036854775807\")],\n    uint64: [/* @__PURE__*/ BigInt(0), /* @__PURE__*/ BigInt(\"18446744073709551615\")],\n};\nexport function pick(schema, mask) {\n    const currDef = schema._zod.def;\n    const checks = currDef.checks;\n    const hasChecks = checks && checks.length > 0;\n    if (hasChecks) {\n        throw new Error(\".pick() cannot be used on object schemas containing refinements\");\n    }\n    const def = mergeDefs(schema._zod.def, {\n        get shape() {\n            const newShape = {};\n            for (const key in mask) {\n                if (!(key in currDef.shape)) {\n                    throw new Error(`Unrecognized key: \"${key}\"`);\n                }\n                if (!mask[key])\n                    continue;\n                newShape[key] = currDef.shape[key];\n            }\n            assignProp(this, \"shape\", newShape); // self-caching\n            return newShape;\n        },\n        checks: [],\n    });\n    return clone(schema, def);\n}\nexport function omit(schema, mask) {\n    const currDef = schema._zod.def;\n    const checks = currDef.checks;\n    const hasChecks = checks && checks.length > 0;\n    if (hasChecks) {\n        throw new Error(\".omit() cannot be used on object schemas containing refinements\");\n    }\n    const def = mergeDefs(schema._zod.def, {\n        get shape() {\n            const newShape = { ...schema._zod.def.shape };\n            for (const key in mask) {\n                if (!(key in currDef.shape)) {\n                    throw new Error(`Unrecognized key: \"${key}\"`);\n                }\n                if (!mask[key])\n                    continue;\n                delete newShape[key];\n            }\n            assignProp(this, \"shape\", newShape); // self-caching\n            return newShape;\n        },\n        checks: [],\n    });\n    return clone(schema, def);\n}\nexport function extend(schema, shape) {\n    if (!isPlainObject(shape)) {\n        throw new Error(\"Invalid input to extend: expected a plain object\");\n    }\n    const checks = schema._zod.def.checks;\n    const hasChecks = checks && checks.length > 0;\n    if (hasChecks) {\n        // Only throw if new shape overlaps with existing shape\n        // Use getOwnPropertyDescriptor to check key existence without accessing values\n        const existingShape = schema._zod.def.shape;\n        for (const key in shape) {\n            if (Object.getOwnPropertyDescriptor(existingShape, key) !== undefined) {\n                throw new Error(\"Cannot overwrite keys on object schemas containing refinements. Use `.safeExtend()` instead.\");\n            }\n        }\n    }\n    const def = mergeDefs(schema._zod.def, {\n        get shape() {\n            const _shape = { ...schema._zod.def.shape, ...shape };\n            assignProp(this, \"shape\", _shape); // self-caching\n            return _shape;\n        },\n    });\n    return clone(schema, def);\n}\nexport function safeExtend(schema, shape) {\n    if (!isPlainObject(shape)) {\n        throw new Error(\"Invalid input to safeExtend: expected a plain object\");\n    }\n    const def = mergeDefs(schema._zod.def, {\n        get shape() {\n            const _shape = { ...schema._zod.def.shape, ...shape };\n            assignProp(this, \"shape\", _shape); // self-caching\n            return _shape;\n        },\n    });\n    return clone(schema, def);\n}\nexport function merge(a, b) {\n    const def = mergeDefs(a._zod.def, {\n        get shape() {\n            const _shape = { ...a._zod.def.shape, ...b._zod.def.shape };\n            assignProp(this, \"shape\", _shape); // self-caching\n            return _shape;\n        },\n        get catchall() {\n            return b._zod.def.catchall;\n        },\n        checks: [], // delete existing checks\n    });\n    return clone(a, def);\n}\nexport function partial(Class, schema, mask) {\n    const currDef = schema._zod.def;\n    const checks = currDef.checks;\n    const hasChecks = checks && checks.length > 0;\n    if (hasChecks) {\n        throw new Error(\".partial() cannot be used on object schemas containing refinements\");\n    }\n    const def = mergeDefs(schema._zod.def, {\n        get shape() {\n            const oldShape = schema._zod.def.shape;\n            const shape = { ...oldShape };\n            if (mask) {\n                for (const key in mask) {\n                    if (!(key in oldShape)) {\n                        throw new Error(`Unrecognized key: \"${key}\"`);\n                    }\n                    if (!mask[key])\n                        continue;\n                    // if (oldShape[key]!._zod.optin === \"optional\") continue;\n                    shape[key] = Class\n                        ? new Class({\n                            type: \"optional\",\n                            innerType: oldShape[key],\n                        })\n                        : oldShape[key];\n                }\n            }\n            else {\n                for (const key in oldShape) {\n                    // if (oldShape[key]!._zod.optin === \"optional\") continue;\n                    shape[key] = Class\n                        ? new Class({\n                            type: \"optional\",\n                            innerType: oldShape[key],\n                        })\n                        : oldShape[key];\n                }\n            }\n            assignProp(this, \"shape\", shape); // self-caching\n            return shape;\n        },\n        checks: [],\n    });\n    return clone(schema, def);\n}\nexport function required(Class, schema, mask) {\n    const def = mergeDefs(schema._zod.def, {\n        get shape() {\n            const oldShape = schema._zod.def.shape;\n            const shape = { ...oldShape };\n            if (mask) {\n                for (const key in mask) {\n                    if (!(key in shape)) {\n                        throw new Error(`Unrecognized key: \"${key}\"`);\n                    }\n                    if (!mask[key])\n                        continue;\n                    // overwrite with non-optional\n                    shape[key] = new Class({\n                        type: \"nonoptional\",\n                        innerType: oldShape[key],\n                    });\n                }\n            }\n            else {\n                for (const key in oldShape) {\n                    // overwrite with non-optional\n                    shape[key] = new Class({\n                        type: \"nonoptional\",\n                        innerType: oldShape[key],\n                    });\n                }\n            }\n            assignProp(this, \"shape\", shape); // self-caching\n            return shape;\n        },\n    });\n    return clone(schema, def);\n}\n// invalid_type | too_big | too_small | invalid_format | not_multiple_of | unrecognized_keys | invalid_union | invalid_key | invalid_element | invalid_value | custom\nexport function aborted(x, startIndex = 0) {\n    if (x.aborted === true)\n        return true;\n    for (let i = startIndex; i < x.issues.length; i++) {\n        if (x.issues[i]?.continue !== true) {\n            return true;\n        }\n    }\n    return false;\n}\nexport function prefixIssues(path, issues) {\n    return issues.map((iss) => {\n        var _a;\n        (_a = iss).path ?? (_a.path = []);\n        iss.path.unshift(path);\n        return iss;\n    });\n}\nexport function unwrapMessage(message) {\n    return typeof message === \"string\" ? message : message?.message;\n}\nexport function finalizeIssue(iss, ctx, config) {\n    const full = { ...iss, path: iss.path ?? [] };\n    // for backwards compatibility\n    if (!iss.message) {\n        const message = unwrapMessage(iss.inst?._zod.def?.error?.(iss)) ??\n            unwrapMessage(ctx?.error?.(iss)) ??\n            unwrapMessage(config.customError?.(iss)) ??\n            unwrapMessage(config.localeError?.(iss)) ??\n            \"Invalid input\";\n        full.message = message;\n    }\n    // delete (full as any).def;\n    delete full.inst;\n    delete full.continue;\n    if (!ctx?.reportInput) {\n        delete full.input;\n    }\n    return full;\n}\nexport function getSizableOrigin(input) {\n    if (input instanceof Set)\n        return \"set\";\n    if (input instanceof Map)\n        return \"map\";\n    // @ts-ignore\n    if (input instanceof File)\n        return \"file\";\n    return \"unknown\";\n}\nexport function getLengthableOrigin(input) {\n    if (Array.isArray(input))\n        return \"array\";\n    if (typeof input === \"string\")\n        return \"string\";\n    return \"unknown\";\n}\nexport function parsedType(data) {\n    const t = typeof data;\n    switch (t) {\n        case \"number\": {\n            return Number.isNaN(data) ? \"nan\" : \"number\";\n        }\n        case \"object\": {\n            if (data === null) {\n                return \"null\";\n            }\n            if (Array.isArray(data)) {\n                return \"array\";\n            }\n            const obj = data;\n            if (obj && Object.getPrototypeOf(obj) !== Object.prototype && \"constructor\" in obj && obj.constructor) {\n                return obj.constructor.name;\n            }\n        }\n    }\n    return t;\n}\nexport function issue(...args) {\n    const [iss, input, inst] = args;\n    if (typeof iss === \"string\") {\n        return {\n            message: iss,\n            code: \"custom\",\n            input,\n            inst,\n        };\n    }\n    return { ...iss };\n}\nexport function cleanEnum(obj) {\n    return Object.entries(obj)\n        .filter(([k, _]) => {\n        // return true if NaN, meaning it's not a number, thus a string key\n        return Number.isNaN(Number.parseInt(k, 10));\n    })\n        .map((el) => el[1]);\n}\n// Codec utility functions\nexport function base64ToUint8Array(base64) {\n    const binaryString = atob(base64);\n    const bytes = new Uint8Array(binaryString.length);\n    for (let i = 0; i < binaryString.length; i++) {\n        bytes[i] = binaryString.charCodeAt(i);\n    }\n    return bytes;\n}\nexport function uint8ArrayToBase64(bytes) {\n    let binaryString = \"\";\n    for (let i = 0; i < bytes.length; i++) {\n        binaryString += String.fromCharCode(bytes[i]);\n    }\n    return btoa(binaryString);\n}\nexport function base64urlToUint8Array(base64url) {\n    const base64 = base64url.replace(/-/g, \"+\").replace(/_/g, \"/\");\n    const padding = \"=\".repeat((4 - (base64.length % 4)) % 4);\n    return base64ToUint8Array(base64 + padding);\n}\nexport function uint8ArrayToBase64url(bytes) {\n    return uint8ArrayToBase64(bytes).replace(/\\+/g, \"-\").replace(/\\//g, \"_\").replace(/=/g, \"\");\n}\nexport function hexToUint8Array(hex) {\n    const cleanHex = hex.replace(/^0x/, \"\");\n    if (cleanHex.length % 2 !== 0) {\n        throw new Error(\"Invalid hex string length\");\n    }\n    const bytes = new Uint8Array(cleanHex.length / 2);\n    for (let i = 0; i < cleanHex.length; i += 2) {\n        bytes[i / 2] = Number.parseInt(cleanHex.slice(i, i + 2), 16);\n    }\n    return bytes;\n}\nexport function uint8ArrayToHex(bytes) {\n    return Array.from(bytes)\n        .map((b) => b.toString(16).padStart(2, \"0\"))\n        .join(\"\");\n}\n// instanceof\nexport class Class {\n    constructor(..._args) { }\n}\n","import { $constructor } from \"./core.js\";\nimport * as util from \"./util.js\";\nconst initializer = (inst, def) => {\n    inst.name = \"$ZodError\";\n    Object.defineProperty(inst, \"_zod\", {\n        value: inst._zod,\n        enumerable: false,\n    });\n    Object.defineProperty(inst, \"issues\", {\n        value: def,\n        enumerable: false,\n    });\n    inst.message = JSON.stringify(def, util.jsonStringifyReplacer, 2);\n    Object.defineProperty(inst, \"toString\", {\n        value: () => inst.message,\n        enumerable: false,\n    });\n};\nexport const $ZodError = $constructor(\"$ZodError\", initializer);\nexport const $ZodRealError = $constructor(\"$ZodError\", initializer, { Parent: Error });\nexport function flattenError(error, mapper = (issue) => issue.message) {\n    const fieldErrors = {};\n    const formErrors = [];\n    for (const sub of error.issues) {\n        if (sub.path.length > 0) {\n            fieldErrors[sub.path[0]] = fieldErrors[sub.path[0]] || [];\n            fieldErrors[sub.path[0]].push(mapper(sub));\n        }\n        else {\n            formErrors.push(mapper(sub));\n        }\n    }\n    return { formErrors, fieldErrors };\n}\nexport function formatError(error, mapper = (issue) => issue.message) {\n    const fieldErrors = { _errors: [] };\n    const processError = (error) => {\n        for (const issue of error.issues) {\n            if (issue.code === \"invalid_union\" && issue.errors.length) {\n                issue.errors.map((issues) => processError({ issues }));\n            }\n            else if (issue.code === \"invalid_key\") {\n                processError({ issues: issue.issues });\n            }\n            else if (issue.code === \"invalid_element\") {\n                processError({ issues: issue.issues });\n            }\n            else if (issue.path.length === 0) {\n                fieldErrors._errors.push(mapper(issue));\n            }\n            else {\n                let curr = fieldErrors;\n                let i = 0;\n                while (i < issue.path.length) {\n                    const el = issue.path[i];\n                    const terminal = i === issue.path.length - 1;\n                    if (!terminal) {\n                        curr[el] = curr[el] || { _errors: [] };\n                    }\n                    else {\n                        curr[el] = curr[el] || { _errors: [] };\n                        curr[el]._errors.push(mapper(issue));\n                    }\n                    curr = curr[el];\n                    i++;\n                }\n            }\n        }\n    };\n    processError(error);\n    return fieldErrors;\n}\nexport function treeifyError(error, mapper = (issue) => issue.message) {\n    const result = { errors: [] };\n    const processError = (error, path = []) => {\n        var _a, _b;\n        for (const issue of error.issues) {\n            if (issue.code === \"invalid_union\" && issue.errors.length) {\n                // regular union error\n                issue.errors.map((issues) => processError({ issues }, issue.path));\n            }\n            else if (issue.code === \"invalid_key\") {\n                processError({ issues: issue.issues }, issue.path);\n            }\n            else if (issue.code === \"invalid_element\") {\n                processError({ issues: issue.issues }, issue.path);\n            }\n            else {\n                const fullpath = [...path, ...issue.path];\n                if (fullpath.length === 0) {\n                    result.errors.push(mapper(issue));\n                    continue;\n                }\n                let curr = result;\n                let i = 0;\n                while (i < fullpath.length) {\n                    const el = fullpath[i];\n                    const terminal = i === fullpath.length - 1;\n                    if (typeof el === \"string\") {\n                        curr.properties ?? (curr.properties = {});\n                        (_a = curr.properties)[el] ?? (_a[el] = { errors: [] });\n                        curr = curr.properties[el];\n                    }\n                    else {\n                        curr.items ?? (curr.items = []);\n                        (_b = curr.items)[el] ?? (_b[el] = { errors: [] });\n                        curr = curr.items[el];\n                    }\n                    if (terminal) {\n                        curr.errors.push(mapper(issue));\n                    }\n                    i++;\n                }\n            }\n        }\n    };\n    processError(error);\n    return result;\n}\n/** Format a ZodError as a human-readable string in the following form.\n *\n * From\n *\n * ```ts\n * ZodError {\n *   issues: [\n *     {\n *       expected: 'string',\n *       code: 'invalid_type',\n *       path: [ 'username' ],\n *       message: 'Invalid input: expected string'\n *     },\n *     {\n *       expected: 'number',\n *       code: 'invalid_type',\n *       path: [ 'favoriteNumbers', 1 ],\n *       message: 'Invalid input: expected number'\n *     }\n *   ];\n * }\n * ```\n *\n * to\n *\n * ```\n * username\n *    Expected number, received string at \"username\n * favoriteNumbers[0]\n *    Invalid input: expected number\n * ```\n */\nexport function toDotPath(_path) {\n    const segs = [];\n    const path = _path.map((seg) => (typeof seg === \"object\" ? seg.key : seg));\n    for (const seg of path) {\n        if (typeof seg === \"number\")\n            segs.push(`[${seg}]`);\n        else if (typeof seg === \"symbol\")\n            segs.push(`[${JSON.stringify(String(seg))}]`);\n        else if (/[^\\w$]/.test(seg))\n            segs.push(`[${JSON.stringify(seg)}]`);\n        else {\n            if (segs.length)\n                segs.push(\".\");\n            segs.push(seg);\n        }\n    }\n    return segs.join(\"\");\n}\nexport function prettifyError(error) {\n    const lines = [];\n    // sort by path length\n    const issues = [...error.issues].sort((a, b) => (a.path ?? []).length - (b.path ?? []).length);\n    // Process each issue\n    for (const issue of issues) {\n        lines.push(` ${issue.message}`);\n        if (issue.path?.length)\n            lines.push(`   at ${toDotPath(issue.path)}`);\n    }\n    // Convert Map to formatted string\n    return lines.join(\"\\n\");\n}\n","import * as core from \"./core.js\";\nimport * as errors from \"./errors.js\";\nimport * as util from \"./util.js\";\nexport const _parse = (_Err) => (schema, value, _ctx, _params) => {\n    const ctx = _ctx ? Object.assign(_ctx, { async: false }) : { async: false };\n    const result = schema._zod.run({ value, issues: [] }, ctx);\n    if (result instanceof Promise) {\n        throw new core.$ZodAsyncError();\n    }\n    if (result.issues.length) {\n        const e = new (_params?.Err ?? _Err)(result.issues.map((iss) => util.finalizeIssue(iss, ctx, core.config())));\n        util.captureStackTrace(e, _params?.callee);\n        throw e;\n    }\n    return result.value;\n};\nexport const parse = /* @__PURE__*/ _parse(errors.$ZodRealError);\nexport const _parseAsync = (_Err) => async (schema, value, _ctx, params) => {\n    const ctx = _ctx ? Object.assign(_ctx, { async: true }) : { async: true };\n    let result = schema._zod.run({ value, issues: [] }, ctx);\n    if (result instanceof Promise)\n        result = await result;\n    if (result.issues.length) {\n        const e = new (params?.Err ?? _Err)(result.issues.map((iss) => util.finalizeIssue(iss, ctx, core.config())));\n        util.captureStackTrace(e, params?.callee);\n        throw e;\n    }\n    return result.value;\n};\nexport const parseAsync = /* @__PURE__*/ _parseAsync(errors.$ZodRealError);\nexport const _safeParse = (_Err) => (schema, value, _ctx) => {\n    const ctx = _ctx ? { ..._ctx, async: false } : { async: false };\n    const result = schema._zod.run({ value, issues: [] }, ctx);\n    if (result instanceof Promise) {\n        throw new core.$ZodAsyncError();\n    }\n    return result.issues.length\n        ? {\n            success: false,\n            error: new (_Err ?? errors.$ZodError)(result.issues.map((iss) => util.finalizeIssue(iss, ctx, core.config()))),\n        }\n        : { success: true, data: result.value };\n};\nexport const safeParse = /* @__PURE__*/ _safeParse(errors.$ZodRealError);\nexport const _safeParseAsync = (_Err) => async (schema, value, _ctx) => {\n    const ctx = _ctx ? Object.assign(_ctx, { async: true }) : { async: true };\n    let result = schema._zod.run({ value, issues: [] }, ctx);\n    if (result instanceof Promise)\n        result = await result;\n    return result.issues.length\n        ? {\n            success: false,\n            error: new _Err(result.issues.map((iss) => util.finalizeIssue(iss, ctx, core.config()))),\n        }\n        : { success: true, data: result.value };\n};\nexport const safeParseAsync = /* @__PURE__*/ _safeParseAsync(errors.$ZodRealError);\nexport const _encode = (_Err) => (schema, value, _ctx) => {\n    const ctx = _ctx ? Object.assign(_ctx, { direction: \"backward\" }) : { direction: \"backward\" };\n    return _parse(_Err)(schema, value, ctx);\n};\nexport const encode = /* @__PURE__*/ _encode(errors.$ZodRealError);\nexport const _decode = (_Err) => (schema, value, _ctx) => {\n    return _parse(_Err)(schema, value, _ctx);\n};\nexport const decode = /* @__PURE__*/ _decode(errors.$ZodRealError);\nexport const _encodeAsync = (_Err) => async (schema, value, _ctx) => {\n    const ctx = _ctx ? Object.assign(_ctx, { direction: \"backward\" }) : { direction: \"backward\" };\n    return _parseAsync(_Err)(schema, value, ctx);\n};\nexport const encodeAsync = /* @__PURE__*/ _encodeAsync(errors.$ZodRealError);\nexport const _decodeAsync = (_Err) => async (schema, value, _ctx) => {\n    return _parseAsync(_Err)(schema, value, _ctx);\n};\nexport const decodeAsync = /* @__PURE__*/ _decodeAsync(errors.$ZodRealError);\nexport const _safeEncode = (_Err) => (schema, value, _ctx) => {\n    const ctx = _ctx ? Object.assign(_ctx, { direction: \"backward\" }) : { direction: \"backward\" };\n    return _safeParse(_Err)(schema, value, ctx);\n};\nexport const safeEncode = /* @__PURE__*/ _safeEncode(errors.$ZodRealError);\nexport const _safeDecode = (_Err) => (schema, value, _ctx) => {\n    return _safeParse(_Err)(schema, value, _ctx);\n};\nexport const safeDecode = /* @__PURE__*/ _safeDecode(errors.$ZodRealError);\nexport const _safeEncodeAsync = (_Err) => async (schema, value, _ctx) => {\n    const ctx = _ctx ? Object.assign(_ctx, { direction: \"backward\" }) : { direction: \"backward\" };\n    return _safeParseAsync(_Err)(schema, value, ctx);\n};\nexport const safeEncodeAsync = /* @__PURE__*/ _safeEncodeAsync(errors.$ZodRealError);\nexport const _safeDecodeAsync = (_Err) => async (schema, value, _ctx) => {\n    return _safeParseAsync(_Err)(schema, value, _ctx);\n};\nexport const safeDecodeAsync = /* @__PURE__*/ _safeDecodeAsync(errors.$ZodRealError);\n","import * as util from \"./util.js\";\nexport const cuid = /^[cC][^\\s-]{8,}$/;\nexport const cuid2 = /^[0-9a-z]+$/;\nexport const ulid = /^[0-9A-HJKMNP-TV-Za-hjkmnp-tv-z]{26}$/;\nexport const xid = /^[0-9a-vA-V]{20}$/;\nexport const ksuid = /^[A-Za-z0-9]{27}$/;\nexport const nanoid = /^[a-zA-Z0-9_-]{21}$/;\n/** ISO 8601-1 duration regex. Does not support the 8601-2 extensions like negative durations or fractional/negative components. */\nexport const duration = /^P(?:(\\d+W)|(?!.*W)(?=\\d|T\\d)(\\d+Y)?(\\d+M)?(\\d+D)?(T(?=\\d)(\\d+H)?(\\d+M)?(\\d+([.,]\\d+)?S)?)?)$/;\n/** Implements ISO 8601-2 extensions like explicit +- prefixes, mixing weeks with other units, and fractional/negative components. */\nexport const extendedDuration = /^[-+]?P(?!$)(?:(?:[-+]?\\d+Y)|(?:[-+]?\\d+[.,]\\d+Y$))?(?:(?:[-+]?\\d+M)|(?:[-+]?\\d+[.,]\\d+M$))?(?:(?:[-+]?\\d+W)|(?:[-+]?\\d+[.,]\\d+W$))?(?:(?:[-+]?\\d+D)|(?:[-+]?\\d+[.,]\\d+D$))?(?:T(?=[\\d+-])(?:(?:[-+]?\\d+H)|(?:[-+]?\\d+[.,]\\d+H$))?(?:(?:[-+]?\\d+M)|(?:[-+]?\\d+[.,]\\d+M$))?(?:[-+]?\\d+(?:[.,]\\d+)?S)?)??$/;\n/** A regex for any UUID-like identifier: 8-4-4-4-12 hex pattern */\nexport const guid = /^([0-9a-fA-F]{8}-[0-9a-fA-F]{4}-[0-9a-fA-F]{4}-[0-9a-fA-F]{4}-[0-9a-fA-F]{12})$/;\n/** Returns a regex for validating an RFC 9562/4122 UUID.\n *\n * @param version Optionally specify a version 1-8. If no version is specified, all versions are supported. */\nexport const uuid = (version) => {\n    if (!version)\n        return /^([0-9a-fA-F]{8}-[0-9a-fA-F]{4}-[1-8][0-9a-fA-F]{3}-[89abAB][0-9a-fA-F]{3}-[0-9a-fA-F]{12}|00000000-0000-0000-0000-000000000000|ffffffff-ffff-ffff-ffff-ffffffffffff)$/;\n    return new RegExp(`^([0-9a-fA-F]{8}-[0-9a-fA-F]{4}-${version}[0-9a-fA-F]{3}-[89abAB][0-9a-fA-F]{3}-[0-9a-fA-F]{12})$`);\n};\nexport const uuid4 = /*@__PURE__*/ uuid(4);\nexport const uuid6 = /*@__PURE__*/ uuid(6);\nexport const uuid7 = /*@__PURE__*/ uuid(7);\n/** Practical email validation */\nexport const email = /^(?!\\.)(?!.*\\.\\.)([A-Za-z0-9_'+\\-\\.]*)[A-Za-z0-9_+-]@([A-Za-z0-9][A-Za-z0-9\\-]*\\.)+[A-Za-z]{2,}$/;\n/** Equivalent to the HTML5 input[type=email] validation implemented by browsers. Source: https://developer.mozilla.org/en-US/docs/Web/HTML/Element/input/email */\nexport const html5Email = /^[a-zA-Z0-9.!#$%&'*+/=?^_`{|}~-]+@[a-zA-Z0-9](?:[a-zA-Z0-9-]{0,61}[a-zA-Z0-9])?(?:\\.[a-zA-Z0-9](?:[a-zA-Z0-9-]{0,61}[a-zA-Z0-9])?)*$/;\n/** The classic emailregex.com regex for RFC 5322-compliant emails */\nexport const rfc5322Email = /^(([^<>()\\[\\]\\\\.,;:\\s@\"]+(\\.[^<>()\\[\\]\\\\.,;:\\s@\"]+)*)|(\".+\"))@((\\[[0-9]{1,3}\\.[0-9]{1,3}\\.[0-9]{1,3}\\.[0-9]{1,3}])|(([a-zA-Z\\-0-9]+\\.)+[a-zA-Z]{2,}))$/;\n/** A loose regex that allows Unicode characters, enforces length limits, and that's about it. */\nexport const unicodeEmail = /^[^\\s@\"]{1,64}@[^\\s@]{1,255}$/u;\nexport const idnEmail = unicodeEmail;\nexport const browserEmail = /^[a-zA-Z0-9.!#$%&'*+/=?^_`{|}~-]+@[a-zA-Z0-9](?:[a-zA-Z0-9-]{0,61}[a-zA-Z0-9])?(?:\\.[a-zA-Z0-9](?:[a-zA-Z0-9-]{0,61}[a-zA-Z0-9])?)*$/;\n// from https://thekevinscott.com/emojis-in-javascript/#writing-a-regular-expression\nconst _emoji = `^(\\\\p{Extended_Pictographic}|\\\\p{Emoji_Component})+$`;\nexport function emoji() {\n    return new RegExp(_emoji, \"u\");\n}\nexport const ipv4 = /^(?:(?:25[0-5]|2[0-4][0-9]|1[0-9][0-9]|[1-9][0-9]|[0-9])\\.){3}(?:25[0-5]|2[0-4][0-9]|1[0-9][0-9]|[1-9][0-9]|[0-9])$/;\nexport const ipv6 = /^(([0-9a-fA-F]{1,4}:){7}[0-9a-fA-F]{1,4}|([0-9a-fA-F]{1,4}:){1,7}:|([0-9a-fA-F]{1,4}:){1,6}:[0-9a-fA-F]{1,4}|([0-9a-fA-F]{1,4}:){1,5}(:[0-9a-fA-F]{1,4}){1,2}|([0-9a-fA-F]{1,4}:){1,4}(:[0-9a-fA-F]{1,4}){1,3}|([0-9a-fA-F]{1,4}:){1,3}(:[0-9a-fA-F]{1,4}){1,4}|([0-9a-fA-F]{1,4}:){1,2}(:[0-9a-fA-F]{1,4}){1,5}|[0-9a-fA-F]{1,4}:((:[0-9a-fA-F]{1,4}){1,6})|:((:[0-9a-fA-F]{1,4}){1,7}|:))$/;\nexport const mac = (delimiter) => {\n    const escapedDelim = util.escapeRegex(delimiter ?? \":\");\n    return new RegExp(`^(?:[0-9A-F]{2}${escapedDelim}){5}[0-9A-F]{2}$|^(?:[0-9a-f]{2}${escapedDelim}){5}[0-9a-f]{2}$`);\n};\nexport const cidrv4 = /^((25[0-5]|2[0-4][0-9]|1[0-9][0-9]|[1-9][0-9]|[0-9])\\.){3}(25[0-5]|2[0-4][0-9]|1[0-9][0-9]|[1-9][0-9]|[0-9])\\/([0-9]|[1-2][0-9]|3[0-2])$/;\nexport const cidrv6 = /^(([0-9a-fA-F]{1,4}:){7}[0-9a-fA-F]{1,4}|::|([0-9a-fA-F]{1,4})?::([0-9a-fA-F]{1,4}:?){0,6})\\/(12[0-8]|1[01][0-9]|[1-9]?[0-9])$/;\n// https://stackoverflow.com/questions/7860392/determine-if-string-is-in-base64-using-javascript\nexport const base64 = /^$|^(?:[0-9a-zA-Z+/]{4})*(?:(?:[0-9a-zA-Z+/]{2}==)|(?:[0-9a-zA-Z+/]{3}=))?$/;\nexport const base64url = /^[A-Za-z0-9_-]*$/;\n// based on https://stackoverflow.com/questions/106179/regular-expression-to-match-dns-hostname-or-ip-address\n// export const hostname: RegExp = /^([a-zA-Z0-9-]+\\.)*[a-zA-Z0-9-]+$/;\nexport const hostname = /^(?=.{1,253}\\.?$)[a-zA-Z0-9](?:[a-zA-Z0-9-]{0,61}[a-zA-Z0-9])?(?:\\.[a-zA-Z0-9](?:[-0-9a-zA-Z]{0,61}[0-9a-zA-Z])?)*\\.?$/;\nexport const domain = /^([a-zA-Z0-9](?:[a-zA-Z0-9-]{0,61}[a-zA-Z0-9])?\\.)+[a-zA-Z]{2,}$/;\n// https://blog.stevenlevithan.com/archives/validate-phone-number#r4-3 (regex sans spaces)\n// E.164: leading digit must be 1-9; total digits (excluding '+') between 7-15\nexport const e164 = /^\\+[1-9]\\d{6,14}$/;\n// const dateSource = `((\\\\d\\\\d[2468][048]|\\\\d\\\\d[13579][26]|\\\\d\\\\d0[48]|[02468][048]00|[13579][26]00)-02-29|\\\\d{4}-((0[13578]|1[02])-(0[1-9]|[12]\\\\d|3[01])|(0[469]|11)-(0[1-9]|[12]\\\\d|30)|(02)-(0[1-9]|1\\\\d|2[0-8])))`;\nconst dateSource = `(?:(?:\\\\d\\\\d[2468][048]|\\\\d\\\\d[13579][26]|\\\\d\\\\d0[48]|[02468][048]00|[13579][26]00)-02-29|\\\\d{4}-(?:(?:0[13578]|1[02])-(?:0[1-9]|[12]\\\\d|3[01])|(?:0[469]|11)-(?:0[1-9]|[12]\\\\d|30)|(?:02)-(?:0[1-9]|1\\\\d|2[0-8])))`;\nexport const date = /*@__PURE__*/ new RegExp(`^${dateSource}$`);\nfunction timeSource(args) {\n    const hhmm = `(?:[01]\\\\d|2[0-3]):[0-5]\\\\d`;\n    const regex = typeof args.precision === \"number\"\n        ? args.precision === -1\n            ? `${hhmm}`\n            : args.precision === 0\n                ? `${hhmm}:[0-5]\\\\d`\n                : `${hhmm}:[0-5]\\\\d\\\\.\\\\d{${args.precision}}`\n        : `${hhmm}(?::[0-5]\\\\d(?:\\\\.\\\\d+)?)?`;\n    return regex;\n}\nexport function time(args) {\n    return new RegExp(`^${timeSource(args)}$`);\n}\n// Adapted from https://stackoverflow.com/a/3143231\nexport function datetime(args) {\n    const time = timeSource({ precision: args.precision });\n    const opts = [\"Z\"];\n    if (args.local)\n        opts.push(\"\");\n    // if (args.offset) opts.push(`([+-]\\\\d{2}:\\\\d{2})`);\n    if (args.offset)\n        opts.push(`([+-](?:[01]\\\\d|2[0-3]):[0-5]\\\\d)`);\n    const timeRegex = `${time}(?:${opts.join(\"|\")})`;\n    return new RegExp(`^${dateSource}T(?:${timeRegex})$`);\n}\nexport const string = (params) => {\n    const regex = params ? `[\\\\s\\\\S]{${params?.minimum ?? 0},${params?.maximum ?? \"\"}}` : `[\\\\s\\\\S]*`;\n    return new RegExp(`^${regex}$`);\n};\nexport const bigint = /^-?\\d+n?$/;\nexport const integer = /^-?\\d+$/;\nexport const number = /^-?\\d+(?:\\.\\d+)?$/;\nexport const boolean = /^(?:true|false)$/i;\nconst _null = /^null$/i;\nexport { _null as null };\nconst _undefined = /^undefined$/i;\nexport { _undefined as undefined };\n// regex for string with no uppercase letters\nexport const lowercase = /^[^A-Z]*$/;\n// regex for string with no lowercase letters\nexport const uppercase = /^[^a-z]*$/;\n// regex for hexadecimal strings (any length)\nexport const hex = /^[0-9a-fA-F]*$/;\n// Hash regexes for different algorithms and encodings\n// Helper function to create base64 regex with exact length and padding\nfunction fixedBase64(bodyLength, padding) {\n    return new RegExp(`^[A-Za-z0-9+/]{${bodyLength}}${padding}$`);\n}\n// Helper function to create base64url regex with exact length (no padding)\nfunction fixedBase64url(length) {\n    return new RegExp(`^[A-Za-z0-9_-]{${length}}$`);\n}\n// MD5 (16 bytes): base64 = 24 chars total (22 + \"==\")\nexport const md5_hex = /^[0-9a-fA-F]{32}$/;\nexport const md5_base64 = /*@__PURE__*/ fixedBase64(22, \"==\");\nexport const md5_base64url = /*@__PURE__*/ fixedBase64url(22);\n// SHA1 (20 bytes): base64 = 28 chars total (27 + \"=\")\nexport const sha1_hex = /^[0-9a-fA-F]{40}$/;\nexport const sha1_base64 = /*@__PURE__*/ fixedBase64(27, \"=\");\nexport const sha1_base64url = /*@__PURE__*/ fixedBase64url(27);\n// SHA256 (32 bytes): base64 = 44 chars total (43 + \"=\")\nexport const sha256_hex = /^[0-9a-fA-F]{64}$/;\nexport const sha256_base64 = /*@__PURE__*/ fixedBase64(43, \"=\");\nexport const sha256_base64url = /*@__PURE__*/ fixedBase64url(43);\n// SHA384 (48 bytes): base64 = 64 chars total (no padding)\nexport const sha384_hex = /^[0-9a-fA-F]{96}$/;\nexport const sha384_base64 = /*@__PURE__*/ fixedBase64(64, \"\");\nexport const sha384_base64url = /*@__PURE__*/ fixedBase64url(64);\n// SHA512 (64 bytes): base64 = 88 chars total (86 + \"==\")\nexport const sha512_hex = /^[0-9a-fA-F]{128}$/;\nexport const sha512_base64 = /*@__PURE__*/ fixedBase64(86, \"==\");\nexport const sha512_base64url = /*@__PURE__*/ fixedBase64url(86);\n","// import { $ZodType } from \"./schemas.js\";\nimport * as core from \"./core.js\";\nimport * as regexes from \"./regexes.js\";\nimport * as util from \"./util.js\";\nexport const $ZodCheck = /*@__PURE__*/ core.$constructor(\"$ZodCheck\", (inst, def) => {\n    var _a;\n    inst._zod ?? (inst._zod = {});\n    inst._zod.def = def;\n    (_a = inst._zod).onattach ?? (_a.onattach = []);\n});\nconst numericOriginMap = {\n    number: \"number\",\n    bigint: \"bigint\",\n    object: \"date\",\n};\nexport const $ZodCheckLessThan = /*@__PURE__*/ core.$constructor(\"$ZodCheckLessThan\", (inst, def) => {\n    $ZodCheck.init(inst, def);\n    const origin = numericOriginMap[typeof def.value];\n    inst._zod.onattach.push((inst) => {\n        const bag = inst._zod.bag;\n        const curr = (def.inclusive ? bag.maximum : bag.exclusiveMaximum) ?? Number.POSITIVE_INFINITY;\n        if (def.value < curr) {\n            if (def.inclusive)\n                bag.maximum = def.value;\n            else\n                bag.exclusiveMaximum = def.value;\n        }\n    });\n    inst._zod.check = (payload) => {\n        if (def.inclusive ? payload.value <= def.value : payload.value < def.value) {\n            return;\n        }\n        payload.issues.push({\n            origin,\n            code: \"too_big\",\n            maximum: typeof def.value === \"object\" ? def.value.getTime() : def.value,\n            input: payload.value,\n            inclusive: def.inclusive,\n            inst,\n            continue: !def.abort,\n        });\n    };\n});\nexport const $ZodCheckGreaterThan = /*@__PURE__*/ core.$constructor(\"$ZodCheckGreaterThan\", (inst, def) => {\n    $ZodCheck.init(inst, def);\n    const origin = numericOriginMap[typeof def.value];\n    inst._zod.onattach.push((inst) => {\n        const bag = inst._zod.bag;\n        const curr = (def.inclusive ? bag.minimum : bag.exclusiveMinimum) ?? Number.NEGATIVE_INFINITY;\n        if (def.value > curr) {\n            if (def.inclusive)\n                bag.minimum = def.value;\n            else\n                bag.exclusiveMinimum = def.value;\n        }\n    });\n    inst._zod.check = (payload) => {\n        if (def.inclusive ? payload.value >= def.value : payload.value > def.value) {\n            return;\n        }\n        payload.issues.push({\n            origin,\n            code: \"too_small\",\n            minimum: typeof def.value === \"object\" ? def.value.getTime() : def.value,\n            input: payload.value,\n            inclusive: def.inclusive,\n            inst,\n            continue: !def.abort,\n        });\n    };\n});\nexport const $ZodCheckMultipleOf = \n/*@__PURE__*/ core.$constructor(\"$ZodCheckMultipleOf\", (inst, def) => {\n    $ZodCheck.init(inst, def);\n    inst._zod.onattach.push((inst) => {\n        var _a;\n        (_a = inst._zod.bag).multipleOf ?? (_a.multipleOf = def.value);\n    });\n    inst._zod.check = (payload) => {\n        if (typeof payload.value !== typeof def.value)\n            throw new Error(\"Cannot mix number and bigint in multiple_of check.\");\n        const isMultiple = typeof payload.value === \"bigint\"\n            ? payload.value % def.value === BigInt(0)\n            : util.floatSafeRemainder(payload.value, def.value) === 0;\n        if (isMultiple)\n            return;\n        payload.issues.push({\n            origin: typeof payload.value,\n            code: \"not_multiple_of\",\n            divisor: def.value,\n            input: payload.value,\n            inst,\n            continue: !def.abort,\n        });\n    };\n});\nexport const $ZodCheckNumberFormat = /*@__PURE__*/ core.$constructor(\"$ZodCheckNumberFormat\", (inst, def) => {\n    $ZodCheck.init(inst, def); // no format checks\n    def.format = def.format || \"float64\";\n    const isInt = def.format?.includes(\"int\");\n    const origin = isInt ? \"int\" : \"number\";\n    const [minimum, maximum] = util.NUMBER_FORMAT_RANGES[def.format];\n    inst._zod.onattach.push((inst) => {\n        const bag = inst._zod.bag;\n        bag.format = def.format;\n        bag.minimum = minimum;\n        bag.maximum = maximum;\n        if (isInt)\n            bag.pattern = regexes.integer;\n    });\n    inst._zod.check = (payload) => {\n        const input = payload.value;\n        if (isInt) {\n            if (!Number.isInteger(input)) {\n                // invalid_format issue\n                // payload.issues.push({\n                //   expected: def.format,\n                //   format: def.format,\n                //   code: \"invalid_format\",\n                //   input,\n                //   inst,\n                // });\n                // invalid_type issue\n                payload.issues.push({\n                    expected: origin,\n                    format: def.format,\n                    code: \"invalid_type\",\n                    continue: false,\n                    input,\n                    inst,\n                });\n                return;\n                // not_multiple_of issue\n                // payload.issues.push({\n                //   code: \"not_multiple_of\",\n                //   origin: \"number\",\n                //   input,\n                //   inst,\n                //   divisor: 1,\n                // });\n            }\n            if (!Number.isSafeInteger(input)) {\n                if (input > 0) {\n                    // too_big\n                    payload.issues.push({\n                        input,\n                        code: \"too_big\",\n                        maximum: Number.MAX_SAFE_INTEGER,\n                        note: \"Integers must be within the safe integer range.\",\n                        inst,\n                        origin,\n                        inclusive: true,\n                        continue: !def.abort,\n                    });\n                }\n                else {\n                    // too_small\n                    payload.issues.push({\n                        input,\n                        code: \"too_small\",\n                        minimum: Number.MIN_SAFE_INTEGER,\n                        note: \"Integers must be within the safe integer range.\",\n                        inst,\n                        origin,\n                        inclusive: true,\n                        continue: !def.abort,\n                    });\n                }\n                return;\n            }\n        }\n        if (input < minimum) {\n            payload.issues.push({\n                origin: \"number\",\n                input,\n                code: \"too_small\",\n                minimum,\n                inclusive: true,\n                inst,\n                continue: !def.abort,\n            });\n        }\n        if (input > maximum) {\n            payload.issues.push({\n                origin: \"number\",\n                input,\n                code: \"too_big\",\n                maximum,\n                inclusive: true,\n                inst,\n                continue: !def.abort,\n            });\n        }\n    };\n});\nexport const $ZodCheckBigIntFormat = /*@__PURE__*/ core.$constructor(\"$ZodCheckBigIntFormat\", (inst, def) => {\n    $ZodCheck.init(inst, def); // no format checks\n    const [minimum, maximum] = util.BIGINT_FORMAT_RANGES[def.format];\n    inst._zod.onattach.push((inst) => {\n        const bag = inst._zod.bag;\n        bag.format = def.format;\n        bag.minimum = minimum;\n        bag.maximum = maximum;\n    });\n    inst._zod.check = (payload) => {\n        const input = payload.value;\n        if (input < minimum) {\n            payload.issues.push({\n                origin: \"bigint\",\n                input,\n                code: \"too_small\",\n                minimum: minimum,\n                inclusive: true,\n                inst,\n                continue: !def.abort,\n            });\n        }\n        if (input > maximum) {\n            payload.issues.push({\n                origin: \"bigint\",\n                input,\n                code: \"too_big\",\n                maximum,\n                inclusive: true,\n                inst,\n                continue: !def.abort,\n            });\n        }\n    };\n});\nexport const $ZodCheckMaxSize = /*@__PURE__*/ core.$constructor(\"$ZodCheckMaxSize\", (inst, def) => {\n    var _a;\n    $ZodCheck.init(inst, def);\n    (_a = inst._zod.def).when ?? (_a.when = (payload) => {\n        const val = payload.value;\n        return !util.nullish(val) && val.size !== undefined;\n    });\n    inst._zod.onattach.push((inst) => {\n        const curr = (inst._zod.bag.maximum ?? Number.POSITIVE_INFINITY);\n        if (def.maximum < curr)\n            inst._zod.bag.maximum = def.maximum;\n    });\n    inst._zod.check = (payload) => {\n        const input = payload.value;\n        const size = input.size;\n        if (size <= def.maximum)\n            return;\n        payload.issues.push({\n            origin: util.getSizableOrigin(input),\n            code: \"too_big\",\n            maximum: def.maximum,\n            inclusive: true,\n            input,\n            inst,\n            continue: !def.abort,\n        });\n    };\n});\nexport const $ZodCheckMinSize = /*@__PURE__*/ core.$constructor(\"$ZodCheckMinSize\", (inst, def) => {\n    var _a;\n    $ZodCheck.init(inst, def);\n    (_a = inst._zod.def).when ?? (_a.when = (payload) => {\n        const val = payload.value;\n        return !util.nullish(val) && val.size !== undefined;\n    });\n    inst._zod.onattach.push((inst) => {\n        const curr = (inst._zod.bag.minimum ?? Number.NEGATIVE_INFINITY);\n        if (def.minimum > curr)\n            inst._zod.bag.minimum = def.minimum;\n    });\n    inst._zod.check = (payload) => {\n        const input = payload.value;\n        const size = input.size;\n        if (size >= def.minimum)\n            return;\n        payload.issues.push({\n            origin: util.getSizableOrigin(input),\n            code: \"too_small\",\n            minimum: def.minimum,\n            inclusive: true,\n            input,\n            inst,\n            continue: !def.abort,\n        });\n    };\n});\nexport const $ZodCheckSizeEquals = /*@__PURE__*/ core.$constructor(\"$ZodCheckSizeEquals\", (inst, def) => {\n    var _a;\n    $ZodCheck.init(inst, def);\n    (_a = inst._zod.def).when ?? (_a.when = (payload) => {\n        const val = payload.value;\n        return !util.nullish(val) && val.size !== undefined;\n    });\n    inst._zod.onattach.push((inst) => {\n        const bag = inst._zod.bag;\n        bag.minimum = def.size;\n        bag.maximum = def.size;\n        bag.size = def.size;\n    });\n    inst._zod.check = (payload) => {\n        const input = payload.value;\n        const size = input.size;\n        if (size === def.size)\n            return;\n        const tooBig = size > def.size;\n        payload.issues.push({\n            origin: util.getSizableOrigin(input),\n            ...(tooBig ? { code: \"too_big\", maximum: def.size } : { code: \"too_small\", minimum: def.size }),\n            inclusive: true,\n            exact: true,\n            input: payload.value,\n            inst,\n            continue: !def.abort,\n        });\n    };\n});\nexport const $ZodCheckMaxLength = /*@__PURE__*/ core.$constructor(\"$ZodCheckMaxLength\", (inst, def) => {\n    var _a;\n    $ZodCheck.init(inst, def);\n    (_a = inst._zod.def).when ?? (_a.when = (payload) => {\n        const val = payload.value;\n        return !util.nullish(val) && val.length !== undefined;\n    });\n    inst._zod.onattach.push((inst) => {\n        const curr = (inst._zod.bag.maximum ?? Number.POSITIVE_INFINITY);\n        if (def.maximum < curr)\n            inst._zod.bag.maximum = def.maximum;\n    });\n    inst._zod.check = (payload) => {\n        const input = payload.value;\n        const length = input.length;\n        if (length <= def.maximum)\n            return;\n        const origin = util.getLengthableOrigin(input);\n        payload.issues.push({\n            origin,\n            code: \"too_big\",\n            maximum: def.maximum,\n            inclusive: true,\n            input,\n            inst,\n            continue: !def.abort,\n        });\n    };\n});\nexport const $ZodCheckMinLength = /*@__PURE__*/ core.$constructor(\"$ZodCheckMinLength\", (inst, def) => {\n    var _a;\n    $ZodCheck.init(inst, def);\n    (_a = inst._zod.def).when ?? (_a.when = (payload) => {\n        const val = payload.value;\n        return !util.nullish(val) && val.length !== undefined;\n    });\n    inst._zod.onattach.push((inst) => {\n        const curr = (inst._zod.bag.minimum ?? Number.NEGATIVE_INFINITY);\n        if (def.minimum > curr)\n            inst._zod.bag.minimum = def.minimum;\n    });\n    inst._zod.check = (payload) => {\n        const input = payload.value;\n        const length = input.length;\n        if (length >= def.minimum)\n            return;\n        const origin = util.getLengthableOrigin(input);\n        payload.issues.push({\n            origin,\n            code: \"too_small\",\n            minimum: def.minimum,\n            inclusive: true,\n            input,\n            inst,\n            continue: !def.abort,\n        });\n    };\n});\nexport const $ZodCheckLengthEquals = /*@__PURE__*/ core.$constructor(\"$ZodCheckLengthEquals\", (inst, def) => {\n    var _a;\n    $ZodCheck.init(inst, def);\n    (_a = inst._zod.def).when ?? (_a.when = (payload) => {\n        const val = payload.value;\n        return !util.nullish(val) && val.length !== undefined;\n    });\n    inst._zod.onattach.push((inst) => {\n        const bag = inst._zod.bag;\n        bag.minimum = def.length;\n        bag.maximum = def.length;\n        bag.length = def.length;\n    });\n    inst._zod.check = (payload) => {\n        const input = payload.value;\n        const length = input.length;\n        if (length === def.length)\n            return;\n        const origin = util.getLengthableOrigin(input);\n        const tooBig = length > def.length;\n        payload.issues.push({\n            origin,\n            ...(tooBig ? { code: \"too_big\", maximum: def.length } : { code: \"too_small\", minimum: def.length }),\n            inclusive: true,\n            exact: true,\n            input: payload.value,\n            inst,\n            continue: !def.abort,\n        });\n    };\n});\nexport const $ZodCheckStringFormat = /*@__PURE__*/ core.$constructor(\"$ZodCheckStringFormat\", (inst, def) => {\n    var _a, _b;\n    $ZodCheck.init(inst, def);\n    inst._zod.onattach.push((inst) => {\n        const bag = inst._zod.bag;\n        bag.format = def.format;\n        if (def.pattern) {\n            bag.patterns ?? (bag.patterns = new Set());\n            bag.patterns.add(def.pattern);\n        }\n    });\n    if (def.pattern)\n        (_a = inst._zod).check ?? (_a.check = (payload) => {\n            def.pattern.lastIndex = 0;\n            if (def.pattern.test(payload.value))\n                return;\n            payload.issues.push({\n                origin: \"string\",\n                code: \"invalid_format\",\n                format: def.format,\n                input: payload.value,\n                ...(def.pattern ? { pattern: def.pattern.toString() } : {}),\n                inst,\n                continue: !def.abort,\n            });\n        });\n    else\n        (_b = inst._zod).check ?? (_b.check = () => { });\n});\nexport const $ZodCheckRegex = /*@__PURE__*/ core.$constructor(\"$ZodCheckRegex\", (inst, def) => {\n    $ZodCheckStringFormat.init(inst, def);\n    inst._zod.check = (payload) => {\n        def.pattern.lastIndex = 0;\n        if (def.pattern.test(payload.value))\n            return;\n        payload.issues.push({\n            origin: \"string\",\n            code: \"invalid_format\",\n            format: \"regex\",\n            input: payload.value,\n            pattern: def.pattern.toString(),\n            inst,\n            continue: !def.abort,\n        });\n    };\n});\nexport const $ZodCheckLowerCase = /*@__PURE__*/ core.$constructor(\"$ZodCheckLowerCase\", (inst, def) => {\n    def.pattern ?? (def.pattern = regexes.lowercase);\n    $ZodCheckStringFormat.init(inst, def);\n});\nexport const $ZodCheckUpperCase = /*@__PURE__*/ core.$constructor(\"$ZodCheckUpperCase\", (inst, def) => {\n    def.pattern ?? (def.pattern = regexes.uppercase);\n    $ZodCheckStringFormat.init(inst, def);\n});\nexport const $ZodCheckIncludes = /*@__PURE__*/ core.$constructor(\"$ZodCheckIncludes\", (inst, def) => {\n    $ZodCheck.init(inst, def);\n    const escapedRegex = util.escapeRegex(def.includes);\n    const pattern = new RegExp(typeof def.position === \"number\" ? `^.{${def.position}}${escapedRegex}` : escapedRegex);\n    def.pattern = pattern;\n    inst._zod.onattach.push((inst) => {\n        const bag = inst._zod.bag;\n        bag.patterns ?? (bag.patterns = new Set());\n        bag.patterns.add(pattern);\n    });\n    inst._zod.check = (payload) => {\n        if (payload.value.includes(def.includes, def.position))\n            return;\n        payload.issues.push({\n            origin: \"string\",\n            code: \"invalid_format\",\n            format: \"includes\",\n            includes: def.includes,\n            input: payload.value,\n            inst,\n            continue: !def.abort,\n        });\n    };\n});\nexport const $ZodCheckStartsWith = /*@__PURE__*/ core.$constructor(\"$ZodCheckStartsWith\", (inst, def) => {\n    $ZodCheck.init(inst, def);\n    const pattern = new RegExp(`^${util.escapeRegex(def.prefix)}.*`);\n    def.pattern ?? (def.pattern = pattern);\n    inst._zod.onattach.push((inst) => {\n        const bag = inst._zod.bag;\n        bag.patterns ?? (bag.patterns = new Set());\n        bag.patterns.add(pattern);\n    });\n    inst._zod.check = (payload) => {\n        if (payload.value.startsWith(def.prefix))\n            return;\n        payload.issues.push({\n            origin: \"string\",\n            code: \"invalid_format\",\n            format: \"starts_with\",\n            prefix: def.prefix,\n            input: payload.value,\n            inst,\n            continue: !def.abort,\n        });\n    };\n});\nexport const $ZodCheckEndsWith = /*@__PURE__*/ core.$constructor(\"$ZodCheckEndsWith\", (inst, def) => {\n    $ZodCheck.init(inst, def);\n    const pattern = new RegExp(`.*${util.escapeRegex(def.suffix)}$`);\n    def.pattern ?? (def.pattern = pattern);\n    inst._zod.onattach.push((inst) => {\n        const bag = inst._zod.bag;\n        bag.patterns ?? (bag.patterns = new Set());\n        bag.patterns.add(pattern);\n    });\n    inst._zod.check = (payload) => {\n        if (payload.value.endsWith(def.suffix))\n            return;\n        payload.issues.push({\n            origin: \"string\",\n            code: \"invalid_format\",\n            format: \"ends_with\",\n            suffix: def.suffix,\n            input: payload.value,\n            inst,\n            continue: !def.abort,\n        });\n    };\n});\n///////////////////////////////////\n/////    $ZodCheckProperty    /////\n///////////////////////////////////\nfunction handleCheckPropertyResult(result, payload, property) {\n    if (result.issues.length) {\n        payload.issues.push(...util.prefixIssues(property, result.issues));\n    }\n}\nexport const $ZodCheckProperty = /*@__PURE__*/ core.$constructor(\"$ZodCheckProperty\", (inst, def) => {\n    $ZodCheck.init(inst, def);\n    inst._zod.check = (payload) => {\n        const result = def.schema._zod.run({\n            value: payload.value[def.property],\n            issues: [],\n        }, {});\n        if (result instanceof Promise) {\n            return result.then((result) => handleCheckPropertyResult(result, payload, def.property));\n        }\n        handleCheckPropertyResult(result, payload, def.property);\n        return;\n    };\n});\nexport const $ZodCheckMimeType = /*@__PURE__*/ core.$constructor(\"$ZodCheckMimeType\", (inst, def) => {\n    $ZodCheck.init(inst, def);\n    const mimeSet = new Set(def.mime);\n    inst._zod.onattach.push((inst) => {\n        inst._zod.bag.mime = def.mime;\n    });\n    inst._zod.check = (payload) => {\n        if (mimeSet.has(payload.value.type))\n            return;\n        payload.issues.push({\n            code: \"invalid_value\",\n            values: def.mime,\n            input: payload.value.type,\n            inst,\n            continue: !def.abort,\n        });\n    };\n});\nexport const $ZodCheckOverwrite = /*@__PURE__*/ core.$constructor(\"$ZodCheckOverwrite\", (inst, def) => {\n    $ZodCheck.init(inst, def);\n    inst._zod.check = (payload) => {\n        payload.value = def.tx(payload.value);\n    };\n});\n","export class Doc {\n    constructor(args = []) {\n        this.content = [];\n        this.indent = 0;\n        if (this)\n            this.args = args;\n    }\n    indented(fn) {\n        this.indent += 1;\n        fn(this);\n        this.indent -= 1;\n    }\n    write(arg) {\n        if (typeof arg === \"function\") {\n            arg(this, { execution: \"sync\" });\n            arg(this, { execution: \"async\" });\n            return;\n        }\n        const content = arg;\n        const lines = content.split(\"\\n\").filter((x) => x);\n        const minIndent = Math.min(...lines.map((x) => x.length - x.trimStart().length));\n        const dedented = lines.map((x) => x.slice(minIndent)).map((x) => \" \".repeat(this.indent * 2) + x);\n        for (const line of dedented) {\n            this.content.push(line);\n        }\n    }\n    compile() {\n        const F = Function;\n        const args = this?.args;\n        const content = this?.content ?? [``];\n        const lines = [...content.map((x) => `  ${x}`)];\n        // console.log(lines.join(\"\\n\"));\n        return new F(...args, lines.join(\"\\n\"));\n    }\n}\n","export const version = {\n    major: 4,\n    minor: 3,\n    patch: 6,\n};\n","import * as checks from \"./checks.js\";\nimport * as core from \"./core.js\";\nimport { Doc } from \"./doc.js\";\nimport { parse, parseAsync, safeParse, safeParseAsync } from \"./parse.js\";\nimport * as regexes from \"./regexes.js\";\nimport * as util from \"./util.js\";\nimport { version } from \"./versions.js\";\nexport const $ZodType = /*@__PURE__*/ core.$constructor(\"$ZodType\", (inst, def) => {\n    var _a;\n    inst ?? (inst = {});\n    inst._zod.def = def; // set _def property\n    inst._zod.bag = inst._zod.bag || {}; // initialize _bag object\n    inst._zod.version = version;\n    const checks = [...(inst._zod.def.checks ?? [])];\n    // if inst is itself a checks.$ZodCheck, run it as a check\n    if (inst._zod.traits.has(\"$ZodCheck\")) {\n        checks.unshift(inst);\n    }\n    for (const ch of checks) {\n        for (const fn of ch._zod.onattach) {\n            fn(inst);\n        }\n    }\n    if (checks.length === 0) {\n        // deferred initializer\n        // inst._zod.parse is not yet defined\n        (_a = inst._zod).deferred ?? (_a.deferred = []);\n        inst._zod.deferred?.push(() => {\n            inst._zod.run = inst._zod.parse;\n        });\n    }\n    else {\n        const runChecks = (payload, checks, ctx) => {\n            let isAborted = util.aborted(payload);\n            let asyncResult;\n            for (const ch of checks) {\n                if (ch._zod.def.when) {\n                    const shouldRun = ch._zod.def.when(payload);\n                    if (!shouldRun)\n                        continue;\n                }\n                else if (isAborted) {\n                    continue;\n                }\n                const currLen = payload.issues.length;\n                const _ = ch._zod.check(payload);\n                if (_ instanceof Promise && ctx?.async === false) {\n                    throw new core.$ZodAsyncError();\n                }\n                if (asyncResult || _ instanceof Promise) {\n                    asyncResult = (asyncResult ?? Promise.resolve()).then(async () => {\n                        await _;\n                        const nextLen = payload.issues.length;\n                        if (nextLen === currLen)\n                            return;\n                        if (!isAborted)\n                            isAborted = util.aborted(payload, currLen);\n                    });\n                }\n                else {\n                    const nextLen = payload.issues.length;\n                    if (nextLen === currLen)\n                        continue;\n                    if (!isAborted)\n                        isAborted = util.aborted(payload, currLen);\n                }\n            }\n            if (asyncResult) {\n                return asyncResult.then(() => {\n                    return payload;\n                });\n            }\n            return payload;\n        };\n        const handleCanaryResult = (canary, payload, ctx) => {\n            // abort if the canary is aborted\n            if (util.aborted(canary)) {\n                canary.aborted = true;\n                return canary;\n            }\n            // run checks first, then\n            const checkResult = runChecks(payload, checks, ctx);\n            if (checkResult instanceof Promise) {\n                if (ctx.async === false)\n                    throw new core.$ZodAsyncError();\n                return checkResult.then((checkResult) => inst._zod.parse(checkResult, ctx));\n            }\n            return inst._zod.parse(checkResult, ctx);\n        };\n        inst._zod.run = (payload, ctx) => {\n            if (ctx.skipChecks) {\n                return inst._zod.parse(payload, ctx);\n            }\n            if (ctx.direction === \"backward\") {\n                // run canary\n                // initial pass (no checks)\n                const canary = inst._zod.parse({ value: payload.value, issues: [] }, { ...ctx, skipChecks: true });\n                if (canary instanceof Promise) {\n                    return canary.then((canary) => {\n                        return handleCanaryResult(canary, payload, ctx);\n                    });\n                }\n                return handleCanaryResult(canary, payload, ctx);\n            }\n            // forward\n            const result = inst._zod.parse(payload, ctx);\n            if (result instanceof Promise) {\n                if (ctx.async === false)\n                    throw new core.$ZodAsyncError();\n                return result.then((result) => runChecks(result, checks, ctx));\n            }\n            return runChecks(result, checks, ctx);\n        };\n    }\n    // Lazy initialize ~standard to avoid creating objects for every schema\n    util.defineLazy(inst, \"~standard\", () => ({\n        validate: (value) => {\n            try {\n                const r = safeParse(inst, value);\n                return r.success ? { value: r.data } : { issues: r.error?.issues };\n            }\n            catch (_) {\n                return safeParseAsync(inst, value).then((r) => (r.success ? { value: r.data } : { issues: r.error?.issues }));\n            }\n        },\n        vendor: \"zod\",\n        version: 1,\n    }));\n});\nexport { clone } from \"./util.js\";\nexport const $ZodString = /*@__PURE__*/ core.$constructor(\"$ZodString\", (inst, def) => {\n    $ZodType.init(inst, def);\n    inst._zod.pattern = [...(inst?._zod.bag?.patterns ?? [])].pop() ?? regexes.string(inst._zod.bag);\n    inst._zod.parse = (payload, _) => {\n        if (def.coerce)\n            try {\n                payload.value = String(payload.value);\n            }\n            catch (_) { }\n        if (typeof payload.value === \"string\")\n            return payload;\n        payload.issues.push({\n            expected: \"string\",\n            code: \"invalid_type\",\n            input: payload.value,\n            inst,\n        });\n        return payload;\n    };\n});\nexport const $ZodStringFormat = /*@__PURE__*/ core.$constructor(\"$ZodStringFormat\", (inst, def) => {\n    // check initialization must come first\n    checks.$ZodCheckStringFormat.init(inst, def);\n    $ZodString.init(inst, def);\n});\nexport const $ZodGUID = /*@__PURE__*/ core.$constructor(\"$ZodGUID\", (inst, def) => {\n    def.pattern ?? (def.pattern = regexes.guid);\n    $ZodStringFormat.init(inst, def);\n});\nexport const $ZodUUID = /*@__PURE__*/ core.$constructor(\"$ZodUUID\", (inst, def) => {\n    if (def.version) {\n        const versionMap = {\n            v1: 1,\n            v2: 2,\n            v3: 3,\n            v4: 4,\n            v5: 5,\n            v6: 6,\n            v7: 7,\n            v8: 8,\n        };\n        const v = versionMap[def.version];\n        if (v === undefined)\n            throw new Error(`Invalid UUID version: \"${def.version}\"`);\n        def.pattern ?? (def.pattern = regexes.uuid(v));\n    }\n    else\n        def.pattern ?? (def.pattern = regexes.uuid());\n    $ZodStringFormat.init(inst, def);\n});\nexport const $ZodEmail = /*@__PURE__*/ core.$constructor(\"$ZodEmail\", (inst, def) => {\n    def.pattern ?? (def.pattern = regexes.email);\n    $ZodStringFormat.init(inst, def);\n});\nexport const $ZodURL = /*@__PURE__*/ core.$constructor(\"$ZodURL\", (inst, def) => {\n    $ZodStringFormat.init(inst, def);\n    inst._zod.check = (payload) => {\n        try {\n            // Trim whitespace from input\n            const trimmed = payload.value.trim();\n            // @ts-ignore\n            const url = new URL(trimmed);\n            if (def.hostname) {\n                def.hostname.lastIndex = 0;\n                if (!def.hostname.test(url.hostname)) {\n                    payload.issues.push({\n                        code: \"invalid_format\",\n                        format: \"url\",\n                        note: \"Invalid hostname\",\n                        pattern: def.hostname.source,\n                        input: payload.value,\n                        inst,\n                        continue: !def.abort,\n                    });\n                }\n            }\n            if (def.protocol) {\n                def.protocol.lastIndex = 0;\n                if (!def.protocol.test(url.protocol.endsWith(\":\") ? url.protocol.slice(0, -1) : url.protocol)) {\n                    payload.issues.push({\n                        code: \"invalid_format\",\n                        format: \"url\",\n                        note: \"Invalid protocol\",\n                        pattern: def.protocol.source,\n                        input: payload.value,\n                        inst,\n                        continue: !def.abort,\n                    });\n                }\n            }\n            // Set the output value based on normalize flag\n            if (def.normalize) {\n                // Use normalized URL\n                payload.value = url.href;\n            }\n            else {\n                // Preserve the original input (trimmed)\n                payload.value = trimmed;\n            }\n            return;\n        }\n        catch (_) {\n            payload.issues.push({\n                code: \"invalid_format\",\n                format: \"url\",\n                input: payload.value,\n                inst,\n                continue: !def.abort,\n            });\n        }\n    };\n});\nexport const $ZodEmoji = /*@__PURE__*/ core.$constructor(\"$ZodEmoji\", (inst, def) => {\n    def.pattern ?? (def.pattern = regexes.emoji());\n    $ZodStringFormat.init(inst, def);\n});\nexport const $ZodNanoID = /*@__PURE__*/ core.$constructor(\"$ZodNanoID\", (inst, def) => {\n    def.pattern ?? (def.pattern = regexes.nanoid);\n    $ZodStringFormat.init(inst, def);\n});\nexport const $ZodCUID = /*@__PURE__*/ core.$constructor(\"$ZodCUID\", (inst, def) => {\n    def.pattern ?? (def.pattern = regexes.cuid);\n    $ZodStringFormat.init(inst, def);\n});\nexport const $ZodCUID2 = /*@__PURE__*/ core.$constructor(\"$ZodCUID2\", (inst, def) => {\n    def.pattern ?? (def.pattern = regexes.cuid2);\n    $ZodStringFormat.init(inst, def);\n});\nexport const $ZodULID = /*@__PURE__*/ core.$constructor(\"$ZodULID\", (inst, def) => {\n    def.pattern ?? (def.pattern = regexes.ulid);\n    $ZodStringFormat.init(inst, def);\n});\nexport const $ZodXID = /*@__PURE__*/ core.$constructor(\"$ZodXID\", (inst, def) => {\n    def.pattern ?? (def.pattern = regexes.xid);\n    $ZodStringFormat.init(inst, def);\n});\nexport const $ZodKSUID = /*@__PURE__*/ core.$constructor(\"$ZodKSUID\", (inst, def) => {\n    def.pattern ?? (def.pattern = regexes.ksuid);\n    $ZodStringFormat.init(inst, def);\n});\nexport const $ZodISODateTime = /*@__PURE__*/ core.$constructor(\"$ZodISODateTime\", (inst, def) => {\n    def.pattern ?? (def.pattern = regexes.datetime(def));\n    $ZodStringFormat.init(inst, def);\n});\nexport const $ZodISODate = /*@__PURE__*/ core.$constructor(\"$ZodISODate\", (inst, def) => {\n    def.pattern ?? (def.pattern = regexes.date);\n    $ZodStringFormat.init(inst, def);\n});\nexport const $ZodISOTime = /*@__PURE__*/ core.$constructor(\"$ZodISOTime\", (inst, def) => {\n    def.pattern ?? (def.pattern = regexes.time(def));\n    $ZodStringFormat.init(inst, def);\n});\nexport const $ZodISODuration = /*@__PURE__*/ core.$constructor(\"$ZodISODuration\", (inst, def) => {\n    def.pattern ?? (def.pattern = regexes.duration);\n    $ZodStringFormat.init(inst, def);\n});\nexport const $ZodIPv4 = /*@__PURE__*/ core.$constructor(\"$ZodIPv4\", (inst, def) => {\n    def.pattern ?? (def.pattern = regexes.ipv4);\n    $ZodStringFormat.init(inst, def);\n    inst._zod.bag.format = `ipv4`;\n});\nexport const $ZodIPv6 = /*@__PURE__*/ core.$constructor(\"$ZodIPv6\", (inst, def) => {\n    def.pattern ?? (def.pattern = regexes.ipv6);\n    $ZodStringFormat.init(inst, def);\n    inst._zod.bag.format = `ipv6`;\n    inst._zod.check = (payload) => {\n        try {\n            // @ts-ignore\n            new URL(`http://[${payload.value}]`);\n            // return;\n        }\n        catch {\n            payload.issues.push({\n                code: \"invalid_format\",\n                format: \"ipv6\",\n                input: payload.value,\n                inst,\n                continue: !def.abort,\n            });\n        }\n    };\n});\nexport const $ZodMAC = /*@__PURE__*/ core.$constructor(\"$ZodMAC\", (inst, def) => {\n    def.pattern ?? (def.pattern = regexes.mac(def.delimiter));\n    $ZodStringFormat.init(inst, def);\n    inst._zod.bag.format = `mac`;\n});\nexport const $ZodCIDRv4 = /*@__PURE__*/ core.$constructor(\"$ZodCIDRv4\", (inst, def) => {\n    def.pattern ?? (def.pattern = regexes.cidrv4);\n    $ZodStringFormat.init(inst, def);\n});\nexport const $ZodCIDRv6 = /*@__PURE__*/ core.$constructor(\"$ZodCIDRv6\", (inst, def) => {\n    def.pattern ?? (def.pattern = regexes.cidrv6); // not used for validation\n    $ZodStringFormat.init(inst, def);\n    inst._zod.check = (payload) => {\n        const parts = payload.value.split(\"/\");\n        try {\n            if (parts.length !== 2)\n                throw new Error();\n            const [address, prefix] = parts;\n            if (!prefix)\n                throw new Error();\n            const prefixNum = Number(prefix);\n            if (`${prefixNum}` !== prefix)\n                throw new Error();\n            if (prefixNum < 0 || prefixNum > 128)\n                throw new Error();\n            // @ts-ignore\n            new URL(`http://[${address}]`);\n        }\n        catch {\n            payload.issues.push({\n                code: \"invalid_format\",\n                format: \"cidrv6\",\n                input: payload.value,\n                inst,\n                continue: !def.abort,\n            });\n        }\n    };\n});\n//////////////////////////////   ZodBase64   //////////////////////////////\nexport function isValidBase64(data) {\n    if (data === \"\")\n        return true;\n    if (data.length % 4 !== 0)\n        return false;\n    try {\n        // @ts-ignore\n        atob(data);\n        return true;\n    }\n    catch {\n        return false;\n    }\n}\nexport const $ZodBase64 = /*@__PURE__*/ core.$constructor(\"$ZodBase64\", (inst, def) => {\n    def.pattern ?? (def.pattern = regexes.base64);\n    $ZodStringFormat.init(inst, def);\n    inst._zod.bag.contentEncoding = \"base64\";\n    inst._zod.check = (payload) => {\n        if (isValidBase64(payload.value))\n            return;\n        payload.issues.push({\n            code: \"invalid_format\",\n            format: \"base64\",\n            input: payload.value,\n            inst,\n            continue: !def.abort,\n        });\n    };\n});\n//////////////////////////////   ZodBase64   //////////////////////////////\nexport function isValidBase64URL(data) {\n    if (!regexes.base64url.test(data))\n        return false;\n    const base64 = data.replace(/[-_]/g, (c) => (c === \"-\" ? \"+\" : \"/\"));\n    const padded = base64.padEnd(Math.ceil(base64.length / 4) * 4, \"=\");\n    return isValidBase64(padded);\n}\nexport const $ZodBase64URL = /*@__PURE__*/ core.$constructor(\"$ZodBase64URL\", (inst, def) => {\n    def.pattern ?? (def.pattern = regexes.base64url);\n    $ZodStringFormat.init(inst, def);\n    inst._zod.bag.contentEncoding = \"base64url\";\n    inst._zod.check = (payload) => {\n        if (isValidBase64URL(payload.value))\n            return;\n        payload.issues.push({\n            code: \"invalid_format\",\n            format: \"base64url\",\n            input: payload.value,\n            inst,\n            continue: !def.abort,\n        });\n    };\n});\nexport const $ZodE164 = /*@__PURE__*/ core.$constructor(\"$ZodE164\", (inst, def) => {\n    def.pattern ?? (def.pattern = regexes.e164);\n    $ZodStringFormat.init(inst, def);\n});\n//////////////////////////////   ZodJWT   //////////////////////////////\nexport function isValidJWT(token, algorithm = null) {\n    try {\n        const tokensParts = token.split(\".\");\n        if (tokensParts.length !== 3)\n            return false;\n        const [header] = tokensParts;\n        if (!header)\n            return false;\n        // @ts-ignore\n        const parsedHeader = JSON.parse(atob(header));\n        if (\"typ\" in parsedHeader && parsedHeader?.typ !== \"JWT\")\n            return false;\n        if (!parsedHeader.alg)\n            return false;\n        if (algorithm && (!(\"alg\" in parsedHeader) || parsedHeader.alg !== algorithm))\n            return false;\n        return true;\n    }\n    catch {\n        return false;\n    }\n}\nexport const $ZodJWT = /*@__PURE__*/ core.$constructor(\"$ZodJWT\", (inst, def) => {\n    $ZodStringFormat.init(inst, def);\n    inst._zod.check = (payload) => {\n        if (isValidJWT(payload.value, def.alg))\n            return;\n        payload.issues.push({\n            code: \"invalid_format\",\n            format: \"jwt\",\n            input: payload.value,\n            inst,\n            continue: !def.abort,\n        });\n    };\n});\nexport const $ZodCustomStringFormat = /*@__PURE__*/ core.$constructor(\"$ZodCustomStringFormat\", (inst, def) => {\n    $ZodStringFormat.init(inst, def);\n    inst._zod.check = (payload) => {\n        if (def.fn(payload.value))\n            return;\n        payload.issues.push({\n            code: \"invalid_format\",\n            format: def.format,\n            input: payload.value,\n            inst,\n            continue: !def.abort,\n        });\n    };\n});\nexport const $ZodNumber = /*@__PURE__*/ core.$constructor(\"$ZodNumber\", (inst, def) => {\n    $ZodType.init(inst, def);\n    inst._zod.pattern = inst._zod.bag.pattern ?? regexes.number;\n    inst._zod.parse = (payload, _ctx) => {\n        if (def.coerce)\n            try {\n                payload.value = Number(payload.value);\n            }\n            catch (_) { }\n        const input = payload.value;\n        if (typeof input === \"number\" && !Number.isNaN(input) && Number.isFinite(input)) {\n            return payload;\n        }\n        const received = typeof input === \"number\"\n            ? Number.isNaN(input)\n                ? \"NaN\"\n                : !Number.isFinite(input)\n                    ? \"Infinity\"\n                    : undefined\n            : undefined;\n        payload.issues.push({\n            expected: \"number\",\n            code: \"invalid_type\",\n            input,\n            inst,\n            ...(received ? { received } : {}),\n        });\n        return payload;\n    };\n});\nexport const $ZodNumberFormat = /*@__PURE__*/ core.$constructor(\"$ZodNumberFormat\", (inst, def) => {\n    checks.$ZodCheckNumberFormat.init(inst, def);\n    $ZodNumber.init(inst, def); // no format checks\n});\nexport const $ZodBoolean = /*@__PURE__*/ core.$constructor(\"$ZodBoolean\", (inst, def) => {\n    $ZodType.init(inst, def);\n    inst._zod.pattern = regexes.boolean;\n    inst._zod.parse = (payload, _ctx) => {\n        if (def.coerce)\n            try {\n                payload.value = Boolean(payload.value);\n            }\n            catch (_) { }\n        const input = payload.value;\n        if (typeof input === \"boolean\")\n            return payload;\n        payload.issues.push({\n            expected: \"boolean\",\n            code: \"invalid_type\",\n            input,\n            inst,\n        });\n        return payload;\n    };\n});\nexport const $ZodBigInt = /*@__PURE__*/ core.$constructor(\"$ZodBigInt\", (inst, def) => {\n    $ZodType.init(inst, def);\n    inst._zod.pattern = regexes.bigint;\n    inst._zod.parse = (payload, _ctx) => {\n        if (def.coerce)\n            try {\n                payload.value = BigInt(payload.value);\n            }\n            catch (_) { }\n        if (typeof payload.value === \"bigint\")\n            return payload;\n        payload.issues.push({\n            expected: \"bigint\",\n            code: \"invalid_type\",\n            input: payload.value,\n            inst,\n        });\n        return payload;\n    };\n});\nexport const $ZodBigIntFormat = /*@__PURE__*/ core.$constructor(\"$ZodBigIntFormat\", (inst, def) => {\n    checks.$ZodCheckBigIntFormat.init(inst, def);\n    $ZodBigInt.init(inst, def); // no format checks\n});\nexport const $ZodSymbol = /*@__PURE__*/ core.$constructor(\"$ZodSymbol\", (inst, def) => {\n    $ZodType.init(inst, def);\n    inst._zod.parse = (payload, _ctx) => {\n        const input = payload.value;\n        if (typeof input === \"symbol\")\n            return payload;\n        payload.issues.push({\n            expected: \"symbol\",\n            code: \"invalid_type\",\n            input,\n            inst,\n        });\n        return payload;\n    };\n});\nexport const $ZodUndefined = /*@__PURE__*/ core.$constructor(\"$ZodUndefined\", (inst, def) => {\n    $ZodType.init(inst, def);\n    inst._zod.pattern = regexes.undefined;\n    inst._zod.values = new Set([undefined]);\n    inst._zod.optin = \"optional\";\n    inst._zod.optout = \"optional\";\n    inst._zod.parse = (payload, _ctx) => {\n        const input = payload.value;\n        if (typeof input === \"undefined\")\n            return payload;\n        payload.issues.push({\n            expected: \"undefined\",\n            code: \"invalid_type\",\n            input,\n            inst,\n        });\n        return payload;\n    };\n});\nexport const $ZodNull = /*@__PURE__*/ core.$constructor(\"$ZodNull\", (inst, def) => {\n    $ZodType.init(inst, def);\n    inst._zod.pattern = regexes.null;\n    inst._zod.values = new Set([null]);\n    inst._zod.parse = (payload, _ctx) => {\n        const input = payload.value;\n        if (input === null)\n            return payload;\n        payload.issues.push({\n            expected: \"null\",\n            code: \"invalid_type\",\n            input,\n            inst,\n        });\n        return payload;\n    };\n});\nexport const $ZodAny = /*@__PURE__*/ core.$constructor(\"$ZodAny\", (inst, def) => {\n    $ZodType.init(inst, def);\n    inst._zod.parse = (payload) => payload;\n});\nexport const $ZodUnknown = /*@__PURE__*/ core.$constructor(\"$ZodUnknown\", (inst, def) => {\n    $ZodType.init(inst, def);\n    inst._zod.parse = (payload) => payload;\n});\nexport const $ZodNever = /*@__PURE__*/ core.$constructor(\"$ZodNever\", (inst, def) => {\n    $ZodType.init(inst, def);\n    inst._zod.parse = (payload, _ctx) => {\n        payload.issues.push({\n            expected: \"never\",\n            code: \"invalid_type\",\n            input: payload.value,\n            inst,\n        });\n        return payload;\n    };\n});\nexport const $ZodVoid = /*@__PURE__*/ core.$constructor(\"$ZodVoid\", (inst, def) => {\n    $ZodType.init(inst, def);\n    inst._zod.parse = (payload, _ctx) => {\n        const input = payload.value;\n        if (typeof input === \"undefined\")\n            return payload;\n        payload.issues.push({\n            expected: \"void\",\n            code: \"invalid_type\",\n            input,\n            inst,\n        });\n        return payload;\n    };\n});\nexport const $ZodDate = /*@__PURE__*/ core.$constructor(\"$ZodDate\", (inst, def) => {\n    $ZodType.init(inst, def);\n    inst._zod.parse = (payload, _ctx) => {\n        if (def.coerce) {\n            try {\n                payload.value = new Date(payload.value);\n            }\n            catch (_err) { }\n        }\n        const input = payload.value;\n        const isDate = input instanceof Date;\n        const isValidDate = isDate && !Number.isNaN(input.getTime());\n        if (isValidDate)\n            return payload;\n        payload.issues.push({\n            expected: \"date\",\n            code: \"invalid_type\",\n            input,\n            ...(isDate ? { received: \"Invalid Date\" } : {}),\n            inst,\n        });\n        return payload;\n    };\n});\nfunction handleArrayResult(result, final, index) {\n    if (result.issues.length) {\n        final.issues.push(...util.prefixIssues(index, result.issues));\n    }\n    final.value[index] = result.value;\n}\nexport const $ZodArray = /*@__PURE__*/ core.$constructor(\"$ZodArray\", (inst, def) => {\n    $ZodType.init(inst, def);\n    inst._zod.parse = (payload, ctx) => {\n        const input = payload.value;\n        if (!Array.isArray(input)) {\n            payload.issues.push({\n                expected: \"array\",\n                code: \"invalid_type\",\n                input,\n                inst,\n            });\n            return payload;\n        }\n        payload.value = Array(input.length);\n        const proms = [];\n        for (let i = 0; i < input.length; i++) {\n            const item = input[i];\n            const result = def.element._zod.run({\n                value: item,\n                issues: [],\n            }, ctx);\n            if (result instanceof Promise) {\n                proms.push(result.then((result) => handleArrayResult(result, payload, i)));\n            }\n            else {\n                handleArrayResult(result, payload, i);\n            }\n        }\n        if (proms.length) {\n            return Promise.all(proms).then(() => payload);\n        }\n        return payload; //handleArrayResultsAsync(parseResults, final);\n    };\n});\nfunction handlePropertyResult(result, final, key, input, isOptionalOut) {\n    if (result.issues.length) {\n        // For optional-out schemas, ignore errors on absent keys\n        if (isOptionalOut && !(key in input)) {\n            return;\n        }\n        final.issues.push(...util.prefixIssues(key, result.issues));\n    }\n    if (result.value === undefined) {\n        if (key in input) {\n            final.value[key] = undefined;\n        }\n    }\n    else {\n        final.value[key] = result.value;\n    }\n}\nfunction normalizeDef(def) {\n    const keys = Object.keys(def.shape);\n    for (const k of keys) {\n        if (!def.shape?.[k]?._zod?.traits?.has(\"$ZodType\")) {\n            throw new Error(`Invalid element at key \"${k}\": expected a Zod schema`);\n        }\n    }\n    const okeys = util.optionalKeys(def.shape);\n    return {\n        ...def,\n        keys,\n        keySet: new Set(keys),\n        numKeys: keys.length,\n        optionalKeys: new Set(okeys),\n    };\n}\nfunction handleCatchall(proms, input, payload, ctx, def, inst) {\n    const unrecognized = [];\n    // iterate over input keys\n    const keySet = def.keySet;\n    const _catchall = def.catchall._zod;\n    const t = _catchall.def.type;\n    const isOptionalOut = _catchall.optout === \"optional\";\n    for (const key in input) {\n        if (keySet.has(key))\n            continue;\n        if (t === \"never\") {\n            unrecognized.push(key);\n            continue;\n        }\n        const r = _catchall.run({ value: input[key], issues: [] }, ctx);\n        if (r instanceof Promise) {\n            proms.push(r.then((r) => handlePropertyResult(r, payload, key, input, isOptionalOut)));\n        }\n        else {\n            handlePropertyResult(r, payload, key, input, isOptionalOut);\n        }\n    }\n    if (unrecognized.length) {\n        payload.issues.push({\n            code: \"unrecognized_keys\",\n            keys: unrecognized,\n            input,\n            inst,\n        });\n    }\n    if (!proms.length)\n        return payload;\n    return Promise.all(proms).then(() => {\n        return payload;\n    });\n}\nexport const $ZodObject = /*@__PURE__*/ core.$constructor(\"$ZodObject\", (inst, def) => {\n    // requires cast because technically $ZodObject doesn't extend\n    $ZodType.init(inst, def);\n    // const sh = def.shape;\n    const desc = Object.getOwnPropertyDescriptor(def, \"shape\");\n    if (!desc?.get) {\n        const sh = def.shape;\n        Object.defineProperty(def, \"shape\", {\n            get: () => {\n                const newSh = { ...sh };\n                Object.defineProperty(def, \"shape\", {\n                    value: newSh,\n                });\n                return newSh;\n            },\n        });\n    }\n    const _normalized = util.cached(() => normalizeDef(def));\n    util.defineLazy(inst._zod, \"propValues\", () => {\n        const shape = def.shape;\n        const propValues = {};\n        for (const key in shape) {\n            const field = shape[key]._zod;\n            if (field.values) {\n                propValues[key] ?? (propValues[key] = new Set());\n                for (const v of field.values)\n                    propValues[key].add(v);\n            }\n        }\n        return propValues;\n    });\n    const isObject = util.isObject;\n    const catchall = def.catchall;\n    let value;\n    inst._zod.parse = (payload, ctx) => {\n        value ?? (value = _normalized.value);\n        const input = payload.value;\n        if (!isObject(input)) {\n            payload.issues.push({\n                expected: \"object\",\n                code: \"invalid_type\",\n                input,\n                inst,\n            });\n            return payload;\n        }\n        payload.value = {};\n        const proms = [];\n        const shape = value.shape;\n        for (const key of value.keys) {\n            const el = shape[key];\n            const isOptionalOut = el._zod.optout === \"optional\";\n            const r = el._zod.run({ value: input[key], issues: [] }, ctx);\n            if (r instanceof Promise) {\n                proms.push(r.then((r) => handlePropertyResult(r, payload, key, input, isOptionalOut)));\n            }\n            else {\n                handlePropertyResult(r, payload, key, input, isOptionalOut);\n            }\n        }\n        if (!catchall) {\n            return proms.length ? Promise.all(proms).then(() => payload) : payload;\n        }\n        return handleCatchall(proms, input, payload, ctx, _normalized.value, inst);\n    };\n});\nexport const $ZodObjectJIT = /*@__PURE__*/ core.$constructor(\"$ZodObjectJIT\", (inst, def) => {\n    // requires cast because technically $ZodObject doesn't extend\n    $ZodObject.init(inst, def);\n    const superParse = inst._zod.parse;\n    const _normalized = util.cached(() => normalizeDef(def));\n    const generateFastpass = (shape) => {\n        const doc = new Doc([\"shape\", \"payload\", \"ctx\"]);\n        const normalized = _normalized.value;\n        const parseStr = (key) => {\n            const k = util.esc(key);\n            return `shape[${k}]._zod.run({ value: input[${k}], issues: [] }, ctx)`;\n        };\n        doc.write(`const input = payload.value;`);\n        const ids = Object.create(null);\n        let counter = 0;\n        for (const key of normalized.keys) {\n            ids[key] = `key_${counter++}`;\n        }\n        // A: preserve key order {\n        doc.write(`const newResult = {};`);\n        for (const key of normalized.keys) {\n            const id = ids[key];\n            const k = util.esc(key);\n            const schema = shape[key];\n            const isOptionalOut = schema?._zod?.optout === \"optional\";\n            doc.write(`const ${id} = ${parseStr(key)};`);\n            if (isOptionalOut) {\n                // For optional-out schemas, ignore errors on absent keys\n                doc.write(`\n        if (${id}.issues.length) {\n          if (${k} in input) {\n            payload.issues = payload.issues.concat(${id}.issues.map(iss => ({\n              ...iss,\n              path: iss.path ? [${k}, ...iss.path] : [${k}]\n            })));\n          }\n        }\n        \n        if (${id}.value === undefined) {\n          if (${k} in input) {\n            newResult[${k}] = undefined;\n          }\n        } else {\n          newResult[${k}] = ${id}.value;\n        }\n        \n      `);\n            }\n            else {\n                doc.write(`\n        if (${id}.issues.length) {\n          payload.issues = payload.issues.concat(${id}.issues.map(iss => ({\n            ...iss,\n            path: iss.path ? [${k}, ...iss.path] : [${k}]\n          })));\n        }\n        \n        if (${id}.value === undefined) {\n          if (${k} in input) {\n            newResult[${k}] = undefined;\n          }\n        } else {\n          newResult[${k}] = ${id}.value;\n        }\n        \n      `);\n            }\n        }\n        doc.write(`payload.value = newResult;`);\n        doc.write(`return payload;`);\n        const fn = doc.compile();\n        return (payload, ctx) => fn(shape, payload, ctx);\n    };\n    let fastpass;\n    const isObject = util.isObject;\n    const jit = !core.globalConfig.jitless;\n    const allowsEval = util.allowsEval;\n    const fastEnabled = jit && allowsEval.value; // && !def.catchall;\n    const catchall = def.catchall;\n    let value;\n    inst._zod.parse = (payload, ctx) => {\n        value ?? (value = _normalized.value);\n        const input = payload.value;\n        if (!isObject(input)) {\n            payload.issues.push({\n                expected: \"object\",\n                code: \"invalid_type\",\n                input,\n                inst,\n            });\n            return payload;\n        }\n        if (jit && fastEnabled && ctx?.async === false && ctx.jitless !== true) {\n            // always synchronous\n            if (!fastpass)\n                fastpass = generateFastpass(def.shape);\n            payload = fastpass(payload, ctx);\n            if (!catchall)\n                return payload;\n            return handleCatchall([], input, payload, ctx, value, inst);\n        }\n        return superParse(payload, ctx);\n    };\n});\nfunction handleUnionResults(results, final, inst, ctx) {\n    for (const result of results) {\n        if (result.issues.length === 0) {\n            final.value = result.value;\n            return final;\n        }\n    }\n    const nonaborted = results.filter((r) => !util.aborted(r));\n    if (nonaborted.length === 1) {\n        final.value = nonaborted[0].value;\n        return nonaborted[0];\n    }\n    final.issues.push({\n        code: \"invalid_union\",\n        input: final.value,\n        inst,\n        errors: results.map((result) => result.issues.map((iss) => util.finalizeIssue(iss, ctx, core.config()))),\n    });\n    return final;\n}\nexport const $ZodUnion = /*@__PURE__*/ core.$constructor(\"$ZodUnion\", (inst, def) => {\n    $ZodType.init(inst, def);\n    util.defineLazy(inst._zod, \"optin\", () => def.options.some((o) => o._zod.optin === \"optional\") ? \"optional\" : undefined);\n    util.defineLazy(inst._zod, \"optout\", () => def.options.some((o) => o._zod.optout === \"optional\") ? \"optional\" : undefined);\n    util.defineLazy(inst._zod, \"values\", () => {\n        if (def.options.every((o) => o._zod.values)) {\n            return new Set(def.options.flatMap((option) => Array.from(option._zod.values)));\n        }\n        return undefined;\n    });\n    util.defineLazy(inst._zod, \"pattern\", () => {\n        if (def.options.every((o) => o._zod.pattern)) {\n            const patterns = def.options.map((o) => o._zod.pattern);\n            return new RegExp(`^(${patterns.map((p) => util.cleanRegex(p.source)).join(\"|\")})$`);\n        }\n        return undefined;\n    });\n    const single = def.options.length === 1;\n    const first = def.options[0]._zod.run;\n    inst._zod.parse = (payload, ctx) => {\n        if (single) {\n            return first(payload, ctx);\n        }\n        let async = false;\n        const results = [];\n        for (const option of def.options) {\n            const result = option._zod.run({\n                value: payload.value,\n                issues: [],\n            }, ctx);\n            if (result instanceof Promise) {\n                results.push(result);\n                async = true;\n            }\n            else {\n                if (result.issues.length === 0)\n                    return result;\n                results.push(result);\n            }\n        }\n        if (!async)\n            return handleUnionResults(results, payload, inst, ctx);\n        return Promise.all(results).then((results) => {\n            return handleUnionResults(results, payload, inst, ctx);\n        });\n    };\n});\nfunction handleExclusiveUnionResults(results, final, inst, ctx) {\n    const successes = results.filter((r) => r.issues.length === 0);\n    if (successes.length === 1) {\n        final.value = successes[0].value;\n        return final;\n    }\n    if (successes.length === 0) {\n        // No matches - same as regular union\n        final.issues.push({\n            code: \"invalid_union\",\n            input: final.value,\n            inst,\n            errors: results.map((result) => result.issues.map((iss) => util.finalizeIssue(iss, ctx, core.config()))),\n        });\n    }\n    else {\n        // Multiple matches - exclusive union failure\n        final.issues.push({\n            code: \"invalid_union\",\n            input: final.value,\n            inst,\n            errors: [],\n            inclusive: false,\n        });\n    }\n    return final;\n}\nexport const $ZodXor = /*@__PURE__*/ core.$constructor(\"$ZodXor\", (inst, def) => {\n    $ZodUnion.init(inst, def);\n    def.inclusive = false;\n    const single = def.options.length === 1;\n    const first = def.options[0]._zod.run;\n    inst._zod.parse = (payload, ctx) => {\n        if (single) {\n            return first(payload, ctx);\n        }\n        let async = false;\n        const results = [];\n        for (const option of def.options) {\n            const result = option._zod.run({\n                value: payload.value,\n                issues: [],\n            }, ctx);\n            if (result instanceof Promise) {\n                results.push(result);\n                async = true;\n            }\n            else {\n                results.push(result);\n            }\n        }\n        if (!async)\n            return handleExclusiveUnionResults(results, payload, inst, ctx);\n        return Promise.all(results).then((results) => {\n            return handleExclusiveUnionResults(results, payload, inst, ctx);\n        });\n    };\n});\nexport const $ZodDiscriminatedUnion = \n/*@__PURE__*/\ncore.$constructor(\"$ZodDiscriminatedUnion\", (inst, def) => {\n    def.inclusive = false;\n    $ZodUnion.init(inst, def);\n    const _super = inst._zod.parse;\n    util.defineLazy(inst._zod, \"propValues\", () => {\n        const propValues = {};\n        for (const option of def.options) {\n            const pv = option._zod.propValues;\n            if (!pv || Object.keys(pv).length === 0)\n                throw new Error(`Invalid discriminated union option at index \"${def.options.indexOf(option)}\"`);\n            for (const [k, v] of Object.entries(pv)) {\n                if (!propValues[k])\n                    propValues[k] = new Set();\n                for (const val of v) {\n                    propValues[k].add(val);\n                }\n            }\n        }\n        return propValues;\n    });\n    const disc = util.cached(() => {\n        const opts = def.options;\n        const map = new Map();\n        for (const o of opts) {\n            const values = o._zod.propValues?.[def.discriminator];\n            if (!values || values.size === 0)\n                throw new Error(`Invalid discriminated union option at index \"${def.options.indexOf(o)}\"`);\n            for (const v of values) {\n                if (map.has(v)) {\n                    throw new Error(`Duplicate discriminator value \"${String(v)}\"`);\n                }\n                map.set(v, o);\n            }\n        }\n        return map;\n    });\n    inst._zod.parse = (payload, ctx) => {\n        const input = payload.value;\n        if (!util.isObject(input)) {\n            payload.issues.push({\n                code: \"invalid_type\",\n                expected: \"object\",\n                input,\n                inst,\n            });\n            return payload;\n        }\n        const opt = disc.value.get(input?.[def.discriminator]);\n        if (opt) {\n            return opt._zod.run(payload, ctx);\n        }\n        if (def.unionFallback) {\n            return _super(payload, ctx);\n        }\n        // no matching discriminator\n        payload.issues.push({\n            code: \"invalid_union\",\n            errors: [],\n            note: \"No matching discriminator\",\n            discriminator: def.discriminator,\n            input,\n            path: [def.discriminator],\n            inst,\n        });\n        return payload;\n    };\n});\nexport const $ZodIntersection = /*@__PURE__*/ core.$constructor(\"$ZodIntersection\", (inst, def) => {\n    $ZodType.init(inst, def);\n    inst._zod.parse = (payload, ctx) => {\n        const input = payload.value;\n        const left = def.left._zod.run({ value: input, issues: [] }, ctx);\n        const right = def.right._zod.run({ value: input, issues: [] }, ctx);\n        const async = left instanceof Promise || right instanceof Promise;\n        if (async) {\n            return Promise.all([left, right]).then(([left, right]) => {\n                return handleIntersectionResults(payload, left, right);\n            });\n        }\n        return handleIntersectionResults(payload, left, right);\n    };\n});\nfunction mergeValues(a, b) {\n    // const aType = parse.t(a);\n    // const bType = parse.t(b);\n    if (a === b) {\n        return { valid: true, data: a };\n    }\n    if (a instanceof Date && b instanceof Date && +a === +b) {\n        return { valid: true, data: a };\n    }\n    if (util.isPlainObject(a) && util.isPlainObject(b)) {\n        const bKeys = Object.keys(b);\n        const sharedKeys = Object.keys(a).filter((key) => bKeys.indexOf(key) !== -1);\n        const newObj = { ...a, ...b };\n        for (const key of sharedKeys) {\n            const sharedValue = mergeValues(a[key], b[key]);\n            if (!sharedValue.valid) {\n                return {\n                    valid: false,\n                    mergeErrorPath: [key, ...sharedValue.mergeErrorPath],\n                };\n            }\n            newObj[key] = sharedValue.data;\n        }\n        return { valid: true, data: newObj };\n    }\n    if (Array.isArray(a) && Array.isArray(b)) {\n        if (a.length !== b.length) {\n            return { valid: false, mergeErrorPath: [] };\n        }\n        const newArray = [];\n        for (let index = 0; index < a.length; index++) {\n            const itemA = a[index];\n            const itemB = b[index];\n            const sharedValue = mergeValues(itemA, itemB);\n            if (!sharedValue.valid) {\n                return {\n                    valid: false,\n                    mergeErrorPath: [index, ...sharedValue.mergeErrorPath],\n                };\n            }\n            newArray.push(sharedValue.data);\n        }\n        return { valid: true, data: newArray };\n    }\n    return { valid: false, mergeErrorPath: [] };\n}\nfunction handleIntersectionResults(result, left, right) {\n    // Track which side(s) report each key as unrecognized\n    const unrecKeys = new Map();\n    let unrecIssue;\n    for (const iss of left.issues) {\n        if (iss.code === \"unrecognized_keys\") {\n            unrecIssue ?? (unrecIssue = iss);\n            for (const k of iss.keys) {\n                if (!unrecKeys.has(k))\n                    unrecKeys.set(k, {});\n                unrecKeys.get(k).l = true;\n            }\n        }\n        else {\n            result.issues.push(iss);\n        }\n    }\n    for (const iss of right.issues) {\n        if (iss.code === \"unrecognized_keys\") {\n            for (const k of iss.keys) {\n                if (!unrecKeys.has(k))\n                    unrecKeys.set(k, {});\n                unrecKeys.get(k).r = true;\n            }\n        }\n        else {\n            result.issues.push(iss);\n        }\n    }\n    // Report only keys unrecognized by BOTH sides\n    const bothKeys = [...unrecKeys].filter(([, f]) => f.l && f.r).map(([k]) => k);\n    if (bothKeys.length && unrecIssue) {\n        result.issues.push({ ...unrecIssue, keys: bothKeys });\n    }\n    if (util.aborted(result))\n        return result;\n    const merged = mergeValues(left.value, right.value);\n    if (!merged.valid) {\n        throw new Error(`Unmergable intersection. Error path: ` + `${JSON.stringify(merged.mergeErrorPath)}`);\n    }\n    result.value = merged.data;\n    return result;\n}\nexport const $ZodTuple = /*@__PURE__*/ core.$constructor(\"$ZodTuple\", (inst, def) => {\n    $ZodType.init(inst, def);\n    const items = def.items;\n    inst._zod.parse = (payload, ctx) => {\n        const input = payload.value;\n        if (!Array.isArray(input)) {\n            payload.issues.push({\n                input,\n                inst,\n                expected: \"tuple\",\n                code: \"invalid_type\",\n            });\n            return payload;\n        }\n        payload.value = [];\n        const proms = [];\n        const reversedIndex = [...items].reverse().findIndex((item) => item._zod.optin !== \"optional\");\n        const optStart = reversedIndex === -1 ? 0 : items.length - reversedIndex;\n        if (!def.rest) {\n            const tooBig = input.length > items.length;\n            const tooSmall = input.length < optStart - 1;\n            if (tooBig || tooSmall) {\n                payload.issues.push({\n                    ...(tooBig\n                        ? { code: \"too_big\", maximum: items.length, inclusive: true }\n                        : { code: \"too_small\", minimum: items.length }),\n                    input,\n                    inst,\n                    origin: \"array\",\n                });\n                return payload;\n            }\n        }\n        let i = -1;\n        for (const item of items) {\n            i++;\n            if (i >= input.length)\n                if (i >= optStart)\n                    continue;\n            const result = item._zod.run({\n                value: input[i],\n                issues: [],\n            }, ctx);\n            if (result instanceof Promise) {\n                proms.push(result.then((result) => handleTupleResult(result, payload, i)));\n            }\n            else {\n                handleTupleResult(result, payload, i);\n            }\n        }\n        if (def.rest) {\n            const rest = input.slice(items.length);\n            for (const el of rest) {\n                i++;\n                const result = def.rest._zod.run({\n                    value: el,\n                    issues: [],\n                }, ctx);\n                if (result instanceof Promise) {\n                    proms.push(result.then((result) => handleTupleResult(result, payload, i)));\n                }\n                else {\n                    handleTupleResult(result, payload, i);\n                }\n            }\n        }\n        if (proms.length)\n            return Promise.all(proms).then(() => payload);\n        return payload;\n    };\n});\nfunction handleTupleResult(result, final, index) {\n    if (result.issues.length) {\n        final.issues.push(...util.prefixIssues(index, result.issues));\n    }\n    final.value[index] = result.value;\n}\nexport const $ZodRecord = /*@__PURE__*/ core.$constructor(\"$ZodRecord\", (inst, def) => {\n    $ZodType.init(inst, def);\n    inst._zod.parse = (payload, ctx) => {\n        const input = payload.value;\n        if (!util.isPlainObject(input)) {\n            payload.issues.push({\n                expected: \"record\",\n                code: \"invalid_type\",\n                input,\n                inst,\n            });\n            return payload;\n        }\n        const proms = [];\n        const values = def.keyType._zod.values;\n        if (values) {\n            payload.value = {};\n            const recordKeys = new Set();\n            for (const key of values) {\n                if (typeof key === \"string\" || typeof key === \"number\" || typeof key === \"symbol\") {\n                    recordKeys.add(typeof key === \"number\" ? key.toString() : key);\n                    const result = def.valueType._zod.run({ value: input[key], issues: [] }, ctx);\n                    if (result instanceof Promise) {\n                        proms.push(result.then((result) => {\n                            if (result.issues.length) {\n                                payload.issues.push(...util.prefixIssues(key, result.issues));\n                            }\n                            payload.value[key] = result.value;\n                        }));\n                    }\n                    else {\n                        if (result.issues.length) {\n                            payload.issues.push(...util.prefixIssues(key, result.issues));\n                        }\n                        payload.value[key] = result.value;\n                    }\n                }\n            }\n            let unrecognized;\n            for (const key in input) {\n                if (!recordKeys.has(key)) {\n                    unrecognized = unrecognized ?? [];\n                    unrecognized.push(key);\n                }\n            }\n            if (unrecognized && unrecognized.length > 0) {\n                payload.issues.push({\n                    code: \"unrecognized_keys\",\n                    input,\n                    inst,\n                    keys: unrecognized,\n                });\n            }\n        }\n        else {\n            payload.value = {};\n            for (const key of Reflect.ownKeys(input)) {\n                if (key === \"__proto__\")\n                    continue;\n                let keyResult = def.keyType._zod.run({ value: key, issues: [] }, ctx);\n                if (keyResult instanceof Promise) {\n                    throw new Error(\"Async schemas not supported in object keys currently\");\n                }\n                // Numeric string fallback: if key is a numeric string and failed, retry with Number(key)\n                // This handles z.number(), z.literal([1, 2, 3]), and unions containing numeric literals\n                const checkNumericKey = typeof key === \"string\" && regexes.number.test(key) && keyResult.issues.length;\n                if (checkNumericKey) {\n                    const retryResult = def.keyType._zod.run({ value: Number(key), issues: [] }, ctx);\n                    if (retryResult instanceof Promise) {\n                        throw new Error(\"Async schemas not supported in object keys currently\");\n                    }\n                    if (retryResult.issues.length === 0) {\n                        keyResult = retryResult;\n                    }\n                }\n                if (keyResult.issues.length) {\n                    if (def.mode === \"loose\") {\n                        // Pass through unchanged\n                        payload.value[key] = input[key];\n                    }\n                    else {\n                        // Default \"strict\" behavior: error on invalid key\n                        payload.issues.push({\n                            code: \"invalid_key\",\n                            origin: \"record\",\n                            issues: keyResult.issues.map((iss) => util.finalizeIssue(iss, ctx, core.config())),\n                            input: key,\n                            path: [key],\n                            inst,\n                        });\n                    }\n                    continue;\n                }\n                const result = def.valueType._zod.run({ value: input[key], issues: [] }, ctx);\n                if (result instanceof Promise) {\n                    proms.push(result.then((result) => {\n                        if (result.issues.length) {\n                            payload.issues.push(...util.prefixIssues(key, result.issues));\n                        }\n                        payload.value[keyResult.value] = result.value;\n                    }));\n                }\n                else {\n                    if (result.issues.length) {\n                        payload.issues.push(...util.prefixIssues(key, result.issues));\n                    }\n                    payload.value[keyResult.value] = result.value;\n                }\n            }\n        }\n        if (proms.length) {\n            return Promise.all(proms).then(() => payload);\n        }\n        return payload;\n    };\n});\nexport const $ZodMap = /*@__PURE__*/ core.$constructor(\"$ZodMap\", (inst, def) => {\n    $ZodType.init(inst, def);\n    inst._zod.parse = (payload, ctx) => {\n        const input = payload.value;\n        if (!(input instanceof Map)) {\n            payload.issues.push({\n                expected: \"map\",\n                code: \"invalid_type\",\n                input,\n                inst,\n            });\n            return payload;\n        }\n        const proms = [];\n        payload.value = new Map();\n        for (const [key, value] of input) {\n            const keyResult = def.keyType._zod.run({ value: key, issues: [] }, ctx);\n            const valueResult = def.valueType._zod.run({ value: value, issues: [] }, ctx);\n            if (keyResult instanceof Promise || valueResult instanceof Promise) {\n                proms.push(Promise.all([keyResult, valueResult]).then(([keyResult, valueResult]) => {\n                    handleMapResult(keyResult, valueResult, payload, key, input, inst, ctx);\n                }));\n            }\n            else {\n                handleMapResult(keyResult, valueResult, payload, key, input, inst, ctx);\n            }\n        }\n        if (proms.length)\n            return Promise.all(proms).then(() => payload);\n        return payload;\n    };\n});\nfunction handleMapResult(keyResult, valueResult, final, key, input, inst, ctx) {\n    if (keyResult.issues.length) {\n        if (util.propertyKeyTypes.has(typeof key)) {\n            final.issues.push(...util.prefixIssues(key, keyResult.issues));\n        }\n        else {\n            final.issues.push({\n                code: \"invalid_key\",\n                origin: \"map\",\n                input,\n                inst,\n                issues: keyResult.issues.map((iss) => util.finalizeIssue(iss, ctx, core.config())),\n            });\n        }\n    }\n    if (valueResult.issues.length) {\n        if (util.propertyKeyTypes.has(typeof key)) {\n            final.issues.push(...util.prefixIssues(key, valueResult.issues));\n        }\n        else {\n            final.issues.push({\n                origin: \"map\",\n                code: \"invalid_element\",\n                input,\n                inst,\n                key: key,\n                issues: valueResult.issues.map((iss) => util.finalizeIssue(iss, ctx, core.config())),\n            });\n        }\n    }\n    final.value.set(keyResult.value, valueResult.value);\n}\nexport const $ZodSet = /*@__PURE__*/ core.$constructor(\"$ZodSet\", (inst, def) => {\n    $ZodType.init(inst, def);\n    inst._zod.parse = (payload, ctx) => {\n        const input = payload.value;\n        if (!(input instanceof Set)) {\n            payload.issues.push({\n                input,\n                inst,\n                expected: \"set\",\n                code: \"invalid_type\",\n            });\n            return payload;\n        }\n        const proms = [];\n        payload.value = new Set();\n        for (const item of input) {\n            const result = def.valueType._zod.run({ value: item, issues: [] }, ctx);\n            if (result instanceof Promise) {\n                proms.push(result.then((result) => handleSetResult(result, payload)));\n            }\n            else\n                handleSetResult(result, payload);\n        }\n        if (proms.length)\n            return Promise.all(proms).then(() => payload);\n        return payload;\n    };\n});\nfunction handleSetResult(result, final) {\n    if (result.issues.length) {\n        final.issues.push(...result.issues);\n    }\n    final.value.add(result.value);\n}\nexport const $ZodEnum = /*@__PURE__*/ core.$constructor(\"$ZodEnum\", (inst, def) => {\n    $ZodType.init(inst, def);\n    const values = util.getEnumValues(def.entries);\n    const valuesSet = new Set(values);\n    inst._zod.values = valuesSet;\n    inst._zod.pattern = new RegExp(`^(${values\n        .filter((k) => util.propertyKeyTypes.has(typeof k))\n        .map((o) => (typeof o === \"string\" ? util.escapeRegex(o) : o.toString()))\n        .join(\"|\")})$`);\n    inst._zod.parse = (payload, _ctx) => {\n        const input = payload.value;\n        if (valuesSet.has(input)) {\n            return payload;\n        }\n        payload.issues.push({\n            code: \"invalid_value\",\n            values,\n            input,\n            inst,\n        });\n        return payload;\n    };\n});\nexport const $ZodLiteral = /*@__PURE__*/ core.$constructor(\"$ZodLiteral\", (inst, def) => {\n    $ZodType.init(inst, def);\n    if (def.values.length === 0) {\n        throw new Error(\"Cannot create literal schema with no valid values\");\n    }\n    const values = new Set(def.values);\n    inst._zod.values = values;\n    inst._zod.pattern = new RegExp(`^(${def.values\n        .map((o) => (typeof o === \"string\" ? util.escapeRegex(o) : o ? util.escapeRegex(o.toString()) : String(o)))\n        .join(\"|\")})$`);\n    inst._zod.parse = (payload, _ctx) => {\n        const input = payload.value;\n        if (values.has(input)) {\n            return payload;\n        }\n        payload.issues.push({\n            code: \"invalid_value\",\n            values: def.values,\n            input,\n            inst,\n        });\n        return payload;\n    };\n});\nexport const $ZodFile = /*@__PURE__*/ core.$constructor(\"$ZodFile\", (inst, def) => {\n    $ZodType.init(inst, def);\n    inst._zod.parse = (payload, _ctx) => {\n        const input = payload.value;\n        // @ts-ignore\n        if (input instanceof File)\n            return payload;\n        payload.issues.push({\n            expected: \"file\",\n            code: \"invalid_type\",\n            input,\n            inst,\n        });\n        return payload;\n    };\n});\nexport const $ZodTransform = /*@__PURE__*/ core.$constructor(\"$ZodTransform\", (inst, def) => {\n    $ZodType.init(inst, def);\n    inst._zod.parse = (payload, ctx) => {\n        if (ctx.direction === \"backward\") {\n            throw new core.$ZodEncodeError(inst.constructor.name);\n        }\n        const _out = def.transform(payload.value, payload);\n        if (ctx.async) {\n            const output = _out instanceof Promise ? _out : Promise.resolve(_out);\n            return output.then((output) => {\n                payload.value = output;\n                return payload;\n            });\n        }\n        if (_out instanceof Promise) {\n            throw new core.$ZodAsyncError();\n        }\n        payload.value = _out;\n        return payload;\n    };\n});\nfunction handleOptionalResult(result, input) {\n    if (result.issues.length && input === undefined) {\n        return { issues: [], value: undefined };\n    }\n    return result;\n}\nexport const $ZodOptional = /*@__PURE__*/ core.$constructor(\"$ZodOptional\", (inst, def) => {\n    $ZodType.init(inst, def);\n    inst._zod.optin = \"optional\";\n    inst._zod.optout = \"optional\";\n    util.defineLazy(inst._zod, \"values\", () => {\n        return def.innerType._zod.values ? new Set([...def.innerType._zod.values, undefined]) : undefined;\n    });\n    util.defineLazy(inst._zod, \"pattern\", () => {\n        const pattern = def.innerType._zod.pattern;\n        return pattern ? new RegExp(`^(${util.cleanRegex(pattern.source)})?$`) : undefined;\n    });\n    inst._zod.parse = (payload, ctx) => {\n        if (def.innerType._zod.optin === \"optional\") {\n            const result = def.innerType._zod.run(payload, ctx);\n            if (result instanceof Promise)\n                return result.then((r) => handleOptionalResult(r, payload.value));\n            return handleOptionalResult(result, payload.value);\n        }\n        if (payload.value === undefined) {\n            return payload;\n        }\n        return def.innerType._zod.run(payload, ctx);\n    };\n});\nexport const $ZodExactOptional = /*@__PURE__*/ core.$constructor(\"$ZodExactOptional\", (inst, def) => {\n    // Call parent init - inherits optin/optout = \"optional\"\n    $ZodOptional.init(inst, def);\n    // Override values/pattern to NOT add undefined\n    util.defineLazy(inst._zod, \"values\", () => def.innerType._zod.values);\n    util.defineLazy(inst._zod, \"pattern\", () => def.innerType._zod.pattern);\n    // Override parse to just delegate (no undefined handling)\n    inst._zod.parse = (payload, ctx) => {\n        return def.innerType._zod.run(payload, ctx);\n    };\n});\nexport const $ZodNullable = /*@__PURE__*/ core.$constructor(\"$ZodNullable\", (inst, def) => {\n    $ZodType.init(inst, def);\n    util.defineLazy(inst._zod, \"optin\", () => def.innerType._zod.optin);\n    util.defineLazy(inst._zod, \"optout\", () => def.innerType._zod.optout);\n    util.defineLazy(inst._zod, \"pattern\", () => {\n        const pattern = def.innerType._zod.pattern;\n        return pattern ? new RegExp(`^(${util.cleanRegex(pattern.source)}|null)$`) : undefined;\n    });\n    util.defineLazy(inst._zod, \"values\", () => {\n        return def.innerType._zod.values ? new Set([...def.innerType._zod.values, null]) : undefined;\n    });\n    inst._zod.parse = (payload, ctx) => {\n        // Forward direction (decode): allow null to pass through\n        if (payload.value === null)\n            return payload;\n        return def.innerType._zod.run(payload, ctx);\n    };\n});\nexport const $ZodDefault = /*@__PURE__*/ core.$constructor(\"$ZodDefault\", (inst, def) => {\n    $ZodType.init(inst, def);\n    // inst._zod.qin = \"true\";\n    inst._zod.optin = \"optional\";\n    util.defineLazy(inst._zod, \"values\", () => def.innerType._zod.values);\n    inst._zod.parse = (payload, ctx) => {\n        if (ctx.direction === \"backward\") {\n            return def.innerType._zod.run(payload, ctx);\n        }\n        // Forward direction (decode): apply defaults for undefined input\n        if (payload.value === undefined) {\n            payload.value = def.defaultValue;\n            /**\n             * $ZodDefault returns the default value immediately in forward direction.\n             * It doesn't pass the default value into the validator (\"prefault\"). There's no reason to pass the default value through validation. The validity of the default is enforced by TypeScript statically. Otherwise, it's the responsibility of the user to ensure the default is valid. In the case of pipes with divergent in/out types, you can specify the default on the `in` schema of your ZodPipe to set a \"prefault\" for the pipe.   */\n            return payload;\n        }\n        // Forward direction: continue with default handling\n        const result = def.innerType._zod.run(payload, ctx);\n        if (result instanceof Promise) {\n            return result.then((result) => handleDefaultResult(result, def));\n        }\n        return handleDefaultResult(result, def);\n    };\n});\nfunction handleDefaultResult(payload, def) {\n    if (payload.value === undefined) {\n        payload.value = def.defaultValue;\n    }\n    return payload;\n}\nexport const $ZodPrefault = /*@__PURE__*/ core.$constructor(\"$ZodPrefault\", (inst, def) => {\n    $ZodType.init(inst, def);\n    inst._zod.optin = \"optional\";\n    util.defineLazy(inst._zod, \"values\", () => def.innerType._zod.values);\n    inst._zod.parse = (payload, ctx) => {\n        if (ctx.direction === \"backward\") {\n            return def.innerType._zod.run(payload, ctx);\n        }\n        // Forward direction (decode): apply prefault for undefined input\n        if (payload.value === undefined) {\n            payload.value = def.defaultValue;\n        }\n        return def.innerType._zod.run(payload, ctx);\n    };\n});\nexport const $ZodNonOptional = /*@__PURE__*/ core.$constructor(\"$ZodNonOptional\", (inst, def) => {\n    $ZodType.init(inst, def);\n    util.defineLazy(inst._zod, \"values\", () => {\n        const v = def.innerType._zod.values;\n        return v ? new Set([...v].filter((x) => x !== undefined)) : undefined;\n    });\n    inst._zod.parse = (payload, ctx) => {\n        const result = def.innerType._zod.run(payload, ctx);\n        if (result instanceof Promise) {\n            return result.then((result) => handleNonOptionalResult(result, inst));\n        }\n        return handleNonOptionalResult(result, inst);\n    };\n});\nfunction handleNonOptionalResult(payload, inst) {\n    if (!payload.issues.length && payload.value === undefined) {\n        payload.issues.push({\n            code: \"invalid_type\",\n            expected: \"nonoptional\",\n            input: payload.value,\n            inst,\n        });\n    }\n    return payload;\n}\nexport const $ZodSuccess = /*@__PURE__*/ core.$constructor(\"$ZodSuccess\", (inst, def) => {\n    $ZodType.init(inst, def);\n    inst._zod.parse = (payload, ctx) => {\n        if (ctx.direction === \"backward\") {\n            throw new core.$ZodEncodeError(\"ZodSuccess\");\n        }\n        const result = def.innerType._zod.run(payload, ctx);\n        if (result instanceof Promise) {\n            return result.then((result) => {\n                payload.value = result.issues.length === 0;\n                return payload;\n            });\n        }\n        payload.value = result.issues.length === 0;\n        return payload;\n    };\n});\nexport const $ZodCatch = /*@__PURE__*/ core.$constructor(\"$ZodCatch\", (inst, def) => {\n    $ZodType.init(inst, def);\n    util.defineLazy(inst._zod, \"optin\", () => def.innerType._zod.optin);\n    util.defineLazy(inst._zod, \"optout\", () => def.innerType._zod.optout);\n    util.defineLazy(inst._zod, \"values\", () => def.innerType._zod.values);\n    inst._zod.parse = (payload, ctx) => {\n        if (ctx.direction === \"backward\") {\n            return def.innerType._zod.run(payload, ctx);\n        }\n        // Forward direction (decode): apply catch logic\n        const result = def.innerType._zod.run(payload, ctx);\n        if (result instanceof Promise) {\n            return result.then((result) => {\n                payload.value = result.value;\n                if (result.issues.length) {\n                    payload.value = def.catchValue({\n                        ...payload,\n                        error: {\n                            issues: result.issues.map((iss) => util.finalizeIssue(iss, ctx, core.config())),\n                        },\n                        input: payload.value,\n                    });\n                    payload.issues = [];\n                }\n                return payload;\n            });\n        }\n        payload.value = result.value;\n        if (result.issues.length) {\n            payload.value = def.catchValue({\n                ...payload,\n                error: {\n                    issues: result.issues.map((iss) => util.finalizeIssue(iss, ctx, core.config())),\n                },\n                input: payload.value,\n            });\n            payload.issues = [];\n        }\n        return payload;\n    };\n});\nexport const $ZodNaN = /*@__PURE__*/ core.$constructor(\"$ZodNaN\", (inst, def) => {\n    $ZodType.init(inst, def);\n    inst._zod.parse = (payload, _ctx) => {\n        if (typeof payload.value !== \"number\" || !Number.isNaN(payload.value)) {\n            payload.issues.push({\n                input: payload.value,\n                inst,\n                expected: \"nan\",\n                code: \"invalid_type\",\n            });\n            return payload;\n        }\n        return payload;\n    };\n});\nexport const $ZodPipe = /*@__PURE__*/ core.$constructor(\"$ZodPipe\", (inst, def) => {\n    $ZodType.init(inst, def);\n    util.defineLazy(inst._zod, \"values\", () => def.in._zod.values);\n    util.defineLazy(inst._zod, \"optin\", () => def.in._zod.optin);\n    util.defineLazy(inst._zod, \"optout\", () => def.out._zod.optout);\n    util.defineLazy(inst._zod, \"propValues\", () => def.in._zod.propValues);\n    inst._zod.parse = (payload, ctx) => {\n        if (ctx.direction === \"backward\") {\n            const right = def.out._zod.run(payload, ctx);\n            if (right instanceof Promise) {\n                return right.then((right) => handlePipeResult(right, def.in, ctx));\n            }\n            return handlePipeResult(right, def.in, ctx);\n        }\n        const left = def.in._zod.run(payload, ctx);\n        if (left instanceof Promise) {\n            return left.then((left) => handlePipeResult(left, def.out, ctx));\n        }\n        return handlePipeResult(left, def.out, ctx);\n    };\n});\nfunction handlePipeResult(left, next, ctx) {\n    if (left.issues.length) {\n        // prevent further checks\n        left.aborted = true;\n        return left;\n    }\n    return next._zod.run({ value: left.value, issues: left.issues }, ctx);\n}\nexport const $ZodCodec = /*@__PURE__*/ core.$constructor(\"$ZodCodec\", (inst, def) => {\n    $ZodType.init(inst, def);\n    util.defineLazy(inst._zod, \"values\", () => def.in._zod.values);\n    util.defineLazy(inst._zod, \"optin\", () => def.in._zod.optin);\n    util.defineLazy(inst._zod, \"optout\", () => def.out._zod.optout);\n    util.defineLazy(inst._zod, \"propValues\", () => def.in._zod.propValues);\n    inst._zod.parse = (payload, ctx) => {\n        const direction = ctx.direction || \"forward\";\n        if (direction === \"forward\") {\n            const left = def.in._zod.run(payload, ctx);\n            if (left instanceof Promise) {\n                return left.then((left) => handleCodecAResult(left, def, ctx));\n            }\n            return handleCodecAResult(left, def, ctx);\n        }\n        else {\n            const right = def.out._zod.run(payload, ctx);\n            if (right instanceof Promise) {\n                return right.then((right) => handleCodecAResult(right, def, ctx));\n            }\n            return handleCodecAResult(right, def, ctx);\n        }\n    };\n});\nfunction handleCodecAResult(result, def, ctx) {\n    if (result.issues.length) {\n        // prevent further checks\n        result.aborted = true;\n        return result;\n    }\n    const direction = ctx.direction || \"forward\";\n    if (direction === \"forward\") {\n        const transformed = def.transform(result.value, result);\n        if (transformed instanceof Promise) {\n            return transformed.then((value) => handleCodecTxResult(result, value, def.out, ctx));\n        }\n        return handleCodecTxResult(result, transformed, def.out, ctx);\n    }\n    else {\n        const transformed = def.reverseTransform(result.value, result);\n        if (transformed instanceof Promise) {\n            return transformed.then((value) => handleCodecTxResult(result, value, def.in, ctx));\n        }\n        return handleCodecTxResult(result, transformed, def.in, ctx);\n    }\n}\nfunction handleCodecTxResult(left, value, nextSchema, ctx) {\n    // Check if transform added any issues\n    if (left.issues.length) {\n        left.aborted = true;\n        return left;\n    }\n    return nextSchema._zod.run({ value, issues: left.issues }, ctx);\n}\nexport const $ZodReadonly = /*@__PURE__*/ core.$constructor(\"$ZodReadonly\", (inst, def) => {\n    $ZodType.init(inst, def);\n    util.defineLazy(inst._zod, \"propValues\", () => def.innerType._zod.propValues);\n    util.defineLazy(inst._zod, \"values\", () => def.innerType._zod.values);\n    util.defineLazy(inst._zod, \"optin\", () => def.innerType?._zod?.optin);\n    util.defineLazy(inst._zod, \"optout\", () => def.innerType?._zod?.optout);\n    inst._zod.parse = (payload, ctx) => {\n        if (ctx.direction === \"backward\") {\n            return def.innerType._zod.run(payload, ctx);\n        }\n        const result = def.innerType._zod.run(payload, ctx);\n        if (result instanceof Promise) {\n            return result.then(handleReadonlyResult);\n        }\n        return handleReadonlyResult(result);\n    };\n});\nfunction handleReadonlyResult(payload) {\n    payload.value = Object.freeze(payload.value);\n    return payload;\n}\nexport const $ZodTemplateLiteral = /*@__PURE__*/ core.$constructor(\"$ZodTemplateLiteral\", (inst, def) => {\n    $ZodType.init(inst, def);\n    const regexParts = [];\n    for (const part of def.parts) {\n        if (typeof part === \"object\" && part !== null) {\n            // is Zod schema\n            if (!part._zod.pattern) {\n                // if (!source)\n                throw new Error(`Invalid template literal part, no pattern found: ${[...part._zod.traits].shift()}`);\n            }\n            const source = part._zod.pattern instanceof RegExp ? part._zod.pattern.source : part._zod.pattern;\n            if (!source)\n                throw new Error(`Invalid template literal part: ${part._zod.traits}`);\n            const start = source.startsWith(\"^\") ? 1 : 0;\n            const end = source.endsWith(\"$\") ? source.length - 1 : source.length;\n            regexParts.push(source.slice(start, end));\n        }\n        else if (part === null || util.primitiveTypes.has(typeof part)) {\n            regexParts.push(util.escapeRegex(`${part}`));\n        }\n        else {\n            throw new Error(`Invalid template literal part: ${part}`);\n        }\n    }\n    inst._zod.pattern = new RegExp(`^${regexParts.join(\"\")}$`);\n    inst._zod.parse = (payload, _ctx) => {\n        if (typeof payload.value !== \"string\") {\n            payload.issues.push({\n                input: payload.value,\n                inst,\n                expected: \"string\",\n                code: \"invalid_type\",\n            });\n            return payload;\n        }\n        inst._zod.pattern.lastIndex = 0;\n        if (!inst._zod.pattern.test(payload.value)) {\n            payload.issues.push({\n                input: payload.value,\n                inst,\n                code: \"invalid_format\",\n                format: def.format ?? \"template_literal\",\n                pattern: inst._zod.pattern.source,\n            });\n            return payload;\n        }\n        return payload;\n    };\n});\nexport const $ZodFunction = /*@__PURE__*/ core.$constructor(\"$ZodFunction\", (inst, def) => {\n    $ZodType.init(inst, def);\n    inst._def = def;\n    inst._zod.def = def;\n    inst.implement = (func) => {\n        if (typeof func !== \"function\") {\n            throw new Error(\"implement() must be called with a function\");\n        }\n        return function (...args) {\n            const parsedArgs = inst._def.input ? parse(inst._def.input, args) : args;\n            const result = Reflect.apply(func, this, parsedArgs);\n            if (inst._def.output) {\n                return parse(inst._def.output, result);\n            }\n            return result;\n        };\n    };\n    inst.implementAsync = (func) => {\n        if (typeof func !== \"function\") {\n            throw new Error(\"implementAsync() must be called with a function\");\n        }\n        return async function (...args) {\n            const parsedArgs = inst._def.input ? await parseAsync(inst._def.input, args) : args;\n            const result = await Reflect.apply(func, this, parsedArgs);\n            if (inst._def.output) {\n                return await parseAsync(inst._def.output, result);\n            }\n            return result;\n        };\n    };\n    inst._zod.parse = (payload, _ctx) => {\n        if (typeof payload.value !== \"function\") {\n            payload.issues.push({\n                code: \"invalid_type\",\n                expected: \"function\",\n                input: payload.value,\n                inst,\n            });\n            return payload;\n        }\n        // Check if output is a promise type to determine if we should use async implementation\n        const hasPromiseOutput = inst._def.output && inst._def.output._zod.def.type === \"promise\";\n        if (hasPromiseOutput) {\n            payload.value = inst.implementAsync(payload.value);\n        }\n        else {\n            payload.value = inst.implement(payload.value);\n        }\n        return payload;\n    };\n    inst.input = (...args) => {\n        const F = inst.constructor;\n        if (Array.isArray(args[0])) {\n            return new F({\n                type: \"function\",\n                input: new $ZodTuple({\n                    type: \"tuple\",\n                    items: args[0],\n                    rest: args[1],\n                }),\n                output: inst._def.output,\n            });\n        }\n        return new F({\n            type: \"function\",\n            input: args[0],\n            output: inst._def.output,\n        });\n    };\n    inst.output = (output) => {\n        const F = inst.constructor;\n        return new F({\n            type: \"function\",\n            input: inst._def.input,\n            output,\n        });\n    };\n    return inst;\n});\nexport const $ZodPromise = /*@__PURE__*/ core.$constructor(\"$ZodPromise\", (inst, def) => {\n    $ZodType.init(inst, def);\n    inst._zod.parse = (payload, ctx) => {\n        return Promise.resolve(payload.value).then((inner) => def.innerType._zod.run({ value: inner, issues: [] }, ctx));\n    };\n});\nexport const $ZodLazy = /*@__PURE__*/ core.$constructor(\"$ZodLazy\", (inst, def) => {\n    $ZodType.init(inst, def);\n    // let _innerType!: any;\n    // util.defineLazy(def, \"getter\", () => {\n    //   if (!_innerType) {\n    //     _innerType = def.getter();\n    //   }\n    //   return () => _innerType;\n    // });\n    util.defineLazy(inst._zod, \"innerType\", () => def.getter());\n    util.defineLazy(inst._zod, \"pattern\", () => inst._zod.innerType?._zod?.pattern);\n    util.defineLazy(inst._zod, \"propValues\", () => inst._zod.innerType?._zod?.propValues);\n    util.defineLazy(inst._zod, \"optin\", () => inst._zod.innerType?._zod?.optin ?? undefined);\n    util.defineLazy(inst._zod, \"optout\", () => inst._zod.innerType?._zod?.optout ?? undefined);\n    inst._zod.parse = (payload, ctx) => {\n        const inner = inst._zod.innerType;\n        return inner._zod.run(payload, ctx);\n    };\n});\nexport const $ZodCustom = /*@__PURE__*/ core.$constructor(\"$ZodCustom\", (inst, def) => {\n    checks.$ZodCheck.init(inst, def);\n    $ZodType.init(inst, def);\n    inst._zod.parse = (payload, _) => {\n        return payload;\n    };\n    inst._zod.check = (payload) => {\n        const input = payload.value;\n        const r = def.fn(input);\n        if (r instanceof Promise) {\n            return r.then((r) => handleRefineResult(r, payload, input, inst));\n        }\n        handleRefineResult(r, payload, input, inst);\n        return;\n    };\n});\nfunction handleRefineResult(result, payload, input, inst) {\n    if (!result) {\n        const _iss = {\n            code: \"custom\",\n            input,\n            inst, // incorporates params.error into issue reporting\n            path: [...(inst._zod.def.path ?? [])], // incorporates params.error into issue reporting\n            continue: !inst._zod.def.abort,\n            // params: inst._zod.def.params,\n        };\n        if (inst._zod.def.params)\n            _iss.params = inst._zod.def.params;\n        payload.issues.push(util.issue(_iss));\n    }\n}\n","var _a;\nexport const $output = Symbol(\"ZodOutput\");\nexport const $input = Symbol(\"ZodInput\");\nexport class $ZodRegistry {\n    constructor() {\n        this._map = new WeakMap();\n        this._idmap = new Map();\n    }\n    add(schema, ..._meta) {\n        const meta = _meta[0];\n        this._map.set(schema, meta);\n        if (meta && typeof meta === \"object\" && \"id\" in meta) {\n            this._idmap.set(meta.id, schema);\n        }\n        return this;\n    }\n    clear() {\n        this._map = new WeakMap();\n        this._idmap = new Map();\n        return this;\n    }\n    remove(schema) {\n        const meta = this._map.get(schema);\n        if (meta && typeof meta === \"object\" && \"id\" in meta) {\n            this._idmap.delete(meta.id);\n        }\n        this._map.delete(schema);\n        return this;\n    }\n    get(schema) {\n        // return this._map.get(schema) as any;\n        // inherit metadata\n        const p = schema._zod.parent;\n        if (p) {\n            const pm = { ...(this.get(p) ?? {}) };\n            delete pm.id; // do not inherit id\n            const f = { ...pm, ...this._map.get(schema) };\n            return Object.keys(f).length ? f : undefined;\n        }\n        return this._map.get(schema);\n    }\n    has(schema) {\n        return this._map.has(schema);\n    }\n}\n// registries\nexport function registry() {\n    return new $ZodRegistry();\n}\n(_a = globalThis).__zod_globalRegistry ?? (_a.__zod_globalRegistry = registry());\nexport const globalRegistry = globalThis.__zod_globalRegistry;\n","import * as checks from \"./checks.js\";\nimport * as registries from \"./registries.js\";\nimport * as schemas from \"./schemas.js\";\nimport * as util from \"./util.js\";\n// @__NO_SIDE_EFFECTS__\nexport function _string(Class, params) {\n    return new Class({\n        type: \"string\",\n        ...util.normalizeParams(params),\n    });\n}\n// @__NO_SIDE_EFFECTS__\nexport function _coercedString(Class, params) {\n    return new Class({\n        type: \"string\",\n        coerce: true,\n        ...util.normalizeParams(params),\n    });\n}\n// @__NO_SIDE_EFFECTS__\nexport function _email(Class, params) {\n    return new Class({\n        type: \"string\",\n        format: \"email\",\n        check: \"string_format\",\n        abort: false,\n        ...util.normalizeParams(params),\n    });\n}\n// @__NO_SIDE_EFFECTS__\nexport function _guid(Class, params) {\n    return new Class({\n        type: \"string\",\n        format: \"guid\",\n        check: \"string_format\",\n        abort: false,\n        ...util.normalizeParams(params),\n    });\n}\n// @__NO_SIDE_EFFECTS__\nexport function _uuid(Class, params) {\n    return new Class({\n        type: \"string\",\n        format: \"uuid\",\n        check: \"string_format\",\n        abort: false,\n        ...util.normalizeParams(params),\n    });\n}\n// @__NO_SIDE_EFFECTS__\nexport function _uuidv4(Class, params) {\n    return new Class({\n        type: \"string\",\n        format: \"uuid\",\n        check: \"string_format\",\n        abort: false,\n        version: \"v4\",\n        ...util.normalizeParams(params),\n    });\n}\n// @__NO_SIDE_EFFECTS__\nexport function _uuidv6(Class, params) {\n    return new Class({\n        type: \"string\",\n        format: \"uuid\",\n        check: \"string_format\",\n        abort: false,\n        version: \"v6\",\n        ...util.normalizeParams(params),\n    });\n}\n// @__NO_SIDE_EFFECTS__\nexport function _uuidv7(Class, params) {\n    return new Class({\n        type: \"string\",\n        format: \"uuid\",\n        check: \"string_format\",\n        abort: false,\n        version: \"v7\",\n        ...util.normalizeParams(params),\n    });\n}\n// @__NO_SIDE_EFFECTS__\nexport function _url(Class, params) {\n    return new Class({\n        type: \"string\",\n        format: \"url\",\n        check: \"string_format\",\n        abort: false,\n        ...util.normalizeParams(params),\n    });\n}\n// @__NO_SIDE_EFFECTS__\nexport function _emoji(Class, params) {\n    return new Class({\n        type: \"string\",\n        format: \"emoji\",\n        check: \"string_format\",\n        abort: false,\n        ...util.normalizeParams(params),\n    });\n}\n// @__NO_SIDE_EFFECTS__\nexport function _nanoid(Class, params) {\n    return new Class({\n        type: \"string\",\n        format: \"nanoid\",\n        check: \"string_format\",\n        abort: false,\n        ...util.normalizeParams(params),\n    });\n}\n// @__NO_SIDE_EFFECTS__\nexport function _cuid(Class, params) {\n    return new Class({\n        type: \"string\",\n        format: \"cuid\",\n        check: \"string_format\",\n        abort: false,\n        ...util.normalizeParams(params),\n    });\n}\n// @__NO_SIDE_EFFECTS__\nexport function _cuid2(Class, params) {\n    return new Class({\n        type: \"string\",\n        format: \"cuid2\",\n        check: \"string_format\",\n        abort: false,\n        ...util.normalizeParams(params),\n    });\n}\n// @__NO_SIDE_EFFECTS__\nexport function _ulid(Class, params) {\n    return new Class({\n        type: \"string\",\n        format: \"ulid\",\n        check: \"string_format\",\n        abort: false,\n        ...util.normalizeParams(params),\n    });\n}\n// @__NO_SIDE_EFFECTS__\nexport function _xid(Class, params) {\n    return new Class({\n        type: \"string\",\n        format: \"xid\",\n        check: \"string_format\",\n        abort: false,\n        ...util.normalizeParams(params),\n    });\n}\n// @__NO_SIDE_EFFECTS__\nexport function _ksuid(Class, params) {\n    return new Class({\n        type: \"string\",\n        format: \"ksuid\",\n        check: \"string_format\",\n        abort: false,\n        ...util.normalizeParams(params),\n    });\n}\n// @__NO_SIDE_EFFECTS__\nexport function _ipv4(Class, params) {\n    return new Class({\n        type: \"string\",\n        format: \"ipv4\",\n        check: \"string_format\",\n        abort: false,\n        ...util.normalizeParams(params),\n    });\n}\n// @__NO_SIDE_EFFECTS__\nexport function _ipv6(Class, params) {\n    return new Class({\n        type: \"string\",\n        format: \"ipv6\",\n        check: \"string_format\",\n        abort: false,\n        ...util.normalizeParams(params),\n    });\n}\n// @__NO_SIDE_EFFECTS__\nexport function _mac(Class, params) {\n    return new Class({\n        type: \"string\",\n        format: \"mac\",\n        check: \"string_format\",\n        abort: false,\n        ...util.normalizeParams(params),\n    });\n}\n// @__NO_SIDE_EFFECTS__\nexport function _cidrv4(Class, params) {\n    return new Class({\n        type: \"string\",\n        format: \"cidrv4\",\n        check: \"string_format\",\n        abort: false,\n        ...util.normalizeParams(params),\n    });\n}\n// @__NO_SIDE_EFFECTS__\nexport function _cidrv6(Class, params) {\n    return new Class({\n        type: \"string\",\n        format: \"cidrv6\",\n        check: \"string_format\",\n        abort: false,\n        ...util.normalizeParams(params),\n    });\n}\n// @__NO_SIDE_EFFECTS__\nexport function _base64(Class, params) {\n    return new Class({\n        type: \"string\",\n        format: \"base64\",\n        check: \"string_format\",\n        abort: false,\n        ...util.normalizeParams(params),\n    });\n}\n// @__NO_SIDE_EFFECTS__\nexport function _base64url(Class, params) {\n    return new Class({\n        type: \"string\",\n        format: \"base64url\",\n        check: \"string_format\",\n        abort: false,\n        ...util.normalizeParams(params),\n    });\n}\n// @__NO_SIDE_EFFECTS__\nexport function _e164(Class, params) {\n    return new Class({\n        type: \"string\",\n        format: \"e164\",\n        check: \"string_format\",\n        abort: false,\n        ...util.normalizeParams(params),\n    });\n}\n// @__NO_SIDE_EFFECTS__\nexport function _jwt(Class, params) {\n    return new Class({\n        type: \"string\",\n        format: \"jwt\",\n        check: \"string_format\",\n        abort: false,\n        ...util.normalizeParams(params),\n    });\n}\nexport const TimePrecision = {\n    Any: null,\n    Minute: -1,\n    Second: 0,\n    Millisecond: 3,\n    Microsecond: 6,\n};\n// @__NO_SIDE_EFFECTS__\nexport function _isoDateTime(Class, params) {\n    return new Class({\n        type: \"string\",\n        format: \"datetime\",\n        check: \"string_format\",\n        offset: false,\n        local: false,\n        precision: null,\n        ...util.normalizeParams(params),\n    });\n}\n// @__NO_SIDE_EFFECTS__\nexport function _isoDate(Class, params) {\n    return new Class({\n        type: \"string\",\n        format: \"date\",\n        check: \"string_format\",\n        ...util.normalizeParams(params),\n    });\n}\n// @__NO_SIDE_EFFECTS__\nexport function _isoTime(Class, params) {\n    return new Class({\n        type: \"string\",\n        format: \"time\",\n        check: \"string_format\",\n        precision: null,\n        ...util.normalizeParams(params),\n    });\n}\n// @__NO_SIDE_EFFECTS__\nexport function _isoDuration(Class, params) {\n    return new Class({\n        type: \"string\",\n        format: \"duration\",\n        check: \"string_format\",\n        ...util.normalizeParams(params),\n    });\n}\n// @__NO_SIDE_EFFECTS__\nexport function _number(Class, params) {\n    return new Class({\n        type: \"number\",\n        checks: [],\n        ...util.normalizeParams(params),\n    });\n}\n// @__NO_SIDE_EFFECTS__\nexport function _coercedNumber(Class, params) {\n    return new Class({\n        type: \"number\",\n        coerce: true,\n        checks: [],\n        ...util.normalizeParams(params),\n    });\n}\n// @__NO_SIDE_EFFECTS__\nexport function _int(Class, params) {\n    return new Class({\n        type: \"number\",\n        check: \"number_format\",\n        abort: false,\n        format: \"safeint\",\n        ...util.normalizeParams(params),\n    });\n}\n// @__NO_SIDE_EFFECTS__\nexport function _float32(Class, params) {\n    return new Class({\n        type: \"number\",\n        check: \"number_format\",\n        abort: false,\n        format: \"float32\",\n        ...util.normalizeParams(params),\n    });\n}\n// @__NO_SIDE_EFFECTS__\nexport function _float64(Class, params) {\n    return new Class({\n        type: \"number\",\n        check: \"number_format\",\n        abort: false,\n        format: \"float64\",\n        ...util.normalizeParams(params),\n    });\n}\n// @__NO_SIDE_EFFECTS__\nexport function _int32(Class, params) {\n    return new Class({\n        type: \"number\",\n        check: \"number_format\",\n        abort: false,\n        format: \"int32\",\n        ...util.normalizeParams(params),\n    });\n}\n// @__NO_SIDE_EFFECTS__\nexport function _uint32(Class, params) {\n    return new Class({\n        type: \"number\",\n        check: \"number_format\",\n        abort: false,\n        format: \"uint32\",\n        ...util.normalizeParams(params),\n    });\n}\n// @__NO_SIDE_EFFECTS__\nexport function _boolean(Class, params) {\n    return new Class({\n        type: \"boolean\",\n        ...util.normalizeParams(params),\n    });\n}\n// @__NO_SIDE_EFFECTS__\nexport function _coercedBoolean(Class, params) {\n    return new Class({\n        type: \"boolean\",\n        coerce: true,\n        ...util.normalizeParams(params),\n    });\n}\n// @__NO_SIDE_EFFECTS__\nexport function _bigint(Class, params) {\n    return new Class({\n        type: \"bigint\",\n        ...util.normalizeParams(params),\n    });\n}\n// @__NO_SIDE_EFFECTS__\nexport function _coercedBigint(Class, params) {\n    return new Class({\n        type: \"bigint\",\n        coerce: true,\n        ...util.normalizeParams(params),\n    });\n}\n// @__NO_SIDE_EFFECTS__\nexport function _int64(Class, params) {\n    return new Class({\n        type: \"bigint\",\n        check: \"bigint_format\",\n        abort: false,\n        format: \"int64\",\n        ...util.normalizeParams(params),\n    });\n}\n// @__NO_SIDE_EFFECTS__\nexport function _uint64(Class, params) {\n    return new Class({\n        type: \"bigint\",\n        check: \"bigint_format\",\n        abort: false,\n        format: \"uint64\",\n        ...util.normalizeParams(params),\n    });\n}\n// @__NO_SIDE_EFFECTS__\nexport function _symbol(Class, params) {\n    return new Class({\n        type: \"symbol\",\n        ...util.normalizeParams(params),\n    });\n}\n// @__NO_SIDE_EFFECTS__\nexport function _undefined(Class, params) {\n    return new Class({\n        type: \"undefined\",\n        ...util.normalizeParams(params),\n    });\n}\n// @__NO_SIDE_EFFECTS__\nexport function _null(Class, params) {\n    return new Class({\n        type: \"null\",\n        ...util.normalizeParams(params),\n    });\n}\n// @__NO_SIDE_EFFECTS__\nexport function _any(Class) {\n    return new Class({\n        type: \"any\",\n    });\n}\n// @__NO_SIDE_EFFECTS__\nexport function _unknown(Class) {\n    return new Class({\n        type: \"unknown\",\n    });\n}\n// @__NO_SIDE_EFFECTS__\nexport function _never(Class, params) {\n    return new Class({\n        type: \"never\",\n        ...util.normalizeParams(params),\n    });\n}\n// @__NO_SIDE_EFFECTS__\nexport function _void(Class, params) {\n    return new Class({\n        type: \"void\",\n        ...util.normalizeParams(params),\n    });\n}\n// @__NO_SIDE_EFFECTS__\nexport function _date(Class, params) {\n    return new Class({\n        type: \"date\",\n        ...util.normalizeParams(params),\n    });\n}\n// @__NO_SIDE_EFFECTS__\nexport function _coercedDate(Class, params) {\n    return new Class({\n        type: \"date\",\n        coerce: true,\n        ...util.normalizeParams(params),\n    });\n}\n// @__NO_SIDE_EFFECTS__\nexport function _nan(Class, params) {\n    return new Class({\n        type: \"nan\",\n        ...util.normalizeParams(params),\n    });\n}\n// @__NO_SIDE_EFFECTS__\nexport function _lt(value, params) {\n    return new checks.$ZodCheckLessThan({\n        check: \"less_than\",\n        ...util.normalizeParams(params),\n        value,\n        inclusive: false,\n    });\n}\n// @__NO_SIDE_EFFECTS__\nexport function _lte(value, params) {\n    return new checks.$ZodCheckLessThan({\n        check: \"less_than\",\n        ...util.normalizeParams(params),\n        value,\n        inclusive: true,\n    });\n}\nexport { \n/** @deprecated Use `z.lte()` instead. */\n_lte as _max, };\n// @__NO_SIDE_EFFECTS__\nexport function _gt(value, params) {\n    return new checks.$ZodCheckGreaterThan({\n        check: \"greater_than\",\n        ...util.normalizeParams(params),\n        value,\n        inclusive: false,\n    });\n}\n// @__NO_SIDE_EFFECTS__\nexport function _gte(value, params) {\n    return new checks.$ZodCheckGreaterThan({\n        check: \"greater_than\",\n        ...util.normalizeParams(params),\n        value,\n        inclusive: true,\n    });\n}\nexport { \n/** @deprecated Use `z.gte()` instead. */\n_gte as _min, };\n// @__NO_SIDE_EFFECTS__\nexport function _positive(params) {\n    return _gt(0, params);\n}\n// negative\n// @__NO_SIDE_EFFECTS__\nexport function _negative(params) {\n    return _lt(0, params);\n}\n// nonpositive\n// @__NO_SIDE_EFFECTS__\nexport function _nonpositive(params) {\n    return _lte(0, params);\n}\n// nonnegative\n// @__NO_SIDE_EFFECTS__\nexport function _nonnegative(params) {\n    return _gte(0, params);\n}\n// @__NO_SIDE_EFFECTS__\nexport function _multipleOf(value, params) {\n    return new checks.$ZodCheckMultipleOf({\n        check: \"multiple_of\",\n        ...util.normalizeParams(params),\n        value,\n    });\n}\n// @__NO_SIDE_EFFECTS__\nexport function _maxSize(maximum, params) {\n    return new checks.$ZodCheckMaxSize({\n        check: \"max_size\",\n        ...util.normalizeParams(params),\n        maximum,\n    });\n}\n// @__NO_SIDE_EFFECTS__\nexport function _minSize(minimum, params) {\n    return new checks.$ZodCheckMinSize({\n        check: \"min_size\",\n        ...util.normalizeParams(params),\n        minimum,\n    });\n}\n// @__NO_SIDE_EFFECTS__\nexport function _size(size, params) {\n    return new checks.$ZodCheckSizeEquals({\n        check: \"size_equals\",\n        ...util.normalizeParams(params),\n        size,\n    });\n}\n// @__NO_SIDE_EFFECTS__\nexport function _maxLength(maximum, params) {\n    const ch = new checks.$ZodCheckMaxLength({\n        check: \"max_length\",\n        ...util.normalizeParams(params),\n        maximum,\n    });\n    return ch;\n}\n// @__NO_SIDE_EFFECTS__\nexport function _minLength(minimum, params) {\n    return new checks.$ZodCheckMinLength({\n        check: \"min_length\",\n        ...util.normalizeParams(params),\n        minimum,\n    });\n}\n// @__NO_SIDE_EFFECTS__\nexport function _length(length, params) {\n    return new checks.$ZodCheckLengthEquals({\n        check: \"length_equals\",\n        ...util.normalizeParams(params),\n        length,\n    });\n}\n// @__NO_SIDE_EFFECTS__\nexport function _regex(pattern, params) {\n    return new checks.$ZodCheckRegex({\n        check: \"string_format\",\n        format: \"regex\",\n        ...util.normalizeParams(params),\n        pattern,\n    });\n}\n// @__NO_SIDE_EFFECTS__\nexport function _lowercase(params) {\n    return new checks.$ZodCheckLowerCase({\n        check: \"string_format\",\n        format: \"lowercase\",\n        ...util.normalizeParams(params),\n    });\n}\n// @__NO_SIDE_EFFECTS__\nexport function _uppercase(params) {\n    return new checks.$ZodCheckUpperCase({\n        check: \"string_format\",\n        format: \"uppercase\",\n        ...util.normalizeParams(params),\n    });\n}\n// @__NO_SIDE_EFFECTS__\nexport function _includes(includes, params) {\n    return new checks.$ZodCheckIncludes({\n        check: \"string_format\",\n        format: \"includes\",\n        ...util.normalizeParams(params),\n        includes,\n    });\n}\n// @__NO_SIDE_EFFECTS__\nexport function _startsWith(prefix, params) {\n    return new checks.$ZodCheckStartsWith({\n        check: \"string_format\",\n        format: \"starts_with\",\n        ...util.normalizeParams(params),\n        prefix,\n    });\n}\n// @__NO_SIDE_EFFECTS__\nexport function _endsWith(suffix, params) {\n    return new checks.$ZodCheckEndsWith({\n        check: \"string_format\",\n        format: \"ends_with\",\n        ...util.normalizeParams(params),\n        suffix,\n    });\n}\n// @__NO_SIDE_EFFECTS__\nexport function _property(property, schema, params) {\n    return new checks.$ZodCheckProperty({\n        check: \"property\",\n        property,\n        schema,\n        ...util.normalizeParams(params),\n    });\n}\n// @__NO_SIDE_EFFECTS__\nexport function _mime(types, params) {\n    return new checks.$ZodCheckMimeType({\n        check: \"mime_type\",\n        mime: types,\n        ...util.normalizeParams(params),\n    });\n}\n// @__NO_SIDE_EFFECTS__\nexport function _overwrite(tx) {\n    return new checks.$ZodCheckOverwrite({\n        check: \"overwrite\",\n        tx,\n    });\n}\n// normalize\n// @__NO_SIDE_EFFECTS__\nexport function _normalize(form) {\n    return _overwrite((input) => input.normalize(form));\n}\n// trim\n// @__NO_SIDE_EFFECTS__\nexport function _trim() {\n    return _overwrite((input) => input.trim());\n}\n// toLowerCase\n// @__NO_SIDE_EFFECTS__\nexport function _toLowerCase() {\n    return _overwrite((input) => input.toLowerCase());\n}\n// toUpperCase\n// @__NO_SIDE_EFFECTS__\nexport function _toUpperCase() {\n    return _overwrite((input) => input.toUpperCase());\n}\n// slugify\n// @__NO_SIDE_EFFECTS__\nexport function _slugify() {\n    return _overwrite((input) => util.slugify(input));\n}\n// @__NO_SIDE_EFFECTS__\nexport function _array(Class, element, params) {\n    return new Class({\n        type: \"array\",\n        element,\n        // get element() {\n        //   return element;\n        // },\n        ...util.normalizeParams(params),\n    });\n}\n// @__NO_SIDE_EFFECTS__\nexport function _union(Class, options, params) {\n    return new Class({\n        type: \"union\",\n        options,\n        ...util.normalizeParams(params),\n    });\n}\nexport function _xor(Class, options, params) {\n    return new Class({\n        type: \"union\",\n        options,\n        inclusive: false,\n        ...util.normalizeParams(params),\n    });\n}\n// @__NO_SIDE_EFFECTS__\nexport function _discriminatedUnion(Class, discriminator, options, params) {\n    return new Class({\n        type: \"union\",\n        options,\n        discriminator,\n        ...util.normalizeParams(params),\n    });\n}\n// @__NO_SIDE_EFFECTS__\nexport function _intersection(Class, left, right) {\n    return new Class({\n        type: \"intersection\",\n        left,\n        right,\n    });\n}\n// export function _tuple(\n//   Class: util.SchemaClass<schemas.$ZodTuple>,\n//   items: [],\n//   params?: string | $ZodTupleParams\n// ): schemas.$ZodTuple<[], null>;\n// @__NO_SIDE_EFFECTS__\nexport function _tuple(Class, items, _paramsOrRest, _params) {\n    const hasRest = _paramsOrRest instanceof schemas.$ZodType;\n    const params = hasRest ? _params : _paramsOrRest;\n    const rest = hasRest ? _paramsOrRest : null;\n    return new Class({\n        type: \"tuple\",\n        items,\n        rest,\n        ...util.normalizeParams(params),\n    });\n}\n// @__NO_SIDE_EFFECTS__\nexport function _record(Class, keyType, valueType, params) {\n    return new Class({\n        type: \"record\",\n        keyType,\n        valueType,\n        ...util.normalizeParams(params),\n    });\n}\n// @__NO_SIDE_EFFECTS__\nexport function _map(Class, keyType, valueType, params) {\n    return new Class({\n        type: \"map\",\n        keyType,\n        valueType,\n        ...util.normalizeParams(params),\n    });\n}\n// @__NO_SIDE_EFFECTS__\nexport function _set(Class, valueType, params) {\n    return new Class({\n        type: \"set\",\n        valueType,\n        ...util.normalizeParams(params),\n    });\n}\n// @__NO_SIDE_EFFECTS__\nexport function _enum(Class, values, params) {\n    const entries = Array.isArray(values) ? Object.fromEntries(values.map((v) => [v, v])) : values;\n    // if (Array.isArray(values)) {\n    //   for (const value of values) {\n    //     entries[value] = value;\n    //   }\n    // } else {\n    //   Object.assign(entries, values);\n    // }\n    // const entries: util.EnumLike = {};\n    // for (const val of values) {\n    //   entries[val] = val;\n    // }\n    return new Class({\n        type: \"enum\",\n        entries,\n        ...util.normalizeParams(params),\n    });\n}\n// @__NO_SIDE_EFFECTS__\n/** @deprecated This API has been merged into `z.enum()`. Use `z.enum()` instead.\n *\n * ```ts\n * enum Colors { red, green, blue }\n * z.enum(Colors);\n * ```\n */\nexport function _nativeEnum(Class, entries, params) {\n    return new Class({\n        type: \"enum\",\n        entries,\n        ...util.normalizeParams(params),\n    });\n}\n// @__NO_SIDE_EFFECTS__\nexport function _literal(Class, value, params) {\n    return new Class({\n        type: \"literal\",\n        values: Array.isArray(value) ? value : [value],\n        ...util.normalizeParams(params),\n    });\n}\n// @__NO_SIDE_EFFECTS__\nexport function _file(Class, params) {\n    return new Class({\n        type: \"file\",\n        ...util.normalizeParams(params),\n    });\n}\n// @__NO_SIDE_EFFECTS__\nexport function _transform(Class, fn) {\n    return new Class({\n        type: \"transform\",\n        transform: fn,\n    });\n}\n// @__NO_SIDE_EFFECTS__\nexport function _optional(Class, innerType) {\n    return new Class({\n        type: \"optional\",\n        innerType,\n    });\n}\n// @__NO_SIDE_EFFECTS__\nexport function _nullable(Class, innerType) {\n    return new Class({\n        type: \"nullable\",\n        innerType,\n    });\n}\n// @__NO_SIDE_EFFECTS__\nexport function _default(Class, innerType, defaultValue) {\n    return new Class({\n        type: \"default\",\n        innerType,\n        get defaultValue() {\n            return typeof defaultValue === \"function\" ? defaultValue() : util.shallowClone(defaultValue);\n        },\n    });\n}\n// @__NO_SIDE_EFFECTS__\nexport function _nonoptional(Class, innerType, params) {\n    return new Class({\n        type: \"nonoptional\",\n        innerType,\n        ...util.normalizeParams(params),\n    });\n}\n// @__NO_SIDE_EFFECTS__\nexport function _success(Class, innerType) {\n    return new Class({\n        type: \"success\",\n        innerType,\n    });\n}\n// @__NO_SIDE_EFFECTS__\nexport function _catch(Class, innerType, catchValue) {\n    return new Class({\n        type: \"catch\",\n        innerType,\n        catchValue: (typeof catchValue === \"function\" ? catchValue : () => catchValue),\n    });\n}\n// @__NO_SIDE_EFFECTS__\nexport function _pipe(Class, in_, out) {\n    return new Class({\n        type: \"pipe\",\n        in: in_,\n        out,\n    });\n}\n// @__NO_SIDE_EFFECTS__\nexport function _readonly(Class, innerType) {\n    return new Class({\n        type: \"readonly\",\n        innerType,\n    });\n}\n// @__NO_SIDE_EFFECTS__\nexport function _templateLiteral(Class, parts, params) {\n    return new Class({\n        type: \"template_literal\",\n        parts,\n        ...util.normalizeParams(params),\n    });\n}\n// @__NO_SIDE_EFFECTS__\nexport function _lazy(Class, getter) {\n    return new Class({\n        type: \"lazy\",\n        getter,\n    });\n}\n// @__NO_SIDE_EFFECTS__\nexport function _promise(Class, innerType) {\n    return new Class({\n        type: \"promise\",\n        innerType,\n    });\n}\n// @__NO_SIDE_EFFECTS__\nexport function _custom(Class, fn, _params) {\n    const norm = util.normalizeParams(_params);\n    norm.abort ?? (norm.abort = true); // default to abort:false\n    const schema = new Class({\n        type: \"custom\",\n        check: \"custom\",\n        fn: fn,\n        ...norm,\n    });\n    return schema;\n}\n// same as _custom but defaults to abort:false\n// @__NO_SIDE_EFFECTS__\nexport function _refine(Class, fn, _params) {\n    const schema = new Class({\n        type: \"custom\",\n        check: \"custom\",\n        fn: fn,\n        ...util.normalizeParams(_params),\n    });\n    return schema;\n}\n// @__NO_SIDE_EFFECTS__\nexport function _superRefine(fn) {\n    const ch = _check((payload) => {\n        payload.addIssue = (issue) => {\n            if (typeof issue === \"string\") {\n                payload.issues.push(util.issue(issue, payload.value, ch._zod.def));\n            }\n            else {\n                // for Zod 3 backwards compatibility\n                const _issue = issue;\n                if (_issue.fatal)\n                    _issue.continue = false;\n                _issue.code ?? (_issue.code = \"custom\");\n                _issue.input ?? (_issue.input = payload.value);\n                _issue.inst ?? (_issue.inst = ch);\n                _issue.continue ?? (_issue.continue = !ch._zod.def.abort); // abort is always undefined, so this is always true...\n                payload.issues.push(util.issue(_issue));\n            }\n        };\n        return fn(payload.value, payload);\n    });\n    return ch;\n}\n// @__NO_SIDE_EFFECTS__\nexport function _check(fn, params) {\n    const ch = new checks.$ZodCheck({\n        check: \"custom\",\n        ...util.normalizeParams(params),\n    });\n    ch._zod.check = fn;\n    return ch;\n}\n// @__NO_SIDE_EFFECTS__\nexport function describe(description) {\n    const ch = new checks.$ZodCheck({ check: \"describe\" });\n    ch._zod.onattach = [\n        (inst) => {\n            const existing = registries.globalRegistry.get(inst) ?? {};\n            registries.globalRegistry.add(inst, { ...existing, description });\n        },\n    ];\n    ch._zod.check = () => { }; // no-op check\n    return ch;\n}\n// @__NO_SIDE_EFFECTS__\nexport function meta(metadata) {\n    const ch = new checks.$ZodCheck({ check: \"meta\" });\n    ch._zod.onattach = [\n        (inst) => {\n            const existing = registries.globalRegistry.get(inst) ?? {};\n            registries.globalRegistry.add(inst, { ...existing, ...metadata });\n        },\n    ];\n    ch._zod.check = () => { }; // no-op check\n    return ch;\n}\n// @__NO_SIDE_EFFECTS__\nexport function _stringbool(Classes, _params) {\n    const params = util.normalizeParams(_params);\n    let truthyArray = params.truthy ?? [\"true\", \"1\", \"yes\", \"on\", \"y\", \"enabled\"];\n    let falsyArray = params.falsy ?? [\"false\", \"0\", \"no\", \"off\", \"n\", \"disabled\"];\n    if (params.case !== \"sensitive\") {\n        truthyArray = truthyArray.map((v) => (typeof v === \"string\" ? v.toLowerCase() : v));\n        falsyArray = falsyArray.map((v) => (typeof v === \"string\" ? v.toLowerCase() : v));\n    }\n    const truthySet = new Set(truthyArray);\n    const falsySet = new Set(falsyArray);\n    const _Codec = Classes.Codec ?? schemas.$ZodCodec;\n    const _Boolean = Classes.Boolean ?? schemas.$ZodBoolean;\n    const _String = Classes.String ?? schemas.$ZodString;\n    const stringSchema = new _String({ type: \"string\", error: params.error });\n    const booleanSchema = new _Boolean({ type: \"boolean\", error: params.error });\n    const codec = new _Codec({\n        type: \"pipe\",\n        in: stringSchema,\n        out: booleanSchema,\n        transform: ((input, payload) => {\n            let data = input;\n            if (params.case !== \"sensitive\")\n                data = data.toLowerCase();\n            if (truthySet.has(data)) {\n                return true;\n            }\n            else if (falsySet.has(data)) {\n                return false;\n            }\n            else {\n                payload.issues.push({\n                    code: \"invalid_value\",\n                    expected: \"stringbool\",\n                    values: [...truthySet, ...falsySet],\n                    input: payload.value,\n                    inst: codec,\n                    continue: false,\n                });\n                return {};\n            }\n        }),\n        reverseTransform: ((input, _payload) => {\n            if (input === true) {\n                return truthyArray[0] || \"true\";\n            }\n            else {\n                return falsyArray[0] || \"false\";\n            }\n        }),\n        error: params.error,\n    });\n    return codec;\n}\n// @__NO_SIDE_EFFECTS__\nexport function _stringFormat(Class, format, fnOrRegex, _params = {}) {\n    const params = util.normalizeParams(_params);\n    const def = {\n        ...util.normalizeParams(_params),\n        check: \"string_format\",\n        type: \"string\",\n        format,\n        fn: typeof fnOrRegex === \"function\" ? fnOrRegex : (val) => fnOrRegex.test(val),\n        ...params,\n    };\n    if (fnOrRegex instanceof RegExp) {\n        def.pattern = fnOrRegex;\n    }\n    const inst = new Class(def);\n    return inst;\n}\n","import { globalRegistry } from \"./registries.js\";\n// function initializeContext<T extends schemas.$ZodType>(inputs: JSONSchemaGeneratorParams<T>): ToJSONSchemaContext<T> {\n//   return {\n//     processor: inputs.processor,\n//     metadataRegistry: inputs.metadata ?? globalRegistry,\n//     target: inputs.target ?? \"draft-2020-12\",\n//     unrepresentable: inputs.unrepresentable ?? \"throw\",\n//   };\n// }\nexport function initializeContext(params) {\n    // Normalize target: convert old non-hyphenated versions to hyphenated versions\n    let target = params?.target ?? \"draft-2020-12\";\n    if (target === \"draft-4\")\n        target = \"draft-04\";\n    if (target === \"draft-7\")\n        target = \"draft-07\";\n    return {\n        processors: params.processors ?? {},\n        metadataRegistry: params?.metadata ?? globalRegistry,\n        target,\n        unrepresentable: params?.unrepresentable ?? \"throw\",\n        override: params?.override ?? (() => { }),\n        io: params?.io ?? \"output\",\n        counter: 0,\n        seen: new Map(),\n        cycles: params?.cycles ?? \"ref\",\n        reused: params?.reused ?? \"inline\",\n        external: params?.external ?? undefined,\n    };\n}\nexport function process(schema, ctx, _params = { path: [], schemaPath: [] }) {\n    var _a;\n    const def = schema._zod.def;\n    // check for schema in seens\n    const seen = ctx.seen.get(schema);\n    if (seen) {\n        seen.count++;\n        // check if cycle\n        const isCycle = _params.schemaPath.includes(schema);\n        if (isCycle) {\n            seen.cycle = _params.path;\n        }\n        return seen.schema;\n    }\n    // initialize\n    const result = { schema: {}, count: 1, cycle: undefined, path: _params.path };\n    ctx.seen.set(schema, result);\n    // custom method overrides default behavior\n    const overrideSchema = schema._zod.toJSONSchema?.();\n    if (overrideSchema) {\n        result.schema = overrideSchema;\n    }\n    else {\n        const params = {\n            ..._params,\n            schemaPath: [..._params.schemaPath, schema],\n            path: _params.path,\n        };\n        if (schema._zod.processJSONSchema) {\n            schema._zod.processJSONSchema(ctx, result.schema, params);\n        }\n        else {\n            const _json = result.schema;\n            const processor = ctx.processors[def.type];\n            if (!processor) {\n                throw new Error(`[toJSONSchema]: Non-representable type encountered: ${def.type}`);\n            }\n            processor(schema, ctx, _json, params);\n        }\n        const parent = schema._zod.parent;\n        if (parent) {\n            // Also set ref if processor didn't (for inheritance)\n            if (!result.ref)\n                result.ref = parent;\n            process(parent, ctx, params);\n            ctx.seen.get(parent).isParent = true;\n        }\n    }\n    // metadata\n    const meta = ctx.metadataRegistry.get(schema);\n    if (meta)\n        Object.assign(result.schema, meta);\n    if (ctx.io === \"input\" && isTransforming(schema)) {\n        // examples/defaults only apply to output type of pipe\n        delete result.schema.examples;\n        delete result.schema.default;\n    }\n    // set prefault as default\n    if (ctx.io === \"input\" && result.schema._prefault)\n        (_a = result.schema).default ?? (_a.default = result.schema._prefault);\n    delete result.schema._prefault;\n    // pulling fresh from ctx.seen in case it was overwritten\n    const _result = ctx.seen.get(schema);\n    return _result.schema;\n}\nexport function extractDefs(ctx, schema\n// params: EmitParams\n) {\n    // iterate over seen map;\n    const root = ctx.seen.get(schema);\n    if (!root)\n        throw new Error(\"Unprocessed schema. This is a bug in Zod.\");\n    // Track ids to detect duplicates across different schemas\n    const idToSchema = new Map();\n    for (const entry of ctx.seen.entries()) {\n        const id = ctx.metadataRegistry.get(entry[0])?.id;\n        if (id) {\n            const existing = idToSchema.get(id);\n            if (existing && existing !== entry[0]) {\n                throw new Error(`Duplicate schema id \"${id}\" detected during JSON Schema conversion. Two different schemas cannot share the same id when converted together.`);\n            }\n            idToSchema.set(id, entry[0]);\n        }\n    }\n    // returns a ref to the schema\n    // defId will be empty if the ref points to an external schema (or #)\n    const makeURI = (entry) => {\n        // comparing the seen objects because sometimes\n        // multiple schemas map to the same seen object.\n        // e.g. lazy\n        // external is configured\n        const defsSegment = ctx.target === \"draft-2020-12\" ? \"$defs\" : \"definitions\";\n        if (ctx.external) {\n            const externalId = ctx.external.registry.get(entry[0])?.id; // ?? \"__shared\";// `__schema${ctx.counter++}`;\n            // check if schema is in the external registry\n            const uriGenerator = ctx.external.uri ?? ((id) => id);\n            if (externalId) {\n                return { ref: uriGenerator(externalId) };\n            }\n            // otherwise, add to __shared\n            const id = entry[1].defId ?? entry[1].schema.id ?? `schema${ctx.counter++}`;\n            entry[1].defId = id; // set defId so it will be reused if needed\n            return { defId: id, ref: `${uriGenerator(\"__shared\")}#/${defsSegment}/${id}` };\n        }\n        if (entry[1] === root) {\n            return { ref: \"#\" };\n        }\n        // self-contained schema\n        const uriPrefix = `#`;\n        const defUriPrefix = `${uriPrefix}/${defsSegment}/`;\n        const defId = entry[1].schema.id ?? `__schema${ctx.counter++}`;\n        return { defId, ref: defUriPrefix + defId };\n    };\n    // stored cached version in `def` property\n    // remove all properties, set $ref\n    const extractToDef = (entry) => {\n        // if the schema is already a reference, do not extract it\n        if (entry[1].schema.$ref) {\n            return;\n        }\n        const seen = entry[1];\n        const { ref, defId } = makeURI(entry);\n        seen.def = { ...seen.schema };\n        // defId won't be set if the schema is a reference to an external schema\n        // or if the schema is the root schema\n        if (defId)\n            seen.defId = defId;\n        // wipe away all properties except $ref\n        const schema = seen.schema;\n        for (const key in schema) {\n            delete schema[key];\n        }\n        schema.$ref = ref;\n    };\n    // throw on cycles\n    // break cycles\n    if (ctx.cycles === \"throw\") {\n        for (const entry of ctx.seen.entries()) {\n            const seen = entry[1];\n            if (seen.cycle) {\n                throw new Error(\"Cycle detected: \" +\n                    `#/${seen.cycle?.join(\"/\")}/<root>` +\n                    '\\n\\nSet the `cycles` parameter to `\"ref\"` to resolve cyclical schemas with defs.');\n            }\n        }\n    }\n    // extract schemas into $defs\n    for (const entry of ctx.seen.entries()) {\n        const seen = entry[1];\n        // convert root schema to # $ref\n        if (schema === entry[0]) {\n            extractToDef(entry); // this has special handling for the root schema\n            continue;\n        }\n        // extract schemas that are in the external registry\n        if (ctx.external) {\n            const ext = ctx.external.registry.get(entry[0])?.id;\n            if (schema !== entry[0] && ext) {\n                extractToDef(entry);\n                continue;\n            }\n        }\n        // extract schemas with `id` meta\n        const id = ctx.metadataRegistry.get(entry[0])?.id;\n        if (id) {\n            extractToDef(entry);\n            continue;\n        }\n        // break cycles\n        if (seen.cycle) {\n            // any\n            extractToDef(entry);\n            continue;\n        }\n        // extract reused schemas\n        if (seen.count > 1) {\n            if (ctx.reused === \"ref\") {\n                extractToDef(entry);\n                // biome-ignore lint:\n                continue;\n            }\n        }\n    }\n}\nexport function finalize(ctx, schema) {\n    const root = ctx.seen.get(schema);\n    if (!root)\n        throw new Error(\"Unprocessed schema. This is a bug in Zod.\");\n    // flatten refs - inherit properties from parent schemas\n    const flattenRef = (zodSchema) => {\n        const seen = ctx.seen.get(zodSchema);\n        // already processed\n        if (seen.ref === null)\n            return;\n        const schema = seen.def ?? seen.schema;\n        const _cached = { ...schema };\n        const ref = seen.ref;\n        seen.ref = null; // prevent infinite recursion\n        if (ref) {\n            flattenRef(ref);\n            const refSeen = ctx.seen.get(ref);\n            const refSchema = refSeen.schema;\n            // merge referenced schema into current\n            if (refSchema.$ref && (ctx.target === \"draft-07\" || ctx.target === \"draft-04\" || ctx.target === \"openapi-3.0\")) {\n                // older drafts can't combine $ref with other properties\n                schema.allOf = schema.allOf ?? [];\n                schema.allOf.push(refSchema);\n            }\n            else {\n                Object.assign(schema, refSchema);\n            }\n            // restore child's own properties (child wins)\n            Object.assign(schema, _cached);\n            const isParentRef = zodSchema._zod.parent === ref;\n            // For parent chain, child is a refinement - remove parent-only properties\n            if (isParentRef) {\n                for (const key in schema) {\n                    if (key === \"$ref\" || key === \"allOf\")\n                        continue;\n                    if (!(key in _cached)) {\n                        delete schema[key];\n                    }\n                }\n            }\n            // When ref was extracted to $defs, remove properties that match the definition\n            if (refSchema.$ref && refSeen.def) {\n                for (const key in schema) {\n                    if (key === \"$ref\" || key === \"allOf\")\n                        continue;\n                    if (key in refSeen.def && JSON.stringify(schema[key]) === JSON.stringify(refSeen.def[key])) {\n                        delete schema[key];\n                    }\n                }\n            }\n        }\n        // If parent was extracted (has $ref), propagate $ref to this schema\n        // This handles cases like: readonly().meta({id}).describe()\n        // where processor sets ref to innerType but parent should be referenced\n        const parent = zodSchema._zod.parent;\n        if (parent && parent !== ref) {\n            // Ensure parent is processed first so its def has inherited properties\n            flattenRef(parent);\n            const parentSeen = ctx.seen.get(parent);\n            if (parentSeen?.schema.$ref) {\n                schema.$ref = parentSeen.schema.$ref;\n                // De-duplicate with parent's definition\n                if (parentSeen.def) {\n                    for (const key in schema) {\n                        if (key === \"$ref\" || key === \"allOf\")\n                            continue;\n                        if (key in parentSeen.def && JSON.stringify(schema[key]) === JSON.stringify(parentSeen.def[key])) {\n                            delete schema[key];\n                        }\n                    }\n                }\n            }\n        }\n        // execute overrides\n        ctx.override({\n            zodSchema: zodSchema,\n            jsonSchema: schema,\n            path: seen.path ?? [],\n        });\n    };\n    for (const entry of [...ctx.seen.entries()].reverse()) {\n        flattenRef(entry[0]);\n    }\n    const result = {};\n    if (ctx.target === \"draft-2020-12\") {\n        result.$schema = \"https://json-schema.org/draft/2020-12/schema\";\n    }\n    else if (ctx.target === \"draft-07\") {\n        result.$schema = \"http://json-schema.org/draft-07/schema#\";\n    }\n    else if (ctx.target === \"draft-04\") {\n        result.$schema = \"http://json-schema.org/draft-04/schema#\";\n    }\n    else if (ctx.target === \"openapi-3.0\") {\n        // OpenAPI 3.0 schema objects should not include a $schema property\n    }\n    else {\n        // Arbitrary string values are allowed but won't have a $schema property set\n    }\n    if (ctx.external?.uri) {\n        const id = ctx.external.registry.get(schema)?.id;\n        if (!id)\n            throw new Error(\"Schema is missing an `id` property\");\n        result.$id = ctx.external.uri(id);\n    }\n    Object.assign(result, root.def ?? root.schema);\n    // build defs object\n    const defs = ctx.external?.defs ?? {};\n    for (const entry of ctx.seen.entries()) {\n        const seen = entry[1];\n        if (seen.def && seen.defId) {\n            defs[seen.defId] = seen.def;\n        }\n    }\n    // set definitions in result\n    if (ctx.external) {\n    }\n    else {\n        if (Object.keys(defs).length > 0) {\n            if (ctx.target === \"draft-2020-12\") {\n                result.$defs = defs;\n            }\n            else {\n                result.definitions = defs;\n            }\n        }\n    }\n    try {\n        // this \"finalizes\" this schema and ensures all cycles are removed\n        // each call to finalize() is functionally independent\n        // though the seen map is shared\n        const finalized = JSON.parse(JSON.stringify(result));\n        Object.defineProperty(finalized, \"~standard\", {\n            value: {\n                ...schema[\"~standard\"],\n                jsonSchema: {\n                    input: createStandardJSONSchemaMethod(schema, \"input\", ctx.processors),\n                    output: createStandardJSONSchemaMethod(schema, \"output\", ctx.processors),\n                },\n            },\n            enumerable: false,\n            writable: false,\n        });\n        return finalized;\n    }\n    catch (_err) {\n        throw new Error(\"Error converting schema to JSON.\");\n    }\n}\nfunction isTransforming(_schema, _ctx) {\n    const ctx = _ctx ?? { seen: new Set() };\n    if (ctx.seen.has(_schema))\n        return false;\n    ctx.seen.add(_schema);\n    const def = _schema._zod.def;\n    if (def.type === \"transform\")\n        return true;\n    if (def.type === \"array\")\n        return isTransforming(def.element, ctx);\n    if (def.type === \"set\")\n        return isTransforming(def.valueType, ctx);\n    if (def.type === \"lazy\")\n        return isTransforming(def.getter(), ctx);\n    if (def.type === \"promise\" ||\n        def.type === \"optional\" ||\n        def.type === \"nonoptional\" ||\n        def.type === \"nullable\" ||\n        def.type === \"readonly\" ||\n        def.type === \"default\" ||\n        def.type === \"prefault\") {\n        return isTransforming(def.innerType, ctx);\n    }\n    if (def.type === \"intersection\") {\n        return isTransforming(def.left, ctx) || isTransforming(def.right, ctx);\n    }\n    if (def.type === \"record\" || def.type === \"map\") {\n        return isTransforming(def.keyType, ctx) || isTransforming(def.valueType, ctx);\n    }\n    if (def.type === \"pipe\") {\n        return isTransforming(def.in, ctx) || isTransforming(def.out, ctx);\n    }\n    if (def.type === \"object\") {\n        for (const key in def.shape) {\n            if (isTransforming(def.shape[key], ctx))\n                return true;\n        }\n        return false;\n    }\n    if (def.type === \"union\") {\n        for (const option of def.options) {\n            if (isTransforming(option, ctx))\n                return true;\n        }\n        return false;\n    }\n    if (def.type === \"tuple\") {\n        for (const item of def.items) {\n            if (isTransforming(item, ctx))\n                return true;\n        }\n        if (def.rest && isTransforming(def.rest, ctx))\n            return true;\n        return false;\n    }\n    return false;\n}\n/**\n * Creates a toJSONSchema method for a schema instance.\n * This encapsulates the logic of initializing context, processing, extracting defs, and finalizing.\n */\nexport const createToJSONSchemaMethod = (schema, processors = {}) => (params) => {\n    const ctx = initializeContext({ ...params, processors });\n    process(schema, ctx);\n    extractDefs(ctx, schema);\n    return finalize(ctx, schema);\n};\nexport const createStandardJSONSchemaMethod = (schema, io, processors = {}) => (params) => {\n    const { libraryOptions, target } = params ?? {};\n    const ctx = initializeContext({ ...(libraryOptions ?? {}), target, io, processors });\n    process(schema, ctx);\n    extractDefs(ctx, schema);\n    return finalize(ctx, schema);\n};\n","import { extractDefs, finalize, initializeContext, process, } from \"./to-json-schema.js\";\nimport { getEnumValues } from \"./util.js\";\nconst formatMap = {\n    guid: \"uuid\",\n    url: \"uri\",\n    datetime: \"date-time\",\n    json_string: \"json-string\",\n    regex: \"\", // do not set\n};\n// ==================== SIMPLE TYPE PROCESSORS ====================\nexport const stringProcessor = (schema, ctx, _json, _params) => {\n    const json = _json;\n    json.type = \"string\";\n    const { minimum, maximum, format, patterns, contentEncoding } = schema._zod\n        .bag;\n    if (typeof minimum === \"number\")\n        json.minLength = minimum;\n    if (typeof maximum === \"number\")\n        json.maxLength = maximum;\n    // custom pattern overrides format\n    if (format) {\n        json.format = formatMap[format] ?? format;\n        if (json.format === \"\")\n            delete json.format; // empty format is not valid\n        // JSON Schema format: \"time\" requires a full time with offset or Z\n        // z.iso.time() does not include timezone information, so format: \"time\" should never be used\n        if (format === \"time\") {\n            delete json.format;\n        }\n    }\n    if (contentEncoding)\n        json.contentEncoding = contentEncoding;\n    if (patterns && patterns.size > 0) {\n        const regexes = [...patterns];\n        if (regexes.length === 1)\n            json.pattern = regexes[0].source;\n        else if (regexes.length > 1) {\n            json.allOf = [\n                ...regexes.map((regex) => ({\n                    ...(ctx.target === \"draft-07\" || ctx.target === \"draft-04\" || ctx.target === \"openapi-3.0\"\n                        ? { type: \"string\" }\n                        : {}),\n                    pattern: regex.source,\n                })),\n            ];\n        }\n    }\n};\nexport const numberProcessor = (schema, ctx, _json, _params) => {\n    const json = _json;\n    const { minimum, maximum, format, multipleOf, exclusiveMaximum, exclusiveMinimum } = schema._zod.bag;\n    if (typeof format === \"string\" && format.includes(\"int\"))\n        json.type = \"integer\";\n    else\n        json.type = \"number\";\n    if (typeof exclusiveMinimum === \"number\") {\n        if (ctx.target === \"draft-04\" || ctx.target === \"openapi-3.0\") {\n            json.minimum = exclusiveMinimum;\n            json.exclusiveMinimum = true;\n        }\n        else {\n            json.exclusiveMinimum = exclusiveMinimum;\n        }\n    }\n    if (typeof minimum === \"number\") {\n        json.minimum = minimum;\n        if (typeof exclusiveMinimum === \"number\" && ctx.target !== \"draft-04\") {\n            if (exclusiveMinimum >= minimum)\n                delete json.minimum;\n            else\n                delete json.exclusiveMinimum;\n        }\n    }\n    if (typeof exclusiveMaximum === \"number\") {\n        if (ctx.target === \"draft-04\" || ctx.target === \"openapi-3.0\") {\n            json.maximum = exclusiveMaximum;\n            json.exclusiveMaximum = true;\n        }\n        else {\n            json.exclusiveMaximum = exclusiveMaximum;\n        }\n    }\n    if (typeof maximum === \"number\") {\n        json.maximum = maximum;\n        if (typeof exclusiveMaximum === \"number\" && ctx.target !== \"draft-04\") {\n            if (exclusiveMaximum <= maximum)\n                delete json.maximum;\n            else\n                delete json.exclusiveMaximum;\n        }\n    }\n    if (typeof multipleOf === \"number\")\n        json.multipleOf = multipleOf;\n};\nexport const booleanProcessor = (_schema, _ctx, json, _params) => {\n    json.type = \"boolean\";\n};\nexport const bigintProcessor = (_schema, ctx, _json, _params) => {\n    if (ctx.unrepresentable === \"throw\") {\n        throw new Error(\"BigInt cannot be represented in JSON Schema\");\n    }\n};\nexport const symbolProcessor = (_schema, ctx, _json, _params) => {\n    if (ctx.unrepresentable === \"throw\") {\n        throw new Error(\"Symbols cannot be represented in JSON Schema\");\n    }\n};\nexport const nullProcessor = (_schema, ctx, json, _params) => {\n    if (ctx.target === \"openapi-3.0\") {\n        json.type = \"string\";\n        json.nullable = true;\n        json.enum = [null];\n    }\n    else {\n        json.type = \"null\";\n    }\n};\nexport const undefinedProcessor = (_schema, ctx, _json, _params) => {\n    if (ctx.unrepresentable === \"throw\") {\n        throw new Error(\"Undefined cannot be represented in JSON Schema\");\n    }\n};\nexport const voidProcessor = (_schema, ctx, _json, _params) => {\n    if (ctx.unrepresentable === \"throw\") {\n        throw new Error(\"Void cannot be represented in JSON Schema\");\n    }\n};\nexport const neverProcessor = (_schema, _ctx, json, _params) => {\n    json.not = {};\n};\nexport const anyProcessor = (_schema, _ctx, _json, _params) => {\n    // empty schema accepts anything\n};\nexport const unknownProcessor = (_schema, _ctx, _json, _params) => {\n    // empty schema accepts anything\n};\nexport const dateProcessor = (_schema, ctx, _json, _params) => {\n    if (ctx.unrepresentable === \"throw\") {\n        throw new Error(\"Date cannot be represented in JSON Schema\");\n    }\n};\nexport const enumProcessor = (schema, _ctx, json, _params) => {\n    const def = schema._zod.def;\n    const values = getEnumValues(def.entries);\n    // Number enums can have both string and number values\n    if (values.every((v) => typeof v === \"number\"))\n        json.type = \"number\";\n    if (values.every((v) => typeof v === \"string\"))\n        json.type = \"string\";\n    json.enum = values;\n};\nexport const literalProcessor = (schema, ctx, json, _params) => {\n    const def = schema._zod.def;\n    const vals = [];\n    for (const val of def.values) {\n        if (val === undefined) {\n            if (ctx.unrepresentable === \"throw\") {\n                throw new Error(\"Literal `undefined` cannot be represented in JSON Schema\");\n            }\n            else {\n                // do not add to vals\n            }\n        }\n        else if (typeof val === \"bigint\") {\n            if (ctx.unrepresentable === \"throw\") {\n                throw new Error(\"BigInt literals cannot be represented in JSON Schema\");\n            }\n            else {\n                vals.push(Number(val));\n            }\n        }\n        else {\n            vals.push(val);\n        }\n    }\n    if (vals.length === 0) {\n        // do nothing (an undefined literal was stripped)\n    }\n    else if (vals.length === 1) {\n        const val = vals[0];\n        json.type = val === null ? \"null\" : typeof val;\n        if (ctx.target === \"draft-04\" || ctx.target === \"openapi-3.0\") {\n            json.enum = [val];\n        }\n        else {\n            json.const = val;\n        }\n    }\n    else {\n        if (vals.every((v) => typeof v === \"number\"))\n            json.type = \"number\";\n        if (vals.every((v) => typeof v === \"string\"))\n            json.type = \"string\";\n        if (vals.every((v) => typeof v === \"boolean\"))\n            json.type = \"boolean\";\n        if (vals.every((v) => v === null))\n            json.type = \"null\";\n        json.enum = vals;\n    }\n};\nexport const nanProcessor = (_schema, ctx, _json, _params) => {\n    if (ctx.unrepresentable === \"throw\") {\n        throw new Error(\"NaN cannot be represented in JSON Schema\");\n    }\n};\nexport const templateLiteralProcessor = (schema, _ctx, json, _params) => {\n    const _json = json;\n    const pattern = schema._zod.pattern;\n    if (!pattern)\n        throw new Error(\"Pattern not found in template literal\");\n    _json.type = \"string\";\n    _json.pattern = pattern.source;\n};\nexport const fileProcessor = (schema, _ctx, json, _params) => {\n    const _json = json;\n    const file = {\n        type: \"string\",\n        format: \"binary\",\n        contentEncoding: \"binary\",\n    };\n    const { minimum, maximum, mime } = schema._zod.bag;\n    if (minimum !== undefined)\n        file.minLength = minimum;\n    if (maximum !== undefined)\n        file.maxLength = maximum;\n    if (mime) {\n        if (mime.length === 1) {\n            file.contentMediaType = mime[0];\n            Object.assign(_json, file);\n        }\n        else {\n            Object.assign(_json, file); // shared props at root\n            _json.anyOf = mime.map((m) => ({ contentMediaType: m })); // only contentMediaType differs\n        }\n    }\n    else {\n        Object.assign(_json, file);\n    }\n};\nexport const successProcessor = (_schema, _ctx, json, _params) => {\n    json.type = \"boolean\";\n};\nexport const customProcessor = (_schema, ctx, _json, _params) => {\n    if (ctx.unrepresentable === \"throw\") {\n        throw new Error(\"Custom types cannot be represented in JSON Schema\");\n    }\n};\nexport const functionProcessor = (_schema, ctx, _json, _params) => {\n    if (ctx.unrepresentable === \"throw\") {\n        throw new Error(\"Function types cannot be represented in JSON Schema\");\n    }\n};\nexport const transformProcessor = (_schema, ctx, _json, _params) => {\n    if (ctx.unrepresentable === \"throw\") {\n        throw new Error(\"Transforms cannot be represented in JSON Schema\");\n    }\n};\nexport const mapProcessor = (_schema, ctx, _json, _params) => {\n    if (ctx.unrepresentable === \"throw\") {\n        throw new Error(\"Map cannot be represented in JSON Schema\");\n    }\n};\nexport const setProcessor = (_schema, ctx, _json, _params) => {\n    if (ctx.unrepresentable === \"throw\") {\n        throw new Error(\"Set cannot be represented in JSON Schema\");\n    }\n};\n// ==================== COMPOSITE TYPE PROCESSORS ====================\nexport const arrayProcessor = (schema, ctx, _json, params) => {\n    const json = _json;\n    const def = schema._zod.def;\n    const { minimum, maximum } = schema._zod.bag;\n    if (typeof minimum === \"number\")\n        json.minItems = minimum;\n    if (typeof maximum === \"number\")\n        json.maxItems = maximum;\n    json.type = \"array\";\n    json.items = process(def.element, ctx, { ...params, path: [...params.path, \"items\"] });\n};\nexport const objectProcessor = (schema, ctx, _json, params) => {\n    const json = _json;\n    const def = schema._zod.def;\n    json.type = \"object\";\n    json.properties = {};\n    const shape = def.shape;\n    for (const key in shape) {\n        json.properties[key] = process(shape[key], ctx, {\n            ...params,\n            path: [...params.path, \"properties\", key],\n        });\n    }\n    // required keys\n    const allKeys = new Set(Object.keys(shape));\n    const requiredKeys = new Set([...allKeys].filter((key) => {\n        const v = def.shape[key]._zod;\n        if (ctx.io === \"input\") {\n            return v.optin === undefined;\n        }\n        else {\n            return v.optout === undefined;\n        }\n    }));\n    if (requiredKeys.size > 0) {\n        json.required = Array.from(requiredKeys);\n    }\n    // catchall\n    if (def.catchall?._zod.def.type === \"never\") {\n        // strict\n        json.additionalProperties = false;\n    }\n    else if (!def.catchall) {\n        // regular\n        if (ctx.io === \"output\")\n            json.additionalProperties = false;\n    }\n    else if (def.catchall) {\n        json.additionalProperties = process(def.catchall, ctx, {\n            ...params,\n            path: [...params.path, \"additionalProperties\"],\n        });\n    }\n};\nexport const unionProcessor = (schema, ctx, json, params) => {\n    const def = schema._zod.def;\n    // Exclusive unions (inclusive === false) use oneOf (exactly one match) instead of anyOf (one or more matches)\n    // This includes both z.xor() and discriminated unions\n    const isExclusive = def.inclusive === false;\n    const options = def.options.map((x, i) => process(x, ctx, {\n        ...params,\n        path: [...params.path, isExclusive ? \"oneOf\" : \"anyOf\", i],\n    }));\n    if (isExclusive) {\n        json.oneOf = options;\n    }\n    else {\n        json.anyOf = options;\n    }\n};\nexport const intersectionProcessor = (schema, ctx, json, params) => {\n    const def = schema._zod.def;\n    const a = process(def.left, ctx, {\n        ...params,\n        path: [...params.path, \"allOf\", 0],\n    });\n    const b = process(def.right, ctx, {\n        ...params,\n        path: [...params.path, \"allOf\", 1],\n    });\n    const isSimpleIntersection = (val) => \"allOf\" in val && Object.keys(val).length === 1;\n    const allOf = [\n        ...(isSimpleIntersection(a) ? a.allOf : [a]),\n        ...(isSimpleIntersection(b) ? b.allOf : [b]),\n    ];\n    json.allOf = allOf;\n};\nexport const tupleProcessor = (schema, ctx, _json, params) => {\n    const json = _json;\n    const def = schema._zod.def;\n    json.type = \"array\";\n    const prefixPath = ctx.target === \"draft-2020-12\" ? \"prefixItems\" : \"items\";\n    const restPath = ctx.target === \"draft-2020-12\" ? \"items\" : ctx.target === \"openapi-3.0\" ? \"items\" : \"additionalItems\";\n    const prefixItems = def.items.map((x, i) => process(x, ctx, {\n        ...params,\n        path: [...params.path, prefixPath, i],\n    }));\n    const rest = def.rest\n        ? process(def.rest, ctx, {\n            ...params,\n            path: [...params.path, restPath, ...(ctx.target === \"openapi-3.0\" ? [def.items.length] : [])],\n        })\n        : null;\n    if (ctx.target === \"draft-2020-12\") {\n        json.prefixItems = prefixItems;\n        if (rest) {\n            json.items = rest;\n        }\n    }\n    else if (ctx.target === \"openapi-3.0\") {\n        json.items = {\n            anyOf: prefixItems,\n        };\n        if (rest) {\n            json.items.anyOf.push(rest);\n        }\n        json.minItems = prefixItems.length;\n        if (!rest) {\n            json.maxItems = prefixItems.length;\n        }\n    }\n    else {\n        json.items = prefixItems;\n        if (rest) {\n            json.additionalItems = rest;\n        }\n    }\n    // length\n    const { minimum, maximum } = schema._zod.bag;\n    if (typeof minimum === \"number\")\n        json.minItems = minimum;\n    if (typeof maximum === \"number\")\n        json.maxItems = maximum;\n};\nexport const recordProcessor = (schema, ctx, _json, params) => {\n    const json = _json;\n    const def = schema._zod.def;\n    json.type = \"object\";\n    // For looseRecord with regex patterns, use patternProperties\n    // This correctly represents \"only validate keys matching the pattern\" semantics\n    // and composes well with allOf (intersections)\n    const keyType = def.keyType;\n    const keyBag = keyType._zod.bag;\n    const patterns = keyBag?.patterns;\n    if (def.mode === \"loose\" && patterns && patterns.size > 0) {\n        // Use patternProperties for looseRecord with regex patterns\n        const valueSchema = process(def.valueType, ctx, {\n            ...params,\n            path: [...params.path, \"patternProperties\", \"*\"],\n        });\n        json.patternProperties = {};\n        for (const pattern of patterns) {\n            json.patternProperties[pattern.source] = valueSchema;\n        }\n    }\n    else {\n        // Default behavior: use propertyNames + additionalProperties\n        if (ctx.target === \"draft-07\" || ctx.target === \"draft-2020-12\") {\n            json.propertyNames = process(def.keyType, ctx, {\n                ...params,\n                path: [...params.path, \"propertyNames\"],\n            });\n        }\n        json.additionalProperties = process(def.valueType, ctx, {\n            ...params,\n            path: [...params.path, \"additionalProperties\"],\n        });\n    }\n    // Add required for keys with discrete values (enum, literal, etc.)\n    const keyValues = keyType._zod.values;\n    if (keyValues) {\n        const validKeyValues = [...keyValues].filter((v) => typeof v === \"string\" || typeof v === \"number\");\n        if (validKeyValues.length > 0) {\n            json.required = validKeyValues;\n        }\n    }\n};\nexport const nullableProcessor = (schema, ctx, json, params) => {\n    const def = schema._zod.def;\n    const inner = process(def.innerType, ctx, params);\n    const seen = ctx.seen.get(schema);\n    if (ctx.target === \"openapi-3.0\") {\n        seen.ref = def.innerType;\n        json.nullable = true;\n    }\n    else {\n        json.anyOf = [inner, { type: \"null\" }];\n    }\n};\nexport const nonoptionalProcessor = (schema, ctx, _json, params) => {\n    const def = schema._zod.def;\n    process(def.innerType, ctx, params);\n    const seen = ctx.seen.get(schema);\n    seen.ref = def.innerType;\n};\nexport const defaultProcessor = (schema, ctx, json, params) => {\n    const def = schema._zod.def;\n    process(def.innerType, ctx, params);\n    const seen = ctx.seen.get(schema);\n    seen.ref = def.innerType;\n    json.default = JSON.parse(JSON.stringify(def.defaultValue));\n};\nexport const prefaultProcessor = (schema, ctx, json, params) => {\n    const def = schema._zod.def;\n    process(def.innerType, ctx, params);\n    const seen = ctx.seen.get(schema);\n    seen.ref = def.innerType;\n    if (ctx.io === \"input\")\n        json._prefault = JSON.parse(JSON.stringify(def.defaultValue));\n};\nexport const catchProcessor = (schema, ctx, json, params) => {\n    const def = schema._zod.def;\n    process(def.innerType, ctx, params);\n    const seen = ctx.seen.get(schema);\n    seen.ref = def.innerType;\n    let catchValue;\n    try {\n        catchValue = def.catchValue(undefined);\n    }\n    catch {\n        throw new Error(\"Dynamic catch values are not supported in JSON Schema\");\n    }\n    json.default = catchValue;\n};\nexport const pipeProcessor = (schema, ctx, _json, params) => {\n    const def = schema._zod.def;\n    const innerType = ctx.io === \"input\" ? (def.in._zod.def.type === \"transform\" ? def.out : def.in) : def.out;\n    process(innerType, ctx, params);\n    const seen = ctx.seen.get(schema);\n    seen.ref = innerType;\n};\nexport const readonlyProcessor = (schema, ctx, json, params) => {\n    const def = schema._zod.def;\n    process(def.innerType, ctx, params);\n    const seen = ctx.seen.get(schema);\n    seen.ref = def.innerType;\n    json.readOnly = true;\n};\nexport const promiseProcessor = (schema, ctx, _json, params) => {\n    const def = schema._zod.def;\n    process(def.innerType, ctx, params);\n    const seen = ctx.seen.get(schema);\n    seen.ref = def.innerType;\n};\nexport const optionalProcessor = (schema, ctx, _json, params) => {\n    const def = schema._zod.def;\n    process(def.innerType, ctx, params);\n    const seen = ctx.seen.get(schema);\n    seen.ref = def.innerType;\n};\nexport const lazyProcessor = (schema, ctx, _json, params) => {\n    const innerType = schema._zod.innerType;\n    process(innerType, ctx, params);\n    const seen = ctx.seen.get(schema);\n    seen.ref = innerType;\n};\n// ==================== ALL PROCESSORS ====================\nexport const allProcessors = {\n    string: stringProcessor,\n    number: numberProcessor,\n    boolean: booleanProcessor,\n    bigint: bigintProcessor,\n    symbol: symbolProcessor,\n    null: nullProcessor,\n    undefined: undefinedProcessor,\n    void: voidProcessor,\n    never: neverProcessor,\n    any: anyProcessor,\n    unknown: unknownProcessor,\n    date: dateProcessor,\n    enum: enumProcessor,\n    literal: literalProcessor,\n    nan: nanProcessor,\n    template_literal: templateLiteralProcessor,\n    file: fileProcessor,\n    success: successProcessor,\n    custom: customProcessor,\n    function: functionProcessor,\n    transform: transformProcessor,\n    map: mapProcessor,\n    set: setProcessor,\n    array: arrayProcessor,\n    object: objectProcessor,\n    union: unionProcessor,\n    intersection: intersectionProcessor,\n    tuple: tupleProcessor,\n    record: recordProcessor,\n    nullable: nullableProcessor,\n    nonoptional: nonoptionalProcessor,\n    default: defaultProcessor,\n    prefault: prefaultProcessor,\n    catch: catchProcessor,\n    pipe: pipeProcessor,\n    readonly: readonlyProcessor,\n    promise: promiseProcessor,\n    optional: optionalProcessor,\n    lazy: lazyProcessor,\n};\nexport function toJSONSchema(input, params) {\n    if (\"_idmap\" in input) {\n        // Registry case\n        const registry = input;\n        const ctx = initializeContext({ ...params, processors: allProcessors });\n        const defs = {};\n        // First pass: process all schemas to build the seen map\n        for (const entry of registry._idmap.entries()) {\n            const [_, schema] = entry;\n            process(schema, ctx);\n        }\n        const schemas = {};\n        const external = {\n            registry,\n            uri: params?.uri,\n            defs,\n        };\n        // Update the context with external configuration\n        ctx.external = external;\n        // Second pass: emit each schema\n        for (const entry of registry._idmap.entries()) {\n            const [key, schema] = entry;\n            extractDefs(ctx, schema);\n            schemas[key] = finalize(ctx, schema);\n        }\n        if (Object.keys(defs).length > 0) {\n            const defsSegment = ctx.target === \"draft-2020-12\" ? \"$defs\" : \"definitions\";\n            schemas.__shared = {\n                [defsSegment]: defs,\n            };\n        }\n        return { schemas };\n    }\n    // Single schema case\n    const ctx = initializeContext({ ...params, processors: allProcessors });\n    process(input, ctx);\n    extractDefs(ctx, input);\n    return finalize(ctx, input);\n}\n","import * as core from \"../core/index.js\";\nimport * as schemas from \"./schemas.js\";\nexport const ZodISODateTime = /*@__PURE__*/ core.$constructor(\"ZodISODateTime\", (inst, def) => {\n    core.$ZodISODateTime.init(inst, def);\n    schemas.ZodStringFormat.init(inst, def);\n});\nexport function datetime(params) {\n    return core._isoDateTime(ZodISODateTime, params);\n}\nexport const ZodISODate = /*@__PURE__*/ core.$constructor(\"ZodISODate\", (inst, def) => {\n    core.$ZodISODate.init(inst, def);\n    schemas.ZodStringFormat.init(inst, def);\n});\nexport function date(params) {\n    return core._isoDate(ZodISODate, params);\n}\nexport const ZodISOTime = /*@__PURE__*/ core.$constructor(\"ZodISOTime\", (inst, def) => {\n    core.$ZodISOTime.init(inst, def);\n    schemas.ZodStringFormat.init(inst, def);\n});\nexport function time(params) {\n    return core._isoTime(ZodISOTime, params);\n}\nexport const ZodISODuration = /*@__PURE__*/ core.$constructor(\"ZodISODuration\", (inst, def) => {\n    core.$ZodISODuration.init(inst, def);\n    schemas.ZodStringFormat.init(inst, def);\n});\nexport function duration(params) {\n    return core._isoDuration(ZodISODuration, params);\n}\n","import * as core from \"../core/index.js\";\nimport { $ZodError } from \"../core/index.js\";\nimport * as util from \"../core/util.js\";\nconst initializer = (inst, issues) => {\n    $ZodError.init(inst, issues);\n    inst.name = \"ZodError\";\n    Object.defineProperties(inst, {\n        format: {\n            value: (mapper) => core.formatError(inst, mapper),\n            // enumerable: false,\n        },\n        flatten: {\n            value: (mapper) => core.flattenError(inst, mapper),\n            // enumerable: false,\n        },\n        addIssue: {\n            value: (issue) => {\n                inst.issues.push(issue);\n                inst.message = JSON.stringify(inst.issues, util.jsonStringifyReplacer, 2);\n            },\n            // enumerable: false,\n        },\n        addIssues: {\n            value: (issues) => {\n                inst.issues.push(...issues);\n                inst.message = JSON.stringify(inst.issues, util.jsonStringifyReplacer, 2);\n            },\n            // enumerable: false,\n        },\n        isEmpty: {\n            get() {\n                return inst.issues.length === 0;\n            },\n            // enumerable: false,\n        },\n    });\n    // Object.defineProperty(inst, \"isEmpty\", {\n    //   get() {\n    //     return inst.issues.length === 0;\n    //   },\n    // });\n};\nexport const ZodError = core.$constructor(\"ZodError\", initializer);\nexport const ZodRealError = core.$constructor(\"ZodError\", initializer, {\n    Parent: Error,\n});\n// /** @deprecated Use `z.core.$ZodErrorMapCtx` instead. */\n// export type ErrorMapCtx = core.$ZodErrorMapCtx;\n","import * as core from \"../core/index.js\";\nimport { ZodRealError } from \"./errors.js\";\nexport const parse = /* @__PURE__ */ core._parse(ZodRealError);\nexport const parseAsync = /* @__PURE__ */ core._parseAsync(ZodRealError);\nexport const safeParse = /* @__PURE__ */ core._safeParse(ZodRealError);\nexport const safeParseAsync = /* @__PURE__ */ core._safeParseAsync(ZodRealError);\n// Codec functions\nexport const encode = /* @__PURE__ */ core._encode(ZodRealError);\nexport const decode = /* @__PURE__ */ core._decode(ZodRealError);\nexport const encodeAsync = /* @__PURE__ */ core._encodeAsync(ZodRealError);\nexport const decodeAsync = /* @__PURE__ */ core._decodeAsync(ZodRealError);\nexport const safeEncode = /* @__PURE__ */ core._safeEncode(ZodRealError);\nexport const safeDecode = /* @__PURE__ */ core._safeDecode(ZodRealError);\nexport const safeEncodeAsync = /* @__PURE__ */ core._safeEncodeAsync(ZodRealError);\nexport const safeDecodeAsync = /* @__PURE__ */ core._safeDecodeAsync(ZodRealError);\n","import * as core from \"../core/index.js\";\nimport { util } from \"../core/index.js\";\nimport * as processors from \"../core/json-schema-processors.js\";\nimport { createStandardJSONSchemaMethod, createToJSONSchemaMethod } from \"../core/to-json-schema.js\";\nimport * as checks from \"./checks.js\";\nimport * as iso from \"./iso.js\";\nimport * as parse from \"./parse.js\";\nexport const ZodType = /*@__PURE__*/ core.$constructor(\"ZodType\", (inst, def) => {\n    core.$ZodType.init(inst, def);\n    Object.assign(inst[\"~standard\"], {\n        jsonSchema: {\n            input: createStandardJSONSchemaMethod(inst, \"input\"),\n            output: createStandardJSONSchemaMethod(inst, \"output\"),\n        },\n    });\n    inst.toJSONSchema = createToJSONSchemaMethod(inst, {});\n    inst.def = def;\n    inst.type = def.type;\n    Object.defineProperty(inst, \"_def\", { value: def });\n    // base methods\n    inst.check = (...checks) => {\n        return inst.clone(util.mergeDefs(def, {\n            checks: [\n                ...(def.checks ?? []),\n                ...checks.map((ch) => typeof ch === \"function\" ? { _zod: { check: ch, def: { check: \"custom\" }, onattach: [] } } : ch),\n            ],\n        }), {\n            parent: true,\n        });\n    };\n    inst.with = inst.check;\n    inst.clone = (def, params) => core.clone(inst, def, params);\n    inst.brand = () => inst;\n    inst.register = ((reg, meta) => {\n        reg.add(inst, meta);\n        return inst;\n    });\n    // parsing\n    inst.parse = (data, params) => parse.parse(inst, data, params, { callee: inst.parse });\n    inst.safeParse = (data, params) => parse.safeParse(inst, data, params);\n    inst.parseAsync = async (data, params) => parse.parseAsync(inst, data, params, { callee: inst.parseAsync });\n    inst.safeParseAsync = async (data, params) => parse.safeParseAsync(inst, data, params);\n    inst.spa = inst.safeParseAsync;\n    // encoding/decoding\n    inst.encode = (data, params) => parse.encode(inst, data, params);\n    inst.decode = (data, params) => parse.decode(inst, data, params);\n    inst.encodeAsync = async (data, params) => parse.encodeAsync(inst, data, params);\n    inst.decodeAsync = async (data, params) => parse.decodeAsync(inst, data, params);\n    inst.safeEncode = (data, params) => parse.safeEncode(inst, data, params);\n    inst.safeDecode = (data, params) => parse.safeDecode(inst, data, params);\n    inst.safeEncodeAsync = async (data, params) => parse.safeEncodeAsync(inst, data, params);\n    inst.safeDecodeAsync = async (data, params) => parse.safeDecodeAsync(inst, data, params);\n    // refinements\n    inst.refine = (check, params) => inst.check(refine(check, params));\n    inst.superRefine = (refinement) => inst.check(superRefine(refinement));\n    inst.overwrite = (fn) => inst.check(checks.overwrite(fn));\n    // wrappers\n    inst.optional = () => optional(inst);\n    inst.exactOptional = () => exactOptional(inst);\n    inst.nullable = () => nullable(inst);\n    inst.nullish = () => optional(nullable(inst));\n    inst.nonoptional = (params) => nonoptional(inst, params);\n    inst.array = () => array(inst);\n    inst.or = (arg) => union([inst, arg]);\n    inst.and = (arg) => intersection(inst, arg);\n    inst.transform = (tx) => pipe(inst, transform(tx));\n    inst.default = (def) => _default(inst, def);\n    inst.prefault = (def) => prefault(inst, def);\n    // inst.coalesce = (def, params) => coalesce(inst, def, params);\n    inst.catch = (params) => _catch(inst, params);\n    inst.pipe = (target) => pipe(inst, target);\n    inst.readonly = () => readonly(inst);\n    // meta\n    inst.describe = (description) => {\n        const cl = inst.clone();\n        core.globalRegistry.add(cl, { description });\n        return cl;\n    };\n    Object.defineProperty(inst, \"description\", {\n        get() {\n            return core.globalRegistry.get(inst)?.description;\n        },\n        configurable: true,\n    });\n    inst.meta = (...args) => {\n        if (args.length === 0) {\n            return core.globalRegistry.get(inst);\n        }\n        const cl = inst.clone();\n        core.globalRegistry.add(cl, args[0]);\n        return cl;\n    };\n    // helpers\n    inst.isOptional = () => inst.safeParse(undefined).success;\n    inst.isNullable = () => inst.safeParse(null).success;\n    inst.apply = (fn) => fn(inst);\n    return inst;\n});\n/** @internal */\nexport const _ZodString = /*@__PURE__*/ core.$constructor(\"_ZodString\", (inst, def) => {\n    core.$ZodString.init(inst, def);\n    ZodType.init(inst, def);\n    inst._zod.processJSONSchema = (ctx, json, params) => processors.stringProcessor(inst, ctx, json, params);\n    const bag = inst._zod.bag;\n    inst.format = bag.format ?? null;\n    inst.minLength = bag.minimum ?? null;\n    inst.maxLength = bag.maximum ?? null;\n    // validations\n    inst.regex = (...args) => inst.check(checks.regex(...args));\n    inst.includes = (...args) => inst.check(checks.includes(...args));\n    inst.startsWith = (...args) => inst.check(checks.startsWith(...args));\n    inst.endsWith = (...args) => inst.check(checks.endsWith(...args));\n    inst.min = (...args) => inst.check(checks.minLength(...args));\n    inst.max = (...args) => inst.check(checks.maxLength(...args));\n    inst.length = (...args) => inst.check(checks.length(...args));\n    inst.nonempty = (...args) => inst.check(checks.minLength(1, ...args));\n    inst.lowercase = (params) => inst.check(checks.lowercase(params));\n    inst.uppercase = (params) => inst.check(checks.uppercase(params));\n    // transforms\n    inst.trim = () => inst.check(checks.trim());\n    inst.normalize = (...args) => inst.check(checks.normalize(...args));\n    inst.toLowerCase = () => inst.check(checks.toLowerCase());\n    inst.toUpperCase = () => inst.check(checks.toUpperCase());\n    inst.slugify = () => inst.check(checks.slugify());\n});\nexport const ZodString = /*@__PURE__*/ core.$constructor(\"ZodString\", (inst, def) => {\n    core.$ZodString.init(inst, def);\n    _ZodString.init(inst, def);\n    inst.email = (params) => inst.check(core._email(ZodEmail, params));\n    inst.url = (params) => inst.check(core._url(ZodURL, params));\n    inst.jwt = (params) => inst.check(core._jwt(ZodJWT, params));\n    inst.emoji = (params) => inst.check(core._emoji(ZodEmoji, params));\n    inst.guid = (params) => inst.check(core._guid(ZodGUID, params));\n    inst.uuid = (params) => inst.check(core._uuid(ZodUUID, params));\n    inst.uuidv4 = (params) => inst.check(core._uuidv4(ZodUUID, params));\n    inst.uuidv6 = (params) => inst.check(core._uuidv6(ZodUUID, params));\n    inst.uuidv7 = (params) => inst.check(core._uuidv7(ZodUUID, params));\n    inst.nanoid = (params) => inst.check(core._nanoid(ZodNanoID, params));\n    inst.guid = (params) => inst.check(core._guid(ZodGUID, params));\n    inst.cuid = (params) => inst.check(core._cuid(ZodCUID, params));\n    inst.cuid2 = (params) => inst.check(core._cuid2(ZodCUID2, params));\n    inst.ulid = (params) => inst.check(core._ulid(ZodULID, params));\n    inst.base64 = (params) => inst.check(core._base64(ZodBase64, params));\n    inst.base64url = (params) => inst.check(core._base64url(ZodBase64URL, params));\n    inst.xid = (params) => inst.check(core._xid(ZodXID, params));\n    inst.ksuid = (params) => inst.check(core._ksuid(ZodKSUID, params));\n    inst.ipv4 = (params) => inst.check(core._ipv4(ZodIPv4, params));\n    inst.ipv6 = (params) => inst.check(core._ipv6(ZodIPv6, params));\n    inst.cidrv4 = (params) => inst.check(core._cidrv4(ZodCIDRv4, params));\n    inst.cidrv6 = (params) => inst.check(core._cidrv6(ZodCIDRv6, params));\n    inst.e164 = (params) => inst.check(core._e164(ZodE164, params));\n    // iso\n    inst.datetime = (params) => inst.check(iso.datetime(params));\n    inst.date = (params) => inst.check(iso.date(params));\n    inst.time = (params) => inst.check(iso.time(params));\n    inst.duration = (params) => inst.check(iso.duration(params));\n});\nexport function string(params) {\n    return core._string(ZodString, params);\n}\nexport const ZodStringFormat = /*@__PURE__*/ core.$constructor(\"ZodStringFormat\", (inst, def) => {\n    core.$ZodStringFormat.init(inst, def);\n    _ZodString.init(inst, def);\n});\nexport const ZodEmail = /*@__PURE__*/ core.$constructor(\"ZodEmail\", (inst, def) => {\n    // ZodStringFormat.init(inst, def);\n    core.$ZodEmail.init(inst, def);\n    ZodStringFormat.init(inst, def);\n});\nexport function email(params) {\n    return core._email(ZodEmail, params);\n}\nexport const ZodGUID = /*@__PURE__*/ core.$constructor(\"ZodGUID\", (inst, def) => {\n    // ZodStringFormat.init(inst, def);\n    core.$ZodGUID.init(inst, def);\n    ZodStringFormat.init(inst, def);\n});\nexport function guid(params) {\n    return core._guid(ZodGUID, params);\n}\nexport const ZodUUID = /*@__PURE__*/ core.$constructor(\"ZodUUID\", (inst, def) => {\n    // ZodStringFormat.init(inst, def);\n    core.$ZodUUID.init(inst, def);\n    ZodStringFormat.init(inst, def);\n});\nexport function uuid(params) {\n    return core._uuid(ZodUUID, params);\n}\nexport function uuidv4(params) {\n    return core._uuidv4(ZodUUID, params);\n}\n// ZodUUIDv6\nexport function uuidv6(params) {\n    return core._uuidv6(ZodUUID, params);\n}\n// ZodUUIDv7\nexport function uuidv7(params) {\n    return core._uuidv7(ZodUUID, params);\n}\nexport const ZodURL = /*@__PURE__*/ core.$constructor(\"ZodURL\", (inst, def) => {\n    // ZodStringFormat.init(inst, def);\n    core.$ZodURL.init(inst, def);\n    ZodStringFormat.init(inst, def);\n});\nexport function url(params) {\n    return core._url(ZodURL, params);\n}\nexport function httpUrl(params) {\n    return core._url(ZodURL, {\n        protocol: /^https?$/,\n        hostname: core.regexes.domain,\n        ...util.normalizeParams(params),\n    });\n}\nexport const ZodEmoji = /*@__PURE__*/ core.$constructor(\"ZodEmoji\", (inst, def) => {\n    // ZodStringFormat.init(inst, def);\n    core.$ZodEmoji.init(inst, def);\n    ZodStringFormat.init(inst, def);\n});\nexport function emoji(params) {\n    return core._emoji(ZodEmoji, params);\n}\nexport const ZodNanoID = /*@__PURE__*/ core.$constructor(\"ZodNanoID\", (inst, def) => {\n    // ZodStringFormat.init(inst, def);\n    core.$ZodNanoID.init(inst, def);\n    ZodStringFormat.init(inst, def);\n});\nexport function nanoid(params) {\n    return core._nanoid(ZodNanoID, params);\n}\nexport const ZodCUID = /*@__PURE__*/ core.$constructor(\"ZodCUID\", (inst, def) => {\n    // ZodStringFormat.init(inst, def);\n    core.$ZodCUID.init(inst, def);\n    ZodStringFormat.init(inst, def);\n});\nexport function cuid(params) {\n    return core._cuid(ZodCUID, params);\n}\nexport const ZodCUID2 = /*@__PURE__*/ core.$constructor(\"ZodCUID2\", (inst, def) => {\n    // ZodStringFormat.init(inst, def);\n    core.$ZodCUID2.init(inst, def);\n    ZodStringFormat.init(inst, def);\n});\nexport function cuid2(params) {\n    return core._cuid2(ZodCUID2, params);\n}\nexport const ZodULID = /*@__PURE__*/ core.$constructor(\"ZodULID\", (inst, def) => {\n    // ZodStringFormat.init(inst, def);\n    core.$ZodULID.init(inst, def);\n    ZodStringFormat.init(inst, def);\n});\nexport function ulid(params) {\n    return core._ulid(ZodULID, params);\n}\nexport const ZodXID = /*@__PURE__*/ core.$constructor(\"ZodXID\", (inst, def) => {\n    // ZodStringFormat.init(inst, def);\n    core.$ZodXID.init(inst, def);\n    ZodStringFormat.init(inst, def);\n});\nexport function xid(params) {\n    return core._xid(ZodXID, params);\n}\nexport const ZodKSUID = /*@__PURE__*/ core.$constructor(\"ZodKSUID\", (inst, def) => {\n    // ZodStringFormat.init(inst, def);\n    core.$ZodKSUID.init(inst, def);\n    ZodStringFormat.init(inst, def);\n});\nexport function ksuid(params) {\n    return core._ksuid(ZodKSUID, params);\n}\nexport const ZodIPv4 = /*@__PURE__*/ core.$constructor(\"ZodIPv4\", (inst, def) => {\n    // ZodStringFormat.init(inst, def);\n    core.$ZodIPv4.init(inst, def);\n    ZodStringFormat.init(inst, def);\n});\nexport function ipv4(params) {\n    return core._ipv4(ZodIPv4, params);\n}\nexport const ZodMAC = /*@__PURE__*/ core.$constructor(\"ZodMAC\", (inst, def) => {\n    // ZodStringFormat.init(inst, def);\n    core.$ZodMAC.init(inst, def);\n    ZodStringFormat.init(inst, def);\n});\nexport function mac(params) {\n    return core._mac(ZodMAC, params);\n}\nexport const ZodIPv6 = /*@__PURE__*/ core.$constructor(\"ZodIPv6\", (inst, def) => {\n    // ZodStringFormat.init(inst, def);\n    core.$ZodIPv6.init(inst, def);\n    ZodStringFormat.init(inst, def);\n});\nexport function ipv6(params) {\n    return core._ipv6(ZodIPv6, params);\n}\nexport const ZodCIDRv4 = /*@__PURE__*/ core.$constructor(\"ZodCIDRv4\", (inst, def) => {\n    core.$ZodCIDRv4.init(inst, def);\n    ZodStringFormat.init(inst, def);\n});\nexport function cidrv4(params) {\n    return core._cidrv4(ZodCIDRv4, params);\n}\nexport const ZodCIDRv6 = /*@__PURE__*/ core.$constructor(\"ZodCIDRv6\", (inst, def) => {\n    core.$ZodCIDRv6.init(inst, def);\n    ZodStringFormat.init(inst, def);\n});\nexport function cidrv6(params) {\n    return core._cidrv6(ZodCIDRv6, params);\n}\nexport const ZodBase64 = /*@__PURE__*/ core.$constructor(\"ZodBase64\", (inst, def) => {\n    // ZodStringFormat.init(inst, def);\n    core.$ZodBase64.init(inst, def);\n    ZodStringFormat.init(inst, def);\n});\nexport function base64(params) {\n    return core._base64(ZodBase64, params);\n}\nexport const ZodBase64URL = /*@__PURE__*/ core.$constructor(\"ZodBase64URL\", (inst, def) => {\n    // ZodStringFormat.init(inst, def);\n    core.$ZodBase64URL.init(inst, def);\n    ZodStringFormat.init(inst, def);\n});\nexport function base64url(params) {\n    return core._base64url(ZodBase64URL, params);\n}\nexport const ZodE164 = /*@__PURE__*/ core.$constructor(\"ZodE164\", (inst, def) => {\n    // ZodStringFormat.init(inst, def);\n    core.$ZodE164.init(inst, def);\n    ZodStringFormat.init(inst, def);\n});\nexport function e164(params) {\n    return core._e164(ZodE164, params);\n}\nexport const ZodJWT = /*@__PURE__*/ core.$constructor(\"ZodJWT\", (inst, def) => {\n    // ZodStringFormat.init(inst, def);\n    core.$ZodJWT.init(inst, def);\n    ZodStringFormat.init(inst, def);\n});\nexport function jwt(params) {\n    return core._jwt(ZodJWT, params);\n}\nexport const ZodCustomStringFormat = /*@__PURE__*/ core.$constructor(\"ZodCustomStringFormat\", (inst, def) => {\n    // ZodStringFormat.init(inst, def);\n    core.$ZodCustomStringFormat.init(inst, def);\n    ZodStringFormat.init(inst, def);\n});\nexport function stringFormat(format, fnOrRegex, _params = {}) {\n    return core._stringFormat(ZodCustomStringFormat, format, fnOrRegex, _params);\n}\nexport function hostname(_params) {\n    return core._stringFormat(ZodCustomStringFormat, \"hostname\", core.regexes.hostname, _params);\n}\nexport function hex(_params) {\n    return core._stringFormat(ZodCustomStringFormat, \"hex\", core.regexes.hex, _params);\n}\nexport function hash(alg, params) {\n    const enc = params?.enc ?? \"hex\";\n    const format = `${alg}_${enc}`;\n    const regex = core.regexes[format];\n    if (!regex)\n        throw new Error(`Unrecognized hash format: ${format}`);\n    return core._stringFormat(ZodCustomStringFormat, format, regex, params);\n}\nexport const ZodNumber = /*@__PURE__*/ core.$constructor(\"ZodNumber\", (inst, def) => {\n    core.$ZodNumber.init(inst, def);\n    ZodType.init(inst, def);\n    inst._zod.processJSONSchema = (ctx, json, params) => processors.numberProcessor(inst, ctx, json, params);\n    inst.gt = (value, params) => inst.check(checks.gt(value, params));\n    inst.gte = (value, params) => inst.check(checks.gte(value, params));\n    inst.min = (value, params) => inst.check(checks.gte(value, params));\n    inst.lt = (value, params) => inst.check(checks.lt(value, params));\n    inst.lte = (value, params) => inst.check(checks.lte(value, params));\n    inst.max = (value, params) => inst.check(checks.lte(value, params));\n    inst.int = (params) => inst.check(int(params));\n    inst.safe = (params) => inst.check(int(params));\n    inst.positive = (params) => inst.check(checks.gt(0, params));\n    inst.nonnegative = (params) => inst.check(checks.gte(0, params));\n    inst.negative = (params) => inst.check(checks.lt(0, params));\n    inst.nonpositive = (params) => inst.check(checks.lte(0, params));\n    inst.multipleOf = (value, params) => inst.check(checks.multipleOf(value, params));\n    inst.step = (value, params) => inst.check(checks.multipleOf(value, params));\n    // inst.finite = (params) => inst.check(core.finite(params));\n    inst.finite = () => inst;\n    const bag = inst._zod.bag;\n    inst.minValue =\n        Math.max(bag.minimum ?? Number.NEGATIVE_INFINITY, bag.exclusiveMinimum ?? Number.NEGATIVE_INFINITY) ?? null;\n    inst.maxValue =\n        Math.min(bag.maximum ?? Number.POSITIVE_INFINITY, bag.exclusiveMaximum ?? Number.POSITIVE_INFINITY) ?? null;\n    inst.isInt = (bag.format ?? \"\").includes(\"int\") || Number.isSafeInteger(bag.multipleOf ?? 0.5);\n    inst.isFinite = true;\n    inst.format = bag.format ?? null;\n});\nexport function number(params) {\n    return core._number(ZodNumber, params);\n}\nexport const ZodNumberFormat = /*@__PURE__*/ core.$constructor(\"ZodNumberFormat\", (inst, def) => {\n    core.$ZodNumberFormat.init(inst, def);\n    ZodNumber.init(inst, def);\n});\nexport function int(params) {\n    return core._int(ZodNumberFormat, params);\n}\nexport function float32(params) {\n    return core._float32(ZodNumberFormat, params);\n}\nexport function float64(params) {\n    return core._float64(ZodNumberFormat, params);\n}\nexport function int32(params) {\n    return core._int32(ZodNumberFormat, params);\n}\nexport function uint32(params) {\n    return core._uint32(ZodNumberFormat, params);\n}\nexport const ZodBoolean = /*@__PURE__*/ core.$constructor(\"ZodBoolean\", (inst, def) => {\n    core.$ZodBoolean.init(inst, def);\n    ZodType.init(inst, def);\n    inst._zod.processJSONSchema = (ctx, json, params) => processors.booleanProcessor(inst, ctx, json, params);\n});\nexport function boolean(params) {\n    return core._boolean(ZodBoolean, params);\n}\nexport const ZodBigInt = /*@__PURE__*/ core.$constructor(\"ZodBigInt\", (inst, def) => {\n    core.$ZodBigInt.init(inst, def);\n    ZodType.init(inst, def);\n    inst._zod.processJSONSchema = (ctx, json, params) => processors.bigintProcessor(inst, ctx, json, params);\n    inst.gte = (value, params) => inst.check(checks.gte(value, params));\n    inst.min = (value, params) => inst.check(checks.gte(value, params));\n    inst.gt = (value, params) => inst.check(checks.gt(value, params));\n    inst.gte = (value, params) => inst.check(checks.gte(value, params));\n    inst.min = (value, params) => inst.check(checks.gte(value, params));\n    inst.lt = (value, params) => inst.check(checks.lt(value, params));\n    inst.lte = (value, params) => inst.check(checks.lte(value, params));\n    inst.max = (value, params) => inst.check(checks.lte(value, params));\n    inst.positive = (params) => inst.check(checks.gt(BigInt(0), params));\n    inst.negative = (params) => inst.check(checks.lt(BigInt(0), params));\n    inst.nonpositive = (params) => inst.check(checks.lte(BigInt(0), params));\n    inst.nonnegative = (params) => inst.check(checks.gte(BigInt(0), params));\n    inst.multipleOf = (value, params) => inst.check(checks.multipleOf(value, params));\n    const bag = inst._zod.bag;\n    inst.minValue = bag.minimum ?? null;\n    inst.maxValue = bag.maximum ?? null;\n    inst.format = bag.format ?? null;\n});\nexport function bigint(params) {\n    return core._bigint(ZodBigInt, params);\n}\nexport const ZodBigIntFormat = /*@__PURE__*/ core.$constructor(\"ZodBigIntFormat\", (inst, def) => {\n    core.$ZodBigIntFormat.init(inst, def);\n    ZodBigInt.init(inst, def);\n});\n// int64\nexport function int64(params) {\n    return core._int64(ZodBigIntFormat, params);\n}\n// uint64\nexport function uint64(params) {\n    return core._uint64(ZodBigIntFormat, params);\n}\nexport const ZodSymbol = /*@__PURE__*/ core.$constructor(\"ZodSymbol\", (inst, def) => {\n    core.$ZodSymbol.init(inst, def);\n    ZodType.init(inst, def);\n    inst._zod.processJSONSchema = (ctx, json, params) => processors.symbolProcessor(inst, ctx, json, params);\n});\nexport function symbol(params) {\n    return core._symbol(ZodSymbol, params);\n}\nexport const ZodUndefined = /*@__PURE__*/ core.$constructor(\"ZodUndefined\", (inst, def) => {\n    core.$ZodUndefined.init(inst, def);\n    ZodType.init(inst, def);\n    inst._zod.processJSONSchema = (ctx, json, params) => processors.undefinedProcessor(inst, ctx, json, params);\n});\nfunction _undefined(params) {\n    return core._undefined(ZodUndefined, params);\n}\nexport { _undefined as undefined };\nexport const ZodNull = /*@__PURE__*/ core.$constructor(\"ZodNull\", (inst, def) => {\n    core.$ZodNull.init(inst, def);\n    ZodType.init(inst, def);\n    inst._zod.processJSONSchema = (ctx, json, params) => processors.nullProcessor(inst, ctx, json, params);\n});\nfunction _null(params) {\n    return core._null(ZodNull, params);\n}\nexport { _null as null };\nexport const ZodAny = /*@__PURE__*/ core.$constructor(\"ZodAny\", (inst, def) => {\n    core.$ZodAny.init(inst, def);\n    ZodType.init(inst, def);\n    inst._zod.processJSONSchema = (ctx, json, params) => processors.anyProcessor(inst, ctx, json, params);\n});\nexport function any() {\n    return core._any(ZodAny);\n}\nexport const ZodUnknown = /*@__PURE__*/ core.$constructor(\"ZodUnknown\", (inst, def) => {\n    core.$ZodUnknown.init(inst, def);\n    ZodType.init(inst, def);\n    inst._zod.processJSONSchema = (ctx, json, params) => processors.unknownProcessor(inst, ctx, json, params);\n});\nexport function unknown() {\n    return core._unknown(ZodUnknown);\n}\nexport const ZodNever = /*@__PURE__*/ core.$constructor(\"ZodNever\", (inst, def) => {\n    core.$ZodNever.init(inst, def);\n    ZodType.init(inst, def);\n    inst._zod.processJSONSchema = (ctx, json, params) => processors.neverProcessor(inst, ctx, json, params);\n});\nexport function never(params) {\n    return core._never(ZodNever, params);\n}\nexport const ZodVoid = /*@__PURE__*/ core.$constructor(\"ZodVoid\", (inst, def) => {\n    core.$ZodVoid.init(inst, def);\n    ZodType.init(inst, def);\n    inst._zod.processJSONSchema = (ctx, json, params) => processors.voidProcessor(inst, ctx, json, params);\n});\nfunction _void(params) {\n    return core._void(ZodVoid, params);\n}\nexport { _void as void };\nexport const ZodDate = /*@__PURE__*/ core.$constructor(\"ZodDate\", (inst, def) => {\n    core.$ZodDate.init(inst, def);\n    ZodType.init(inst, def);\n    inst._zod.processJSONSchema = (ctx, json, params) => processors.dateProcessor(inst, ctx, json, params);\n    inst.min = (value, params) => inst.check(checks.gte(value, params));\n    inst.max = (value, params) => inst.check(checks.lte(value, params));\n    const c = inst._zod.bag;\n    inst.minDate = c.minimum ? new Date(c.minimum) : null;\n    inst.maxDate = c.maximum ? new Date(c.maximum) : null;\n});\nexport function date(params) {\n    return core._date(ZodDate, params);\n}\nexport const ZodArray = /*@__PURE__*/ core.$constructor(\"ZodArray\", (inst, def) => {\n    core.$ZodArray.init(inst, def);\n    ZodType.init(inst, def);\n    inst._zod.processJSONSchema = (ctx, json, params) => processors.arrayProcessor(inst, ctx, json, params);\n    inst.element = def.element;\n    inst.min = (minLength, params) => inst.check(checks.minLength(minLength, params));\n    inst.nonempty = (params) => inst.check(checks.minLength(1, params));\n    inst.max = (maxLength, params) => inst.check(checks.maxLength(maxLength, params));\n    inst.length = (len, params) => inst.check(checks.length(len, params));\n    inst.unwrap = () => inst.element;\n});\nexport function array(element, params) {\n    return core._array(ZodArray, element, params);\n}\n// .keyof\nexport function keyof(schema) {\n    const shape = schema._zod.def.shape;\n    return _enum(Object.keys(shape));\n}\nexport const ZodObject = /*@__PURE__*/ core.$constructor(\"ZodObject\", (inst, def) => {\n    core.$ZodObjectJIT.init(inst, def);\n    ZodType.init(inst, def);\n    inst._zod.processJSONSchema = (ctx, json, params) => processors.objectProcessor(inst, ctx, json, params);\n    util.defineLazy(inst, \"shape\", () => {\n        return def.shape;\n    });\n    inst.keyof = () => _enum(Object.keys(inst._zod.def.shape));\n    inst.catchall = (catchall) => inst.clone({ ...inst._zod.def, catchall: catchall });\n    inst.passthrough = () => inst.clone({ ...inst._zod.def, catchall: unknown() });\n    inst.loose = () => inst.clone({ ...inst._zod.def, catchall: unknown() });\n    inst.strict = () => inst.clone({ ...inst._zod.def, catchall: never() });\n    inst.strip = () => inst.clone({ ...inst._zod.def, catchall: undefined });\n    inst.extend = (incoming) => {\n        return util.extend(inst, incoming);\n    };\n    inst.safeExtend = (incoming) => {\n        return util.safeExtend(inst, incoming);\n    };\n    inst.merge = (other) => util.merge(inst, other);\n    inst.pick = (mask) => util.pick(inst, mask);\n    inst.omit = (mask) => util.omit(inst, mask);\n    inst.partial = (...args) => util.partial(ZodOptional, inst, args[0]);\n    inst.required = (...args) => util.required(ZodNonOptional, inst, args[0]);\n});\nexport function object(shape, params) {\n    const def = {\n        type: \"object\",\n        shape: shape ?? {},\n        ...util.normalizeParams(params),\n    };\n    return new ZodObject(def);\n}\n// strictObject\nexport function strictObject(shape, params) {\n    return new ZodObject({\n        type: \"object\",\n        shape,\n        catchall: never(),\n        ...util.normalizeParams(params),\n    });\n}\n// looseObject\nexport function looseObject(shape, params) {\n    return new ZodObject({\n        type: \"object\",\n        shape,\n        catchall: unknown(),\n        ...util.normalizeParams(params),\n    });\n}\nexport const ZodUnion = /*@__PURE__*/ core.$constructor(\"ZodUnion\", (inst, def) => {\n    core.$ZodUnion.init(inst, def);\n    ZodType.init(inst, def);\n    inst._zod.processJSONSchema = (ctx, json, params) => processors.unionProcessor(inst, ctx, json, params);\n    inst.options = def.options;\n});\nexport function union(options, params) {\n    return new ZodUnion({\n        type: \"union\",\n        options: options,\n        ...util.normalizeParams(params),\n    });\n}\nexport const ZodXor = /*@__PURE__*/ core.$constructor(\"ZodXor\", (inst, def) => {\n    ZodUnion.init(inst, def);\n    core.$ZodXor.init(inst, def);\n    inst._zod.processJSONSchema = (ctx, json, params) => processors.unionProcessor(inst, ctx, json, params);\n    inst.options = def.options;\n});\n/** Creates an exclusive union (XOR) where exactly one option must match.\n * Unlike regular unions that succeed when any option matches, xor fails if\n * zero or more than one option matches the input. */\nexport function xor(options, params) {\n    return new ZodXor({\n        type: \"union\",\n        options: options,\n        inclusive: false,\n        ...util.normalizeParams(params),\n    });\n}\nexport const ZodDiscriminatedUnion = /*@__PURE__*/ core.$constructor(\"ZodDiscriminatedUnion\", (inst, def) => {\n    ZodUnion.init(inst, def);\n    core.$ZodDiscriminatedUnion.init(inst, def);\n});\nexport function discriminatedUnion(discriminator, options, params) {\n    // const [options, params] = args;\n    return new ZodDiscriminatedUnion({\n        type: \"union\",\n        options,\n        discriminator,\n        ...util.normalizeParams(params),\n    });\n}\nexport const ZodIntersection = /*@__PURE__*/ core.$constructor(\"ZodIntersection\", (inst, def) => {\n    core.$ZodIntersection.init(inst, def);\n    ZodType.init(inst, def);\n    inst._zod.processJSONSchema = (ctx, json, params) => processors.intersectionProcessor(inst, ctx, json, params);\n});\nexport function intersection(left, right) {\n    return new ZodIntersection({\n        type: \"intersection\",\n        left: left,\n        right: right,\n    });\n}\nexport const ZodTuple = /*@__PURE__*/ core.$constructor(\"ZodTuple\", (inst, def) => {\n    core.$ZodTuple.init(inst, def);\n    ZodType.init(inst, def);\n    inst._zod.processJSONSchema = (ctx, json, params) => processors.tupleProcessor(inst, ctx, json, params);\n    inst.rest = (rest) => inst.clone({\n        ...inst._zod.def,\n        rest: rest,\n    });\n});\nexport function tuple(items, _paramsOrRest, _params) {\n    const hasRest = _paramsOrRest instanceof core.$ZodType;\n    const params = hasRest ? _params : _paramsOrRest;\n    const rest = hasRest ? _paramsOrRest : null;\n    return new ZodTuple({\n        type: \"tuple\",\n        items: items,\n        rest,\n        ...util.normalizeParams(params),\n    });\n}\nexport const ZodRecord = /*@__PURE__*/ core.$constructor(\"ZodRecord\", (inst, def) => {\n    core.$ZodRecord.init(inst, def);\n    ZodType.init(inst, def);\n    inst._zod.processJSONSchema = (ctx, json, params) => processors.recordProcessor(inst, ctx, json, params);\n    inst.keyType = def.keyType;\n    inst.valueType = def.valueType;\n});\nexport function record(keyType, valueType, params) {\n    return new ZodRecord({\n        type: \"record\",\n        keyType,\n        valueType: valueType,\n        ...util.normalizeParams(params),\n    });\n}\n// type alksjf = core.output<core.$ZodRecordKey>;\nexport function partialRecord(keyType, valueType, params) {\n    const k = core.clone(keyType);\n    k._zod.values = undefined;\n    return new ZodRecord({\n        type: \"record\",\n        keyType: k,\n        valueType: valueType,\n        ...util.normalizeParams(params),\n    });\n}\nexport function looseRecord(keyType, valueType, params) {\n    return new ZodRecord({\n        type: \"record\",\n        keyType,\n        valueType: valueType,\n        mode: \"loose\",\n        ...util.normalizeParams(params),\n    });\n}\nexport const ZodMap = /*@__PURE__*/ core.$constructor(\"ZodMap\", (inst, def) => {\n    core.$ZodMap.init(inst, def);\n    ZodType.init(inst, def);\n    inst._zod.processJSONSchema = (ctx, json, params) => processors.mapProcessor(inst, ctx, json, params);\n    inst.keyType = def.keyType;\n    inst.valueType = def.valueType;\n    inst.min = (...args) => inst.check(core._minSize(...args));\n    inst.nonempty = (params) => inst.check(core._minSize(1, params));\n    inst.max = (...args) => inst.check(core._maxSize(...args));\n    inst.size = (...args) => inst.check(core._size(...args));\n});\nexport function map(keyType, valueType, params) {\n    return new ZodMap({\n        type: \"map\",\n        keyType: keyType,\n        valueType: valueType,\n        ...util.normalizeParams(params),\n    });\n}\nexport const ZodSet = /*@__PURE__*/ core.$constructor(\"ZodSet\", (inst, def) => {\n    core.$ZodSet.init(inst, def);\n    ZodType.init(inst, def);\n    inst._zod.processJSONSchema = (ctx, json, params) => processors.setProcessor(inst, ctx, json, params);\n    inst.min = (...args) => inst.check(core._minSize(...args));\n    inst.nonempty = (params) => inst.check(core._minSize(1, params));\n    inst.max = (...args) => inst.check(core._maxSize(...args));\n    inst.size = (...args) => inst.check(core._size(...args));\n});\nexport function set(valueType, params) {\n    return new ZodSet({\n        type: \"set\",\n        valueType: valueType,\n        ...util.normalizeParams(params),\n    });\n}\nexport const ZodEnum = /*@__PURE__*/ core.$constructor(\"ZodEnum\", (inst, def) => {\n    core.$ZodEnum.init(inst, def);\n    ZodType.init(inst, def);\n    inst._zod.processJSONSchema = (ctx, json, params) => processors.enumProcessor(inst, ctx, json, params);\n    inst.enum = def.entries;\n    inst.options = Object.values(def.entries);\n    const keys = new Set(Object.keys(def.entries));\n    inst.extract = (values, params) => {\n        const newEntries = {};\n        for (const value of values) {\n            if (keys.has(value)) {\n                newEntries[value] = def.entries[value];\n            }\n            else\n                throw new Error(`Key ${value} not found in enum`);\n        }\n        return new ZodEnum({\n            ...def,\n            checks: [],\n            ...util.normalizeParams(params),\n            entries: newEntries,\n        });\n    };\n    inst.exclude = (values, params) => {\n        const newEntries = { ...def.entries };\n        for (const value of values) {\n            if (keys.has(value)) {\n                delete newEntries[value];\n            }\n            else\n                throw new Error(`Key ${value} not found in enum`);\n        }\n        return new ZodEnum({\n            ...def,\n            checks: [],\n            ...util.normalizeParams(params),\n            entries: newEntries,\n        });\n    };\n});\nfunction _enum(values, params) {\n    const entries = Array.isArray(values) ? Object.fromEntries(values.map((v) => [v, v])) : values;\n    return new ZodEnum({\n        type: \"enum\",\n        entries,\n        ...util.normalizeParams(params),\n    });\n}\nexport { _enum as enum };\n/** @deprecated This API has been merged into `z.enum()`. Use `z.enum()` instead.\n *\n * ```ts\n * enum Colors { red, green, blue }\n * z.enum(Colors);\n * ```\n */\nexport function nativeEnum(entries, params) {\n    return new ZodEnum({\n        type: \"enum\",\n        entries,\n        ...util.normalizeParams(params),\n    });\n}\nexport const ZodLiteral = /*@__PURE__*/ core.$constructor(\"ZodLiteral\", (inst, def) => {\n    core.$ZodLiteral.init(inst, def);\n    ZodType.init(inst, def);\n    inst._zod.processJSONSchema = (ctx, json, params) => processors.literalProcessor(inst, ctx, json, params);\n    inst.values = new Set(def.values);\n    Object.defineProperty(inst, \"value\", {\n        get() {\n            if (def.values.length > 1) {\n                throw new Error(\"This schema contains multiple valid literal values. Use `.values` instead.\");\n            }\n            return def.values[0];\n        },\n    });\n});\nexport function literal(value, params) {\n    return new ZodLiteral({\n        type: \"literal\",\n        values: Array.isArray(value) ? value : [value],\n        ...util.normalizeParams(params),\n    });\n}\nexport const ZodFile = /*@__PURE__*/ core.$constructor(\"ZodFile\", (inst, def) => {\n    core.$ZodFile.init(inst, def);\n    ZodType.init(inst, def);\n    inst._zod.processJSONSchema = (ctx, json, params) => processors.fileProcessor(inst, ctx, json, params);\n    inst.min = (size, params) => inst.check(core._minSize(size, params));\n    inst.max = (size, params) => inst.check(core._maxSize(size, params));\n    inst.mime = (types, params) => inst.check(core._mime(Array.isArray(types) ? types : [types], params));\n});\nexport function file(params) {\n    return core._file(ZodFile, params);\n}\nexport const ZodTransform = /*@__PURE__*/ core.$constructor(\"ZodTransform\", (inst, def) => {\n    core.$ZodTransform.init(inst, def);\n    ZodType.init(inst, def);\n    inst._zod.processJSONSchema = (ctx, json, params) => processors.transformProcessor(inst, ctx, json, params);\n    inst._zod.parse = (payload, _ctx) => {\n        if (_ctx.direction === \"backward\") {\n            throw new core.$ZodEncodeError(inst.constructor.name);\n        }\n        payload.addIssue = (issue) => {\n            if (typeof issue === \"string\") {\n                payload.issues.push(util.issue(issue, payload.value, def));\n            }\n            else {\n                // for Zod 3 backwards compatibility\n                const _issue = issue;\n                if (_issue.fatal)\n                    _issue.continue = false;\n                _issue.code ?? (_issue.code = \"custom\");\n                _issue.input ?? (_issue.input = payload.value);\n                _issue.inst ?? (_issue.inst = inst);\n                // _issue.continue ??= true;\n                payload.issues.push(util.issue(_issue));\n            }\n        };\n        const output = def.transform(payload.value, payload);\n        if (output instanceof Promise) {\n            return output.then((output) => {\n                payload.value = output;\n                return payload;\n            });\n        }\n        payload.value = output;\n        return payload;\n    };\n});\nexport function transform(fn) {\n    return new ZodTransform({\n        type: \"transform\",\n        transform: fn,\n    });\n}\nexport const ZodOptional = /*@__PURE__*/ core.$constructor(\"ZodOptional\", (inst, def) => {\n    core.$ZodOptional.init(inst, def);\n    ZodType.init(inst, def);\n    inst._zod.processJSONSchema = (ctx, json, params) => processors.optionalProcessor(inst, ctx, json, params);\n    inst.unwrap = () => inst._zod.def.innerType;\n});\nexport function optional(innerType) {\n    return new ZodOptional({\n        type: \"optional\",\n        innerType: innerType,\n    });\n}\nexport const ZodExactOptional = /*@__PURE__*/ core.$constructor(\"ZodExactOptional\", (inst, def) => {\n    core.$ZodExactOptional.init(inst, def);\n    ZodType.init(inst, def);\n    inst._zod.processJSONSchema = (ctx, json, params) => processors.optionalProcessor(inst, ctx, json, params);\n    inst.unwrap = () => inst._zod.def.innerType;\n});\nexport function exactOptional(innerType) {\n    return new ZodExactOptional({\n        type: \"optional\",\n        innerType: innerType,\n    });\n}\nexport const ZodNullable = /*@__PURE__*/ core.$constructor(\"ZodNullable\", (inst, def) => {\n    core.$ZodNullable.init(inst, def);\n    ZodType.init(inst, def);\n    inst._zod.processJSONSchema = (ctx, json, params) => processors.nullableProcessor(inst, ctx, json, params);\n    inst.unwrap = () => inst._zod.def.innerType;\n});\nexport function nullable(innerType) {\n    return new ZodNullable({\n        type: \"nullable\",\n        innerType: innerType,\n    });\n}\n// nullish\nexport function nullish(innerType) {\n    return optional(nullable(innerType));\n}\nexport const ZodDefault = /*@__PURE__*/ core.$constructor(\"ZodDefault\", (inst, def) => {\n    core.$ZodDefault.init(inst, def);\n    ZodType.init(inst, def);\n    inst._zod.processJSONSchema = (ctx, json, params) => processors.defaultProcessor(inst, ctx, json, params);\n    inst.unwrap = () => inst._zod.def.innerType;\n    inst.removeDefault = inst.unwrap;\n});\nexport function _default(innerType, defaultValue) {\n    return new ZodDefault({\n        type: \"default\",\n        innerType: innerType,\n        get defaultValue() {\n            return typeof defaultValue === \"function\" ? defaultValue() : util.shallowClone(defaultValue);\n        },\n    });\n}\nexport const ZodPrefault = /*@__PURE__*/ core.$constructor(\"ZodPrefault\", (inst, def) => {\n    core.$ZodPrefault.init(inst, def);\n    ZodType.init(inst, def);\n    inst._zod.processJSONSchema = (ctx, json, params) => processors.prefaultProcessor(inst, ctx, json, params);\n    inst.unwrap = () => inst._zod.def.innerType;\n});\nexport function prefault(innerType, defaultValue) {\n    return new ZodPrefault({\n        type: \"prefault\",\n        innerType: innerType,\n        get defaultValue() {\n            return typeof defaultValue === \"function\" ? defaultValue() : util.shallowClone(defaultValue);\n        },\n    });\n}\nexport const ZodNonOptional = /*@__PURE__*/ core.$constructor(\"ZodNonOptional\", (inst, def) => {\n    core.$ZodNonOptional.init(inst, def);\n    ZodType.init(inst, def);\n    inst._zod.processJSONSchema = (ctx, json, params) => processors.nonoptionalProcessor(inst, ctx, json, params);\n    inst.unwrap = () => inst._zod.def.innerType;\n});\nexport function nonoptional(innerType, params) {\n    return new ZodNonOptional({\n        type: \"nonoptional\",\n        innerType: innerType,\n        ...util.normalizeParams(params),\n    });\n}\nexport const ZodSuccess = /*@__PURE__*/ core.$constructor(\"ZodSuccess\", (inst, def) => {\n    core.$ZodSuccess.init(inst, def);\n    ZodType.init(inst, def);\n    inst._zod.processJSONSchema = (ctx, json, params) => processors.successProcessor(inst, ctx, json, params);\n    inst.unwrap = () => inst._zod.def.innerType;\n});\nexport function success(innerType) {\n    return new ZodSuccess({\n        type: \"success\",\n        innerType: innerType,\n    });\n}\nexport const ZodCatch = /*@__PURE__*/ core.$constructor(\"ZodCatch\", (inst, def) => {\n    core.$ZodCatch.init(inst, def);\n    ZodType.init(inst, def);\n    inst._zod.processJSONSchema = (ctx, json, params) => processors.catchProcessor(inst, ctx, json, params);\n    inst.unwrap = () => inst._zod.def.innerType;\n    inst.removeCatch = inst.unwrap;\n});\nfunction _catch(innerType, catchValue) {\n    return new ZodCatch({\n        type: \"catch\",\n        innerType: innerType,\n        catchValue: (typeof catchValue === \"function\" ? catchValue : () => catchValue),\n    });\n}\nexport { _catch as catch };\nexport const ZodNaN = /*@__PURE__*/ core.$constructor(\"ZodNaN\", (inst, def) => {\n    core.$ZodNaN.init(inst, def);\n    ZodType.init(inst, def);\n    inst._zod.processJSONSchema = (ctx, json, params) => processors.nanProcessor(inst, ctx, json, params);\n});\nexport function nan(params) {\n    return core._nan(ZodNaN, params);\n}\nexport const ZodPipe = /*@__PURE__*/ core.$constructor(\"ZodPipe\", (inst, def) => {\n    core.$ZodPipe.init(inst, def);\n    ZodType.init(inst, def);\n    inst._zod.processJSONSchema = (ctx, json, params) => processors.pipeProcessor(inst, ctx, json, params);\n    inst.in = def.in;\n    inst.out = def.out;\n});\nexport function pipe(in_, out) {\n    return new ZodPipe({\n        type: \"pipe\",\n        in: in_,\n        out: out,\n        // ...util.normalizeParams(params),\n    });\n}\nexport const ZodCodec = /*@__PURE__*/ core.$constructor(\"ZodCodec\", (inst, def) => {\n    ZodPipe.init(inst, def);\n    core.$ZodCodec.init(inst, def);\n});\nexport function codec(in_, out, params) {\n    return new ZodCodec({\n        type: \"pipe\",\n        in: in_,\n        out: out,\n        transform: params.decode,\n        reverseTransform: params.encode,\n    });\n}\nexport const ZodReadonly = /*@__PURE__*/ core.$constructor(\"ZodReadonly\", (inst, def) => {\n    core.$ZodReadonly.init(inst, def);\n    ZodType.init(inst, def);\n    inst._zod.processJSONSchema = (ctx, json, params) => processors.readonlyProcessor(inst, ctx, json, params);\n    inst.unwrap = () => inst._zod.def.innerType;\n});\nexport function readonly(innerType) {\n    return new ZodReadonly({\n        type: \"readonly\",\n        innerType: innerType,\n    });\n}\nexport const ZodTemplateLiteral = /*@__PURE__*/ core.$constructor(\"ZodTemplateLiteral\", (inst, def) => {\n    core.$ZodTemplateLiteral.init(inst, def);\n    ZodType.init(inst, def);\n    inst._zod.processJSONSchema = (ctx, json, params) => processors.templateLiteralProcessor(inst, ctx, json, params);\n});\nexport function templateLiteral(parts, params) {\n    return new ZodTemplateLiteral({\n        type: \"template_literal\",\n        parts,\n        ...util.normalizeParams(params),\n    });\n}\nexport const ZodLazy = /*@__PURE__*/ core.$constructor(\"ZodLazy\", (inst, def) => {\n    core.$ZodLazy.init(inst, def);\n    ZodType.init(inst, def);\n    inst._zod.processJSONSchema = (ctx, json, params) => processors.lazyProcessor(inst, ctx, json, params);\n    inst.unwrap = () => inst._zod.def.getter();\n});\nexport function lazy(getter) {\n    return new ZodLazy({\n        type: \"lazy\",\n        getter: getter,\n    });\n}\nexport const ZodPromise = /*@__PURE__*/ core.$constructor(\"ZodPromise\", (inst, def) => {\n    core.$ZodPromise.init(inst, def);\n    ZodType.init(inst, def);\n    inst._zod.processJSONSchema = (ctx, json, params) => processors.promiseProcessor(inst, ctx, json, params);\n    inst.unwrap = () => inst._zod.def.innerType;\n});\nexport function promise(innerType) {\n    return new ZodPromise({\n        type: \"promise\",\n        innerType: innerType,\n    });\n}\nexport const ZodFunction = /*@__PURE__*/ core.$constructor(\"ZodFunction\", (inst, def) => {\n    core.$ZodFunction.init(inst, def);\n    ZodType.init(inst, def);\n    inst._zod.processJSONSchema = (ctx, json, params) => processors.functionProcessor(inst, ctx, json, params);\n});\nexport function _function(params) {\n    return new ZodFunction({\n        type: \"function\",\n        input: Array.isArray(params?.input) ? tuple(params?.input) : (params?.input ?? array(unknown())),\n        output: params?.output ?? unknown(),\n    });\n}\nexport { _function as function };\nexport const ZodCustom = /*@__PURE__*/ core.$constructor(\"ZodCustom\", (inst, def) => {\n    core.$ZodCustom.init(inst, def);\n    ZodType.init(inst, def);\n    inst._zod.processJSONSchema = (ctx, json, params) => processors.customProcessor(inst, ctx, json, params);\n});\n// custom checks\nexport function check(fn) {\n    const ch = new core.$ZodCheck({\n        check: \"custom\",\n        // ...util.normalizeParams(params),\n    });\n    ch._zod.check = fn;\n    return ch;\n}\nexport function custom(fn, _params) {\n    return core._custom(ZodCustom, fn ?? (() => true), _params);\n}\nexport function refine(fn, _params = {}) {\n    return core._refine(ZodCustom, fn, _params);\n}\n// superRefine\nexport function superRefine(fn) {\n    return core._superRefine(fn);\n}\n// Re-export describe and meta from core\nexport const describe = core.describe;\nexport const meta = core.meta;\nfunction _instanceof(cls, params = {}) {\n    const inst = new ZodCustom({\n        type: \"custom\",\n        check: \"custom\",\n        fn: (data) => data instanceof cls,\n        abort: true,\n        ...util.normalizeParams(params),\n    });\n    inst._zod.bag.Class = cls;\n    // Override check to emit invalid_type instead of custom\n    inst._zod.check = (payload) => {\n        if (!(payload.value instanceof cls)) {\n            payload.issues.push({\n                code: \"invalid_type\",\n                expected: cls.name,\n                input: payload.value,\n                inst,\n                path: [...(inst._zod.def.path ?? [])],\n            });\n        }\n    };\n    return inst;\n}\nexport { _instanceof as instanceof };\n// stringbool\nexport const stringbool = (...args) => core._stringbool({\n    Codec: ZodCodec,\n    Boolean: ZodBoolean,\n    String: ZodString,\n}, ...args);\nexport function json(params) {\n    const jsonSchema = lazy(() => {\n        return union([string(params), number(), boolean(), _null(), array(jsonSchema), record(string(), jsonSchema)]);\n    });\n    return jsonSchema;\n}\n// preprocess\n// /** @deprecated Use `z.pipe()` and `z.transform()` instead. */\nexport function preprocess(fn, schema) {\n    return pipe(transform(fn), schema);\n}\n","import { z } from 'zod';\r\n\r\nexport const projectSchema = z.object({\r\n    name: z.string()\r\n        .min(3, 'Project name must be at least 3 characters')\r\n        .max(50, 'Project name must be less than 50 characters')\r\n        .regex(/^[a-zA-Z0-9_\\-\\s]+$/, 'Project name can only contain letters, numbers, spaces, underscores, and hyphens'),\r\n    description: z.string().optional(),\r\n    owner_id: z.string().optional(), // Often set automatically\r\n    company_id: z.string().optional(),\r\n});\r\n\r\nexport const projectSettingsSchema = z.object({\r\n    userRole: z.string().optional(),\r\n    userRolePrompt: z.string().optional(),\r\n});\r\n\r\nexport type ProjectSchema = z.infer<typeof projectSchema>;\r\n","/**\n * Project Modal - SOTA Design\n * Create and edit projects with modern glassmorphism design\n * Includes: General settings, Members, Roles, and Configuration tabs\n */\n\nimport { createModal, openModal, closeModal, confirm } from '@components/Modal';\nimport { createElement, on } from '@lib/dom';\nimport { appStore } from '@stores/app';\nimport { dataStore } from '@stores/data';\nimport { http } from '@services/api';\nimport { toast } from '@services/toast';\nimport { showMemberPermissionsModal } from './MemberPermissionsModal';\nimport { listCompanies } from '@services/companies';\nimport { projectSchema } from '@schemas/project';\n\nconst MODAL_ID = 'project-modal';\n\n// ==================== Types ====================\n\nexport interface ProjectData {\n  id?: string;\n  name: string;\n  description?: string;\n  owner_id?: string;\n  company_id?: string;\n  company?: { id: string; name?: string; logo_url?: string; brand_assets?: Record<string, unknown> };\n  settings?: ProjectSettings;\n  created_at?: string;\n  updated_at?: string;\n}\n\ninterface ProjectSettings {\n  userRole?: string;\n  userRolePrompt?: string;\n}\n\ninterface ProjectMember {\n  user_id: string;\n  email?: string;\n  display_name?: string;\n  avatar_url?: string;\n  role: 'owner' | 'admin' | 'write' | 'read';\n  user_role?: string;\n  user_role_prompt?: string;\n  linked_contact_id?: string;\n  linked_contact?: {\n    id: string;\n    name: string;\n    email?: string;\n    organization?: string;\n    role?: string;\n  };\n  joined_at: string;\n}\n\ninterface Contact {\n  id: string;\n  name: string;\n  email?: string;\n  organization?: string;\n  role?: string;\n}\n\ninterface RoleTemplate {\n  id: string;\n  name: string;\n  display_name: string;\n  description?: string;\n  icon?: string;\n  prompt_template?: string;\n  focus_areas?: string[];\n  category?: string;\n  is_builtin: boolean;\n  is_active: boolean;\n}\n\ninterface ProjectConfig {\n  id?: string;\n  project_id: string;\n  llm_config?: Record<string, unknown>;\n  ollama_config?: Record<string, unknown>;\n  prompts?: Record<string, string>;\n  processing_settings?: Record<string, unknown>;\n  ui_preferences?: Record<string, unknown>;\n}\n\nexport interface ProjectModalProps {\n  mode: 'create' | 'edit';\n  project?: ProjectData;\n  onSave?: (project: ProjectData) => void;\n  onDelete?: (projectId: string) => void;\n}\n\n// ==================== State ====================\n\nlet currentProps: ProjectModalProps = { mode: 'create' };\nlet currentProject: ProjectData | null = null;\n/** When set, form is shown inline (no modal); close/cancel/save/delete call this then clear */\nlet inlineOnCancel: (() => void) | null = null;\nlet projectMembers: ProjectMember[] = [];\nlet projectRoles: RoleTemplate[] = [];\nlet projectConfig: ProjectConfig | null = null;\nlet projectContacts: Contact[] = [];\n\n// ==================== Main Functions ====================\n\n/**\n * Show project modal (or inline when container provided)\n */\nexport function showProjectModal(props: ProjectModalProps & { inlineContainer?: HTMLElement; onCancel?: () => void }): void {\n  currentProps = props;\n  currentProject = props.project || null;\n  inlineOnCancel = props.inlineContainer ? (props.onCancel ?? (() => { })) : null;\n\n  const content = createModalContent(props.mode);\n\n  if (props.inlineContainer) {\n    props.inlineContainer.innerHTML = '';\n    props.inlineContainer.appendChild(content);\n    if (props.mode === 'edit' && props.project?.id) {\n      loadProjectData(content, props.project.id);\n    } else {\n      renderCreateForm(content);\n    }\n    return;\n  }\n\n  const modal = createModal({\n    id: MODAL_ID,\n    title: '',\n    size: 'lg',\n    content: content,\n  });\n\n  // Remove default modal styling for custom design\n  const modalContent = modal.querySelector('.modal-content') as HTMLElement;\n  if (modalContent) {\n    modalContent.classList.add('project-modal-content-bare');\n  }\n  const modalHeader = modal.querySelector('.modal-header') as HTMLElement;\n  if (modalHeader) {\n    modalHeader.classList.add('hidden');\n  }\n\n  document.body.appendChild(modal);\n  openModal(MODAL_ID);\n\n  if (props.mode === 'edit' && props.project?.id) {\n    loadProjectData(content, props.project.id);\n  } else {\n    renderCreateForm(content);\n  }\n}\n\nfunction closeOrInlineCancel(): void {\n  if (inlineOnCancel) {\n    inlineOnCancel();\n    inlineOnCancel = null;\n  } else {\n    closeModal(MODAL_ID);\n  }\n}\n\n/**\n * Create modal content with SOTA styling\n */\nfunction createModalContent(mode: 'create' | 'edit'): HTMLElement {\n  const container = createElement('div', { className: 'project-modal-sota' });\n\n  container.innerHTML = `\n    <style>\n      .project-modal-sota {\n        font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, sans-serif;\n      }\n      \n      .project-card {\n        background: linear-gradient(135deg, rgba(255,255,255,0.95) 0%, rgba(248,250,252,0.95) 100%);\n        backdrop-filter: blur(20px);\n        border-radius: 24px;\n        box-shadow: \n          0 25px 50px -12px rgba(0, 0, 0, 0.15),\n          0 0 0 1px rgba(255, 255, 255, 0.8),\n          inset 0 1px 0 rgba(255, 255, 255, 0.9);\n        overflow: hidden;\n      }\n      \n      [data-theme=\"dark\"] .project-card {\n        background: linear-gradient(135deg, rgba(30,41,59,0.95) 0%, rgba(15,23,42,0.95) 100%);\n        box-shadow: \n          0 25px 50px -12px rgba(0, 0, 0, 0.5),\n          0 0 0 1px rgba(255, 255, 255, 0.1),\n          inset 0 1px 0 rgba(255, 255, 255, 0.05);\n      }\n      \n      .project-header {\n        background: linear-gradient(135deg, #e11d48 0%, #be123c 100%);\n        padding: 32px;\n        position: relative;\n        overflow: hidden;\n      }\n      \n      .project-header::before {\n        content: '';\n        position: absolute;\n        top: -50%;\n        right: -50%;\n        width: 100%;\n        height: 200%;\n        background: radial-gradient(circle, rgba(255,255,255,0.1) 0%, transparent 60%);\n        pointer-events: none;\n      }\n      \n      .project-header-content {\n        display: flex;\n        align-items: center;\n        gap: 20px;\n        position: relative;\n        z-index: 1;\n      }\n      \n      .project-icon-large {\n        width: 72px;\n        height: 72px;\n        border-radius: 18px;\n        background: rgba(255,255,255,0.2);\n        display: flex;\n        align-items: center;\n        justify-content: center;\n        border: 3px solid rgba(255,255,255,0.3);\n        flex-shrink: 0;\n      }\n      \n      .project-icon-large svg {\n        width: 36px;\n        height: 36px;\n        color: white;\n      }\n      \n      .project-title-info h2 {\n        margin: 0 0 4px 0;\n        font-size: 24px;\n        font-weight: 700;\n        color: white;\n      }\n      \n      .project-title-info p {\n        margin: 0;\n        color: rgba(255,255,255,0.8);\n        font-size: 14px;\n      }\n      \n      .project-close-btn {\n        position: absolute;\n        top: 16px;\n        right: 16px;\n        width: 36px;\n        height: 36px;\n        border-radius: 50%;\n        background: rgba(255,255,255,0.2);\n        border: none;\n        cursor: pointer;\n        display: flex;\n        align-items: center;\n        justify-content: center;\n        transition: all 0.2s;\n        z-index: 10;\n      }\n      \n      .project-close-btn:hover {\n        background: rgba(255,255,255,0.3);\n        transform: rotate(90deg);\n      }\n      \n      .project-close-btn svg {\n        width: 20px;\n        height: 20px;\n        color: white;\n      }\n      \n      .project-tabs-nav {\n        display: flex;\n        gap: 0;\n        padding: 0 24px;\n        background: rgba(0,0,0,0.02);\n        border-bottom: 1px solid rgba(0,0,0,0.06);\n        overflow-x: auto;\n      }\n      \n      [data-theme=\"dark\"] .project-tabs-nav {\n        background: rgba(255,255,255,0.02);\n        border-bottom-color: rgba(255,255,255,0.06);\n      }\n      \n      .project-tab-btn {\n        padding: 16px 20px;\n        background: transparent;\n        border: none;\n        font-size: 14px;\n        font-weight: 500;\n        color: #64748b;\n        cursor: pointer;\n        position: relative;\n        transition: all 0.2s;\n        white-space: nowrap;\n        display: flex;\n        align-items: center;\n        gap: 8px;\n      }\n      \n      .project-tab-btn:hover {\n        color: #1e293b;\n      }\n      \n      [data-theme=\"dark\"] .project-tab-btn:hover {\n        color: #e2e8f0;\n      }\n      \n      .project-tab-btn.active {\n        color: #e11d48;\n      }\n      \n      .project-tab-btn.active::after {\n        content: '';\n        position: absolute;\n        bottom: 0;\n        left: 20px;\n        right: 20px;\n        height: 2px;\n        background: #e11d48;\n        border-radius: 2px 2px 0 0;\n      }\n      \n      .project-tab-icon {\n        width: 18px;\n        height: 18px;\n      }\n      \n      .project-body {\n        padding: 32px;\n        max-height: 60vh;\n        overflow-y: auto;\n      }\n      \n      .project-section {\n        display: none;\n      }\n      \n      .project-section.active {\n        display: block;\n      }\n      \n      .form-grid {\n        display: grid;\n        grid-template-columns: repeat(2, 1fr);\n        gap: 20px;\n      }\n      \n      .form-grid .full-width {\n        grid-column: 1 / -1;\n      }\n      \n      .form-field {\n        display: flex;\n        flex-direction: column;\n        gap: 6px;\n      }\n      \n      .form-field label {\n        font-size: 13px;\n        font-weight: 600;\n        color: #475569;\n        display: flex;\n        align-items: center;\n        gap: 6px;\n      }\n      \n      [data-theme=\"dark\"] .form-field label {\n        color: #94a3b8;\n      }\n      \n      .form-field input,\n      .form-field select,\n      .form-field textarea {\n        padding: 12px 16px;\n        border: 1px solid #e2e8f0;\n        border-radius: 12px;\n        font-size: 14px;\n        background: #f8fafc;\n        color: #1e293b;\n        transition: all 0.2s;\n        outline: none;\n      }\n      \n      [data-theme=\"dark\"] .form-field input,\n      [data-theme=\"dark\"] .form-field select,\n      [data-theme=\"dark\"] .form-field textarea {\n        background: rgba(255,255,255,0.05);\n        border-color: rgba(255,255,255,0.1);\n        color: #f1f5f9;\n      }\n      \n      .form-field input:focus,\n      .form-field select:focus,\n      .form-field textarea:focus {\n        border-color: #e11d48;\n        box-shadow: 0 0 0 3px rgba(225, 29, 72, 0.1);\n      }\n      \n      .form-field input:disabled {\n        background: #f1f5f9;\n        color: #94a3b8;\n        cursor: not-allowed;\n      }\n      \n      .form-field textarea {\n        resize: vertical;\n        min-height: 80px;\n      }\n      \n      .form-hint {\n        font-size: 12px;\n        color: #94a3b8;\n      }\n      \n      .form-actions {\n        display: flex;\n        justify-content: flex-end;\n        gap: 12px;\n        margin-top: 24px;\n        padding-top: 24px;\n        border-top: 1px solid rgba(0,0,0,0.06);\n      }\n      \n      [data-theme=\"dark\"] .form-actions {\n        border-top-color: rgba(255,255,255,0.06);\n      }\n      \n      .btn-sota {\n        padding: 12px 24px;\n        border-radius: 12px;\n        font-size: 14px;\n        font-weight: 600;\n        cursor: pointer;\n        transition: all 0.2s;\n        border: none;\n        display: inline-flex;\n        align-items: center;\n        gap: 8px;\n      }\n      \n      .btn-sota.primary {\n        background: linear-gradient(135deg, #e11d48 0%, #be123c 100%);\n        color: white;\n        box-shadow: 0 4px 14px rgba(225, 29, 72, 0.3);\n      }\n      \n      .btn-sota.primary:hover {\n        transform: translateY(-1px);\n        box-shadow: 0 6px 20px rgba(225, 29, 72, 0.4);\n      }\n      \n      .btn-sota.primary:disabled {\n        opacity: 0.6;\n        cursor: not-allowed;\n        transform: none;\n      }\n      \n      .btn-sota.secondary {\n        background: #f1f5f9;\n        color: #475569;\n      }\n      \n      [data-theme=\"dark\"] .btn-sota.secondary {\n        background: rgba(255,255,255,0.1);\n        color: #e2e8f0;\n      }\n      \n      .btn-sota.secondary:hover {\n        background: #e2e8f0;\n      }\n      \n      .btn-sota.danger {\n        background: transparent;\n        color: #dc2626;\n        border: 1px solid #fecaca;\n      }\n      \n      .btn-sota.danger:hover {\n        background: #fef2f2;\n        border-color: #dc2626;\n      }\n      \n      .btn-sota.small {\n        padding: 8px 16px;\n        font-size: 13px;\n      }\n      \n      /* Section Headers */\n      .section-header {\n        display: flex;\n        align-items: center;\n        justify-content: space-between;\n        margin-bottom: 20px;\n      }\n      \n      .section-header h3 {\n        font-size: 16px;\n        font-weight: 600;\n        color: #1e293b;\n        margin: 0;\n        display: flex;\n        align-items: center;\n        gap: 8px;\n      }\n      \n      [data-theme=\"dark\"] .section-header h3 {\n        color: #f1f5f9;\n      }\n      \n      .section-header h3 svg {\n        width: 20px;\n        height: 20px;\n        color: #e11d48;\n      }\n      \n      /* Members List */\n      .members-list {\n        display: flex;\n        flex-direction: column;\n        gap: 12px;\n      }\n      \n      .member-card {\n        display: flex;\n        align-items: center;\n        justify-content: space-between;\n        padding: 16px 20px;\n        background: #f8fafc;\n        border-radius: 12px;\n        border: 1px solid transparent;\n        transition: all 0.2s;\n      }\n      \n      [data-theme=\"dark\"] .member-card {\n        background: rgba(255,255,255,0.03);\n      }\n      \n      .member-card:hover {\n        border-color: #e2e8f0;\n      }\n      \n      .member-card.owner {\n        border-color: #e11d48;\n        background: linear-gradient(135deg, rgba(225,29,72,0.05) 0%, rgba(225,29,72,0.02) 100%);\n      }\n      \n      .member-info {\n        display: flex;\n        align-items: center;\n        gap: 14px;\n      }\n      \n      .member-avatar {\n        width: 44px;\n        height: 44px;\n        border-radius: 50%;\n        background: linear-gradient(135deg, #e11d48 0%, #be123c 100%);\n        display: flex;\n        align-items: center;\n        justify-content: center;\n        font-size: 16px;\n        font-weight: 600;\n        color: white;\n        flex-shrink: 0;\n        overflow: hidden;\n      }\n      \n      .member-avatar img {\n        width: 100%;\n        height: 100%;\n        object-fit: cover;\n      }\n      \n      .member-details h4 {\n        margin: 0 0 4px 0;\n        font-size: 14px;\n        font-weight: 600;\n        color: #1e293b;\n      }\n      \n      [data-theme=\"dark\"] .member-details h4 {\n        color: #f1f5f9;\n      }\n      \n      .member-details p {\n        margin: 0;\n        font-size: 12px;\n        color: #64748b;\n      }\n      \n      .member-actions {\n        display: flex;\n        align-items: center;\n        gap: 12px;\n      }\n      \n      .role-badge {\n        font-size: 11px;\n        font-weight: 600;\n        padding: 4px 10px;\n        border-radius: 20px;\n        text-transform: uppercase;\n        letter-spacing: 0.5px;\n      }\n      \n      .role-badge.owner {\n        background: #e11d48;\n        color: white;\n      }\n      \n      .role-badge.admin {\n        background: #8b5cf6;\n        color: white;\n      }\n      \n      .role-badge.write {\n        background: #0ea5e9;\n        color: white;\n      }\n      \n      .role-badge.read {\n        background: #64748b;\n        color: white;\n      }\n      \n      .role-select {\n        padding: 6px 12px;\n        border: 1px solid #e2e8f0;\n        border-radius: 8px;\n        font-size: 13px;\n        background: white;\n        cursor: pointer;\n      }\n      \n      [data-theme=\"dark\"] .role-select {\n        background: rgba(255,255,255,0.05);\n        border-color: rgba(255,255,255,0.1);\n        color: #f1f5f9;\n      }\n      \n      /* Role Templates List */\n      .roles-grid {\n        display: grid;\n        grid-template-columns: repeat(2, 1fr);\n        gap: 16px;\n      }\n      \n      .role-card {\n        padding: 20px;\n        background: #f8fafc;\n        border-radius: 16px;\n        border: 2px solid transparent;\n        cursor: pointer;\n        transition: all 0.2s;\n      }\n      \n      [data-theme=\"dark\"] .role-card {\n        background: rgba(255,255,255,0.03);\n      }\n      \n      .role-card:hover {\n        border-color: #e2e8f0;\n        transform: translateY(-2px);\n      }\n      \n      .role-card.active {\n        border-color: #e11d48;\n        background: linear-gradient(135deg, rgba(225,29,72,0.05) 0%, rgba(225,29,72,0.02) 100%);\n      }\n      \n      .role-card-header {\n        display: flex;\n        align-items: center;\n        gap: 12px;\n        margin-bottom: 12px;\n      }\n      \n      .role-icon {\n        width: 40px;\n        height: 40px;\n        border-radius: 10px;\n        background: linear-gradient(135deg, #e11d48 0%, #be123c 100%);\n        display: flex;\n        align-items: center;\n        justify-content: center;\n      }\n      \n      .role-icon svg {\n        width: 20px;\n        height: 20px;\n        color: white;\n      }\n      \n      .role-card h4 {\n        margin: 0;\n        font-size: 14px;\n        font-weight: 600;\n        color: #1e293b;\n      }\n      \n      [data-theme=\"dark\"] .role-card h4 {\n        color: #f1f5f9;\n      }\n      \n      .role-card p {\n        margin: 0;\n        font-size: 13px;\n        color: #64748b;\n        line-height: 1.5;\n      }\n      \n      .role-card .toggle-active {\n        margin-top: 12px;\n        display: flex;\n        align-items: center;\n        gap: 8px;\n        font-size: 12px;\n        color: #64748b;\n      }\n      \n      /* Config Section */\n      .config-group {\n        margin-bottom: 32px;\n      }\n      \n      .config-group h4 {\n        font-size: 14px;\n        font-weight: 600;\n        color: #1e293b;\n        margin: 0 0 16px 0;\n        display: flex;\n        align-items: center;\n        gap: 8px;\n      }\n      \n      [data-theme=\"dark\"] .config-group h4 {\n        color: #f1f5f9;\n      }\n      \n      .config-group h4 svg {\n        width: 16px;\n        height: 16px;\n        color: #e11d48;\n      }\n      \n      .api-key-field {\n        display: flex;\n        gap: 12px;\n      }\n      \n      .api-key-field input {\n        flex: 1;\n      }\n      \n      .api-key-field .btn-sota {\n        flex-shrink: 0;\n      }\n      \n      /* Danger Zone */\n      .danger-zone {\n        background: linear-gradient(135deg, #fef2f2 0%, #fff 100%);\n        border: 1px solid #fecaca;\n        border-radius: 16px;\n        padding: 24px;\n        margin-top: 32px;\n      }\n      \n      [data-theme=\"dark\"] .danger-zone {\n        background: linear-gradient(135deg, rgba(220,38,38,0.1) 0%, rgba(220,38,38,0.05) 100%);\n        border-color: rgba(220,38,38,0.3);\n      }\n      \n      .danger-zone h3 {\n        color: #dc2626 !important;\n        margin: 0 0 8px 0;\n        font-size: 16px;\n        font-weight: 600;\n        display: flex;\n        align-items: center;\n        gap: 8px;\n      }\n      \n      .danger-zone h3 svg {\n        width: 18px;\n        height: 18px;\n      }\n      \n      .danger-zone p {\n        color: #991b1b;\n        font-size: 14px;\n        margin: 0 0 16px 0;\n      }\n      \n      [data-theme=\"dark\"] .danger-zone p {\n        color: #fca5a5;\n      }\n      \n      /* Empty State */\n      .empty-state {\n        text-align: center;\n        padding: 48px 24px;\n        color: #94a3b8;\n      }\n      \n      .empty-state svg {\n        width: 48px;\n        height: 48px;\n        margin-bottom: 16px;\n        opacity: 0.5;\n      }\n      \n      .empty-state p {\n        margin: 0 0 16px 0;\n      }\n      \n      /* Loading */\n      .loading-spinner {\n        display: flex;\n        justify-content: center;\n        align-items: center;\n        padding: 48px;\n      }\n      \n      .loading-spinner::after {\n        content: '';\n        width: 32px;\n        height: 32px;\n        border: 3px solid #e2e8f0;\n        border-top-color: #e11d48;\n        border-radius: 50%;\n        animation: spin 0.8s linear infinite;\n      }\n      \n      @keyframes spin {\n        to { transform: rotate(360deg); }\n      }\n      \n      /* Responsive */\n      @media (max-width: 640px) {\n        .form-grid {\n          grid-template-columns: 1fr;\n        }\n        \n        .roles-grid {\n          grid-template-columns: 1fr;\n        }\n        \n        .project-tabs-nav {\n          padding: 0 16px;\n        }\n        \n        .project-tab-btn {\n          padding: 14px 16px;\n        }\n      }\n    </style>\n    \n    <div class=\"project-card\">\n      <div class=\"loading-spinner\"></div>\n    </div>\n  `;\n\n  return container;\n}\n\n/**\n * Load project data for editing\n */\nasync function loadProjectData(container: HTMLElement, projectId: string): Promise<void> {\n  const card = container.querySelector('.project-card') as HTMLElement;\n  if (!card) return;\n\n  try {\n    // Load project details, members, roles, config, and contacts in parallel\n    const [projectRes, membersRes, rolesRes, configRes, contactsRes] = await Promise.all([\n      http.get<{ project: ProjectData }>(`/api/projects/${projectId}`).catch(() => null),\n      http.get<{ members: ProjectMember[] }>(`/api/projects/${projectId}/members`).catch(() => ({ data: { members: [] } })),\n      http.get<{ roles: RoleTemplate[] }>('/api/role-templates').catch(() => ({ data: { roles: [] } })),\n      http.get<{ config: ProjectConfig }>(`/api/projects/${projectId}/config`).catch(() => ({ data: { config: null } })),\n      http.get<{ contacts: Contact[] }>('/api/contacts').catch(() => ({ data: { contacts: [] } })),\n    ]);\n\n    if (projectRes?.data?.project) {\n      currentProject = projectRes.data.project;\n    }\n    projectMembers = membersRes?.data?.members || [];\n    projectRoles = rolesRes?.data?.roles || [];\n    projectConfig = configRes?.data?.config || null;\n    // Handle different response formats for contacts\n    const contactsData = contactsRes?.data;\n    projectContacts = Array.isArray(contactsData) ? contactsData : (contactsData?.contacts || []);\n\n    renderEditForm(card);\n  } catch {\n    // Use props project as fallback\n    renderEditForm(card);\n  }\n}\n\n/**\n * Render create form\n */\nfunction renderCreateForm(container: HTMLElement): void {\n  const card = container.querySelector('.project-card') as HTMLElement;\n  if (!card) return;\n\n  card.innerHTML = `\n    <!-- Header -->\n    <div class=\"project-header\">\n      <button class=\"project-close-btn\" id=\"close-project-btn\">\n        <svg fill=\"none\" viewBox=\"0 0 24 24\" stroke=\"currentColor\">\n          <path stroke-linecap=\"round\" stroke-linejoin=\"round\" stroke-width=\"2\" d=\"M6 18L18 6M6 6l12 12\"/>\n        </svg>\n      </button>\n      \n      <div class=\"project-header-content\">\n        <div class=\"project-icon-large\">\n          <svg fill=\"none\" viewBox=\"0 0 24 24\" stroke=\"currentColor\">\n            <path stroke-linecap=\"round\" stroke-linejoin=\"round\" stroke-width=\"2\" d=\"M19 11H5m14 0a2 2 0 012 2v6a2 2 0 01-2 2H5a2 2 0 01-2-2v-6a2 2 0 012-2m14 0V9a2 2 0 00-2-2M5 11V9a2 2 0 012-2m0 0V5a2 2 0 012-2h6a2 2 0 012 2v2M7 7h10\"/>\n          </svg>\n        </div>\n        <div class=\"project-title-info\">\n          <h2>New Project</h2>\n          <p>Create a new project to organize your work</p>\n        </div>\n      </div>\n    </div>\n    \n    <!-- Form -->\n    <div class=\"project-body\">\n      <form id=\"project-form\">\n        <div class=\"form-grid\">\n          <div class=\"form-field full-width\">\n            <label>\n              <svg width=\"14\" height=\"14\" fill=\"none\" viewBox=\"0 0 24 24\" stroke=\"currentColor\">\n                <path stroke-linecap=\"round\" stroke-linejoin=\"round\" stroke-width=\"2\" d=\"M3 7v10a2 2 0 002 2h14a2 2 0 002-2V9a2 2 0 00-2-2h-6l-2-2H5a2 2 0 00-2 2z\"/>\n              </svg>\n              Project Name *\n            </label>\n            <input type=\"text\" name=\"name\" required placeholder=\"Enter project name\">\n          </div>\n          \n          <div class=\"form-field full-width\">\n            <label>\n              <svg width=\"14\" height=\"14\" fill=\"none\" viewBox=\"0 0 24 24\" stroke=\"currentColor\">\n                <path stroke-linecap=\"round\" stroke-linejoin=\"round\" stroke-width=\"2\" d=\"M4 6h16M4 12h16M4 18h7\"/>\n              </svg>\n              Description\n            </label>\n            <textarea name=\"description\" placeholder=\"Brief description of the project\"></textarea>\n          </div>\n          <div class=\"form-field full-width\">\n            <label>\n              <svg width=\"14\" height=\"14\" fill=\"none\" viewBox=\"0 0 24 24\" stroke=\"currentColor\">\n                <path stroke-linecap=\"round\" stroke-linejoin=\"round\" stroke-width=\"2\" d=\"M19 21V5a2 2 0 00-2-2H7a2 2 0 00-2 2v16m14 0h2m-2 0h-5m-9 0H3m2 0h5M9 7h1m-1 4h1m4-4h1m-1 4h1m-5 10v-5a1 1 0 011-1h2a1 1 0 011 1v5m-4 0h4\"/>\n              </svg>\n              Company *\n            </label>\n            <select name=\"company_id\" id=\"project-company-id\">\n              <option value=\"\">Loading...</option>\n            </select>\n          </div>\n        </div>\n        \n        <div class=\"form-actions\">\n          <button type=\"button\" class=\"btn-sota secondary\" id=\"cancel-btn\">Cancel</button>\n          <button type=\"submit\" class=\"btn-sota primary\">\n            <svg width=\"16\" height=\"16\" fill=\"none\" viewBox=\"0 0 24 24\" stroke=\"currentColor\">\n              <path stroke-linecap=\"round\" stroke-linejoin=\"round\" stroke-width=\"2\" d=\"M12 4v16m8-8H4\"/>\n            </svg>\n            Create Project\n          </button>\n        </div>\n      </form>\n    </div>\n  `;\n\n  bindCreateEvents(card);\n}\n\n/**\n * Render edit form with tabs\n */\nfunction renderEditForm(container: HTMLElement): void {\n  const project = currentProject || currentProps.project;\n  if (!project) return;\n\n  const settings = project.settings || {};\n\n  container.innerHTML = `\n    <!-- Header -->\n    <div class=\"project-header\">\n      <button class=\"project-close-btn\" id=\"close-project-btn\">\n        <svg fill=\"none\" viewBox=\"0 0 24 24\" stroke=\"currentColor\">\n          <path stroke-linecap=\"round\" stroke-linejoin=\"round\" stroke-width=\"2\" d=\"M6 18L18 6M6 6l12 12\"/>\n        </svg>\n      </button>\n      \n      <div class=\"project-header-content\">\n        <div class=\"project-icon-large\">\n          <svg fill=\"none\" viewBox=\"0 0 24 24\" stroke=\"currentColor\">\n            <path stroke-linecap=\"round\" stroke-linejoin=\"round\" stroke-width=\"2\" d=\"M19 11H5m14 0a2 2 0 012 2v6a2 2 0 01-2 2H5a2 2 0 01-2-2v-6a2 2 0 012-2m14 0V9a2 2 0 00-2-2M5 11V9a2 2 0 012-2m0 0V5a2 2 0 012-2h6a2 2 0 012 2v2M7 7h10\"/>\n          </svg>\n        </div>\n        <div class=\"project-title-info\">\n          <h2>${escapeHtml(project.name)}</h2>\n          <p>${project.description ? escapeHtml(project.description) : 'No description'}</p>\n        </div>\n      </div>\n    </div>\n    \n    <!-- Tabs Navigation -->\n    <nav class=\"project-tabs-nav\">\n      <button class=\"project-tab-btn active\" data-tab=\"general\">\n        <svg class=\"project-tab-icon\" fill=\"none\" viewBox=\"0 0 24 24\" stroke=\"currentColor\">\n          <path stroke-linecap=\"round\" stroke-linejoin=\"round\" stroke-width=\"2\" d=\"M10.325 4.317c.426-1.756 2.924-1.756 3.35 0a1.724 1.724 0 002.573 1.066c1.543-.94 3.31.826 2.37 2.37a1.724 1.724 0 001.065 2.572c1.756.426 1.756 2.924 0 3.35a1.724 1.724 0 00-1.066 2.573c.94 1.543-.826 3.31-2.37 2.37a1.724 1.724 0 00-2.572 1.065c-.426 1.756-2.924 1.756-3.35 0a1.724 1.724 0 00-2.573-1.066c-1.543.94-3.31-.826-2.37-2.37a1.724 1.724 0 00-1.065-2.572c-1.756-.426-1.756-2.924 0-3.35a1.724 1.724 0 001.066-2.573c-.94-1.543.826-3.31 2.37-2.37.996.608 2.296.07 2.572-1.065z\"/>\n          <path stroke-linecap=\"round\" stroke-linejoin=\"round\" stroke-width=\"2\" d=\"M15 12a3 3 0 11-6 0 3 3 0 016 0z\"/>\n        </svg>\n        General\n      </button>\n      <button class=\"project-tab-btn\" data-tab=\"members\">\n        <svg class=\"project-tab-icon\" fill=\"none\" viewBox=\"0 0 24 24\" stroke=\"currentColor\">\n          <path stroke-linecap=\"round\" stroke-linejoin=\"round\" stroke-width=\"2\" d=\"M12 4.354a4 4 0 110 5.292M15 21H3v-1a6 6 0 0112 0v1zm0 0h6v-1a6 6 0 00-9-5.197M13 7a4 4 0 11-8 0 4 4 0 018 0z\"/>\n        </svg>\n        Members\n        <span class=\"badge\">${projectMembers.length}</span>\n      </button>\n      <button class=\"project-tab-btn\" data-tab=\"roles\">\n        <svg class=\"project-tab-icon\" fill=\"none\" viewBox=\"0 0 24 24\" stroke=\"currentColor\">\n          <path stroke-linecap=\"round\" stroke-linejoin=\"round\" stroke-width=\"2\" d=\"M9 12l2 2 4-4m5.618-4.016A11.955 11.955 0 0112 2.944a11.955 11.955 0 01-8.618 3.04A12.02 12.02 0 003 9c0 5.591 3.824 10.29 9 11.622 5.176-1.332 9-6.03 9-11.622 0-1.042-.133-2.052-.382-3.016z\"/>\n        </svg>\n        Roles\n      </button>\n      <button class=\"project-tab-btn\" data-tab=\"config\">\n        <svg class=\"project-tab-icon\" fill=\"none\" viewBox=\"0 0 24 24\" stroke=\"currentColor\">\n          <path stroke-linecap=\"round\" stroke-linejoin=\"round\" stroke-width=\"2\" d=\"M12 6V4m0 2a2 2 0 100 4m0-4a2 2 0 110 4m-6 8a2 2 0 100-4m0 4a2 2 0 110-4m0 4v2m0-6V4m6 6v10m6-2a2 2 0 100-4m0 4a2 2 0 110-4m0 4v2m0-6V4\"/>\n        </svg>\n        Config\n      </button>\n    </nav>\n    \n    <!-- Tab Content -->\n    <div class=\"project-body\">\n      <!-- General Tab -->\n      <div class=\"project-section active\" id=\"section-general\">\n        <form id=\"project-form\">\n          <div class=\"form-grid\">\n            <div class=\"form-field full-width\">\n              <label>\n                <svg width=\"14\" height=\"14\" fill=\"none\" viewBox=\"0 0 24 24\" stroke=\"currentColor\">\n                  <path stroke-linecap=\"round\" stroke-linejoin=\"round\" stroke-width=\"2\" d=\"M3 7v10a2 2 0 002 2h14a2 2 0 002-2V9a2 2 0 00-2-2h-6l-2-2H5a2 2 0 00-2 2z\"/>\n                </svg>\n                Project Name *\n              </label>\n              <input type=\"text\" name=\"name\" required value=\"${escapeHtml(project.name)}\" placeholder=\"Enter project name\">\n            </div>\n            \n            <div class=\"form-field full-width\">\n              <label>\n                <svg width=\"14\" height=\"14\" fill=\"none\" viewBox=\"0 0 24 24\" stroke=\"currentColor\">\n                  <path stroke-linecap=\"round\" stroke-linejoin=\"round\" stroke-width=\"2\" d=\"M4 6h16M4 12h16M4 18h7\"/>\n                </svg>\n                Description\n              </label>\n              <textarea name=\"description\" placeholder=\"Brief description of the project\">${escapeHtml(project.description || '')}</textarea>\n            </div>\n            \n            <div class=\"form-field\">\n              <label>\n                <svg width=\"14\" height=\"14\" fill=\"none\" viewBox=\"0 0 24 24\" stroke=\"currentColor\">\n                  <path stroke-linecap=\"round\" stroke-linejoin=\"round\" stroke-width=\"2\" d=\"M16 7a4 4 0 11-8 0 4 4 0 018 0zM12 14a7 7 0 00-7 7h14a7 7 0 00-7-7z\"/>\n                </svg>\n                Your Role\n              </label>\n              <input type=\"text\" name=\"userRole\" value=\"${escapeHtml(settings.userRole || '')}\" placeholder=\"e.g., Project Manager, Tech Lead\">\n              <span class=\"form-hint\">Your role in this project (used for AI context)</span>\n            </div>\n            \n            <div class=\"form-field\">\n              <label>\n                <svg width=\"14\" height=\"14\" fill=\"none\" viewBox=\"0 0 24 24\" stroke=\"currentColor\">\n                  <path stroke-linecap=\"round\" stroke-linejoin=\"round\" stroke-width=\"2\" d=\"M8 10h.01M12 10h.01M16 10h.01M9 16H5a2 2 0 01-2-2V6a2 2 0 012-2h14a2 2 0 012 2v8a2 2 0 01-2 2h-5l-5 5v-5z\"/>\n                </svg>\n                Role Prompt\n              </label>\n              <input type=\"text\" name=\"userRolePrompt\" value=\"${escapeHtml(settings.userRolePrompt || '')}\" placeholder=\"e.g., I manage the project timeline\">\n              <span class=\"form-hint\">Brief description of your responsibilities</span>\n            </div>\n\n            <div class=\"form-field full-width\">\n              <label>\n                <svg width=\"14\" height=\"14\" fill=\"none\" viewBox=\"0 0 24 24\" stroke=\"currentColor\">\n                  <path stroke-linecap=\"round\" stroke-linejoin=\"round\" stroke-width=\"2\" d=\"M19 21V5a2 2 0 00-2-2H7a2 2 0 00-2 2v16m14 0h2m-2 0h-5m-9 0H3m2 0h5M9 7h1m-1 4h1m4-4h1m-1 4h1m-5 10v-5a1 1 0 011-1h2a1 1 0 011 1v5m-4 0h4\"/>\n                </svg>\n                Company\n              </label>\n              <select name=\"company_id\" id=\"project-company-id\">\n                <option value=\"\">Loading...</option>\n              </select>\n            </div>\n          </div>\n          \n          <div class=\"form-actions\">\n            <button type=\"submit\" class=\"btn-sota primary\">\n              <svg width=\"16\" height=\"16\" fill=\"none\" viewBox=\"0 0 24 24\" stroke=\"currentColor\">\n                <path stroke-linecap=\"round\" stroke-linejoin=\"round\" stroke-width=\"2\" d=\"M5 13l4 4L19 7\"/>\n              </svg>\n              Save Changes\n            </button>\n          </div>\n        </form>\n        \n        <!-- Danger Zone -->\n        <div class=\"danger-zone\">\n          <h3>\n            <svg fill=\"none\" viewBox=\"0 0 24 24\" stroke=\"currentColor\">\n              <path stroke-linecap=\"round\" stroke-linejoin=\"round\" stroke-width=\"2\" d=\"M12 9v2m0 4h.01m-6.938 4h13.856c1.54 0 2.502-1.667 1.732-3L13.732 4c-.77-1.333-2.694-1.333-3.464 0L3.34 16c-.77 1.333.192 3 1.732 3z\"/>\n            </svg>\n            Danger Zone\n          </h3>\n          <p>Deleting a project will permanently remove all associated data including questions, decisions, risks, and contacts.</p>\n          <button type=\"button\" class=\"btn-sota danger\" id=\"delete-project-btn\">\n            <svg width=\"16\" height=\"16\" fill=\"none\" viewBox=\"0 0 24 24\" stroke=\"currentColor\">\n              <path stroke-linecap=\"round\" stroke-linejoin=\"round\" stroke-width=\"2\" d=\"M19 7l-.867 12.142A2 2 0 0116.138 21H7.862a2 2 0 01-1.995-1.858L5 7m5 4v6m4-6v6m1-10V4a1 1 0 00-1-1h-4a1 1 0 00-1 1v3M4 7h16\"/>\n            </svg>\n            Delete Project\n          </button>\n        </div>\n      </div>\n      \n      <!-- Members Tab -->\n      <div class=\"project-section\" id=\"section-members\">\n        <div class=\"section-header\">\n          <h3>\n            <svg fill=\"none\" viewBox=\"0 0 24 24\" stroke=\"currentColor\">\n              <path stroke-linecap=\"round\" stroke-linejoin=\"round\" stroke-width=\"2\" d=\"M12 4.354a4 4 0 110 5.292M15 21H3v-1a6 6 0 0112 0v1zm0 0h6v-1a6 6 0 00-9-5.197M13 7a4 4 0 11-8 0 4 4 0 018 0z\"/>\n            </svg>\n            Team Members\n          </h3>\n          <button class=\"btn-sota primary small\" id=\"invite-member-btn\">\n            <svg width=\"14\" height=\"14\" fill=\"none\" viewBox=\"0 0 24 24\" stroke=\"currentColor\">\n              <path stroke-linecap=\"round\" stroke-linejoin=\"round\" stroke-width=\"2\" d=\"M18 9v3m0 0v3m0-3h3m-3 0h-3m-2-5a4 4 0 11-8 0 4 4 0 018 0zM3 20a6 6 0 0112 0v1H3v-1z\"/>\n            </svg>\n            Invite\n          </button>\n        </div>\n        \n        <div class=\"members-list\" id=\"members-list\">\n          ${renderMembersList()}\n        </div>\n      </div>\n      \n      <!-- Roles Tab -->\n      <div class=\"project-section\" id=\"section-roles\">\n        <div class=\"section-header\">\n          <h3>\n            <svg fill=\"none\" viewBox=\"0 0 24 24\" stroke=\"currentColor\">\n              <path stroke-linecap=\"round\" stroke-linejoin=\"round\" stroke-width=\"2\" d=\"M9 12l2 2 4-4m5.618-4.016A11.955 11.955 0 0112 2.944a11.955 11.955 0 01-8.618 3.04A12.02 12.02 0 003 9c0 5.591 3.824 10.29 9 11.622 5.176-1.332 9-6.03 9-11.622 0-1.042-.133-2.052-.382-3.016z\"/>\n            </svg>\n            Available Roles\n          </h3>\n          <button class=\"btn-sota primary small\" id=\"add-role-btn\">\n            <svg width=\"14\" height=\"14\" fill=\"none\" viewBox=\"0 0 24 24\" stroke=\"currentColor\">\n              <path stroke-linecap=\"round\" stroke-linejoin=\"round\" stroke-width=\"2\" d=\"M12 4v16m8-8H4\"/>\n            </svg>\n            Add Role\n          </button>\n        </div>\n        <p class=\"section-intro\">\n          Select which roles are available for team members in this project.\n        </p>\n        \n        <div class=\"roles-grid\" id=\"roles-grid\">\n          ${renderRolesList()}\n        </div>\n      </div>\n      \n      <!-- Config Tab -->\n      <div class=\"project-section\" id=\"section-config\">\n        <div class=\"section-header\">\n          <h3>\n            <svg fill=\"none\" viewBox=\"0 0 24 24\" stroke=\"currentColor\">\n              <path stroke-linecap=\"round\" stroke-linejoin=\"round\" stroke-width=\"2\" d=\"M12 6V4m0 2a2 2 0 100 4m0-4a2 2 0 110 4m-6 8a2 2 0 100-4m0 4a2 2 0 110-4m0 4v2m0-6V4m6 6v10m6-2a2 2 0 100-4m0 4a2 2 0 110-4m0 4v2m0-6V4\"/>\n            </svg>\n            Project Configuration\n          </h3>\n        </div>\n        <p class=\"section-intro-24\">\n          Override system defaults with project-specific API keys. Leave empty to use system defaults.\n        </p>\n        \n        <form id=\"config-form\">\n          <!-- LLM Per-Task Configuration -->\n          <div class=\"config-group\">\n            <h4>\n              <svg fill=\"none\" viewBox=\"0 0 24 24\" stroke=\"currentColor\">\n                <path stroke-linecap=\"round\" stroke-linejoin=\"round\" stroke-width=\"2\" d=\"M9 3v2m6-2v2M9 19v2m6-2v2M5 9H3m2 6H3m18-6h-2m2 6h-2M7 19h10a2 2 0 002-2V7a2 2 0 00-2-2H7a2 2 0 00-2 2v10a2 2 0 002 2zM9 9h6v6H9V9z\"/>\n              </svg>\n              LLM Model Selection\n            </h4>\n            <p class=\"section-intro-sm\">\n              Override system defaults for each task type. Uncheck to use platform defaults.\n            </p>\n            \n            <!-- Text -->\n            <div class=\"llm-task-override\">\n              <div class=\"task-header-inline\">\n                <label class=\"checkbox-inline\">\n                  <input type=\"checkbox\" name=\"use_system_text\" ${getConfigValue('llm_pertask.useSystemDefaults.text') !== 'false' ? 'checked' : ''}>\n                  <span class=\"task-icon\"></span> Text / Chat\n                </label>\n                <span class=\"system-hint\">(Use system default)</span>\n              </div>\n              <div class=\"task-override-fields ${getConfigValue('llm_pertask.useSystemDefaults.text') !== 'false' ? 'disabled' : ''}\">\n                <select name=\"text_provider\" class=\"form-control\" disabled>\n                  <option value=\"\">Loading...</option>\n                </select>\n                <select name=\"text_model\" class=\"form-control\" disabled>\n                  <option value=\"\">Select provider first</option>\n                </select>\n              </div>\n            </div>\n            \n            <!-- Vision -->\n            <div class=\"llm-task-override\">\n              <div class=\"task-header-inline\">\n                <label class=\"checkbox-inline\">\n                  <input type=\"checkbox\" name=\"use_system_vision\" ${getConfigValue('llm_pertask.useSystemDefaults.vision') !== 'false' ? 'checked' : ''}>\n                  <span class=\"task-icon\"></span> Vision\n                </label>\n                <span class=\"system-hint\">(Use system default)</span>\n              </div>\n              <div class=\"task-override-fields ${getConfigValue('llm_pertask.useSystemDefaults.vision') !== 'false' ? 'disabled' : ''}\">\n                <select name=\"vision_provider\" class=\"form-control\" disabled>\n                  <option value=\"\">Loading...</option>\n                </select>\n                <select name=\"vision_model\" class=\"form-control\" disabled>\n                  <option value=\"\">Select provider first</option>\n                </select>\n              </div>\n            </div>\n            \n            <!-- Embeddings -->\n            <div class=\"llm-task-override\">\n              <div class=\"task-header-inline\">\n                <label class=\"checkbox-inline\">\n                  <input type=\"checkbox\" name=\"use_system_embeddings\" ${getConfigValue('llm_pertask.useSystemDefaults.embeddings') !== 'false' ? 'checked' : ''}>\n                  <span class=\"task-icon\"></span> Embeddings\n                </label>\n                <span class=\"system-hint\">(Use system default)</span>\n              </div>\n              <div class=\"task-override-fields ${getConfigValue('llm_pertask.useSystemDefaults.embeddings') !== 'false' ? 'disabled' : ''}\">\n                <select name=\"embeddings_provider\" class=\"form-control\" disabled>\n                  <option value=\"\">Loading...</option>\n                </select>\n                <select name=\"embeddings_model\" class=\"form-control\" disabled>\n                  <option value=\"\">Select provider first</option>\n                </select>\n              </div>\n            </div>\n          </div>\n\n          <div class=\"config-group\">\n            <h4>\n              <svg fill=\"none\" viewBox=\"0 0 24 24\" stroke=\"currentColor\">\n                <path stroke-linecap=\"round\" stroke-linejoin=\"round\" stroke-width=\"2\" d=\"M9.663 17h4.673M12 3v1m6.364 1.636l-.707.707M21 12h-1M4 12H3m3.343-5.657l-.707-.707m2.828 9.9a5 5 0 117.072 0l-.548.547A3.374 3.374 0 0014 18.469V19a2 2 0 11-4 0v-.531c0-.895-.356-1.754-.988-2.386l-.548-.547z\"/>\n              </svg>\n              LLM API Keys\n            </h4>\n            <p class=\"section-intro-sm\">\n              Override system API keys for this project. Leave empty to use system defaults.\n            </p>\n            \n            <div class=\"form-grid\">\n              <div class=\"form-field\">\n                <label>OpenAI API Key</label>\n                <input type=\"password\" name=\"openai_key\" placeholder=\"sk-...\" value=\"${escapeHtml(getConfigValue('llm_config.openai_key'))}\">\n              </div>\n              \n              <div class=\"form-field\">\n                <label>Anthropic API Key</label>\n                <input type=\"password\" name=\"anthropic_key\" placeholder=\"sk-ant-...\" value=\"${escapeHtml(getConfigValue('llm_config.anthropic_key'))}\">\n              </div>\n              \n              <div class=\"form-field\">\n                <label>Google AI API Key</label>\n                <input type=\"password\" name=\"google_key\" placeholder=\"AI...\" value=\"${escapeHtml(getConfigValue('llm_config.google_key'))}\">\n              </div>\n              \n              <div class=\"form-field\">\n                <label>xAI (Grok) API Key</label>\n                <input type=\"password\" name=\"grok_key\" placeholder=\"xai-...\" value=\"${escapeHtml(getConfigValue('llm_config.grok_key'))}\">\n              </div>\n            </div>\n          </div>\n          \n          <div class=\"config-group\">\n            <h4>\n              <svg fill=\"none\" viewBox=\"0 0 24 24\" stroke=\"currentColor\">\n                <path stroke-linecap=\"round\" stroke-linejoin=\"round\" stroke-width=\"2\" d=\"M5 12h14M5 12a2 2 0 01-2-2V6a2 2 0 012-2h14a2 2 0 012 2v4a2 2 0 01-2 2M5 12a2 2 0 00-2 2v4a2 2 0 002 2h14a2 2 0 002-2v-4a2 2 0 00-2-2m-2-4h.01M17 16h.01\"/>\n              </svg>\n              Ollama Configuration\n            </h4>\n            \n            <div class=\"form-grid\">\n              <div class=\"form-field\">\n                <label>Ollama URL</label>\n                <input type=\"url\" name=\"ollama_url\" placeholder=\"http://localhost:11434\" value=\"${escapeHtml(getConfigValue('ollama_config.url'))}\">\n              </div>\n              \n              <div class=\"form-field\">\n                <label>Default Model</label>\n                <input type=\"text\" name=\"ollama_model\" placeholder=\"llama2, mistral, etc.\" value=\"${escapeHtml(getConfigValue('ollama_config.model'))}\">\n              </div>\n            </div>\n          </div>\n          \n          <div class=\"form-actions\">\n            <button type=\"submit\" class=\"btn-sota primary\">\n              <svg width=\"16\" height=\"16\" fill=\"none\" viewBox=\"0 0 24 24\" stroke=\"currentColor\">\n                <path stroke-linecap=\"round\" stroke-linejoin=\"round\" stroke-width=\"2\" d=\"M5 13l4 4L19 7\"/>\n              </svg>\n              Save Configuration\n            </button>\n          </div>\n        </form>\n      </div>\n    </div>\n  `;\n\n  bindEditEvents(container);\n}\n\n// ==================== Render Helpers ====================\n\nfunction renderMembersList(): string {\n  if (projectMembers.length === 0) {\n    return `\n      <div class=\"empty-state\">\n        <svg fill=\"none\" viewBox=\"0 0 24 24\" stroke=\"currentColor\">\n          <path stroke-linecap=\"round\" stroke-linejoin=\"round\" stroke-width=\"2\" d=\"M12 4.354a4 4 0 110 5.292M15 21H3v-1a6 6 0 0112 0v1zm0 0h6v-1a6 6 0 00-9-5.197M13 7a4 4 0 11-8 0 4 4 0 018 0z\"/>\n        </svg>\n        <p>No team members yet</p>\n        <button class=\"btn-sota primary small\" id=\"invite-first-btn\">Invite Member</button>\n      </div>\n    `;\n  }\n\n  return projectMembers.map(member => {\n    const initials = getInitials(member.display_name || member.email || 'U');\n    const isOwner = member.role === 'owner';\n\n    return `\n      <div class=\"member-card ${isOwner ? 'owner' : ''}\" data-user-id=\"${member.user_id}\">\n        <div class=\"member-info\">\n          <div class=\"member-avatar\">\n            ${member.avatar_url\n        ? `<img src=\"${member.avatar_url}\" alt=\"${escapeHtml(member.display_name || '')}\">`\n        : initials\n      }\n          </div>\n          <div class=\"member-details\">\n            <h4>${escapeHtml(member.display_name || member.email || 'Unknown')}</h4>\n            <p>\n              ${escapeHtml(member.email || '')}\n              ${member.user_role ? `  <strong>${escapeHtml(member.user_role)}</strong>` : '  <em class=\"member-role-muted\">No role defined</em>'}\n              ${member.linked_contact ? `  <span class=\"member-link\" title=\"Linked to contact: ${escapeHtml(member.linked_contact.name)}\"> ${escapeHtml(member.linked_contact.name)}</span>` : ''}\n            </p>\n          </div>\n        </div>\n        <div class=\"member-actions\">\n          <button class=\"btn-sota secondary small edit-user-role-btn\" data-user-id=\"${member.user_id}\" title=\"Edit project role\">\n            <svg width=\"14\" height=\"14\" fill=\"none\" viewBox=\"0 0 24 24\" stroke=\"currentColor\">\n              <path stroke-linecap=\"round\" stroke-linejoin=\"round\" stroke-width=\"2\" d=\"M11 5H6a2 2 0 00-2 2v11a2 2 0 002 2h11a2 2 0 002-2v-5m-1.414-9.414a2 2 0 112.828 2.828L11.828 15H9v-2.828l8.586-8.586z\"/>\n            </svg>\n          </button>\n          <button class=\"btn-sota secondary small permissions-btn\" data-user-id=\"${member.user_id}\" title=\"Edit permissions\">\n            \n          </button>\n          ${isOwner\n        ? `<span class=\"role-badge owner\">Owner</span>`\n        : `\n              <select class=\"role-select member-role-select\" data-user-id=\"${member.user_id}\" title=\"Access level\">\n                <option value=\"admin\" ${member.role === 'admin' ? 'selected' : ''}>Admin</option>\n                <option value=\"write\" ${member.role === 'write' ? 'selected' : ''}>Write</option>\n                <option value=\"read\" ${member.role === 'read' ? 'selected' : ''}>Read</option>\n              </select>\n              <button class=\"btn-sota danger small remove-member-btn\" data-user-id=\"${member.user_id}\" title=\"Remove member\">\n                <svg width=\"14\" height=\"14\" fill=\"none\" viewBox=\"0 0 24 24\" stroke=\"currentColor\">\n                  <path stroke-linecap=\"round\" stroke-linejoin=\"round\" stroke-width=\"2\" d=\"M6 18L18 6M6 6l12 12\"/>\n                </svg>\n              </button>\n            `\n      }\n        </div>\n      </div>\n    `;\n  }).join('');\n}\n\nfunction renderRolesList(): string {\n  if (projectRoles.length === 0) {\n    return `\n      <div class=\"empty-state gm-grid-col-all\">\n        <svg fill=\"none\" viewBox=\"0 0 24 24\" stroke=\"currentColor\">\n          <path stroke-linecap=\"round\" stroke-linejoin=\"round\" stroke-width=\"2\" d=\"M9 12l2 2 4-4m5.618-4.016A11.955 11.955 0 0112 2.944a11.955 11.955 0 01-8.618 3.04A12.02 12.02 0 003 9c0 5.591 3.824 10.29 9 11.622 5.176-1.332 9-6.03 9-11.622 0-1.042-.133-2.052-.382-3.016z\"/>\n        </svg>\n        <p>No role templates available</p>\n      </div>\n    `;\n  }\n\n  return projectRoles.map(role => `\n    <div class=\"role-card ${role.is_active ? 'active' : ''}\" data-role-id=\"${role.id}\">\n      <div class=\"role-card-header\">\n        <div class=\"role-icon\">\n          <svg fill=\"none\" viewBox=\"0 0 24 24\" stroke=\"currentColor\">\n            <path stroke-linecap=\"round\" stroke-linejoin=\"round\" stroke-width=\"2\" d=\"M16 7a4 4 0 11-8 0 4 4 0 018 0zM12 14a7 7 0 00-7 7h14a7 7 0 00-7-7z\"/>\n          </svg>\n        </div>\n        <h4>${escapeHtml(role.display_name)}</h4>\n      </div>\n      <p>${escapeHtml(role.description || 'No description')}</p>\n      <div class=\"toggle-active\">\n        <input type=\"checkbox\" id=\"role-${role.id}\" ${role.is_active ? 'checked' : ''}>\n        <label for=\"role-${role.id}\">Active in this project</label>\n      </div>\n    </div>\n  `).join('');\n}\n\nfunction getConfigValue(path: string): string {\n  if (!projectConfig) return '';\n\n  const parts = path.split('.');\n  // eslint-disable-next-line @typescript-eslint/no-explicit-any\n  let value: any = projectConfig;\n\n  for (const part of parts) {\n    if (value && typeof value === 'object' && part in value) {\n      value = value[part];\n    } else {\n      return '';\n    }\n  }\n\n  return typeof value === 'string' ? value : '';\n}\n\n// ==================== Event Binding ====================\n\nfunction bindCreateEvents(container: HTMLElement): void {\n  // Close button\n  const closeBtn = container.querySelector('#close-project-btn');\n  if (closeBtn) {\n    on(closeBtn as HTMLElement, 'click', () => closeOrInlineCancel());\n  }\n\n  // Cancel button\n  const cancelBtn = container.querySelector('#cancel-btn');\n  if (cancelBtn) {\n    on(cancelBtn as HTMLElement, 'click', () => closeOrInlineCancel());\n  }\n\n  // Load companies for dropdown\n  const companySelect = container.querySelector('#project-company-id') as HTMLSelectElement;\n  if (companySelect) {\n    listCompanies()\n      .then((companies) => {\n        companySelect.innerHTML = '<option value=\"\">Use default company</option>' +\n          companies.map((c) => `<option value=\"${c.id}\">${escapeHtml(c.name)}</option>`).join('');\n      })\n      .catch(() => {\n        companySelect.innerHTML = '<option value=\"\">Use default company</option>';\n      });\n  }\n\n  // Form submit\n  const form = container.querySelector('#project-form') as HTMLFormElement;\n  if (form) {\n    on(form, 'submit', async (e) => {\n      e.preventDefault();\n\n      const formData = new FormData(form);\n      const companyId = (formData.get('company_id') as string)?.trim() || undefined;\n      const projectData: ProjectData & { company_id?: string } = {\n        name: (formData.get('name') as string).trim(),\n        description: (formData.get('description') as string).trim() || undefined,\n      };\n      if (companyId) projectData.company_id = companyId;\n\n      // SOTA Validation\n      const validation = projectSchema.safeParse(projectData);\n      if (!validation.success) {\n        toast.error(validation.error.issues[0].message);\n        return;\n      }\n\n      const submitBtn = form.querySelector('button[type=\"submit\"]') as HTMLButtonElement;\n      submitBtn.disabled = true;\n      submitBtn.innerHTML = '<span class=\"loading-spinner gm-size-4\"></span> Creating...';\n\n      try {\n        const response = await http.post<{ id: string; project?: ProjectData }>('/api/projects', projectData);\n        projectData.id = response.data.id;\n\n        toast.success('Project created');\n\n        // Set as current project\n        appStore.setCurrentProject({\n          id: projectData.id,\n          name: projectData.name,\n          description: projectData.description,\n        });\n\n        currentProps.onSave?.(projectData);\n        closeOrInlineCancel();\n        loadProjects();\n      } catch {\n        toast.error('Failed to create project');\n      } finally {\n        submitBtn.disabled = false;\n        submitBtn.innerHTML = `\n          <svg width=\"16\" height=\"16\" fill=\"none\" viewBox=\"0 0 24 24\" stroke=\"currentColor\">\n            <path stroke-linecap=\"round\" stroke-linejoin=\"round\" stroke-width=\"2\" d=\"M12 4v16m8-8H4\"/>\n          </svg>\n          Create Project\n        `;\n      }\n    });\n  }\n}\n\nfunction bindEditEvents(container: HTMLElement): void {\n  // Close button\n  const closeBtn = container.querySelector('#close-project-btn');\n  if (closeBtn) {\n    on(closeBtn as HTMLElement, 'click', () => closeOrInlineCancel());\n  }\n\n  // Tab switching\n  const tabs = container.querySelectorAll('.project-tab-btn');\n  tabs.forEach(tab => {\n    on(tab as HTMLElement, 'click', () => {\n      tabs.forEach(t => t.classList.remove('active'));\n      tab.classList.add('active');\n\n      const tabId = tab.getAttribute('data-tab');\n      container.querySelectorAll('.project-section').forEach(section => {\n        section.classList.toggle('active', section.id === `section-${tabId}`);\n      });\n    });\n  });\n\n  // Load companies for edit form dropdown\n  const companySelectEdit = container.querySelector('#project-company-id') as HTMLSelectElement;\n  if (companySelectEdit) {\n    const project = currentProject || currentProps.project;\n    const currentCompanyId = project?.company_id ?? (project as ProjectData & { company?: { id: string } })?.company?.id;\n    listCompanies()\n      .then((companies) => {\n        companySelectEdit.innerHTML = '<option value=\"\"></option>' +\n          companies.map((c) => `<option value=\"${c.id}\" ${c.id === currentCompanyId ? 'selected' : ''}>${escapeHtml(c.name)}</option>`).join('');\n      })\n      .catch(() => {\n        companySelectEdit.innerHTML = '<option value=\"\"></option>';\n      });\n  }\n\n  // General form submit\n  const projectForm = container.querySelector('#project-form') as HTMLFormElement;\n  if (projectForm) {\n    on(projectForm, 'submit', async (e) => {\n      e.preventDefault();\n\n      const formData = new FormData(projectForm);\n      const companyId = (formData.get('company_id') as string)?.trim() || undefined;\n      const projectData: Record<string, unknown> = {\n        name: (formData.get('name') as string).trim(),\n        description: (formData.get('description') as string).trim() || undefined,\n        settings: {\n          userRole: (formData.get('userRole') as string).trim() || undefined,\n          userRolePrompt: (formData.get('userRolePrompt') as string).trim() || undefined,\n        },\n      };\n      if (companyId) projectData.company_id = companyId;\n\n      // SOTA Validation\n      const validation = projectSchema.safeParse(projectData);\n      if (!validation.success) {\n        toast.error(validation.error.issues[0].message);\n        return;\n      }\n\n      try {\n        await http.put(`/api/projects/${currentProject?.id || currentProps.project?.id}`, projectData);\n        toast.success('Project updated');\n        currentProps.onSave?.({ ...currentProject, ...projectData } as ProjectData);\n        if (inlineOnCancel) closeOrInlineCancel();\n\n        // Update header\n        const titleEl = container.querySelector('.project-title-info h2');\n        const descEl = container.querySelector('.project-title-info p');\n        if (titleEl) titleEl.textContent = String(projectData.name);\n        if (descEl) descEl.textContent = String(projectData.description || 'No description');\n      } catch {\n        toast.error('Failed to update project');\n      }\n    });\n  }\n\n  // Delete project\n  const deleteBtn = container.querySelector('#delete-project-btn');\n  if (deleteBtn) {\n    on(deleteBtn as HTMLElement, 'click', async () => {\n      const project = currentProject || currentProps.project;\n      if (!project?.id) return;\n\n      const confirmed = await confirm(\n        `Are you sure you want to delete \"${project.name}\"? This action cannot be undone.`,\n        {\n          title: 'Delete Project',\n          confirmText: 'Delete',\n          confirmClass: 'btn-danger',\n        }\n      );\n\n      if (confirmed) {\n        try {\n          await http.delete(`/api/projects/${project.id}`);\n          toast.success('Project deleted');\n          currentProps.onDelete?.(project.id);\n          closeOrInlineCancel();\n\n          if (appStore.getState().currentProjectId === project.id) {\n            appStore.setCurrentProject(null);\n          }\n\n          loadProjects();\n        } catch {\n          toast.error('Failed to delete project');\n        }\n      }\n    });\n  }\n\n  // Invite member buttons\n  const inviteBtn = container.querySelector('#invite-member-btn');\n  const inviteFirstBtn = container.querySelector('#invite-first-btn');\n  [inviteBtn, inviteFirstBtn].forEach(btn => {\n    if (btn) {\n      on(btn as HTMLElement, 'click', () => {\n        showInviteModal();\n      });\n    }\n  });\n\n  // Add role button\n  const addRoleBtn = container.querySelector('#add-role-btn');\n  if (addRoleBtn) {\n    on(addRoleBtn as HTMLElement, 'click', () => {\n      showAddRoleDialog(container);\n    });\n  }\n\n  // Member role changes\n  container.querySelectorAll('.member-role-select').forEach(select => {\n    on(select as HTMLElement, 'change', async () => {\n      const userId = select.getAttribute('data-user-id');\n      const newRole = (select as HTMLSelectElement).value;\n      const projectId = currentProject?.id || currentProps.project?.id;\n\n      if (!userId || !projectId) return;\n\n      try {\n        await http.put(`/api/projects/${projectId}/members/${userId}`, { role: newRole });\n        toast.success('Member role updated');\n      } catch {\n        toast.error('Failed to update role');\n      }\n    });\n  });\n\n  // Remove member\n  container.querySelectorAll('.remove-member-btn').forEach(btn => {\n    on(btn as HTMLElement, 'click', async () => {\n      const userId = btn.getAttribute('data-user-id');\n      const projectId = currentProject?.id || currentProps.project?.id;\n\n      if (!userId || !projectId) return;\n\n      const confirmed = await confirm('Remove this member from the project?', {\n        title: 'Remove Member',\n        confirmText: 'Remove',\n        confirmClass: 'btn-danger',\n      });\n\n      if (confirmed) {\n        try {\n          await http.delete(`/api/projects/${projectId}/members/${userId}`);\n          toast.success('Member removed');\n\n          // Remove from list\n          projectMembers = projectMembers.filter(m => m.user_id !== userId);\n          const membersList = container.querySelector('#members-list');\n          if (membersList) {\n            membersList.innerHTML = renderMembersList();\n            bindMemberEvents(container);\n          }\n        } catch {\n          toast.error('Failed to remove member');\n        }\n      }\n    });\n  });\n\n  // Config form submit\n  const configForm = container.querySelector('#config-form') as HTMLFormElement;\n  if (configForm) {\n    on(configForm, 'submit', async (e) => {\n      e.preventDefault();\n\n      const formData = new FormData(configForm);\n      const config = {\n        llm_config: {\n          openai_key: formData.get('openai_key') || undefined,\n          anthropic_key: formData.get('anthropic_key') || undefined,\n          google_key: formData.get('google_key') || undefined,\n          grok_key: formData.get('grok_key') || undefined,\n        },\n        ollama_config: {\n          url: formData.get('ollama_url') || undefined,\n          model: formData.get('ollama_model') || undefined,\n        },\n      };\n\n      const projectId = currentProject?.id || currentProps.project?.id;\n      if (!projectId) return;\n\n      try {\n        await http.put(`/api/projects/${projectId}/config`, config);\n        toast.success('Configuration saved');\n      } catch {\n        toast.error('Failed to save configuration');\n      }\n    });\n  }\n\n  // Bind member-specific events (edit role buttons)\n  bindMemberEvents(container);\n}\n\nfunction bindMemberEvents(container: HTMLElement): void {\n  // Edit user role buttons\n  container.querySelectorAll('.edit-user-role-btn').forEach(btn => {\n    on(btn as HTMLElement, 'click', () => {\n      const userId = btn.getAttribute('data-user-id');\n      if (!userId) return;\n\n      const member = projectMembers.find(m => m.user_id === userId);\n      if (member) {\n        showEditUserRoleDialog(container, member);\n      }\n    });\n  });\n\n  // Permissions buttons\n  container.querySelectorAll('.permissions-btn').forEach(btn => {\n    on(btn as HTMLElement, 'click', () => {\n      const userId = btn.getAttribute('data-user-id');\n      if (!userId) return;\n\n      const member = projectMembers.find(m => m.user_id === userId);\n      const projectId = currentProject?.id || currentProps.project?.id;\n      if (!member || !projectId) return;\n\n      showMemberPermissionsModal({\n        projectId,\n        userId: member.user_id,\n        userName: member.display_name || '',\n        userEmail: member.email || '',\n        avatarUrl: member.avatar_url,\n        currentRole: member.role,\n        currentPermissions: (member as { permissions?: string[] }).permissions,\n        onSave: async () => {\n          // Reload members after permissions update\n          try {\n            const response = await http.get<{ members: typeof projectMembers }>(`/api/projects/${projectId}/members`);\n            projectMembers = response.data.members || [];\n            const membersList = container.querySelector('#members-list');\n            if (membersList) {\n              membersList.innerHTML = renderMembersList();\n              bindMemberEvents(container);\n            }\n          } catch {\n            // Ignore\n          }\n        },\n      });\n    });\n  });\n\n  // Re-bind member role changes and remove buttons after list update\n  container.querySelectorAll('.member-role-select').forEach(select => {\n    on(select as HTMLElement, 'change', async () => {\n      const userId = select.getAttribute('data-user-id');\n      const newRole = (select as HTMLSelectElement).value;\n      const projectId = currentProject?.id || currentProps.project?.id;\n\n      if (!userId || !projectId) return;\n\n      try {\n        await http.put(`/api/projects/${projectId}/members/${userId}`, { role: newRole });\n        toast.success('Access level updated');\n      } catch {\n        toast.error('Failed to update access level');\n      }\n    });\n  });\n\n  container.querySelectorAll('.remove-member-btn').forEach(btn => {\n    on(btn as HTMLElement, 'click', async () => {\n      const userId = btn.getAttribute('data-user-id');\n      const projectId = currentProject?.id || currentProps.project?.id;\n\n      if (!userId || !projectId) return;\n\n      const confirmed = await confirm('Remove this member from the project?', {\n        title: 'Remove Member',\n        confirmText: 'Remove',\n        confirmClass: 'btn-danger',\n      });\n\n      if (confirmed) {\n        try {\n          await http.delete(`/api/projects/${projectId}/members/${userId}`);\n          toast.success('Member removed');\n\n          projectMembers = projectMembers.filter(m => m.user_id !== userId);\n          const membersList = container.querySelector('#members-list');\n          if (membersList) {\n            membersList.innerHTML = renderMembersList();\n            bindMemberEvents(container);\n          }\n        } catch {\n          toast.error('Failed to remove member');\n        }\n      }\n    });\n  });\n}\n\n/**\n * Show dialog to add a new role\n */\nfunction showAddRoleDialog(container: HTMLElement): void {\n  // Check if dialog already exists\n  const existingDialog = container.querySelector('.add-role-dialog');\n  if (existingDialog) existingDialog.remove();\n\n  const projectId = currentProject?.id || currentProps.project?.id;\n  if (!projectId) return;\n\n  // Create dialog\n  const dialog = createElement('div', { className: 'add-role-dialog' });\n  dialog.innerHTML = `\n    <style>\n      .add-role-dialog {\n        position: fixed;\n        top: 0;\n        left: 0;\n        right: 0;\n        bottom: 0;\n        background: rgba(0,0,0,0.5);\n        display: flex;\n        align-items: center;\n        justify-content: center;\n        z-index: 10001;\n        backdrop-filter: blur(4px);\n      }\n      \n      .add-role-card {\n        background: white;\n        border-radius: 20px;\n        width: 100%;\n        max-width: 500px;\n        box-shadow: 0 25px 50px -12px rgba(0,0,0,0.25);\n        overflow: hidden;\n      }\n      \n      [data-theme=\"dark\"] .add-role-card {\n        background: #1e293b;\n      }\n      \n      .add-role-header {\n        background: linear-gradient(135deg, #e11d48 0%, #be123c 100%);\n        padding: 20px 24px;\n        color: white;\n      }\n      \n      .add-role-header h4 {\n        margin: 0;\n        font-size: 18px;\n        font-weight: 700;\n      }\n      \n      .add-role-body {\n        padding: 24px;\n      }\n      \n      .add-role-field {\n        margin-bottom: 20px;\n      }\n      \n      .add-role-field label {\n        display: block;\n        font-size: 13px;\n        font-weight: 600;\n        color: #64748b;\n        margin-bottom: 8px;\n      }\n      \n      .add-role-field input,\n      .add-role-field textarea,\n      .add-role-field select {\n        width: 100%;\n        padding: 12px 16px;\n        border: 1px solid #e2e8f0;\n        border-radius: 10px;\n        font-size: 14px;\n        box-sizing: border-box;\n        background: #f8fafc;\n      }\n      \n      [data-theme=\"dark\"] .add-role-field input,\n      [data-theme=\"dark\"] .add-role-field textarea,\n      [data-theme=\"dark\"] .add-role-field select {\n        background: rgba(255,255,255,0.05);\n        border-color: rgba(255,255,255,0.1);\n        color: #f1f5f9;\n      }\n      \n      .add-role-field input:focus,\n      .add-role-field textarea:focus,\n      .add-role-field select:focus {\n        outline: none;\n        border-color: #e11d48;\n        box-shadow: 0 0 0 3px rgba(225,29,72,0.1);\n      }\n      \n      .add-role-field textarea {\n        resize: vertical;\n        min-height: 80px;\n      }\n      \n      .add-role-ai-btn {\n        display: inline-flex;\n        align-items: center;\n        gap: 6px;\n        padding: 8px 14px;\n        background: linear-gradient(135deg, #8b5cf6 0%, #7c3aed 100%);\n        color: white;\n        border: none;\n        border-radius: 8px;\n        font-size: 12px;\n        font-weight: 600;\n        cursor: pointer;\n        margin-top: 8px;\n        transition: all 0.2s;\n      }\n      \n      .add-role-ai-btn:hover {\n        transform: translateY(-1px);\n        box-shadow: 0 4px 12px rgba(139,92,246,0.3);\n      }\n      \n      .add-role-ai-btn:disabled {\n        opacity: 0.6;\n        cursor: not-allowed;\n      }\n      \n      .add-role-actions {\n        display: flex;\n        gap: 12px;\n        justify-content: flex-end;\n        padding-top: 16px;\n        border-top: 1px solid #e2e8f0;\n      }\n      \n      [data-theme=\"dark\"] .add-role-actions {\n        border-color: rgba(255,255,255,0.1);\n      }\n    </style>\n    \n    <div class=\"add-role-card\">\n      <div class=\"add-role-header\">\n        <h4>Add New Role</h4>\n      </div>\n      <div class=\"add-role-body\">\n        <form id=\"add-role-form\">\n          <div class=\"add-role-field\">\n            <label>Role Name *</label>\n            <input type=\"text\" id=\"new-role-name\" required placeholder=\"e.g., Senior Developer, Tech Lead\">\n          </div>\n          \n          <div class=\"add-role-field\">\n            <label>Category</label>\n            <select id=\"new-role-category\">\n              <option value=\"project\"> Project</option>\n              <option value=\"technical\"> Technical</option>\n              <option value=\"management\"> Management</option>\n              <option value=\"stakeholder\"> Stakeholder</option>\n              <option value=\"custom\"> Custom</option>\n            </select>\n          </div>\n          \n          <div class=\"add-role-field\">\n            <label>Description</label>\n            <input type=\"text\" id=\"new-role-description\" placeholder=\"Brief description of this role\">\n          </div>\n          \n          <div class=\"add-role-field\">\n            <label>Role Context (for AI)</label>\n            <textarea id=\"new-role-context\" placeholder=\"Describe this role's responsibilities, priorities, and how the AI should adapt responses...\"></textarea>\n            <button type=\"button\" class=\"add-role-ai-btn\" id=\"enhance-role-btn\">\n               Enhance with AI\n            </button>\n          </div>\n          \n          <div class=\"add-role-actions\">\n            <button type=\"button\" class=\"btn-sota secondary\" id=\"cancel-add-role\">Cancel</button>\n            <button type=\"submit\" class=\"btn-sota primary\">Create Role</button>\n          </div>\n        </form>\n      </div>\n    </div>\n  `;\n\n  container.appendChild(dialog);\n\n  // Bind events\n  const closeDialog = () => dialog.remove();\n\n  // Cancel button\n  const cancelBtn = dialog.querySelector('#cancel-add-role');\n  if (cancelBtn) {\n    on(cancelBtn as HTMLElement, 'click', closeDialog);\n  }\n\n  // Click outside to close\n  on(dialog, 'click', (e) => {\n    if (e.target === dialog) closeDialog();\n  });\n\n  // AI enhance button\n  const enhanceBtn = dialog.querySelector('#enhance-role-btn');\n  if (enhanceBtn) {\n    on(enhanceBtn as HTMLElement, 'click', async () => {\n      const nameInput = dialog.querySelector('#new-role-name') as HTMLInputElement;\n      const contextInput = dialog.querySelector('#new-role-context') as HTMLTextAreaElement;\n      const descInput = dialog.querySelector('#new-role-description') as HTMLInputElement;\n\n      const roleName = nameInput.value.trim();\n      if (!roleName) {\n        toast.error('Please enter a role name first');\n        return;\n      }\n\n      (enhanceBtn as HTMLButtonElement).disabled = true;\n      enhanceBtn.textContent = ' Enhancing...';\n\n      try {\n        const response = await http.post<{ prompt: string; description?: string }>('/api/roles/generate', {\n          title: roleName,\n          currentContext: contextInput.value,\n        });\n\n        if (response.data.prompt) {\n          contextInput.value = response.data.prompt;\n        }\n        if (response.data.description && !descInput.value) {\n          descInput.value = response.data.description;\n        }\n        toast.success('Role context enhanced');\n      } catch {\n        toast.error('Failed to enhance with AI');\n      } finally {\n        (enhanceBtn as HTMLButtonElement).disabled = false;\n        enhanceBtn.textContent = ' Enhance with AI';\n      }\n    });\n  }\n\n  // Form submit\n  const form = dialog.querySelector('#add-role-form') as HTMLFormElement;\n  if (form) {\n    on(form, 'submit', async (e) => {\n      e.preventDefault();\n\n      const name = (dialog.querySelector('#new-role-name') as HTMLInputElement).value.trim();\n      const category = (dialog.querySelector('#new-role-category') as HTMLSelectElement).value;\n      const description = (dialog.querySelector('#new-role-description') as HTMLInputElement).value.trim();\n      const roleContext = (dialog.querySelector('#new-role-context') as HTMLTextAreaElement).value.trim();\n\n      if (!name) {\n        toast.error('Role name is required');\n        return;\n      }\n\n      try {\n        await http.post('/api/role-templates', {\n          name: name.toLowerCase().replace(/\\s+/g, '_'),\n          display_name: name,\n          description,\n          role_context: roleContext,\n          category,\n          color: '#e11d48',\n          is_template: true,\n        });\n\n        toast.success('Role created');\n        closeDialog();\n\n        // Reload roles\n        await loadProjectRoles(projectId);\n        const rolesGrid = container.querySelector('#roles-grid');\n        if (rolesGrid) {\n          rolesGrid.innerHTML = renderRolesList();\n        }\n      } catch {\n        toast.error('Failed to create role');\n      }\n    });\n  }\n\n  // Focus on name input\n  setTimeout(() => {\n    const nameInput = dialog.querySelector('#new-role-name') as HTMLInputElement;\n    if (nameInput) nameInput.focus();\n  }, 100);\n}\n\n/**\n * Show inline edit dialog for user role\n */\nfunction showEditUserRoleDialog(container: HTMLElement, member: ProjectMember): void {\n  // Check if dialog already exists\n  const existingDialog = container.querySelector('.user-role-edit-dialog');\n  if (existingDialog) existingDialog.remove();\n\n  const projectId = currentProject?.id || currentProps.project?.id;\n  if (!projectId) return;\n\n  // Create inline edit dialog\n  const dialog = createElement('div', { className: 'user-role-edit-dialog' });\n  dialog.innerHTML = `\n    <style>\n      .user-role-edit-dialog {\n        position: fixed;\n        top: 50%;\n        left: 50%;\n        transform: translate(-50%, -50%);\n        background: white;\n        border-radius: 16px;\n        box-shadow: 0 25px 50px rgba(0,0,0,0.25);\n        padding: 24px;\n        z-index: 10001;\n        width: 400px;\n        max-width: 90vw;\n      }\n      \n      [data-theme=\"dark\"] .user-role-edit-dialog {\n        background: #1e293b;\n      }\n      \n      .user-role-edit-dialog h3 {\n        margin: 0 0 20px 0;\n        font-size: 18px;\n        font-weight: 600;\n        color: #1e293b;\n        display: flex;\n        align-items: center;\n        gap: 10px;\n      }\n      \n      [data-theme=\"dark\"] .user-role-edit-dialog h3 {\n        color: #f1f5f9;\n      }\n      \n      .user-role-edit-dialog h3 svg {\n        width: 20px;\n        height: 20px;\n        color: #e11d48;\n      }\n      \n      .user-role-edit-dialog .form-field {\n        margin-bottom: 16px;\n      }\n      \n      .user-role-edit-dialog .form-field label {\n        display: block;\n        font-size: 13px;\n        font-weight: 600;\n        color: #475569;\n        margin-bottom: 6px;\n      }\n      \n      [data-theme=\"dark\"] .user-role-edit-dialog .form-field label {\n        color: #94a3b8;\n      }\n      \n      .user-role-edit-dialog .form-field input,\n      .user-role-edit-dialog .form-field textarea,\n      .user-role-edit-dialog .form-field select {\n        width: 100%;\n        padding: 10px 14px;\n        border: 1px solid #e2e8f0;\n        border-radius: 10px;\n        font-size: 14px;\n        background: #f8fafc;\n        color: #1e293b;\n        box-sizing: border-box;\n      }\n      \n      [data-theme=\"dark\"] .user-role-edit-dialog .form-field input,\n      [data-theme=\"dark\"] .user-role-edit-dialog .form-field textarea,\n      [data-theme=\"dark\"] .user-role-edit-dialog .form-field select {\n        background: rgba(255,255,255,0.05);\n        border-color: rgba(255,255,255,0.1);\n        color: #f1f5f9;\n      }\n      \n      .user-role-edit-dialog .form-field input:focus,\n      .user-role-edit-dialog .form-field textarea:focus,\n      .user-role-edit-dialog .form-field select:focus {\n        outline: none;\n        border-color: #e11d48;\n        box-shadow: 0 0 0 3px rgba(225, 29, 72, 0.1);\n      }\n      \n      .user-role-edit-dialog .form-field textarea {\n        resize: vertical;\n        min-height: 80px;\n      }\n      \n      .user-role-edit-dialog .form-hint {\n        font-size: 12px;\n        color: #94a3b8;\n        margin-top: 4px;\n      }\n      \n      .user-role-edit-dialog .linked-contact-info {\n        display: flex;\n        align-items: center;\n        gap: 10px;\n        padding: 10px 14px;\n        background: linear-gradient(135deg, rgba(225,29,72,0.05) 0%, rgba(225,29,72,0.02) 100%);\n        border: 1px solid rgba(225,29,72,0.2);\n        border-radius: 10px;\n        margin-top: 8px;\n      }\n      \n      .user-role-edit-dialog .linked-contact-info svg {\n        width: 16px;\n        height: 16px;\n        color: #e11d48;\n        flex-shrink: 0;\n      }\n      \n      .user-role-edit-dialog .linked-contact-info span {\n        font-size: 13px;\n        color: #1e293b;\n      }\n      \n      [data-theme=\"dark\"] .user-role-edit-dialog .linked-contact-info span {\n        color: #f1f5f9;\n      }\n      \n      .user-role-edit-dialog .dialog-actions {\n        display: flex;\n        justify-content: flex-end;\n        gap: 10px;\n        margin-top: 20px;\n      }\n      \n      .user-role-edit-overlay {\n        position: fixed;\n        inset: 0;\n        background: rgba(0,0,0,0.4);\n        z-index: 10000;\n      }\n    </style>\n    \n    <h3>\n      <svg fill=\"none\" viewBox=\"0 0 24 24\" stroke=\"currentColor\">\n        <path stroke-linecap=\"round\" stroke-linejoin=\"round\" stroke-width=\"2\" d=\"M16 7a4 4 0 11-8 0 4 4 0 018 0zM12 14a7 7 0 00-7 7h14a7 7 0 00-7-7z\"/>\n      </svg>\n      Edit Project Role\n    </h3>\n    <p class=\"section-intro-last\">\n      Define <strong>${escapeHtml(member.display_name || member.email || 'this member')}</strong>'s role in the project\n    </p>\n    \n    <div class=\"form-field\">\n      <label>Role Title</label>\n      <select id=\"edit-user-role\">\n        <option value=\"\">-- Select a role --</option>\n        ${projectRoles.filter(r => r.is_active).map(r => `\n          <option value=\"${escapeHtml(r.display_name || r.name)}\" \n                  data-prompt=\"${escapeHtml(r.prompt_template || '')}\"\n                  ${member.user_role === r.display_name || member.user_role === r.name ? 'selected' : ''}>\n            ${escapeHtml(r.display_name || r.name)}\n          </option>\n        `).join('')}\n        <option value=\"__custom__\" ${member.user_role && !projectRoles.some(r => r.display_name === member.user_role || r.name === member.user_role) ? 'selected' : ''}>Custom role...</option>\n      </select>\n      <div class=\"form-hint\">Select a predefined role or choose \"Custom role\" for a custom title</div>\n      <input type=\"text\" id=\"edit-user-role-custom\" \n             value=\"${member.user_role && !projectRoles.some(r => r.display_name === member.user_role || r.name === member.user_role) ? escapeHtml(member.user_role) : ''}\" \n             placeholder=\"Enter custom role title\"\n             class=\"gm-mt-2 ${member.user_role && !projectRoles.some(r => r.display_name === member.user_role || r.name === member.user_role) ? '' : 'hidden'}\">\n    </div>\n    \n    <div class=\"form-field\">\n      <label>Role Description</label>\n      <textarea id=\"edit-user-role-prompt\" placeholder=\"e.g., I manage the technical architecture and lead the development team\">${escapeHtml(member.user_role_prompt || '')}</textarea>\n      <div class=\"form-hint\">Brief description of responsibilities (used for AI context)</div>\n    </div>\n    \n    <div class=\"form-field\">\n      <label>\n        <svg class=\"gm-inline-icon\" width=\"14\" height=\"14\" fill=\"none\" viewBox=\"0 0 24 24\" stroke=\"currentColor\">\n          <path stroke-linecap=\"round\" stroke-linejoin=\"round\" stroke-width=\"2\" d=\"M17 20h5v-2a3 3 0 00-5.356-1.857M17 20H7m10 0v-2c0-.656-.126-1.283-.356-1.857M7 20H2v-2a3 3 0 015.356-1.857M7 20v-2c0-.656.126-1.283.356-1.857m0 0a5.002 5.002 0 019.288 0M15 7a3 3 0 11-6 0 3 3 0 016 0zm6 3a2 2 0 11-4 0 2 2 0 014 0zM7 10a2 2 0 11-4 0 2 2 0 014 0z\"/>\n        </svg>\n        Link to Contact\n      </label>\n      <select id=\"edit-linked-contact\">\n        <option value=\"\">-- No linked contact --</option>\n        ${projectContacts.map(c => `\n          <option value=\"${c.id}\" ${member.linked_contact_id === c.id ? 'selected' : ''}>\n            ${escapeHtml(c.name)}${c.organization ? ` (${escapeHtml(c.organization)})` : ''}${c.email ? ` - ${escapeHtml(c.email)}` : ''}\n          </option>\n        `).join('')}\n      </select>\n      <div class=\"form-hint\">Associate this team member with a project contact</div>\n      ${member.linked_contact ? `\n        <div class=\"linked-contact-info\">\n          <svg fill=\"none\" viewBox=\"0 0 24 24\" stroke=\"currentColor\">\n            <path stroke-linecap=\"round\" stroke-linejoin=\"round\" stroke-width=\"2\" d=\"M13.828 10.172a4 4 0 00-5.656 0l-4 4a4 4 0 105.656 5.656l1.102-1.101m-.758-4.899a4 4 0 005.656 0l4-4a4 4 0 00-5.656-5.656l-1.1 1.1\"/>\n          </svg>\n          <span>Currently linked to: <strong>${escapeHtml(member.linked_contact.name)}</strong></span>\n        </div>\n      ` : ''}\n    </div>\n    \n    <div class=\"dialog-actions\">\n      <button class=\"btn-sota secondary\" id=\"cancel-role-edit\">Cancel</button>\n      <button class=\"btn-sota primary\" id=\"save-role-edit\">\n        <svg width=\"14\" height=\"14\" fill=\"none\" viewBox=\"0 0 24 24\" stroke=\"currentColor\">\n          <path stroke-linecap=\"round\" stroke-linejoin=\"round\" stroke-width=\"2\" d=\"M5 13l4 4L19 7\"/>\n        </svg>\n        Save Role\n      </button>\n    </div>\n  `;\n\n  // Create overlay\n  const overlay = createElement('div', { className: 'user-role-edit-overlay' });\n\n  document.body.appendChild(overlay);\n  document.body.appendChild(dialog);\n\n  // Focus first input\n  const roleSelect = dialog.querySelector('#edit-user-role') as HTMLSelectElement;\n  const customInput = dialog.querySelector('#edit-user-role-custom') as HTMLInputElement;\n  const promptTextarea = dialog.querySelector('#edit-user-role-prompt') as HTMLTextAreaElement;\n  setTimeout(() => roleSelect?.focus(), 100);\n\n  // Handle role selection change\n  on(roleSelect, 'change', () => {\n    const selectedOption = roleSelect.options[roleSelect.selectedIndex];\n    const isCustom = roleSelect.value === '__custom__';\n\n    // Show/hide custom input\n    customInput.classList.toggle('hidden', !isCustom);\n    if (isCustom) {\n      customInput.focus();\n    }\n\n    // Auto-fill prompt from role template (always when selecting a predefined role)\n    if (!isCustom && selectedOption.dataset.prompt) {\n      promptTextarea.value = selectedOption.dataset.prompt;\n    }\n  });\n\n  // Cancel button\n  const cancelBtn = dialog.querySelector('#cancel-role-edit');\n  const closeDialog = () => {\n    overlay.remove();\n    dialog.remove();\n  };\n\n  on(cancelBtn as HTMLElement, 'click', closeDialog);\n  on(overlay, 'click', closeDialog);\n\n  // Save button\n  const saveBtn = dialog.querySelector('#save-role-edit');\n  on(saveBtn as HTMLElement, 'click', async () => {\n    const roleSelectValue = roleSelect.value;\n    const userRole = roleSelectValue === '__custom__' ? customInput.value.trim() : roleSelectValue;\n    const userRolePrompt = (dialog.querySelector('#edit-user-role-prompt') as HTMLTextAreaElement).value.trim();\n    const linkedContactId = (dialog.querySelector('#edit-linked-contact') as HTMLSelectElement).value || null;\n\n    try {\n      await http.put(`/api/projects/${projectId}/members/${member.user_id}`, {\n        user_role: userRole,\n        user_role_prompt: userRolePrompt,\n        linked_contact_id: linkedContactId,\n      });\n\n      // Update local state\n      const memberIndex = projectMembers.findIndex(m => m.user_id === member.user_id);\n      if (memberIndex !== -1) {\n        projectMembers[memberIndex].user_role = userRole;\n        projectMembers[memberIndex].user_role_prompt = userRolePrompt;\n        projectMembers[memberIndex].linked_contact_id = linkedContactId || undefined;\n        // Find linked contact info\n        if (linkedContactId) {\n          const contact = projectContacts.find(c => c.id === linkedContactId);\n          if (contact) {\n            projectMembers[memberIndex].linked_contact = {\n              id: contact.id,\n              name: contact.name,\n              email: contact.email,\n              organization: contact.organization,\n              role: contact.role,\n            };\n          }\n        } else {\n          projectMembers[memberIndex].linked_contact = undefined;\n        }\n      }\n\n      // Refresh list\n      const membersList = container.querySelector('#members-list');\n      if (membersList) {\n        membersList.innerHTML = renderMembersList();\n        bindMemberEvents(container);\n      }\n\n      toast.success('Project role updated');\n      closeDialog();\n    } catch {\n      toast.error('Failed to update role');\n    }\n  });\n\n  // Close on Escape\n  const handleEscape = (e: KeyboardEvent) => {\n    if (e.key === 'Escape') {\n      closeDialog();\n      document.removeEventListener('keydown', handleEscape);\n    }\n  };\n  document.addEventListener('keydown', handleEscape);\n}\n\n// ==================== Helper Functions ====================\n\nasync function showInviteModal(): Promise<void> {\n  const { showInviteModal: showInvite } = await import('./InviteModal');\n  const projectId = currentProject?.id || currentProps.project?.id;\n  if (projectId) {\n    showInvite({\n      projectId,\n      onInvite: async () => {\n        // Refresh members list\n        try {\n          const res = await http.get<{ members: ProjectMember[] }>(`/api/projects/${projectId}/members`);\n          projectMembers = res.data.members || [];\n          const membersList = document.querySelector('#members-list');\n          if (membersList) {\n            membersList.innerHTML = renderMembersList();\n            bindMemberEvents(membersList.closest('.project-card') as HTMLElement);\n          }\n        } catch {\n          // Ignore\n        }\n      },\n    });\n  }\n}\n\nasync function loadProjects(): Promise<void> {\n  try {\n    const response = await http.get<Array<{ id: string; name: string }>>('/api/projects');\n    dataStore.setProjects(response.data);\n  } catch {\n    // Silent fail\n  }\n}\n\nasync function loadProjectRoles(projectId: string): Promise<void> {\n  try {\n    const response = await http.get<{ roles: RoleTemplate[] }>('/api/role-templates');\n    projectRoles = response.data.roles || [];\n  } catch {\n    projectRoles = [];\n  }\n}\n\nfunction getInitials(name: string): string {\n  return name.split(' ').map(n => n[0]).join('').toUpperCase().slice(0, 2);\n}\n\nfunction escapeHtml(text: string): string {\n  const div = document.createElement('div');\n  div.textContent = text;\n  return div.innerHTML;\n}\n\nexport function closeProjectModal(): void {\n  closeModal(MODAL_ID);\n}\n\nexport default showProjectModal;\n","/**\r\n * Project Selector Component\r\n * Dropdown for selecting and managing projects\r\n */\r\n\r\nimport { createElement, on } from '@lib/dom';\r\nimport { appStore } from '@stores/app';\r\nimport { dataStore } from '@stores/data';\r\nimport { projects } from '@services/projects';\r\nimport { toast } from '@services/toast';\r\nimport { showProjectModal } from '@components/modals/ProjectModal';\r\n\r\nexport interface ProjectSelectorOptions {\r\n  containerId?: string;\r\n  onProjectChange?: (projectId: string) => void;\r\n}\r\n\r\n/**\r\n * Initialize project selector\r\n */\r\nexport function initProjectSelector(options: ProjectSelectorOptions = {}): void {\r\n  const container = options.containerId\r\n    ? document.getElementById(options.containerId)\r\n    : document.getElementById('project-selector-container');\r\n\r\n  if (!container) return;\r\n\r\n  // Create selector HTML\r\n  container.innerHTML = `\r\n    <div class=\"project-selector-wrapper\">\r\n      <select id=\"project-selector\" class=\"project-selector\">\r\n        <option value=\"\">Select Project...</option>\r\n      </select>\r\n      <button id=\"new-project-btn\" class=\"btn-icon\" title=\"Create new project\">+</button>\r\n      <button id=\"edit-project-btn\" class=\"btn-icon hidden\" title=\"Edit project\"></button>\r\n    </div>\r\n  `;\r\n\r\n  const selector = container.querySelector('#project-selector') as HTMLSelectElement;\r\n  const newBtn = container.querySelector('#new-project-btn') as HTMLButtonElement;\r\n  const editBtn = container.querySelector('#edit-project-btn') as HTMLButtonElement;\r\n\r\n  // Load and populate projects\r\n  loadProjectsIntoSelector(selector);\r\n\r\n  // Handle selection change\r\n  on(selector, 'change', async () => {\r\n    const projectId = selector.value;\r\n    if (projectId) {\r\n      await selectProject(projectId, options.onProjectChange);\r\n      editBtn.classList.remove('hidden');\r\n    } else {\r\n      editBtn.classList.add('hidden');\r\n    }\r\n  });\r\n\r\n  // New project button\r\n  on(newBtn, 'click', () => {\r\n    showProjectModal({\r\n      mode: 'create',\r\n      onSave: async (project) => {\r\n        await loadProjectsIntoSelector(selector);\r\n        if (project.id) {\r\n          selector.value = project.id;\r\n          editBtn.classList.remove('hidden');\r\n          options.onProjectChange?.(project.id);\r\n        }\r\n      },\r\n    });\r\n  });\r\n\r\n  // Edit project button\r\n  on(editBtn, 'click', () => {\r\n    const currentProject = appStore.getState().currentProject;\r\n    if (currentProject) {\r\n      showProjectModal({\r\n        mode: 'edit',\r\n        project: currentProject,\r\n        onSave: async () => {\r\n          await loadProjectsIntoSelector(selector);\r\n        },\r\n        onDelete: async () => {\r\n          await loadProjectsIntoSelector(selector);\r\n          editBtn.classList.add('hidden');\r\n        },\r\n      });\r\n    }\r\n  });\r\n\r\n  // Subscribe to store changes\r\n  dataStore.subscribe((state) => {\r\n    updateSelectorOptions(selector, state.projects);\r\n  });\r\n\r\n  appStore.subscribe((state) => {\r\n    if (state.currentProjectId && selector.value !== state.currentProjectId) {\r\n      selector.value = state.currentProjectId;\r\n      editBtn.classList.remove('hidden');\r\n    }\r\n  });\r\n}\r\n\r\n/**\r\n * Load projects into selector\r\n */\r\nasync function loadProjectsIntoSelector(selector: HTMLSelectElement): Promise<void> {\r\n  const projectList = await projects.getAll();\r\n  updateSelectorOptions(selector, projectList);\r\n\r\n  // Set current project if any\r\n  const currentProjectId = appStore.getState().currentProjectId;\r\n  if (currentProjectId) {\r\n    selector.value = currentProjectId;\r\n  }\r\n}\r\n\r\n/**\r\n * Update selector options\r\n */\r\nfunction updateSelectorOptions(\r\n  selector: HTMLSelectElement,\r\n  projectList: Array<{ id: string; name: string; isDefault?: boolean }>\r\n): void {\r\n  const currentValue = selector.value;\r\n\r\n  selector.innerHTML = '<option value=\"\">Select Project...</option>';\r\n\r\n  projectList.forEach(project => {\r\n    const option = document.createElement('option');\r\n    option.value = project.id;\r\n    option.textContent = project.name + (project.isDefault ? ' (default)' : '');\r\n    selector.appendChild(option);\r\n  });\r\n\r\n  // Restore selection if possible\r\n  if (currentValue && projectList.some(p => p.id === currentValue)) {\r\n    selector.value = currentValue;\r\n  }\r\n}\r\n\r\n/**\r\n * Select a project\r\n */\r\nasync function selectProject(\r\n  projectId: string,\r\n  onChange?: (projectId: string) => void\r\n): Promise<void> {\r\n  try {\r\n    const project = await projects.activate(projectId);\r\n    if (project) {\r\n      toast.success(`Switched to: ${project.name}`);\r\n      onChange?.(projectId);\r\n    }\r\n  } catch {\r\n    toast.error('Failed to switch project');\r\n  }\r\n}\r\n\r\n/**\r\n * Create standalone project selector element\r\n */\r\nexport function createProjectSelector(options: ProjectSelectorOptions = {}): HTMLElement {\r\n  const wrapper = createElement('div', { className: 'project-selector-wrapper' });\r\n\r\n  const selector = createElement('select', {\r\n    className: 'project-selector',\r\n    id: 'project-selector',\r\n  }) as HTMLSelectElement;\r\n\r\n  const defaultOption = createElement('option', {\r\n    textContent: 'Select Project...',\r\n  }) as HTMLOptionElement;\r\n  defaultOption.value = '';\r\n  selector.appendChild(defaultOption);\r\n\r\n  const newBtn = createElement('button', {\r\n    className: 'btn-icon',\r\n    textContent: '+',\r\n    title: 'Create new project',\r\n  });\r\n\r\n  wrapper.appendChild(selector);\r\n  wrapper.appendChild(newBtn);\r\n\r\n  // Load projects\r\n  projects.getAll().then(projectList => {\r\n    updateSelectorOptions(selector, projectList);\r\n    const currentProjectId = appStore.getState().currentProjectId;\r\n    if (currentProjectId) {\r\n      selector.value = currentProjectId;\r\n    }\r\n  });\r\n\r\n  // Bind events\r\n  on(selector, 'change', async () => {\r\n    const projectId = selector.value;\r\n    if (projectId) {\r\n      await selectProject(projectId, options.onProjectChange);\r\n    }\r\n  });\r\n\r\n  on(newBtn, 'click', () => {\r\n    showProjectModal({\r\n      mode: 'create',\r\n      onSave: async (project) => {\r\n        const projectList = await projects.getAll();\r\n        updateSelectorOptions(selector, projectList);\r\n        if (project.id) {\r\n          selector.value = project.id;\r\n          options.onProjectChange?.(project.id);\r\n        }\r\n      },\r\n    });\r\n  });\r\n\r\n  return wrapper;\r\n}\r\n\r\nexport default initProjectSelector;\r\n","/**\r\n * Format Utilities\r\n * Helper functions for formatting values\r\n */\r\n\r\n/**\r\n * Format number with thousand separators\r\n */\r\nexport function formatNumber(value: number, locale = 'en-US'): string {\r\n  return new Intl.NumberFormat(locale).format(value);\r\n}\r\n\r\n/**\r\n * Format date to locale string\r\n */\r\nexport function formatDate(date: string | Date, options?: Intl.DateTimeFormatOptions): string {\r\n  const d = typeof date === 'string' ? new Date(date) : date;\r\n  return d.toLocaleDateString(undefined, options);\r\n}\r\n\r\n/**\r\n * Format date and time\r\n */\r\nexport function formatDateTime(date: string | Date): string {\r\n  const d = typeof date === 'string' ? new Date(date) : date;\r\n  return d.toLocaleString();\r\n}\r\n\r\n/**\r\n * Format relative time (e.g., \"2 hours ago\", \"yesterday\", \"this week\")\r\n * \r\n * Returns human-friendly labels:\r\n * - \"just now\" for < 1 minute\r\n * - \"X minutes ago\" for < 1 hour\r\n * - \"X hours ago\" for same day\r\n * - \"yesterday\" for previous day\r\n * - \"X days ago\" for < 7 days\r\n * - \"this week\" for same week\r\n * - \"last week\" for previous week\r\n * - Full date for older\r\n */\r\nexport function formatRelativeTime(date: string | Date): string {\r\n  const d = typeof date === 'string' ? new Date(date) : date;\r\n  const now = new Date();\r\n  const diffMs = now.getTime() - d.getTime();\r\n  const diffSec = Math.floor(diffMs / 1000);\r\n  const diffMin = Math.floor(diffSec / 60);\r\n  const diffHour = Math.floor(diffMin / 60);\r\n  const diffDay = Math.floor(diffHour / 24);\r\n\r\n  // Future dates\r\n  if (diffMs < 0) {\r\n    const futureDays = Math.ceil(Math.abs(diffMs) / (1000 * 60 * 60 * 24));\r\n    if (futureDays === 0) return 'today';\r\n    if (futureDays === 1) return 'tomorrow';\r\n    if (futureDays < 7) return `in ${futureDays} days`;\r\n    return formatDate(d, { month: 'short', day: 'numeric' });\r\n  }\r\n\r\n  // Past dates\r\n  if (diffSec < 60) return 'just now';\r\n  if (diffMin < 60) return `${diffMin} min${diffMin === 1 ? '' : 's'} ago`;\r\n  if (diffHour < 24) return `${diffHour} hour${diffHour === 1 ? '' : 's'} ago`;\r\n\r\n  // Check if yesterday\r\n  const yesterday = new Date(now);\r\n  yesterday.setDate(yesterday.getDate() - 1);\r\n  if (isSameDay(d, yesterday)) return 'yesterday';\r\n\r\n  // Check if this week (same calendar week)\r\n  const startOfWeek = getStartOfWeek(now);\r\n  if (d >= startOfWeek) return 'this week';\r\n\r\n  // Check if last week\r\n  const startOfLastWeek = new Date(startOfWeek);\r\n  startOfLastWeek.setDate(startOfLastWeek.getDate() - 7);\r\n  if (d >= startOfLastWeek) return 'last week';\r\n\r\n  // Within 30 days\r\n  if (diffDay < 30) return `${diffDay} days ago`;\r\n\r\n  // Within this year\r\n  if (d.getFullYear() === now.getFullYear()) {\r\n    return formatDate(d, { month: 'short', day: 'numeric' });\r\n  }\r\n  \r\n  // Older\r\n  return formatDate(d, { year: 'numeric', month: 'short', day: 'numeric' });\r\n}\r\n\r\n/**\r\n * Check if two dates are the same calendar day\r\n */\r\nfunction isSameDay(d1: Date, d2: Date): boolean {\r\n  return d1.getFullYear() === d2.getFullYear() &&\r\n         d1.getMonth() === d2.getMonth() &&\r\n         d1.getDate() === d2.getDate();\r\n}\r\n\r\n/**\r\n * Get start of week (Sunday)\r\n */\r\nfunction getStartOfWeek(date: Date): Date {\r\n  const d = new Date(date);\r\n  const day = d.getDay();\r\n  d.setDate(d.getDate() - day);\r\n  d.setHours(0, 0, 0, 0);\r\n  return d;\r\n}\r\n\r\n/**\r\n * Format file size\r\n */\r\nexport function formatFileSize(bytes: number): string {\r\n  if (bytes === 0) return '0 B';\r\n  \r\n  const units = ['B', 'KB', 'MB', 'GB', 'TB'];\r\n  const i = Math.floor(Math.log(bytes) / Math.log(1024));\r\n  const size = bytes / Math.pow(1024, i);\r\n  \r\n  return `${size.toFixed(i > 0 ? 1 : 0)} ${units[i]}`;\r\n}\r\n\r\n/**\r\n * Format percentage\r\n */\r\nexport function formatPercent(value: number, decimals = 0): string {\r\n  return `${(value * 100).toFixed(decimals)}%`;\r\n}\r\n\r\n/**\r\n * Format currency\r\n */\r\nexport function formatCurrency(value: number, currency = 'USD', locale = 'en-US'): string {\r\n  return new Intl.NumberFormat(locale, {\r\n    style: 'currency',\r\n    currency,\r\n  }).format(value);\r\n}\r\n\r\n/**\r\n * Truncate text with ellipsis\r\n */\r\nexport function truncate(text: string, maxLength: number, suffix = '...'): string {\r\n  if (text.length <= maxLength) return text;\r\n  return text.slice(0, maxLength - suffix.length) + suffix;\r\n}\r\n\r\n/**\r\n * Capitalize first letter\r\n */\r\nexport function capitalize(text: string): string {\r\n  return text.charAt(0).toUpperCase() + text.slice(1);\r\n}\r\n\r\n/**\r\n * Convert to title case\r\n */\r\nexport function titleCase(text: string): string {\r\n  return text\r\n    .toLowerCase()\r\n    .split(' ')\r\n    .map(word => capitalize(word))\r\n    .join(' ');\r\n}\r\n\r\n/**\r\n * Convert to kebab-case\r\n */\r\nexport function kebabCase(text: string): string {\r\n  return text\r\n    .replace(/([a-z])([A-Z])/g, '$1-$2')\r\n    .replace(/[\\s_]+/g, '-')\r\n    .toLowerCase();\r\n}\r\n\r\n/**\r\n * Convert to camelCase\r\n */\r\nexport function camelCase(text: string): string {\r\n  return text\r\n    .replace(/[-_\\s]+(.)?/g, (_, c) => c ? c.toUpperCase() : '')\r\n    .replace(/^[A-Z]/, c => c.toLowerCase());\r\n}\r\n\r\n/**\r\n * Pluralize word based on count\r\n */\r\nexport function pluralize(count: number, singular: string, plural?: string): string {\r\n  return count === 1 ? singular : (plural || singular + 's');\r\n}\r\n\r\n/**\r\n * Format duration in seconds to human readable\r\n */\r\nexport function formatDuration(seconds: number): string {\r\n  if (seconds < 60) return `${seconds}s`;\r\n  if (seconds < 3600) {\r\n    const min = Math.floor(seconds / 60);\r\n    const sec = seconds % 60;\r\n    return sec > 0 ? `${min}m ${sec}s` : `${min}m`;\r\n  }\r\n  \r\n  const hours = Math.floor(seconds / 3600);\r\n  const min = Math.floor((seconds % 3600) / 60);\r\n  return min > 0 ? `${hours}h ${min}m` : `${hours}h`;\r\n}\r\n","/**\n * Question Modal Component\n * View, create, edit, and answer questions with AI suggestions\n */\n\nimport { createElement, on } from '@lib/dom';\nimport { createModal, openModal, closeModal } from '@components/Modal';\nimport {\n  questionsService,\n  Question,\n  CreateQuestionRequest,\n  AssigneeSuggestion\n} from '@services/questions';\nimport { toast } from '@services/toast';\nimport { formatRelativeTime } from '@lib/format';\n\nconst MODAL_ID = 'question-modal';\n\nexport interface QuestionModalProps {\n  mode: 'view' | 'answer' | 'create' | 'edit';\n  question?: Question;\n  onSave?: (question: Question) => void;\n  onDismiss?: (questionId: string | number) => void;\n  onDelete?: (questionId: string | number) => void;\n}\n\nlet currentSuggestions: AssigneeSuggestion[] = [];\n\n/**\n * Show question modal\n */\nexport function showQuestionModal(props: QuestionModalProps): void {\n  const { mode, question, onSave, onDismiss } = props;\n  currentSuggestions = [];\n\n  // Remove existing modal\n  const existing = document.querySelector(`[data-modal-id=\"${MODAL_ID}\"]`);\n  if (existing) existing.remove();\n\n  const content = createElement('div', { className: 'question-modal-content' });\n\n  if (mode === 'create') {\n    renderCreateForm(content);\n  } else if (mode === 'edit' && question) {\n    renderEditForm(content, question);\n  } else if (question) {\n    renderQuestionView(content, question, mode === 'answer');\n  }\n\n  // Footer\n  const footer = createElement('div', { className: 'modal-footer' });\n  createFooterButtons(footer, mode, question, content, props);\n\n  // Create modal\n  const modal = createModal({\n    id: MODAL_ID,\n    title: getModalTitle(mode),\n    content,\n    size: 'lg',\n    footer,\n  });\n\n  document.body.appendChild(modal);\n  openModal(MODAL_ID);\n}\n\n/**\n * Get modal title based on mode\n */\nfunction getModalTitle(mode: string): string {\n  switch (mode) {\n    case 'create': return 'New Question';\n    case 'edit': return 'Edit Question';\n    case 'answer': return 'Answer Question';\n    default: return 'Question Details';\n  }\n}\n\n/**\n * Create footer buttons based on mode\n */\nfunction createFooterButtons(\n  footer: HTMLElement,\n  mode: string,\n  question: Question | undefined,\n  content: HTMLElement,\n  props: QuestionModalProps\n): void {\n  const { onSave, onDismiss, onDelete } = props;\n\n  if (mode === 'create') {\n    const cancelBtn = createElement('button', { className: 'btn btn-secondary', textContent: 'Cancel' });\n    const createBtn = createElement('button', { className: 'btn btn-primary', textContent: 'Create Question' });\n\n    on(cancelBtn, 'click', () => closeModal(MODAL_ID));\n    on(createBtn, 'click', () => handleCreate(content, onSave));\n\n    footer.appendChild(cancelBtn);\n    footer.appendChild(createBtn);\n  } else if (mode === 'edit' && question) {\n    const cancelBtn = createElement('button', { className: 'btn btn-secondary', textContent: 'Cancel' });\n    const saveBtn = createElement('button', { className: 'btn btn-primary', textContent: 'Save Changes' });\n\n    on(cancelBtn, 'click', () => closeModal(MODAL_ID));\n    on(saveBtn, 'click', () => handleEdit(content, question, onSave));\n\n    footer.appendChild(cancelBtn);\n    footer.appendChild(saveBtn);\n  } else if (question) {\n    const status = question.status;\n\n    if (status !== 'resolved' && status !== 'dismissed') {\n      const dismissBtn = createElement('button', { className: 'btn btn-secondary', textContent: 'Dismiss' });\n      on(dismissBtn, 'click', () => handleDismiss(question.id, onDismiss));\n      footer.appendChild(dismissBtn);\n\n      if (mode === 'answer') {\n        const saveAnswerBtn = createElement('button', { className: 'btn btn-primary', textContent: 'Save Answer' });\n        on(saveAnswerBtn, 'click', () => handleAnswer(content, question, onSave));\n        footer.appendChild(saveAnswerBtn);\n      } else {\n        const answerBtn = createElement('button', { className: 'btn btn-primary', textContent: 'Answer' });\n        on(answerBtn, 'click', () => {\n          closeModal(MODAL_ID);\n          showQuestionModal({ ...props, mode: 'answer' });\n        });\n        footer.appendChild(answerBtn);\n      }\n    } else if (status === 'resolved') {\n      const reopenBtn = createElement('button', { className: 'btn btn-warning', textContent: 'Reopen' });\n      on(reopenBtn, 'click', () => handleReopen(question, onSave));\n      footer.appendChild(reopenBtn);\n    }\n\n    const closeBtn = createElement('button', { className: 'btn btn-secondary', textContent: 'Close' });\n    on(closeBtn, 'click', () => closeModal(MODAL_ID));\n    footer.appendChild(closeBtn);\n  }\n}\n\n/**\n * Render create form\n */\nfunction renderCreateForm(container: HTMLElement): void {\n  container.innerHTML = `\n    <form id=\"question-form\" class=\"question-form\">\n      <div class=\"form-group\">\n        <label for=\"question-content\">Question <span class=\"required\">*</span></label>\n        <textarea id=\"question-content\" rows=\"3\" required minlength=\"5\"\n                  placeholder=\"What needs to be clarified? (min 5 characters)\"></textarea>\n        <div id=\"duplicate-warning\" class=\"form-warning hidden\"></div>\n      </div>\n      \n      <div class=\"form-group\">\n        <label for=\"question-context\">Context</label>\n        <textarea id=\"question-context\" rows=\"2\"\n                  placeholder=\"Why is this question important?\"></textarea>\n      </div>\n      \n      <div class=\"form-row\">\n        <div class=\"form-group\">\n          <label for=\"question-priority\">Priority</label>\n          <select id=\"question-priority\">\n            <option value=\"low\">Low</option>\n            <option value=\"medium\" selected>Medium</option>\n            <option value=\"high\">High</option>\n            <option value=\"critical\">Critical</option>\n          </select>\n        </div>\n        \n        <div class=\"form-group\">\n          <label for=\"question-assignee\">Assign To</label>\n          <input type=\"text\" id=\"question-assignee\" placeholder=\"Person name\">\n          <button type=\"button\" id=\"suggest-assignee-btn\" class=\"btn btn-sm btn-secondary\">\n            AI Suggest\n          </button>\n        </div>\n      </div>\n      \n      <div id=\"suggestions-container\" class=\"suggestions-container hidden\"></div>\n    </form>\n  `;\n\n  // Bind AI suggest button\n  const suggestBtn = container.querySelector('#suggest-assignee-btn');\n  if (suggestBtn) {\n    on(suggestBtn as HTMLElement, 'click', () => loadAssigneeSuggestions(container));\n  }\n}\n\n/**\n * Render edit form\n */\nfunction renderEditForm(container: HTMLElement, question: Question): void {\n  container.innerHTML = `\n    <form id=\"question-form\" class=\"question-form\">\n      <div class=\"form-group\">\n        <label for=\"question-content\">Question <span class=\"required\">*</span></label>\n        <textarea id=\"question-content\" rows=\"3\" required minlength=\"5\">${escapeHtml(question.content)}</textarea>\n      </div>\n      \n      <div class=\"form-group\">\n        <label for=\"question-context\">Context</label>\n        <textarea id=\"question-context\" rows=\"2\">${escapeHtml(question.context || '')}</textarea>\n      </div>\n      \n      <div class=\"form-row\">\n        <div class=\"form-group\">\n          <label for=\"question-priority\">Priority</label>\n          <select id=\"question-priority\">\n            <option value=\"low\" ${question.priority === 'low' ? 'selected' : ''}>Low</option>\n            <option value=\"medium\" ${question.priority === 'medium' ? 'selected' : ''}>Medium</option>\n            <option value=\"high\" ${question.priority === 'high' ? 'selected' : ''}>High</option>\n            <option value=\"critical\" ${question.priority === 'critical' ? 'selected' : ''}>Critical</option>\n          </select>\n        </div>\n        \n        <div class=\"form-group\">\n          <label for=\"question-status\">Status</label>\n          <select id=\"question-status\">\n            <option value=\"pending\" ${question.status === 'pending' ? 'selected' : ''}>Pending</option>\n            <option value=\"assigned\" ${question.status === 'assigned' ? 'selected' : ''}>Assigned</option>\n            <option value=\"resolved\" ${question.status === 'resolved' ? 'selected' : ''}>Resolved</option>\n            <option value=\"dismissed\" ${question.status === 'dismissed' ? 'selected' : ''}>Dismissed</option>\n          </select>\n        </div>\n      </div>\n      \n      <div class=\"form-group\">\n        <label for=\"question-assignee\">Assigned To</label>\n        <input type=\"text\" id=\"question-assignee\" value=\"${escapeHtml(question.assigned_to || '')}\">\n      </div>\n      \n      <div class=\"form-group\">\n        <label for=\"question-category\">Category</label>\n        <input type=\"text\" id=\"question-category\" value=\"${escapeHtml(question.category || '')}\">\n      </div>\n    </form>\n  `;\n}\n\n/**\n * Render question view\n */\nfunction renderQuestionView(container: HTMLElement, question: Question, showAnswerField: boolean): void {\n  container.innerHTML = `\n    <div class=\"question-view\">\n      <div class=\"question-meta\">\n        <span class=\"priority-badge priority-${question.priority}\">${question.priority}</span>\n        <span class=\"status-badge status-${question.status}\">${question.status}</span>\n        <span class=\"question-date\">${formatRelativeTime(question.created_at)}</span>\n        ${question.assigned_to ? `<span class=\"question-assignee\"> ${escapeHtml(question.assigned_to)}</span>` : ''}\n      </div>\n      \n      <div class=\"question-content-large\">\n        ${escapeHtml(question.content)}\n      </div>\n      \n      ${question.context ? `<div class=\"question-context\"><strong>Context:</strong> ${escapeHtml(question.context)}</div>` : ''}\n      ${question.category ? `<div class=\"question-category\"><strong>Category:</strong> ${escapeHtml(question.category)}</div>` : ''}\n      ${question.source_file ? `<div class=\"question-source\"><strong>Source:</strong> ${escapeHtml(question.source_file)}</div>` : ''}\n      \n      ${question.answer ? `\n        <div class=\"question-answer-section\">\n          <h4>Answer ${question.answer_source ? `<span class=\"answer-source\">(${question.answer_source})</span>` : ''}</h4>\n          <div class=\"answer-text\">${escapeHtml(question.answer)}</div>\n          ${question.resolved_at ? `<div class=\"answer-date\">Resolved ${formatRelativeTime(question.resolved_at)}</div>` : ''}\n        </div>\n      ` : ''}\n      \n      ${showAnswerField && question.status !== 'resolved' ? `\n        <div class=\"answer-form\">\n          <div class=\"form-group\">\n            <label for=\"question-answer\">Your Answer <span class=\"required\">*</span></label>\n            <textarea id=\"question-answer\" rows=\"4\" required minlength=\"3\"\n                      placeholder=\"Provide an answer (min 3 characters)...\"></textarea>\n          </div>\n          <div class=\"form-group\">\n            <label for=\"answer-source\">Source</label>\n            <select id=\"answer-source\">\n              <option value=\"manual\" selected>Manual</option>\n              <option value=\"document\">From Document</option>\n              <option value=\"ai\">AI Assisted</option>\n            </select>\n          </div>\n          <div class=\"form-group\">\n            <label for=\"followup-questions\">Follow-up Questions (one per line)</label>\n            <textarea id=\"followup-questions\" rows=\"2\"\n                      placeholder=\"Add any follow-up questions...\"></textarea>\n          </div>\n        </div>\n      ` : ''}\n      \n      ${question.reopened_reason ? `\n        <div class=\"reopen-reason\">\n          <strong>Reopen Reason:</strong> ${escapeHtml(question.reopened_reason)}\n        </div>\n      ` : ''}\n    </div>\n  `;\n}\n\n/**\n * Load AI assignee suggestions\n */\nasync function loadAssigneeSuggestions(container: HTMLElement): Promise<void> {\n  const contentInput = container.querySelector('#question-content') as HTMLTextAreaElement;\n  const content = contentInput?.value.trim();\n\n  if (!content || content.length < 5) {\n    toast.warning('Please enter at least 5 characters for the question');\n    return;\n  }\n\n  const suggestionsContainer = container.querySelector('#suggestions-container') as HTMLElement;\n  const suggestBtn = container.querySelector('#suggest-assignee-btn') as HTMLButtonElement;\n\n  suggestBtn.disabled = true;\n  suggestBtn.textContent = 'Loading...';\n  suggestionsContainer.classList.remove('hidden');\n  suggestionsContainer.innerHTML = '<div class=\"loading\">Getting AI suggestions...</div>';\n\n  try {\n    const result = await questionsService.suggestAssignee({ content, useAI: true });\n    currentSuggestions = result.suggestions;\n\n    if (currentSuggestions.length === 0) {\n      suggestionsContainer.innerHTML = '<div class=\"no-suggestions\">No suggestions available</div>';\n    } else {\n      suggestionsContainer.innerHTML = `\n        <h4>AI Suggestions ${result.cached ? '<span class=\"cached\">(cached)</span>' : ''}</h4>\n        <div class=\"suggestions-list\">\n          ${currentSuggestions.map((s, i) => `\n            <div class=\"suggestion-item\" data-index=\"${i}\">\n              <div class=\"suggestion-person\">${escapeHtml(s.person)}</div>\n              <div class=\"suggestion-score\">${s.score}%</div>\n              <div class=\"suggestion-reason\">${escapeHtml(s.reason)}</div>\n              ${s.role ? `<div class=\"suggestion-role\">${escapeHtml(s.role)}</div>` : ''}\n            </div>\n          `).join('')}\n        </div>\n      `;\n\n      // Bind click to select suggestion\n      suggestionsContainer.querySelectorAll('.suggestion-item').forEach(item => {\n        on(item as HTMLElement, 'click', () => {\n          const index = parseInt(item.getAttribute('data-index') || '0', 10);\n          const suggestion = currentSuggestions[index];\n          if (suggestion) {\n            const assigneeInput = container.querySelector('#question-assignee') as HTMLInputElement;\n            if (assigneeInput) {\n              assigneeInput.value = suggestion.person;\n            }\n            suggestionsContainer.classList.add('hidden');\n            toast.success(`Selected: ${suggestion.person}`);\n          }\n        });\n      });\n    }\n  } catch {\n    suggestionsContainer.innerHTML = '<div class=\"error\">Failed to get suggestions</div>';\n  } finally {\n    suggestBtn.disabled = false;\n    suggestBtn.textContent = 'AI Suggest';\n  }\n}\n\n/**\n * Handle create\n */\nasync function handleCreate(\n  container: HTMLElement,\n  onSave?: (question: Question) => void\n): Promise<void> {\n  const form = container.querySelector('#question-form') as HTMLFormElement;\n  if (!form.checkValidity()) {\n    form.reportValidity();\n    return;\n  }\n\n  const getValue = (id: string) => {\n    const el = container.querySelector(`#${id}`) as HTMLInputElement | HTMLTextAreaElement | HTMLSelectElement;\n    return el?.value.trim() || '';\n  };\n\n  const data: CreateQuestionRequest = {\n    content: getValue('question-content'),\n    priority: getValue('question-priority') as 'low' | 'medium' | 'high' | 'critical',\n    assigned_to: getValue('question-assignee') || undefined,\n    context: getValue('question-context') || undefined,\n  };\n\n  try {\n    const result = await questionsService.create(data);\n\n    if (result.duplicate) {\n      const warning = container.querySelector('#duplicate-warning') as HTMLElement;\n      if (warning) {\n        warning.classList.remove('hidden');\n        warning.innerHTML = ` Similar question exists (${result.similarity}% match). <a href=\"#\" id=\"view-duplicate\">View existing</a>`;\n      }\n      return;\n    }\n\n    toast.success('Question created');\n\n    const newQuestion: Question = {\n      id: result.id || Date.now(),\n      content: data.content,\n      priority: data.priority || 'medium',\n      status: data.assigned_to ? 'assigned' : 'pending',\n      assigned_to: data.assigned_to,\n      context: data.context,\n      created_at: new Date().toISOString(),\n    };\n\n    onSave?.(newQuestion);\n    closeModal(MODAL_ID);\n  } catch {\n    // Error shown by API service\n  }\n}\n\n/**\n * Handle edit\n */\nasync function handleEdit(\n  container: HTMLElement,\n  question: Question,\n  onSave?: (question: Question) => void\n): Promise<void> {\n  const getValue = (id: string) => {\n    const el = container.querySelector(`#${id}`) as HTMLInputElement | HTMLTextAreaElement | HTMLSelectElement;\n    return el?.value.trim() || '';\n  };\n\n  try {\n    const updated = await questionsService.update(question.id, {\n      content: getValue('question-content'),\n      context: getValue('question-context') || undefined,\n      priority: getValue('question-priority') as 'low' | 'medium' | 'high' | 'critical',\n      status: getValue('question-status') as 'pending' | 'assigned' | 'resolved' | 'dismissed',\n      assigned_to: getValue('question-assignee') || undefined,\n      category: getValue('question-category') || undefined,\n    });\n\n    toast.success('Question updated');\n    onSave?.(updated);\n    closeModal(MODAL_ID);\n  } catch {\n    // Error shown by API service\n  }\n}\n\n/**\n * Handle answer\n */\nasync function handleAnswer(\n  container: HTMLElement,\n  question: Question,\n  onSave?: (question: Question) => void\n): Promise<void> {\n  const answerInput = container.querySelector('#question-answer') as HTMLTextAreaElement;\n  const sourceSelect = container.querySelector('#answer-source') as HTMLSelectElement;\n  const followupInput = container.querySelector('#followup-questions') as HTMLTextAreaElement;\n\n  const answer = answerInput?.value.trim();\n  const source = sourceSelect?.value || 'manual';\n  const followupQuestions = followupInput?.value.trim();\n\n  if (!answer || answer.length < 3) {\n    toast.warning('Please provide an answer (at least 3 characters)');\n    return;\n  }\n\n  try {\n    const result = await questionsService.answer(question.id, {\n      answer,\n      source: source as 'manual' | 'document' | 'ai',\n      followupQuestions,\n    });\n\n    toast.success(result.message);\n    onSave?.(result.question);\n    closeModal(MODAL_ID);\n  } catch {\n    // Error shown by API service\n  }\n}\n\n/**\n * Handle dismiss\n */\nasync function handleDismiss(\n  questionId: string | number,\n  onDismiss?: (questionId: string | number) => void\n): Promise<void> {\n  const { confirm } = await import('@components/Modal');\n  const confirmed = await confirm(\n    'Are you sure you want to dismiss this question?',\n    {\n      title: 'Dismiss Question',\n      confirmText: 'Dismiss',\n    }\n  );\n\n  if (confirmed) {\n    try {\n      await questionsService.delete(questionId, 'dismissed');\n      toast.success('Question dismissed');\n      onDismiss?.(questionId);\n      closeModal(MODAL_ID);\n    } catch {\n      // Error shown by API service\n    }\n  }\n}\n\n/**\n * Handle reopen\n */\nasync function handleReopen(\n  question: Question,\n  onSave?: (question: Question) => void\n): Promise<void> {\n  const { prompt } = await import('@components/Modal');\n  const reason = await prompt('Why are you reopening this question?', {\n    title: 'Reopen Question',\n    placeholder: 'Enter reason...',\n  });\n\n  if (reason) {\n    try {\n      const updated = await questionsService.reopen(question.id, reason);\n      toast.success('Question reopened');\n      onSave?.(updated);\n      closeModal(MODAL_ID);\n    } catch {\n      // Error shown by API service\n    }\n  }\n}\n\n/**\n * Escape HTML\n */\nfunction escapeHtml(text: string): string {\n  const div = document.createElement('div');\n  div.textContent = text;\n  return div.innerHTML;\n}\n\nexport default showQuestionModal;\n","/**\r\n * Question Detail View\r\n * Full-page view for question details, replacing the panel when a card is clicked\r\n * Features: timeline, contact picker, answer suggestions, follow-up chain, entity display\r\n * Refactored to Class-based SOTA component to eliminate singleton state.\r\n */\r\n\r\nimport { createElement, on } from '@lib/dom';\r\nimport { Question, questionsService } from '@services/questions';\r\nimport { contactsService, Contact } from '@services/contacts';\r\nimport { toast } from '@services/toast';\r\nimport { formatRelativeTime, formatDateTime } from '@lib/format';\r\nimport { http } from '@services/api';\r\n\r\nexport interface QuestionDetailViewProps {\r\n  question: Question;\r\n  onClose: () => void;\r\n  onUpdate?: (question: Question) => void;\r\n  onNavigateToQuestion?: (questionId: string) => void;\r\n}\r\n\r\ninterface QuestionChain {\r\n  parent: Question | null;\r\n  children: Question[];\r\n}\r\n\r\ninterface TimelineEvent {\r\n  id: string;\r\n  event_type: string;\r\n  event_data: Record<string, unknown>;\r\n  actor_name?: string;\r\n  created_at: string;\r\n}\r\n\r\ninterface PotentialAnswer {\r\n  type: 'fact' | 'decision';\r\n  id: string;\r\n  content: string;\r\n  confidence: number;\r\n  source?: string;\r\n}\r\n\r\ninterface SimilarQuestion {\r\n  id: string;\r\n  content: string;\r\n  status: string;\r\n  priority: string;\r\n  similarityScore: number;\r\n}\r\n\r\nexport class QuestionDetailView {\r\n  private props: QuestionDetailViewProps;\r\n  private question: Question;\r\n  private contacts: Contact[] = [];\r\n  private container: HTMLElement;\r\n\r\n  constructor(props: QuestionDetailViewProps) {\r\n    this.props = props;\r\n    this.question = props.question;\r\n    this.container = createElement('div', { className: 'question-detail-view' });\r\n  }\r\n\r\n  public render(): HTMLElement {\r\n    const { question } = this;\r\n\r\n    this.container.innerHTML = `\r\n      <div class=\"question-detail-header\">\r\n        <div class=\"breadcrumb\">\r\n          <a href=\"#\" class=\"breadcrumb-link\" id=\"back-to-list\">Questions</a>\r\n          <span class=\"breadcrumb-separator\"></span>\r\n          <span class=\"breadcrumb-current\">Question #${String(question.id).substring(0, 8)}</span>\r\n        </div>\r\n        <div class=\"header-actions\">\r\n          ${question.sla_breached ? '<span class=\"sla-badge breached\">SLA Breached</span>' : ''}\r\n          <button class=\"btn btn-icon\" id=\"close-detail\" title=\"Close\"></button>\r\n        </div>\r\n      </div>\r\n\r\n      <div class=\"question-detail-content\">\r\n        <!-- Main Question Card -->\r\n        <section class=\"detail-section question-main\">\r\n          <div class=\"question-badges\">\r\n            <span class=\"priority-badge priority-${question.priority}\">${question.priority}</span>\r\n            <span class=\"status-badge status-${question.status}\">${question.status}</span>\r\n            ${question.requester_role ? `\r\n              <div class=\"requester-badge-full\" title=\"Question from the perspective of this role\">\r\n                <div class=\"requester-avatar-sm\">${this.getInitials((question as any).requester_name || question.requester_role)}</div>\r\n                <div class=\"requester-text\">\r\n                  ${(question as any).requester_name ? `<span class=\"requester-name-sm\">${this.escapeHtml((question as any).requester_name)}</span>` : ''}\r\n                  <span class=\"requester-role-sm\">${this.escapeHtml(question.requester_role)}</span>\r\n                </div>\r\n              </div>\r\n            ` : ''}\r\n            <span class=\"question-date\">Created ${formatRelativeTime(question.created_at)}</span>\r\n          </div>\r\n          <h2 class=\"question-text\">${this.escapeHtml(question.content)}</h2>\r\n          ${question.context ? `<p class=\"question-context\">${this.escapeHtml(question.context)}</p>` : ''}\r\n          ${this.renderEntities(question)}\r\n        </section>\r\n\r\n        <!-- Two-column layout -->\r\n        <div class=\"detail-columns\">\r\n          <div class=\"detail-column-left\">\r\n            <!-- Assignment Section - SOTA Design -->\r\n            <section class=\"detail-section\" id=\"assignment-section\">\r\n              <div class=\"section-header-sota\">\r\n                <h3>\r\n                  <svg width=\"20\" height=\"20\" fill=\"none\" viewBox=\"0 0 24 24\" stroke=\"currentColor\">\r\n                    <path stroke-linecap=\"round\" stroke-linejoin=\"round\" stroke-width=\"2\" d=\"M16 7a4 4 0 11-8 0 4 4 0 018 0zM12 14a7 7 0 00-7 7h14a7 7 0 00-7-7z\"/>\r\n                  </svg>\r\n                  Assignment\r\n                  <span class=\"section-subtitle\">Who should answer this question?</span>\r\n                </h3>\r\n                <button type=\"button\" class=\"btn-ai-suggest\" id=\"ai-suggest-btn\">\r\n                  <svg width=\"16\" height=\"16\" fill=\"none\" viewBox=\"0 0 24 24\" stroke=\"currentColor\">\r\n                    <path stroke-linecap=\"round\" stroke-linejoin=\"round\" stroke-width=\"2\" d=\"M13 10V3L4 14h7v7l9-11h-7z\"/>\r\n                  </svg>\r\n                  AI Suggest\r\n                </button>\r\n              </div>\r\n              \r\n              <!-- Current Assignment Display -->\r\n              <div id=\"current-assignment\" class=\"current-assignment-card\">\r\n                ${this.renderAssignmentState()}\r\n              </div>\r\n              \r\n              <!-- Contact Picker (hidden by default) -->\r\n              <div id=\"contact-picker\" class=\"contact-picker-sota hidden\">\r\n                <div class=\"picker-search\">\r\n                  <svg width=\"16\" height=\"16\" fill=\"none\" viewBox=\"0 0 24 24\" stroke=\"currentColor\">\r\n                    <path stroke-linecap=\"round\" stroke-linejoin=\"round\" stroke-width=\"2\" d=\"M21 21l-6-6m2-5a7 7 0 11-14 0 7 7 0 0114 0z\"/>\r\n                  </svg>\r\n                  <input type=\"text\" id=\"contact-search\" placeholder=\"Search contacts...\" autocomplete=\"off\">\r\n                </div>\r\n                <div id=\"contact-list\" class=\"contact-list-grid\">\r\n                  <div class=\"loading\">Loading contacts...</div>\r\n                </div>\r\n              </div>\r\n              \r\n              <!-- Hidden select for form submission -->\r\n              <select id=\"assignee-select\" class=\"form-select hidden\">\r\n                <option value=\"\">Select contact...</option>\r\n              </select>\r\n              \r\n              <!-- AI Suggestions Panel -->\r\n              <div id=\"suggestions-panel\" class=\"suggestions-panel-sota hidden\"></div>\r\n            </section>\r\n\r\n            <!-- Potential Answers Section -->\r\n            <section class=\"detail-section\" id=\"answers-section\">\r\n              <div class=\"section-header\">\r\n                <h3>Potential Answers</h3>\r\n                <button class=\"btn btn-secondary btn-sm\" id=\"check-answers-btn\">\r\n                  Check Knowledge Base\r\n                </button>\r\n              </div>\r\n              <div id=\"potential-answers\" class=\"potential-answers\">\r\n                <p class=\"empty-state\">Click \"Check Knowledge Base\" to find potential answers</p>\r\n              </div>\r\n            </section>\r\n\r\n            <!-- Answer Form Section -->\r\n            <section class=\"detail-section\" id=\"answer-section\">\r\n              <h3>${question.answer ? 'Current Answer' : 'Your Answer'}</h3>\r\n              ${question.answer ? this.renderExistingAnswer(question) : ''}\r\n              <div class=\"answer-form ${question.status === 'resolved' ? 'hidden' : ''}\">\r\n                <div class=\"form-group\">\r\n                  <textarea id=\"answer-input\" rows=\"4\" \r\n                    placeholder=\"Type your answer here...\">${question.answer || ''}</textarea>\r\n                </div>\r\n                <div class=\"form-row answer-form-row\">\r\n                  <div class=\"form-group source-group\">\r\n                    <label>Source</label>\r\n                    <div class=\"source-options\">\r\n                      <label class=\"source-option ${question.answer_source === 'manual' || !question.answer_source ? 'active' : ''}\">\r\n                        <input type=\"radio\" name=\"answer-source\" value=\"manual\" ${question.answer_source === 'manual' || !question.answer_source ? 'checked' : ''}>\r\n                        <span class=\"source-icon\"></span>\r\n                        <span class=\"source-label\">Manual</span>\r\n                      </label>\r\n                      <label class=\"source-option ${question.answer_source === 'document' ? 'active' : ''}\">\r\n                        <input type=\"radio\" name=\"answer-source\" value=\"document\" ${question.answer_source === 'document' ? 'checked' : ''}>\r\n                        <span class=\"source-icon\"></span>\r\n                        <span class=\"source-label\">Document</span>\r\n                      </label>\r\n                      <label class=\"source-option ${question.answer_source === 'ai' ? 'active' : ''}\">\r\n                        <input type=\"radio\" name=\"answer-source\" value=\"ai\" ${question.answer_source === 'ai' ? 'checked' : ''}>\r\n                        <span class=\"source-icon\"></span>\r\n                        <span class=\"source-label\">AI</span>\r\n                      </label>\r\n                    </div>\r\n                  </div>\r\n                  <div class=\"form-group answered-by-group\">\r\n                    <label>Answered By</label>\r\n                    <div class=\"answered-by-picker\">\r\n                      <div id=\"answered-by-display\" class=\"answered-by-display\">\r\n                        ${question.answered_by_contact_id || question.answered_by_name ? `\r\n                          <div class=\"answered-by-card\" id=\"current-answerer\">\r\n                            <div class=\"answerer-avatar\" id=\"answerer-avatar\">${this.getInitials(question.answered_by_name || '')}</div>\r\n                            <span class=\"answerer-name\">${this.escapeHtml(question.answered_by_name || 'Contact')}</span>\r\n                            <button type=\"button\" class=\"btn-clear-answerer\" id=\"clear-answerer\"></button>\r\n                          </div>\r\n                        ` : `\r\n                          <button type=\"button\" class=\"btn-select-answerer\" id=\"show-answerer-picker\">\r\n                            <svg width=\"16\" height=\"16\" fill=\"none\" viewBox=\"0 0 24 24\" stroke=\"currentColor\">\r\n                              <path stroke-linecap=\"round\" stroke-linejoin=\"round\" stroke-width=\"2\" d=\"M16 7a4 4 0 11-8 0 4 4 0 018 0zM12 14a7 7 0 00-7 7h14a7 7 0 00-7-7z\"/>\r\n                            </svg>\r\n                            Select who answered...\r\n                          </button>\r\n                        `}\r\n                      </div>\r\n                      <!-- Hidden select for form -->\r\n                      <select id=\"answered-by-contact\" class=\"form-select hidden\">\r\n                        <option value=\"\">Select who answered...</option>\r\n                      </select>\r\n                      <!-- Contact picker dropdown -->\r\n                      <div id=\"answerer-picker-dropdown\" class=\"answerer-picker-dropdown hidden\">\r\n                        <div class=\"picker-search-sm\">\r\n                          <input type=\"text\" id=\"answerer-search\" placeholder=\"Search contacts...\">\r\n                        </div>\r\n                        <div id=\"answerer-list\" class=\"answerer-list\"></div>\r\n                        <div class=\"answerer-other\">\r\n                          <input type=\"text\" id=\"answerer-other-name\" placeholder=\"Or type a name...\">\r\n                        </div>\r\n                      </div>\r\n                    </div>\r\n                  </div>\r\n                </div>\r\n                <div class=\"form-group\">\r\n                  <label>Follow-up Questions (one per line)</label>\r\n                  <textarea id=\"followup-input\" rows=\"2\" \r\n                    placeholder=\"Add any follow-up questions...\"></textarea>\r\n                </div>\r\n                <div class=\"form-actions\">\r\n                  <button class=\"btn btn-primary\" id=\"save-answer-btn\">\r\n                    ${question.answer ? 'Update Answer' : 'Save Answer'}\r\n                  </button>\r\n                </div>\r\n              </div>\r\n            </section>\r\n          </div>\r\n\r\n          <div class=\"detail-column-right\">\r\n            <!-- Follow-up Chain Section -->\r\n            <section class=\"detail-section\" id=\"chain-section\">\r\n              <h3>Follow-up Chain</h3>\r\n              <div id=\"chain-content\" class=\"chain-content\">\r\n                <div class=\"skeleton-card\">\r\n                  <div class=\"skeleton-text w-75\"></div>\r\n                  <div class=\"skeleton-text w-25\"></div>\r\n                </div>\r\n              </div>\r\n            </section>\r\n\r\n            <!-- Similar Questions Section -->\r\n            <section class=\"detail-section\" id=\"similar-section\">\r\n              <h3>Similar Questions</h3>\r\n              <div id=\"similar-content\" class=\"similar-content\">\r\n                 <div class=\"skeleton-card\">\r\n                  <div class=\"skeleton-text w-100\"></div>\r\n                  <div class=\"skeleton-row\">\r\n                    <div class=\"skeleton-text w-25\"></div>\r\n                    <div class=\"skeleton-text w-25\"></div>\r\n                  </div>\r\n                </div>\r\n                <div class=\"skeleton-card\" style=\"margin-top: 8px;\">\r\n                  <div class=\"skeleton-text w-100\"></div>\r\n                  <div class=\"skeleton-row\">\r\n                    <div class=\"skeleton-text w-25\"></div>\r\n                    <div class=\"skeleton-text w-25\"></div>\r\n                  </div>\r\n                </div>\r\n              </div>\r\n            </section>\r\n\r\n            <!-- Timeline Section -->\r\n            <section class=\"detail-section\" id=\"timeline-section\">\r\n              <h3>Timeline</h3>\r\n              <div id=\"timeline-content\" class=\"timeline-content\">\r\n                <div class=\"skeleton-card\">\r\n                    <div class=\"skeleton-row\">\r\n                        <div class=\"skeleton-avatar\"></div>\r\n                        <div class=\"skeleton-text w-50\" style=\"margin-bottom:0\"></div>\r\n                    </div>\r\n                    <div class=\"skeleton-text w-75\" style=\"margin-top: 8px;\"></div>\r\n                </div>\r\n                 <div class=\"skeleton-card\" style=\"margin-top: 12px;\">\r\n                    <div class=\"skeleton-row\">\r\n                        <div class=\"skeleton-avatar\"></div>\r\n                        <div class=\"skeleton-text w-50\" style=\"margin-bottom:0\"></div>\r\n                    </div>\r\n                    <div class=\"skeleton-text w-75\" style=\"margin-top: 8px;\"></div>\r\n                </div>\r\n              </div>\r\n            </section>\r\n          </div>\r\n        </div>\r\n\r\n      </div>\r\n\r\n      <!-- Actions Bar - Outside scrollable content for proper click handling -->\r\n      <div class=\"detail-actions\">\r\n        ${question.status === 'resolved' || question.status === 'dismissed' ? `\r\n          <button class=\"btn btn-warning\" id=\"reopen-btn\">Reopen</button>\r\n        ` : ''}\r\n        ${question.status === 'deferred' ? `\r\n          <button class=\"btn btn-info\" id=\"undefer-btn\">Resume Now</button>\r\n        ` : `\r\n          <button class=\"btn btn-secondary\" id=\"defer-btn\">Defer</button>\r\n        `}\r\n        ${question.was_useful === undefined && question.answer ? `\r\n          <div class=\"feedback-buttons\">\r\n            <span class=\"feedback-label\">Was this helpful?</span>\r\n            <button class=\"btn btn-sm btn-success\" id=\"feedback-yes\">Yes</button>\r\n            <button class=\"btn btn-sm btn-secondary\" id=\"feedback-no\">No</button>\r\n          </div>\r\n        ` : ''}\r\n        <button class=\"btn btn-secondary\" id=\"edit-btn\">Edit</button>\r\n        <div class=\"dropdown dismiss-dropdown\">\r\n          <button class=\"btn btn-danger\" id=\"dismiss-btn\">Dismiss </button>\r\n          <div class=\"dropdown-menu\" id=\"dismiss-menu\">\r\n            <a href=\"#\" data-reason=\"duplicate\">Duplicate</a>\r\n            <a href=\"#\" data-reason=\"not_relevant\">Not Relevant</a>\r\n            <a href=\"#\" data-reason=\"out_of_scope\">Out of Scope</a>\r\n            <a href=\"#\" data-reason=\"answered_elsewhere\">Answered Elsewhere</a>\r\n            <a href=\"#\" data-reason=\"no_longer_needed\">No Longer Needed</a>\r\n            <a href=\"#\" data-reason=\"other\">Other...</a>\r\n          </div>\r\n        </div>\r\n      </div>\r\n    `;\r\n\r\n    // Bind events\r\n    this.bindEvents();\r\n\r\n    // Load async data\r\n    this.loadContacts();\r\n    this.loadChain(question.id);\r\n    this.loadSimilar(question.id);\r\n    this.loadTimeline(question.id);\r\n\r\n    return this.container;\r\n  }\r\n\r\n  private renderAssignmentState(): string {\r\n    const { question } = this;\r\n    if (question.assigned_to) {\r\n      return `\r\n        <div class=\"assigned-contact-display\">\r\n          <div class=\"contact-avatar-lg\" id=\"assigned-avatar\">\r\n            ${this.getInitials(question.assigned_to)}\r\n          </div>\r\n          <div class=\"contact-details\">\r\n            <div class=\"contact-name-lg\">${this.escapeHtml(question.assigned_to)}</div>\r\n            <div class=\"contact-role-sm\" id=\"assigned-role\">Loading...</div>\r\n          </div>\r\n          <button class=\"btn-change-assignment\" id=\"change-assignee-btn\">\r\n            <svg width=\"14\" height=\"14\" fill=\"none\" viewBox=\"0 0 24 24\" stroke=\"currentColor\">\r\n              <path stroke-linecap=\"round\" stroke-linejoin=\"round\" stroke-width=\"2\" d=\"M15.232 5.232l3.536 3.536m-2.036-5.036a2.5 2.5 0 113.536 3.536L6.5 21.036H3v-3.572L16.732 3.732z\"/>\r\n            </svg>\r\n            Change\r\n          </button>\r\n        </div>\r\n      `;\r\n    }\r\n    return `\r\n      <div class=\"no-assignment\">\r\n        <div class=\"no-assignment-icon\">\r\n          <svg width=\"32\" height=\"32\" fill=\"none\" viewBox=\"0 0 24 24\" stroke=\"currentColor\">\r\n            <path stroke-linecap=\"round\" stroke-linejoin=\"round\" stroke-width=\"1.5\" d=\"M18 9v3m0 0v3m0-3h3m-3 0h-3m-2-5a4 4 0 11-8 0 4 4 0 018 0zM3 20a6 6 0 0112 0v1H3v-1z\"/>\r\n          </svg>\r\n        </div>\r\n        <span>No one assigned to answer</span>\r\n        <p class=\"no-assignment-hint\">Use AI Suggest to find the best person</p>\r\n        <button class=\"btn-assign-now\" id=\"show-picker-btn\">Choose Manually</button>\r\n      </div>\r\n    `;\r\n  }\r\n\r\n  private renderEntities(question: Question): string {\r\n    const entities = question.extracted_entities || [];\r\n    const topics = question.extracted_topics || [];\r\n\r\n    if (entities.length === 0 && topics.length === 0) {\r\n      return '';\r\n    }\r\n\r\n    const tags = [\r\n      ...entities.map(e => `<span class=\"entity-tag entity-${e.type}\">@${e.name}</span>`),\r\n      ...topics.map(t => `<span class=\"entity-tag entity-topic\">#${t.name}</span>`)\r\n    ];\r\n\r\n    return `<div class=\"question-entities\">${tags.join('')}</div>`;\r\n  }\r\n\r\n  private renderExistingAnswer(question: Question): string {\r\n    if (!question.answer) return '';\r\n\r\n    return `\r\n      <div class=\"existing-answer\">\r\n        <div class=\"answer-text\">${this.escapeHtml(question.answer)}</div>\r\n        <div class=\"answer-meta\">\r\n          <span class=\"answer-source-badge\">${question.answer_source || 'manual'}</span>\r\n          ${question.answered_by_name ? `<span class=\"answered-by\">by ${this.escapeHtml(question.answered_by_name)}</span>` : ''}\r\n          ${question.answered_at ? `<span class=\"answered-date\">${formatRelativeTime(question.answered_at)}</span>` : ''}\r\n        </div>\r\n        ${question.answer_provenance ? this.renderProvenance(question.answer_provenance) : ''}\r\n      </div>\r\n    `;\r\n  }\r\n\r\n  private renderProvenance(provenance: { sources?: Array<{ type: string; content: string; confidence: number }> }): string {\r\n    if (!provenance.sources || provenance.sources.length === 0) return '';\r\n\r\n    const sources = provenance.sources.map(s => `\r\n      <div class=\"provenance-source\">\r\n        <span class=\"source-type\">${s.type}</span>\r\n        <span class=\"source-content\">${this.escapeHtml(s.content.substring(0, 100))}...</span>\r\n        <span class=\"source-confidence\">${Math.round(s.confidence * 100)}%</span>\r\n      </div>\r\n    `).join('');\r\n\r\n    return `\r\n      <div class=\"answer-provenance\">\r\n        <div class=\"provenance-label\">Sources:</div>\r\n        ${sources}\r\n      </div>\r\n    `;\r\n  }\r\n\r\n  private bindEvents(): void {\r\n    const { onClose, onUpdate } = this.props;\r\n    const container = this.container;\r\n\r\n    // Close button\r\n    const closeBtn = container.querySelector('#close-detail');\r\n    if (closeBtn) {\r\n      on(closeBtn as HTMLElement, 'click', onClose);\r\n    }\r\n\r\n    // Back to list link\r\n    const backLink = container.querySelector('#back-to-list');\r\n    if (backLink) {\r\n      on(backLink as HTMLElement, 'click', (e) => {\r\n        e.preventDefault();\r\n        onClose();\r\n      });\r\n    }\r\n\r\n    // AI Suggest button\r\n    const aiSuggestBtn = container.querySelector('#ai-suggest-btn');\r\n    if (aiSuggestBtn) {\r\n      on(aiSuggestBtn as HTMLElement, 'click', () => this.loadAISuggestions());\r\n    }\r\n\r\n    // Check answers button\r\n    const checkAnswersBtn = container.querySelector('#check-answers-btn');\r\n    if (checkAnswersBtn) {\r\n      on(checkAnswersBtn as HTMLElement, 'click', () => this.checkPotentialAnswers());\r\n    }\r\n\r\n    // Save answer button\r\n    const saveAnswerBtn = container.querySelector('#save-answer-btn');\r\n    if (saveAnswerBtn) {\r\n      on(saveAnswerBtn as HTMLElement, 'click', () => this.saveAnswer());\r\n    }\r\n\r\n    // Reopen button\r\n    const reopenBtn = container.querySelector('#reopen-btn');\r\n    if (reopenBtn) {\r\n      on(reopenBtn as HTMLElement, 'click', () => this.reopenQuestion());\r\n    }\r\n\r\n    // Dismiss button and dropdown\r\n    const dismissBtn = container.querySelector('#dismiss-btn');\r\n    const dismissMenu = container.querySelector('#dismiss-menu');\r\n\r\n    if (dismissBtn && dismissMenu) {\r\n      on(dismissBtn as HTMLElement, 'click', (e) => {\r\n        e.stopPropagation();\r\n        dismissMenu.classList.toggle('show');\r\n      });\r\n\r\n      // Dismiss reasons - Use arrow function to preserve this\r\n      const reasonLinks = dismissMenu.querySelectorAll('a[data-reason]');\r\n      reasonLinks.forEach(link => {\r\n        on(link as HTMLElement, 'click', async (e) => {\r\n          e.preventDefault();\r\n          e.stopPropagation();\r\n          const reason = link.getAttribute('data-reason') as any;\r\n          dismissMenu.classList.remove('show');\r\n\r\n          let details: string | undefined;\r\n          if (reason === 'other') {\r\n            details = prompt('Please provide a reason for dismissing this question:') || undefined;\r\n            if (!details) return;\r\n          }\r\n          await this.dismissQuestionWithReason(reason, details);\r\n        });\r\n      });\r\n\r\n      // Close dropdown on outside click\r\n      const closeMenu = (e: Event) => {\r\n        if (!(e.target as HTMLElement).closest('.dismiss-dropdown') && this.container.contains(dismissMenu)) {\r\n          try {\r\n            dismissMenu.classList.remove('show');\r\n          } catch (e) { } // Handle case where menu might be removed\r\n        }\r\n      };\r\n      document.addEventListener('click', closeMenu);\r\n      // NOTE: We should cleanup this listener in a destroy() method if we implement one\r\n    }\r\n\r\n    // Defer button\r\n    const deferBtn = container.querySelector('#defer-btn');\r\n    if (deferBtn) {\r\n      on(deferBtn as HTMLElement, 'click', () => this.showDeferDialog());\r\n    }\r\n\r\n    // Undefer button\r\n    const undeferBtn = container.querySelector('#undefer-btn');\r\n    if (undeferBtn) {\r\n      on(undeferBtn as HTMLElement, 'click', () => this.reopenQuestion());\r\n    }\r\n\r\n    // Feedback buttons\r\n    const feedbackYes = container.querySelector('#feedback-yes');\r\n    const feedbackNo = container.querySelector('#feedback-no');\r\n\r\n    if (feedbackYes) {\r\n      on(feedbackYes as HTMLElement, 'click', () => this.submitFeedback(true));\r\n    }\r\n\r\n    if (feedbackNo) {\r\n      on(feedbackNo as HTMLElement, 'click', () => {\r\n        const feedback = prompt('How can we improve this answer?');\r\n        this.submitFeedback(false, feedback || undefined);\r\n      });\r\n    }\r\n\r\n    // Edit button\r\n    const editBtn = container.querySelector('#edit-btn');\r\n    if (editBtn) {\r\n      on(editBtn as HTMLElement, 'click', () => {\r\n        // Toggle edit mode (show answer form even if resolved)\r\n        const form = container.querySelector('.answer-form');\r\n        if (form) {\r\n          form.classList.remove('hidden');\r\n          (form.querySelector('#answer-input') as HTMLElement)?.focus();\r\n        }\r\n      });\r\n    }\r\n\r\n    // Answer source radio buttons\r\n    const sourceRadios = container.querySelectorAll('input[name=\"answer-source\"]');\r\n    sourceRadios.forEach(radio => {\r\n      on(radio as HTMLElement, 'change', (e) => {\r\n        const value = (e.target as HTMLInputElement).value;\r\n        const form = container.querySelector('.answer-form');\r\n        if (form) {\r\n          // Update active class on labels\r\n          form.querySelectorAll('.source-option').forEach(opt => opt.classList.remove('active'));\r\n          (e.target as HTMLElement).closest('.source-option')?.classList.add('active');\r\n        }\r\n      });\r\n    });\r\n\r\n    // Answerer picker\r\n    const showAnswererPickerBtn = container.querySelector('#show-answerer-picker');\r\n    const clearAnswererBtn = container.querySelector('#clear-answerer');\r\n    const answererPicker = container.querySelector('#answerer-picker-dropdown');\r\n\r\n    if (showAnswererPickerBtn && answererPicker) {\r\n      on(showAnswererPickerBtn as HTMLElement, 'click', (e) => {\r\n        e.stopPropagation();\r\n        answererPicker.classList.toggle('hidden');\r\n        const input = answererPicker.querySelector('#answerer-search') as HTMLInputElement;\r\n        if (input) input.focus();\r\n\r\n        // Populate if empty\r\n        const list = answererPicker.querySelector('#answerer-list');\r\n        if (list && !list.hasChildNodes()) {\r\n          list.innerHTML = this.contacts.map(c => `\r\n             <div class=\"picker-item\" data-id=\"${c.id}\" data-name=\"${this.escapeHtml(c.name)}\">\r\n               <div class=\"picker-avatar\">${this.getInitials(c.name)}</div>\r\n               <div class=\"picker-name\">${this.escapeHtml(c.name)}</div>\r\n             </div>\r\n           `).join('');\r\n\r\n          // Bind items\r\n          list.querySelectorAll('.picker-item').forEach(item => {\r\n            on(item as HTMLElement, 'click', () => {\r\n              const id = item.getAttribute('data-id');\r\n              const name = item.getAttribute('data-name');\r\n              this.setAnsweredBy(id || undefined, name || undefined);\r\n              answererPicker.classList.add('hidden');\r\n            });\r\n          });\r\n        }\r\n      });\r\n\r\n      // Filter list\r\n      const filterInput = answererPicker.querySelector('#answerer-search');\r\n      if (filterInput) {\r\n        on(filterInput as HTMLElement, 'input', (e) => {\r\n          const val = (e.target as HTMLInputElement).value.toLowerCase();\r\n          const list = answererPicker.querySelector('#answerer-list');\r\n          if (list) {\r\n            list.querySelectorAll('.picker-item').forEach(item => {\r\n              const name = item.getAttribute('data-name')?.toLowerCase() || '';\r\n              (item as HTMLElement).style.display = name.includes(val) ? 'flex' : 'none';\r\n            });\r\n          }\r\n        });\r\n      }\r\n\r\n      // Other name input\r\n      const otherInput = answererPicker.querySelector('#answerer-other-name');\r\n      if (otherInput) {\r\n        on(otherInput as HTMLElement, 'keydown', (e) => {\r\n          if ((e as KeyboardEvent).key === 'Enter') {\r\n            e.preventDefault();\r\n            const name = (e.target as HTMLInputElement).value.trim();\r\n            if (name) {\r\n              this.setAnsweredBy(undefined, name);\r\n              answererPicker.classList.add('hidden');\r\n            }\r\n          }\r\n        });\r\n      }\r\n\r\n      // Close on outside click\r\n      document.addEventListener('click', (e) => {\r\n        if (answererPicker && !answererPicker.classList.contains('hidden') &&\r\n          !(e.target as HTMLElement).closest('.answered-by-picker')) {\r\n          answererPicker.classList.add('hidden');\r\n        }\r\n      });\r\n    }\r\n\r\n    if (clearAnswererBtn) {\r\n      on(clearAnswererBtn as HTMLElement, 'click', () => {\r\n        this.setAnsweredBy(undefined, undefined);\r\n      });\r\n    }\r\n  }\r\n\r\n  private setAnsweredBy(id: string | undefined, name: string | undefined): void {\r\n    const display = this.container.querySelector('#answered-by-display');\r\n    const select = this.container.querySelector('#answered-by-contact') as HTMLSelectElement;\r\n\r\n    if (select) {\r\n      select.value = id || '';\r\n      select.setAttribute('data-name', name || '');\r\n    }\r\n\r\n    if (display) {\r\n      if (id || name) {\r\n        display.innerHTML = `\r\n          <div class=\"answered-by-card\" id=\"current-answerer\">\r\n            <div class=\"answerer-avatar\" id=\"answerer-avatar\">${this.getInitials(name || '')}</div>\r\n            <span class=\"answerer-name\">${this.escapeHtml(name || 'Contact')}</span>\r\n            <button type=\"button\" class=\"btn-clear-answerer\" id=\"clear-answerer\"></button>\r\n          </div>\r\n        `;\r\n        // Rebind clear button\r\n        const clearBtn = display.querySelector('#clear-answerer');\r\n        if (clearBtn) {\r\n          on(clearBtn as HTMLElement, 'click', () => this.setAnsweredBy(undefined, undefined));\r\n        }\r\n      } else {\r\n        display.innerHTML = `\r\n          <button type=\"button\" class=\"btn-select-answerer\" id=\"show-answerer-picker\">\r\n            <svg width=\"16\" height=\"16\" fill=\"none\" viewBox=\"0 0 24 24\" stroke=\"currentColor\">\r\n              <path stroke-linecap=\"round\" stroke-linejoin=\"round\" stroke-width=\"2\" d=\"M16 7a4 4 0 11-8 0 4 4 0 018 0zM12 14a7 7 0 00-7 7h14a7 7 0 00-7-7z\"/>\r\n            </svg>\r\n            Select who answered...\r\n          </button>\r\n        `;\r\n        // Rebind show picker button - requires re-binding global event or delegation? \r\n        // For simplicity, we just rely on parent delegation or re-run bindEvents logic? \r\n        // No, bindEvents runs once. We need to re-bind specific element.\r\n        // Better: trigger a re-bind or just manually bind it here.\r\n        // But `answerer-picker-dropdown` is sibling, so we need access to it.\r\n        // This is getting complex. Let's assume we can grab it again.\r\n        const showBtn = display.querySelector('#show-answerer-picker');\r\n        const picker = this.container.querySelector('#answerer-picker-dropdown');\r\n        if (showBtn && picker) {\r\n          on(showBtn as HTMLElement, 'click', (e) => {\r\n            e.stopPropagation();\r\n            picker.classList.toggle('hidden');\r\n            const input = picker.querySelector('#answerer-search') as HTMLInputElement;\r\n            if (input) input.focus();\r\n          });\r\n        }\r\n      }\r\n    }\r\n  }\r\n\r\n  private async submitFeedback(wasUseful: boolean, feedback?: string): Promise<void> {\r\n    try {\r\n      await questionsService.submitAnswerFeedback(this.question.id, wasUseful, feedback);\r\n      toast.success('Feedback submitted');\r\n      // Hide buttons\r\n      const buttons = this.container.querySelector('.feedback-buttons');\r\n      if (buttons) {\r\n        buttons.innerHTML = `<span class=\"feedback-submitted\">Thank you for your feedback!</span>`;\r\n      }\r\n    } catch (e) {\r\n      toast.error('Failed to submit feedback');\r\n    }\r\n  }\r\n\r\n  private async loadContacts(): Promise<void> {\r\n    try {\r\n      const response = await contactsService.getAll();\r\n      this.contacts = response?.contacts || [];\r\n      // Logic to populate select/picker\r\n      this.renderAssignmentState(); // Refresh assignment UI with loaded role info\r\n    } catch (e) {\r\n      console.error('Error loading contacts', e);\r\n    }\r\n  }\r\n\r\n  // ... (Implement other methods: loadChain, loadSimilar, loadTimeline, loadAISuggestions, checkPotentialAnswers, saveAnswer, reopenQuestion, dismissQuestionWithReason, showDeferDialog, etc. mapped to use this.question and component state)\r\n\r\n  // Helpers\r\n  private getInitials(name: string): string {\r\n    if (!name) return '?';\r\n    const parts = name.trim().split(/\\s+/);\r\n    if (parts.length === 1) {\r\n      return parts[0].substring(0, 2).toUpperCase();\r\n    }\r\n    return (parts[0][0] + parts[parts.length - 1][0]).toUpperCase();\r\n  }\r\n\r\n  private escapeHtml(str: string | undefined): string {\r\n    if (!str) return '';\r\n    return str.replace(/&/g, '&amp;')\r\n      .replace(/</g, '&lt;')\r\n      .replace(/>/g, '&gt;')\r\n      .replace(/\"/g, '&quot;')\r\n      .replace(/'/g, '&#039;');\r\n  }\r\n\r\n  private async loadChain(questionId: string | number): Promise<void> {\r\n    const chainContent = this.container.querySelector('#chain-content');\r\n    if (!chainContent) return;\r\n\r\n    try {\r\n      const response = await http.get<{ parent: Question | null; children: Question[] }>(\r\n        `/api/questions/${questionId}/chain`\r\n      );\r\n      if (!this.container.isConnected) return;\r\n      const { parent, children } = response.data;\r\n\r\n      if (!parent && children.length === 0) {\r\n        chainContent.innerHTML = '<p class=\"empty-state\">No follow-up chain</p>';\r\n        return;\r\n      }\r\n\r\n      let html = '';\r\n\r\n      if (parent) {\r\n        html += `\r\n          <div class=\"chain-item chain-parent\" data-id=\"${parent.id}\">\r\n            <span class=\"chain-arrow\"></span>\r\n            <span class=\"chain-label\">Parent:</span>\r\n            <span class=\"chain-content\">${this.escapeHtml(parent.content.substring(0, 50))}...</span>\r\n            <span class=\"status-badge status-${parent.status}\">${parent.status}</span>\r\n          </div>\r\n        `;\r\n      }\r\n\r\n      html += `<div class=\"chain-item chain-current\">This question</div>`;\r\n\r\n      for (const child of children) {\r\n        html += `\r\n          <div class=\"chain-item chain-child\" data-id=\"${child.id}\">\r\n            <span class=\"chain-arrow\"></span>\r\n            <span class=\"chain-content\">${this.escapeHtml(child.content.substring(0, 50))}...</span>\r\n            <span class=\"status-badge status-${child.status}\">${child.status}</span>\r\n          </div>\r\n        `;\r\n      }\r\n\r\n      chainContent.innerHTML = html;\r\n\r\n      // Bind click handlers for navigation\r\n      chainContent.querySelectorAll('.chain-item[data-id]').forEach(item => {\r\n        on(item as HTMLElement, 'click', () => {\r\n          const id = item.getAttribute('data-id');\r\n          if (id && this.props.onNavigateToQuestion) {\r\n            this.props.onNavigateToQuestion(id);\r\n          }\r\n        });\r\n      });\r\n    } catch (e) {\r\n      chainContent.innerHTML = '<p class=\"error\">Failed to load chain</p>';\r\n    }\r\n  }\r\n  private async loadSimilar(questionId: string | number): Promise<void> {\r\n    const similarContent = this.container.querySelector('#similar-content');\r\n    if (!similarContent) return;\r\n\r\n    try {\r\n      const response = await http.get<{ similar: SimilarQuestion[] }>(\r\n        `/api/questions/${questionId}/similar?limit=5`\r\n      );\r\n      if (!this.container.isConnected) return;\r\n      const { similar } = response.data;\r\n\r\n      if (!similar || similar.length === 0) {\r\n        similarContent.innerHTML = '<p class=\"empty-state\">No similar questions found</p>';\r\n        return;\r\n      }\r\n\r\n      const html = similar.map(q => `\r\n        <div class=\"similar-item\" data-id=\"${q.id}\">\r\n          <div class=\"similar-content\">${this.escapeHtml(q.content.substring(0, 60))}...</div>\r\n          <div class=\"similar-meta\">\r\n            <span class=\"status-badge status-${q.status}\">${q.status}</span>\r\n            <span class=\"similarity-score\">${Math.round(q.similarityScore * 100)}%</span>\r\n          </div>\r\n        </div>\r\n      `).join('');\r\n\r\n      similarContent.innerHTML = html;\r\n\r\n      // Bind click handlers\r\n      similarContent.querySelectorAll('.similar-item').forEach(item => {\r\n        on(item as HTMLElement, 'click', () => {\r\n          const id = item.getAttribute('data-id');\r\n          if (id && this.props.onNavigateToQuestion) {\r\n            this.props.onNavigateToQuestion(id);\r\n          }\r\n        });\r\n      });\r\n    } catch (e) {\r\n      similarContent.innerHTML = '<p class=\"error\">Failed to load similar questions</p>';\r\n    }\r\n  }\r\n  private async loadTimeline(questionId: string | number): Promise<void> {\r\n    const timelineContent = this.container.querySelector('#timeline-content');\r\n    if (!timelineContent) return;\r\n\r\n    try {\r\n      const response = await http.get<{ events: TimelineEvent[] }>(\r\n        `/api/questions/${questionId}/timeline`\r\n      );\r\n      if (!this.container.isConnected) return;\r\n      const { events } = response.data;\r\n\r\n      if (!events || events.length === 0) {\r\n        timelineContent.innerHTML = '<p class=\"empty-state\">No events recorded</p>';\r\n        return;\r\n      }\r\n\r\n      const html = events.map(e => {\r\n        const icon = this.getEventIcon(e.event_type);\r\n        const description = this.getEventDescription(e);\r\n\r\n        return `\r\n          <div class=\"timeline-item\">\r\n            <div class=\"timeline-icon\">${icon}</div>\r\n            <div class=\"timeline-content\">\r\n              <div class=\"timeline-title\">${description}</div>\r\n              <div class=\"timeline-date\">${formatDateTime(e.created_at)}</div>\r\n            </div>\r\n          </div>\r\n        `;\r\n      }).join('');\r\n\r\n      timelineContent.innerHTML = `<div class=\"timeline-list\">${html}</div>`;\r\n    } catch (e) {\r\n      timelineContent.innerHTML = '<p class=\"error\">Failed to load timeline</p>';\r\n    }\r\n  }\r\n\r\n  private getEventIcon(eventType: string): string {\r\n    const icons: Record<string, string> = {\r\n      created: '',\r\n      assigned: '',\r\n      answered: '',\r\n      priority_changed: '',\r\n      status_changed: '',\r\n      reopened: '',\r\n      dismissed: '',\r\n      sla_breached: '',\r\n      entity_extracted: '',\r\n      similar_linked: ''\r\n    };\r\n    return icons[eventType] || '';\r\n  }\r\n\r\n  private getEventDescription(event: TimelineEvent): string {\r\n    const data = event.event_data || {};\r\n\r\n    switch (event.event_type) {\r\n      case 'created':\r\n        return `Created${event.actor_name ? ` by ${event.actor_name}` : ''}`;\r\n      case 'assigned':\r\n        return `Assigned to ${data.to || 'someone'}${event.actor_name ? ` by ${event.actor_name}` : ''}`;\r\n      case 'answered':\r\n        return `Answered${event.actor_name ? ` by ${event.actor_name}` : ''} (${data.source || 'manual'})`;\r\n      case 'priority_changed':\r\n        return `Priority changed: ${data.from}  ${data.to}`;\r\n      case 'status_changed':\r\n        return `Status changed: ${data.from}  ${data.to}`;\r\n      case 'reopened':\r\n        return `Reopened${event.actor_name ? ` by ${event.actor_name}` : ''}`;\r\n      case 'dismissed':\r\n        return `Dismissed${event.actor_name ? ` by ${event.actor_name}` : ''}`;\r\n      case 'sla_breached':\r\n        return 'SLA breached';\r\n      case 'entity_extracted':\r\n        return `Entities extracted: ${(data.entities as Array<{ name: string }>)?.length || 0}`;\r\n      default:\r\n        return event.event_type;\r\n    }\r\n  }\r\n  private async loadAISuggestions(): Promise<void> {\r\n    const panel = this.container.querySelector('#suggestions-panel') as HTMLElement;\r\n    const btn = this.container.querySelector('#ai-suggest-btn') as HTMLButtonElement;\r\n\r\n    if (!panel || !this.question) return;\r\n\r\n    btn.disabled = true;\r\n    btn.innerHTML = `\r\n      <svg class=\"spin\" width=\"16\" height=\"16\" fill=\"none\" viewBox=\"0 0 24 24\" stroke=\"currentColor\">\r\n        <path stroke-linecap=\"round\" stroke-linejoin=\"round\" stroke-width=\"2\" d=\"M4 4v5h.582m15.356 2A8.001 8.001 0 004.582 9m0 0H9m11 11v-5h-.581m0 0a8.003 8.003 0 01-15.357-2m15.357 2H15\"/>\r\n      </svg>\r\n      Analyzing...\r\n    `;\r\n    panel.classList.remove('hidden');\r\n    panel.innerHTML = `\r\n      <div class=\"suggestions-loading\">\r\n        <div class=\"ai-thinking-animation\">\r\n          <span></span><span></span><span></span>\r\n        </div>\r\n        <div class=\"loading-text\">AI is analyzing question context and team expertise...</div>\r\n      </div>\r\n    `;\r\n\r\n    try {\r\n      const result = await questionsService.suggestAssignee({\r\n        id: this.question.id,\r\n        useAI: true\r\n      });\r\n      if (!this.container.isConnected) return;\r\n\r\n      if (result.suggestions.length === 0) {\r\n        panel.innerHTML = `\r\n          <div class=\"no-suggestions\">\r\n            <svg width=\"40\" height=\"40\" fill=\"none\" viewBox=\"0 0 24 24\" stroke=\"currentColor\">\r\n              <path stroke-linecap=\"round\" stroke-linejoin=\"round\" stroke-width=\"1.5\" d=\"M9.172 16.172a4 4 0 015.656 0M9 10h.01M15 10h.01M21 12a9 9 0 11-18 0 9 9 0 0118 0z\"/>\r\n            </svg>\r\n            <div class=\"no-suggestions-text\">No matching experts found</div>\r\n            <button class=\"btn-show-all-contacts\" id=\"show-all-btn\">Browse all contacts</button>\r\n          </div>\r\n        `;\r\n\r\n        // Bind show all button\r\n        const showAllBtn = panel.querySelector('#show-all-btn');\r\n        if (showAllBtn) {\r\n          on(showAllBtn as HTMLElement, 'click', () => {\r\n            panel.classList.add('hidden');\r\n            const picker = this.container.querySelector('#contact-picker') as HTMLElement;\r\n            if (picker) {\r\n              picker.classList.remove('hidden');\r\n            }\r\n          });\r\n        }\r\n      } else {\r\n        panel.innerHTML = `\r\n          <div class=\"suggestions-header-sota\">\r\n            <div class=\"ai-badge\">\r\n              <svg width=\"14\" height=\"14\" fill=\"none\" viewBox=\"0 0 24 24\" stroke=\"currentColor\">\r\n                <path stroke-linecap=\"round\" stroke-linejoin=\"round\" stroke-width=\"2\" d=\"M13 10V3L4 14h7v7l9-11h-7z\"/>\r\n              </svg>\r\n              AI Recommended\r\n            </div>\r\n            ${result.cached ? '<span class=\"cached-tag\">Cached</span>' : '<span class=\"fresh-tag\">Fresh</span>'}\r\n          </div>\r\n          <div class=\"suggestions-list-sota\">\r\n            ${result.suggestions.map((s, i) => {\r\n          const contact = this.contacts.find(c => (c.name || '').trim().toLowerCase() === (s.person || '').trim().toLowerCase())\r\n            || this.contacts.find(c => (c.aliases || []).some(a => String(a).trim().toLowerCase() === (s.person || '').trim().toLowerCase()));\r\n          const photoUrl = contact?.photoUrl || contact?.avatarUrl || contact?.photo_url || contact?.avatar_url;\r\n          const roleDisplay = contact?.role ?? s.role ?? '';\r\n          const scoreColor = this.getScoreColor(s.score);\r\n\r\n          return `\r\n                <div class=\"suggestion-card-sota\" data-index=\"${i}\">\r\n                  <div class=\"suggestion-rank\">#${i + 1}</div>\r\n                  <div class=\"suggestion-avatar-sota\">\r\n                    ${photoUrl\r\n              ? `<img src=\"${photoUrl}\" alt=\"${this.escapeHtml(s.person)}\" onerror=\"this.parentElement.innerHTML='${this.getInitials(s.person)}'\">`\r\n              : this.getInitials(s.person)\r\n            }\r\n                  </div>\r\n                  <div class=\"suggestion-info-sota\">\r\n                    <div class=\"suggestion-name-sota\">${this.escapeHtml(s.person)}</div>\r\n                    ${roleDisplay ? `<div class=\"suggestion-role-sota\">${this.escapeHtml(roleDisplay)}</div>` : ''}\r\n                    <div class=\"suggestion-reason-sota\">${this.escapeHtml(s.reason)}</div>\r\n                  </div>\r\n                  <div class=\"suggestion-score-sota\" style=\"--score-color: ${scoreColor}\">\r\n                    <div class=\"score-ring\">\r\n                      <svg viewBox=\"0 0 36 36\">\r\n                        <path class=\"score-bg\" d=\"M18 2.0845 a 15.9155 15.9155 0 0 1 0 31.831 a 15.9155 15.9155 0 0 1 0 -31.831\"/>\r\n                        <path class=\"score-fill\" stroke-dasharray=\"${s.score}, 100\" d=\"M18 2.0845 a 15.9155 15.9155 0 0 1 0 31.831 a 15.9155 15.9155 0 0 1 0 -31.831\"/>\r\n                      </svg>\r\n                      <div class=\"score-value\">${s.score}%</div>\r\n                    </div>\r\n                    <div class=\"score-label\">Match</div>\r\n                  </div>\r\n                  <button class=\"btn-select-suggestion\">\r\n                    <svg width=\"16\" height=\"16\" fill=\"none\" viewBox=\"0 0 24 24\" stroke=\"currentColor\">\r\n                      <path stroke-linecap=\"round\" stroke-linejoin=\"round\" stroke-width=\"2\" d=\"M5 13l4 4L19 7\"/>\r\n                    </svg>\r\n                    Assign\r\n                  </button>\r\n                </div>\r\n              `;\r\n        }).join('')}\r\n          </div>\r\n          <div class=\"suggestions-footer\">\r\n            <button class=\"btn-link\" id=\"hide-suggestions-btn\">Close suggestions</button>\r\n          </div>\r\n        `;\r\n\r\n        // Bind click to select\r\n        panel.querySelectorAll('.suggestion-card-sota').forEach(item => {\r\n          const selectBtn = item.querySelector('.btn-select-suggestion');\r\n          if (selectBtn) {\r\n            on(selectBtn as HTMLElement, 'click', async (e) => {\r\n              e.stopPropagation();\r\n              const idx = parseInt(item.getAttribute('data-index') || '0');\r\n              const suggestion = result.suggestions[idx];\r\n              if (suggestion && this.question) {\r\n                const select = this.container.querySelector('#assignee-select') as HTMLSelectElement;\r\n                const contact = this.contacts.find(c => c.name === suggestion.person);\r\n\r\n                // Optimistic Update\r\n                const previousAssignedTo = this.question.assigned_to;\r\n                const previousStatus = this.question.status;\r\n\r\n                // 1. Update State Optimistically\r\n                this.question.assigned_to = suggestion.person;\r\n                this.question.status = 'assigned';\r\n\r\n                // 2. Update UI Immediately\r\n                if (contact && select) select.value = contact.id;\r\n                const assignmentEl = this.container.querySelector('#current-assignment');\r\n                if (assignmentEl) assignmentEl.innerHTML = this.renderAssignmentState();\r\n                this.bindPickerButtons();\r\n                panel.classList.add('hidden');\r\n\r\n                // 3. Perform API Call\r\n                try {\r\n                  await questionsService.update(this.question.id, {\r\n                    assigned_to: suggestion.person,\r\n                    status: 'assigned'\r\n                  });\r\n                  toast.success(`Assigned to ${suggestion.person}`);\r\n                } catch (err) {\r\n                  // 4. Rollback on Failure\r\n                  console.error('[QuestionDetail] Failed to save AI suggestion assignment:', err);\r\n                  this.question.assigned_to = previousAssignedTo;\r\n                  this.question.status = previousStatus;\r\n\r\n                  if (select && previousAssignedTo) {\r\n                    const prevContact = this.contacts.find(c => c.name === previousAssignedTo);\r\n                    if (prevContact) select.value = prevContact.id;\r\n                  }\r\n                  if (assignmentEl) assignmentEl.innerHTML = this.renderAssignmentState();\r\n                  this.bindPickerButtons();\r\n\r\n                  toast.error('Failed to save assignment. Reverted changes.');\r\n                }\r\n              }\r\n            });\r\n          }\r\n        });\r\n\r\n        // Bind hide button\r\n        const hideBtn = panel.querySelector('#hide-suggestions-btn');\r\n        if (hideBtn) {\r\n          on(hideBtn as HTMLElement, 'click', () => {\r\n            panel.classList.add('hidden');\r\n          });\r\n        }\r\n      }\r\n    } catch (e) {\r\n      const isTimeout = (err: unknown) =>\r\n        (err as { message?: string; status?: number }).message === 'Request timed out' ||\r\n        (err as { status?: number }).status === 0;\r\n      const timeoutMessage = isTimeout(e);\r\n      panel.innerHTML = `\r\n        <div class=\"suggestions-error\">\r\n          <svg width=\"32\" height=\"32\" fill=\"none\" viewBox=\"0 0 24 24\" stroke=\"currentColor\">\r\n            <path stroke-linecap=\"round\" stroke-linejoin=\"round\" stroke-width=\"2\" d=\"M12 9v2m0 4h.01m-6.938 4h13.856c1.54 0 2.502-1.667 1.732-3L13.732 4c-.77-1.333-2.694-1.333-3.464 0L3.34 16c-.77 1.333.192 3 1.732 3z\"/>\r\n          </svg>\r\n          <div>${timeoutMessage ? 'This took longer than expected.' : 'Failed to get AI suggestions.'}</div>\r\n          ${timeoutMessage ? '<p class=\"suggestions-error-hint\">You can try again (suggestions may be ready) or choose someone manually.</p>' : ''}\r\n          <button class=\"btn-retry\" id=\"retry-suggestions-btn\">Try Again</button>\r\n        </div>\r\n      `;\r\n\r\n      const retryBtn = panel.querySelector('#retry-suggestions-btn');\r\n      if (retryBtn) {\r\n        on(retryBtn as HTMLElement, 'click', () => this.loadAISuggestions());\r\n      }\r\n    } finally {\r\n      if (btn) {\r\n        btn.disabled = false;\r\n        btn.innerHTML = `\r\n          <svg width=\"16\" height=\"16\" fill=\"none\" viewBox=\"0 0 24 24\" stroke=\"currentColor\">\r\n            <path stroke-linecap=\"round\" stroke-linejoin=\"round\" stroke-width=\"2\" d=\"M13 10V3L4 14h7v7l9-11h-7z\"/>\r\n          </svg>\r\n          AI Suggest\r\n        `;\r\n      }\r\n    }\r\n  }\r\n\r\n  private getScoreColor(score: number): string {\r\n    if (score >= 75) return '#10b981'; // green\r\n    if (score >= 50) return '#f59e0b'; // amber\r\n    return '#6b7280'; // gray\r\n  }\r\n\r\n  private bindPickerButtons(): void {\r\n    const container = this.container;\r\n    const showPickerBtn = container.querySelector('#show-picker-btn');\r\n    const changeBtn = container.querySelector('#change-assignee-btn');\r\n    const picker = container.querySelector('#contact-picker') as HTMLElement;\r\n\r\n    if (showPickerBtn && picker) {\r\n      on(showPickerBtn as HTMLElement, 'click', () => {\r\n        picker.classList.toggle('hidden');\r\n        const searchInput = picker.querySelector('#contact-search') as HTMLInputElement;\r\n        if (searchInput) {\r\n          searchInput.focus();\r\n        }\r\n      });\r\n    }\r\n\r\n    if (changeBtn && picker) {\r\n      on(changeBtn as HTMLElement, 'click', () => {\r\n        picker.classList.toggle('hidden');\r\n        const searchInput = picker.querySelector('#contact-search') as HTMLInputElement;\r\n        if (searchInput) {\r\n          searchInput.focus();\r\n        }\r\n      });\r\n    }\r\n  }\r\n  private async checkPotentialAnswers(): Promise<void> {\r\n    const container = this.container.querySelector('#potential-answers');\r\n    if (!container) return;\r\n\r\n    container.innerHTML = '<div class=\"loading\">Searching knowledge base...</div>';\r\n\r\n    try {\r\n      // Create a query from the question context + content\r\n      const query = `${this.question.content} ${this.question.context || ''}`.trim().substring(0, 100);\r\n\r\n      // Use factsService to search (assuming getAll with filter or we mimic search)\r\n      // Since we don't have a dedicated search endpoint visible in snippets, we'll try a basic fetch \r\n      // or just assume we can get some relevant facts. \r\n      // For now, we'll mock a search via getAll and client-side filter if needed, \r\n      // OR better, checking if there's a specific 'search' endpoint in api.ts we missed.\r\n      // Let's assume there is a way to get relevant facts.\r\n      const response = await import('@services/facts').then(m => m.factsService.getAll());\r\n      if (!this.container.isConnected) return;\r\n      const facts = response.facts || [];\r\n\r\n      // Simple client-side search for demo\r\n      const relevant = facts.filter(f =>\r\n        f.content.toLowerCase().includes(this.question.content.toLowerCase()) ||\r\n        this.question.content.toLowerCase().includes(f.content.toLowerCase())\r\n      ).slice(0, 3);\r\n\r\n      if (relevant.length === 0) {\r\n        container.innerHTML = '<p class=\"empty-state\">No direct matches found in knowledge base.</p>';\r\n        return;\r\n      }\r\n\r\n      container.innerHTML = relevant.map(f => `\r\n         <div class=\"potential-answer-card\">\r\n           <div class=\"answer-content\">${this.escapeHtml(f.content)}</div>\r\n           <div class=\"answer-meta\">\r\n             <span class=\"badg badge-fact\">Fact</span>\r\n             <span class=\"confidence\">Confidence: ${Math.round((f.confidence || 0.8) * 100)}%</span>\r\n             <button class=\"btn-use-answer\" data-content=\"${this.escapeHtml(f.content)}\">Use this</button>\r\n           </div>\r\n         </div>\r\n       `).join('');\r\n\r\n      // Bind use buttons\r\n      container.querySelectorAll('.btn-use-answer').forEach(btn => {\r\n        on(btn as HTMLElement, 'click', () => {\r\n          const content = btn.getAttribute('data-content');\r\n          const textarea = this.container.querySelector('#answer-input') as HTMLTextAreaElement;\r\n          if (textarea && content) {\r\n            textarea.value = content;\r\n            textarea.focus();\r\n          }\r\n        });\r\n      });\r\n\r\n    } catch (e) {\r\n      container.innerHTML = '<p class=\"error\">Failed to check answers</p>';\r\n    }\r\n  }\r\n  private async saveAnswer(): Promise<void> {\r\n    const textarea = this.container.querySelector('#answer-input') as HTMLTextAreaElement;\r\n    const answer = textarea?.value.trim();\r\n\r\n    if (!answer) {\r\n      toast.error('Please enter an answer');\r\n      return;\r\n    }\r\n\r\n    const btn = this.container.querySelector('#save-answer-btn') as HTMLButtonElement;\r\n    if (btn) {\r\n      btn.disabled = true;\r\n      btn.textContent = 'Saving...';\r\n    }\r\n\r\n    // Gather form data BEFORE optimistic update\r\n    const sourceRadio = this.container.querySelector('input[name=\"answer-source\"]:checked') as HTMLInputElement;\r\n    const source = (sourceRadio?.value || 'manual') as any;\r\n\r\n    const answererSelect = this.container.querySelector('#answered-by-contact') as HTMLSelectElement;\r\n    const contextAnsweredBy = answererSelect?.value;\r\n    const contextAnsweredByName = answererSelect?.getAttribute('data-name');\r\n\r\n    const followupInput = this.container.querySelector('#followup-input') as HTMLTextAreaElement;\r\n    const followups = followupInput?.value.trim();\r\n\r\n    // Optimistic Update\r\n    const previousQuestion = { ...this.question };\r\n\r\n    // 1. Update State Optimistically\r\n    this.question.answer = answer;\r\n\r\n    // 2. Render deeply optimistically\r\n    this.render();\r\n\r\n    try {\r\n      const result = await questionsService.answer(this.question.id, {\r\n        answer,\r\n        source,\r\n        answeredByContactId: contextAnsweredBy || undefined,\r\n        answeredByName: contextAnsweredByName || undefined,\r\n        followupQuestions: followups\r\n      });\r\n\r\n      if (!this.container.isConnected) return;\r\n\r\n      if (result.success) {\r\n        toast.success('Answer saved successfully');\r\n        this.question = result.question;\r\n        if (this.props.onUpdate) this.props.onUpdate(result.question);\r\n        this.render(); // Re-render with canonical server state\r\n      } else {\r\n        throw new Error(result.message || 'Failed to save answer');\r\n      }\r\n    } catch (e) {\r\n      console.error('Save answer error:', e);\r\n      toast.error('Error saving answer. restoring...');\r\n\r\n      // Rollback\r\n      this.question = previousQuestion;\r\n      this.render();\r\n\r\n      // Restore user input so they don't lose it\r\n      // After render, find textarea and button\r\n      setTimeout(() => {\r\n        const area = this.container.querySelector('#answer-input') as HTMLTextAreaElement;\r\n        if (area) area.value = answer;\r\n      }, 0);\r\n    }\r\n  }\r\n\r\n  private async reopenQuestion(): Promise<void> {\r\n    if (!confirm('Are you sure you want to reopen this question?')) return;\r\n\r\n    try {\r\n      const updated = await questionsService.reopen(this.question.id, 'Manually reopened');\r\n      if (!this.container.isConnected) return;\r\n      toast.success('Question reopened');\r\n      this.question = updated;\r\n      if (this.props.onUpdate) this.props.onUpdate(updated);\r\n      this.render();\r\n    } catch (e) {\r\n      toast.error('Failed to reopen question');\r\n    }\r\n  }\r\n\r\n  private async dismissQuestionWithReason(reason: any, details?: string): Promise<void> {\r\n    try {\r\n      const updated = await questionsService.dismissQuestion(this.question.id, reason, details);\r\n      if (!this.container.isConnected) return;\r\n      toast.success(`Question dismissed`);\r\n      this.question = updated;\r\n      if (this.props.onUpdate) this.props.onUpdate(updated);\r\n      this.props.onClose();\r\n    } catch (e) {\r\n      toast.error('Failed to dismiss');\r\n    }\r\n  }\r\n\r\n  private async showDeferDialog(): Promise<void> {\r\n    // Simple prompt for now, or build a custom dialog\r\n    const dateStr = prompt('Defer until (YYYY-MM-DD):', new Date(Date.now() + 86400000).toISOString().split('T')[0]);\r\n    if (!dateStr) return;\r\n\r\n    const reason = prompt('Reason for deferring (optional):') || undefined;\r\n\r\n    try {\r\n      const updated = await questionsService.deferQuestion(this.question.id, dateStr, reason);\r\n      if (!this.container.isConnected) return;\r\n      toast.success('Question deferred');\r\n      this.question = updated;\r\n      if (this.props.onUpdate) this.props.onUpdate(updated);\r\n      this.props.onClose();\r\n    } catch (e) {\r\n      toast.error('Failed to defer question');\r\n    }\r\n  }\r\n}\r\n\r\n/**\r\n * Factory function to maintain backward compatibility with main.ts\r\n */\r\nexport function createQuestionDetailView(props: QuestionDetailViewProps): HTMLElement {\r\n  return new QuestionDetailView(props).render();\r\n}\r\n","/**\r\n * Questions Panel Component\r\n * Displays and manages questions in the Source of Truth\r\n * Updated to support detail view instead of modal\r\n */\r\n\r\nimport { createElement, on } from '@lib/dom';\r\nimport { questionsService, Question } from '@services/questions';\r\nimport { dataStore } from '@stores/data';\r\nimport { showQuestionModal } from '../modals/QuestionModal';\r\nimport { createQuestionDetailView } from '../questions/QuestionDetailView';\r\nimport { toast } from '@services/toast';\r\nimport { formatRelativeTime } from '@lib/format';\r\nimport { http } from '@services/api';\r\n\r\nexport interface QuestionsPanelProps {\r\n  onQuestionClick?: (question: Question) => void;\r\n  useDetailView?: boolean; // If true, replace panel with detail view instead of modal\r\n  containerElement?: HTMLElement; // Parent container for detail view replacement\r\n}\r\n\r\nlet currentFilter: string = 'all';\r\nlet currentView: 'status' | 'person' | 'team' = 'status';\r\n\r\n/**\r\n * Create questions panel\r\n */\r\nexport function createQuestionsPanel(props: QuestionsPanelProps = {}): HTMLElement {\r\n  const panel = createElement('div', { className: 'sot-panel questions-panel' });\r\n\r\n  panel.innerHTML = `\r\n    <div class=\"panel-header\">\r\n      <div class=\"panel-title\">\r\n        <h2>Questions</h2>\r\n        <span class=\"panel-count\" id=\"questions-count\">0</span>\r\n      </div>\r\n      <div class=\"panel-actions\">\r\n        <select id=\"questions-filter\" class=\"filter-select\">\r\n          <option value=\"all\">All Active</option>\r\n          <option value=\"pending\">Pending</option>\r\n          <option value=\"assigned\">Assigned</option>\r\n          <option value=\"critical\">Critical Priority</option>\r\n          <option value=\"overdue\">Overdue (SLA)</option>\r\n          <option value=\"resolved\"> Resolved</option>\r\n          <option value=\"dismissed\"> Dismissed</option>\r\n        </select>\r\n        <div class=\"view-tabs\">\r\n          <button class=\"view-tab active\" data-view=\"status\">By Status</button>\r\n          <button class=\"view-tab\" data-view=\"person\">By Person</button>\r\n          <button class=\"view-tab\" data-view=\"team\">By Team</button>\r\n        </div>\r\n        <button class=\"btn btn-secondary btn-sm\" id=\"generate-team-btn\" title=\"Generate questions for team based on roles\"> Generate</button>\r\n        <button class=\"btn btn-primary btn-sm\" id=\"add-question-btn\">+ Add</button>\r\n      </div>\r\n    </div>\r\n    <div class=\"panel-content\" id=\"questions-content\">\r\n      <div class=\"loading\">Loading questions...</div>\r\n    </div>\r\n  `;\r\n\r\n  // Bind events\r\n  const filterSelect = panel.querySelector('#questions-filter') as HTMLSelectElement;\r\n  on(filterSelect, 'change', () => {\r\n    currentFilter = filterSelect.value;\r\n    loadQuestions(panel, props);\r\n  });\r\n\r\n  const viewTabs = panel.querySelectorAll('.view-tab');\r\n  viewTabs.forEach(tab => {\r\n    on(tab as HTMLElement, 'click', () => {\r\n      viewTabs.forEach(t => t.classList.remove('active'));\r\n      tab.classList.add('active');\r\n      currentView = tab.getAttribute('data-view') as 'status' | 'person' | 'team';\r\n      loadQuestions(panel, props);\r\n    });\r\n  });\r\n\r\n  const addBtn = panel.querySelector('#add-question-btn');\r\n  if (addBtn) {\r\n    on(addBtn as HTMLElement, 'click', () => {\r\n      showQuestionModal({\r\n        mode: 'create',\r\n        onSave: () => loadQuestions(panel, props),\r\n      });\r\n    });\r\n  }\r\n\r\n  // Generate for team button\r\n  const generateBtn = panel.querySelector('#generate-team-btn');\r\n  if (generateBtn) {\r\n    on(generateBtn as HTMLElement, 'click', () => showGenerateForTeamDialog(panel, props));\r\n  }\r\n\r\n  // Initial load\r\n  loadQuestions(panel, props);\r\n\r\n  // Subscribe to data changes\r\n  dataStore.subscribe(() => {\r\n    updateCount(panel);\r\n  });\r\n\r\n  return panel;\r\n}\r\n\r\n/**\r\n * Load questions\r\n */\r\nasync function loadQuestions(panel: HTMLElement, props: QuestionsPanelProps): Promise<void> {\r\n  const content = panel.querySelector('#questions-content') as HTMLElement;\r\n  content.innerHTML = '<div class=\"loading\">Loading...</div>';\r\n\r\n  try {\r\n    let questions: Question[] = [];\r\n\r\n    if (currentView === 'status') {\r\n      // Handle special filters\r\n      if (currentFilter === 'overdue') {\r\n        // Get all pending/assigned questions and filter by SLA breach\r\n        questions = await questionsService.getAll();\r\n        questions = questions.filter(q =>\r\n          q.sla_breached === true ||\r\n          (q.status !== 'resolved' && q.status !== 'dismissed' && isOverdue(q))\r\n        );\r\n      } else if (currentFilter === 'critical') {\r\n        // Filter by critical priority\r\n        questions = await questionsService.getAll();\r\n        questions = questions.filter(q => q.priority === 'critical' && q.status !== 'resolved' && q.status !== 'dismissed');\r\n      } else if (currentFilter === 'all') {\r\n        // \"All\" means all ACTIVE questions - exclude dismissed/resolved\r\n        questions = await questionsService.getAll();\r\n        questions = questions.filter(q => q.status !== 'dismissed' && q.status !== 'resolved' && q.status !== 'closed');\r\n      } else if (currentFilter === 'dismissed') {\r\n        // Specifically show dismissed questions\r\n        questions = await questionsService.getAll();\r\n        questions = questions.filter(q => q.status === 'dismissed');\r\n      } else if (currentFilter === 'resolved') {\r\n        // Specifically show resolved/answered questions\r\n        questions = await questionsService.getAll();\r\n        questions = questions.filter(q => q.status === 'resolved' || q.status === 'answered');\r\n      } else {\r\n        // Filter by specific status (pending, assigned, etc.)\r\n        questions = await questionsService.getAll();\r\n        questions = questions.filter(q => q.status === currentFilter);\r\n      }\r\n      renderByStatus(content, questions, props);\r\n    } else if (currentView === 'person') {\r\n      const grouped = await questionsService.getByPerson();\r\n      renderGrouped(content, grouped, props);\r\n    } else if (currentView === 'team') {\r\n      const grouped = await questionsService.getByTeam();\r\n      renderGrouped(content, grouped, props);\r\n    }\r\n\r\n    // Update store\r\n    if (currentView === 'status') {\r\n      dataStore.setQuestions(questions as unknown as []);\r\n    }\r\n\r\n    updateCount(panel);\r\n  } catch (error) {\r\n    content.innerHTML = '<div class=\"error\">Failed to load questions</div>';\r\n  }\r\n}\r\n\r\n/**\r\n * Check if a question is overdue based on SLA\r\n */\r\nfunction isOverdue(question: Question): boolean {\r\n  if (!question.created_at) return false;\r\n  const slaHours = question.sla_hours || 168; // 7 days default\r\n  const created = new Date(question.created_at);\r\n  const deadline = new Date(created.getTime() + slaHours * 60 * 60 * 1000);\r\n  return new Date() > deadline;\r\n}\r\n\r\n/**\r\n * Render questions by status\r\n */\r\nfunction renderByStatus(container: HTMLElement, questions: Question[], props: QuestionsPanelProps): void {\r\n  if (questions.length === 0) {\r\n    container.innerHTML = `\r\n      <div class=\"empty-state\">\r\n        <p>No questions found</p>\r\n        <button class=\"btn btn-primary\" id=\"empty-add-btn\">Add Question</button>\r\n      </div>\r\n    `;\r\n    const addBtn = container.querySelector('#empty-add-btn');\r\n    if (addBtn) {\r\n      on(addBtn as HTMLElement, 'click', () => {\r\n        showQuestionModal({ mode: 'create' });\r\n      });\r\n    }\r\n    return;\r\n  }\r\n\r\n  container.innerHTML = questions.map(q => createQuestionCard(q)).join('');\r\n  bindCardEvents(container, questions, props);\r\n}\r\n\r\n/**\r\n * Render grouped questions\r\n */\r\nfunction renderGrouped(\r\n  container: HTMLElement,\r\n  grouped: Record<string, Question[]>,\r\n  props: QuestionsPanelProps\r\n): void {\r\n  const groups = Object.entries(grouped);\r\n\r\n  if (groups.length === 0) {\r\n    container.innerHTML = '<div class=\"empty-state\"><p>No questions found</p></div>';\r\n    return;\r\n  }\r\n\r\n  container.innerHTML = groups.map(([groupName, questions]) => `\r\n    <div class=\"question-group\">\r\n      <div class=\"group-header\">\r\n        <h3>${escapeHtml(groupName)}</h3>\r\n        <span class=\"group-count\">${questions.length}</span>\r\n      </div>\r\n      <div class=\"group-items\">\r\n        ${questions.map(q => createQuestionCard(q)).join('')}\r\n      </div>\r\n    </div>\r\n  `).join('');\r\n\r\n  // Flatten for event binding\r\n  const allQuestions = groups.flatMap(([, qs]) => qs);\r\n  bindCardEvents(container, allQuestions, props);\r\n}\r\n\r\n/**\r\n * Create question card HTML - SOTA Design\r\n */\r\nfunction createQuestionCard(question: Question): string {\r\n  const priorityClass = `priority-${question.priority}`;\r\n  const statusClass = `status-${question.status}`;\r\n  const slaBreached = question.sla_breached;\r\n  const autoDetected = question.answer_source === 'auto-detected';\r\n  const hasAnswer = !!question.answer;\r\n  const hasRequesterRole = !!question.requester_role;\r\n\r\n  // Get initials for avatar\r\n  const getInitials = (name: string): string => {\r\n    if (!name) return '?';\r\n    const parts = name.trim().split(/\\s+/);\r\n    return parts.length === 1\r\n      ? parts[0].substring(0, 2).toUpperCase()\r\n      : (parts[0][0] + parts[parts.length - 1][0]).toUpperCase();\r\n  };\r\n\r\n  // Build the card HTML\r\n  let html = `<div class=\"question-card-sota${slaBreached ? ' sla-breached' : ''}${hasAnswer ? ' has-answer' : ''}\" data-id=\"${question.id}\">`;\r\n\r\n  // Priority Bar\r\n  html += `<div class=\"card-priority-bar ${priorityClass}\"></div>`;\r\n\r\n  // Card Body\r\n  html += `<div class=\"card-body\">`;\r\n\r\n  // Top Row\r\n  html += `<div class=\"card-top-row\">`;\r\n  html += `<div class=\"card-badges\">`;\r\n  html += `<span class=\"priority-pill ${priorityClass}\">${question.priority}</span>`;\r\n  html += `<span class=\"status-pill ${statusClass}\">${question.status}</span>`;\r\n  if (slaBreached) html += `<span class=\"sla-pill\">SLA</span>`;\r\n  if (autoDetected) html += `<span class=\"auto-pill\">Answer Found</span>`;\r\n  if (question.follow_up_to) html += `<span class=\"followup-pill\">Follow-up</span>`;\r\n  html += `</div>`; // .card-badges\r\n  html += `<span class=\"card-timestamp\">${formatRelativeTime(question.created_at)}</span>`;\r\n  html += `</div>`; // .card-top-row\r\n\r\n  // Question Text\r\n  html += `<div class=\"card-question-text\">${escapeHtml(question.content)}</div>`;\r\n\r\n  // Bottom Row\r\n  html += `<div class=\"card-bottom-row\">`;\r\n\r\n  // Get contacts for photo lookup\r\n  const contacts = dataStore.getState().contacts || [];\r\n\r\n  // Helper to get photo URL\r\n  const getPhotoUrl = (name: string, contactId?: string): string | null => {\r\n    const contact = contactId\r\n      ? contacts.find((c: any) => c.id === contactId)\r\n      : contacts.find((c: any) => c.name === name);\r\n    return contact?.photoUrl || contact?.avatarUrl || contact?.photo_url || contact?.avatar_url || null;\r\n  };\r\n\r\n  // Helper to render avatar (photo or initials)\r\n  const renderAvatar = (name: string, photoUrl: string | null, cssClass: string): string => {\r\n    if (photoUrl) {\r\n      return `<div class=\"${cssClass}\"><img src=\"${photoUrl}\" alt=\"${escapeHtml(name)}\" onerror=\"this.parentElement.innerHTML='${getInitials(name)}'\"></div>`;\r\n    }\r\n    return `<div class=\"${cssClass}\">${getInitials(name)}</div>`;\r\n  };\r\n\r\n  // Left: Requester (who is asking) - shows avatar + name + role\r\n  html += `<div class=\"card-requester\">`;\r\n  if (hasRequesterRole) {\r\n    const requesterName = (question as any).requester_name || '';\r\n    const requesterRole = question.requester_role || '';\r\n    const requesterContactId = (question as any).requester_contact_id;\r\n    const requesterPhotoUrl = getPhotoUrl(requesterName, requesterContactId);\r\n\r\n    html += `<div class=\"requester-chip\">`;\r\n    html += renderAvatar(requesterName || requesterRole, requesterPhotoUrl, 'requester-avatar');\r\n    html += `<div class=\"requester-info\">`;\r\n    if (requesterName) {\r\n      html += `<span class=\"requester-name\">${escapeHtml(requesterName)}</span>`;\r\n    }\r\n    html += `<span class=\"requester-role\">${escapeHtml(requesterRole)}</span>`;\r\n    html += `</div>`;\r\n    html += `</div>`;\r\n  }\r\n  html += `</div>`; // .card-requester\r\n\r\n  // Right: Assignment (who should answer) - shows avatar + name\r\n  html += `<div class=\"card-assignment\">`;\r\n  if (question.assigned_to) {\r\n    const assigneePhotoUrl = getPhotoUrl(question.assigned_to);\r\n\r\n    html += `<div class=\"assignee-chip\">`;\r\n    html += renderAvatar(question.assigned_to, assigneePhotoUrl, 'assignee-avatar');\r\n    html += `<div class=\"assignee-info\">`;\r\n    html += `<span class=\"assignee-name\">${escapeHtml(question.assigned_to)}</span>`;\r\n    if (hasAnswer) html += `<span class=\"answered-badge\">Answered</span>`;\r\n    html += `</div>`;\r\n    html += `</div>`;\r\n  } else {\r\n    html += `<div class=\"unassigned-chip\">`;\r\n    html += `<span>Unassigned</span>`;\r\n    html += `</div>`;\r\n  }\r\n  html += `</div>`; // .card-assignment\r\n\r\n  html += `</div>`; // .card-bottom-row\r\n  html += `</div>`; // .card-body\r\n  html += `</div>`; // .question-card-sota\r\n\r\n  return html;\r\n}\r\n\r\n/**\r\n * Bind card click events\r\n */\r\nfunction bindCardEvents(container: HTMLElement, questions: Question[], props: QuestionsPanelProps): void {\r\n  container.querySelectorAll('.question-card-sota').forEach(card => {\r\n    on(card as HTMLElement, 'click', () => {\r\n      const id = card.getAttribute('data-id');\r\n      const question = questions.find(q => String(q.id) === id);\r\n      if (question) {\r\n        if (props.onQuestionClick) {\r\n          props.onQuestionClick(question);\r\n        } else if (props.useDetailView && props.containerElement) {\r\n          // Replace panel with detail view\r\n          showQuestionDetailView(question, props);\r\n        } else {\r\n          // Fallback to modal\r\n          showQuestionModal({\r\n            mode: 'view',\r\n            question,\r\n            onSave: () => loadQuestions(container.closest('.questions-panel') as HTMLElement, props),\r\n          });\r\n        }\r\n      }\r\n    });\r\n  });\r\n}\r\n\r\n/**\r\n * Show question detail view (replaces panel content)\r\n */\r\nfunction showQuestionDetailView(question: Question, props: QuestionsPanelProps): void {\r\n  const containerEl = props.containerElement;\r\n  if (!containerEl) return;\r\n\r\n  // Store current panel content for restoration\r\n  const panelContent = containerEl.innerHTML;\r\n\r\n  // Create detail view\r\n  const detailView = createQuestionDetailView({\r\n    question,\r\n    onClose: () => {\r\n      // Restore panel content\r\n      containerEl.innerHTML = panelContent;\r\n      // Re-initialize the panel\r\n      const panel = containerEl.querySelector('.questions-panel');\r\n      if (panel) {\r\n        loadQuestions(panel as HTMLElement, props);\r\n      }\r\n    },\r\n    onUpdate: (updatedQuestion) => {\r\n      // If question was dismissed/resolved, close detail view and refresh list\r\n      if (updatedQuestion.status === 'dismissed' || updatedQuestion.status === 'resolved' || updatedQuestion.status === 'closed') {\r\n        // Restore panel content and reload\r\n        containerEl.innerHTML = panelContent;\r\n        const panel = containerEl.querySelector('.questions-panel');\r\n        if (panel) {\r\n          loadQuestions(panel as HTMLElement, props);\r\n        }\r\n        toast.info('Question updated - returning to list');\r\n      }\r\n    },\r\n    onNavigateToQuestion: async (questionId) => {\r\n      // Navigate to another question\r\n      try {\r\n        const questions = await questionsService.getAll();\r\n        const targetQuestion = questions.find(q => String(q.id) === questionId);\r\n        if (targetQuestion) {\r\n          showQuestionDetailView(targetQuestion, props);\r\n        }\r\n      } catch (e) {\r\n        toast.error('Failed to load question');\r\n      }\r\n    }\r\n  });\r\n\r\n  // Replace content with detail view\r\n  containerEl.innerHTML = '';\r\n  containerEl.appendChild(detailView);\r\n}\r\n\r\n/**\r\n * Show AI-powered generate questions dialog (SOTA version)\r\n * Uses the universal modal-sota.css system\r\n */\r\nasync function showGenerateForTeamDialog(panel: HTMLElement, props: QuestionsPanelProps): Promise<void> {\r\n  const modal = document.createElement('div');\r\n  modal.className = 'modal open';\r\n  modal.id = 'generate-ai-modal';\r\n  modal.innerHTML = `\r\n    <div class=\"modal-backdrop\"></div>\r\n    <div class=\"modal-container modal-sota modal-sota-relative\">\r\n      <!-- Header -->\r\n      <div class=\"sota-header header-primary\">\r\n        <div class=\"header-row\">\r\n          <div class=\"header-icon\">\r\n            <svg width=\"28\" height=\"28\" viewBox=\"0 0 24 24\" fill=\"none\" stroke=\"currentColor\" stroke-width=\"2\">\r\n              <path d=\"M12 2a2 2 0 0 1 2 2c0 .74-.4 1.39-1 1.73V7h1a7 7 0 0 1 7 7h1a1 1 0 0 1 1 1v3a1 1 0 0 1-1 1h-1v1a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2v-1H2a1 1 0 0 1-1-1v-3a1 1 0 0 1 1-1h1a7 7 0 0 1 7-7h1V5.73c-.6-.34-1-.99-1-1.73a2 2 0 0 1 2-2z\"/>\r\n              <circle cx=\"7.5\" cy=\"14.5\" r=\"1.5\"/><circle cx=\"16.5\" cy=\"14.5\" r=\"1.5\"/>\r\n            </svg>\r\n          </div>\r\n          <div class=\"header-text\">\r\n            <h2>AI Question Generator</h2>\r\n            <p>Generate contextual questions for your project team</p>\r\n          </div>\r\n        </div>\r\n        <button class=\"header-close\" id=\"close-modal\">\r\n          <svg width=\"18\" height=\"18\" viewBox=\"0 0 24 24\" fill=\"none\" stroke=\"currentColor\" stroke-width=\"2\">\r\n            <line x1=\"18\" y1=\"6\" x2=\"6\" y2=\"18\"/><line x1=\"6\" y1=\"6\" x2=\"18\" y2=\"18\"/>\r\n          </svg>\r\n        </button>\r\n      </div>\r\n\r\n      <!-- Tabs -->\r\n      <div class=\"sota-tabs\">\r\n        <button class=\"sota-tab active\" data-source=\"team\">\r\n          <span class=\"tab-icon\"></span>\r\n          <span>Team Members</span>\r\n        </button>\r\n        <button class=\"sota-tab\" data-source=\"contacts\">\r\n          <span class=\"tab-icon\"></span>\r\n          <span>Project Contacts</span>\r\n        </button>\r\n      </div>\r\n\r\n      <!-- Body -->\r\n      <div class=\"sota-body\">\r\n        <!-- Section: Roles -->\r\n        <div class=\"sota-section\">\r\n          <div class=\"section-title\">\r\n            <span class=\"title-icon\"></span>\r\n            <span>Select a Role</span>\r\n          </div>\r\n          <div id=\"roles-grid\" class=\"sota-grid\">\r\n            <div class=\"sota-loading\">\r\n              <div class=\"spinner-ring\"></div>\r\n              <p>Loading roles...</p>\r\n            </div>\r\n          </div>\r\n        </div>\r\n\r\n        <!-- Section: Configuration (hidden until role selected) -->\r\n        <div class=\"sota-section hidden\" id=\"config-section\">\r\n          <div id=\"selected-badge\"></div>\r\n          \r\n          <div class=\"config-row\">\r\n            <label>Questions to generate</label>\r\n            <div class=\"config-buttons\">\r\n              <button class=\"config-btn active\" data-count=\"auto\" title=\"AI determines optimal count\"> Auto</button>\r\n              <button class=\"config-btn\" data-count=\"3\">3</button>\r\n              <button class=\"config-btn\" data-count=\"5\">5</button>\r\n              <button class=\"config-btn\" data-count=\"8\">8</button>\r\n            </div>\r\n          </div>\r\n\r\n          <label class=\"toggle-row\">\r\n            <input type=\"checkbox\" id=\"use-context\" checked>\r\n            <span class=\"toggle-track\"><span class=\"toggle-thumb\"></span></span>\r\n            <span>Use project context (facts, documents)</span>\r\n          </label>\r\n          \r\n          <label class=\"toggle-row\">\r\n            <input type=\"checkbox\" id=\"skip-dupes\" checked>\r\n            <span class=\"toggle-track\"><span class=\"toggle-thumb\"></span></span>\r\n            <span>Skip duplicate questions</span>\r\n          </label>\r\n\r\n          <button class=\"sota-btn-primary sota-btn-mt\" id=\"btn-generate\">\r\n            <svg width=\"20\" height=\"20\" viewBox=\"0 0 24 24\" fill=\"none\" stroke=\"currentColor\" stroke-width=\"2\">\r\n              <polygon points=\"13 2 3 14 12 14 11 22 21 10 12 10 13 2\"/>\r\n            </svg>\r\n            Generate Questions\r\n          </button>\r\n        </div>\r\n      </div>\r\n\r\n      <!-- Overlay for generation -->\r\n      <div class=\"sota-overlay hidden\" id=\"gen-overlay\">\r\n        <div id=\"gen-content\">\r\n          <div class=\"overlay-spinner\"></div>\r\n          <h4 class=\"overlay-title\">Generating questions...</h4>\r\n          <p class=\"overlay-subtitle\">AI is analyzing your project context</p>\r\n        </div>\r\n      </div>\r\n    </div>\r\n  `;\r\n\r\n  document.body.appendChild(modal);\r\n\r\n  // State\r\n  type RoleData = { role: string; rolePrompt?: string; members: Array<{ id: string; name: string; photoUrl?: string; email?: string }> };\r\n  let currentSource: 'team' | 'contacts' = 'team';\r\n  let selectedRole: RoleData | null = null;\r\n  let allRoles: RoleData[] = [];\r\n  let questionCount: number | 'auto' = 'auto';\r\n\r\n  // Elements\r\n  const rolesGrid = modal.querySelector('#roles-grid') as HTMLElement;\r\n  const configSection = modal.querySelector('#config-section') as HTMLElement;\r\n  const selectedBadge = modal.querySelector('#selected-badge') as HTMLElement;\r\n  const genOverlay = modal.querySelector('#gen-overlay') as HTMLElement;\r\n  const genContent = modal.querySelector('#gen-content') as HTMLElement;\r\n\r\n  // Helpers\r\n  const getInitials = (name: string) => {\r\n    if (!name) return '?';\r\n    return name.split(' ').map(n => n[0]).join('').substring(0, 2).toUpperCase();\r\n  };\r\n\r\n  const getRoleIcon = (role: string): string => {\r\n    const r = role.toLowerCase();\r\n    if (r.includes('analyst') || r.includes('data')) return '';\r\n    if (r.includes('manager') || r.includes('lead')) return '';\r\n    if (r.includes('developer') || r.includes('engineer')) return '';\r\n    if (r.includes('design') || r.includes('ux')) return '';\r\n    if (r.includes('product') || r.includes('owner')) return '';\r\n    if (r.includes('qa') || r.includes('test')) return '';\r\n    if (r.includes('support') || r.includes('success')) return '';\r\n    if (r.includes('sales') || r.includes('commercial')) return '';\r\n    if (r.includes('marketing')) return '';\r\n    if (r.includes('security')) return '';\r\n    if (r.includes('devops') || r.includes('infra')) return '';\r\n    if (r.includes('legal')) return '';\r\n    return '';\r\n  };\r\n\r\n  // Load roles based on source\r\n  const loadRoles = async (source: 'team' | 'contacts') => {\r\n    rolesGrid.innerHTML = '<div class=\"sota-loading\"><div class=\"spinner-ring\"></div><p>Loading roles...</p></div>';\r\n    configSection.classList.add('hidden');\r\n    selectedRole = null;\r\n\r\n    try {\r\n      let roles: RoleData[] = [];\r\n\r\n      if (source === 'team') {\r\n        const res = await http.get<{ roles: RoleData[] }>('/api/questions/team-roles');\r\n        roles = res.data.roles || [];\r\n      } else {\r\n        // Load from contacts\r\n        const res = await http.get<{ contacts: Array<{ id: string; name: string; role?: string; photo_url?: string; email?: string }> }>('/api/contacts');\r\n        const contacts = res.data.contacts || [];\r\n\r\n        // Group by role\r\n        const roleMap: Record<string, RoleData> = {};\r\n        for (const c of contacts) {\r\n          if (!c.role) continue;\r\n          if (!roleMap[c.role]) {\r\n            roleMap[c.role] = { role: c.role, members: [] };\r\n          }\r\n          roleMap[c.role].members.push({\r\n            id: c.id,\r\n            name: c.name,\r\n            photoUrl: c.photo_url,\r\n            email: c.email\r\n          });\r\n        }\r\n        roles = Object.values(roleMap);\r\n      }\r\n\r\n      allRoles = roles;\r\n\r\n      if (roles.length === 0) {\r\n        rolesGrid.innerHTML = `\r\n          <div class=\"sota-empty sota-empty-full\">\r\n            <div class=\"empty-icon\">${source === 'team' ? '' : ''}</div>\r\n            <h4>No ${source === 'team' ? 'Team Members' : 'Contacts'} with Roles</h4>\r\n            <p>${source === 'team'\r\n            ? 'Add team members with roles in Project Settings'\r\n            : 'Add contacts with roles to this project'}</p>\r\n          </div>\r\n        `;\r\n        return;\r\n      }\r\n\r\n      rolesGrid.innerHTML = roles.map((r, idx) => `\r\n        <div class=\"sota-card\" data-idx=\"${idx}\">\r\n          <div class=\"card-icon\">${getRoleIcon(r.role)}</div>\r\n          <div class=\"card-title\">${escapeHtml(r.role)}</div>\r\n          <div class=\"card-avatars\">\r\n            ${r.members.slice(0, 3).map(m => `\r\n              <div class=\"mini-avatar\" title=\"${escapeHtml(m.name)}\">\r\n                ${m.photoUrl\r\n          ? `<img src=\"${m.photoUrl}\" alt=\"\" class=\"mini-avatar-img\" onerror=\"this.classList.add('hidden');this.nextElementSibling.classList.remove('hidden')\">`\r\n          : ''}\r\n                <span class=\"avatar-fallback${m.photoUrl ? ' hidden' : ''}\">${getInitials(m.name)}</span>\r\n              </div>\r\n            `).join('')}\r\n            ${r.members.length > 3 ? `<div class=\"mini-avatar more\">+${r.members.length - 3}</div>` : ''}\r\n          </div>\r\n          <div class=\"card-subtitle\">${r.members.map(m => m.name).slice(0, 2).join(', ')}${r.members.length > 2 ? '...' : ''}</div>\r\n          <div class=\"card-badge\">${r.members.length}</div>\r\n        </div>\r\n      `).join('');\r\n\r\n      // Bind clicks\r\n      rolesGrid.querySelectorAll('.sota-card').forEach(card => {\r\n        card.addEventListener('click', () => {\r\n          rolesGrid.querySelectorAll('.sota-card').forEach(c => c.classList.remove('selected'));\r\n          card.classList.add('selected');\r\n\r\n          const idx = parseInt(card.getAttribute('data-idx') || '0', 10);\r\n          selectedRole = allRoles[idx];\r\n          showConfig();\r\n        });\r\n      });\r\n\r\n    } catch (err) {\r\n      rolesGrid.innerHTML = `\r\n        <div class=\"sota-empty sota-empty-full\">\r\n          <div class=\"empty-icon\"></div>\r\n          <h4>Failed to Load</h4>\r\n          <p>Could not fetch roles. Please try again.</p>\r\n          <button class=\"sota-btn-primary sota-btn-retry\" id=\"retry-load\">Retry</button>\r\n        </div>\r\n      `;\r\n      modal.querySelector('#retry-load')?.addEventListener('click', () => loadRoles(source));\r\n    }\r\n  };\r\n\r\n  // Show config panel\r\n  const showConfig = () => {\r\n    if (!selectedRole) return;\r\n\r\n    configSection.classList.remove('hidden');\r\n    selectedBadge.innerHTML = `\r\n      <div class=\"selected-badge\">\r\n        <span class=\"badge-icon\">${getRoleIcon(selectedRole.role)}</span>\r\n        <div class=\"badge-info\">\r\n          <strong>${escapeHtml(selectedRole.role)}</strong>\r\n          <span>${selectedRole.members.map(m => m.name).join(', ')}</span>\r\n        </div>\r\n        <button class=\"badge-clear\" id=\"clear-selection\"></button>\r\n      </div>\r\n    `;\r\n\r\n    modal.querySelector('#clear-selection')?.addEventListener('click', () => {\r\n      selectedRole = null;\r\n      configSection.classList.add('hidden');\r\n      rolesGrid.querySelectorAll('.sota-card').forEach(c => c.classList.remove('selected'));\r\n    });\r\n  };\r\n\r\n  // Generate questions\r\n  const generateQuestions = async () => {\r\n    if (!selectedRole) return;\r\n\r\n    genOverlay.classList.remove('hidden');\r\n\r\n    try {\r\n      const res = await http.post<{\r\n        generated: number;\r\n        skipped: number;\r\n        questions: Array<{ content: string; priority: string; requester_role: string }>;\r\n      }>('/api/questions/generate-ai', {\r\n        role: selectedRole.role,\r\n        memberIds: selectedRole.members.map(m => m.id),\r\n        count: questionCount,\r\n        includeContext: (modal.querySelector('#use-context') as HTMLInputElement)?.checked ?? true,\r\n        skipDuplicates: (modal.querySelector('#skip-dupes') as HTMLInputElement)?.checked ?? true\r\n      });\r\n\r\n      const q = res.data.questions || [];\r\n\r\n      genContent.innerHTML = `\r\n        <div class=\"sota-success\">\r\n          <div class=\"success-icon\"></div>\r\n          <h4>${res.data.generated} Questions Generated</h4>\r\n          <p>${res.data.skipped > 0 ? `${res.data.skipped} duplicates skipped` : 'All questions created successfully'}</p>\r\n        </div>\r\n        <div class=\"results-list\">\r\n          ${q.slice(0, 5).map(item => `\r\n            <div class=\"result-row\">\r\n              <span class=\"result-badge ${item.priority}\">${item.priority}</span>\r\n              <span class=\"result-text\">${escapeHtml(item.content.length > 70 ? item.content.substring(0, 70) + '...' : item.content)}</span>\r\n            </div>\r\n          `).join('')}\r\n          ${q.length > 5 ? `<p class=\"sota-more-hint\">+ ${q.length - 5} more questions</p>` : ''}\r\n        </div>\r\n        <p class=\"sota-questions-footer\">\r\n           Questions from <strong>${selectedRole?.role}</strong> perspective<br>\r\n          <span class=\"sota-questions-footer-muted\">Use AI Suggest on each question to find who should answer</span>\r\n        </p>\r\n        <button class=\"sota-btn-primary\" id=\"btn-done\">Done</button>\r\n      `;\r\n\r\n      modal.querySelector('#btn-done')?.addEventListener('click', () => {\r\n        modal.remove();\r\n        loadQuestions(panel, props);\r\n      });\r\n\r\n    } catch (err) {\r\n      genContent.innerHTML = `\r\n        <div class=\"sota-error\">\r\n          <div class=\"error-icon\"></div>\r\n          <h4>Generation Failed</h4>\r\n          <p>Something went wrong. Please try again.</p>\r\n          <button class=\"sota-btn-primary sota-btn-retry sota-btn-retry-mt\" id=\"retry-gen\">Retry</button>\r\n        </div>\r\n      `;\r\n      modal.querySelector('#retry-gen')?.addEventListener('click', generateQuestions);\r\n    }\r\n  };\r\n\r\n  // Bind events\r\n  modal.querySelector('#close-modal')?.addEventListener('click', () => modal.remove());\r\n  modal.querySelector('.modal-backdrop')?.addEventListener('click', () => modal.remove());\r\n\r\n  // Source tabs\r\n  modal.querySelectorAll('.sota-tab').forEach(tab => {\r\n    tab.addEventListener('click', () => {\r\n      modal.querySelectorAll('.sota-tab').forEach(t => t.classList.remove('active'));\r\n      tab.classList.add('active');\r\n      currentSource = (tab.getAttribute('data-source') as 'team' | 'contacts') || 'team';\r\n      loadRoles(currentSource);\r\n    });\r\n  });\r\n\r\n  // Count buttons\r\n  modal.querySelectorAll('.config-btn').forEach(btn => {\r\n    btn.addEventListener('click', () => {\r\n      modal.querySelectorAll('.config-btn').forEach(b => b.classList.remove('active'));\r\n      btn.classList.add('active');\r\n      const countVal = btn.getAttribute('data-count') || 'auto';\r\n      questionCount = countVal === 'auto' ? 'auto' : parseInt(countVal, 10);\r\n    });\r\n  });\r\n\r\n  // Generate button\r\n  modal.querySelector('#btn-generate')?.addEventListener('click', generateQuestions);\r\n\r\n  // Initial load\r\n  loadRoles('team');\r\n}\r\n\r\n/**\r\n * Update count badge\r\n */\r\nfunction updateCount(panel: HTMLElement): void {\r\n  const countEl = panel.querySelector('#questions-count');\r\n  if (countEl) {\r\n    const questions = dataStore.getState().questions;\r\n    countEl.textContent = String(questions.length);\r\n  }\r\n}\r\n\r\n/**\r\n * Escape HTML\r\n */\r\nfunction escapeHtml(text: string): string {\r\n  const div = document.createElement('div');\r\n  div.textContent = text;\r\n  return div.innerHTML;\r\n}\r\n\r\nexport default createQuestionsPanel;\r\n","/**\n * Risk Modal Component\n * Create, view and edit risks\n */\n\nimport { createElement, on } from '@lib/dom';\nimport { createModal, openModal, closeModal } from '@components/Modal';\nimport { Risk } from '@stores/data';\nimport { http } from '@services/api';\nimport { toast } from '@services/toast';\nimport { formatRelativeTime } from '@lib/format';\nimport { risksService } from '@services/risks';\n\nconst MODAL_ID = 'risk-modal';\n\nexport interface RiskModalProps {\n  mode: 'view' | 'edit' | 'create';\n  risk?: Risk;\n  onSave?: (risk: Risk) => void;\n  onDelete?: (riskId: string) => void;\n}\n\n/**\n * Show risk modal\n */\nexport function showRiskModal(props: RiskModalProps): void {\n  const { mode, risk, onSave, onDelete } = props;\n  const isEdit = mode === 'edit' && risk?.id;\n  const isView = mode === 'view';\n\n  // Remove existing modal\n  const existing = document.querySelector(`[data-modal-id=\"${MODAL_ID}\"]`);\n  if (existing) existing.remove();\n\n  const content = createElement('div', { className: 'risk-modal-content' });\n\n  const riskDesc = risk?.description ?? (risk as { content?: string })?.content ?? '';\n  const riskProb = risk?.probability ?? (risk as { likelihood?: string })?.likelihood ?? 'medium';\n  const riskCreated = risk?.createdAt ?? (risk as { created_at?: string })?.created_at ?? '';\n\n  if (isView && risk) {\n    content.innerHTML = `\n      <div class=\"risk-view\">\n        <div class=\"risk-meta\">\n          <span class=\"impact-badge impact-${risk.impact}\">${risk.impact} impact</span>\n          <span class=\"probability-badge\">${riskProb} probability</span>\n          <span class=\"status-badge ${risk.status}\">${risk.status}</span>\n        </div>\n        \n        <div class=\"risk-description-large\">\n          ${escapeHtml(riskDesc)}\n        </div>\n        \n        ${risk.mitigation ? `\n          <div class=\"risk-mitigation-section\">\n            <h4>Mitigation Strategy</h4>\n            <p>${escapeHtml(risk.mitigation)}</p>\n          </div>\n        ` : ''}\n        \n        <div class=\"risk-date\">Created ${formatRelativeTime(riskCreated)}</div>\n      </div>\n    `;\n  } else {\n    const riskOwner = risk?.owner ?? '';\n    content.innerHTML = `\n      <form id=\"risk-form\" class=\"risk-form\">\n        <div class=\"form-group gm-flex gm-flex-center gm-gap-3 gm-flex-wrap\">\n          <label for=\"risk-description\" class=\"gm-mb-0\">Risk Description *</label>\n          <button type=\"button\" class=\"btn btn-secondary btn-sm\" id=\"risk-ai-suggest-btn\" title=\"Suggest owner and mitigation from description\"> AI suggest</button>\n        </div>\n        <div class=\"form-group\">\n          <textarea id=\"risk-description\" rows=\"3\" required \n                    placeholder=\"Describe the risk...\">${riskDesc}</textarea>\n        </div>\n        \n        <div class=\"form-row\">\n          <div class=\"form-group\">\n            <label for=\"risk-impact\">Impact</label>\n            <select id=\"risk-impact\">\n              <option value=\"low\" ${risk?.impact === 'low' ? 'selected' : ''}>Low</option>\n              <option value=\"medium\" ${risk?.impact === 'medium' || !risk ? 'selected' : ''}>Medium</option>\n              <option value=\"high\" ${risk?.impact === 'high' ? 'selected' : ''}>High</option>\n            </select>\n          </div>\n          \n          <div class=\"form-group\">\n            <label for=\"risk-probability\">Probability</label>\n            <select id=\"risk-probability\">\n              <option value=\"low\" ${riskProb === 'low' ? 'selected' : ''}>Low</option>\n              <option value=\"medium\" ${riskProb === 'medium' ? 'selected' : ''}>Medium</option>\n              <option value=\"high\" ${riskProb === 'high' ? 'selected' : ''}>High</option>\n            </select>\n          </div>\n        </div>\n        \n        <div class=\"form-group\">\n          <label for=\"risk-status\">Status</label>\n          <select id=\"risk-status\">\n            <option value=\"open\" ${risk?.status === 'open' || !risk ? 'selected' : ''}>Open</option>\n            <option value=\"mitigating\" ${risk?.status === 'mitigating' ? 'selected' : ''}>Mitigating</option>\n            <option value=\"mitigated\" ${risk?.status === 'mitigated' ? 'selected' : ''}>Mitigated</option>\n            <option value=\"accepted\" ${risk?.status === 'accepted' ? 'selected' : ''}>Accepted</option>\n            <option value=\"closed\" ${risk?.status === 'closed' ? 'selected' : ''}>Closed</option>\n          </select>\n        </div>\n        \n        <div class=\"form-group\">\n          <label for=\"risk-owner\">Owner</label>\n          <input type=\"text\" id=\"risk-owner\" class=\"form-input\" placeholder=\"Who owns this risk?\" value=\"${escapeHtml(riskOwner)}\">\n        </div>\n        \n        <div class=\"form-group\">\n          <label for=\"risk-mitigation\">Mitigation Strategy</label>\n          <textarea id=\"risk-mitigation\" rows=\"3\" \n                    placeholder=\"How will this risk be mitigated?\">${risk?.mitigation || ''}</textarea>\n        </div>\n      </form>\n    `;\n\n    const suggestBtn = content.querySelector('#risk-ai-suggest-btn');\n    if (suggestBtn) {\n      on(suggestBtn as HTMLElement, 'click', async () => {\n        const descEl = content.querySelector('#risk-description') as HTMLTextAreaElement;\n        const impactEl = content.querySelector('#risk-impact') as HTMLSelectElement;\n        const probEl = content.querySelector('#risk-probability') as HTMLSelectElement;\n        const contentText = descEl?.value?.trim() || '';\n        if (!contentText) {\n          toast.error('Enter a risk description first');\n          return;\n        }\n        (suggestBtn as HTMLButtonElement).disabled = true;\n        (suggestBtn as HTMLButtonElement).textContent = '';\n        try {\n          const result = await risksService.suggest({\n            content: contentText,\n            impact: impactEl?.value || 'medium',\n            likelihood: probEl?.value || 'medium',\n          });\n          const ownerEl = content.querySelector('#risk-owner') as HTMLInputElement;\n          const mitigationEl = content.querySelector('#risk-mitigation') as HTMLTextAreaElement;\n          if (ownerEl && result.suggested_owner) ownerEl.value = result.suggested_owner;\n          if (mitigationEl && result.suggested_mitigation) mitigationEl.value = result.suggested_mitigation;\n          toast.success('Owner and mitigation suggested');\n        } catch (e) {\n          toast.error((e as Error).message || 'AI suggest failed');\n        } finally {\n          (suggestBtn as HTMLButtonElement).disabled = false;\n          (suggestBtn as HTMLButtonElement).textContent = ' AI suggest';\n        }\n      });\n    }\n  }\n\n  // Footer\n  const footer = createElement('div', { className: 'modal-footer' });\n\n  if (isView) {\n    const editBtn = createElement('button', {\n      className: 'btn btn-primary',\n      textContent: 'Edit',\n    });\n\n    const closeBtn = createElement('button', {\n      className: 'btn btn-secondary',\n      textContent: 'Close',\n    });\n\n    on(closeBtn, 'click', () => closeModal(MODAL_ID));\n    on(editBtn, 'click', () => {\n      closeModal(MODAL_ID);\n      showRiskModal({ ...props, mode: 'edit' });\n    });\n\n    footer.appendChild(closeBtn);\n    footer.appendChild(editBtn);\n  } else {\n    const cancelBtn = createElement('button', {\n      className: 'btn btn-secondary',\n      textContent: 'Cancel',\n    });\n\n    const saveBtn = createElement('button', {\n      className: 'btn btn-primary',\n      textContent: isEdit ? 'Save Changes' : 'Create Risk',\n    });\n\n    on(cancelBtn, 'click', () => closeModal(MODAL_ID));\n\n    on(saveBtn, 'click', async () => {\n      const form = content.querySelector('#risk-form') as HTMLFormElement;\n      if (!form.checkValidity()) {\n        form.reportValidity();\n        return;\n      }\n\n      const getValue = (id: string) => (content.querySelector(`#${id}`) as HTMLInputElement | HTMLTextAreaElement | HTMLSelectElement)?.value.trim() || '';\n\n      const desc = getValue('risk-description');\n      const owner = getValue('risk-owner') || undefined;\n      const riskData: Risk & { content?: string; likelihood?: string; owner?: string } = {\n        id: risk?.id || `risk-${Date.now()}`,\n        description: desc,\n        content: desc,\n        impact: getValue('risk-impact') as Risk['impact'],\n        probability: getValue('risk-probability') as Risk['probability'],\n        likelihood: getValue('risk-probability') as 'low' | 'medium' | 'high',\n        status: getValue('risk-status') as Risk['status'],\n        mitigation: getValue('risk-mitigation') || undefined,\n        owner,\n        createdAt: risk?.createdAt ?? (risk as { created_at?: string })?.created_at ?? new Date().toISOString(),\n      };\n\n      saveBtn.disabled = true;\n      saveBtn.textContent = 'Saving...';\n\n      try {\n        if (isEdit) {\n          await http.put(`/api/risks/${risk!.id}`, { content: riskData.content ?? riskData.description, impact: riskData.impact, likelihood: riskData.likelihood ?? riskData.probability, mitigation: riskData.mitigation, status: riskData.status, owner: riskData.owner });\n          toast.success('Risk updated');\n        } else {\n          const response = await http.post<{ id: string; risk: Risk }>('/api/risks', { content: riskData.content ?? riskData.description, impact: riskData.impact, likelihood: riskData.likelihood ?? riskData.probability, mitigation: riskData.mitigation, status: riskData.status, owner: riskData.owner });\n          const created = response.data.risk;\n          if (created) riskData.id = created.id as string;\n          else riskData.id = response.data.id as string;\n          toast.success('Risk created');\n        }\n\n        onSave?.({ ...riskData, description: riskData.description ?? riskData.content, content: riskData.content ?? riskData.description } as Risk);\n        closeModal(MODAL_ID);\n      } catch {\n        // Error shown by API service\n      } finally {\n        saveBtn.disabled = false;\n        saveBtn.textContent = isEdit ? 'Save Changes' : 'Create Risk';\n      }\n    });\n\n    if (isEdit) {\n      const deleteBtn = createElement('button', {\n        className: 'btn btn-danger',\n        textContent: 'Delete',\n      });\n\n      on(deleteBtn, 'click', async () => {\n        const { confirm } = await import('@components/Modal');\n        const confirmed = await confirm(\n          'Are you sure you want to delete this risk?',\n          {\n            title: 'Delete Risk',\n            confirmText: 'Delete',\n            confirmClass: 'btn-danger',\n          }\n        );\n\n        if (confirmed) {\n          try {\n            await http.delete(`/api/risks/${risk!.id}`);\n            toast.success('Risk deleted');\n            onDelete?.(String(risk!.id));\n            closeModal(MODAL_ID);\n          } catch {\n            // Error shown by API service\n          }\n        }\n      });\n\n      footer.appendChild(saveBtn);\n      footer.appendChild(cancelBtn);\n      footer.appendChild(deleteBtn);\n    } else {\n      footer.appendChild(saveBtn);\n      footer.appendChild(cancelBtn);\n    }\n  }\n\n  // Create modal\n  const modal = createModal({\n    id: MODAL_ID,\n    title: isView ? 'Risk Details' : (isEdit ? 'Edit Risk' : 'New Risk'),\n    content,\n    size: 'md',\n    footer,\n  });\n\n  document.body.appendChild(modal);\n  openModal(MODAL_ID);\n}\n\n/**\n * Escape HTML\n */\nfunction escapeHtml(text: string): string {\n  const div = document.createElement('div');\n  div.textContent = text;\n  return div.innerHTML;\n}\n\nexport default showRiskModal;\n","/**\r\n * Risk Detail View\r\n * Full-page view for risk details: content, impact, likelihood, mitigation, status, owner, source, timeline\r\n */\r\n\r\nimport { createElement, on } from '@lib/dom';\r\nimport { Risk, RiskEvent, RiskOwnerSuggestion, risksService } from '@services/risks';\r\nimport { contactsService, Contact } from '@services/contacts';\r\nimport { toast } from '@services/toast';\r\nimport { formatRelativeTime, formatDateTime } from '@lib/format';\r\n\r\nexport interface RiskDetailViewProps {\r\n  risk: Risk;\r\n  onClose: () => void;\r\n  onUpdate?: (risk: Risk) => void;\r\n}\r\n\r\nfunction escapeHtml(text: string): string {\r\n  const div = document.createElement('div');\r\n  div.textContent = text;\r\n  return div.innerHTML;\r\n}\r\n\r\nfunction formatDate(iso: string | undefined): string {\r\n  if (!iso) return '';\r\n  try {\r\n    return formatDateTime(iso);\r\n  } catch {\r\n    return iso;\r\n  }\r\n}\r\n\r\nfunction getScoreColor(score: number): string {\r\n  if (score >= 70) return 'var(--success, #4ecdc4)';\r\n  if (score >= 50) return 'var(--warning, #ffe66d)';\r\n  return 'var(--text-muted, #6a6a8a)';\r\n}\r\n\r\nfunction getInitials(name: string): string {\r\n  return name\r\n    .trim()\r\n    .split(/\\s+/)\r\n    .map((s) => s[0])\r\n    .join('')\r\n    .toUpperCase()\r\n    .substring(0, 2);\r\n}\r\n\r\nfunction getRiskEventIcon(eventType: string): string {\r\n  const icons: Record<string, string> = {\r\n    created: '',\r\n    updated: '',\r\n    deleted: '',\r\n    restored: '',\r\n  };\r\n  return icons[eventType] || '';\r\n}\r\n\r\nfunction getRiskEventDescription(ev: RiskEvent): string {\r\n  const data = ev.event_data || {};\r\n  const actor = ev.actor_name ? ` by ${ev.actor_name}` : '';\r\n\r\n  switch (ev.event_type) {\r\n    case 'created':\r\n      return `Created${actor}`;\r\n    case 'updated': {\r\n      const changes = (data.changes as Array<{ field: string; from: string; to: string }>) || [];\r\n      if (changes.length === 0) return `Updated${actor}`;\r\n      if (changes.length === 1) {\r\n        const c = changes[0];\r\n        const toStr = String(c.to).trim() ? c.to : '';\r\n        const fromStr = String(c.from).trim() ? c.from : '';\r\n        return `${c.field} changed: ${fromStr}  ${toStr}${actor}`;\r\n      }\r\n      return `${changes.map((c) => `${c.field}: ${c.from || ''}  ${c.to || ''}`).join('; ')}${actor}`;\r\n    }\r\n    case 'deleted':\r\n      return `Deleted${data.reason ? ` (${data.reason})` : ''}${actor}`;\r\n    case 'restored':\r\n      return `Restored${actor}`;\r\n    default:\r\n      return ev.event_type;\r\n  }\r\n}\r\n\r\nexport function createRiskDetailView(props: RiskDetailViewProps): HTMLElement {\r\n  const { risk, onClose, onUpdate } = props;\r\n\r\n  const container = createElement('div', { className: 'risk-detail-view question-detail-view' });\r\n\r\n  container.innerHTML = `\r\n    <div class=\"question-detail-header risk-detail-header\">\r\n      <div class=\"breadcrumb\">\r\n        <a href=\"#\" class=\"breadcrumb-link\" id=\"back-to-list\">Risks</a>\r\n        <span class=\"breadcrumb-separator\"></span>\r\n        <span class=\"breadcrumb-current\">Risk #${String(risk.id).substring(0, 8)}</span>\r\n      </div>\r\n      <div class=\"header-actions\">\r\n        <span class=\"status-badge status-${(risk.status || 'open').toLowerCase()}\">${escapeHtml(String(risk.status))}</span>\r\n        <button class=\"btn btn-icon\" id=\"close-detail\" title=\"Close\"></button>\r\n      </div>\r\n    </div>\r\n\r\n    <div class=\"question-detail-content risk-detail-content\">\r\n      <div id=\"risk-view-content\">\r\n      <section class=\"detail-section risk-main\">\r\n        <div class=\"question-badges risk-badges\">\r\n          ${risk.impact ? `<span class=\"priority-pill impact-${risk.impact}\">${escapeHtml(risk.impact)} impact</span>` : ''}\r\n          ${risk.likelihood ? `<span class=\"priority-pill likelihood-${risk.likelihood}\">${escapeHtml(risk.likelihood)} likelihood</span>` : ''}\r\n          ${risk.generation_source ? `<span class=\"status-pill\">${escapeHtml(risk.generation_source)}</span>` : ''}\r\n          <span class=\"question-date risk-date\">Created ${formatRelativeTime(risk.created_at)}</span>\r\n        </div>\r\n        <h2 class=\"question-text risk-content-text\">${escapeHtml(risk.content)}</h2>\r\n      </section>\r\n\r\n      <div class=\"detail-columns\">\r\n        <div class=\"detail-column-left\">\r\n          <!-- Assignment (Owner) Section - SOTA (aligned with Questions) -->\r\n          <section class=\"detail-section\" id=\"risk-assignment-section\">\r\n            <div class=\"section-header-sota\">\r\n              <h3>\r\n                <svg width=\"20\" height=\"20\" fill=\"none\" viewBox=\"0 0 24 24\" stroke=\"currentColor\">\r\n                  <path stroke-linecap=\"round\" stroke-linejoin=\"round\" stroke-width=\"2\" d=\"M16 7a4 4 0 11-8 0 4 4 0 018 0zM12 14a7 7 0 00-7 7h14a7 7 0 00-7-7z\"/>\r\n                </svg>\r\n                Assignment\r\n                <span class=\"section-subtitle\">Who should own this risk?</span>\r\n              </h3>\r\n              <button type=\"button\" class=\"btn-ai-suggest\" id=\"risk-ai-suggest-btn\" title=\"Suggest owner and mitigation from risk content\">\r\n                <svg width=\"16\" height=\"16\" fill=\"none\" viewBox=\"0 0 24 24\" stroke=\"currentColor\"><path stroke-linecap=\"round\" stroke-linejoin=\"round\" stroke-width=\"2\" d=\"M13 10V3L4 14h7v7l9-11h-7z\"/></svg>\r\n                AI Suggest\r\n              </button>\r\n            </div>\r\n\r\n            <!-- Current Assignment (Owner) Display -->\r\n            <div id=\"risk-current-assignment\" class=\"current-assignment-card\">\r\n              ${risk.owner ? `\r\n                <div class=\"assigned-contact-display\">\r\n                  <div class=\"contact-avatar-lg\" id=\"risk-assigned-avatar\">${getInitials(risk.owner)}</div>\r\n                  <div class=\"contact-details\">\r\n                    <div class=\"contact-name-lg\">${escapeHtml(risk.owner)}</div>\r\n                    <div class=\"contact-role-sm\" id=\"risk-assigned-role\"></div>\r\n                  </div>\r\n                  <button class=\"btn-change-assignment\" id=\"risk-change-owner-btn\" type=\"button\">\r\n                    <svg width=\"14\" height=\"14\" fill=\"none\" viewBox=\"0 0 24 24\" stroke=\"currentColor\"><path stroke-linecap=\"round\" stroke-linejoin=\"round\" stroke-width=\"2\" d=\"M15.232 5.232l3.536 3.536m-2.036-5.036a2.5 2.5 0 113.536 3.536L6.5 21.036H3v-3.572L16.732 3.732z\"/></svg>\r\n                    Change\r\n                  </button>\r\n                </div>\r\n              ` : `\r\n                <div class=\"no-assignment\">\r\n                  <div class=\"no-assignment-icon\">\r\n                    <svg width=\"32\" height=\"32\" fill=\"none\" viewBox=\"0 0 24 24\" stroke=\"currentColor\"><path stroke-linecap=\"round\" stroke-linejoin=\"round\" stroke-width=\"1.5\" d=\"M18 9v3m0 0v3m0-3h3m-3 0h-3m-2-5a4 4 0 11-8 0 4 4 0 018 0zM3 20a6 6 0 0112 0v1H3v-1z\"/></svg>\r\n                  </div>\r\n                  <span>No one assigned</span>\r\n                  <p class=\"no-assignment-hint\">Use AI Suggest or choose manually</p>\r\n                  <button class=\"btn-assign-now\" id=\"risk-show-picker-btn\" type=\"button\">Choose Manually</button>\r\n                </div>\r\n              `}\r\n            </div>\r\n\r\n            <!-- Contact Picker (hidden by default) -->\r\n            <div id=\"risk-contact-picker\" class=\"contact-picker-sota hidden\">\r\n              <div class=\"picker-search\">\r\n                <svg width=\"16\" height=\"16\" fill=\"none\" viewBox=\"0 0 24 24\" stroke=\"currentColor\"><path stroke-linecap=\"round\" stroke-linejoin=\"round\" stroke-width=\"2\" d=\"M21 21l-6-6m2-5a7 7 0 11-14 0 7 7 0 0114 0z\"/></svg>\r\n                <input type=\"text\" id=\"risk-contact-search\" placeholder=\"Search contacts...\" autocomplete=\"off\">\r\n              </div>\r\n              <div id=\"risk-contact-list\" class=\"contact-list-grid\">Loading...</div>\r\n            </div>\r\n\r\n            <!-- AI Suggestions Panel -->\r\n            <div id=\"risk-suggestions-panel\" class=\"suggestions-panel-sota risk-suggestions-panel hidden\"></div>\r\n\r\n            <!-- Mitigation (below assignment) -->\r\n            <div class=\"risk-mitigation-block\">\r\n              <strong>Mitigation</strong>\r\n              <p id=\"risk-detail-mitigation\" class=\"risk-mitigation\">${risk.mitigation ? escapeHtml(risk.mitigation) : '<span class=\"text-muted\">No mitigation recorded</span>'}</p>\r\n            </div>\r\n          </section>\r\n\r\n          <section class=\"detail-section\">\r\n            <div class=\"section-header\">\r\n              <h3>Source</h3>\r\n            </div>\r\n            ${risk.source_file ? `<p class=\"source-file\">${escapeHtml(risk.source_file)}</p>` : ''}\r\n            ${risk.source_document_id ? `\r\n              <p class=\"source-doc\">\r\n                <a href=\"#\" class=\"doc-link\" data-document-id=\"${escapeHtml(String(risk.source_document_id))}\">View source document</a>\r\n              </p>\r\n            ` : ''}\r\n            ${!risk.source_file && !risk.source_document_id ? '<p class=\"text-muted\">No source recorded</p>' : ''}\r\n          </section>\r\n        </div>\r\n\r\n        <div class=\"detail-column-right\">\r\n          <section class=\"detail-section metadata-section\">\r\n            <h3>Metadata</h3>\r\n            <dl class=\"metadata-list\">\r\n              <dt>Created</dt>\r\n              <dd>${formatDate(risk.created_at)}</dd>\r\n              ${risk.updated_at ? `<dt>Updated</dt><dd>${formatDate(risk.updated_at)}</dd>` : ''}\r\n            </dl>\r\n          </section>\r\n\r\n          <section class=\"detail-section\" id=\"risk-timeline-section\">\r\n            <h3>Timeline</h3>\r\n            <div id=\"timeline-content\" class=\"timeline-content\">\r\n              <span class=\"text-muted\">Loading</span>\r\n            </div>\r\n          </section>\r\n        </div>\r\n      </div>\r\n\r\n      <div class=\"detail-actions\">\r\n        <button type=\"button\" class=\"btn btn-secondary\" id=\"edit-risk-btn\">Edit</button>\r\n        <button type=\"button\" class=\"btn btn-danger\" id=\"delete-risk-btn\">Delete</button>\r\n      </div>\r\n      </div>\r\n\r\n      <div id=\"risk-edit-form\" class=\"risk-detail-edit-form hidden\">\r\n        <form id=\"risk-inline-form\" class=\"risk-form\">\r\n          <div class=\"form-group\">\r\n            <div class=\"gm-flex gm-flex-center gm-justify-between gm-flex-wrap gm-gap-2 gm-mb-2\">\r\n              <label for=\"risk-edit-content\" class=\"gm-mb-0\">Risk description *</label>\r\n              <button type=\"button\" class=\"btn-ai-suggest btn-sm\" id=\"risk-edit-ai-suggest-btn\" title=\"Suggest owner and mitigation from description\">\r\n                <svg width=\"14\" height=\"14\" fill=\"none\" viewBox=\"0 0 24 24\" stroke=\"currentColor\"><path stroke-linecap=\"round\" stroke-linejoin=\"round\" stroke-width=\"2\" d=\"M13 10V3L4 14h7v7l9-11h-7z\"/></svg>\r\n                AI suggest\r\n              </button>\r\n            </div>\r\n            <textarea id=\"risk-edit-content\" rows=\"3\" required placeholder=\"Describe the risk...\">${escapeHtml(risk.content || '')}</textarea>\r\n          </div>\r\n          <div id=\"risk-edit-suggestions-panel\" class=\"suggestions-panel-sota risk-suggestions-panel hidden gm-mb-4\"></div>\r\n          <div class=\"form-row\">\r\n            <div class=\"form-group\">\r\n              <label for=\"risk-edit-impact\">Impact</label>\r\n              <select id=\"risk-edit-impact\">\r\n                <option value=\"low\" ${risk.impact === 'low' ? 'selected' : ''}>Low</option>\r\n                <option value=\"medium\" ${risk.impact === 'medium' || !risk.impact ? 'selected' : ''}>Medium</option>\r\n                <option value=\"high\" ${risk.impact === 'high' ? 'selected' : ''}>High</option>\r\n              </select>\r\n            </div>\r\n            <div class=\"form-group\">\r\n              <label for=\"risk-edit-likelihood\">Likelihood</label>\r\n              <select id=\"risk-edit-likelihood\">\r\n                <option value=\"low\" ${risk.likelihood === 'low' ? 'selected' : ''}>Low</option>\r\n                <option value=\"medium\" ${risk.likelihood === 'medium' || !risk.likelihood ? 'selected' : ''}>Medium</option>\r\n                <option value=\"high\" ${risk.likelihood === 'high' ? 'selected' : ''}>High</option>\r\n              </select>\r\n            </div>\r\n            <div class=\"form-group\">\r\n              <label for=\"risk-edit-status\">Status</label>\r\n              <select id=\"risk-edit-status\">\r\n                <option value=\"open\" ${risk.status === 'open' || !risk.status ? 'selected' : ''}>Open</option>\r\n                <option value=\"mitigating\" ${risk.status === 'mitigating' ? 'selected' : ''}>Mitigating</option>\r\n                <option value=\"mitigated\" ${risk.status === 'mitigated' ? 'selected' : ''}>Mitigated</option>\r\n                <option value=\"accepted\" ${risk.status === 'accepted' ? 'selected' : ''}>Accepted</option>\r\n                <option value=\"closed\" ${risk.status === 'closed' ? 'selected' : ''}>Closed</option>\r\n              </select>\r\n            </div>\r\n          </div>\r\n          <div class=\"form-group risk-owner-picker-wrap\">\r\n            <label>Owner</label>\r\n            <input type=\"hidden\" id=\"risk-edit-owner\" value=\"${escapeHtml(risk.owner || '')}\">\r\n            <div class=\"risk-owner-picker-trigger\" id=\"risk-owner-picker-trigger\" title=\"Click to select from project contacts\">\r\n              <span class=\"risk-owner-picker-value\" id=\"risk-owner-picker-value\">${risk.owner ? escapeHtml(risk.owner) : '<span class=\"text-muted\">Select owner...</span>'}</span>\r\n              <svg width=\"16\" height=\"16\" fill=\"none\" viewBox=\"0 0 24 24\" stroke=\"currentColor\"><path stroke-linecap=\"round\" stroke-linejoin=\"round\" stroke-width=\"2\" d=\"M19 9l-7 7-7-7\"/></svg>\r\n            </div>\r\n            <div id=\"risk-owner-picker-dropdown\" class=\"risk-owner-picker-dropdown hidden\">\r\n              <div class=\"risk-owner-picker-search\">\r\n                <input type=\"text\" id=\"risk-owner-picker-search\" placeholder=\"Search contacts...\" autocomplete=\"off\">\r\n              </div>\r\n              <div id=\"risk-owner-picker-list\" class=\"risk-owner-picker-list\">Loading...</div>\r\n            </div>\r\n          </div>\r\n          <div class=\"form-group\">\r\n            <label for=\"risk-edit-mitigation\">Mitigation strategy</label>\r\n            <textarea id=\"risk-edit-mitigation\" rows=\"3\" placeholder=\"How will this risk be mitigated?\">${escapeHtml(risk.mitigation || '')}</textarea>\r\n          </div>\r\n        </form>\r\n        <div class=\"detail-actions\">\r\n          <button type=\"button\" class=\"btn btn-primary\" id=\"risk-save-btn\">Save</button>\r\n          <button type=\"button\" class=\"btn btn-secondary\" id=\"risk-cancel-edit-btn\">Cancel</button>\r\n          <button type=\"button\" class=\"btn btn-danger\" id=\"risk-delete-in-edit-btn\">Delete</button>\r\n        </div>\r\n      </div>\r\n    </div>\r\n  `;\r\n\r\n  const backLink = container.querySelector('#back-to-list');\r\n  if (backLink) {\r\n    on(backLink as HTMLElement, 'click', (e) => {\r\n      e.preventDefault();\r\n      onClose();\r\n    });\r\n  }\r\n  const closeBtn = container.querySelector('#close-detail');\r\n  if (closeBtn) {\r\n    on(closeBtn as HTMLElement, 'click', onClose);\r\n  }\r\n\r\n  const viewContent = container.querySelector('#risk-view-content') as HTMLElement;\r\n  const editForm = container.querySelector('#risk-edit-form') as HTMLElement;\r\n\r\n  const editBtn = container.querySelector('#edit-risk-btn');\r\n  if (editBtn && viewContent && editForm) {\r\n    on(editBtn as HTMLElement, 'click', () => {\r\n      viewContent.classList.add('hidden');\r\n      editForm.classList.remove('hidden');\r\n    });\r\n  }\r\n\r\n  const cancelEditBtn = container.querySelector('#risk-cancel-edit-btn');\r\n  if (cancelEditBtn && viewContent && editForm) {\r\n    on(cancelEditBtn as HTMLElement, 'click', () => {\r\n      editForm.classList.add('hidden');\r\n      viewContent.classList.remove('hidden');\r\n    });\r\n  }\r\n\r\n  const saveBtn = container.querySelector('#risk-save-btn');\r\n  if (saveBtn && editForm && onUpdate) {\r\n    on(saveBtn as HTMLElement, 'click', async () => {\r\n      const form = container.querySelector('#risk-inline-form') as HTMLFormElement;\r\n      if (!form?.checkValidity()) {\r\n        form.reportValidity();\r\n        return;\r\n      }\r\n      const contentEl = container.querySelector('#risk-edit-content') as HTMLTextAreaElement;\r\n      const impactEl = container.querySelector('#risk-edit-impact') as HTMLSelectElement;\r\n      const likelihoodEl = container.querySelector('#risk-edit-likelihood') as HTMLSelectElement;\r\n      const statusEl = container.querySelector('#risk-edit-status') as HTMLSelectElement;\r\n      const ownerEl = container.querySelector('#risk-edit-owner') as HTMLInputElement;\r\n      const mitigationEl = container.querySelector('#risk-edit-mitigation') as HTMLTextAreaElement;\r\n      const content = contentEl?.value?.trim() || '';\r\n      if (!content) {\r\n        toast.error('Risk description is required');\r\n        return;\r\n      }\r\n      (saveBtn as HTMLButtonElement).disabled = true;\r\n      (saveBtn as HTMLButtonElement).textContent = 'Saving...';\r\n      try {\r\n        const updated = await risksService.update(risk.id, {\r\n          content,\r\n          impact: (impactEl?.value || 'medium') as Risk['impact'],\r\n          likelihood: (likelihoodEl?.value || 'medium') as Risk['likelihood'],\r\n          status: (statusEl?.value || 'open') as Risk['status'],\r\n          owner: ownerEl?.value?.trim() || undefined,\r\n          mitigation: mitigationEl?.value?.trim() || undefined,\r\n        });\r\n        toast.success('Risk updated');\r\n        onUpdate(updated);\r\n      } catch {\r\n        toast.error('Failed to save');\r\n      } finally {\r\n        (saveBtn as HTMLButtonElement).disabled = false;\r\n        (saveBtn as HTMLButtonElement).textContent = 'Save';\r\n      }\r\n    });\r\n  }\r\n\r\n  const deleteInEditBtn = container.querySelector('#risk-delete-in-edit-btn');\r\n  if (deleteInEditBtn) {\r\n    on(deleteInEditBtn as HTMLElement, 'click', async () => {\r\n      if (!confirm('Are you sure you want to delete this risk?')) return;\r\n      try {\r\n        await risksService.delete(risk.id);\r\n        toast.success('Risk deleted');\r\n        onClose();\r\n      } catch {\r\n        toast.error('Failed to delete');\r\n      }\r\n    });\r\n  }\r\n\r\n  // Owner contact picker in edit form (project contacts with cards)\r\n  const ownerPickerTrigger = container.querySelector('#risk-owner-picker-trigger');\r\n  const ownerPickerDropdown = container.querySelector('#risk-owner-picker-dropdown') as HTMLElement;\r\n  const ownerPickerValue = container.querySelector('#risk-owner-picker-value');\r\n  const ownerHiddenInput = container.querySelector('#risk-edit-owner') as HTMLInputElement;\r\n  const ownerPickerList = container.querySelector('#risk-owner-picker-list') as HTMLElement;\r\n  const ownerPickerSearch = container.querySelector('#risk-owner-picker-search') as HTMLInputElement;\r\n\r\n  if (ownerPickerTrigger && ownerPickerDropdown && ownerPickerList && ownerHiddenInput) {\r\n    let editFormContacts: Contact[] = [];\r\n    const renderOwnerPickerList = (filter = '') => {\r\n      const filtered = filter\r\n        ? editFormContacts.filter(\r\n          (c) =>\r\n            (c.name || '').toLowerCase().includes(filter.toLowerCase()) ||\r\n            (c.role || '').toLowerCase().includes(filter.toLowerCase())\r\n        )\r\n        : editFormContacts;\r\n      if (editFormContacts.length === 0) {\r\n        ownerPickerList.innerHTML = '<div class=\"empty-state\">Loading contacts...</div>';\r\n        return;\r\n      }\r\n      if (filtered.length === 0) {\r\n        ownerPickerList.innerHTML = '<div class=\"empty-state\">No contacts match</div>';\r\n        return;\r\n      }\r\n      ownerPickerList.innerHTML = filtered\r\n        .map((c) => {\r\n          const photoUrl = c.photoUrl || c.avatarUrl;\r\n          const selected = (ownerHiddenInput?.value || '').trim() === (c.name || '').trim();\r\n          return `\r\n            <div class=\"risk-owner-card-picker ${selected ? 'selected' : ''}\" data-contact-name=\"${escapeHtml(c.name || '')}\">\r\n              <div class=\"risk-owner-card-avatar\">${photoUrl ? `<img src=\"${escapeHtml(photoUrl)}\" alt=\"\" onerror=\"this.parentElement.innerHTML='${getInitials(c.name || '')}'\">` : getInitials(c.name || '')}</div>\r\n              <div class=\"risk-owner-card-info\">\r\n                <div class=\"risk-owner-card-name\">${escapeHtml(c.name || '')}</div>\r\n                ${c.role ? `<div class=\"risk-owner-card-role\">${escapeHtml(c.role)}</div>` : ''}\r\n              </div>\r\n            </div>\r\n          `;\r\n        })\r\n        .join('');\r\n      ownerPickerList.querySelectorAll('.risk-owner-card-picker').forEach((card) => {\r\n        on(card as HTMLElement, 'click', () => {\r\n          const name = card.getAttribute('data-contact-name') || '';\r\n          ownerHiddenInput.value = name;\r\n          if (ownerPickerValue) ownerPickerValue.innerHTML = name ? escapeHtml(name) : '<span class=\"text-muted\">Select owner...</span>';\r\n          ownerPickerDropdown.classList.add('hidden');\r\n        });\r\n      });\r\n    };\r\n    on(ownerPickerTrigger as HTMLElement, 'click', async (e) => {\r\n      e.stopPropagation();\r\n      const isOpen = !ownerPickerDropdown.classList.contains('hidden');\r\n      ownerPickerDropdown.classList.toggle('hidden', isOpen);\r\n      if (!isOpen && editFormContacts.length === 0) {\r\n        ownerPickerList.innerHTML = '<div class=\"empty-state\">Loading...</div>';\r\n        try {\r\n          const res = await contactsService.getAll();\r\n          editFormContacts = res?.contacts || [];\r\n          renderOwnerPickerList(ownerPickerSearch?.value || '');\r\n        } catch {\r\n          ownerPickerList.innerHTML = '<div class=\"empty-state\">Failed to load contacts</div>';\r\n        }\r\n      } else if (!isOpen) renderOwnerPickerList(ownerPickerSearch?.value || '');\r\n    });\r\n    if (ownerPickerSearch) {\r\n      ownerPickerSearch.addEventListener('input', () => renderOwnerPickerList(ownerPickerSearch.value));\r\n    }\r\n    document.addEventListener('click', (e) => {\r\n      const target = e.target as HTMLElement;\r\n      if (!target.closest('.risk-owner-picker-wrap') && !ownerPickerDropdown?.classList.contains('hidden')) {\r\n        ownerPickerDropdown.classList.add('hidden');\r\n      }\r\n    });\r\n  }\r\n\r\n  // AI suggest in edit form (fill owner + mitigation)\r\n  const editAiSuggestBtn = container.querySelector('#risk-edit-ai-suggest-btn');\r\n  const editSuggestionsPanel = container.querySelector('#risk-edit-suggestions-panel') as HTMLElement;\r\n  if (editAiSuggestBtn && editSuggestionsPanel) {\r\n    on(editAiSuggestBtn as HTMLElement, 'click', async () => {\r\n      const contentEl = container.querySelector('#risk-edit-content') as HTMLTextAreaElement;\r\n      const content = contentEl?.value?.trim() || '';\r\n      if (!content) {\r\n        toast.error('Enter a risk description first');\r\n        return;\r\n      }\r\n      const btn = editAiSuggestBtn as HTMLButtonElement;\r\n      btn.disabled = true;\r\n      btn.innerHTML = '<span class=\"spin\"></span> Analyzing...';\r\n      editSuggestionsPanel.classList.remove('hidden');\r\n      editSuggestionsPanel.innerHTML = '<div class=\"suggestions-loading\"><div class=\"loading-text\">AI is suggesting owners and mitigation...</div></div>';\r\n      try {\r\n        const [result, contactsRes] = await Promise.all([\r\n          risksService.suggest({ content, impact: (container.querySelector('#risk-edit-impact') as HTMLSelectElement)?.value || 'medium', likelihood: (container.querySelector('#risk-edit-likelihood') as HTMLSelectElement)?.value || 'medium' }),\r\n          contactsService.getAll(),\r\n        ]);\r\n        const contacts: Contact[] = contactsRes?.contacts || [];\r\n        const owners: RiskOwnerSuggestion[] = result.suggested_owners?.length ? result.suggested_owners : result.suggested_owner ? [{ name: result.suggested_owner, reason: '', score: 0 }] : [];\r\n        const mitigation = result.suggested_mitigation || '';\r\n        if (owners.length === 0 && !mitigation) {\r\n          editSuggestionsPanel.innerHTML = '<div class=\"no-suggestions\"><div class=\"no-suggestions-text\">No suggestions</div><button type=\"button\" class=\"btn-link\" id=\"risk-edit-hide-suggest-btn\">Close</button></div>';\r\n        } else {\r\n          editSuggestionsPanel.innerHTML = `\r\n            <div class=\"suggestions-header-sota\"><div class=\"ai-badge\"> AI Recommended</div></div>\r\n            ${owners.length > 0 ? `<div class=\"suggestions-list-sota\">${owners.map((s, i) => {\r\n            const contact = contacts.find((c) => (c.name || '').trim().toLowerCase() === (s.name || '').trim().toLowerCase());\r\n            const photoUrl = contact?.photoUrl || contact?.avatarUrl || (contact as { photo_url?: string })?.photo_url || (contact as { avatar_url?: string })?.avatar_url;\r\n            const roleOrReason = contact?.role ?? s.reason ?? '';\r\n            const score = s.score ?? 0;\r\n            const scoreColor = getScoreColor(score);\r\n            return `<div class=\"suggestion-card-sota risk-owner-card\" data-owner-name=\"${escapeHtml(s.name || '')}\">\r\n                <div class=\"suggestion-rank\">#${i + 1}</div>\r\n                <div class=\"suggestion-avatar-sota\">${photoUrl ? `<img src=\"${escapeHtml(photoUrl)}\" alt=\"\" onerror=\"this.parentElement.innerHTML='${getInitials(s.name)}'\">` : getInitials(s.name)}</div>\r\n                <div class=\"suggestion-info-sota\"><div class=\"suggestion-name-sota\">${escapeHtml(s.name || '')}</div>${roleOrReason ? `<div class=\"suggestion-reason-sota\">${escapeHtml(roleOrReason)}</div>` : ''}</div>\r\n                ${score > 0 ? `<div class=\"suggestion-score-sota\" style=\"--score-color: ${scoreColor}\"><div class=\"score-value\">${score}%</div></div>` : ''}\r\n                <button type=\"button\" class=\"btn-select-suggestion\">Assign</button>\r\n              </div>`;\r\n          }).join('')}</div>` : ''}\r\n            ${mitigation ? `<div class=\"risk-suggestion-card risk-mitigation-suggestion\"><strong>Suggested mitigation</strong><p class=\"risk-suggestion-mitigation\">${escapeHtml(mitigation)}</p><button type=\"button\" class=\"btn btn-secondary btn-sm\" id=\"risk-edit-apply-mitigation-btn\">Apply mitigation</button></div>` : ''}\r\n            <div class=\"suggestions-footer\"><button type=\"button\" class=\"btn-link\" id=\"risk-edit-hide-suggest-btn\">Close suggestions</button></div>\r\n          `;\r\n          editSuggestionsPanel.querySelectorAll('.risk-owner-card .btn-select-suggestion').forEach((assignBtn) => {\r\n            const card = (assignBtn as HTMLElement).closest('.risk-owner-card');\r\n            const name = card?.getAttribute('data-owner-name') || '';\r\n            if (!name) return;\r\n            on(assignBtn as HTMLElement, 'click', () => {\r\n              if (ownerHiddenInput) ownerHiddenInput.value = name;\r\n              if (ownerPickerValue) ownerPickerValue.innerHTML = escapeHtml(name);\r\n              editSuggestionsPanel.classList.add('hidden');\r\n              toast.success(`Owner set to ${name}`);\r\n            });\r\n          });\r\n          const applyMitigationBtn = editSuggestionsPanel.querySelector('#risk-edit-apply-mitigation-btn');\r\n          if (applyMitigationBtn && mitigation) {\r\n            on(applyMitigationBtn as HTMLElement, 'click', () => {\r\n              const mitigationEl = container.querySelector('#risk-edit-mitigation') as HTMLTextAreaElement;\r\n              if (mitigationEl) mitigationEl.value = mitigation;\r\n              toast.success('Mitigation applied');\r\n            });\r\n          }\r\n        }\r\n        const hideBtn = editSuggestionsPanel.querySelector('#risk-edit-hide-suggest-btn');\r\n        if (hideBtn) on(hideBtn as HTMLElement, 'click', () => { editSuggestionsPanel.classList.add('hidden'); });\r\n      } catch {\r\n        editSuggestionsPanel.innerHTML = '<div class=\"suggestions-error\">Failed to get suggestions. <button type=\"button\" class=\"btn-link\" id=\"risk-edit-hide-suggest-btn\">Close</button></div>';\r\n        const h = editSuggestionsPanel.querySelector('#risk-edit-hide-suggest-btn');\r\n        if (h) on(h as HTMLElement, 'click', () => { editSuggestionsPanel.classList.add('hidden'); });\r\n      } finally {\r\n        btn.disabled = false;\r\n        btn.innerHTML = '<svg width=\"14\" height=\"14\" fill=\"none\" viewBox=\"0 0 24 24\" stroke=\"currentColor\"><path stroke-linecap=\"round\" stroke-linejoin=\"round\" stroke-width=\"2\" d=\"M13 10V3L4 14h7v7l9-11h-7z\"/></svg> AI suggest';\r\n      }\r\n    });\r\n  }\r\n\r\n  const deleteBtn = container.querySelector('#delete-risk-btn');\r\n  if (deleteBtn) {\r\n    on(deleteBtn as HTMLElement, 'click', async () => {\r\n      if (!confirm('Are you sure you want to delete this risk?')) return;\r\n      try {\r\n        await risksService.delete(risk.id);\r\n        toast.success('Risk deleted');\r\n        onClose();\r\n      } catch {\r\n        toast.error('Failed to delete risk');\r\n      }\r\n    });\r\n  }\r\n\r\n  // AI suggest owner & mitigation (same UX as Question Assignment: list of owner cards with Assign each)\r\n  let lastMitigation = '';\r\n  const aiSuggestBtn = container.querySelector('#risk-ai-suggest-btn');\r\n  const suggestionsPanel = container.querySelector('#risk-suggestions-panel') as HTMLElement;\r\n  if (aiSuggestBtn && suggestionsPanel) {\r\n    on(aiSuggestBtn as HTMLElement, 'click', async () => {\r\n      const btn = aiSuggestBtn as HTMLButtonElement;\r\n      btn.disabled = true;\r\n      btn.innerHTML = `\r\n        <svg class=\"spin\" width=\"16\" height=\"16\" fill=\"none\" viewBox=\"0 0 24 24\" stroke=\"currentColor\">\r\n          <path stroke-linecap=\"round\" stroke-linejoin=\"round\" stroke-width=\"2\" d=\"M4 4v5h.582m15.356 2A8.001 8.001 0 004.582 9m0 0H9m11 11v-5h-.581m0 0a8.003 8.003 0 01-15.357-2m15.357 2H15\"/>\r\n        </svg>\r\n        Analyzing...\r\n      `;\r\n      suggestionsPanel.classList.remove('hidden');\r\n      suggestionsPanel.innerHTML = `\r\n        <div class=\"suggestions-loading\">\r\n          <div class=\"ai-thinking-animation\"><span></span><span></span><span></span></div>\r\n          <div class=\"loading-text\">AI is suggesting owners and mitigation...</div>\r\n        </div>\r\n      `;\r\n      try {\r\n        const [result, contactsRes] = await Promise.all([\r\n          risksService.suggest({\r\n            content: risk.content || '',\r\n            impact: risk.impact || 'medium',\r\n            likelihood: risk.likelihood || 'medium',\r\n          }),\r\n          contactsService.getAll(),\r\n        ]);\r\n        const contacts: Contact[] = contactsRes?.contacts || [];\r\n        lastMitigation = result.suggested_mitigation || '';\r\n        const owners: RiskOwnerSuggestion[] = result.suggested_owners?.length ? result.suggested_owners : (result.suggested_owner ? [{ name: result.suggested_owner, reason: '', score: 0 }] : []);\r\n\r\n        if (owners.length === 0 && !lastMitigation) {\r\n          suggestionsPanel.innerHTML = `\r\n            <div class=\"no-suggestions\">\r\n              <div class=\"no-suggestions-text\">No owner or mitigation suggestions</div>\r\n              <button type=\"button\" class=\"btn-link\" id=\"risk-hide-suggestions-btn\">Close</button>\r\n            </div>\r\n          `;\r\n        } else {\r\n          suggestionsPanel.innerHTML = `\r\n            <div class=\"suggestions-header-sota\">\r\n              <div class=\"ai-badge\">\r\n                <svg width=\"14\" height=\"14\" fill=\"none\" viewBox=\"0 0 24 24\" stroke=\"currentColor\">\r\n                  <path stroke-linecap=\"round\" stroke-linejoin=\"round\" stroke-width=\"2\" d=\"M13 10V3L4 14h7v7l9-11h-7z\"/>\r\n                </svg>\r\n                AI Recommended\r\n              </div>\r\n            </div>\r\n            ${owners.length > 0 ? `\r\n            <div class=\"suggestions-list-sota\">\r\n              ${owners.map((s, i) => {\r\n            const score = s.score ?? 0;\r\n            const scoreColor = getScoreColor(score);\r\n            const contact = contacts.find((c) => (c.name || '').trim().toLowerCase() === (s.name || '').trim().toLowerCase());\r\n            const photoUrl = contact?.photoUrl || contact?.avatarUrl || (contact as { photo_url?: string })?.photo_url || (contact as { avatar_url?: string })?.avatar_url;\r\n            const roleOrReason = contact?.role ?? s.reason ?? '';\r\n            return `\r\n                  <div class=\"suggestion-card-sota risk-owner-card\" data-index=\"${i}\">\r\n                    <div class=\"suggestion-rank\">#${i + 1}</div>\r\n                    <div class=\"suggestion-avatar-sota\">${photoUrl\r\n                ? `<img src=\"${escapeHtml(photoUrl)}\" alt=\"${escapeHtml(s.name)}\" onerror=\"this.parentElement.innerHTML='${getInitials(s.name)}'\">`\r\n                : getInitials(s.name)}</div>\r\n                    <div class=\"suggestion-info-sota\">\r\n                      <div class=\"suggestion-name-sota\">${escapeHtml(s.name)}</div>\r\n                      ${roleOrReason ? `<div class=\"suggestion-reason-sota\">${escapeHtml(roleOrReason)}</div>` : ''}\r\n                    </div>\r\n                    ${score > 0 ? `\r\n                    <div class=\"suggestion-score-sota\" style=\"--score-color: ${scoreColor}\">\r\n                      <div class=\"score-ring\">\r\n                        <svg viewBox=\"0 0 36 36\">\r\n                          <path class=\"score-bg\" d=\"M18 2.0845 a 15.9155 15.9155 0 0 1 0 31.831 a 15.9155 15.9155 0 0 1 0 -31.831\"/>\r\n                          <path class=\"score-fill\" stroke-dasharray=\"${score}, 100\" d=\"M18 2.0845 a 15.9155 15.9155 0 0 1 0 31.831 a 15.9155 15.9155 0 0 1 0 -31.831\"/>\r\n                        </svg>\r\n                        <div class=\"score-value\">${score}%</div>\r\n                      </div>\r\n                      <div class=\"score-label\">Match</div>\r\n                    </div>\r\n                    ` : ''}\r\n                    <button type=\"button\" class=\"btn-select-suggestion\">\r\n                      <svg width=\"16\" height=\"16\" fill=\"none\" viewBox=\"0 0 24 24\" stroke=\"currentColor\">\r\n                        <path stroke-linecap=\"round\" stroke-linejoin=\"round\" stroke-width=\"2\" d=\"M5 13l4 4L19 7\"/>\r\n                      </svg>\r\n                      Assign\r\n                    </button>\r\n                  </div>\r\n                `;\r\n          }).join('')}\r\n            </div>\r\n            ` : ''}\r\n            ${lastMitigation ? `\r\n            <div class=\"risk-suggestion-card risk-mitigation-suggestion\">\r\n              <strong>Suggested mitigation</strong>\r\n              <p class=\"risk-suggestion-mitigation\">${escapeHtml(lastMitigation)}</p>\r\n              <button type=\"button\" class=\"btn btn-secondary btn-sm\" id=\"risk-apply-mitigation-btn\">Apply mitigation</button>\r\n            </div>\r\n            ` : ''}\r\n            <div class=\"suggestions-footer\">\r\n              <button type=\"button\" class=\"btn-link\" id=\"risk-hide-suggestions-btn\">Close suggestions</button>\r\n            </div>\r\n          `;\r\n\r\n          // Bind Assign per owner card\r\n          suggestionsPanel.querySelectorAll('.risk-owner-card').forEach((item) => {\r\n            const selectBtn = item.querySelector('.btn-select-suggestion');\r\n            if (!selectBtn) return;\r\n            const idx = parseInt(item.getAttribute('data-index') || '0');\r\n            const suggestion = owners[idx];\r\n            if (!suggestion || !onUpdate) return;\r\n            on(selectBtn as HTMLElement, 'click', async (e) => {\r\n              e.stopPropagation();\r\n              try {\r\n                const updated = await risksService.update(risk.id, { owner: suggestion.name });\r\n                suggestionsPanel.classList.add('hidden');\r\n                onUpdate(updated);\r\n                toast.success(`Assigned to ${suggestion.name}`);\r\n              } catch {\r\n                toast.error('Failed to save');\r\n              }\r\n            });\r\n          });\r\n\r\n          // Bind Apply mitigation\r\n          const applyMitigationBtn = suggestionsPanel.querySelector('#risk-apply-mitigation-btn');\r\n          if (applyMitigationBtn && lastMitigation && onUpdate) {\r\n            on(applyMitigationBtn as HTMLElement, 'click', async () => {\r\n              try {\r\n                const updated = await risksService.update(risk.id, { mitigation: lastMitigation });\r\n                const mitigationEl = container.querySelector('#risk-detail-mitigation');\r\n                if (mitigationEl) mitigationEl.innerHTML = escapeHtml(lastMitigation);\r\n                onUpdate(updated);\r\n                toast.success('Mitigation updated');\r\n              } catch {\r\n                toast.error('Failed to save');\r\n              }\r\n            });\r\n          }\r\n        }\r\n\r\n        const hideBtn = suggestionsPanel.querySelector('#risk-hide-suggestions-btn');\r\n        if (hideBtn) {\r\n          on(hideBtn as HTMLElement, 'click', () => {\r\n            suggestionsPanel.classList.add('hidden');\r\n          });\r\n        }\r\n      } catch {\r\n        suggestionsPanel.innerHTML = `\r\n          <div class=\"suggestions-error\">\r\n            <div>Failed to get AI suggestions</div>\r\n            <button type=\"button\" class=\"btn-retry\" id=\"risk-retry-suggest-btn\">Try again</button>\r\n          </div>\r\n        `;\r\n        const retryBtn = suggestionsPanel.querySelector('#risk-retry-suggest-btn');\r\n        if (retryBtn) {\r\n          on(retryBtn as HTMLElement, 'click', () => (aiSuggestBtn as HTMLElement).click());\r\n        }\r\n      } finally {\r\n        btn.disabled = false;\r\n        btn.innerHTML = `\r\n          <svg width=\"16\" height=\"16\" fill=\"none\" viewBox=\"0 0 24 24\" stroke=\"currentColor\">\r\n            <path stroke-linecap=\"round\" stroke-linejoin=\"round\" stroke-width=\"2\" d=\"M13 10V3L4 14h7v7l9-11h-7z\"/>\r\n          </svg>\r\n          AI suggest\r\n        `;\r\n      }\r\n    });\r\n  }\r\n\r\n  const docLink = container.querySelector('.doc-link');\r\n  if (docLink && risk.source_document_id) {\r\n    on(docLink as HTMLElement, 'click', (e) => {\r\n      e.preventDefault();\r\n      window.dispatchEvent(new CustomEvent('godmode:navigate', {\r\n        detail: { tab: 'files', documentId: risk.source_document_id }\r\n      }));\r\n    });\r\n  }\r\n\r\n  const timelineEl = container.querySelector('#timeline-content');\r\n  if (timelineEl) {\r\n    risksService.getEvents(risk.id).then((events: RiskEvent[]) => {\r\n      if (events.length === 0) {\r\n        (timelineEl as HTMLElement).innerHTML = '<p class=\"empty-state\">No events recorded</p>';\r\n        return;\r\n      }\r\n      const html = events.map((ev) => {\r\n        const icon = getRiskEventIcon(ev.event_type);\r\n        const description = getRiskEventDescription(ev);\r\n        return `\r\n          <div class=\"timeline-item risk-event-${escapeHtml(ev.event_type)}\">\r\n            <div class=\"timeline-icon\">${icon}</div>\r\n            <div class=\"timeline-content\">\r\n              <div class=\"timeline-title\">${escapeHtml(description)}</div>\r\n              <div class=\"timeline-date\">${formatDateTime(ev.created_at)}</div>\r\n            </div>\r\n          </div>`;\r\n      }).join('');\r\n      (timelineEl as HTMLElement).innerHTML = `<div class=\"timeline-list\">${html}</div>`;\r\n    }).catch(() => {\r\n      (timelineEl as HTMLElement).innerHTML = '<p class=\"error\">Failed to load timeline</p>';\r\n    });\r\n  }\r\n\r\n  // Contact picker in view: show on Change/Choose Manually, on select update owner via API\r\n  let viewContacts: Contact[] = [];\r\n  const owner = risk.owner || '';\r\n  const riskContactPicker = container.querySelector('#risk-contact-picker') as HTMLElement;\r\n  const riskContactList = container.querySelector('#risk-contact-list') as HTMLElement;\r\n  const riskContactSearch = container.querySelector('#risk-contact-search') as HTMLInputElement;\r\n\r\n  const renderRiskContactGrid = (filter = '') => {\r\n    if (!riskContactList) return;\r\n    const list = filter\r\n      ? viewContacts.filter(\r\n        (c) =>\r\n          (c.name || '').toLowerCase().includes(filter.toLowerCase()) ||\r\n          (c.role || '').toLowerCase().includes(filter.toLowerCase()) ||\r\n          ((c as { organization?: string }).organization || '').toLowerCase().includes(filter.toLowerCase())\r\n      )\r\n      : viewContacts;\r\n    if (viewContacts.length === 0) {\r\n      riskContactList.innerHTML = '<div class=\"empty-state\">Loading contacts...</div>';\r\n      return;\r\n    }\r\n    if (list.length === 0) {\r\n      riskContactList.innerHTML = '<div class=\"empty-state\">No contacts match</div>';\r\n      return;\r\n    }\r\n    riskContactList.innerHTML = list\r\n      .map((c) => {\r\n        const photoUrl = getContactPhotoUrl(c);\r\n        const isCurrent = (owner || '').trim() === (c.name || '').trim();\r\n        return `\r\n          <div class=\"contact-card-picker ${isCurrent ? 'selected' : ''}\" data-contact-name=\"${escapeHtml(c.name || '')}\">\r\n            <div class=\"contact-avatar-picker\">${photoUrl ? `<img src=\"${escapeHtml(photoUrl)}\" alt=\"\" onerror=\"this.parentElement.innerHTML='${getInitials(c.name || '')}'\">` : getInitials(c.name || '')}</div>\r\n            <div class=\"contact-info-picker\">\r\n              <div class=\"contact-name-picker\">${escapeHtml(c.name || '')}</div>\r\n              ${c.role ? `<div class=\"contact-role-picker\">${escapeHtml(c.role)}</div>` : ''}\r\n            </div>\r\n          </div>`;\r\n      })\r\n      .join('');\r\n    riskContactList.querySelectorAll('.contact-card-picker').forEach((card) => {\r\n      on(card as HTMLElement, 'click', async () => {\r\n        const name = card.getAttribute('data-contact-name') || '';\r\n        if (!name) return;\r\n        try {\r\n          const updated = await risksService.update(risk.id, { owner: name });\r\n          toast.success(`Owner set to ${name}`);\r\n          if (riskContactPicker) riskContactPicker.classList.add('hidden');\r\n          onUpdate?.(updated);\r\n        } catch {\r\n          toast.error('Failed to save');\r\n        }\r\n      });\r\n    });\r\n  };\r\n\r\n  const showRiskPicker = () => {\r\n    if (!riskContactPicker) return;\r\n    const wasHidden = riskContactPicker.classList.contains('hidden');\r\n    riskContactPicker.classList.toggle('hidden', wasHidden);\r\n    if (wasHidden && viewContacts.length === 0) {\r\n      contactsService.getAll().then((res) => {\r\n        viewContacts = res?.contacts || [];\r\n        renderRiskContactGrid(riskContactSearch?.value || '');\r\n      }).catch(() => {\r\n        if (riskContactList) riskContactList.innerHTML = '<div class=\"empty-state\">Failed to load contacts</div>';\r\n      });\r\n    } else if (wasHidden) {\r\n      renderRiskContactGrid(riskContactSearch?.value || '');\r\n    }\r\n    if (riskContactSearch) riskContactSearch.focus();\r\n  };\r\n\r\n  const changeOwnerBtn = container.querySelector('#risk-change-owner-btn');\r\n  const showPickerBtn = container.querySelector('#risk-show-picker-btn');\r\n  if (changeOwnerBtn && riskContactPicker) on(changeOwnerBtn as HTMLElement, 'click', showRiskPicker);\r\n  if (showPickerBtn && riskContactPicker) on(showPickerBtn as HTMLElement, 'click', showRiskPicker);\r\n  if (riskContactSearch) {\r\n    riskContactSearch.addEventListener('input', () => renderRiskContactGrid(riskContactSearch.value));\r\n  }\r\n\r\n  function findContactByOwner(name: string): Contact | undefined {\r\n    if (!name || !viewContacts.length) return undefined;\r\n    const n = name.trim().toLowerCase();\r\n    if (!n) return undefined;\r\n    const byExact = viewContacts.find((c) => (c.name || '').trim().toLowerCase() === n);\r\n    if (byExact) return byExact;\r\n    const byPartial = viewContacts.find(\r\n      (c) =>\r\n        (c.name || '').trim().toLowerCase().includes(n) ||\r\n        n.includes((c.name || '').trim().toLowerCase())\r\n    );\r\n    if (byPartial) return byPartial;\r\n    const byAlias = viewContacts.find((c) =>\r\n      (c.aliases || []).some((a) => String(a).trim().toLowerCase() === n)\r\n    );\r\n    if (byAlias) return byAlias;\r\n    return viewContacts.find((c) =>\r\n      (c.aliases || []).some((a) => {\r\n        const aLower = String(a).trim().toLowerCase();\r\n        return aLower.includes(n) || n.includes(aLower);\r\n      })\r\n    );\r\n  }\r\n\r\n  function getContactPhotoUrl(c: Contact | undefined): string | null {\r\n    if (!c) return null;\r\n    const u = c as { photoUrl?: string; avatarUrl?: string; photo_url?: string; avatar_url?: string };\r\n    return u.photoUrl || u.avatarUrl || u.photo_url || u.avatar_url || null;\r\n  }\r\n\r\n  contactsService.getAll().then((res) => {\r\n    viewContacts = res?.contacts || [];\r\n    const contact = findContactByOwner(owner);\r\n    const roleEl = container.querySelector('#risk-assigned-role');\r\n    if (roleEl) roleEl.textContent = contact?.role ?? '';\r\n    const avatarEl = container.querySelector('#risk-assigned-avatar');\r\n    if (avatarEl && owner) {\r\n      const photoUrl = getContactPhotoUrl(contact);\r\n      if (photoUrl) {\r\n        avatarEl.innerHTML = '';\r\n        const img = document.createElement('img');\r\n        img.src = photoUrl;\r\n        img.alt = '';\r\n        img.onerror = () => { avatarEl.textContent = getInitials(owner); };\r\n        avatarEl.appendChild(img);\r\n      }\r\n    }\r\n  }).catch(() => { });\r\n\r\n  return container;\r\n}\r\n","/**\r\n * Risks Panel Component\r\n * Displays and manages risks with view tabs, search, grouping, detail view, and removed section (SOTA parity)\r\n */\r\n\r\nimport { createElement, on } from '@lib/dom';\r\nimport { risksService, Risk } from '@services/risks';\r\nimport { dataStore } from '@stores/data';\r\nimport { showRiskModal } from '../modals/RiskModal';\r\nimport { createRiskDetailView, RiskDetailViewProps } from '../risks/RiskDetailView';\r\nimport { toast } from '@services/toast';\r\nimport { formatRelativeTime } from '@lib/format';\r\n\r\nfunction riskDetailProps(containerEl: HTMLElement, props: RisksPanelProps, risk: Risk): RiskDetailViewProps {\r\n  return {\r\n    risk,\r\n    onClose: () => {\r\n      containerEl.innerHTML = '';\r\n      containerEl.appendChild(createRisksPanel(props));\r\n    },\r\n    onUpdate: (updatedRisk?: Risk) => {\r\n      containerEl.innerHTML = '';\r\n      if (updatedRisk) {\r\n        containerEl.appendChild(createRiskDetailView(riskDetailProps(containerEl, props, updatedRisk)));\r\n      } else {\r\n        containerEl.appendChild(createRisksPanel(props));\r\n      }\r\n    },\r\n  };\r\n}\r\n\r\nexport interface RisksPanelProps {\r\n  onRiskClick?: (risk: Risk) => void;\r\n  useDetailView?: boolean;\r\n  containerElement?: HTMLElement;\r\n}\r\n\r\nlet currentFilter: string = 'all';\r\nlet currentSearch: string = '';\r\nlet currentView: 'status' | 'source' = 'status';\r\nlet showMatrix: boolean = false;\r\nlet lastLoadedRisks: Risk[] = [];\r\n\r\n/**\r\n * Create risks panel\r\n */\r\nexport function createRisksPanel(props: RisksPanelProps = {}): HTMLElement {\r\n  const panel = createElement('div', { className: 'sot-panel risks-panel' });\r\n\r\n  panel.innerHTML = `\r\n    <div class=\"panel-header\">\r\n      <div class=\"panel-title\">\r\n        <h2>Risks</h2>\r\n        <span class=\"panel-count\" id=\"risks-count\">0</span>\r\n      </div>\r\n      <div class=\"panel-actions\">\r\n        <select id=\"risks-filter\" class=\"filter-select\">\r\n          <option value=\"all\">All</option>\r\n          <option value=\"open\">Open</option>\r\n          <option value=\"mitigating\">Mitigating</option>\r\n          <option value=\"mitigated\">Mitigated</option>\r\n          <option value=\"high\">High Impact</option>\r\n        </select>\r\n        <div class=\"view-tabs\">\r\n          <button class=\"view-tab active\" data-view=\"status\">By Status</button>\r\n          <button class=\"view-tab\" data-view=\"source\">By Source</button>\r\n        </div>\r\n        <input type=\"search\" id=\"risks-search\" class=\"search-input\" placeholder=\"Search risks...\" title=\"Search\">\r\n        <button class=\"btn btn-secondary btn-sm\" id=\"toggle-matrix-btn\">Show Matrix</button>\r\n        <button class=\"btn btn-primary btn-sm\" id=\"add-risk-btn\">+ Add</button>\r\n      </div>\r\n    </div>\r\n    <div id=\"risk-matrix-container\" class=\"risk-matrix-container hidden\"></div>\r\n    <div class=\"panel-content\" id=\"risks-content\">\r\n      <div class=\"loading\">Loading risks...</div>\r\n    </div>\r\n    <div id=\"removed-risks-container\" class=\"removed-risks-container hidden\"></div>\r\n  `;\r\n\r\n  const filterSelect = panel.querySelector('#risks-filter') as HTMLSelectElement;\r\n  on(filterSelect, 'change', () => {\r\n    currentFilter = filterSelect.value;\r\n    loadRisks(panel, props);\r\n  });\r\n\r\n  const viewTabs = panel.querySelectorAll('.view-tab');\r\n  viewTabs.forEach(tab => {\r\n    on(tab as HTMLElement, 'click', () => {\r\n      viewTabs.forEach(t => t.classList.remove('active'));\r\n      tab.classList.add('active');\r\n      currentView = tab.getAttribute('data-view') as 'status' | 'source';\r\n      loadRisks(panel, props);\r\n    });\r\n  });\r\n\r\n  const searchInput = panel.querySelector('#risks-search') as HTMLInputElement;\r\n  let searchTimeout: number;\r\n  on(searchInput, 'input', () => {\r\n    clearTimeout(searchTimeout);\r\n    searchTimeout = window.setTimeout(() => {\r\n      currentSearch = searchInput.value.trim();\r\n      loadRisks(panel, props);\r\n    }, 300);\r\n  });\r\n\r\n  const matrixBtn = panel.querySelector('#toggle-matrix-btn') as HTMLButtonElement;\r\n  on(matrixBtn, 'click', () => {\r\n    showMatrix = !showMatrix;\r\n    matrixBtn.textContent = showMatrix ? 'Hide Matrix' : 'Show Matrix';\r\n    const matrixContainer = panel.querySelector('#risk-matrix-container') as HTMLElement;\r\n    matrixContainer.classList.toggle('hidden', !showMatrix);\r\n    if (showMatrix) {\r\n      const risksToShow = lastLoadedRisks.length > 0 ? lastLoadedRisks : (dataStore.getState().risks as unknown as Risk[]) || [];\r\n      renderRiskMatrix(matrixContainer, Array.isArray(risksToShow) ? risksToShow : []);\r\n    }\r\n  });\r\n\r\n  const addBtn = panel.querySelector('#add-risk-btn');\r\n  if (addBtn) {\r\n    on(addBtn as HTMLElement, 'click', () => {\r\n      showRiskModal({\r\n        mode: 'create',\r\n        onSave: () => {\r\n          loadRisks(panel, props);\r\n          refreshRemovedSection(panel, props);\r\n        },\r\n      });\r\n    });\r\n  }\r\n\r\n  loadRisks(panel, props);\r\n  refreshRemovedSection(panel, props);\r\n\r\n  return panel;\r\n}\r\n\r\nasync function refreshRemovedSection(panel: HTMLElement, props: RisksPanelProps): Promise<void> {\r\n  const container = panel.querySelector('#removed-risks-container') as HTMLElement;\r\n  if (!container) return;\r\n  try {\r\n    const deleted = await risksService.getDeleted();\r\n    if (deleted.length === 0) {\r\n      container.classList.add('hidden');\r\n      container.innerHTML = '';\r\n      return;\r\n    }\r\n    container.classList.remove('hidden');\r\n    container.innerHTML = `\r\n      <div class=\"removed-risks-section\">\r\n        <div class=\"removed-risks-header section-header-sota\">\r\n          <h3>Removed risks</h3>\r\n          <span class=\"panel-count removed-count\">${deleted.length}</span>\r\n        </div>\r\n        <p class=\"removed-risks-hint\">Restore to bring the risk back; it will be synced to the graph.</p>\r\n        <div class=\"removed-risks-list\">\r\n          ${deleted.map((r) => `\r\n            <div class=\"removed-risk-item\" data-risk-id=\"${r.id}\">\r\n              <div class=\"removed-risk-content\">${escapeHtml(truncate(r.content ?? '', 100))}</div>\r\n              <button type=\"button\" class=\"btn btn-sm conflict-resolve-restore\">Restore</button>\r\n            </div>\r\n          `).join('')}\r\n        </div>\r\n      </div>\r\n    `;\r\n    container.querySelectorAll('.conflict-resolve-restore').forEach((restoreBtn) => {\r\n      on(restoreBtn as HTMLElement, 'click', async () => {\r\n        const id = (restoreBtn as HTMLElement).closest('.removed-risk-item')?.getAttribute('data-risk-id');\r\n        if (!id) return;\r\n        try {\r\n          await risksService.restore(id);\r\n          toast.success('Risk restored');\r\n          loadRisks(panel, props);\r\n          refreshRemovedSection(panel, props);\r\n        } catch {\r\n          toast.error('Failed to restore risk');\r\n        }\r\n      });\r\n    });\r\n  } catch {\r\n    container.classList.add('hidden');\r\n    container.innerHTML = '';\r\n  }\r\n}\r\n\r\nfunction truncate(s: string, len: number): string {\r\n  if (s.length <= len) return s;\r\n  return s.substring(0, len) + '';\r\n}\r\n\r\nfunction filterRisksBySearch(risks: Risk[], q: string): Risk[] {\r\n  if (!q) return risks;\r\n  const lower = q.toLowerCase();\r\n  return risks.filter(\r\n    r =>\r\n      (r.content || '').toLowerCase().includes(lower) ||\r\n      (r.mitigation || '').toLowerCase().includes(lower) ||\r\n      (r.owner || '').toLowerCase().includes(lower) ||\r\n      (r.source_file || '').toLowerCase().includes(lower)\r\n  );\r\n}\r\n\r\nasync function loadRisks(panel: HTMLElement, props: RisksPanelProps): Promise<void> {\r\n  const content = panel.querySelector('#risks-content') as HTMLElement;\r\n  content.innerHTML = '<div class=\"loading\">Loading...</div>';\r\n\r\n  try {\r\n    const status = currentFilter === 'all' || currentFilter === 'high' ? undefined : currentFilter;\r\n    let risks = await risksService.getAll(status);\r\n    if (currentFilter === 'high') {\r\n      risks = risks.filter(r => r.impact === 'high' || r.impact === 'critical');\r\n    }\r\n    risks = filterRisksBySearch(risks, currentSearch);\r\n\r\n    if (currentView === 'source') {\r\n      renderRisksBySource(content, risks, props);\r\n    } else {\r\n      renderRisks(content, risks, props);\r\n    }\r\n    lastLoadedRisks = risks;\r\n    dataStore.setRisks(risks as unknown as []);\r\n    updateCount(panel, risks.length);\r\n\r\n    if (showMatrix) {\r\n      const matrixContainer = panel.querySelector('#risk-matrix-container') as HTMLElement;\r\n      renderRiskMatrix(matrixContainer, risks);\r\n    }\r\n  } catch {\r\n    content.innerHTML = '<div class=\"error\">Failed to load risks</div>';\r\n  }\r\n}\r\n\r\nfunction renderRisks(container: HTMLElement, risks: Risk[], props: RisksPanelProps): void {\r\n  if (risks.length === 0) {\r\n    container.innerHTML = `\r\n      <div class=\"empty-state\">\r\n        <p>${currentSearch ? 'No risks match your search' : 'No risks found'}</p>\r\n        <button class=\"btn btn-primary\" id=\"empty-add-btn\">Add Risk</button>\r\n      </div>\r\n    `;\r\n    const addBtn = container.querySelector('#empty-add-btn');\r\n    if (addBtn) {\r\n      on(addBtn as HTMLElement, 'click', () => {\r\n        showRiskModal({ mode: 'create', onSave: () => loadRisks(container.closest('.risks-panel') as HTMLElement, props) });\r\n      });\r\n    }\r\n    return;\r\n  }\r\n\r\n  const contacts: ContactLike[] = (dataStore.getState().contacts || []) as ContactLike[];\r\n  const byStatus: Record<string, Risk[]> = {};\r\n  risks.forEach(r => {\r\n    const s = (r.status || 'open').toLowerCase();\r\n    if (!byStatus[s]) byStatus[s] = [];\r\n    byStatus[s].push(r);\r\n  });\r\n  const statuses = Object.keys(byStatus);\r\n\r\n  if (statuses.length > 1) {\r\n    container.innerHTML = statuses.map(status => `\r\n      <div class=\"question-group\">\r\n        <div class=\"group-header\">\r\n          <h3>${escapeHtml(status)}</h3>\r\n          <span class=\"group-count\">${byStatus[status].length}</span>\r\n        </div>\r\n        <div class=\"group-items\">\r\n          ${byStatus[status].map(r => createRiskCard(r, contacts)).join('')}\r\n        </div>\r\n      </div>\r\n    `).join('');\r\n  } else {\r\n    container.innerHTML = risks.map(r => createRiskCard(r, contacts)).join('');\r\n  }\r\n  bindRiskCards(container, risks, props);\r\n}\r\n\r\nfunction renderRisksBySource(container: HTMLElement, risks: Risk[], props: RisksPanelProps): void {\r\n  if (risks.length === 0) {\r\n    container.innerHTML = `\r\n      <div class=\"empty-state\">\r\n        <p>${currentSearch ? 'No risks match your search' : 'No risks found'}</p>\r\n        <button class=\"btn btn-primary\" id=\"empty-add-btn\">Add Risk</button>\r\n      </div>\r\n    `;\r\n    const addBtn = container.querySelector('#empty-add-btn');\r\n    if (addBtn) {\r\n      on(addBtn as HTMLElement, 'click', () => {\r\n        showRiskModal({ mode: 'create', onSave: () => loadRisks(container.closest('.risks-panel') as HTMLElement, props) });\r\n      });\r\n    }\r\n    return;\r\n  }\r\n  const contacts: ContactLike[] = (dataStore.getState().contacts || []) as ContactLike[];\r\n  const bySource: Record<string, Risk[]> = {};\r\n  risks.forEach(r => {\r\n    const src = r.source_file || 'Unknown source';\r\n    if (!bySource[src]) bySource[src] = [];\r\n    bySource[src].push(r);\r\n  });\r\n  container.innerHTML = Object.entries(bySource).map(([source, list]) => `\r\n    <div class=\"question-group\">\r\n      <div class=\"group-header\">\r\n        <h3>${escapeHtml(source)}</h3>\r\n        <span class=\"group-count\">${list.length}</span>\r\n      </div>\r\n      <div class=\"group-items\">\r\n        ${list.map(r => createRiskCard(r, contacts)).join('')}\r\n      </div>\r\n    </div>\r\n  `).join('');\r\n  bindRiskCards(container, risks, props);\r\n}\r\n\r\nconst IMPACT_BAR_COLOR: Record<string, string> = {\r\n  critical: '#dc2626',\r\n  high: '#ea580c',\r\n  medium: '#ca8a04',\r\n  low: '#16a34a',\r\n};\r\n\r\ntype ContactLike = { name?: string; role?: string; photoUrl?: string; avatarUrl?: string; photo_url?: string; avatar_url?: string; aliases?: string[] };\r\n\r\nfunction findContactByOwner(contacts: ContactLike[], name: string): ContactLike | undefined {\r\n  if (!name || !contacts.length) return undefined;\r\n  const n = name.trim().toLowerCase();\r\n  if (!n) return undefined;\r\n  const byExact = contacts.find((c) => (c.name || '').trim().toLowerCase() === n);\r\n  if (byExact) return byExact;\r\n  const byPartial = contacts.find(\r\n    (c) =>\r\n      (c.name || '').trim().toLowerCase().includes(n) ||\r\n      n.includes((c.name || '').trim().toLowerCase())\r\n  );\r\n  if (byPartial) return byPartial;\r\n  const byAlias = contacts.find((c) =>\r\n    (c.aliases || []).some((a) => String(a).trim().toLowerCase() === n)\r\n  );\r\n  return byAlias || contacts.find((c) =>\r\n    (c.aliases || []).some((a) => {\r\n      const aLower = String(a).trim().toLowerCase();\r\n      return aLower.includes(n) || n.includes(aLower);\r\n    })\r\n  );\r\n}\r\n\r\nfunction getContactPhotoUrl(c: ContactLike | undefined): string | null {\r\n  if (!c) return null;\r\n  return c.photoUrl || c.avatarUrl || c.photo_url || c.avatar_url || null;\r\n}\r\n\r\nfunction getInitials(name: string): string {\r\n  if (!name) return '?';\r\n  const parts = name.trim().split(/\\s+/);\r\n  return parts.length === 1 ? parts[0].substring(0, 2).toUpperCase() : (parts[0][0] + parts[parts.length - 1][0]).toUpperCase();\r\n}\r\n\r\nfunction createRiskCard(risk: Risk, contacts: ContactLike[]): string {\r\n  const impact = (risk.impact || 'medium').toLowerCase();\r\n  const barColor = IMPACT_BAR_COLOR[impact] ?? IMPACT_BAR_COLOR.medium;\r\n  const content = risk.content || '';\r\n  const source = risk.source_file || '';\r\n  const owner = risk.owner || '';\r\n  const contact = owner ? findContactByOwner(contacts, owner) : undefined;\r\n  const photoUrl = getContactPhotoUrl(contact);\r\n  const ownerChipHtml = owner\r\n    ? `\r\n        <div class=\"assignee-chip\">\r\n          <div class=\"assignee-avatar\">${photoUrl ? `<img src=\"${escapeHtml(photoUrl)}\" alt=\"${escapeHtml(owner)}\" onerror=\"this.parentElement.innerHTML='${getInitials(owner)}'\">` : getInitials(owner)}</div>\r\n          <div class=\"assignee-info\">\r\n            <span class=\"assignee-name\">${escapeHtml(owner)}</span>\r\n            ${contact?.role ? `<span class=\"assignee-role\">${escapeHtml(contact.role)}</span>` : ''}\r\n          </div>\r\n        </div>\r\n      `\r\n    : '<span class=\"card-owner-placeholder text-muted\">No owner</span>';\r\n  const sourceChip = source ? `<span class=\"card-source-chip\">${escapeHtml(truncate(source, 40))}</span>` : '<span class=\"card-source-chip text-muted\">No source</span>';\r\n\r\n  return `\r\n    <div class=\"risk-card-sota question-card-sota\" data-id=\"${risk.id}\" style=\"--risk-impact-bar: ${barColor}\">\r\n      <div class=\"card-priority-bar risk-impact-bar\"></div>\r\n      <div class=\"card-body\">\r\n        <div class=\"card-top-row\">\r\n          <div class=\"card-badges\">\r\n            <span class=\"priority-pill impact-${impact}\">${escapeHtml(risk.impact || 'medium')}</span>\r\n            <span class=\"status-pill\">L: ${escapeHtml(risk.likelihood || 'medium')}</span>\r\n            <span class=\"status-pill status-${(risk.status || 'open').toLowerCase()}\">${escapeHtml(risk.status || 'open')}</span>\r\n          </div>\r\n          <span class=\"card-timestamp\">${formatRelativeTime(risk.created_at)}</span>\r\n        </div>\r\n        <div class=\"card-question-text\">${escapeHtml(content)}</div>\r\n        ${risk.mitigation ? `<div class=\"card-mitigation text-muted\">${escapeHtml(truncate(risk.mitigation, 120))}</div>` : ''}\r\n        <div class=\"card-bottom-row\">\r\n          <div class=\"card-requester\">\r\n            ${sourceChip}\r\n            ${ownerChipHtml}\r\n          </div>\r\n          <div class=\"card-assignment\">\r\n            <button type=\"button\" class=\"btn-link risk-view-link\">View</button>\r\n          </div>\r\n        </div>\r\n      </div>\r\n    </div>\r\n  `;\r\n}\r\n\r\nfunction bindRiskCards(container: HTMLElement, risks: Risk[], props: RisksPanelProps): void {\r\n  container.querySelectorAll('.risk-card-sota').forEach((card) => {\r\n    on(card as HTMLElement, 'click', (e) => {\r\n      if ((e.target as HTMLElement).closest('.card-actions')) return;\r\n      const id = card.getAttribute('data-id');\r\n      const risk = risks.find(r => String(r.id) === id);\r\n      if (!risk) return;\r\n      if (props.useDetailView && props.containerElement) {\r\n        const containerEl = props.containerElement;\r\n        containerEl.innerHTML = '';\r\n        containerEl.appendChild(createRiskDetailView(riskDetailProps(containerEl, props, risk)));\r\n      } else if (props.onRiskClick) {\r\n        props.onRiskClick(risk);\r\n      } else {\r\n        showRiskModal({\r\n          mode: 'edit',\r\n          risk: { ...risk },\r\n          onSave: () => loadRisks(container.closest('.risks-panel') as HTMLElement, props),\r\n        });\r\n      }\r\n    });\r\n  });\r\n}\r\n\r\nfunction renderRiskMatrix(container: HTMLElement, risks: Risk[]): void {\r\n  const activeRisks = risks.filter(r => r.status !== 'mitigated' && r.status !== 'closed');\r\n  const getSeverity = (impact?: string, likelihood?: string): string => {\r\n    const impactLevel = ['low', 'medium', 'high', 'critical'].indexOf((impact || '').toString().toLowerCase() || 'low');\r\n    const likelihoodLevel = ['low', 'medium', 'high'].indexOf((likelihood || '').toString().toLowerCase() || 'low');\r\n    const score = impactLevel + likelihoodLevel;\r\n    if (score >= 4) return 'critical';\r\n    if (score >= 3) return 'high';\r\n    if (score >= 2) return 'medium';\r\n    return 'low';\r\n  };\r\n  const counts = { critical: 0, high: 0, medium: 0, low: 0 };\r\n  activeRisks.forEach(risk => {\r\n    const severity = getSeverity(risk.impact, risk.likelihood);\r\n    counts[severity as keyof typeof counts]++;\r\n  });\r\n  const total = activeRisks.length;\r\n  const mitigated = risks.length - activeRisks.length;\r\n  const getPercent = (count: number) => total > 0 ? Math.round((count / total) * 100) : 0;\r\n  let conicStops = '';\r\n  let currentDeg = 0;\r\n  const colors = { critical: '#ef4444', high: '#f97316', medium: '#eab308', low: '#22c55e' };\r\n  (['critical', 'high', 'medium', 'low'] as const).forEach(level => {\r\n    const percent = getPercent(counts[level]);\r\n    const degrees = (percent / 100) * 360;\r\n    if (degrees > 0) {\r\n      conicStops += `${colors[level]} ${currentDeg}deg ${currentDeg + degrees}deg, `;\r\n      currentDeg += degrees;\r\n    }\r\n  });\r\n  if (!conicStops) conicStops = 'var(--color-border) 0deg 360deg';\r\n  else conicStops = conicStops.slice(0, -2);\r\n\r\n  container.innerHTML = `\r\n    <div class=\"risk-summary\">\r\n      <div class=\"risk-summary-header\">\r\n        <h4>Risk Overview</h4>\r\n        <span class=\"risk-total\">${total} active</span>\r\n      </div>\r\n      <div class=\"risk-summary-content\">\r\n        <div class=\"risk-donut-container\">\r\n          <div class=\"risk-donut\" style=\"background: conic-gradient(${conicStops})\">\r\n            <div class=\"risk-donut-center\">\r\n              <span class=\"donut-value\">${total}</span>\r\n              <span class=\"donut-label\">Risks</span>\r\n            </div>\r\n          </div>\r\n        </div>\r\n        <div class=\"risk-bars\">\r\n          <div class=\"risk-bar-item critical\">\r\n            <span class=\"bar-icon\"></span>\r\n            <span class=\"bar-label\">Critical</span>\r\n            <div class=\"bar-track\"><div class=\"bar-fill\" style=\"--bar-width: ${getPercent(counts.critical)}\"></div></div>\r\n            <span class=\"bar-count\">${counts.critical}</span>\r\n          </div>\r\n          <div class=\"risk-bar-item high\">\r\n            <span class=\"bar-icon\"></span>\r\n            <span class=\"bar-label\">High</span>\r\n            <div class=\"bar-track\"><div class=\"bar-fill\" style=\"--bar-width: ${getPercent(counts.high)}\"></div></div>\r\n            <span class=\"bar-count\">${counts.high}</span>\r\n          </div>\r\n          <div class=\"risk-bar-item medium\">\r\n            <span class=\"bar-icon\"></span>\r\n            <span class=\"bar-label\">Medium</span>\r\n            <div class=\"bar-track\"><div class=\"bar-fill\" style=\"--bar-width: ${getPercent(counts.medium)}\"></div></div>\r\n            <span class=\"bar-count\">${counts.medium}</span>\r\n          </div>\r\n          <div class=\"risk-bar-item low\">\r\n            <span class=\"bar-icon\"></span>\r\n            <span class=\"bar-label\">Low</span>\r\n            <div class=\"bar-track\"><div class=\"bar-fill\" style=\"--bar-width: ${getPercent(counts.low)}\"></div></div>\r\n            <span class=\"bar-count\">${counts.low}</span>\r\n          </div>\r\n        </div>\r\n      </div>\r\n      ${mitigated > 0 ? `<div class=\"risk-mitigated\"><span class=\"mitigated-icon\"></span><span>${mitigated} risk${mitigated > 1 ? 's' : ''} mitigated</span></div>` : ''}\r\n    </div>\r\n  `;\r\n}\r\n\r\nfunction updateCount(panel: HTMLElement, count: number): void {\r\n  const countEl = panel.querySelector('#risks-count');\r\n  if (countEl) countEl.textContent = String(count);\r\n}\r\n\r\nfunction escapeHtml(text: string): string {\r\n  const div = document.createElement('div');\r\n  div.textContent = text;\r\n  return div.innerHTML;\r\n}\r\n\r\nexport default createRisksPanel;\r\n","/**\r\n * Sprints Service\r\n * Create sprint, generate tasks from emails/transcripts, apply\r\n */\r\n\r\nimport { http } from './api';\r\n\r\nexport interface Sprint {\r\n  id: string;\r\n  project_id: string;\r\n  name: string;\r\n  start_date: string;\r\n  end_date: string;\r\n  context?: string;\r\n  analysis_start_date?: string;\r\n  analysis_end_date?: string;\r\n  created_at?: string;\r\n  updated_at?: string;\r\n}\r\n\r\nexport interface ProposedTask {\r\n  task: string;\r\n  description?: string;\r\n  size_estimate?: string;\r\n  definition_of_done?: string[];\r\n  acceptance_criteria?: string[];\r\n  priority?: string;\r\n  due_date?: string;\r\n}\r\n\r\nexport interface SprintGenerateResult {\r\n  proposed_new_tasks: ProposedTask[];\r\n  existing_action_ids: string[];\r\n  existing_details?: { id: string; task: string; status: string }[];\r\n}\r\n\r\nexport interface SprintApplyResult {\r\n  ok: boolean;\r\n  created: number;\r\n  linked: number;\r\n  sprint: Sprint;\r\n}\r\n\r\nexport async function getSprints(): Promise<Sprint[]> {\r\n  try {\r\n    const response = await http.get<{ sprints: Sprint[] }>('/api/sprints');\r\n    return response.data.sprints || [];\r\n  } catch {\r\n    return [];\r\n  }\r\n}\r\n\r\nexport async function getSprint(id: string): Promise<Sprint | null> {\r\n  try {\r\n    const response = await http.get<{ sprint: Sprint }>(`/api/sprints/${id}`);\r\n    return response.data.sprint || null;\r\n  } catch {\r\n    return null;\r\n  }\r\n}\r\n\r\nexport async function createSprint(data: {\r\n  name: string;\r\n  start_date: string;\r\n  end_date: string;\r\n  context?: string;\r\n  analysis_start_date?: string;\r\n  analysis_end_date?: string;\r\n}): Promise<Sprint> {\r\n  const response = await http.post<{ sprint: Sprint }>('/api/sprints', data);\r\n  return response.data.sprint;\r\n}\r\n\r\nexport async function generateSprintTasks(\r\n  sprintId: string,\r\n  body?: { analysis_start_date?: string; analysis_end_date?: string }\r\n): Promise<SprintGenerateResult> {\r\n  const response = await http.post<SprintGenerateResult>(`/api/sprints/${sprintId}/generate`, body || {});\r\n  return response.data;\r\n}\r\n\r\nexport async function applySprintGeneration(\r\n  sprintId: string,\r\n  body: { new_tasks: ProposedTask[]; existing_action_ids: string[] }\r\n): Promise<SprintApplyResult> {\r\n  const response = await http.post<SprintApplyResult>(`/api/sprints/${sprintId}/apply`, body);\r\n  return response.data;\r\n}\r\n\r\n/** Report: sprint + actions + breakdown for charts */\r\nexport interface SprintReport {\r\n  sprint: Sprint;\r\n  actions: Array<{ id: string; task?: string; content?: string; status?: string; owner?: string; task_points?: number }>;\r\n  breakdown: { by_status: Record<string, number>; by_assignee: Record<string, number> };\r\n  total_task_points: number;\r\n  completed_task_points: number;\r\n  total_tasks: number;\r\n  completed_tasks: number;\r\n}\r\n\r\nexport async function getSprintReport(sprintId: string): Promise<SprintReport | null> {\r\n  try {\r\n    const response = await http.get<SprintReport>(`/api/sprints/${sprintId}/report`);\r\n    return response.data ?? null;\r\n  } catch {\r\n    return null;\r\n  }\r\n}\r\n\r\nexport async function analyzeSprintReport(sprintId: string): Promise<{ analysis: string; ai_analysis: string | null; error?: string }> {\r\n  const response = await http.post<{ analysis: string; ai_analysis: string | null; error?: string }>(\r\n    `/api/sprints/${sprintId}/report/analyze`,\r\n    {}\r\n  );\r\n  return response.data;\r\n}\r\n\r\nexport async function getSprintBusinessReport(sprintId: string): Promise<{\r\n  summary: string;\r\n  business_report: string | null;\r\n  error?: string;\r\n}> {\r\n  const response = await http.post<{ summary: string; business_report: string | null; error?: string }>(\r\n    `/api/sprints/${sprintId}/report/business`,\r\n    {}\r\n  );\r\n  return response.data;\r\n}\r\n\r\nexport type ReportDocumentStyle =\r\n  | ''\r\n  | 'sprint_report_style_corporate_classic'\r\n  | 'sprint_report_style_modern_minimal'\r\n  | 'sprint_report_style_startup_tech'\r\n  | 'sprint_report_style_consultancy';\r\n\r\nexport async function generateSprintReportDocument(\r\n  sprintId: string,\r\n  options?: { include_analysis?: boolean; include_business?: boolean; style?: ReportDocumentStyle }\r\n): Promise<{ html: string }> {\r\n  const response = await http.post<{ html: string }>(`/api/sprints/${sprintId}/report/document`, {\r\n    include_analysis: options?.include_analysis ?? false,\r\n    include_business: options?.include_business ?? false,\r\n    style: options?.style ?? '',\r\n  });\r\n  return response.data;\r\n}\r\n\r\nexport async function generateSprintReportPresentation(\r\n  sprintId: string,\r\n  options?: { include_analysis?: boolean; include_business?: boolean }\r\n): Promise<{ html: string }> {\r\n  const response = await http.post<{ html: string }>(`/api/sprints/${sprintId}/report/presentation`, {\r\n    include_analysis: options?.include_analysis ?? false,\r\n    include_business: options?.include_business ?? false,\r\n  });\r\n  return response.data;\r\n}\r\n","/**\r\n * Action Modal Component\r\n * Create, view and edit actions/tasks\r\n */\r\n\r\nimport { createElement, on } from '@lib/dom';\r\nimport { createModal, openModal, closeModal } from '../Modal';\r\nimport { Action } from '@services/actions';\r\nimport { actionsService } from '@services/actions';\r\nimport { getSprints } from '@services/sprints';\r\nimport { contactsService } from '@services/contacts';\r\nimport { toast } from '@services/toast';\r\nimport { formatRelativeTime } from '@lib/format';\r\n\r\nconst MODAL_ID = 'action-modal';\r\n\r\nexport interface ActionModalProps {\r\n  mode: 'view' | 'edit' | 'create';\r\n  action?: Action;\r\n  onSave?: (action: Action) => void;\r\n  onDelete?: (actionId: string) => void;\r\n}\r\n\r\nfunction taskText(a: Action | undefined): string {\r\n  return (a?.content ?? a?.task ?? '') as string;\r\n}\r\nfunction dueDateText(a: Action | undefined): string {\r\n  return (a?.due_date ?? (a as { dueDate?: string })?.dueDate ?? '') as string;\r\n}\r\nfunction createdText(a: Action | undefined): string {\r\n  return (a?.created_at ?? (a as { createdAt?: string })?.createdAt ?? '') as string;\r\n}\r\nfunction parentStoryRef(a: Action | undefined): string {\r\n  return (a?.parent_story_ref ?? '') as string;\r\n}\r\nfunction sizeEstimate(a: Action | undefined): string {\r\n  return (a?.size_estimate ?? '') as string;\r\n}\r\nfunction descriptionText(a: Action | undefined): string {\r\n  return (a?.description ?? '') as string;\r\n}\r\nfunction dodList(a: Action | undefined): string[] {\r\n  if (!a?.definition_of_done) return [];\r\n  return a.definition_of_done.map((item) => (typeof item === 'string' ? item : item.text));\r\n}\r\nfunction acList(a: Action | undefined): string[] {\r\n  return Array.isArray(a?.acceptance_criteria) ? a.acceptance_criteria : [];\r\n}\r\n\r\n/**\r\n * Show action modal\r\n */\r\nexport function showActionModal(props: ActionModalProps): void {\r\n  const { mode, action, onSave, onDelete } = props;\r\n  const isEdit = mode === 'edit' && action?.id;\r\n  const isView = mode === 'view';\r\n\r\n  // Remove existing modal\r\n  const existing = document.querySelector(`[data-modal-id=\"${MODAL_ID}\"]`);\r\n  if (existing) existing.remove();\r\n\r\n  const content = createElement('div', { className: 'action-modal-content' });\r\n\r\n  if (isView && action) {\r\n    const due = dueDateText(action);\r\n    const isOverdue = due && new Date(due) < new Date() && action.status !== 'completed';\r\n    const parent = parentStoryRef(action);\r\n    const size = sizeEstimate(action);\r\n    const desc = descriptionText(action);\r\n    const dod = dodList(action);\r\n    const ac = acList(action);\r\n\r\n    content.innerHTML = `\r\n      <div class=\"action-view\">\r\n        <div class=\"action-meta\">\r\n          <span class=\"priority-badge priority-${action.priority || 'medium'}\">${action.priority || 'medium'}</span>\r\n          <span class=\"status-badge ${action.status}\">${action.status.replace('_', ' ')}</span>\r\n          ${isOverdue ? '<span class=\"status-badge overdue\">Overdue</span>' : ''}\r\n        </div>\r\n        \r\n        <div class=\"action-task-large ${action.status === 'completed' ? 'completed' : ''}\">\r\n          ${escapeHtml(taskText(action))}\r\n        </div>\r\n        \r\n        <div class=\"action-details\">\r\n          ${action.assignee ? `<div class=\"detail-item\"><strong>Assignee:</strong> ${escapeHtml(action.assignee)}</div>` : ''}\r\n          ${due ? `<div class=\"detail-item\"><strong>Due Date:</strong> ${due}</div>` : ''}\r\n          ${size ? `<div class=\"detail-item\"><strong>Effort:</strong> ${escapeHtml(size)}</div>` : ''}\r\n          ${parent ? `<div class=\"detail-item\"><strong>Parent Story:</strong> ${escapeHtml(parent)}</div>` : ''}\r\n          ${action.generation_source ? `<div class=\"detail-item\"><strong>Source:</strong> ${escapeHtml(action.generation_source)}</div>` : ''}\r\n          ${(action.sprint_id || action.sprint_name) ? `<div class=\"detail-item\"><strong>Sprint:</strong> ${escapeHtml((action.sprint_name as string) || action.sprint_id || '')}</div>` : ''}\r\n          ${action.task_points != null ? `<div class=\"detail-item\"><strong>Task points:</strong> ${action.task_points}</div>` : ''}\r\n          ${(action.requested_by || (action as { requested_by_contact_id?: string }).requested_by_contact_id) ? `<div class=\"detail-item\" id=\"action-view-requester-wrap\"><strong>Requested by:</strong> <span id=\"action-view-requester-card\">${escapeHtml((action.requested_by as string) || '')}</span></div>` : ''}\r\n          <div class=\"detail-item\"><strong>Created:</strong> ${formatRelativeTime(createdText(action))}</div>\r\n        </div>\r\n        ${desc ? `<div class=\"action-description\"><strong>Description</strong><p>${escapeHtml(desc)}</p></div>` : ''}\r\n        ${dod.length ? `<div class=\"action-dod\"><strong>Definition of Done</strong><ul>${dod.map((item: string) => `<li>${escapeHtml(item)}</li>`).join('')}</ul></div>` : ''}\r\n        ${ac.length ? `<div class=\"action-ac\"><strong>Acceptance Criteria</strong><ul>${ac.map((item: string) => `<li>${escapeHtml(item)}</li>`).join('')}</ul></div>` : ''}\r\n      </div>\r\n    `;\r\n  } else {\r\n    const dodStr = dodList(action).join('\\n');\r\n    const acStr = acList(action).join('\\n');\r\n    content.innerHTML = `\r\n      <form id=\"action-form\" class=\"action-form\">\r\n        <div class=\"form-group action-generate-block\">\r\n          <label>Generate from description (AI, uses Sprint Board rules)</label>\r\n          <textarea id=\"action-description-draft\" rows=\"2\" placeholder=\"e.g. Add JWT validation to the API\">${isEdit && action ? escapeHtml([taskText(action), descriptionText(action)].filter(Boolean).join('\\n\\n')) : ''}</textarea>\r\n          <div class=\"action-generate-buttons mt-1\">\r\n            <button type=\"button\" class=\"btn btn-secondary btn-sm\" id=\"action-generate-btn\">Generate from description</button>\r\n            ${isEdit && action ? '<button type=\"button\" class=\"btn btn-outline-secondary btn-sm\" id=\"action-regenerate-ai-btn\">Regenerate with AI</button>' : ''}\r\n          </div>\r\n        </div>\r\n        <div class=\"form-group\">\r\n          <label for=\"action-task\">Task (title) *</label>\r\n          <textarea id=\"action-task\" rows=\"2\" required \r\n                    placeholder=\"Concrete action e.g. Implementar validao JWT no backend\">${escapeHtml(taskText(action))}</textarea>\r\n        </div>\r\n        <div class=\"form-row\">\r\n          <div class=\"form-group\">\r\n            <label for=\"action-parent-story-id\">Parent User Story</label>\r\n            <div class=\"form-row-inline\">\r\n              <select id=\"action-parent-story-id\">\r\n                <option value=\"\"> None </option>\r\n              </select>\r\n              <button type=\"button\" class=\"btn btn-secondary btn-sm\" id=\"action-new-story-btn\">New story</button>\r\n              <button type=\"button\" class=\"btn btn-outline-secondary btn-sm\" id=\"action-edit-story-btn\" title=\"Edit selected story (title, story points)\">Edit story</button>\r\n            </div>\r\n          </div>\r\n          <div class=\"form-group\">\r\n            <label for=\"action-size\">Size (estimate)</label>\r\n            <input type=\"text\" id=\"action-size\" \r\n                   value=\"${escapeHtml(sizeEstimate(action))}\" \r\n                   placeholder=\"e.g. 1 day, 8h (max 8h)\">\r\n          </div>\r\n        </div>\r\n        <div class=\"form-group\">\r\n          <label for=\"action-sprint-id\">Sprint</label>\r\n          <select id=\"action-sprint-id\">\r\n            <option value=\"\"> None </option>\r\n          </select>\r\n        </div>\r\n        <div class=\"form-group\">\r\n          <label for=\"action-task-points\">Task points (optional)</label>\r\n          <input type=\"number\" id=\"action-task-points\" min=\"0\" step=\"1\" \r\n                 value=\"${action?.task_points != null ? String(action.task_points) : ''}\" \r\n                 placeholder=\"e.g. 2\">\r\n        </div>\r\n        <div class=\"form-group\">\r\n          <label for=\"action-depends-on\">Depends on (other tasks)</label>\r\n          <select id=\"action-depends-on\" multiple class=\"form-select-multi\">\r\n            <option value=\"\" disabled>Loading...</option>\r\n          </select>\r\n        </div>\r\n        \r\n        <div class=\"form-group\">\r\n          <label for=\"action-description\">Description (technical)</label>\r\n          <textarea id=\"action-description\" rows=\"3\" \r\n                    placeholder=\"Implementation notes\">${escapeHtml(descriptionText(action))}</textarea>\r\n        </div>\r\n        \r\n        <div class=\"form-row\">\r\n          <div class=\"form-group\">\r\n            <label for=\"action-priority\">Priority</label>\r\n            <select id=\"action-priority\">\r\n              <option value=\"low\" ${action?.priority === 'low' ? 'selected' : ''}>Low</option>\r\n              <option value=\"medium\" ${action?.priority === 'medium' || !action ? 'selected' : ''}>Medium</option>\r\n              <option value=\"high\" ${action?.priority === 'high' ? 'selected' : ''}>High</option>\r\n            </select>\r\n          </div>\r\n          \r\n          <div class=\"form-group\">\r\n            <label for=\"action-status\">Status</label>\r\n            <select id=\"action-status\">\r\n              <option value=\"pending\" ${action?.status === 'pending' || !action ? 'selected' : ''}>Pending</option>\r\n              <option value=\"in_progress\" ${action?.status === 'in_progress' ? 'selected' : ''}>Active (In Progress)</option>\r\n              <option value=\"completed\" ${action?.status === 'completed' ? 'selected' : ''}>Completed</option>\r\n              <option value=\"cancelled\" ${action?.status === 'cancelled' ? 'selected' : ''}>Cancelled</option>\r\n            </select>\r\n          </div>\r\n        </div>\r\n        \r\n        <div class=\"form-row\">\r\n          <div class=\"form-group\">\r\n            <label for=\"action-assignee\">Assignee</label>\r\n            <input type=\"text\" id=\"action-assignee\" \r\n                   value=\"${escapeHtml(action?.assignee ?? action?.owner ?? '')}\" \r\n                   placeholder=\"Who is responsible?\">\r\n          </div>\r\n          \r\n          <div class=\"form-group\">\r\n            <label for=\"action-due\">Due Date</label>\r\n            <input type=\"date\" id=\"action-due\" \r\n                   value=\"${dueDateText(action)}\">\r\n          </div>\r\n        </div>\r\n        \r\n        <div class=\"form-group action-requester-picker-wrap\">\r\n          <label>Requested by (optional)</label>\r\n          <input type=\"hidden\" id=\"action-requested-by-contact-id\" value=\"${escapeHtml((action?.requested_by_contact_id as string) ?? '')}\">\r\n          <input type=\"hidden\" id=\"action-requested-by\" value=\"${escapeHtml((action?.requested_by as string) ?? '')}\">\r\n          <div class=\"action-assignee-picker-trigger\" id=\"action-modal-requester-trigger\" title=\"Select who requested this task\">\r\n            <span class=\"action-assignee-picker-value\" id=\"action-modal-requester-value\">${(action?.requested_by) ? escapeHtml(action.requested_by as string) : '<span class=\"text-muted\">Select requester...</span>'}</span>\r\n            <svg width=\"16\" height=\"16\" fill=\"none\" viewBox=\"0 0 24 24\" stroke=\"currentColor\"><path stroke-linecap=\"round\" stroke-linejoin=\"round\" stroke-width=\"2\" d=\"M19 9l-7 7-7-7\"/></svg>\r\n          </div>\r\n          <div id=\"action-modal-requester-dropdown\" class=\"action-assignee-picker-dropdown hidden\">\r\n            <div class=\"action-assignee-picker-search\">\r\n              <input type=\"text\" id=\"action-modal-requester-search\" placeholder=\"Search contacts...\" autocomplete=\"off\">\r\n            </div>\r\n            <div id=\"action-modal-requester-list\" class=\"action-assignee-picker-list\">Loading...</div>\r\n          </div>\r\n        </div>\r\n        \r\n        <div class=\"form-group\">\r\n          <label for=\"action-dod\">Definition of Done (one per line)</label>\r\n          <textarea id=\"action-dod\" rows=\"3\" \r\n                    placeholder=\"e.g. Cdigo testado localmente&#10;PR criado e revisto\">${escapeHtml(dodStr)}</textarea>\r\n        </div>\r\n        \r\n        <div class=\"form-group\">\r\n          <label for=\"action-ac\">Acceptance Criteria (one per line)</label>\r\n          <textarea id=\"action-ac\" rows=\"3\" \r\n                    placeholder=\"e.g. Middleware rejeita tokens invlidos com 401&#10;Testes unitrios passam\">${escapeHtml(acStr)}</textarea>\r\n        </div>\r\n      </form>\r\n    `;\r\n  }\r\n\r\n  // Footer\r\n  const footer = createElement('div', { className: 'modal-footer' });\r\n\r\n  if (isView && action) {\r\n    const editBtn = createElement('button', {\r\n      className: 'btn btn-primary',\r\n      textContent: 'Edit',\r\n    });\r\n\r\n    const closeBtn = createElement('button', {\r\n      className: 'btn btn-secondary',\r\n      textContent: 'Close',\r\n    });\r\n\r\n    // Quick complete button if not completed\r\n    if (action.status !== 'completed') {\r\n      const completeBtn = createElement('button', {\r\n        className: 'btn btn-success',\r\n        textContent: 'Mark Complete',\r\n      });\r\n\r\n      on(completeBtn, 'click', async () => {\r\n        try {\r\n          const updated = await actionsService.update(action.id, { status: 'completed' });\r\n          toast.success('Action completed');\r\n          onSave?.(updated);\r\n          closeModal(MODAL_ID);\r\n        } catch {\r\n          // Error shown by API service\r\n        }\r\n      });\r\n\r\n      footer.appendChild(completeBtn);\r\n    }\r\n\r\n    on(closeBtn, 'click', () => closeModal(MODAL_ID));\r\n    on(editBtn, 'click', () => {\r\n      closeModal(MODAL_ID);\r\n      showActionModal({ ...props, mode: 'edit' });\r\n    });\r\n\r\n    footer.appendChild(closeBtn);\r\n    footer.appendChild(editBtn);\r\n  } else {\r\n    const cancelBtn = createElement('button', {\r\n      className: 'btn btn-secondary',\r\n      textContent: 'Cancel',\r\n    });\r\n\r\n    const saveBtn = createElement('button', {\r\n      className: 'btn btn-primary',\r\n      textContent: isEdit ? 'Save Changes' : 'Create Action',\r\n    });\r\n\r\n    on(cancelBtn, 'click', () => closeModal(MODAL_ID));\r\n\r\n    on(saveBtn, 'click', async () => {\r\n      const form = content.querySelector('#action-form') as HTMLFormElement;\r\n      if (!form.checkValidity()) {\r\n        form.reportValidity();\r\n        return;\r\n      }\r\n\r\n      const getValue = (id: string) => (content.querySelector(`#${id}`) as HTMLInputElement | HTMLTextAreaElement | HTMLSelectElement)?.value.trim() || '';\r\n      const lines = (id: string) => getValue(id).split(/\\n/).map((s: string) => s.trim()).filter(Boolean);\r\n\r\n      const contentVal = getValue('action-task');\r\n      const parentStoryIdEl = content.querySelector('#action-parent-story-id') as HTMLSelectElement;\r\n      const dependsOnEl = content.querySelector('#action-depends-on') as HTMLSelectElement;\r\n      const parentStoryId = parentStoryIdEl?.value?.trim() || undefined;\r\n      const dependsOn = dependsOnEl ? Array.from((dependsOnEl as HTMLSelectElement).selectedOptions).map(o => o.value).filter(Boolean) : [];\r\n\r\n      const sprintIdEl = content.querySelector('#action-sprint-id') as HTMLSelectElement;\r\n      const sprintId = sprintIdEl?.value?.trim() || undefined;\r\n      const payload = {\r\n        content: contentVal,\r\n        status: getValue('action-status') as Action['status'],\r\n        priority: getValue('action-priority') as Action['priority'],\r\n        assignee: getValue('action-assignee') || undefined,\r\n        due_date: getValue('action-due') || undefined,\r\n        parent_story_id: parentStoryId,\r\n        size_estimate: getValue('action-size') || undefined,\r\n        description: getValue('action-description') || undefined,\r\n        definition_of_done: lines('action-dod'),\r\n        acceptance_criteria: lines('action-ac'),\r\n        depends_on: dependsOn.length ? dependsOn : undefined,\r\n        requested_by: getValue('action-requested-by') || undefined,\r\n        requested_by_contact_id: getValue('action-requested-by-contact-id') || undefined,\r\n        sprint_id: sprintId,\r\n        task_points: (() => {\r\n          const v = getValue('action-task-points');\r\n          if (v === '' || v == null) return undefined;\r\n          const n = Number(v);\r\n          return Number.isFinite(n) && n >= 0 ? n : undefined;\r\n        })(),\r\n      };\r\n\r\n      saveBtn.disabled = true;\r\n      saveBtn.textContent = 'Saving...';\r\n\r\n      try {\r\n        if (isEdit) {\r\n          const updated = await actionsService.update(action!.id, payload);\r\n          toast.success('Action updated');\r\n          onSave?.(updated);\r\n        } else {\r\n          const created = await actionsService.create(payload);\r\n          toast.success('Action created');\r\n          onSave?.(created);\r\n        }\r\n\r\n        closeModal(MODAL_ID);\r\n      } catch {\r\n        // Error shown by API service\r\n      } finally {\r\n        saveBtn.disabled = false;\r\n        saveBtn.textContent = isEdit ? 'Save Changes' : 'Create Action';\r\n      }\r\n    });\r\n\r\n    if (isEdit) {\r\n      const deleteBtn = createElement('button', {\r\n        className: 'btn btn-danger',\r\n        textContent: 'Delete',\r\n      });\r\n\r\n      on(deleteBtn, 'click', async () => {\r\n        const { confirm } = await import('../Modal');\r\n        const confirmed = await confirm(\r\n          'Are you sure you want to delete this action?',\r\n          {\r\n            title: 'Delete Action',\r\n            confirmText: 'Delete',\r\n            confirmClass: 'btn-danger',\r\n          }\r\n        );\r\n\r\n        if (confirmed) {\r\n          try {\r\n            await actionsService.delete(action!.id);\r\n            toast.success('Action deleted');\r\n            onDelete?.(String(action!.id));\r\n            closeModal(MODAL_ID);\r\n          } catch {\r\n            // Error shown by API service\r\n          }\r\n        }\r\n      });\r\n\r\n      footer.appendChild(deleteBtn);\r\n    }\r\n\r\n    footer.appendChild(cancelBtn);\r\n    footer.appendChild(saveBtn);\r\n  }\r\n\r\n  // Create modal\r\n  const modal = createModal({\r\n    id: MODAL_ID,\r\n    title: isView ? 'Action Details' : (isEdit ? 'Edit Action' : 'New Action'),\r\n    content,\r\n    size: 'md',\r\n    footer,\r\n  });\r\n\r\n  document.body.appendChild(modal);\r\n  openModal(MODAL_ID);\r\n\r\n  if (isView && action && (action.requested_by || (action as { requested_by_contact_id?: string }).requested_by_contact_id)) {\r\n    const cardEl = content.querySelector('#action-view-requester-card') as HTMLElement;\r\n    if (cardEl) {\r\n      (async () => {\r\n        try {\r\n          const res = await contactsService.getAll();\r\n          const contacts = (res?.contacts || []) as { id?: string; name?: string; role?: string; photoUrl?: string; avatarUrl?: string }[];\r\n          const cid = (action as { requested_by_contact_id?: string }).requested_by_contact_id;\r\n          const contact = cid\r\n            ? contacts.find((c) => c.id && String(c.id) === String(cid))\r\n            : contacts.find(\r\n              (c) =>\r\n                (c.name || '').trim().toLowerCase() === (action.requested_by as string)?.trim().toLowerCase() ||\r\n                (c.name || '').toLowerCase().includes((action.requested_by as string)?.toLowerCase() || '')\r\n            );\r\n          const name = contact?.name ?? (action.requested_by as string) ?? '';\r\n          const role = contact?.role ?? '';\r\n          const photoUrl = contact?.photoUrl || contact?.avatarUrl || null;\r\n          const initials = name ? name.trim().split(/\\s+/).map((s) => s[0]).join('').toUpperCase().substring(0, 2) : '?';\r\n          if (contact) {\r\n            cardEl.innerHTML = `\r\n              <div class=\"action-view-requester-card-inner assignee-chip\">\r\n                <div class=\"assignee-avatar\">${photoUrl ? `<img src=\"${escapeHtml(photoUrl)}\" alt=\"${escapeHtml(name)}\" onerror=\"this.parentElement.innerHTML='${initials}'\">` : initials}</div>\r\n                <div class=\"action-assignee-card-info\">\r\n                  <div class=\"action-assignee-card-name\">${escapeHtml(name)}</div>\r\n                  ${role ? `<div class=\"action-assignee-card-role\">${escapeHtml(role)}</div>` : ''}\r\n                </div>\r\n              </div>\r\n            `;\r\n          }\r\n        } catch {\r\n          /* keep text fallback */\r\n        }\r\n      })();\r\n    }\r\n  }\r\n\r\n  if (!isView && content) {\r\n    (async () => {\r\n      const stories = await actionsService.getUserStories();\r\n      const parentSelect = content.querySelector('#action-parent-story-id') as HTMLSelectElement;\r\n      if (parentSelect) {\r\n        parentSelect.innerHTML = '<option value=\"\"> None </option>';\r\n        stories.forEach(s => {\r\n          const opt = document.createElement('option');\r\n          opt.value = s.id;\r\n          opt.textContent = s.story_points != null ? `${s.title} (${s.story_points} pt)` : s.title;\r\n          if (action?.parent_story_id && String(s.id) === String(action.parent_story_id)) opt.selected = true;\r\n          parentSelect.appendChild(opt);\r\n        });\r\n      }\r\n      const sprints = await getSprints();\r\n      const sprintSelect = content.querySelector('#action-sprint-id') as HTMLSelectElement;\r\n      if (sprintSelect) {\r\n        sprintSelect.innerHTML = '<option value=\"\"> None </option>';\r\n        sprints.forEach(s => {\r\n          const opt = document.createElement('option');\r\n          opt.value = s.id;\r\n          opt.textContent = s.name;\r\n          if (action?.sprint_id && String(s.id) === String(action.sprint_id)) opt.selected = true;\r\n          sprintSelect.appendChild(opt);\r\n        });\r\n      }\r\n      const actions = await actionsService.getAll();\r\n      const depSelect = content.querySelector('#action-depends-on') as HTMLSelectElement;\r\n      if (depSelect) {\r\n        depSelect.innerHTML = '';\r\n        const currentId = action?.id ? String(action.id) : '';\r\n        actions.filter(a => String(a.id) !== currentId).forEach(a => {\r\n          const opt = document.createElement('option');\r\n          opt.value = String(a.id);\r\n          opt.textContent = ((a.content || a.task) || '').substring(0, 60) + (((a.content || a.task) || '').length > 60 ? '...' : '');\r\n          if (Array.isArray(action?.depends_on) && action.depends_on.includes(String(a.id))) opt.selected = true;\r\n          depSelect.appendChild(opt);\r\n        });\r\n      }\r\n    })();\r\n    const newStoryBtn = content.querySelector('#action-new-story-btn');\r\n    if (newStoryBtn) {\r\n      on(newStoryBtn as HTMLElement, 'click', async () => {\r\n        const title = window.prompt('User story title');\r\n        if (!title?.trim()) return;\r\n        const pointsInput = window.prompt('Story points (optional, number). Leave empty to skip.');\r\n        let story_points: number | undefined;\r\n        if (pointsInput != null && pointsInput.trim() !== '') {\r\n          const n = Number(pointsInput.trim());\r\n          if (Number.isFinite(n) && n >= 0) story_points = n;\r\n        }\r\n        try {\r\n          const story = await actionsService.addUserStory({ title: title.trim(), story_points });\r\n          const parentSelect = content.querySelector('#action-parent-story-id') as HTMLSelectElement;\r\n          if (parentSelect) {\r\n            const opt = document.createElement('option');\r\n            opt.value = story.id;\r\n            opt.textContent = story.story_points != null ? `${story.title} (${story.story_points} pt)` : story.title;\r\n            opt.selected = true;\r\n            parentSelect.appendChild(opt);\r\n          }\r\n          toast.success('User story created');\r\n        } catch (e) {\r\n          toast.error((e as Error).message || 'Failed to create story');\r\n        }\r\n      });\r\n    }\r\n    const editStoryBtn = content.querySelector('#action-edit-story-btn');\r\n    if (editStoryBtn) {\r\n      on(editStoryBtn as HTMLElement, 'click', async () => {\r\n        const parentSelect = content.querySelector('#action-parent-story-id') as HTMLSelectElement;\r\n        const storyId = parentSelect?.value?.trim();\r\n        if (!storyId) {\r\n          toast.error('Select a user story first');\r\n          return;\r\n        }\r\n        try {\r\n          const story = await actionsService.getUserStory(storyId);\r\n          if (!story) {\r\n            toast.error('Story not found');\r\n            return;\r\n          }\r\n          const newTitle = window.prompt('User story title', story.title);\r\n          if (newTitle == null) return;\r\n          const title = newTitle.trim();\r\n          if (!title) {\r\n            toast.error('Title is required');\r\n            return;\r\n          }\r\n          const pointsInput = window.prompt('Story points (optional, number). Leave empty to clear.', story.story_points != null ? String(story.story_points) : '');\r\n          let story_points: number | null | undefined = undefined;\r\n          if (pointsInput != null) {\r\n            if (pointsInput.trim() === '') story_points = null;\r\n            else {\r\n              const n = Number(pointsInput.trim());\r\n              if (Number.isFinite(n) && n >= 0) story_points = n;\r\n            }\r\n          }\r\n          await actionsService.updateUserStory(storyId, { title, ...(story_points !== undefined ? { story_points } : {}) });\r\n          if (parentSelect) {\r\n            const opt = parentSelect.selectedOptions?.[0];\r\n            if (opt) opt.textContent = story_points != null ? `${title} (${story_points} pt)` : title;\r\n          }\r\n          toast.success('User story updated');\r\n        } catch (e) {\r\n          toast.error((e as Error).message || 'Failed to update story');\r\n        }\r\n      });\r\n    }\r\n    const runGenerateFromDraft = async (btn: HTMLButtonElement, btnLabel: string) => {\r\n      const draftEl = content.querySelector('#action-description-draft') as HTMLTextAreaElement;\r\n      const draft = draftEl?.value?.trim() || '';\r\n      if (!draft) {\r\n        toast.error('Enter a short description first');\r\n        return;\r\n      }\r\n      btn.textContent = 'Generating...';\r\n      btn.disabled = true;\r\n      try {\r\n        const parentSelect = content.querySelector('#action-parent-story-id') as HTMLSelectElement;\r\n        const parentRef = parentSelect?.selectedOptions?.[0]?.textContent || '';\r\n        const result = await actionsService.suggestTaskFromDescription({ user_input: draft, parent_story_ref: parentRef || undefined });\r\n        (content.querySelector('#action-task') as HTMLTextAreaElement).value = result.task;\r\n        (content.querySelector('#action-description') as HTMLTextAreaElement).value = result.description;\r\n        (content.querySelector('#action-size') as HTMLInputElement).value = result.size_estimate;\r\n        (content.querySelector('#action-dod') as HTMLTextAreaElement).value = result.definition_of_done.join('\\n');\r\n        (content.querySelector('#action-ac') as HTMLTextAreaElement).value = result.acceptance_criteria.join('\\n');\r\n        toast.success(btn.id === 'action-regenerate-ai-btn' ? 'Task regenerated with AI' : 'Task generated from description');\r\n      } catch (e) {\r\n        toast.error((e as Error).message || 'Failed to generate');\r\n      } finally {\r\n        btn.disabled = false;\r\n        btn.textContent = btnLabel;\r\n      }\r\n    };\r\n    const genBtn = content.querySelector('#action-generate-btn');\r\n    if (genBtn) {\r\n      on(genBtn as HTMLElement, 'click', () => runGenerateFromDraft(genBtn as HTMLButtonElement, 'Generate from description'));\r\n    }\r\n    const regenBtn = content.querySelector('#action-regenerate-ai-btn');\r\n    if (regenBtn) {\r\n      on(regenBtn as HTMLElement, 'click', () => runGenerateFromDraft(regenBtn as HTMLButtonElement, 'Regenerate with AI'));\r\n    }\r\n    const requesterTrigger = content.querySelector('#action-modal-requester-trigger');\r\n    const requesterDropdown = content.querySelector('#action-modal-requester-dropdown') as HTMLElement;\r\n    const requesterValue = content.querySelector('#action-modal-requester-value');\r\n    const requesterList = content.querySelector('#action-modal-requester-list') as HTMLElement;\r\n    const requesterSearch = content.querySelector('#action-modal-requester-search') as HTMLInputElement;\r\n    const requesterContactIdInput = content.querySelector('#action-requested-by-contact-id') as HTMLInputElement;\r\n    const requesterNameInput = content.querySelector('#action-requested-by') as HTMLInputElement;\r\n    if (requesterTrigger && requesterDropdown && requesterList && requesterContactIdInput && requesterNameInput) {\r\n      let requesterContacts: { id: string; name: string; role?: string }[] = [];\r\n      const escapeHtml = (s: string) => {\r\n        const div = document.createElement('div');\r\n        div.textContent = s;\r\n        return div.innerHTML;\r\n      };\r\n      const getInitials = (name: string) => name.trim().split(/\\s+/).map((s) => s[0]).join('').toUpperCase().substring(0, 2);\r\n      const renderRequesterList = (filter = '') => {\r\n        const filtered = filter\r\n          ? requesterContacts.filter(\r\n            (c) =>\r\n              (c.name || '').toLowerCase().includes(filter.toLowerCase()) ||\r\n              (c.role || '').toLowerCase().includes(filter.toLowerCase())\r\n          )\r\n          : requesterContacts;\r\n        if (requesterContacts.length === 0) {\r\n          requesterList.innerHTML = '<div class=\"empty-state\">Loading...</div>';\r\n          return;\r\n        }\r\n        requesterList.innerHTML =\r\n          '<div class=\"action-assignee-card-picker\" data-contact-id=\"\" data-contact-name=\"\"><div class=\"action-assignee-card-info\"><div class=\"action-assignee-card-name text-muted\">No requester</div></div></div>' +\r\n          filtered\r\n            .map(\r\n              (c) => `\r\n            <div class=\"action-assignee-card-picker\" data-contact-id=\"${escapeHtml(c.id)}\" data-contact-name=\"${escapeHtml(c.name || '')}\">\r\n              <div class=\"action-assignee-card-info\">\r\n                <div class=\"action-assignee-card-name\">${escapeHtml(c.name || '')}</div>\r\n                ${c.role ? `<div class=\"action-assignee-card-role\">${escapeHtml(c.role)}</div>` : ''}\r\n              </div>\r\n            </div>\r\n          `\r\n            )\r\n            .join('');\r\n        requesterList.querySelectorAll('.action-assignee-card-picker').forEach((card) => {\r\n          on(card as HTMLElement, 'click', () => {\r\n            const id = card.getAttribute('data-contact-id') || '';\r\n            const name = card.getAttribute('data-contact-name') || '';\r\n            requesterContactIdInput.value = id;\r\n            requesterNameInput.value = name;\r\n            if (requesterValue) requesterValue.innerHTML = name ? escapeHtml(name) : '<span class=\"text-muted\">Select requester...</span>';\r\n            requesterDropdown.classList.add('hidden');\r\n          });\r\n        });\r\n      };\r\n      on(requesterTrigger as HTMLElement, 'click', async (e) => {\r\n        e.stopPropagation();\r\n        const isOpen = !requesterDropdown.classList.contains('hidden');\r\n        requesterDropdown.classList.toggle('hidden', isOpen);\r\n        if (!isOpen && requesterContacts.length === 0) {\r\n          requesterList.innerHTML = '<div class=\"empty-state\">Loading...</div>';\r\n          try {\r\n            const res = await contactsService.getAll();\r\n            requesterContacts = (res?.contacts || []).map((c) => ({ id: c.id, name: c.name || '', role: c.role }));\r\n            renderRequesterList(requesterSearch?.value || '');\r\n          } catch {\r\n            requesterList.innerHTML = '<div class=\"empty-state\">Failed to load contacts</div>';\r\n          }\r\n        } else if (!isOpen) renderRequesterList(requesterSearch?.value || '');\r\n      });\r\n      if (requesterSearch) requesterSearch.addEventListener('input', () => renderRequesterList(requesterSearch.value));\r\n      const closeRequesterDropdown = () => {\r\n        if (requesterDropdown && !requesterDropdown.classList.contains('hidden')) requesterDropdown.classList.add('hidden');\r\n      };\r\n      let removed = false;\r\n      const removeListeners = () => {\r\n        if (removed) return;\r\n        removed = true;\r\n        document.removeEventListener('click', clickHandler);\r\n        document.removeEventListener('keydown', keyHandler);\r\n      };\r\n      const clickHandler = (e: MouseEvent) => {\r\n        const modalEl = document.querySelector(`[data-modal-id=\"${MODAL_ID}\"]`);\r\n        if (!modalEl?.classList.contains('open')) {\r\n          removeListeners();\r\n          return;\r\n        }\r\n        const target = e.target as HTMLElement;\r\n        if (!target.closest('.action-requester-picker-wrap')) closeRequesterDropdown();\r\n      };\r\n      const keyHandler = (e: KeyboardEvent) => {\r\n        const modalEl = document.querySelector(`[data-modal-id=\"${MODAL_ID}\"]`);\r\n        if (!modalEl?.classList.contains('open')) {\r\n          removeListeners();\r\n          return;\r\n        }\r\n        if (e.key === 'Escape') closeRequesterDropdown();\r\n      };\r\n      document.addEventListener('click', clickHandler);\r\n      document.addEventListener('keydown', keyHandler);\r\n    }\r\n  }\r\n}\r\n\r\n/**\r\n * Escape HTML\r\n */\r\nfunction escapeHtml(text: string): string {\r\n  const div = document.createElement('div');\r\n  div.textContent = text;\r\n  return div.innerHTML;\r\n}\r\n\r\nexport default showActionModal;\r\n","/**\r\n * Create Sprint Modal\r\n * Create sprint, generate tasks from emails/transcripts, preview and apply\r\n */\r\n\r\nimport { createElement, on } from '@lib/dom';\r\nimport { createModal, openModal, closeModal } from '../Modal';\r\nimport { createSprint, generateSprintTasks, applySprintGeneration, ProposedTask, Sprint } from '@services/sprints';\r\nimport { toast } from '@services/toast';\r\n\r\nconst MODAL_ID = 'create-sprint-modal';\r\n\r\nfunction escapeHtml(text: string): string {\r\n  const div = document.createElement('div');\r\n  div.textContent = text;\r\n  return div.innerHTML;\r\n}\r\n\r\nexport interface CreateSprintModalProps {\r\n  onSuccess?: (sprint: Sprint) => void;\r\n}\r\n\r\nexport function showCreateSprintModal(props: CreateSprintModalProps = {}): void {\r\n  const { onSuccess } = props;\r\n  const existing = document.querySelector(`[data-modal-id=\"${MODAL_ID}\"]`);\r\n  if (existing) existing.remove();\r\n\r\n  const content = createElement('div', { className: 'create-sprint-modal-content' });\r\n  content.innerHTML = `\r\n    <form id=\"create-sprint-form\" class=\"create-sprint-form\">\r\n      <div class=\"form-group\">\r\n        <label for=\"sprint-name\">Sprint name *</label>\r\n        <input type=\"text\" id=\"sprint-name\" required placeholder=\"e.g. Sprint 12\">\r\n      </div>\r\n      <div class=\"form-row\">\r\n        <div class=\"form-group\">\r\n          <label for=\"sprint-start\">Start date *</label>\r\n          <input type=\"date\" id=\"sprint-start\" required>\r\n        </div>\r\n        <div class=\"form-group\">\r\n          <label for=\"sprint-end\">End date *</label>\r\n          <input type=\"date\" id=\"sprint-end\" required>\r\n        </div>\r\n      </div>\r\n      <div class=\"form-row\">\r\n        <div class=\"form-group\">\r\n          <label for=\"sprint-analysis-start\">Analysis period start</label>\r\n          <input type=\"date\" id=\"sprint-analysis-start\" title=\"From when to consider emails/transcripts\">\r\n        </div>\r\n        <div class=\"form-group\">\r\n          <label for=\"sprint-analysis-end\">Analysis period end</label>\r\n          <input type=\"date\" id=\"sprint-analysis-end\" title=\"Until when to consider emails/transcripts\">\r\n        </div>\r\n      </div>\r\n      <div class=\"form-group\">\r\n        <label for=\"sprint-context\">Sprint context / goals</label>\r\n        <textarea id=\"sprint-context\" rows=\"3\" placeholder=\"What is the focus of this sprint? Goals, priorities...\"></textarea>\r\n      </div>\r\n    </form>\r\n    <div id=\"create-sprint-step2\" class=\"create-sprint-preview hidden\">\r\n      <p class=\"create-sprint-preview-intro\">Review proposed tasks and existing actions to link. Then click Apply.</p>\r\n      <div class=\"form-group\">\r\n        <label>New tasks to create</label>\r\n        <div id=\"create-sprint-new-tasks-list\" class=\"create-sprint-tasks-list\"></div>\r\n      </div>\r\n      <div class=\"form-group\">\r\n        <label>Existing actions to add to this sprint</label>\r\n        <div id=\"create-sprint-existing-list\" class=\"create-sprint-existing-list\"></div>\r\n      </div>\r\n    </div>\r\n  `;\r\n\r\n  const footer = createElement('div', { className: 'modal-footer' });\r\n  footer.innerHTML = `\r\n    <button type=\"button\" class=\"btn btn-secondary\" id=\"create-sprint-cancel-btn\">Cancel</button>\r\n    <button type=\"button\" class=\"btn btn-primary\" id=\"create-sprint-generate-btn\">Create Sprint & Generate Tasks</button>\r\n    <button type=\"button\" class=\"btn btn-primary hidden\" id=\"create-sprint-apply-btn\">Apply</button>\r\n  `;\r\n\r\n  const modal = createModal({\r\n    id: MODAL_ID,\r\n    title: 'Create Sprint',\r\n    content,\r\n    size: 'lg',\r\n    closable: true,\r\n    footer,\r\n    onClose: () => { },\r\n  });\r\n\r\n  document.body.appendChild(modal);\r\n  openModal(MODAL_ID);\r\n\r\n  let createdSprint: Sprint | null = null;\r\n  let proposedNewTasks: ProposedTask[] = [];\r\n  let existingActionIds: string[] = [];\r\n  const existingCheckboxes: Map<string, HTMLInputElement> = new Map();\r\n\r\n  const getVal = (id: string) => (content.querySelector(`#${id}`) as HTMLInputElement | HTMLTextAreaElement)?.value?.trim() || '';\r\n  const form = content.querySelector('#create-sprint-form') as HTMLFormElement;\r\n  const step2 = content.querySelector('#create-sprint-step2') as HTMLElement;\r\n  const generateBtn = content.querySelector('#create-sprint-generate-btn') as HTMLButtonElement;\r\n  const applyBtn = content.querySelector('#create-sprint-apply-btn') as HTMLButtonElement;\r\n  const cancelBtn = content.querySelector('#create-sprint-cancel-btn') as HTMLButtonElement;\r\n\r\n  on(cancelBtn, 'click', () => closeModal(MODAL_ID));\r\n\r\n  on(generateBtn, 'click', async () => {\r\n    if (!form.checkValidity()) {\r\n      form.reportValidity();\r\n      return;\r\n    }\r\n    const name = getVal('sprint-name');\r\n    const start_date = getVal('sprint-start');\r\n    const end_date = getVal('sprint-end');\r\n    if (new Date(end_date) < new Date(start_date)) {\r\n      toast.error('End date must be after start date');\r\n      return;\r\n    }\r\n    generateBtn.disabled = true;\r\n    generateBtn.textContent = 'Creating...';\r\n    try {\r\n      createdSprint = await createSprint({\r\n        name,\r\n        start_date,\r\n        end_date,\r\n        context: getVal('sprint-context') || undefined,\r\n        analysis_start_date: getVal('sprint-analysis-start') || undefined,\r\n        analysis_end_date: getVal('sprint-analysis-end') || undefined,\r\n      });\r\n      generateBtn.textContent = 'Generating tasks...';\r\n      const result = await generateSprintTasks(createdSprint.id, {\r\n        analysis_start_date: getVal('sprint-analysis-start') || undefined,\r\n        analysis_end_date: getVal('sprint-analysis-end') || undefined,\r\n      });\r\n      proposedNewTasks = result.proposed_new_tasks || [];\r\n      existingActionIds = result.existing_action_ids || [];\r\n      const existingDetails = result.existing_details || [];\r\n\r\n      form.classList.add('hidden');\r\n      step2.classList.remove('hidden');\r\n      generateBtn.classList.add('hidden');\r\n      applyBtn.classList.remove('hidden');\r\n\r\n      const newList = content.querySelector('#create-sprint-new-tasks-list') as HTMLElement;\r\n      newList.innerHTML = proposedNewTasks.length\r\n        ? proposedNewTasks.map((t, i) => `\r\n          <div class=\"create-sprint-task-item\" data-index=\"${i}\">\r\n            <div class=\"create-sprint-task-title\">${escapeHtml((t.task || '').slice(0, 120))}${(t.task || '').length > 120 ? '' : ''}</div>\r\n            ${t.size_estimate ? `<span class=\"create-sprint-task-size\">${escapeHtml(t.size_estimate)}</span>` : ''}\r\n          </div>\r\n        `).join('')\r\n        : '<p class=\"text-muted\">No new tasks suggested.</p>';\r\n\r\n      const existingList = content.querySelector('#create-sprint-existing-list') as HTMLElement;\r\n      existingCheckboxes.clear();\r\n      if (existingDetails.length) {\r\n        existingList.innerHTML = existingDetails.map((a) => {\r\n          const checked = existingActionIds.includes(a.id);\r\n          return `\r\n            <label class=\"create-sprint-existing-item\">\r\n              <input type=\"checkbox\" data-action-id=\"${a.id}\" ${checked ? 'checked' : ''}>\r\n              <span>${escapeHtml((a.task || '').slice(0, 80))}${(a.task || '').length > 80 ? '' : ''}</span>\r\n              <span class=\"create-sprint-existing-status\">${escapeHtml(a.status || '')}</span>\r\n            </label>\r\n          `;\r\n        }).join('');\r\n        existingList.querySelectorAll('input[type=checkbox]').forEach((cb) => {\r\n          existingCheckboxes.set((cb as HTMLInputElement).dataset.actionId!, cb as HTMLInputElement);\r\n        });\r\n      } else {\r\n        existingList.innerHTML = '<p class=\"text-muted\">No existing actions suggested.</p>';\r\n      }\r\n      toast.success('Sprint created. Review and click Apply to add tasks.');\r\n    } catch (e) {\r\n      toast.error((e as Error).message || 'Failed');\r\n    } finally {\r\n      generateBtn.disabled = false;\r\n      generateBtn.textContent = 'Create Sprint & Generate Tasks';\r\n    }\r\n  });\r\n\r\n  on(applyBtn, 'click', async () => {\r\n    if (!createdSprint) return;\r\n    const selectedExisting = Array.from(existingCheckboxes.entries())\r\n      .filter(([, el]) => el.checked)\r\n      .map(([id]) => id);\r\n    applyBtn.disabled = true;\r\n    applyBtn.textContent = 'Applying...';\r\n    try {\r\n      await applySprintGeneration(createdSprint.id, {\r\n        new_tasks: proposedNewTasks,\r\n        existing_action_ids: selectedExisting,\r\n      });\r\n      toast.success('Sprint applied. New tasks created and existing actions linked.');\r\n      closeModal(MODAL_ID);\r\n      onSuccess?.(createdSprint);\r\n    } catch (e) {\r\n      toast.error((e as Error).message || 'Apply failed');\r\n    } finally {\r\n      applyBtn.disabled = false;\r\n      applyBtn.textContent = 'Apply';\r\n    }\r\n  });\r\n}\r\n","/**\r\n * Breakdown Chart Widget\r\n * Bar/doughnut chart for sprint report: by status, by assignee\r\n */\r\n\r\nimport { createElement } from '@lib/dom';\r\n\r\nconst STATUS_COLORS: Record<string, string> = {\r\n  pending: 'var(--color-neutral-400)',\r\n  in_progress: 'var(--color-info-500)',\r\n  completed: 'var(--color-success-500)',\r\n  cancelled: 'var(--color-neutral-500)',\r\n  overdue: 'var(--color-danger-500)',\r\n};\r\n\r\nexport interface BreakdownChartProps {\r\n  byStatus: Record<string, number>;\r\n  byAssignee?: Record<string, number>;\r\n  height?: number;\r\n  showAssignee?: boolean;\r\n}\r\n\r\nfunction capitalize(str: string): string {\r\n  return str.replace(/_/g, ' ').replace(/\\b\\w/g, c => c.toUpperCase());\r\n}\r\n\r\n/**\r\n * Create breakdown chart element (by status; optional by assignee)\r\n */\r\nexport function createBreakdownChart(props: BreakdownChartProps): HTMLElement {\r\n  const { byStatus, byAssignee = {}, height = 220, showAssignee = true } = props;\r\n\r\n  const container = createElement('div', { className: 'breakdown-chart-container' });\r\n  container.style.height = `${height}px`;\r\n\r\n  const statusEntries = Object.entries(byStatus).filter(([, v]) => v > 0);\r\n  const assigneeEntries = Object.entries(byAssignee).filter(([, v]) => v > 0);\r\n\r\n  if (statusEntries.length === 0 && assigneeEntries.length === 0) {\r\n    container.innerHTML = '<div class=\"empty-chart\">No data for breakdown</div>';\r\n    return container;\r\n  }\r\n\r\n  const chartId = `breakdown-chart-${Date.now()}`;\r\n  container.innerHTML = `\r\n    <div class=\"breakdown-chart-wrapper\">\r\n      <div class=\"breakdown-chart-section\">\r\n        <div class=\"breakdown-chart-title\">By status</div>\r\n        <canvas id=\"${chartId}-status\" width=\"280\" height=\"${Math.min(180, height - 40)}\"></canvas>\r\n      </div>\r\n      ${showAssignee && assigneeEntries.length > 0 ? `\r\n      <div class=\"breakdown-chart-section\">\r\n        <div class=\"breakdown-chart-title\">By assignee</div>\r\n        <canvas id=\"${chartId}-assignee\" width=\"280\" height=\"${Math.min(180, height - 40)}\"></canvas>\r\n      </div>\r\n      ` : ''}\r\n    </div>\r\n  `;\r\n\r\n  const statusCanvas = container.querySelector(`#${chartId}-status`) as HTMLCanvasElement;\r\n  if (statusCanvas && statusEntries.length > 0) {\r\n    const statusLabels = statusEntries.map(([k]) => capitalize(k));\r\n    const statusValues = statusEntries.map(([, v]) => v);\r\n    const statusKeys = statusEntries.map(([k]) => k);\r\n    initBarChart(statusCanvas, statusLabels, statusValues, (_, i) => STATUS_COLORS[statusKeys[i]] || '#6366f1');\r\n  }\r\n\r\n  if (showAssignee && assigneeEntries.length > 0) {\r\n    const assigneeCanvas = container.querySelector(`#${chartId}-assignee`) as HTMLCanvasElement;\r\n    if (assigneeCanvas) {\r\n      const palette = ['var(--color-info-500)', 'var(--color-success-500)', 'var(--color-warning-500)', 'var(--color-danger-500)', 'var(--color-accent-500)'];\r\n      initBarChart(assigneeCanvas, assigneeEntries.map(([k]) => k || '(unassigned)'), assigneeEntries.map(([, v]) => v), (_, i) => palette[i % palette.length]);\r\n    }\r\n  }\r\n\r\n  return container;\r\n}\r\n\r\nfunction initBarChart(\r\n  canvas: HTMLCanvasElement,\r\n  labels: string[],\r\n  values: number[],\r\n  colorFn: (label: string, index: number) => string\r\n): void {\r\n  if (typeof (window as unknown as { Chart?: unknown }).Chart === 'undefined') {\r\n    renderFallbackBars(canvas.parentElement as HTMLElement, labels, values, (l, i) => colorFn(l, i));\r\n    return;\r\n  }\r\n\r\n  const Chart = (window as unknown as { Chart: typeof import('chart.js').Chart }).Chart;\r\n  const colors = labels.map((l, i) => colorFn(l, i));\r\n\r\n  new Chart(canvas, {\r\n    type: 'bar',\r\n    data: {\r\n      labels,\r\n      datasets: [{\r\n        label: 'Count',\r\n        data: values,\r\n        backgroundColor: colors,\r\n        borderColor: colors.map(c => c),\r\n        borderWidth: 1,\r\n      }],\r\n    },\r\n    options: {\r\n      responsive: true,\r\n      maintainAspectRatio: false,\r\n      plugins: {\r\n        legend: { display: false },\r\n      },\r\n      scales: {\r\n        y: { beginAtZero: true, ticks: { stepSize: 1 } },\r\n      },\r\n    },\r\n  });\r\n}\r\n\r\nfunction renderFallbackBars(\r\n  container: HTMLElement,\r\n  labels: string[],\r\n  values: number[],\r\n  colorFn: (label: string, index: number) => string\r\n): void {\r\n  const max = Math.max(...values, 1);\r\n  const bars = labels.map((label, i) => {\r\n    const v = values[i];\r\n    const pct = (v / max) * 100;\r\n    const color = colorFn(label, i);\r\n    return `<div class=\"breakdown-fallback-bar\"><span class=\"bar-label\">${escapeHtml(label)}</span><div class=\"bar-track\"><div class=\"bar-fill\" style=\"width:${pct}%;background:${color}\"></div></div><span class=\"bar-value\">${v}</span></div>`;\r\n  }).join('');\r\n  const wrap = document.createElement('div');\r\n  wrap.className = 'breakdown-fallback';\r\n  wrap.innerHTML = bars;\r\n  container.appendChild(wrap);\r\n}\r\n\r\nfunction escapeHtml(text: string): string {\r\n  const div = document.createElement('div');\r\n  div.textContent = text;\r\n  return div.innerHTML;\r\n}\r\n\r\nexport default createBreakdownChart;\r\n","/**\r\n * Sprint Report Modal\r\n * Full report: breakdown chart, task list, AI analysis, business report\r\n */\r\n\r\nimport { createElement, on } from '@lib/dom';\r\nimport { createModal, openModal, closeModal } from '../Modal';\r\nimport {\r\n  getSprintReport,\r\n  analyzeSprintReport,\r\n  getSprintBusinessReport,\r\n  generateSprintReportDocument,\r\n  generateSprintReportPresentation,\r\n  type SprintReport,\r\n  type ReportDocumentStyle,\r\n} from '@services/sprints';\r\nimport { createBreakdownChart } from '@components/widgets/BreakdownChart';\r\nimport { toast } from '@services/toast';\r\n\r\nconst MODAL_ID = 'sprint-report-modal';\r\n\r\nfunction escapeHtml(text: string): string {\r\n  const div = document.createElement('div');\r\n  div.textContent = text;\r\n  return div.innerHTML;\r\n}\r\n\r\nexport interface SprintReportModalProps {\r\n  sprintId: string;\r\n  sprintName?: string;\r\n  onClose?: () => void;\r\n}\r\n\r\nexport function showSprintReportModal(props: SprintReportModalProps): void {\r\n  const { sprintId, sprintName = 'Sprint', onClose } = props;\r\n  const existing = document.querySelector(`[data-modal-id=\"${MODAL_ID}\"]`);\r\n  if (existing) existing.remove();\r\n\r\n  const content = createElement('div', { className: 'sprint-report-modal-content' });\r\n  content.innerHTML = `\r\n    <div class=\"sprint-report-loading\">Loading report...</div>\r\n    <div id=\"sprint-report-body\" class=\"sprint-report-body hidden\">\r\n      <div class=\"sprint-report-export-section\">\r\n        <h4>Export as</h4>\r\n        <div class=\"sprint-report-format-row\">\r\n          <label class=\"sprint-report-format-option\">\r\n            <input type=\"radio\" name=\"sprint-report-format\" value=\"document\" checked> Document (A4)\r\n          </label>\r\n          <label class=\"sprint-report-format-option\">\r\n            <input type=\"radio\" name=\"sprint-report-format\" value=\"presentation\"> Presentation (PPT)\r\n          </label>\r\n        </div>\r\n        <div id=\"sprint-report-document-options\" class=\"sprint-report-format-options\">\r\n          <label class=\"sprint-report-style-row\">\r\n            <span>Style:</span>\r\n            <select id=\"sprint-report-document-style\">\r\n              <option value=\"\">Default</option>\r\n              <option value=\"sprint_report_style_corporate_classic\">Corporativo clssico</option>\r\n              <option value=\"sprint_report_style_modern_minimal\">Moderno minimalista</option>\r\n              <option value=\"sprint_report_style_startup_tech\">Startup / Tech</option>\r\n              <option value=\"sprint_report_style_consultancy\">Consultoria / Enterprise</option>\r\n            </select>\r\n          </label>\r\n          <label class=\"sprint-report-check\"><input type=\"checkbox\" id=\"sprint-report-include-analysis\"> Include AI analysis</label>\r\n          <label class=\"sprint-report-check\"><input type=\"checkbox\" id=\"sprint-report-include-business\"> Include business report</label>\r\n        </div>\r\n        <div id=\"sprint-report-presentation-options\" class=\"sprint-report-format-options hidden\">\r\n          <label class=\"sprint-report-check\"><input type=\"checkbox\" id=\"sprint-report-ppt-include-analysis\"> Include AI analysis</label>\r\n          <label class=\"sprint-report-check\"><input type=\"checkbox\" id=\"sprint-report-ppt-include-business\"> Include business report</label>\r\n        </div>\r\n        <div class=\"sprint-report-generate-row\">\r\n          <button type=\"button\" class=\"btn btn-primary\" id=\"sprint-report-generate-doc-btn\">Generate document (A4)</button>\r\n          <button type=\"button\" class=\"btn btn-primary hidden\" id=\"sprint-report-generate-ppt-btn\">Generate presentation (PPT)</button>\r\n          <label class=\"sprint-report-check sprint-report-pdf-option\"><input type=\"checkbox\" id=\"sprint-report-open-for-pdf\"> Open for PDF (print dialog)</label>\r\n        </div>\r\n        <div id=\"sprint-report-generate-status\" class=\"sprint-report-generate-status hidden\"></div>\r\n      </div>\r\n      <div class=\"sprint-report-summary\" id=\"sprint-report-summary\"></div>\r\n      <div class=\"sprint-report-chart\" id=\"sprint-report-chart\"></div>\r\n      <div class=\"sprint-report-actions-list\" id=\"sprint-report-actions\"></div>\r\n      <div class=\"sprint-report-ai-section\">\r\n        <h4>AI analysis</h4>\r\n        <div id=\"sprint-report-ai-placeholder\" class=\"sprint-report-ai-placeholder\">Click \"Analyze with AI\" to generate.</div>\r\n        <div id=\"sprint-report-ai-content\" class=\"sprint-report-ai-content hidden\"></div>\r\n      </div>\r\n      <div class=\"sprint-report-business-section\">\r\n        <h4>Business report</h4>\r\n        <div id=\"sprint-report-business-placeholder\" class=\"sprint-report-business-placeholder\">Click \"Business report\" to generate.</div>\r\n        <div id=\"sprint-report-business-content\" class=\"sprint-report-business-content hidden\"></div>\r\n      </div>\r\n    </div>\r\n    <div id=\"sprint-report-error\" class=\"sprint-report-error hidden\"></div>\r\n  `;\r\n\r\n  const footer = createElement('div', { className: 'modal-footer' });\r\n  footer.innerHTML = `\r\n    <button type=\"button\" class=\"btn btn-outline-secondary\" id=\"sprint-report-export-pdf-btn\">Export report as PDF</button>\r\n    <button type=\"button\" class=\"btn btn-secondary\" id=\"sprint-report-analyze-btn\">Analyze with AI</button>\r\n    <button type=\"button\" class=\"btn btn-outline-primary\" id=\"sprint-report-business-btn\">Business report</button>\r\n    <button type=\"button\" class=\"btn btn-primary\" id=\"sprint-report-close-btn\">Close</button>\r\n  `;\r\n\r\n  const modal = createModal({\r\n    id: MODAL_ID,\r\n    title: `Sprint report: ${escapeHtml(sprintName)}`,\r\n    content,\r\n    size: 'xl',\r\n    closable: true,\r\n    footer,\r\n    onClose: () => {\r\n      onClose?.();\r\n    },\r\n  });\r\n\r\n  document.body.appendChild(modal);\r\n  openModal(MODAL_ID);\r\n\r\n  let reportData: SprintReport | null = null;\r\n\r\n  async function loadReport(): Promise<void> {\r\n    const loading = content.querySelector('.sprint-report-loading') as HTMLElement;\r\n    const body = content.querySelector('#sprint-report-body') as HTMLElement;\r\n    const errEl = content.querySelector('#sprint-report-error') as HTMLElement;\r\n    if (!loading || !body || !errEl) return;\r\n\r\n    try {\r\n      const report = await getSprintReport(sprintId);\r\n      if (!report) {\r\n        errEl.textContent = 'Failed to load report';\r\n        errEl.classList.remove('hidden');\r\n        loading.classList.add('hidden');\r\n        return;\r\n      }\r\n      reportData = report;\r\n      loading.classList.add('hidden');\r\n      errEl.classList.add('hidden');\r\n      body.classList.remove('hidden');\r\n\r\n      const summaryEl = content.querySelector('#sprint-report-summary') as HTMLElement;\r\n      if (summaryEl) {\r\n        const pct = report.total_tasks ? Math.round((report.completed_tasks / report.total_tasks) * 100) : 0;\r\n        const pointsLine =\r\n          report.total_task_points > 0\r\n            ? `  ${report.completed_task_points}/${report.total_task_points} points`\r\n            : '';\r\n        summaryEl.innerHTML = `\r\n          <p><strong>${report.completed_tasks}</strong> / <strong>${report.total_tasks}</strong> tasks completed (${pct}%)${pointsLine}</p>\r\n          <p class=\"sprint-report-dates\">${report.sprint.start_date}  ${report.sprint.end_date}</p>\r\n          ${report.sprint.context ? `<p class=\"sprint-report-context\">${escapeHtml(report.sprint.context)}</p>` : ''}\r\n        `;\r\n      }\r\n\r\n      const chartEl = content.querySelector('#sprint-report-chart') as HTMLElement;\r\n      if (chartEl) {\r\n        chartEl.innerHTML = '';\r\n        chartEl.appendChild(\r\n          createBreakdownChart({\r\n            byStatus: report.breakdown.by_status,\r\n            byAssignee: report.breakdown.by_assignee,\r\n            height: 200,\r\n            showAssignee: true,\r\n          })\r\n        );\r\n      }\r\n\r\n      const listEl = content.querySelector('#sprint-report-actions') as HTMLElement;\r\n      if (listEl && report.actions.length > 0) {\r\n        listEl.innerHTML = `\r\n          <h4>Tasks (${report.actions.length})</h4>\r\n          <ul class=\"sprint-report-task-list\">\r\n            ${report.actions\r\n            .map(\r\n              (a) =>\r\n                `<li class=\"sprint-report-task-item\" data-status=\"${escapeHtml((a.status || 'pending').toLowerCase())}\">\r\n                    <span class=\"task-status-dot\"></span>\r\n                    ${escapeHtml(a.task || a.content || '')}\r\n                    ${a.task_points != null ? `<span class=\"task-points\">${a.task_points} pt</span>` : ''}\r\n                  </li>`\r\n            )\r\n            .join('')}\r\n          </ul>\r\n        `;\r\n      } else if (listEl) {\r\n        listEl.innerHTML = '<p class=\"sprint-report-no-tasks\">No tasks in this sprint.</p>';\r\n      }\r\n    } catch (e) {\r\n      loading.classList.add('hidden');\r\n      body.classList.add('hidden');\r\n      errEl.textContent = e instanceof Error ? e.message : 'Failed to load report';\r\n      errEl.classList.remove('hidden');\r\n    }\r\n  }\r\n\r\n  on(footer.querySelector('#sprint-report-close-btn') as HTMLElement, 'click', () => closeModal(MODAL_ID));\r\n\r\n  /** Build printable HTML from current report data and open print dialog (Save as PDF). */\r\n  function exportReportAsPdf(): void {\r\n    if (!reportData) {\r\n      toast.error('Report not loaded yet');\r\n      return;\r\n    }\r\n    const sprint = reportData.sprint;\r\n    const aiEl = content.querySelector('#sprint-report-ai-content');\r\n    const bizEl = content.querySelector('#sprint-report-business-content');\r\n    const aiHtml = aiEl && !aiEl.classList.contains('hidden') ? aiEl.innerHTML : '';\r\n    const bizHtml = bizEl && !bizEl.classList.contains('hidden') ? bizEl.innerHTML : '';\r\n    const byStatus = reportData.breakdown.by_status || {};\r\n    const byAssignee = reportData.breakdown.by_assignee || {};\r\n    const html = `<!DOCTYPE html><html><head><meta charset=\"utf-8\"><title>Sprint Report  ${escapeHtml(sprint.name)}</title>\r\n<style>\r\n  body { font-family: system-ui, sans-serif; max-width: 800px; margin: 2rem auto; padding: 0 1rem; color: #333; line-height: 1.5; }\r\n  h1 { font-size: 1.5rem; margin-bottom: 0.5rem; }\r\n  h2 { font-size: 1.15rem; margin-top: 1.5rem; margin-bottom: 0.5rem; }\r\n  p, ul { margin: 0.5rem 0; }\r\n  ul { padding-left: 1.5rem; }\r\n  .meta { color: #666; font-size: 0.9rem; }\r\n  .section { margin-top: 1rem; }\r\n  @media print { body { margin: 1rem; } }\r\n</style></head><body>\r\n  <h1>${escapeHtml(sprint.name)}</h1>\r\n  <p class=\"meta\">${escapeHtml(sprint.start_date)}  ${escapeHtml(sprint.end_date)}</p>\r\n  ${sprint.context ? `<p>${escapeHtml(sprint.context)}</p>` : ''}\r\n  <div class=\"section\">\r\n    <h2>Summary</h2>\r\n    <p><strong>${reportData.completed_tasks}</strong> / <strong>${reportData.total_tasks}</strong> tasks completed${reportData.total_task_points > 0 ? `  ${reportData.completed_task_points}/${reportData.total_task_points} points` : ''}.</p>\r\n  </div>\r\n  <div class=\"section\">\r\n    <h2>By status</h2>\r\n    <ul>${Object.entries(byStatus).map(([k, v]) => `<li>${escapeHtml(k)}: ${v}</li>`).join('')}</ul>\r\n  </div>\r\n  <div class=\"section\">\r\n    <h2>By assignee</h2>\r\n    <ul>${Object.entries(byAssignee).map(([k, v]) => `<li>${escapeHtml(k)}: ${v}</li>`).join('')}</ul>\r\n  </div>\r\n  <div class=\"section\">\r\n    <h2>Tasks</h2>\r\n    <ul>${reportData.actions.slice(0, 100).map(a => `<li>${escapeHtml((a.status || 'pending'))}: ${escapeHtml((a.task || a.content || '').substring(0, 200))}${a.task_points != null ? ` (${a.task_points} pt)` : ''}</li>`).join('')}</ul>\r\n    ${reportData.actions.length > 100 ? `<p class=\"meta\"> and ${reportData.actions.length - 100} more tasks</p>` : ''}\r\n  </div>\r\n  ${aiHtml ? `<div class=\"section\"><h2>AI analysis</h2><div>${aiHtml}</div></div>` : ''}\r\n  ${bizHtml ? `<div class=\"section\"><h2>Business report</h2><div>${bizHtml}</div></div>` : ''}\r\n<script>window.onload=function(){window.print();}<\\/script>\r\n</body></html>`;\r\n    const blob = new Blob([html], { type: 'text/html;charset=utf-8' });\r\n    const url = URL.createObjectURL(blob);\r\n    const w = window.open(url, '_blank', 'noopener');\r\n    if (w) {\r\n      w.addEventListener('load', () => URL.revokeObjectURL(url), { once: true });\r\n    } else {\r\n      toast.error('Allow pop-ups to export PDF');\r\n      URL.revokeObjectURL(url);\r\n    }\r\n  }\r\n\r\n  const exportPdfBtn = footer.querySelector('#sprint-report-export-pdf-btn');\r\n  if (exportPdfBtn) on(exportPdfBtn as HTMLElement, 'click', () => exportReportAsPdf());\r\n\r\n  // Format: Document vs Presentation  toggle options and which generate button is visible\r\n  const docOptions = content.querySelector('#sprint-report-document-options') as HTMLElement;\r\n  const pptOptions = content.querySelector('#sprint-report-presentation-options') as HTMLElement;\r\n  const docBtn = content.querySelector('#sprint-report-generate-doc-btn') as HTMLButtonElement;\r\n  const pptBtn = content.querySelector('#sprint-report-generate-ppt-btn') as HTMLButtonElement;\r\n  content.querySelectorAll('input[name=\"sprint-report-format\"]').forEach((radio) => {\r\n    on(radio as HTMLElement, 'change', () => {\r\n      const isDoc = (content.querySelector('input[name=\"sprint-report-format\"]:checked') as HTMLInputElement)?.value === 'document';\r\n      if (docOptions) docOptions.classList.toggle('hidden', !isDoc);\r\n      if (pptOptions) pptOptions.classList.toggle('hidden', isDoc);\r\n      if (docBtn) docBtn.classList.toggle('hidden', !isDoc);\r\n      if (pptBtn) pptBtn.classList.toggle('hidden', isDoc);\r\n    });\r\n  });\r\n\r\n  /** Open generated HTML in new tab; if forPdf, inject script to open print dialog (user can Save as PDF). */\r\n  function openHtmlInNewTab(html: string, forPdf = false): void {\r\n    let out = html;\r\n    if (forPdf) {\r\n      const printScript = '<script>window.onload=function(){window.print();}<\\/script>';\r\n      if (out.includes('</body>')) {\r\n        out = out.replace('</body>', printScript + '</body>');\r\n      } else if (out.includes('</html>')) {\r\n        out = out.replace('</html>', printScript + '</html>');\r\n      } else {\r\n        out = out + printScript;\r\n      }\r\n    }\r\n    const blob = new Blob([out], { type: 'text/html;charset=utf-8' });\r\n    const url = URL.createObjectURL(blob);\r\n    window.open(url, '_blank', 'noopener');\r\n    URL.revokeObjectURL(url);\r\n  }\r\n\r\n  const statusEl = content.querySelector('#sprint-report-generate-status') as HTMLElement;\r\n  if (docBtn) {\r\n    on(docBtn, 'click', async () => {\r\n      if (!statusEl) return;\r\n      docBtn.disabled = true;\r\n      statusEl.classList.remove('hidden');\r\n      statusEl.textContent = 'Generating document';\r\n      try {\r\n        const style = (content.querySelector('#sprint-report-document-style') as HTMLSelectElement)?.value as ReportDocumentStyle | '' || '';\r\n        const includeAnalysis = (content.querySelector('#sprint-report-include-analysis') as HTMLInputElement)?.checked ?? false;\r\n        const includeBusiness = (content.querySelector('#sprint-report-include-business') as HTMLInputElement)?.checked ?? false;\r\n        const result = await generateSprintReportDocument(sprintId, { include_analysis: includeAnalysis, include_business: includeBusiness, style: style || undefined });\r\n        const forPdf = (content.querySelector('#sprint-report-open-for-pdf') as HTMLInputElement)?.checked ?? false;\r\n        statusEl.textContent = forPdf ? 'Done. Opening for PDF' : 'Done. Opening in new tab';\r\n        openHtmlInNewTab(result.html, forPdf);\r\n      } catch (e) {\r\n        toast.error(e instanceof Error ? e.message : 'Failed to generate document');\r\n        statusEl.textContent = '';\r\n      } finally {\r\n        docBtn.disabled = false;\r\n      }\r\n    });\r\n  }\r\n  if (pptBtn) {\r\n    on(pptBtn, 'click', async () => {\r\n      if (!statusEl) return;\r\n      pptBtn.disabled = true;\r\n      statusEl.classList.remove('hidden');\r\n      statusEl.textContent = 'Generating presentation';\r\n      try {\r\n        const includeAnalysis = (content.querySelector('#sprint-report-ppt-include-analysis') as HTMLInputElement)?.checked ?? false;\r\n        const includeBusiness = (content.querySelector('#sprint-report-ppt-include-business') as HTMLInputElement)?.checked ?? false;\r\n        const result = await generateSprintReportPresentation(sprintId, { include_analysis: includeAnalysis, include_business: includeBusiness });\r\n        const forPdf = (content.querySelector('#sprint-report-open-for-pdf') as HTMLInputElement)?.checked ?? false;\r\n        statusEl.textContent = forPdf ? 'Done. Opening for PDF' : 'Done. Opening in new tab';\r\n        openHtmlInNewTab(result.html, forPdf);\r\n      } catch (e) {\r\n        toast.error(e instanceof Error ? e.message : 'Failed to generate presentation');\r\n        statusEl.textContent = '';\r\n      } finally {\r\n        pptBtn.disabled = false;\r\n      }\r\n    });\r\n  }\r\n\r\n  on(footer.querySelector('#sprint-report-analyze-btn') as HTMLElement, 'click', async () => {\r\n    const btn = footer.querySelector('#sprint-report-analyze-btn') as HTMLButtonElement;\r\n    const placeholder = content.querySelector('#sprint-report-ai-placeholder') as HTMLElement;\r\n    const aiContent = content.querySelector('#sprint-report-ai-content') as HTMLElement;\r\n    if (!btn || !placeholder || !aiContent) return;\r\n    btn.disabled = true;\r\n    placeholder.textContent = 'Analyzing...';\r\n    try {\r\n      const result = await analyzeSprintReport(sprintId);\r\n      placeholder.classList.add('hidden');\r\n      aiContent.classList.remove('hidden');\r\n      aiContent.innerHTML = result.ai_analysis\r\n        ? `<div class=\"sprint-report-ai-text\">${escapeHtml(result.ai_analysis).replace(/\\n/g, '<br>')}</div>`\r\n        : `<div class=\"sprint-report-ai-text\">${escapeHtml(result.error || 'No analysis available.')}</div>`;\r\n    } catch (e) {\r\n      toast.error(e instanceof Error ? e.message : 'Analysis failed');\r\n      placeholder.textContent = 'Click \"Analyze with AI\" to generate.';\r\n    } finally {\r\n      btn.disabled = false;\r\n    }\r\n  });\r\n  on(footer.querySelector('#sprint-report-business-btn') as HTMLElement, 'click', async () => {\r\n    const btn = footer.querySelector('#sprint-report-business-btn') as HTMLButtonElement;\r\n    const placeholder = content.querySelector('#sprint-report-business-placeholder') as HTMLElement;\r\n    const bizContent = content.querySelector('#sprint-report-business-content') as HTMLElement;\r\n    if (!btn || !placeholder || !bizContent) return;\r\n    btn.disabled = true;\r\n    placeholder.textContent = 'Generating...';\r\n    try {\r\n      const result = await getSprintBusinessReport(sprintId);\r\n      placeholder.classList.add('hidden');\r\n      bizContent.classList.remove('hidden');\r\n      bizContent.innerHTML = result.business_report\r\n        ? `<div class=\"sprint-report-business-text\">${escapeHtml(result.business_report).replace(/\\n/g, '<br>')}</div>`\r\n        : `<div class=\"sprint-report-business-text\">${escapeHtml(result.error || 'No business report available.')}</div>`;\r\n    } catch (e) {\r\n      toast.error(e instanceof Error ? e.message : 'Business report failed');\r\n      placeholder.textContent = 'Click \"Business report\" to generate.';\r\n    } finally {\r\n      btn.disabled = false;\r\n    }\r\n  });\r\n\r\n  loadReport();\r\n}\r\n","/**\r\n * Comments Thread Component\r\n * Inline comments for entities\r\n */\r\n\r\nimport { createElement, on } from '@lib/dom';\r\nimport { commentsService, Comment } from '@services/notifications';\r\nimport { appStore } from '@stores/app';\r\nimport { toast } from '@services/toast';\r\nimport { formatRelativeTime } from '@lib/format';\r\n\r\nexport interface CommentsThreadProps {\r\n  targetType: 'question' | 'risk' | 'action' | 'decision' | 'contact' | 'document' | 'email';\r\n  targetId: string;\r\n  projectId?: string;\r\n  onCommentAdded?: (comment: Comment) => void;\r\n}\r\n\r\n/**\r\n * Create comments thread\r\n */\r\nexport function createCommentsThread(props: CommentsThreadProps): HTMLElement {\r\n  const container = createElement('div', { className: 'comments-thread' });\r\n\r\n  container.innerHTML = `\r\n    <div class=\"comments-header\">\r\n      <h4>Comments</h4>\r\n      <span class=\"comments-count\" id=\"comments-count\">0</span>\r\n    </div>\r\n    <div class=\"comments-list\" id=\"comments-list\">\r\n      <div class=\"loading\">Loading comments...</div>\r\n    </div>\r\n    <div class=\"comment-form\">\r\n      <textarea id=\"comment-input\" placeholder=\"Add a comment...\" rows=\"2\"></textarea>\r\n      <div class=\"comment-form-actions\">\r\n        <button class=\"btn btn-primary btn-sm\" id=\"submit-comment-btn\" disabled>Comment</button>\r\n      </div>\r\n    </div>\r\n  `;\r\n\r\n  // Bind input\r\n  const input = container.querySelector('#comment-input') as HTMLTextAreaElement;\r\n  const submitBtn = container.querySelector('#submit-comment-btn') as HTMLButtonElement;\r\n\r\n  on(input, 'input', () => {\r\n    submitBtn.disabled = !input.value.trim();\r\n  });\r\n\r\n  on(submitBtn, 'click', () => submitComment(container, props, input));\r\n\r\n  // Submit on Ctrl+Enter\r\n  on(input, 'keydown', (e) => {\r\n    if (e.key === 'Enter' && (e.ctrlKey || e.metaKey)) {\r\n      e.preventDefault();\r\n      if (input.value.trim()) {\r\n        submitComment(container, props, input);\r\n      }\r\n    }\r\n  });\r\n\r\n  // Initial load\r\n  loadComments(container, props);\r\n\r\n  return container;\r\n}\r\n\r\n/**\r\n * Load comments\r\n */\r\nasync function loadComments(container: HTMLElement, props: CommentsThreadProps): Promise<void> {\r\n  const list = container.querySelector('#comments-list') as HTMLElement;\r\n  list.innerHTML = '<div class=\"loading\">Loading...</div>';\r\n\r\n  try {\r\n    const comments = await commentsService.getAll(props.targetType, props.targetId);\r\n\r\n    renderComments(list, comments, container, props);\r\n    updateCount(container, comments.length);\r\n  } catch {\r\n    list.innerHTML = '<div class=\"error\">Failed to load comments</div>';\r\n  }\r\n}\r\n\r\n/**\r\n * Render comments\r\n */\r\nfunction renderComments(\r\n  container: HTMLElement,\r\n  comments: Comment[],\r\n  thread: HTMLElement,\r\n  props: CommentsThreadProps\r\n): void {\r\n  if (comments.length === 0) {\r\n    container.innerHTML = '<div class=\"empty\">No comments yet</div>';\r\n    return;\r\n  }\r\n\r\n  // Group by parent\r\n  const topLevel = comments.filter(c => !c.parent_id);\r\n  const replies = comments.filter(c => c.parent_id);\r\n  const repliesByParent: Record<string, Comment[]> = {};\r\n\r\n  replies.forEach(r => {\r\n    if (!repliesByParent[r.parent_id!]) repliesByParent[r.parent_id!] = [];\r\n    repliesByParent[r.parent_id!].push(r);\r\n  });\r\n\r\n  container.innerHTML = topLevel.map(comment =>\r\n    renderComment(comment, repliesByParent[comment.id] || [], thread, props)\r\n  ).join('');\r\n\r\n  bindCommentEvents(container, comments, thread, props);\r\n}\r\n\r\n/**\r\n * Render single comment\r\n */\r\nfunction renderComment(\r\n  comment: Comment,\r\n  replies: Comment[],\r\n  thread: HTMLElement,\r\n  props: CommentsThreadProps\r\n): string {\r\n  const currentUser = appStore.getState().currentUser;\r\n  const isOwn = currentUser?.id === comment.user_id;\r\n\r\n  return `\r\n    <div class=\"comment ${comment.resolved ? 'resolved' : ''}\" data-id=\"${comment.id}\">\r\n      <div class=\"comment-avatar\">${getInitials(comment.user_name || 'U')}</div>\r\n      <div class=\"comment-body\">\r\n        <div class=\"comment-header\">\r\n          <span class=\"comment-author\">${escapeHtml(comment.user_name || 'Unknown')}</span>\r\n          <span class=\"comment-time\">${formatRelativeTime(comment.created_at)}</span>\r\n          ${comment.resolved ? '<span class=\"resolved-badge\">Resolved</span>' : ''}\r\n        </div>\r\n        <div class=\"comment-content\">${escapeHtml(comment.content)}</div>\r\n        <div class=\"comment-actions\">\r\n          <button class=\"btn-link reply-btn\">Reply</button>\r\n          ${!comment.resolved ? '<button class=\"btn-link resolve-btn\">Resolve</button>' : ''}\r\n          ${isOwn ? '<button class=\"btn-link delete-btn\">Delete</button>' : ''}\r\n        </div>\r\n        <div class=\"reply-form hidden\">\r\n          <textarea class=\"reply-input\" placeholder=\"Reply...\" rows=\"2\"></textarea>\r\n          <div class=\"reply-actions\">\r\n            <button class=\"btn btn-sm cancel-reply-btn\">Cancel</button>\r\n            <button class=\"btn btn-primary btn-sm submit-reply-btn\">Reply</button>\r\n          </div>\r\n        </div>\r\n      </div>\r\n    </div>\r\n    ${replies.length > 0 ? `\r\n      <div class=\"comment-replies\">\r\n        ${replies.map(r => `\r\n          <div class=\"comment reply\" data-id=\"${r.id}\">\r\n            <div class=\"comment-avatar small\">${getInitials(r.user_name || 'U')}</div>\r\n            <div class=\"comment-body\">\r\n              <div class=\"comment-header\">\r\n                <span class=\"comment-author\">${escapeHtml(r.user_name || 'Unknown')}</span>\r\n                <span class=\"comment-time\">${formatRelativeTime(r.created_at)}</span>\r\n              </div>\r\n              <div class=\"comment-content\">${escapeHtml(r.content)}</div>\r\n              ${currentUser?.id === r.user_id ? `\r\n                <div class=\"comment-actions\">\r\n                  <button class=\"btn-link delete-btn\">Delete</button>\r\n                </div>\r\n              ` : ''}\r\n            </div>\r\n          </div>\r\n        `).join('')}\r\n      </div>\r\n    ` : ''}\r\n  `;\r\n}\r\n\r\n/**\r\n * Bind comment events\r\n */\r\nfunction bindCommentEvents(\r\n  container: HTMLElement,\r\n  comments: Comment[],\r\n  thread: HTMLElement,\r\n  props: CommentsThreadProps\r\n): void {\r\n  // Reply buttons\r\n  container.querySelectorAll('.reply-btn').forEach(btn => {\r\n    on(btn as HTMLElement, 'click', () => {\r\n      const comment = btn.closest('.comment');\r\n      const replyForm = comment?.querySelector('.reply-form');\r\n      if (replyForm) {\r\n        replyForm.classList.toggle('hidden');\r\n        const input = replyForm.querySelector('.reply-input') as HTMLTextAreaElement;\r\n        input?.focus();\r\n      }\r\n    });\r\n  });\r\n\r\n  // Cancel reply\r\n  container.querySelectorAll('.cancel-reply-btn').forEach(btn => {\r\n    on(btn as HTMLElement, 'click', () => {\r\n      const replyForm = btn.closest('.reply-form');\r\n      if (replyForm) {\r\n        replyForm.classList.add('hidden');\r\n        (replyForm.querySelector('.reply-input') as HTMLTextAreaElement).value = '';\r\n      }\r\n    });\r\n  });\r\n\r\n  // Submit reply\r\n  container.querySelectorAll('.submit-reply-btn').forEach(btn => {\r\n    on(btn as HTMLElement, 'click', async () => {\r\n      const comment = btn.closest('.comment');\r\n      const id = comment?.getAttribute('data-id');\r\n      const input = comment?.querySelector('.reply-input') as HTMLTextAreaElement;\r\n      if (!id || !input?.value.trim()) return;\r\n\r\n      try {\r\n        await commentsService.create(props.targetType, props.targetId, input.value.trim(), id);\r\n        toast.success('Reply added');\r\n        loadComments(thread, props);\r\n      } catch {\r\n        toast.error('Failed to add reply');\r\n      }\r\n    });\r\n  });\r\n\r\n  // Resolve\r\n  container.querySelectorAll('.resolve-btn').forEach(btn => {\r\n    on(btn as HTMLElement, 'click', async () => {\r\n      const comment = btn.closest('.comment');\r\n      const id = comment?.getAttribute('data-id');\r\n      if (!id) return;\r\n\r\n      try {\r\n        await commentsService.resolve(id);\r\n        toast.success('Comment resolved');\r\n        loadComments(thread, props);\r\n      } catch {\r\n        toast.error('Failed to resolve comment');\r\n      }\r\n    });\r\n  });\r\n\r\n  // Delete\r\n  container.querySelectorAll('.delete-btn').forEach(btn => {\r\n    on(btn as HTMLElement, 'click', async () => {\r\n      const comment = btn.closest('.comment');\r\n      const id = comment?.getAttribute('data-id');\r\n      if (!id || !confirm('Delete this comment?')) return;\r\n\r\n      try {\r\n        await commentsService.delete(id);\r\n        toast.success('Comment deleted');\r\n        loadComments(thread, props);\r\n      } catch {\r\n        toast.error('Failed to delete comment');\r\n      }\r\n    });\r\n  });\r\n}\r\n\r\n/**\r\n * Submit new comment\r\n */\r\nasync function submitComment(\r\n  container: HTMLElement,\r\n  props: CommentsThreadProps,\r\n  input: HTMLTextAreaElement\r\n): Promise<void> {\r\n  const content = input.value.trim();\r\n  if (!content) return;\r\n\r\n  const btn = container.querySelector('#submit-comment-btn') as HTMLButtonElement;\r\n  btn.disabled = true;\r\n\r\n  try {\r\n    const comment = await commentsService.create(props.targetType, props.targetId, content);\r\n\r\n    input.value = '';\r\n    toast.success('Comment added');\r\n    loadComments(container, props);\r\n    props.onCommentAdded?.(comment);\r\n  } catch {\r\n    toast.error('Failed to add comment');\r\n    btn.disabled = false;\r\n  }\r\n}\r\n\r\n/**\r\n * Update count\r\n */\r\nfunction updateCount(container: HTMLElement, count: number): void {\r\n  const countEl = container.querySelector('#comments-count');\r\n  if (countEl) countEl.textContent = String(count);\r\n}\r\n\r\n/**\r\n * Get initials\r\n */\r\nfunction getInitials(name: string): string {\r\n  return name\r\n    .split(' ')\r\n    .map(n => n[0])\r\n    .join('')\r\n    .toUpperCase()\r\n    .slice(0, 2);\r\n}\r\n\r\n/**\r\n * Escape HTML\r\n */\r\nfunction escapeHtml(text: string): string {\r\n  const div = document.createElement('div');\r\n  div.textContent = text;\r\n  return div.innerHTML;\r\n}\r\n\r\nexport default createCommentsThread;\r\n","/**\r\n * App State Selectors\r\n * SOTA pattern for decoupled state access and derived state.\r\n * Ref: Phase 10.2 State Management Hardening\r\n */\r\n\r\nimport { appStore, Project, User, ProjectConfig, AppState } from './app';\r\n\r\n// Base Selectors\r\nexport const selectState = (): AppState => appStore.getState();\r\n\r\nexport const selectCurrentProject = (): Project | null => selectState().currentProject;\r\nexport const selectCurrentProjectId = (): string | null => selectState().currentProjectId;\r\nexport const selectCurrentUser = (): User | null => selectState().currentUser;\r\nexport const selectIsLoading = (): boolean => selectState().isLoading;\r\nexport const selectError = (): string | null => selectState().error;\r\nexport const selectIsOnline = (): boolean => selectState().isOnline;\r\nexport const selectConfig = (): ProjectConfig => selectState().config;\r\n\r\n// Derived Selectors\r\nexport const selectIsAuthenticated = (): boolean => !!selectCurrentUser();\r\nexport const selectProjectName = (): string => selectCurrentProject()?.name || '';\r\nexport const selectProjectSettings = (): Record<string, unknown> => selectCurrentProject()?.settings || {};\r\n\r\nexport const selectAiProvider = (): string => selectConfig().aiProvider || 'openai';\r\nexport const selectAiModel = (): string => selectConfig().aiModel || 'gpt-4';\r\n\r\n/**\r\n * Type-safe selector for specific config keys\r\n */\r\nexport function selectConfigValue<K extends keyof ProjectConfig>(key: K): ProjectConfig[K] | undefined {\r\n    return selectConfig()[key];\r\n}\r\n\r\n/**\r\n * Check if user has specific role\r\n */\r\nexport function selectHasRole(role: User['role']): boolean {\r\n    const user = selectCurrentUser();\r\n    if (!user) return false;\r\n    if (role === 'member') return true; // Everyone is at least member\r\n    if (role === 'admin') return user.role === 'admin' || user.role === 'superadmin';\r\n    return user.role === role;\r\n}\r\n","/**\r\n * Action Detail View\r\n * Full-page view for action details: task, status, priority, assignee, due date, source, timeline\r\n */\r\n\r\nimport { createElement, on } from '@lib/dom';\r\nimport { Action, ActionEvent, ActionAssigneeSuggestion, actionsService } from '@services/actions';\r\nimport { decisionsService, Decision } from '@services/decisions';\r\nimport { contactsService, Contact } from '@services/contacts';\r\nimport { toast } from '@services/toast';\r\nimport { formatRelativeTime, formatDateTime } from '@lib/format';\r\nimport { createCommentsThread } from '../CommentsThread';\r\nimport { appStore } from '@stores/app';\r\nimport { selectCurrentProject } from '@stores/selectors';\r\n\r\nfunction getInitials(name: string): string {\r\n  return name.trim().split(/\\s+/).map((s) => s[0]).join('').toUpperCase().substring(0, 2);\r\n}\r\n\r\nexport interface ActionDetailViewProps {\r\n  action: Action;\r\n  onClose: () => void;\r\n  onUpdate?: (action: Action) => void;\r\n  /** When user clicks the linked decision (optional, e.g. open decision detail) */\r\n  onDecisionClick?: (decisionId: string | number) => void;\r\n}\r\n\r\nfunction escapeHtml(text: string): string {\r\n  const div = document.createElement('div');\r\n  div.textContent = text;\r\n  return div.innerHTML;\r\n}\r\n\r\nfunction formatDate(iso: string | undefined): string {\r\n  if (!iso) return '';\r\n  try {\r\n    return formatDateTime(iso);\r\n  } catch {\r\n    return iso;\r\n  }\r\n}\r\n\r\nfunction taskText(a: Action): string {\r\n  return (a.content ?? a.task ?? '') as string;\r\n}\r\n\r\nfunction getActionEventIcon(eventType: string): string {\r\n  const icons: Record<string, string> = {\r\n    created: '',\r\n    updated: '',\r\n    deleted: '',\r\n    restored: '',\r\n    refined_with_ai: '',\r\n    rollback: '',\r\n  };\r\n  return icons[eventType] || '';\r\n}\r\n\r\nfunction getActionEventDescription(ev: ActionEvent): string {\r\n  const data = ev.event_data || {};\r\n  const actor = ev.actor_name ? ` by ${ev.actor_name}` : '';\r\n\r\n  switch (ev.event_type) {\r\n    case 'created':\r\n      return `Created${actor}`;\r\n    case 'refined_with_ai':\r\n      return `Refined with AI${actor}`;\r\n    case 'rollback':\r\n      return `Restored previous version${actor}`;\r\n    case 'updated': {\r\n      const changes = (data.changes as Array<{ field: string; from: string; to: string }>) || [];\r\n      if (changes.length === 0) return `Updated${actor}`;\r\n      const textFields = ['Description', 'Task', 'DoD', 'Acceptance criteria'];\r\n      const hasLongText = changes.some((c) => textFields.includes(c.field));\r\n      if (hasLongText && changes.length >= 2) {\r\n        return `Fields updated${actor}`;\r\n      }\r\n      if (changes.length === 1) {\r\n        const c = changes[0];\r\n        const toStr = String(c.to).trim() ? c.to : '';\r\n        const fromStr = String(c.from).trim() ? c.from : '';\r\n        return `${c.field} changed: ${fromStr}  ${toStr}${actor}`;\r\n      }\r\n      return `${changes.map((c) => `${c.field}: ${c.from || ''}  ${c.to || ''}`).join('; ')}${actor}`;\r\n    }\r\n    case 'deleted':\r\n      return `Deleted${data.reason ? ` (${data.reason})` : ''}${actor}`;\r\n    case 'restored':\r\n      return `Restored${actor}`;\r\n    default:\r\n      return ev.event_type;\r\n  }\r\n}\r\n\r\ntype DodItem = { text: string; done: boolean };\r\n\r\nfunction normalizeDefinitionOfDone(raw: (string | { text?: string; done?: boolean })[] | undefined): DodItem[] {\r\n  if (!Array.isArray(raw) || raw.length === 0) return [];\r\n  return raw.map((item) => {\r\n    if (typeof item === 'string') return { text: item, done: false };\r\n    return { text: (item.text ?? '').toString(), done: Boolean(item.done) };\r\n  });\r\n}\r\n\r\nfunction getDescriptionBodyHtml(a: Action, _assigneeStr: string): string {\r\n  const dod = normalizeDefinitionOfDone((a.definition_of_done as (string | { text?: string; done?: boolean })[]) || []);\r\n  const ac = (a.acceptance_criteria || []).map((item) => (typeof item === 'string' ? item : String(item)));\r\n  // Task title is shown in the header; Assignee in Assignment section; Status in header badge  avoid duplicating here\r\n  const dlParts: string[] = [];\r\n  if (a.parent_story_ref || a.parent_story_id) {\r\n    dlParts.push(`<dt>Parent</dt><dd>${escapeHtml(String(a.parent_story_ref || a.parent_story_id))}</dd>`);\r\n  }\r\n  if (a.size_estimate) {\r\n    dlParts.push(`<dt>Size</dt><dd>${escapeHtml(a.size_estimate)}</dd>`);\r\n  }\r\n  const dlHtml = dlParts.length\r\n    ? `<dl class=\"action-description-dl\">${dlParts.join('')}</dl>`\r\n    : '';\r\n  const descHtml = a.description ? `<div class=\"action-description-text\"><strong>Description</strong><p>${escapeHtml(a.description).replace(/\\n/g, '<br>')}</p></div>` : '';\r\n  const dodHtml = dod.length\r\n    ? `<div class=\"action-dod\"><strong>Definition of Done</strong><ul class=\"action-checklist action-dod-list\">${dod.map((item, i) => `<li class=\"dod-item ${item.done ? 'dod-done' : ''}\" data-dod-index=\"${i}\"><button type=\"button\" class=\"dod-item-toggle\" data-dod-index=\"${i}\" aria-label=\"${item.done ? 'Mark undone' : 'Mark done'}\">${item.done ? '' : ''}</button><span class=\"dod-item-text\">${escapeHtml(item.text)}</span></li>`).join('')}</ul></div>`\r\n    : '';\r\n  const acHtml = ac.length ? `<div class=\"action-ac\"><strong>Acceptance criteria</strong><ul class=\"action-checklist\">${ac.map((item) => `<li>${escapeHtml(item)}</li>`).join('')}</ul></div>` : '';\r\n  return `${dlHtml}${descHtml}${dodHtml}${acHtml}`;\r\n}\r\n\r\nexport function createActionDetailView(props: ActionDetailViewProps): HTMLElement {\r\n  const { action, onClose, onUpdate, onDecisionClick } = props;\r\n  let currentAction: Action = action;\r\n\r\n  const container = createElement('div', { className: 'action-detail-view question-detail-view' });\r\n\r\n  const task = taskText(action);\r\n  const due = action.due_date ?? (action as { deadline?: string }).deadline ?? '';\r\n  const assignee = action.assignee ?? action.owner ?? '';\r\n  const projectName = selectCurrentProject()?.name ?? null;\r\n\r\n  container.innerHTML = `\r\n    <div class=\"question-detail-header action-detail-header\">\r\n      <div class=\"breadcrumb\">\r\n        <a href=\"#\" class=\"breadcrumb-link\" id=\"back-to-list\">Actions</a>\r\n        <span class=\"breadcrumb-separator\"></span>\r\n        ${projectName ? `<span class=\"breadcrumb-project\" title=\"Project\">${escapeHtml(projectName)}</span><span class=\"breadcrumb-separator\"></span>` : ''}\r\n        <span class=\"breadcrumb-current\">Action #${String(action.id).substring(0, 8)}</span>\r\n      </div>\r\n      <div class=\"header-actions\">\r\n        <button type=\"button\" class=\"btn btn-secondary btn-sm\" id=\"action-refine-ai-btn\" title=\"Refine task description, DoD and acceptance criteria with AI\">\r\n          <svg width=\"14\" height=\"14\" fill=\"none\" viewBox=\"0 0 24 24\" stroke=\"currentColor\"><path stroke-linecap=\"round\" stroke-linejoin=\"round\" stroke-width=\"2\" d=\"M13 10V3L4 14h7v7l9-11h-7z\"/></svg>\r\n          Refine with AI\r\n        </button>\r\n        <span class=\"status-badge status-${(action.status || 'pending').toLowerCase()}\">${escapeHtml(String(action.status).replace('_', ' '))}</span>\r\n        <button class=\"btn btn-icon\" id=\"close-detail\" title=\"Close\"></button>\r\n      </div>\r\n    </div>\r\n\r\n    <div class=\"question-detail-content action-detail-content\">\r\n      <div id=\"action-view-content\">\r\n        <section class=\"detail-section action-main\">\r\n          <div class=\"question-badges action-badges\">\r\n            ${projectName ? `<span class=\"project-badge\" title=\"Project\">${escapeHtml(projectName)}</span>` : ''}\r\n            ${action.priority ? `<span class=\"priority-pill priority-${action.priority}\">${escapeHtml(action.priority)}</span>` : ''}\r\n            <span class=\"question-date action-date\">Created ${formatRelativeTime(action.created_at)}</span>\r\n          </div>\r\n          <h2 class=\"question-text action-task-text\">${escapeHtml(task)}</h2>\r\n        </section>\r\n\r\n        <section class=\"detail-section action-description-structured\" id=\"action-description-section\">\r\n          <h3 class=\"section-header-sota\">Description</h3>\r\n          <div class=\"action-description-body\">${getDescriptionBodyHtml(action, assignee)}</div>\r\n        </section>\r\n\r\n        <div class=\"detail-columns\">\r\n          <div class=\"detail-column-left\">\r\n            <!-- Assignment Section - SOTA (aligned with Questions) -->\r\n            <section class=\"detail-section\" id=\"action-assignment-section\">\r\n              <div class=\"section-header-sota\">\r\n                <h3>\r\n                  <svg width=\"20\" height=\"20\" fill=\"none\" viewBox=\"0 0 24 24\" stroke=\"currentColor\">\r\n                    <path stroke-linecap=\"round\" stroke-linejoin=\"round\" stroke-width=\"2\" d=\"M16 7a4 4 0 11-8 0 4 4 0 018 0zM12 14a7 7 0 00-7 7h14a7 7 0 00-7-7z\"/>\r\n                  </svg>\r\n                  Assignment\r\n                  <span class=\"section-subtitle\">Who should do this?</span>\r\n                </h3>\r\n                <button type=\"button\" class=\"btn-ai-suggest\" id=\"action-ai-suggest-btn\" title=\"Suggest who should do this task (assignee) from task content\">\r\n                  <svg width=\"16\" height=\"16\" fill=\"none\" viewBox=\"0 0 24 24\" stroke=\"currentColor\"><path stroke-linecap=\"round\" stroke-linejoin=\"round\" stroke-width=\"2\" d=\"M13 10V3L4 14h7v7l9-11h-7z\"/></svg>\r\n                  AI Suggest\r\n                </button>\r\n              </div>\r\n\r\n              <!-- Current Assignment Display -->\r\n              <div id=\"action-current-assignment\" class=\"current-assignment-card\">\r\n                ${assignee ? `\r\n                  <div class=\"assigned-contact-display\">\r\n                    <div class=\"contact-avatar-lg\" id=\"action-assigned-avatar\">${getInitials(assignee)}</div>\r\n                    <div class=\"contact-details\">\r\n                      <div class=\"contact-name-lg\">${escapeHtml(assignee)}</div>\r\n                      <div class=\"contact-role-sm\" id=\"action-assigned-role\"></div>\r\n                    </div>\r\n                    <button class=\"btn-change-assignment\" id=\"action-change-assignee-btn\" type=\"button\">\r\n                      <svg width=\"14\" height=\"14\" fill=\"none\" viewBox=\"0 0 24 24\" stroke=\"currentColor\"><path stroke-linecap=\"round\" stroke-linejoin=\"round\" stroke-width=\"2\" d=\"M15.232 5.232l3.536 3.536m-2.036-5.036a2.5 2.5 0 113.536 3.536L6.5 21.036H3v-3.572L16.732 3.732z\"/></svg>\r\n                      Change\r\n                    </button>\r\n                  </div>\r\n                ` : `\r\n                  <div class=\"no-assignment\">\r\n                    <div class=\"no-assignment-icon\">\r\n                      <svg width=\"32\" height=\"32\" fill=\"none\" viewBox=\"0 0 24 24\" stroke=\"currentColor\"><path stroke-linecap=\"round\" stroke-linejoin=\"round\" stroke-width=\"1.5\" d=\"M18 9v3m0 0v3m0-3h3m-3 0h-3m-2-5a4 4 0 11-8 0 4 4 0 018 0zM3 20a6 6 0 0112 0v1H3v-1z\"/></svg>\r\n                    </div>\r\n                    <span>No one assigned</span>\r\n                    <p class=\"no-assignment-hint\">Use AI Suggest or choose manually</p>\r\n                    <button class=\"btn-assign-now\" id=\"action-show-picker-btn\" type=\"button\">Choose Manually</button>\r\n                  </div>\r\n                `}\r\n              </div>\r\n\r\n              <!-- Contact Picker (hidden by default) -->\r\n              <div id=\"action-contact-picker\" class=\"contact-picker-sota hidden\">\r\n                <div class=\"picker-search\">\r\n                  <svg width=\"16\" height=\"16\" fill=\"none\" viewBox=\"0 0 24 24\" stroke=\"currentColor\"><path stroke-linecap=\"round\" stroke-linejoin=\"round\" stroke-width=\"2\" d=\"M21 21l-6-6m2-5a7 7 0 11-14 0 7 7 0 0114 0z\"/></svg>\r\n                  <input type=\"text\" id=\"action-contact-search\" placeholder=\"Search contacts...\" autocomplete=\"off\">\r\n                </div>\r\n                <div id=\"action-contact-list\" class=\"contact-list-grid\">Loading...</div>\r\n              </div>\r\n\r\n              <!-- AI Suggestions Panel -->\r\n              <div id=\"action-suggestions-panel\" class=\"suggestions-panel-sota action-suggestions-panel hidden gm-mb-3\"></div>\r\n\r\n              <!-- Due date, Sprint (Status is only in header badge) -->\r\n              <dl class=\"metadata-list action-meta-inline\">\r\n                <dt>Due date</dt>\r\n                <dd>${due ? formatDate(due) : ''}</dd>\r\n                ${(action.sprint_id || action.sprint_name) ? `\r\n                <dt>Sprint</dt>\r\n                <dd>${escapeHtml((action.sprint_name as string) || String(action.sprint_id))}</dd>\r\n                ` : ''}\r\n              </dl>\r\n            </section>\r\n\r\n            <section class=\"detail-section\" id=\"action-decision-section\">\r\n              <div class=\"section-header\"><h3>Implementing decision</h3></div>\r\n              <div id=\"action-decision-display\" class=\"action-decision-display\">\r\n                ${(action as Action).decision_id ? `<p class=\"text-muted\">Loading</p>` : '<p class=\"text-muted\">No decision linked</p>'}\r\n              </div>\r\n              <div class=\"action-decision-actions\">\r\n                <button type=\"button\" class=\"btn btn-sm btn-outline-secondary\" id=\"action-link-decision-btn\">${(action as Action).decision_id ? 'Change' : 'Link decision'}</button>\r\n                <button type=\"button\" class=\"btn btn-sm btn-link ${!(action as Action).decision_id ? 'hidden' : ''}\" id=\"action-unlink-decision-btn\">Unlink</button>\r\n              </div>\r\n              <div id=\"action-decision-picker\" class=\"action-decision-picker hidden\">\r\n                <div class=\"picker-search\"><input type=\"text\" id=\"action-decision-search\" placeholder=\"Search decisions...\" autocomplete=\"off\"></div>\r\n                <div id=\"action-decision-list\" class=\"action-decision-list\">Loading</div>\r\n              </div>\r\n            </section>\r\n\r\n            <section class=\"detail-section\" id=\"action-source-section\">\r\n              <div class=\"section-header\"><h3>Source</h3></div>\r\n              <div class=\"source-content\">\r\n              ${[\r\n      action.source_file ? `<p class=\"source-file\"><strong>File:</strong> ${escapeHtml(action.source_file)}</p>` : '',\r\n      action.source_document_id ? `<p class=\"source-doc\"><a href=\"#\" class=\"doc-link\" data-document-id=\"${escapeHtml(String(action.source_document_id))}\">View source document</a></p>` : '',\r\n      action.source_type ? `<p class=\"source-type\"><strong>Origin:</strong> ${escapeHtml(action.source_type)}</p>` : '',\r\n      action.generation_source ? `<p class=\"source-meta\"><strong>Generation:</strong> <span class=\"status-pill\">${escapeHtml(action.generation_source)}</span></p>` : '',\r\n      action.requested_by ? `<div id=\"action-requester-display\" class=\"requester-display\"><p><strong>Requested by:</strong> ${escapeHtml(action.requested_by)}</p></div>` : '',\r\n    ].filter(Boolean).join('') || '<p class=\"text-muted\">No source recorded</p>'}\r\n              </div>\r\n            </section>\r\n          </div>\r\n\r\n          <div class=\"detail-column-right\">\r\n            <section class=\"detail-section metadata-section\">\r\n              <h3>Metadata</h3>\r\n              <dl class=\"metadata-list\">\r\n                <dt>Created</dt>\r\n                <dd>${formatDate(action.created_at)}</dd>\r\n                ${action.updated_at ? `<dt>Updated</dt><dd>${formatDate(action.updated_at)}</dd>` : ''}\r\n              </dl>\r\n            </section>\r\n\r\n            <section class=\"detail-section\" id=\"action-timeline-section\">\r\n              <h3>Timeline</h3>\r\n              <div id=\"timeline-content\" class=\"timeline-content\">\r\n                <span class=\"text-muted\">Loading</span>\r\n              </div>\r\n            </section>\r\n\r\n            <section class=\"detail-section\" id=\"action-comments-section\">\r\n              <div id=\"action-comments-mount\"></div>\r\n            </section>\r\n\r\n            <section class=\"detail-section\" id=\"action-similar-section\">\r\n              <h3 class=\"section-header-sota\">Similar actions</h3>\r\n              <div id=\"action-similar-mount\" class=\"action-similar-list\">\r\n                <div class=\"skeleton-card\">\r\n                  <div class=\"skeleton-text w-100\"></div>\r\n                  <div class=\"skeleton-row\">\r\n                    <div class=\"skeleton-text w-25\"></div>\r\n                    <div class=\"skeleton-text w-25\"></div>\r\n                  </div>\r\n                </div>\r\n              </div>\r\n            </section>\r\n          </div>\r\n        </div>\r\n\r\n        <div class=\"detail-actions\">\r\n          <button type=\"button\" class=\"btn btn-secondary\" id=\"edit-action-btn\">Edit</button>\r\n          <button type=\"button\" class=\"btn btn-danger\" id=\"delete-action-btn\">Delete</button>\r\n        </div>\r\n      </div>\r\n\r\n      <div id=\"action-edit-form\" class=\"action-detail-edit-form hidden\">\r\n        <form id=\"action-inline-form\" class=\"action-form\">\r\n          <div class=\"form-group\">\r\n            <div class=\"gm-flex gm-flex-center gm-justify-between gm-flex-wrap gm-gap-2 gm-mb-2\">\r\n              <label for=\"action-edit-task\" class=\"gm-mb-0\">Task *</label>\r\n              <button type=\"button\" class=\"btn-ai-suggest btn-sm\" id=\"action-edit-ai-suggest-btn\" title=\"Suggest assignee from task content\">\r\n                <svg width=\"14\" height=\"14\" fill=\"none\" viewBox=\"0 0 24 24\" stroke=\"currentColor\"><path stroke-linecap=\"round\" stroke-linejoin=\"round\" stroke-width=\"2\" d=\"M13 10V3L4 14h7v7l9-11h-7z\"/></svg>\r\n                AI suggest\r\n              </button>\r\n            </div>\r\n            <textarea id=\"action-edit-task\" rows=\"3\" required placeholder=\"What needs to be done?\">${escapeHtml(task)}</textarea>\r\n          </div>\r\n          <div id=\"action-edit-suggestions-panel\" class=\"suggestions-panel-sota action-suggestions-panel hidden gm-mb-4\"></div>\r\n          <div class=\"form-row\">\r\n            <div class=\"form-group\">\r\n              <label for=\"action-edit-status\">Status</label>\r\n              <select id=\"action-edit-status\">\r\n                <option value=\"pending\" ${action.status === 'pending' ? 'selected' : ''}>Pending</option>\r\n                <option value=\"in_progress\" ${action.status === 'in_progress' ? 'selected' : ''}>In Progress</option>\r\n                <option value=\"completed\" ${action.status === 'completed' ? 'selected' : ''}>Completed</option>\r\n                <option value=\"cancelled\" ${action.status === 'cancelled' ? 'selected' : ''}>Cancelled</option>\r\n              </select>\r\n            </div>\r\n            <div class=\"form-group\">\r\n              <label for=\"action-edit-priority\">Priority</label>\r\n              <select id=\"action-edit-priority\">\r\n                <option value=\"low\" ${action.priority === 'low' ? 'selected' : ''}>Low</option>\r\n                <option value=\"medium\" ${action.priority === 'medium' || !action.priority ? 'selected' : ''}>Medium</option>\r\n                <option value=\"high\" ${action.priority === 'high' ? 'selected' : ''}>High</option>\r\n              </select>\r\n            </div>\r\n          </div>\r\n          <div class=\"form-row\">\r\n            <div class=\"form-group action-assignee-picker-wrap\">\r\n              <label>Assignee</label>\r\n              <input type=\"hidden\" id=\"action-edit-assignee\" value=\"${escapeHtml(assignee)}\">\r\n              <div class=\"action-assignee-picker-trigger\" id=\"action-assignee-picker-trigger\" title=\"Click to select from project contacts\">\r\n                <span class=\"action-assignee-picker-value\" id=\"action-assignee-picker-value\">${assignee ? escapeHtml(assignee) : '<span class=\"text-muted\">Select assignee...</span>'}</span>\r\n                <svg width=\"16\" height=\"16\" fill=\"none\" viewBox=\"0 0 24 24\" stroke=\"currentColor\"><path stroke-linecap=\"round\" stroke-linejoin=\"round\" stroke-width=\"2\" d=\"M19 9l-7 7-7-7\"/></svg>\r\n              </div>\r\n              <div id=\"action-assignee-picker-dropdown\" class=\"action-assignee-picker-dropdown hidden\">\r\n                <div class=\"action-assignee-picker-search\">\r\n                  <input type=\"text\" id=\"action-assignee-picker-search\" placeholder=\"Search contacts...\" autocomplete=\"off\">\r\n                </div>\r\n                <div id=\"action-assignee-picker-list\" class=\"action-assignee-picker-list\">Loading...</div>\r\n              </div>\r\n            </div>\r\n            <div class=\"form-group\">\r\n              <label for=\"action-edit-due\">Due date</label>\r\n              <input type=\"date\" id=\"action-edit-due\" value=\"${due ? due.split('T')[0] : ''}\">\r\n            </div>\r\n          </div>\r\n          <div class=\"form-group action-requester-picker-wrap\">\r\n            <label>Requested by</label>\r\n            <input type=\"hidden\" id=\"action-edit-requester-contact-id\" value=\"${escapeHtml((action.requested_by_contact_id as string) || '')}\">\r\n            <input type=\"hidden\" id=\"action-edit-requester-name\" value=\"${escapeHtml((action.requested_by as string) || '')}\">\r\n            <div class=\"action-assignee-picker-trigger\" id=\"action-requester-picker-trigger\" title=\"Click to select who requested this task\">\r\n              <span class=\"action-assignee-picker-value\" id=\"action-requester-picker-value\">${(action.requested_by as string) ? escapeHtml(action.requested_by as string) : '<span class=\"text-muted\">Select requester...</span>'}</span>\r\n              <svg width=\"16\" height=\"16\" fill=\"none\" viewBox=\"0 0 24 24\" stroke=\"currentColor\"><path stroke-linecap=\"round\" stroke-linejoin=\"round\" stroke-width=\"2\" d=\"M19 9l-7 7-7-7\"/></svg>\r\n            </div>\r\n            <div id=\"action-requester-picker-dropdown\" class=\"action-assignee-picker-dropdown hidden\">\r\n              <div class=\"action-assignee-picker-search\">\r\n                <input type=\"text\" id=\"action-requester-picker-search\" placeholder=\"Search contacts...\" autocomplete=\"off\">\r\n              </div>\r\n              <div id=\"action-requester-picker-list\" class=\"action-assignee-picker-list\">Loading...</div>\r\n            </div>\r\n          </div>\r\n        </form>\r\n        <div class=\"detail-actions\">\r\n          <button type=\"button\" class=\"btn btn-primary\" id=\"action-save-btn\">Save</button>\r\n          <button type=\"button\" class=\"btn btn-secondary\" id=\"action-cancel-edit-btn\">Cancel</button>\r\n          <button type=\"button\" class=\"btn btn-danger\" id=\"action-delete-in-edit-btn\">Delete</button>\r\n        </div>\r\n      </div>\r\n    </div>\r\n  `;\r\n\r\n  const backLink = container.querySelector('#back-to-list');\r\n  if (backLink) {\r\n    on(backLink as HTMLElement, 'click', (e) => {\r\n      e.preventDefault();\r\n      onClose();\r\n    });\r\n  }\r\n  const closeBtn = container.querySelector('#close-detail');\r\n  if (closeBtn) {\r\n    on(closeBtn as HTMLElement, 'click', onClose);\r\n  }\r\n\r\n  const refineAiBtn = container.querySelector('#action-refine-ai-btn');\r\n  if (refineAiBtn) {\r\n    on(refineAiBtn as HTMLElement, 'click', async () => {\r\n      const task = taskText(action);\r\n      const desc = (action.description ?? '') as string;\r\n      const userInput = [task, desc].filter(Boolean).join('\\n\\n');\r\n      if (!userInput.trim()) {\r\n        toast.error('Task has no content to refine');\r\n        return;\r\n      }\r\n      (refineAiBtn as HTMLButtonElement).disabled = true;\r\n      (refineAiBtn as HTMLButtonElement).textContent = 'Refining...';\r\n      try {\r\n        const result = await actionsService.suggestTaskFromDescription({\r\n          user_input: userInput,\r\n          parent_story_ref: (action.parent_story_ref as string) || undefined,\r\n        });\r\n        if (!container.isConnected) return;\r\n        const updated = await actionsService.update(action.id, {\r\n          content: result.task,\r\n          description: result.description,\r\n          definition_of_done: result.definition_of_done,\r\n          acceptance_criteria: result.acceptance_criteria,\r\n          size_estimate: result.size_estimate,\r\n          refined_with_ai: true,\r\n        });\r\n        if (!container.isConnected) return;\r\n        toast.success('Task refined with AI');\r\n        currentAction = updated;\r\n        refreshDescriptionAndTimeline();\r\n        onUpdate?.(updated);\r\n      } catch (e) {\r\n        toast.error((e as Error).message || 'Failed to refine');\r\n      } finally {\r\n        (refineAiBtn as HTMLButtonElement).disabled = false;\r\n        (refineAiBtn as HTMLButtonElement).innerHTML = `\r\n          <svg width=\"14\" height=\"14\" fill=\"none\" viewBox=\"0 0 24 24\" stroke=\"currentColor\"><path stroke-linecap=\"round\" stroke-linejoin=\"round\" stroke-width=\"2\" d=\"M13 10V3L4 14h7v7l9-11h-7z\"/></svg>\r\n          Refine with AI\r\n        `;\r\n      }\r\n    });\r\n  }\r\n\r\n  function bindDodToggles(): void {\r\n    const bodyEl = container.querySelector('#action-description-section .action-description-body');\r\n    if (!bodyEl) return;\r\n    bodyEl.querySelectorAll('.dod-item-toggle').forEach((btn) => {\r\n      on(btn as HTMLElement, 'click', async () => {\r\n        const idx = parseInt((btn as HTMLElement).getAttribute('data-dod-index') ?? '-1', 10);\r\n        if (idx < 0) return;\r\n        const dod = normalizeDefinitionOfDone((currentAction.definition_of_done as (string | { text?: string; done?: boolean })[]) || []);\r\n        if (idx >= dod.length) return;\r\n        const li = (btn as HTMLElement).closest('.dod-item');\r\n        const previousDone = dod[idx].done;\r\n        dod[idx].done = !dod[idx].done;\r\n        const payload = dod.map((item) => ({ text: item.text, done: item.done }));\r\n        // Optimistic UI: update DOM immediately\r\n        if (li) li.classList.toggle('dod-done', dod[idx].done);\r\n        (btn as HTMLButtonElement).textContent = dod[idx].done ? '' : '';\r\n        (btn as HTMLButtonElement).setAttribute('aria-label', dod[idx].done ? 'Mark undone' : 'Mark done');\r\n        try {\r\n          const updated = await actionsService.update(currentAction.id, { definition_of_done: payload });\r\n          if (!container.isConnected) return;\r\n          currentAction = updated;\r\n          toast.success(dod[idx].done ? 'Marked done' : 'Marked undone');\r\n        } catch (e) {\r\n          // Revert optimistic update\r\n          dod[idx].done = previousDone;\r\n          if (li) li.classList.toggle('dod-done', previousDone);\r\n          (btn as HTMLButtonElement).textContent = previousDone ? '' : '';\r\n          (btn as HTMLButtonElement).setAttribute('aria-label', previousDone ? 'Mark undone' : 'Mark done');\r\n          toast.error((e as Error).message || 'Failed to update');\r\n        }\r\n      });\r\n    });\r\n  }\r\n\r\n  function renderTimeline(el: HTMLElement | null): void {\r\n    if (!el) return;\r\n    actionsService.getEvents(currentAction.id).then((events: ActionEvent[]) => {\r\n      if (!container.isConnected) return;\r\n      if (events.length === 0) {\r\n        el.innerHTML = '<p class=\"empty-state\">No events recorded</p>';\r\n        bindDodToggles();\r\n        return;\r\n      }\r\n      const html = events.map((ev) => {\r\n        const icon = getActionEventIcon(ev.event_type);\r\n        const description = getActionEventDescription(ev);\r\n        const data = ev.event_data || {};\r\n        const snapshot = data.snapshot as Record<string, unknown> | undefined;\r\n        const hasRestore = ev.event_type === 'refined_with_ai' && snapshot && typeof snapshot === 'object';\r\n        const snapshotAttr = hasRestore ? ` data-snapshot=\"${escapeHtml(JSON.stringify(snapshot))}\"` : '';\r\n        const restoreBtn = hasRestore\r\n          ? `<button type=\"button\" class=\"btn btn-sm btn-outline-secondary action-restore-btn\"${snapshotAttr} title=\"Restore this version\">Restore</button>`\r\n          : '';\r\n        return `\r\n          <div class=\"timeline-item action-event-${escapeHtml(ev.event_type)}\">\r\n            <div class=\"timeline-icon\">${icon}</div>\r\n            <div class=\"timeline-content\">\r\n              <div class=\"timeline-title-row\">\r\n                <span class=\"timeline-title\">${escapeHtml(description)}</span>\r\n                ${restoreBtn}\r\n              </div>\r\n              <div class=\"timeline-date\">${formatDateTime(ev.created_at)}</div>\r\n            </div>\r\n          </div>`;\r\n      }).join('');\r\n      el.innerHTML = `<div class=\"timeline-list\">${html}</div>`;\r\n      el.querySelectorAll('.action-restore-btn').forEach((btn) => {\r\n        on(btn as HTMLElement, 'click', async () => {\r\n          const raw = (btn as HTMLElement).getAttribute('data-snapshot');\r\n          if (!raw) return;\r\n          const restoreBtn = btn as HTMLButtonElement;\r\n          restoreBtn.disabled = true;\r\n          const originalText = restoreBtn.textContent || 'Restore';\r\n          restoreBtn.textContent = 'Restoring';\r\n          try {\r\n            const snapshot = JSON.parse(raw) as { content?: string; task?: string; description?: string; definition_of_done?: (string | { text: string; done?: boolean })[]; acceptance_criteria?: string[]; size_estimate?: string };\r\n            const updated = await actionsService.update(currentAction.id, { restore_snapshot: snapshot });\r\n            if (!container.isConnected) return;\r\n            toast.success('Previous version restored');\r\n            currentAction = updated;\r\n            refreshDescriptionAndTimeline();\r\n            onUpdate?.(updated);\r\n          } catch (e) {\r\n            toast.error((e as Error).message || 'Failed to restore');\r\n            restoreBtn.disabled = false;\r\n            restoreBtn.textContent = originalText;\r\n          }\r\n        });\r\n      });\r\n      bindDodToggles();\r\n    }).catch(() => {\r\n      el.innerHTML = '<p class=\"error\">Failed to load timeline</p>';\r\n    });\r\n  }\r\n\r\n  function refreshDescriptionAndTimeline(): void {\r\n    const taskEl = container.querySelector('.action-task-text');\r\n    if (taskEl) taskEl.textContent = taskText(currentAction);\r\n    const bodyEl = container.querySelector('#action-description-section .action-description-body');\r\n    if (bodyEl) {\r\n      bodyEl.innerHTML = getDescriptionBodyHtml(currentAction, currentAction.assignee ?? (currentAction as Action).owner ?? '');\r\n      bindDodToggles();\r\n    }\r\n    const timelineEl = container.querySelector('#timeline-content') as HTMLElement | null;\r\n    if (timelineEl) timelineEl.innerHTML = `\r\n      <div class=\"skeleton-card\">\r\n          <div class=\"skeleton-row\">\r\n              <div class=\"skeleton-avatar\"></div>\r\n              <div class=\"skeleton-text w-50\" style=\"margin-bottom:0\"></div>\r\n          </div>\r\n          <div class=\"skeleton-text w-75\" style=\"margin-top: 8px;\"></div>\r\n      </div>\r\n    `;\r\n    renderTimeline(timelineEl);\r\n  }\r\n\r\n  function refreshDecisionSection(): void {\r\n    const displayEl = container.querySelector('#action-decision-display') as HTMLElement;\r\n    const linkBtn = container.querySelector('#action-link-decision-btn') as HTMLButtonElement;\r\n    const unlinkBtn = container.querySelector('#action-unlink-decision-btn');\r\n    const decisionId = (currentAction as Action).decision_id;\r\n    if (!displayEl) return;\r\n    if (decisionId) {\r\n      displayEl.innerHTML = '<div class=\"skeleton-text w-75\"></div>';\r\n      decisionsService.get(decisionId).then((d: Decision | null) => {\r\n        if (!container.isConnected) return;\r\n        if (!displayEl) return;\r\n        const title = (d?.summary || d?.content || '').toString().trim().substring(0, 80) + ((d?.content || '').toString().length > 80 ? '' : '');\r\n        displayEl.innerHTML = `<p><a href=\"#\" class=\"decision-link\" data-decision-id=\"${escapeHtml(String(decisionId))}\">${escapeHtml(title || `Decision #${String(decisionId).substring(0, 8)}`)}</a></p>`;\r\n        displayEl.querySelector('.decision-link') && on(displayEl.querySelector('.decision-link') as HTMLElement, 'click', (e) => {\r\n          e.preventDefault();\r\n          if (decisionId) onDecisionClick?.(decisionId);\r\n        });\r\n      }).catch(() => {\r\n        displayEl.innerHTML = `<p><a href=\"#\" class=\"decision-link\" data-decision-id=\"${escapeHtml(String(decisionId))}\">Decision #${String(decisionId).substring(0, 8)}</a></p>`;\r\n      });\r\n      if (linkBtn) linkBtn.textContent = 'Change';\r\n      if (unlinkBtn) (unlinkBtn as HTMLElement).classList.remove('hidden');\r\n    } else {\r\n      displayEl.innerHTML = '<p class=\"text-muted\">No decision linked</p>';\r\n      if (linkBtn) linkBtn.textContent = 'Link decision';\r\n      if (unlinkBtn) (unlinkBtn as HTMLElement).classList.add('hidden');\r\n    }\r\n  }\r\n\r\n  const viewContent = container.querySelector('#action-view-content') as HTMLElement;\r\n  const editForm = container.querySelector('#action-edit-form') as HTMLElement;\r\n\r\n  const commentsMount = container.querySelector('#action-comments-mount') as HTMLElement;\r\n  if (commentsMount) {\r\n    const projectId = selectCurrentProject()?.id;\r\n    const commentsThread = createCommentsThread({\r\n      targetType: 'action',\r\n      targetId: String(action.id),\r\n      projectId: projectId || undefined,\r\n    });\r\n    commentsMount.appendChild(commentsThread);\r\n  }\r\n\r\n  const similarMount = container.querySelector('#action-similar-mount') as HTMLElement;\r\n  if (similarMount) {\r\n    (async () => {\r\n      try {\r\n        const similar = await actionsService.getSimilar(action.id);\r\n        if (!container.isConnected) return;\r\n        if (similar.length === 0) {\r\n          similarMount.innerHTML = '<span class=\"text-muted\">No similar actions found. Rebuild RAG embeddings to enable.</span>';\r\n          return;\r\n        }\r\n        similarMount.innerHTML = similar\r\n          .map(\r\n            (a) => `\r\n          <div class=\"action-similar-card\" data-action-id=\"${escapeHtml(String(a.id))}\" role=\"button\" tabindex=\"0\">\r\n            <span class=\"action-similar-status status-pill status-${(a.status || 'pending').toLowerCase()}\">${escapeHtml(String(a.status || 'pending').replace('_', ' '))}</span>\r\n            <span class=\"action-similar-task\">${escapeHtml(((a.content || a.task) || '').toString().trim().substring(0, 80))}${((a.content || a.task) || '').toString().length > 80 ? '' : ''}</span>\r\n          </div>\r\n        `\r\n          )\r\n          .join('');\r\n        similarMount.querySelectorAll('.action-similar-card').forEach((el) => {\r\n          on(el as HTMLElement, 'click', () => {\r\n            const id = (el as HTMLElement).getAttribute('data-action-id');\r\n            const chosen = similar.find((a) => String(a.id) === id);\r\n            if (chosen) onUpdate?.(chosen);\r\n          });\r\n        });\r\n      } catch {\r\n        similarMount.innerHTML = '<span class=\"text-muted\">Could not load similar actions.</span>';\r\n      }\r\n    })();\r\n  }\r\n\r\n  // Implementing decision: load linked decision and bind Link/Unlink/Picker\r\n  (() => {\r\n    refreshDecisionSection();\r\n    const linkBtn = container.querySelector('#action-link-decision-btn');\r\n    const unlinkBtn = container.querySelector('#action-unlink-decision-btn');\r\n    const pickerEl = container.querySelector('#action-decision-picker') as HTMLElement;\r\n    const listEl = container.querySelector('#action-decision-list') as HTMLElement;\r\n    const searchInput = container.querySelector('#action-decision-search') as HTMLInputElement;\r\n\r\n    const renderDecisionList = (decisions: Decision[], filter = '') => {\r\n      if (!listEl) return;\r\n      const f = filter.trim().toLowerCase();\r\n      const filtered = f ? decisions.filter((d) => (d.content || '').toLowerCase().includes(f) || (d.summary || '').toLowerCase().includes(f)) : decisions;\r\n      if (filtered.length === 0) {\r\n        listEl.innerHTML = '<div class=\"empty-state\">No decisions match</div>';\r\n        return;\r\n      }\r\n      listEl.innerHTML = filtered\r\n        .map((d) => {\r\n          const title = (d.summary || d.content || '').toString().trim().substring(0, 60) + ((d.content || '').toString().length > 60 ? '' : '');\r\n          return `<div class=\"action-decision-item\" data-decision-id=\"${escapeHtml(String(d.id))}\" role=\"button\" tabindex=\"0\">${escapeHtml(title)}</div>`;\r\n        })\r\n        .join('');\r\n      listEl.querySelectorAll('.action-decision-item').forEach((el) => {\r\n        on(el as HTMLElement, 'click', async () => {\r\n          const id = (el as HTMLElement).getAttribute('data-decision-id');\r\n          if (!id) return;\r\n\r\n          // Optimistic Update\r\n          const previousAction = { ...currentAction };\r\n          const decisionTitle = (el as HTMLElement).textContent || `Decision #${id}`;\r\n\r\n          // Mock update state\r\n          (currentAction as any).decision_id = id;\r\n\r\n          // Manually update display to avoid wait\r\n          const displayEl = container.querySelector('#action-decision-display') as HTMLElement;\r\n          const linkBtn = container.querySelector('#action-link-decision-btn') as HTMLButtonElement;\r\n          const unlinkBtn = container.querySelector('#action-unlink-decision-btn') as HTMLElement;\r\n\r\n          if (displayEl) {\r\n            displayEl.innerHTML = `<p><a href=\"#\" class=\"decision-link\" data-decision-id=\"${escapeHtml(id)}\">${escapeHtml(decisionTitle)}</a></p>`;\r\n            const newLink = displayEl.querySelector('.decision-link');\r\n            if (newLink) on(newLink as HTMLElement, 'click', (e) => {\r\n              e.preventDefault();\r\n              onDecisionClick?.(id);\r\n            });\r\n          }\r\n          if (linkBtn) linkBtn.textContent = 'Change';\r\n          if (unlinkBtn) unlinkBtn.classList.remove('hidden');\r\n          if (pickerEl) pickerEl.classList.add('hidden');\r\n\r\n          try {\r\n            const updated = await actionsService.update(currentAction.id, { decision_id: id });\r\n            if (!container.isConnected) return;\r\n            currentAction = updated as Action;\r\n            onUpdate?.(updated as Action);\r\n            // refreshDecisionSection will canonicalize the display\r\n            refreshDecisionSection();\r\n            toast.success('Decision linked');\r\n          } catch (e) {\r\n            console.error('Failed to link decision', e);\r\n            // Rollback\r\n            currentAction = previousAction;\r\n            refreshDecisionSection();\r\n            toast.error((e as Error).message || 'Failed to link decision');\r\n          }\r\n        });\r\n      });\r\n    };\r\n\r\n    if (linkBtn) {\r\n      on(linkBtn as HTMLElement, 'click', async () => {\r\n        if (!pickerEl || !listEl) return;\r\n        const isOpen = !pickerEl.classList.contains('hidden');\r\n        pickerEl.classList.toggle('hidden', isOpen);\r\n        if (!isOpen) {\r\n          listEl.innerHTML = 'Loading';\r\n          try {\r\n            const decisions = await decisionsService.getAll();\r\n            renderDecisionList(decisions, searchInput?.value || '');\r\n          } catch {\r\n            listEl.innerHTML = '<div class=\"empty-state\">Failed to load decisions</div>';\r\n          }\r\n        }\r\n      });\r\n    }\r\n    if (unlinkBtn) {\r\n      on(unlinkBtn as HTMLElement, 'click', async () => {\r\n        try {\r\n          const updated = await actionsService.update(currentAction.id, { decision_id: null });\r\n          if (!container.isConnected) return;\r\n          currentAction = updated as Action;\r\n          onUpdate?.(updated as Action);\r\n          refreshDecisionSection();\r\n          toast.success('Decision unlinked');\r\n        } catch (e) {\r\n          toast.error((e as Error).message || 'Failed to unlink');\r\n        }\r\n      });\r\n    }\r\n    if (searchInput && listEl) {\r\n      searchInput.addEventListener('input', () => {\r\n        decisionsService.getAll().then((decisions) => renderDecisionList(decisions, searchInput.value));\r\n      });\r\n    }\r\n    document.addEventListener('click', (e) => {\r\n      if (pickerEl && !(e.target as HTMLElement).closest('#action-decision-section') && !pickerEl.classList.contains('hidden')) {\r\n        pickerEl.classList.add('hidden');\r\n      }\r\n    });\r\n  })();\r\n\r\n  const editBtn = container.querySelector('#edit-action-btn');\r\n  if (editBtn) {\r\n    on(editBtn as HTMLElement, 'click', () => {\r\n      viewContent.classList.add('hidden');\r\n      editForm.classList.remove('hidden');\r\n    });\r\n  }\r\n\r\n  const cancelEditBtn = container.querySelector('#action-cancel-edit-btn');\r\n  if (cancelEditBtn) {\r\n    on(cancelEditBtn as HTMLElement, 'click', () => {\r\n      editForm.classList.add('hidden');\r\n      viewContent.classList.remove('hidden');\r\n    });\r\n  }\r\n\r\n  const assigneePickerTrigger = container.querySelector('#action-assignee-picker-trigger');\r\n  const assigneePickerDropdown = container.querySelector('#action-assignee-picker-dropdown') as HTMLElement;\r\n  const assigneePickerValue = container.querySelector('#action-assignee-picker-value');\r\n  const assigneeHiddenInput = container.querySelector('#action-edit-assignee') as HTMLInputElement;\r\n  const assigneePickerList = container.querySelector('#action-assignee-picker-list') as HTMLElement;\r\n  const assigneePickerSearch = container.querySelector('#action-assignee-picker-search') as HTMLInputElement;\r\n  if (assigneePickerTrigger && assigneePickerDropdown && assigneePickerList && assigneeHiddenInput) {\r\n    let editFormContacts: Contact[] = [];\r\n    const renderAssigneePickerList = (filter = '') => {\r\n      const filtered = filter\r\n        ? editFormContacts.filter(\r\n          (c) =>\r\n            (c.name || '').toLowerCase().includes(filter.toLowerCase()) ||\r\n            (c.role || '').toLowerCase().includes(filter.toLowerCase())\r\n        )\r\n        : editFormContacts;\r\n      if (editFormContacts.length === 0) {\r\n        assigneePickerList.innerHTML = '<div class=\"empty-state\">Loading contacts...</div>';\r\n        return;\r\n      }\r\n      if (filtered.length === 0) {\r\n        assigneePickerList.innerHTML = '<div class=\"empty-state\">No contacts match</div>';\r\n        return;\r\n      }\r\n      assigneePickerList.innerHTML = filtered\r\n        .map((c) => {\r\n          const photoUrl = (c as { photoUrl?: string }).photoUrl || (c as { avatarUrl?: string }).avatarUrl;\r\n          const selected = (assigneeHiddenInput?.value || '').trim() === (c.name || '').trim();\r\n          return `\r\n            <div class=\"action-assignee-card-picker ${selected ? 'selected' : ''}\" data-contact-name=\"${escapeHtml(c.name || '')}\">\r\n              <div class=\"action-assignee-card-avatar\">${photoUrl ? `<img src=\"${escapeHtml(photoUrl)}\" alt=\"\" onerror=\"this.parentElement.innerHTML='${getInitials(c.name || '')}'\">` : getInitials(c.name || '')}</div>\r\n              <div class=\"action-assignee-card-info\">\r\n                <div class=\"action-assignee-card-name\">${escapeHtml(c.name || '')}</div>\r\n                ${c.role ? `<div class=\"action-assignee-card-role\">${escapeHtml(c.role)}</div>` : ''}\r\n              </div>\r\n            </div>\r\n          `;\r\n        })\r\n        .join('');\r\n      assigneePickerList.querySelectorAll('.action-assignee-card-picker').forEach((card) => {\r\n        on(card as HTMLElement, 'click', () => {\r\n          const name = card.getAttribute('data-contact-name') || '';\r\n          assigneeHiddenInput.value = name;\r\n          if (assigneePickerValue) assigneePickerValue.innerHTML = name ? escapeHtml(name) : '<span class=\"text-muted\">Select assignee...</span>';\r\n          assigneePickerDropdown.classList.add('hidden');\r\n        });\r\n      });\r\n    };\r\n    on(assigneePickerTrigger as HTMLElement, 'click', async (e) => {\r\n      e.stopPropagation();\r\n      const isOpen = !assigneePickerDropdown.classList.contains('hidden');\r\n      assigneePickerDropdown.classList.toggle('hidden', isOpen);\r\n      if (!isOpen && editFormContacts.length === 0) {\r\n        assigneePickerList.innerHTML = '<div class=\"empty-state\">Loading...</div>';\r\n        try {\r\n          const res = await contactsService.getAll();\r\n          if (!container.isConnected) return;\r\n          editFormContacts = res?.contacts || [];\r\n          renderAssigneePickerList(assigneePickerSearch?.value || '');\r\n        } catch {\r\n          assigneePickerList.innerHTML = '<div class=\"empty-state\">Failed to load contacts</div>';\r\n        }\r\n      } else if (!isOpen) renderAssigneePickerList(assigneePickerSearch?.value || '');\r\n    });\r\n    if (assigneePickerSearch) {\r\n      assigneePickerSearch.addEventListener('input', () => renderAssigneePickerList(assigneePickerSearch.value));\r\n    }\r\n    document.addEventListener('click', (e) => {\r\n      const target = e.target as HTMLElement;\r\n      if (!target.closest('.action-assignee-picker-wrap') && !assigneePickerDropdown?.classList.contains('hidden')) {\r\n        assigneePickerDropdown.classList.add('hidden');\r\n      }\r\n    });\r\n  }\r\n\r\n  const requesterPickerTrigger = container.querySelector('#action-requester-picker-trigger');\r\n  const requesterPickerDropdown = container.querySelector('#action-requester-picker-dropdown') as HTMLElement;\r\n  const requesterPickerValue = container.querySelector('#action-requester-picker-value');\r\n  const requesterContactIdInput = container.querySelector('#action-edit-requester-contact-id') as HTMLInputElement;\r\n  const requesterNameInput = container.querySelector('#action-edit-requester-name') as HTMLInputElement;\r\n  const requesterPickerList = container.querySelector('#action-requester-picker-list') as HTMLElement;\r\n  const requesterPickerSearch = container.querySelector('#action-requester-picker-search') as HTMLInputElement;\r\n  if (requesterPickerTrigger && requesterPickerDropdown && requesterPickerList && requesterContactIdInput && requesterNameInput) {\r\n    let requesterContacts: Contact[] = [];\r\n    const renderRequesterPickerList = (filter = '') => {\r\n      const filtered = filter\r\n        ? requesterContacts.filter(\r\n          (c) =>\r\n            (c.name || '').toLowerCase().includes(filter.toLowerCase()) ||\r\n            (c.role || '').toLowerCase().includes(filter.toLowerCase())\r\n        )\r\n        : requesterContacts;\r\n      if (requesterContacts.length === 0) {\r\n        requesterPickerList.innerHTML = '<div class=\"empty-state\">Loading contacts...</div>';\r\n        return;\r\n      }\r\n      requesterPickerList.innerHTML =\r\n        '<div class=\"action-assignee-card-picker\" data-contact-id=\"\" data-contact-name=\"\"><div class=\"action-assignee-card-info\"><div class=\"action-assignee-card-name text-muted\">No requester</div></div></div>' +\r\n        filtered\r\n          .map((c) => {\r\n            const photoUrl = (c as { photoUrl?: string }).photoUrl || (c as { avatarUrl?: string }).avatarUrl;\r\n            return `\r\n            <div class=\"action-assignee-card-picker\" data-contact-id=\"${escapeHtml(c.id)}\" data-contact-name=\"${escapeHtml(c.name || '')}\">\r\n              <div class=\"action-assignee-card-avatar\">${photoUrl ? `<img src=\"${escapeHtml(photoUrl)}\" alt=\"\" onerror=\"this.parentElement.innerHTML='${getInitials(c.name || '')}'\">` : getInitials(c.name || '')}</div>\r\n              <div class=\"action-assignee-card-info\">\r\n                <div class=\"action-assignee-card-name\">${escapeHtml(c.name || '')}</div>\r\n                ${c.role ? `<div class=\"action-assignee-card-role\">${escapeHtml(c.role)}</div>` : ''}\r\n              </div>\r\n            </div>\r\n          `;\r\n          })\r\n          .join('');\r\n      requesterPickerList.querySelectorAll('.action-assignee-card-picker').forEach((card) => {\r\n        on(card as HTMLElement, 'click', () => {\r\n          const id = card.getAttribute('data-contact-id') || '';\r\n          const name = card.getAttribute('data-contact-name') || '';\r\n          requesterContactIdInput.value = id;\r\n          requesterNameInput.value = name;\r\n          if (requesterPickerValue) requesterPickerValue.innerHTML = name ? escapeHtml(name) : '<span class=\"text-muted\">Select requester...</span>';\r\n          requesterPickerDropdown.classList.add('hidden');\r\n        });\r\n      });\r\n    };\r\n    on(requesterPickerTrigger as HTMLElement, 'click', async (e) => {\r\n      e.stopPropagation();\r\n      const isOpen = !requesterPickerDropdown.classList.contains('hidden');\r\n      requesterPickerDropdown.classList.toggle('hidden', isOpen);\r\n      if (!isOpen && requesterContacts.length === 0) {\r\n        requesterPickerList.innerHTML = '<div class=\"empty-state\">Loading...</div>';\r\n        try {\r\n          const res = await contactsService.getAll();\r\n          if (!container.isConnected) return;\r\n          requesterContacts = res?.contacts || [];\r\n          renderRequesterPickerList(requesterPickerSearch?.value || '');\r\n        } catch {\r\n          requesterPickerList.innerHTML = '<div class=\"empty-state\">Failed to load contacts</div>';\r\n        }\r\n      } else if (!isOpen) renderRequesterPickerList(requesterPickerSearch?.value || '');\r\n    });\r\n    if (requesterPickerSearch) {\r\n      requesterPickerSearch.addEventListener('input', () => renderRequesterPickerList(requesterPickerSearch.value));\r\n    }\r\n    document.addEventListener('click', (e) => {\r\n      const target = e.target as HTMLElement;\r\n      if (!target.closest('.action-requester-picker-wrap') && !requesterPickerDropdown?.classList.contains('hidden')) {\r\n        requesterPickerDropdown.classList.add('hidden');\r\n      }\r\n    });\r\n  }\r\n\r\n  // AI suggest in edit form (suggest assignee from task; fill picker only, user clicks Save)\r\n  const editAiSuggestBtn = container.querySelector('#action-edit-ai-suggest-btn');\r\n  const editSuggestionsPanel = container.querySelector('#action-edit-suggestions-panel') as HTMLElement;\r\n  const editAssigneeHiddenInput = container.querySelector('#action-edit-assignee') as HTMLInputElement;\r\n  const editAssigneePickerValue = container.querySelector('#action-assignee-picker-value');\r\n  if (editAiSuggestBtn && editSuggestionsPanel) {\r\n    on(editAiSuggestBtn as HTMLElement, 'click', async () => {\r\n      const taskEl = container.querySelector('#action-edit-task') as HTMLTextAreaElement;\r\n      const content = taskEl?.value?.trim() || '';\r\n      if (!content) {\r\n        toast.warning('Enter task content first');\r\n        return;\r\n      }\r\n      const btn = editAiSuggestBtn as HTMLButtonElement;\r\n      btn.disabled = true;\r\n      btn.innerHTML = '<span class=\"spin\"></span> Analyzing...';\r\n      editSuggestionsPanel.classList.remove('hidden');\r\n      editSuggestionsPanel.innerHTML = '<div class=\"suggestions-loading\"><div class=\"loading-text\">AI is suggesting assignees...</div></div>';\r\n      try {\r\n        if (viewContacts.length === 0) {\r\n          const res = await contactsService.getAll();\r\n          if (!container.isConnected) return;\r\n          viewContacts = res?.contacts || [];\r\n        }\r\n        const { suggested_assignees } = await actionsService.suggest({ content });\r\n        if (!container.isConnected) return;\r\n        if (!suggested_assignees?.length) {\r\n          editSuggestionsPanel.innerHTML = '<div class=\"no-suggestions\"><div class=\"no-suggestions-text\">No suggestions</div><button type=\"button\" class=\"btn-link\" id=\"action-edit-hide-suggest-btn\">Close</button></div>';\r\n        } else {\r\n          editSuggestionsPanel.innerHTML = `\r\n            <div class=\"suggestions-header-sota\"><div class=\"ai-badge\"> AI Recommended</div></div>\r\n            <div class=\"suggestions-list-sota\">\r\n              ${suggested_assignees.map((s: ActionAssigneeSuggestion) => {\r\n            const contact = findContactByAssignee(s.name);\r\n            const photoUrl = getContactPhotoUrl(contact);\r\n            const roleOrReason = contact?.role ?? s.reason ?? '';\r\n            return `\r\n                <div class=\"action-suggestion-card suggestion-card-sota\">\r\n                  <div class=\"suggestion-card-left\">\r\n                    <div class=\"suggestion-avatar-sota\">${photoUrl ? `<img src=\"${escapeHtml(photoUrl)}\" alt=\"\" onerror=\"this.parentElement.innerHTML='${getInitials(s.name)}'\">` : getInitials(s.name)}</div>\r\n                    <div class=\"suggestion-score-ring\" style=\"--score-color: ${(s.score ?? 0) >= 70 ? 'var(--success)' : (s.score ?? 0) >= 50 ? 'var(--warning)' : 'var(--text-muted)'}\">${s.score ?? 0}</div>\r\n                    <div>\r\n                      <div class=\"suggestion-name\">${escapeHtml(s.name)}</div>\r\n                      ${roleOrReason ? `<div class=\"suggestion-reason\">${escapeHtml(roleOrReason)}</div>` : ''}\r\n                    </div>\r\n                  </div>\r\n                  <button type=\"button\" class=\"btn-select-suggestion\" data-assignee-name=\"${escapeHtml(s.name)}\">Assign</button>\r\n                </div>\r\n              `;\r\n          }).join('')}\r\n            </div>\r\n            <div class=\"suggestions-footer\"><button type=\"button\" class=\"btn-link\" id=\"action-edit-hide-suggest-btn\">Close suggestions</button></div>\r\n          `;\r\n          editSuggestionsPanel.querySelectorAll('.btn-select-suggestion').forEach((assignBtn) => {\r\n            const name = (assignBtn as HTMLElement).getAttribute('data-assignee-name') || '';\r\n            if (!name) return;\r\n            on(assignBtn as HTMLElement, 'click', () => {\r\n              if (editAssigneeHiddenInput) editAssigneeHiddenInput.value = name;\r\n              if (editAssigneePickerValue) editAssigneePickerValue.innerHTML = escapeHtml(name);\r\n              editSuggestionsPanel.classList.add('hidden');\r\n              toast.success(`Assignee set to ${name}`);\r\n            });\r\n          });\r\n        }\r\n        const hideBtn = editSuggestionsPanel.querySelector('#action-edit-hide-suggest-btn');\r\n        if (hideBtn) on(hideBtn as HTMLElement, 'click', () => { editSuggestionsPanel.classList.add('hidden'); });\r\n      } catch {\r\n        editSuggestionsPanel.innerHTML = '<div class=\"suggestions-error\">Failed to get suggestions. <button type=\"button\" class=\"btn-link\" id=\"action-edit-hide-suggest-btn\">Close</button></div>';\r\n        const h = editSuggestionsPanel.querySelector('#action-edit-hide-suggest-btn');\r\n        if (h) on(h as HTMLElement, 'click', () => { editSuggestionsPanel.classList.add('hidden'); });\r\n      } finally {\r\n        btn.disabled = false;\r\n        btn.innerHTML = '<svg width=\"14\" height=\"14\" fill=\"none\" viewBox=\"0 0 24 24\" stroke=\"currentColor\"><path stroke-linecap=\"round\" stroke-linejoin=\"round\" stroke-width=\"2\" d=\"M13 10V3L4 14h7v7l9-11h-7z\"/></svg> AI suggest';\r\n      }\r\n    });\r\n  }\r\n\r\n  const saveBtn = container.querySelector('#action-save-btn');\r\n  if (saveBtn) {\r\n    on(saveBtn as HTMLElement, 'click', async () => {\r\n      const taskEl = container.querySelector('#action-edit-task') as HTMLTextAreaElement;\r\n      const statusEl = container.querySelector('#action-edit-status') as HTMLSelectElement;\r\n      const priorityEl = container.querySelector('#action-edit-priority') as HTMLSelectElement;\r\n      const assigneeEl = container.querySelector('#action-edit-assignee') as HTMLInputElement;\r\n      const dueEl = container.querySelector('#action-edit-due') as HTMLInputElement;\r\n      const requesterContactIdEl = container.querySelector('#action-edit-requester-contact-id') as HTMLInputElement;\r\n      const requesterNameEl = container.querySelector('#action-edit-requester-name') as HTMLInputElement;\r\n      if (!taskEl?.value.trim()) {\r\n        toast.warning('Task is required');\r\n        return;\r\n      }\r\n      try {\r\n        const updated = await actionsService.update(action.id, {\r\n          content: taskEl.value.trim(),\r\n          status: statusEl?.value as Action['status'],\r\n          priority: priorityEl?.value as Action['priority'],\r\n          assignee: assigneeEl?.value.trim() || undefined,\r\n          due_date: dueEl?.value || undefined,\r\n          requested_by_contact_id: requesterContactIdEl?.value?.trim() || undefined,\r\n          requested_by: requesterNameEl?.value?.trim() || undefined,\r\n        });\r\n        if (!container.isConnected) return;\r\n        toast.success('Action updated');\r\n        onUpdate?.(updated);\r\n      } catch {\r\n        toast.error('Failed to update action');\r\n      }\r\n    });\r\n  }\r\n\r\n  const deleteBtn = container.querySelector('#delete-action-btn');\r\n  const deleteInEditBtn = container.querySelector('#action-delete-in-edit-btn');\r\n  const doDelete = async () => {\r\n    const { confirm } = await import('../Modal');\r\n    const confirmed = await confirm('Are you sure you want to delete this action?', {\r\n      title: 'Delete Action',\r\n      confirmText: 'Delete',\r\n      confirmClass: 'btn-danger',\r\n    });\r\n    if (confirmed) {\r\n      try {\r\n        await actionsService.delete(action.id);\r\n        if (!container.isConnected) return;\r\n        toast.success('Action deleted');\r\n        onClose();\r\n      } catch {\r\n        toast.error('Failed to delete action');\r\n      }\r\n    }\r\n  };\r\n  if (deleteBtn) on(deleteBtn as HTMLElement, 'click', doDelete);\r\n  if (deleteInEditBtn) on(deleteInEditBtn as HTMLElement, 'click', doDelete);\r\n\r\n  const docLink = container.querySelector('.doc-link[data-document-id]');\r\n  if (docLink) {\r\n    on(docLink as HTMLElement, 'click', (e) => {\r\n      e.preventDefault();\r\n      const docId = (docLink as HTMLElement).getAttribute('data-document-id');\r\n      if (docId) {\r\n        window.dispatchEvent(new CustomEvent('godmode:navigate', {\r\n          detail: { tab: 'files', documentId: docId }\r\n        }));\r\n      }\r\n    });\r\n  }\r\n\r\n  const aiSuggestBtn = container.querySelector('#action-ai-suggest-btn');\r\n  const suggestionsPanel = container.querySelector('#action-suggestions-panel') as HTMLElement;\r\n  if (aiSuggestBtn && suggestionsPanel) {\r\n    on(aiSuggestBtn as HTMLElement, 'click', async () => {\r\n      (aiSuggestBtn as HTMLButtonElement).disabled = true;\r\n      suggestionsPanel.classList.remove('hidden');\r\n      suggestionsPanel.innerHTML = '<div class=\"suggestions-loading\">Loading suggestions...</div>';\r\n      try {\r\n        const task = taskText(action);\r\n        if (viewContacts.length === 0) {\r\n          const res = await contactsService.getAll();\r\n          if (!container.isConnected) return;\r\n          viewContacts = res?.contacts || [];\r\n        }\r\n        const { suggested_assignees } = await actionsService.suggest({ content: task });\r\n        if (!container.isConnected) return;\r\n        if (!suggested_assignees?.length) {\r\n          suggestionsPanel.innerHTML = '<div class=\"no-suggestions\">No suggestions. <button type=\"button\" class=\"btn-link\" id=\"action-hide-suggest-btn\">Close suggestions</button></div>';\r\n        } else {\r\n          suggestionsPanel.innerHTML = `\r\n            <div class=\"suggestions-header-sota\">\r\n              <div class=\"ai-badge\">\r\n                <svg width=\"14\" height=\"14\" fill=\"none\" viewBox=\"0 0 24 24\" stroke=\"currentColor\"><path stroke-linecap=\"round\" stroke-linejoin=\"round\" stroke-width=\"2\" d=\"M13 10V3L4 14h7v7l9-11h-7z\"/></svg>\r\n                AI Recommended\r\n              </div>\r\n            </div>\r\n            <div class=\"suggestions-list-sota\">\r\n              ${suggested_assignees.map((s: ActionAssigneeSuggestion, i: number) => {\r\n            const contact = findContactByAssignee(s.name);\r\n            const photoUrl = getContactPhotoUrl(contact);\r\n            const roleOrReason = contact?.role ?? s.reason ?? '';\r\n            return `\r\n                <div class=\"suggestion-card-sota\" data-index=\"${i}\">\r\n                  <div class=\"suggestion-rank\">#${i + 1}</div>\r\n                  <div class=\"suggestion-avatar-sota\">${photoUrl ? `<img src=\"${escapeHtml(photoUrl)}\" alt=\"\" onerror=\"this.parentElement.innerHTML='${getInitials(s.name)}'\">` : getInitials(s.name)}</div>\r\n                  <div class=\"suggestion-info-sota\">\r\n                    <div class=\"suggestion-name-sota\">${escapeHtml(s.name)}</div>\r\n                    ${roleOrReason ? `<div class=\"suggestion-reason-sota\">${escapeHtml(roleOrReason)}</div>` : ''}\r\n                  </div>\r\n                  <div class=\"suggestion-score-sota\" style=\"--score-color: ${(s.score ?? 0) >= 70 ? 'var(--success)' : (s.score ?? 0) >= 50 ? 'var(--warning)' : 'var(--text-muted)'}\">\r\n                    <div class=\"score-ring\">\r\n                      <svg viewBox=\"0 0 36 36\">\r\n                        <path class=\"score-bg\" d=\"M18 2.0845 a 15.9155 15.9155 0 0 1 0 31.831 a 15.9155 15.9155 0 0 1 0 -31.831\"/>\r\n                        <path class=\"score-fill\" stroke-dasharray=\"${s.score ?? 0}, 100\" d=\"M18 2.0845 a 15.9155 15.9155 0 0 1 0 31.831 a 15.9155 15.9155 0 0 1 0 -31.831\"/>\r\n                      </svg>\r\n                      <div class=\"score-value\">${s.score ?? 0}%</div>\r\n                    </div>\r\n                    <div class=\"score-label\">Match</div>\r\n                  </div>\r\n                  <button type=\"button\" class=\"btn-select-suggestion\" data-assignee-name=\"${escapeHtml(s.name)}\">\r\n                    <svg width=\"16\" height=\"16\" fill=\"none\" viewBox=\"0 0 24 24\" stroke=\"currentColor\"><path stroke-linecap=\"round\" stroke-linejoin=\"round\" stroke-width=\"2\" d=\"M5 13l4 4L19 7\"/></svg>\r\n                    Assign\r\n                  </button>\r\n                </div>\r\n              `;\r\n          }).join('')}\r\n            </div>\r\n            <div class=\"suggestions-footer\"><button type=\"button\" class=\"btn-link\" id=\"action-hide-suggest-btn\">Close suggestions</button></div>\r\n          `;\r\n          suggestionsPanel.querySelectorAll('.btn-select-suggestion').forEach((btn) => {\r\n            on(btn as HTMLElement, 'click', async () => {\r\n              const name = (btn as HTMLElement).getAttribute('data-assignee-name') || '';\r\n              if (!name) return;\r\n              try {\r\n                const updated = await actionsService.update(action.id, { assignee: name });\r\n                if (!container.isConnected) return;\r\n                toast.success(`Assigned to ${name}`);\r\n                onUpdate?.(updated);\r\n                suggestionsPanel.classList.add('hidden');\r\n              } catch {\r\n                toast.error('Failed to assign');\r\n              }\r\n            });\r\n          });\r\n        }\r\n        const hideBtn = suggestionsPanel.querySelector('#action-hide-suggest-btn');\r\n        if (hideBtn) on(hideBtn as HTMLElement, 'click', () => { suggestionsPanel.classList.add('hidden'); });\r\n      } catch {\r\n        suggestionsPanel.innerHTML = '<div class=\"suggestions-error\">Failed to get suggestions. <button type=\"button\" class=\"btn-link\" id=\"action-hide-suggest-btn\">Close</button></div>';\r\n        const h = suggestionsPanel.querySelector('#action-hide-suggest-btn');\r\n        if (h) on(h as HTMLElement, 'click', () => { suggestionsPanel.classList.add('hidden'); });\r\n      } finally {\r\n        (aiSuggestBtn as HTMLButtonElement).disabled = false;\r\n      }\r\n    });\r\n  }\r\n\r\n  const timelineEl = container.querySelector('#timeline-content');\r\n  if (timelineEl) renderTimeline(timelineEl as HTMLElement);\r\n  bindDodToggles();\r\n\r\n  // Contact picker in view: load contacts, show picker on Change/Choose Manually, on select update assignee via API\r\n  let viewContacts: Contact[] = [];\r\n  const actionContactPicker = container.querySelector('#action-contact-picker') as HTMLElement;\r\n  const actionContactList = container.querySelector('#action-contact-list') as HTMLElement;\r\n  const actionContactSearch = container.querySelector('#action-contact-search') as HTMLInputElement;\r\n\r\n  function getContactPhotoUrl(c: Contact | undefined): string | null {\r\n    if (!c) return null;\r\n    const u = c as { photoUrl?: string; avatarUrl?: string; photo_url?: string; avatar_url?: string };\r\n    return u.photoUrl || u.avatarUrl || u.photo_url || u.avatar_url || null;\r\n  }\r\n\r\n  const renderActionContactGrid = (filter = '') => {\r\n    if (!actionContactList) return;\r\n    const list = filter\r\n      ? viewContacts.filter(\r\n        (c) =>\r\n          (c.name || '').toLowerCase().includes(filter.toLowerCase()) ||\r\n          (c.role || '').toLowerCase().includes(filter.toLowerCase()) ||\r\n          ((c as { organization?: string }).organization || '').toLowerCase().includes(filter.toLowerCase())\r\n      )\r\n      : viewContacts;\r\n    if (viewContacts.length === 0) {\r\n      actionContactList.innerHTML = '<div class=\"empty-state\">Loading contacts...</div>';\r\n      return;\r\n    }\r\n    if (list.length === 0) {\r\n      actionContactList.innerHTML = '<div class=\"empty-state\">No contacts match</div>';\r\n      return;\r\n    }\r\n    actionContactList.innerHTML = list\r\n      .map((c) => {\r\n        const photoUrl = getContactPhotoUrl(c);\r\n        const isCurrent = (assignee || '').trim() === (c.name || '').trim();\r\n        return `\r\n          <div class=\"contact-card-picker ${isCurrent ? 'selected' : ''}\" data-contact-name=\"${escapeHtml(c.name || '')}\">\r\n            <div class=\"contact-avatar-picker\">${photoUrl ? `<img src=\"${escapeHtml(photoUrl)}\" alt=\"\" onerror=\"this.parentElement.innerHTML='${getInitials(c.name || '')}'\">` : getInitials(c.name || '')}</div>\r\n            <div class=\"contact-info-picker\">\r\n              <div class=\"contact-name-picker\">${escapeHtml(c.name || '')}</div>\r\n              ${c.role ? `<div class=\"contact-role-picker\">${escapeHtml(c.role)}</div>` : ''}\r\n            </div>\r\n          </div>`;\r\n      })\r\n      .join('');\r\n    actionContactList.querySelectorAll('.contact-card-picker').forEach((card) => {\r\n      on(card as HTMLElement, 'click', async () => {\r\n        const name = card.getAttribute('data-contact-name') || '';\r\n        if (!name) return;\r\n\r\n        // Optimistic Update\r\n        const previousAssignee = currentAction.assignee;\r\n        const previousAction = { ...currentAction };\r\n\r\n        // 1. Update State\r\n        currentAction.assignee = name;\r\n\r\n        // 2. Update UI\r\n        // We can reuse the logic that fetches contact details, but optimistically using the clicked card's info\r\n        // The card has name and avatar. Role might be missing from picker card if simplified, but usually present.\r\n        // Let's rely on viewContacts to find the full contact object for the UI update\r\n        const contact = findContactByAssignee(name);\r\n\r\n        // Update Assignment Section UI\r\n        const roleEl = container.querySelector('#action-assigned-role');\r\n        const avatarEl = container.querySelector('#action-assigned-avatar');\r\n        const nameEl = container.querySelector('.contact-name-lg'); // This selector might be ambiguous if multiple\r\n        // Better selector:\r\n        const assignedDisplay = container.querySelector('#action-current-assignment .assigned-contact-display');\r\n\r\n        // If we are switching from \"No assigned\" to \"Assigned\", the DOM structure changes completely.\r\n        // We need to re-render the assignment card.\r\n        const assignmentCard = container.querySelector('#action-current-assignment');\r\n        if (assignmentCard) {\r\n          // Re-render assignment part\r\n          // We need 'getInitials' which is in scope\r\n          const photoUrl = getContactPhotoUrl(contact);\r\n          assignmentCard.innerHTML = `\r\n                  <div class=\"assigned-contact-display\">\r\n                    <div class=\"contact-avatar-lg\" id=\"action-assigned-avatar\">${photoUrl ? `<img src=\"${escapeHtml(photoUrl)}\" alt=\"\" onerror=\"this.parentElement.innerHTML='${getInitials(name)}'\">` : getInitials(name)}</div>\r\n                    <div class=\"contact-details\">\r\n                      <div class=\"contact-name-lg\">${escapeHtml(name)}</div>\r\n                      <div class=\"contact-role-sm\" id=\"action-assigned-role\">${escapeHtml(contact?.role || '')}</div>\r\n                    </div>\r\n                    <button class=\"btn-change-assignment\" id=\"action-change-assignee-btn\" type=\"button\">\r\n                      <svg width=\"14\" height=\"14\" fill=\"none\" viewBox=\"0 0 24 24\" stroke=\"currentColor\"><path stroke-linecap=\"round\" stroke-linejoin=\"round\" stroke-width=\"2\" d=\"M15.232 5.232l3.536 3.536m-2.036-5.036a2.5 2.5 0 113.536 3.536L6.5 21.036H3v-3.572L16.732 3.732z\"/></svg>\r\n                      Change\r\n                    </button>\r\n                  </div>\r\n            `;\r\n          // Rebind Change button\r\n          const chgBtn = assignmentCard.querySelector('#action-change-assignee-btn');\r\n          if (chgBtn) on(chgBtn as HTMLElement, 'click', showActionPicker);\r\n        }\r\n\r\n        if (actionContactPicker) actionContactPicker.classList.add('hidden');\r\n\r\n        try {\r\n          const updated = await actionsService.update(action.id, { assignee: name });\r\n          if (!container.isConnected) return;\r\n          toast.success(`Assigned to ${name}`);\r\n          currentAction = updated; // canonical update\r\n          onUpdate?.(updated);\r\n        } catch {\r\n          console.error('Failed to save assignment');\r\n          toast.error('Failed to save assignment. Reverting...');\r\n\r\n          // Rollback\r\n          currentAction = previousAction;\r\n          // Revert UI effectively by re-rendering assignment area or just reloading\r\n          // For now, let's just reset the HTML to previous state if possible, or re-run the \"Load contacts\" logic\r\n          // Simpler: reload contacts logic or manually revert.\r\n          // Since we changed DOM structure, we should re-render based on 'previousAssignee'\r\n\r\n          if (assignmentCard) {\r\n            if (previousAssignee) {\r\n              const prevContact = findContactByAssignee(previousAssignee);\r\n              const photoUrl = getContactPhotoUrl(prevContact);\r\n              assignmentCard.innerHTML = `\r\n                      <div class=\"assigned-contact-display\">\r\n                        <div class=\"contact-avatar-lg\" id=\"action-assigned-avatar\">${photoUrl ? `<img src=\"${escapeHtml(photoUrl)}\" alt=\"\" onerror=\"this.parentElement.innerHTML='${getInitials(previousAssignee)}'\">` : getInitials(previousAssignee)}</div>\r\n                        <div class=\"contact-details\">\r\n                          <div class=\"contact-name-lg\">${escapeHtml(previousAssignee)}</div>\r\n                          <div class=\"contact-role-sm\" id=\"action-assigned-role\">${escapeHtml(prevContact?.role || '')}</div>\r\n                        </div>\r\n                        <button class=\"btn-change-assignment\" id=\"action-change-assignee-btn\" type=\"button\">\r\n                          <svg width=\"14\" height=\"14\" fill=\"none\" viewBox=\"0 0 24 24\" stroke=\"currentColor\"><path stroke-linecap=\"round\" stroke-linejoin=\"round\" stroke-width=\"2\" d=\"M15.232 5.232l3.536 3.536m-2.036-5.036a2.5 2.5 0 113.536 3.536L6.5 21.036H3v-3.572L16.732 3.732z\"/></svg>\r\n                          Change\r\n                        </button>\r\n                      </div>\r\n                   `;\r\n              const chgBtn = assignmentCard.querySelector('#action-change-assignee-btn');\r\n              if (chgBtn) on(chgBtn as HTMLElement, 'click', showActionPicker);\r\n            } else {\r\n              // Revert to \"No assignment\" state\r\n              assignmentCard.innerHTML = `\r\n                      <div class=\"no-assignment\">\r\n                        <div class=\"no-assignment-icon\">\r\n                          <svg width=\"32\" height=\"32\" fill=\"none\" viewBox=\"0 0 24 24\" stroke=\"currentColor\"><path stroke-linecap=\"round\" stroke-linejoin=\"round\" stroke-width=\"1.5\" d=\"M18 9v3m0 0v3m0-3h3m-3 0h-3m-2-5a4 4 0 11-8 0 4 4 0 018 0zM3 20a6 6 0 0112 0v1H3v-1z\"/></svg>\r\n                        </div>\r\n                        <span>No one assigned</span>\r\n                        <p class=\"no-assignment-hint\">Use AI Suggest or choose manually</p>\r\n                        <button class=\"btn-assign-now\" id=\"action-show-picker-btn\" type=\"button\">Choose Manually</button>\r\n                      </div>\r\n                   `;\r\n              const pickBtn = assignmentCard.querySelector('#action-show-picker-btn');\r\n              if (pickBtn) on(pickBtn as HTMLElement, 'click', showActionPicker);\r\n            }\r\n          }\r\n        }\r\n      });\r\n    });\r\n  };\r\n\r\n  const showActionPicker = () => {\r\n    if (!actionContactPicker) return;\r\n    actionContactPicker.classList.toggle('hidden');\r\n    if (!actionContactPicker.classList.contains('hidden') && viewContacts.length === 0) {\r\n      contactsService.getAll().then((res) => {\r\n        if (!container.isConnected) return;\r\n        viewContacts = res?.contacts || [];\r\n        renderActionContactGrid(actionContactSearch?.value || '');\r\n      }).catch(() => {\r\n        if (actionContactList) actionContactList.innerHTML = '<div class=\"empty-state\">Failed to load contacts</div>';\r\n      });\r\n    } else if (!actionContactPicker.classList.contains('hidden')) {\r\n      renderActionContactGrid(actionContactSearch?.value || '');\r\n    }\r\n    if (actionContactSearch) actionContactSearch.focus();\r\n  };\r\n\r\n  const changeBtn = container.querySelector('#action-change-assignee-btn');\r\n  const showPickerBtn = container.querySelector('#action-show-picker-btn');\r\n  if (changeBtn && actionContactPicker) on(changeBtn as HTMLElement, 'click', showActionPicker);\r\n  if (showPickerBtn && actionContactPicker) on(showPickerBtn as HTMLElement, 'click', showActionPicker);\r\n  if (actionContactSearch) {\r\n    actionContactSearch.addEventListener('input', () => renderActionContactGrid(actionContactSearch.value));\r\n  }\r\n\r\n  // Find contact by assignee name: exact name, partial name, or any alias (case-insensitive)\r\n  function findContactByAssignee(name: string): Contact | undefined {\r\n    if (!name || !viewContacts.length) return undefined;\r\n    const n = name.trim().toLowerCase();\r\n    if (!n) return undefined;\r\n    const byExact = viewContacts.find((c) => (c.name || '').trim().toLowerCase() === n);\r\n    if (byExact) return byExact;\r\n    const byPartial = viewContacts.find(\r\n      (c) =>\r\n        (c.name || '').trim().toLowerCase().includes(n) ||\r\n        n.includes((c.name || '').trim().toLowerCase())\r\n    );\r\n    if (byPartial) return byPartial;\r\n    const byAlias = viewContacts.find((c) =>\r\n      (c.aliases || []).some((a) => String(a).trim().toLowerCase() === n)\r\n    );\r\n    if (byAlias) return byAlias;\r\n    return viewContacts.find((c) =>\r\n      (c.aliases || []).some((a) => {\r\n        const aLower = String(a).trim().toLowerCase();\r\n        return aLower.includes(n) || n.includes(aLower);\r\n      })\r\n    );\r\n  }\r\n\r\n  function findContactByRequester(contacts: Contact[], action: Action): Contact | undefined {\r\n    if (!contacts.length) return undefined;\r\n    if (action.requested_by_contact_id) {\r\n      const byId = contacts.find((c) => String(c.id) === String(action.requested_by_contact_id));\r\n      if (byId) return byId;\r\n    }\r\n    const name = (action.requested_by || '').trim();\r\n    if (!name) return undefined;\r\n    const n = name.toLowerCase();\r\n    const byExact = contacts.find((c) => (c.name || '').trim().toLowerCase() === n);\r\n    if (byExact) return byExact;\r\n    const byPartial = contacts.find((c) => (c.name || '').trim().toLowerCase().includes(n) || n.includes((c.name || '').trim().toLowerCase()));\r\n    return byPartial;\r\n  }\r\n\r\n  // Load contacts to show assigned role/avatar and requester card\r\n  contactsService.getAll().then((res) => {\r\n    if (!container.isConnected) return;\r\n    viewContacts = res?.contacts || [];\r\n    const contact = findContactByAssignee(assignee);\r\n    const roleEl = container.querySelector('#action-assigned-role');\r\n    if (roleEl) roleEl.textContent = contact?.role ?? '';\r\n    const avatarEl = container.querySelector('#action-assigned-avatar');\r\n    if (avatarEl && assignee) {\r\n      const photoUrl = getContactPhotoUrl(contact);\r\n      if (photoUrl) {\r\n        avatarEl.innerHTML = '';\r\n        const img = document.createElement('img');\r\n        img.src = photoUrl;\r\n        img.alt = '';\r\n        img.onerror = () => { avatarEl.textContent = getInitials(assignee); };\r\n        avatarEl.appendChild(img);\r\n      }\r\n    }\r\n    const requesterDisplay = container.querySelector('#action-requester-display') as HTMLElement;\r\n    if (requesterDisplay && (action.requested_by || action.requested_by_contact_id)) {\r\n      const requesterContact = findContactByRequester(viewContacts, action);\r\n      if (requesterContact) {\r\n        const photoUrl = getContactPhotoUrl(requesterContact);\r\n        const name = requesterContact.name || action.requested_by || '';\r\n        requesterDisplay.innerHTML = `\r\n          <p class=\"requested-by-label\">Requested by</p>\r\n          <div class=\"assigned-contact-display requester-contact-card\">\r\n            <div class=\"contact-avatar-lg\">${photoUrl ? `<img src=\"${escapeHtml(photoUrl)}\" alt=\"\" onerror=\"this.parentElement.textContent='${getInitials(name)}'\">` : getInitials(name)}</div>\r\n            <div class=\"contact-details\">\r\n              <div class=\"contact-name-lg\">${escapeHtml(name)}</div>\r\n              ${requesterContact.role ? `<div class=\"contact-role-sm\">${escapeHtml(requesterContact.role)}</div>` : ''}\r\n            </div>\r\n          </div>\r\n        `;\r\n      }\r\n    }\r\n  }).catch(() => { });\r\n\r\n  return container;\r\n}\r\n","/**\r\n * Actions Panel Component\r\n * Displays and manages action items\r\n */\r\n\r\nimport { createElement, on } from '@lib/dom';\r\nimport { actionsService, Action } from '@services/actions';\r\nimport { getSprints, getSprint } from '@services/sprints';\r\nimport type { Sprint } from '@services/sprints';\r\nimport { dataStore } from '@stores/data';\r\nimport { showActionModal } from '../modals/ActionModal';\r\nimport { showCreateSprintModal } from '../sprints/CreateSprintModal';\r\nimport { showSprintReportModal } from '../sprints/SprintReportModal';\r\nimport { createActionDetailView, ActionDetailViewProps } from '../actions/ActionDetailView';\r\nimport { formatRelativeTime, formatDate } from '@lib/format';\r\nimport { toast } from '@services/toast';\r\n\r\ntype ViewMode = 'list' | 'by_sprint' | 'by_story';\r\n\r\nfunction actionDetailProps(containerEl: HTMLElement, props: ActionsPanelProps, action: Action): ActionDetailViewProps {\r\n  return {\r\n    action,\r\n    onClose: () => {\r\n      containerEl.innerHTML = '';\r\n      containerEl.appendChild(createActionsPanel(props));\r\n    },\r\n    onUpdate: (updatedAction?: Action) => {\r\n      containerEl.innerHTML = '';\r\n      if (updatedAction) {\r\n        containerEl.appendChild(createActionDetailView(actionDetailProps(containerEl, props, updatedAction)));\r\n      } else {\r\n        containerEl.appendChild(createActionsPanel(props));\r\n      }\r\n    },\r\n  };\r\n}\r\n\r\nexport interface ActionsPanelProps {\r\n  onActionClick?: (action: Action) => void;\r\n  useDetailView?: boolean;\r\n  containerElement?: HTMLElement;\r\n}\r\n\r\nlet currentFilter: string = 'all';\r\nlet currentSprintId: string = '';\r\nlet currentViewMode: ViewMode = 'by_sprint';\r\n\r\n/**\r\n * Create actions panel\r\n */\r\nexport function createActionsPanel(props: ActionsPanelProps = {}): HTMLElement {\r\n  const panel = createElement('div', { className: 'sot-panel actions-panel' });\r\n\r\n  panel.innerHTML = `\r\n    <div class=\"panel-header\">\r\n      <div class=\"panel-title\">\r\n        <h2>Actions</h2>\r\n        <span class=\"panel-count\" id=\"actions-count\">0</span>\r\n      </div>\r\n      <div class=\"panel-actions\">\r\n        <div class=\"view-mode-tabs\" role=\"tablist\">\r\n          <button type=\"button\" class=\"view-mode-tab\" data-view=\"list\" title=\"Flat list\">List</button>\r\n          <button type=\"button\" class=\"view-mode-tab active\" data-view=\"by_sprint\" title=\"Group by sprint\">Sprints</button>\r\n          <button type=\"button\" class=\"view-mode-tab\" data-view=\"by_story\" title=\"Group by user story\">Stories</button>\r\n        </div>\r\n        <select id=\"actions-sprint-filter\" class=\"filter-select\" title=\"Sprint (List view)\">\r\n          <option value=\"\">All sprints</option>\r\n        </select>\r\n        <select id=\"actions-filter\" class=\"filter-select\">\r\n          <option value=\"all\">All</option>\r\n          <option value=\"pending\">Pending</option>\r\n          <option value=\"in_progress\">In Progress</option>\r\n          <option value=\"completed\">Completed</option>\r\n          <option value=\"overdue\">Overdue</option>\r\n        </select>\r\n        <button class=\"btn btn-outline-primary btn-sm\" id=\"create-sprint-btn\" title=\"Create sprint and generate tasks from emails/transcripts\">Sprint</button>\r\n        <button class=\"btn btn-primary btn-sm\" id=\"add-action-btn\">+ Add</button>\r\n      </div>\r\n    </div>\r\n    <div id=\"actions-report-strip\" class=\"actions-report-strip hidden\"></div>\r\n    <div id=\"actions-sprint-detail\" class=\"actions-sprint-detail hidden\"></div>\r\n    <div class=\"panel-content\" id=\"actions-content\">\r\n      <div class=\"loading\">Loading actions...</div>\r\n    </div>\r\n    <div id=\"removed-actions-container\" class=\"removed-actions-container hidden\"></div>\r\n  `;\r\n\r\n  // Populate sprint filter and bind\r\n  (async () => {\r\n    const sprintSelect = panel.querySelector('#actions-sprint-filter') as HTMLSelectElement;\r\n    if (!sprintSelect) return;\r\n    try {\r\n      const sprints = await getSprints();\r\n      sprints.forEach((s) => {\r\n        const opt = document.createElement('option');\r\n        opt.value = s.id;\r\n        opt.textContent = s.name;\r\n        if (s.id === currentSprintId) opt.selected = true;\r\n        sprintSelect.appendChild(opt);\r\n      });\r\n      on(sprintSelect, 'change', () => {\r\n        currentSprintId = sprintSelect.value || '';\r\n        loadActions(panel, props);\r\n      });\r\n    } catch {\r\n      // ignore\r\n    }\r\n  })();\r\n\r\n  panel.querySelectorAll('.view-mode-tab').forEach((tab) => {\r\n    on(tab as HTMLElement, 'click', () => {\r\n      const view = (tab as HTMLElement).getAttribute('data-view') as ViewMode;\r\n      if (!view || view === currentViewMode) return;\r\n      currentViewMode = view;\r\n      panel.querySelectorAll('.view-mode-tab').forEach((t) => t.classList.remove('active'));\r\n      tab.classList.add('active');\r\n      loadActions(panel, props);\r\n    });\r\n  });\r\n\r\n  const filterSelect = panel.querySelector('#actions-filter') as HTMLSelectElement;\r\n  on(filterSelect, 'change', () => {\r\n    currentFilter = filterSelect.value;\r\n    loadActions(panel, props);\r\n  });\r\n\r\n  const createSprintBtn = panel.querySelector('#create-sprint-btn');\r\n  if (createSprintBtn) {\r\n    on(createSprintBtn as HTMLElement, 'click', () => {\r\n      showCreateSprintModal({\r\n        onSuccess: () => loadActions(panel, props),\r\n      });\r\n    });\r\n  }\r\n  const addBtn = panel.querySelector('#add-action-btn');\r\n  if (addBtn) {\r\n    on(addBtn as HTMLElement, 'click', () => {\r\n      showActionModal({\r\n        mode: 'create',\r\n        onSave: () => loadActions(panel, props),\r\n      });\r\n    });\r\n  }\r\n\r\n  // Initial load\r\n  loadActions(panel, props);\r\n  refreshRemovedActionsSection(panel, props);\r\n  refreshReportStrip(panel);\r\n\r\n  return panel;\r\n}\r\n\r\n/**\r\n * Load and render the Sprint detail header when a sprint is selected\r\n */\r\nasync function refreshSprintDetailHeader(panel: HTMLElement): Promise<void> {\r\n  const container = panel.querySelector('#actions-sprint-detail') as HTMLElement;\r\n  if (!container) return;\r\n  if (!currentSprintId) {\r\n    container.classList.add('hidden');\r\n    container.innerHTML = '';\r\n    return;\r\n  }\r\n  try {\r\n    const sprint = await getSprint(currentSprintId);\r\n    if (!sprint) {\r\n      container.classList.add('hidden');\r\n      container.innerHTML = '';\r\n      return;\r\n    }\r\n    container.classList.remove('hidden');\r\n    const start = sprint.start_date ? new Date(sprint.start_date).toLocaleDateString() : '';\r\n    const end = sprint.end_date ? new Date(sprint.end_date).toLocaleDateString() : '';\r\n    container.innerHTML = `\r\n      <div class=\"sprint-detail-header\">\r\n        <div class=\"sprint-detail-title\">${escapeHtml(sprint.name)}</div>\r\n        <div class=\"sprint-detail-meta\">${start}  ${end}</div>\r\n        ${sprint.context ? `<div class=\"sprint-detail-context\">${escapeHtml(sprint.context)}</div>` : ''}\r\n        <button type=\"button\" class=\"btn btn-outline-primary btn-sm sprint-report-btn\" id=\"sprint-report-open-btn\" data-sprint-id=\"${escapeHtml(sprint.id)}\" data-sprint-name=\"${escapeHtml(sprint.name)}\">Sprint report</button>\r\n      </div>\r\n    `;\r\n    const reportBtn = container.querySelector('#sprint-report-open-btn');\r\n    if (reportBtn) {\r\n      on(reportBtn as HTMLElement, 'click', () => {\r\n        const id = (reportBtn as HTMLElement).getAttribute('data-sprint-id');\r\n        const name = (reportBtn as HTMLElement).getAttribute('data-sprint-name') || undefined;\r\n        if (id) showSprintReportModal({ sprintId: id, sprintName: name || undefined, onClose: () => { } });\r\n      });\r\n    }\r\n  } catch {\r\n    container.classList.add('hidden');\r\n    container.innerHTML = '';\r\n  }\r\n}\r\n\r\n/**\r\n * Load and render the actions report strip (by status)\r\n */\r\nasync function refreshReportStrip(panel: HTMLElement): Promise<void> {\r\n  const strip = panel.querySelector('#actions-report-strip') as HTMLElement;\r\n  if (!strip) return;\r\n  try {\r\n    const report = await actionsService.getReport();\r\n    const byStatus = report.by_status || {};\r\n    const bySprint = report.by_sprint || {};\r\n    const parts: string[] = [];\r\n    ['pending', 'in_progress', 'completed', 'cancelled'].forEach((s) => {\r\n      const n = byStatus[s] ?? 0;\r\n      if (n > 0) parts.push(`${s.replace('_', ' ')}: ${n}`);\r\n    });\r\n    const sprintParts = Object.entries(bySprint)\r\n      .filter(([k]) => k !== '(no sprint)')\r\n      .map(([, v]) => `${v.name}: ${v.count}`);\r\n    if (sprintParts.length > 0) parts.push(`Sprints: ${sprintParts.join('  ')}`);\r\n    if (parts.length === 0) {\r\n      strip.classList.add('hidden');\r\n      strip.innerHTML = '';\r\n      return;\r\n    }\r\n    strip.classList.remove('hidden');\r\n    strip.innerHTML = `<span class=\"actions-report-label\">By status:</span> ${parts.join('  ')}`;\r\n  } catch {\r\n    strip.classList.add('hidden');\r\n    strip.innerHTML = '';\r\n  }\r\n}\r\n\r\n/**\r\n * Load and render the \"Removed actions\" section (for restore). Syncs with graph on restore.\r\n */\r\nasync function refreshRemovedActionsSection(panel: HTMLElement, props: ActionsPanelProps): Promise<void> {\r\n  const container = panel.querySelector('#removed-actions-container') as HTMLElement;\r\n  if (!container) return;\r\n  try {\r\n    const deleted = await actionsService.getDeletedActions();\r\n    if (deleted.length === 0) {\r\n      container.classList.add('hidden');\r\n      container.innerHTML = '';\r\n      return;\r\n    }\r\n    container.classList.remove('hidden');\r\n    const truncate = (s: string, max: number) => (s.length > max ? s.slice(0, max) + '' : s);\r\n    container.innerHTML = `\r\n      <div class=\"removed-actions-section\">\r\n        <div class=\"removed-actions-header section-header-sota\">\r\n          <h3>Removed actions</h3>\r\n          <span class=\"panel-count removed-count\">${deleted.length}</span>\r\n        </div>\r\n        <p class=\"removed-actions-hint\">Restore to undo; action will be synced back to the graph.</p>\r\n        <div class=\"removed-actions-list\">\r\n          ${deleted.map((a) => `\r\n            <div class=\"removed-action-item\" data-action-id=\"${a.id}\">\r\n              <div class=\"removed-action-content\">${escapeHtml(truncate((a.task || a.content || ''), 100))}</div>\r\n              <button type=\"button\" class=\"btn btn-sm conflict-resolve-restore\">Restore</button>\r\n            </div>\r\n          `).join('')}\r\n        </div>\r\n      </div>\r\n    `;\r\n    container.querySelectorAll('.conflict-resolve-restore').forEach((btn) => {\r\n      const item = (btn as HTMLElement).closest('.removed-action-item');\r\n      const id = item?.getAttribute('data-action-id');\r\n      if (id) {\r\n        on(btn as HTMLElement, 'click', async () => {\r\n          try {\r\n            await actionsService.restoreAction(id);\r\n            toast.success('Action restored');\r\n            await loadActions(panel, props);\r\n            refreshRemovedActionsSection(panel, props);\r\n          } catch {\r\n            toast.error('Failed to restore action');\r\n          }\r\n        });\r\n      }\r\n    });\r\n  } catch {\r\n    container.classList.add('hidden');\r\n    container.innerHTML = '';\r\n  }\r\n}\r\n\r\n/**\r\n * Load actions (list or grouped by sprint / story)\r\n */\r\nasync function loadActions(panel: HTMLElement, props: ActionsPanelProps): Promise<void> {\r\n  const content = panel.querySelector('#actions-content') as HTMLElement;\r\n  content.innerHTML = '<div class=\"loading\">Loading...</div>';\r\n\r\n  try {\r\n    const status = currentFilter === 'all' || currentFilter === 'overdue' ? undefined : currentFilter;\r\n    const sprintFilter = currentViewMode === 'list' ? (currentSprintId || undefined) : undefined;\r\n    let actions = await actionsService.getAll(status, sprintFilter);\r\n\r\n    if (currentFilter === 'overdue') {\r\n      actions = actions.filter(a => actionsService.isOverdue(a));\r\n    }\r\n\r\n    dataStore.setActions(actions as unknown as []);\r\n\r\n    if (currentViewMode === 'by_sprint') {\r\n      await renderGroupedBySprint(content, actions, panel, props);\r\n    } else if (currentViewMode === 'by_story') {\r\n      await renderGroupedByStory(content, actions, panel, props);\r\n    } else {\r\n      renderActions(content, actions, props);\r\n    }\r\n\r\n    updateCount(panel, actions.length);\r\n    refreshRemovedActionsSection(panel, props);\r\n    refreshReportStrip(panel);\r\n    refreshSprintDetailHeader(panel);\r\n  } catch {\r\n    content.innerHTML = '<div class=\"error\">Failed to load actions</div>';\r\n  }\r\n}\r\n\r\n/**\r\n * Group actions by sprint and render sections (Sprint A, Sprint B, Tasks without sprint)\r\n */\r\nasync function renderGroupedBySprint(\r\n  content: HTMLElement,\r\n  actions: Action[],\r\n  panel: HTMLElement,\r\n  props: ActionsPanelProps\r\n): Promise<void> {\r\n  const sprints = await getSprints();\r\n  const bySprint = new Map<string, Action[]>();\r\n  const noSprint: Action[] = [];\r\n\r\n  for (const a of actions) {\r\n    const sid = (a as { sprint_id?: string }).sprint_id;\r\n    if (sid) {\r\n      if (!bySprint.has(sid)) bySprint.set(sid, []);\r\n      bySprint.get(sid)!.push(a);\r\n    } else {\r\n      noSprint.push(a);\r\n    }\r\n  }\r\n\r\n  const sprintList = sprints.filter((s) => bySprint.has(s.id));\r\n  content.innerHTML = '';\r\n\r\n  for (const sprint of sprintList) {\r\n    const groupActions = bySprint.get(sprint.id) || [];\r\n    const section = createGroupSection(\r\n      `${sprint.name} (${groupActions.length})`,\r\n      groupActions,\r\n      panel,\r\n      props,\r\n      () => {\r\n        currentSprintId = sprint.id;\r\n        refreshSprintDetailHeader(panel);\r\n      }\r\n    );\r\n    content.appendChild(section);\r\n  }\r\n\r\n  const noSprintSection = createGroupSection('Tasks without sprint', noSprint, panel, props);\r\n  content.appendChild(noSprintSection);\r\n}\r\n\r\n/**\r\n * Group actions by user story and render sections (Story 1, Story 2, Tasks without story)\r\n */\r\nasync function renderGroupedByStory(\r\n  content: HTMLElement,\r\n  actions: Action[],\r\n  panel: HTMLElement,\r\n  props: ActionsPanelProps\r\n): Promise<void> {\r\n  const stories = await actionsService.getUserStories();\r\n  const byStory = new Map<string, Action[]>();\r\n  const noStory: Action[] = [];\r\n\r\n  for (const a of actions) {\r\n    const storyId = (a as { parent_story_id?: string }).parent_story_id;\r\n    if (storyId) {\r\n      if (!byStory.has(storyId)) byStory.set(storyId, []);\r\n      byStory.get(storyId)!.push(a);\r\n    } else {\r\n      noStory.push(a);\r\n    }\r\n  }\r\n\r\n  content.innerHTML = '';\r\n\r\n  for (const story of stories) {\r\n    const groupActions = byStory.get(story.id) || [];\r\n    if (groupActions.length === 0 && !byStory.has(story.id)) continue;\r\n    const title = story.story_points != null ? `${story.title} (${story.story_points} pt)` : story.title;\r\n    const section = createGroupSection(`${title}  ${groupActions.length} tasks`, groupActions, panel, props);\r\n    content.appendChild(section);\r\n  }\r\n\r\n  const noStorySection = createGroupSection('Tasks without story', noStory, panel, props);\r\n  content.appendChild(noStorySection);\r\n}\r\n\r\nfunction createGroupSection(\r\n  title: string,\r\n  groupActions: Action[],\r\n  panel: HTMLElement,\r\n  props: ActionsPanelProps,\r\n  onHeaderClick?: () => void\r\n): HTMLElement {\r\n  const section = createElement('div', { className: 'actions-group' });\r\n  const header = createElement('div', { className: 'actions-group-header' });\r\n  header.innerHTML = `<h3 class=\"actions-group-title\">${escapeHtml(title)}</h3><span class=\"actions-group-count\">${groupActions.length}</span>`;\r\n  if (onHeaderClick) header.style.cursor = 'pointer';\r\n  if (onHeaderClick) on(header, 'click', onHeaderClick);\r\n  section.appendChild(header);\r\n  const listEl = createElement('div', { className: 'actions-group-list' });\r\n  section.appendChild(listEl);\r\n  if (groupActions.length === 0) {\r\n    listEl.innerHTML = '<p class=\"actions-group-empty\">No tasks</p>';\r\n  } else {\r\n    renderActionCards(listEl, groupActions, props);\r\n  }\r\n  return section;\r\n}\r\n\r\ntype ContactLike = { id?: string; name?: string; role?: string; photoUrl?: string; avatarUrl?: string; photo_url?: string; avatar_url?: string; aliases?: string[] };\r\n\r\nfunction findContactById(contacts: ContactLike[], id: string): ContactLike | undefined {\r\n  if (!id || !contacts.length) return undefined;\r\n  return contacts.find((c) => (c as { id?: string }).id && String((c as { id: string }).id) === String(id));\r\n}\r\n\r\nfunction findContactByAssignee(contacts: ContactLike[], name: string): ContactLike | undefined {\r\n  if (!name || !contacts.length) return undefined;\r\n  const n = name.trim().toLowerCase();\r\n  if (!n) return undefined;\r\n  const byExact = contacts.find((c) => (c.name || '').trim().toLowerCase() === n);\r\n  if (byExact) return byExact;\r\n  const byPartial = contacts.find(\r\n    (c) =>\r\n      (c.name || '').trim().toLowerCase().includes(n) ||\r\n      n.includes((c.name || '').trim().toLowerCase())\r\n  );\r\n  if (byPartial) return byPartial;\r\n  const byAlias = contacts.find((c) =>\r\n    (c.aliases || []).some((a) => String(a).trim().toLowerCase() === n)\r\n  );\r\n  return byAlias || contacts.find((c) =>\r\n    (c.aliases || []).some((a) => {\r\n      const aLower = String(a).trim().toLowerCase();\r\n      return aLower.includes(n) || n.includes(aLower);\r\n    })\r\n  );\r\n}\r\n\r\nfunction getContactPhotoUrl(c: ContactLike | undefined): string | null {\r\n  if (!c) return null;\r\n  return c.photoUrl || c.avatarUrl || c.photo_url || c.avatar_url || null;\r\n}\r\n\r\nfunction getInitials(name: string): string {\r\n  if (!name) return '?';\r\n  const parts = name.trim().split(/\\s+/);\r\n  return parts.length === 1 ? parts[0].substring(0, 2).toUpperCase() : (parts[0][0] + parts[parts.length - 1][0]).toUpperCase();\r\n}\r\n\r\n/**\r\n * Render action cards into a container (used by list view and grouped sections)\r\n */\r\nfunction renderActionCards(container: HTMLElement, actions: Action[], props: ActionsPanelProps): void {\r\n  if (actions.length === 0) return;\r\n  const panel = (container.closest && container.closest('.actions-panel')) as HTMLElement | null;\r\n  const contacts: ContactLike[] = (dataStore.getState().contacts || []) as ContactLike[];\r\n  const priorityBarColor: Record<string, string> = { high: '#ea580c', medium: '#ca8a04', low: '#16a34a' };\r\n  container.innerHTML = actions.map(action => buildActionCardHtml(action, contacts, priorityBarColor)).join('');\r\n  bindActionCards(container, actions, props, panel || undefined);\r\n}\r\n\r\nfunction buildActionCardHtml(\r\n  action: Action,\r\n  contacts: ContactLike[],\r\n  priorityBarColor: Record<string, string>\r\n): string {\r\n  const isOverdue = actionsService.isOverdue(action);\r\n  const priority = (action.priority || 'medium').toLowerCase();\r\n  const barColor = priorityBarColor[priority] ?? priorityBarColor.medium;\r\n  const content = (action.content ?? (action as { task?: string }).task ?? '').trim();\r\n  const assignee = action.assignee ?? (action as { owner?: string }).owner ?? '';\r\n  const contact = assignee ? findContactByAssignee(contacts, assignee) : undefined;\r\n  const photoUrl = getContactPhotoUrl(contact);\r\n  const assigneeChipHtml = assignee\r\n    ? `\r\n    <div class=\"assignee-chip\">\r\n      <div class=\"assignee-avatar\">${photoUrl ? `<img src=\"${escapeHtml(photoUrl)}\" alt=\"${escapeHtml(assignee)}\" onerror=\"this.parentElement.innerHTML='${getInitials(assignee)}'\">` : getInitials(assignee)}</div>\r\n      <div class=\"assignee-info\">\r\n        <span class=\"assignee-name\">${escapeHtml(assignee)}</span>\r\n        ${contact?.role ? `<span class=\"assignee-role\">${escapeHtml(contact.role)}</span>` : ''}\r\n      </div>\r\n    </div>\r\n  `\r\n    : '';\r\n  const requestedBy = (action as { requested_by?: string }).requested_by ?? '';\r\n  const requestedByContactId = (action as { requested_by_contact_id?: string }).requested_by_contact_id ?? '';\r\n  const requesterContact = requestedByContactId\r\n    ? findContactById(contacts, requestedByContactId)\r\n    : requestedBy\r\n      ? findContactByAssignee(contacts, requestedBy)\r\n      : undefined;\r\n  const requesterName = requesterContact?.name ?? requestedBy;\r\n  const requesterPhotoUrl = getContactPhotoUrl(requesterContact);\r\n  const requesterChipHtml =\r\n    requesterName || requestedByContactId\r\n      ? `\r\n    <div class=\"requester-chip card-source-chip\">\r\n      <span class=\"requester-label\">Requested by</span>\r\n      <div class=\"assignee-chip requester-chip-inner\">\r\n        <div class=\"assignee-avatar\">${requesterPhotoUrl ? `<img src=\"${escapeHtml(requesterPhotoUrl)}\" alt=\"${escapeHtml(requesterName || '')}\" onerror=\"this.parentElement.innerHTML='${getInitials(requesterName || '?')}'\">` : getInitials(requesterName || '?')}</div>\r\n        <span class=\"assignee-name\">${escapeHtml(requesterName || 'Unknown')}</span>\r\n      </div>\r\n    </div>\r\n  `\r\n      : '';\r\n  const dueChip = action.due_date ? `<span class=\"card-source-chip\">Due: ${formatDate(action.due_date)}</span>` : '<span class=\"card-source-chip text-muted\">No due date</span>';\r\n  return `\r\n    <div class=\"action-card-sota question-card-sota ${isOverdue ? 'overdue' : ''}\" data-id=\"${action.id}\" style=\"--action-priority-bar: ${barColor}\">\r\n      <div class=\"card-priority-bar action-priority-bar\"></div>\r\n      <div class=\"card-body\">\r\n        <div class=\"card-top-row\">\r\n          <div class=\"card-badges\">\r\n            <span class=\"status-pill status-${(action.status || 'pending').toLowerCase()}\">${escapeHtml(String(action.status).replace('_', ' '))}</span>\r\n            ${action.priority ? `<span class=\"priority-pill priority-${action.priority}\">${escapeHtml(action.priority)}</span>` : ''}\r\n            ${isOverdue ? '<span class=\"status-pill overdue\">OVERDUE</span>' : ''}\r\n          </div>\r\n          <span class=\"card-timestamp\">${formatRelativeTime(action.created_at)}</span>\r\n        </div>\r\n        <div class=\"card-question-text\">${escapeHtml(content)}</div>\r\n        <div class=\"card-bottom-row\">\r\n          <div class=\"card-requester\">\r\n            ${assigneeChipHtml}\r\n            ${requesterChipHtml}\r\n            ${dueChip}\r\n          </div>\r\n          <div class=\"card-assignment\">\r\n            <button type=\"button\" class=\"btn-link action-view-link\">View</button>\r\n          </div>\r\n        </div>\r\n      </div>\r\n    </div>\r\n  `;\r\n}\r\n\r\nfunction bindActionCards(container: HTMLElement, actions: Action[], props: ActionsPanelProps, panel?: HTMLElement | null): void {\r\n  const reload = () => (panel ? loadActions(panel, props) : undefined);\r\n  container.querySelectorAll('.action-card-sota').forEach((card) => {\r\n    on(card as HTMLElement, 'click', (e) => {\r\n      if ((e.target as HTMLElement).closest('.card-assignment')) return;\r\n      const id = card.getAttribute('data-id');\r\n      const action = actions.find((a) => String(a.id) === id);\r\n      if (!action) return;\r\n      if (props.useDetailView && props.containerElement) {\r\n        const containerEl = props.containerElement;\r\n        containerEl.innerHTML = '';\r\n        containerEl.appendChild(createActionDetailView(actionDetailProps(containerEl, props, action)));\r\n      } else if (props.onActionClick) {\r\n        props.onActionClick(action);\r\n      } else {\r\n        showActionModal({ mode: 'edit', action, onSave: reload });\r\n      }\r\n    });\r\n    const viewLink = card.querySelector('.action-view-link');\r\n    if (viewLink) {\r\n      on(viewLink as HTMLElement, 'click', (e) => {\r\n        e.stopPropagation();\r\n        const id = card.getAttribute('data-id');\r\n        const action = actions.find((a) => String(a.id) === id);\r\n        if (!action) return;\r\n        if (props.useDetailView && props.containerElement) {\r\n          const containerEl = props.containerElement;\r\n          containerEl.innerHTML = '';\r\n          containerEl.appendChild(createActionDetailView(actionDetailProps(containerEl, props, action)));\r\n        } else if (props.onActionClick) {\r\n          props.onActionClick(action);\r\n        } else {\r\n          showActionModal({ mode: 'edit', action, onSave: reload });\r\n        }\r\n      });\r\n    }\r\n  });\r\n}\r\n\r\n/**\r\n * Render actions list (flat view)\r\n */\r\nfunction renderActions(container: HTMLElement, actions: Action[], props: ActionsPanelProps): void {\r\n  if (actions.length === 0) {\r\n    container.innerHTML = `\r\n      <div class=\"empty-state\">\r\n        <p>No actions found</p>\r\n        <button class=\"btn btn-primary\" id=\"empty-add-btn\">Add Action</button>\r\n      </div>\r\n    `;\r\n    const addBtn = container.querySelector('#empty-add-btn');\r\n    if (addBtn) {\r\n      on(addBtn as HTMLElement, 'click', () => {\r\n        showActionModal({ mode: 'create' });\r\n      });\r\n    }\r\n    return;\r\n  }\r\n  renderActionCards(container, actions, props);\r\n}\r\n\r\n/**\r\n * Update count badge\r\n */\r\nfunction updateCount(panel: HTMLElement, count: number): void {\r\n  const countEl = panel.querySelector('#actions-count');\r\n  if (countEl) {\r\n    countEl.textContent = String(count);\r\n  }\r\n}\r\n\r\n/**\r\n * Escape HTML\r\n */\r\nfunction escapeHtml(text: string): string {\r\n  const div = document.createElement('div');\r\n  div.textContent = text;\r\n  return div.innerHTML;\r\n}\r\n\r\nexport default createActionsPanel;\r\n","/**\n * Decision Modal Component\n * Create, view and edit decisions\n */\n\nimport { createElement, on } from '@lib/dom';\nimport { createModal, openModal, closeModal } from '@components/Modal';\nimport { Decision } from '@stores/data';\nimport { http } from '@services/api';\nimport { decisionsService } from '@services/decisions';\nimport { contactsService, Contact } from '@services/contacts';\nimport { toast } from '@services/toast';\nimport { formatRelativeTime } from '@lib/format';\n\nfunction getInitials(name: string): string {\n  if (!name) return '?';\n  const parts = name.trim().split(/\\s+/);\n  return parts.length === 1 ? parts[0].substring(0, 2).toUpperCase() : (parts[0][0] + parts[parts.length - 1][0]).toUpperCase();\n}\n\nfunction getContactPhotoUrl(c: Contact | undefined): string | null {\n  if (!c) return null;\n  const u = c as { photoUrl?: string; avatarUrl?: string; photo_url?: string; avatar_url?: string };\n  return u.photoUrl || u.avatarUrl || u.photo_url || u.avatar_url || null;\n}\n\nconst MODAL_ID = 'decision-modal';\n\nexport interface DecisionModalProps {\n  mode: 'view' | 'edit' | 'create';\n  decision?: Decision;\n  onSave?: (decision: Decision) => void;\n  onDelete?: (decisionId: string) => void;\n}\n\n/**\n * Show decision modal\n */\nexport function showDecisionModal(props: DecisionModalProps): void {\n  const { mode, decision, onSave, onDelete } = props;\n  const isEdit = mode === 'edit' && decision?.id;\n  const isView = mode === 'view';\n\n  // Remove existing modal\n  const existing = document.querySelector(`[data-modal-id=\"${MODAL_ID}\"]`);\n  if (existing) existing.remove();\n\n  const content = createElement('div', { className: 'decision-modal-content' });\n\n  if (isView && decision) {\n    const viewContent = (decision as any).content ?? decision.decision;\n    const viewImpact = (decision as any).impact;\n    const viewSummary = (decision as any).summary;\n    content.innerHTML = `\n      <div class=\"decision-view\">\n        <div class=\"decision-meta\">\n          <span class=\"status-badge ${decision.status}\">${decision.status}</span>\n          ${viewImpact ? `<span class=\"impact-badge impact-${viewImpact}\">${escapeHtml(viewImpact)} impact</span>` : ''}\n          <span class=\"decision-date\">${formatRelativeTime(decision.madeAt)}</span>\n        </div>\n        \n        <div class=\"decision-text-large\">\n          ${escapeHtml(viewContent)}\n        </div>\n        \n        ${viewSummary ? `\n          <div class=\"decision-section decision-summary\">\n            <h4>Summary</h4>\n            <p>${escapeHtml(viewSummary)}</p>\n          </div>\n        ` : ''}\n        \n        ${decision.rationale ? `\n          <div class=\"decision-section\">\n            <h4>Rationale</h4>\n            <p>${escapeHtml(decision.rationale)}</p>\n          </div>\n        ` : ''}\n        \n        ${decision.madeBy ? `\n          <div class=\"decision-made-by\">\n            <strong>Decision made by:</strong> ${escapeHtml(decision.madeBy)}\n          </div>\n        ` : ''}\n      </div>\n    `;\n  } else {\n    const decisionContent = (decision as any)?.content ?? decision?.decision ?? '';\n    const decisionImpact = (decision as any)?.impact ?? '';\n    const decisionSummary = (decision as any)?.summary ?? '';\n    content.innerHTML = `\n      <form id=\"decision-form\" class=\"decision-form\">\n        <div class=\"form-group\">\n          <label for=\"decision-text\">Decision *</label>\n          <textarea id=\"decision-text\" rows=\"3\" required \n                    placeholder=\"What was decided?\">${escapeHtml(decisionContent)}</textarea>\n        </div>\n        \n        <div class=\"form-group\">\n          <label for=\"decision-rationale\">Rationale</label>\n          <div class=\"form-group-with-action\">\n            <textarea id=\"decision-rationale\" rows=\"2\" \n                      placeholder=\"Why was this decision made?\">${escapeHtml(decision?.rationale || '')}</textarea>\n          </div>\n        </div>\n        \n        <div class=\"form-row\">\n          <div class=\"form-group\">\n            <label for=\"decision-impact\">Impact</label>\n            <select id=\"decision-impact\">\n              <option value=\"\"></option>\n              <option value=\"low\" ${decisionImpact === 'low' ? 'selected' : ''}>Low</option>\n              <option value=\"medium\" ${decisionImpact === 'medium' || !decisionImpact ? 'selected' : ''}>Medium</option>\n              <option value=\"high\" ${decisionImpact === 'high' ? 'selected' : ''}>High</option>\n            </select>\n          </div>\n          <div class=\"form-group\">\n            <label for=\"decision-summary\">Summary (one line)</label>\n            <input type=\"text\" id=\"decision-summary\" \n                   value=\"${escapeHtml(decisionSummary)}\" \n                   placeholder=\"One-line summary for lists/reports\">\n          </div>\n        </div>\n        \n        <div class=\"form-row form-row-actions\">\n          <button type=\"button\" class=\"btn-ai-suggest btn-sm\" id=\"decision-ai-suggest-btn\" title=\"Suggest rationale, impact and summary from decision text\">\n            <svg width=\"16\" height=\"16\" fill=\"none\" viewBox=\"0 0 24 24\" stroke=\"currentColor\"><path stroke-linecap=\"round\" stroke-linejoin=\"round\" stroke-width=\"2\" d=\"M13 10V3L4 14h7v7l9-11h-7z\"/></svg>\n            AI suggest\n          </button>\n          <span class=\"form-hint\" id=\"decision-suggest-hint\"></span>\n        </div>\n        \n        <div class=\"form-row\">\n          <div class=\"form-group\">\n            <label for=\"decision-status\">Status</label>\n            <select id=\"decision-status\">\n              <option value=\"proposed\" ${decision?.status === 'proposed' || !decision ? 'selected' : ''}>Proposed</option>\n              <option value=\"approved\" ${decision?.status === 'approved' ? 'selected' : ''}>Approved</option>\n              <option value=\"rejected\" ${decision?.status === 'rejected' ? 'selected' : ''}>Rejected</option>\n            </select>\n          </div>\n          \n          <div class=\"form-group\">\n            <label>Made By</label>\n            <input type=\"hidden\" id=\"decision-by\" value=\"${escapeHtml(decision?.madeBy || '')}\">\n            <div id=\"decision-made-by-display\" class=\"current-assignment-card decision-modal-owner-card\"></div>\n            <div id=\"decision-modal-contact-picker\" class=\"contact-picker-sota contact-picker-mt hidden\">\n              <div class=\"picker-search\">\n                <svg width=\"16\" height=\"16\" fill=\"none\" viewBox=\"0 0 24 24\" stroke=\"currentColor\"><path stroke-linecap=\"round\" stroke-linejoin=\"round\" stroke-width=\"2\" d=\"M21 21l-6-6m2-5a7 7 0 11-14 0 7 7 0 0114 0z\"/></svg>\n                <input type=\"text\" id=\"decision-modal-contact-search\" placeholder=\"Search contacts...\" autocomplete=\"off\">\n              </div>\n              <div id=\"decision-modal-contact-list\" class=\"contact-list-grid\">Loading...</div>\n            </div>\n          </div>\n        </div>\n      </form>\n    `;\n\n    const suggestBtn = content.querySelector('#decision-ai-suggest-btn');\n    const hintEl = content.querySelector('#decision-suggest-hint');\n    if (suggestBtn) {\n      on(suggestBtn as HTMLElement, 'click', async () => {\n        const getVal = (id: string) => (content.querySelector(`#${id}`) as HTMLInputElement | HTMLTextAreaElement | HTMLSelectElement)?.value?.trim() || '';\n        const text = getVal('decision-text');\n        if (!text) {\n          toast.warning('Enter decision text first');\n          return;\n        }\n        (suggestBtn as HTMLButtonElement).disabled = true;\n        if (hintEl) hintEl.textContent = 'Asking AI';\n        try {\n          const result = await decisionsService.suggest(text, getVal('decision-rationale'));\n          (content.querySelector('#decision-rationale') as HTMLTextAreaElement).value = result.rationale || '';\n          (content.querySelector('#decision-impact') as HTMLSelectElement).value = result.impact || 'medium';\n          (content.querySelector('#decision-summary') as HTMLInputElement).value = result.summary || '';\n          if (hintEl) hintEl.textContent = result.impact_summary ? `Impact: ${result.impact_summary}` : 'Done';\n        } catch {\n          if (hintEl) hintEl.textContent = '';\n          toast.error('AI suggest failed');\n        } finally {\n          (suggestBtn as HTMLButtonElement).disabled = false;\n        }\n      });\n    }\n\n    // Made By: contact picker + current-assignment display\n    let modalContacts: Contact[] = [];\n    const madeByDisplay = content.querySelector('#decision-made-by-display') as HTMLElement;\n    const madeByInput = content.querySelector('#decision-by') as HTMLInputElement;\n    const modalPicker = content.querySelector('#decision-modal-contact-picker') as HTMLElement;\n    const modalContactList = content.querySelector('#decision-modal-contact-list') as HTMLElement;\n    const modalContactSearch = content.querySelector('#decision-modal-contact-search') as HTMLInputElement;\n\n    function findContactByName(name: string): Contact | undefined {\n      if (!name || !modalContacts.length) return undefined;\n      const n = name.trim().toLowerCase();\n      if (!n) return undefined;\n      const byExact = modalContacts.find((c) => (c.name || '').trim().toLowerCase() === n);\n      if (byExact) return byExact;\n      const byAlias = modalContacts.find((c) =>\n        (c.aliases || []).some((a) => String(a).trim().toLowerCase() === n)\n      );\n      return byAlias;\n    }\n\n    function renderMadeByDisplay(madeBy: string) {\n      if (!madeByDisplay || !madeByInput) return;\n      madeByInput.value = madeBy;\n      if (madeBy) {\n        const contact = findContactByName(madeBy);\n        const photoUrl = getContactPhotoUrl(contact);\n        madeByDisplay.innerHTML = `\n          <div class=\"assigned-contact-display\">\n            <div class=\"contact-avatar-lg\">${photoUrl ? `<img src=\"${escapeHtml(photoUrl)}\" alt=\"\" onerror=\"this.parentElement.innerHTML='${getInitials(madeBy)}'\">` : getInitials(madeBy)}</div>\n            <div class=\"contact-details\">\n              <div class=\"contact-name-lg\">${escapeHtml(madeBy)}</div>\n              ${contact?.role ? `<div class=\"contact-role-sm\">${escapeHtml(contact.role)}</div>` : ''}\n            </div>\n            <button type=\"button\" class=\"btn-change-assignment\" id=\"decision-modal-change-owner-btn\">\n              <svg width=\"14\" height=\"14\" fill=\"none\" viewBox=\"0 0 24 24\" stroke=\"currentColor\"><path stroke-linecap=\"round\" stroke-linejoin=\"round\" stroke-width=\"2\" d=\"M15.232 5.232l3.536 3.536m-2.036-5.036a2.5 2.5 0 113.536 3.536L6.5 21.036H3v-3.572L16.732 3.732z\"/></svg>\n              Change\n            </button>\n          </div>`;\n      } else {\n        madeByDisplay.innerHTML = `\n          <div class=\"no-assignment\">\n            <span>No owner</span>\n            <button type=\"button\" class=\"btn-assign-now\" id=\"decision-modal-choose-owner-btn\">Choose</button>\n          </div>`;\n      }\n      const changeBtn = madeByDisplay.querySelector('#decision-modal-change-owner-btn');\n      const chooseBtn = madeByDisplay.querySelector('#decision-modal-choose-owner-btn');\n      if (changeBtn) on(changeBtn as HTMLElement, 'click', showModalPicker);\n      if (chooseBtn) on(chooseBtn as HTMLElement, 'click', showModalPicker);\n    }\n\n    function showModalPicker() {\n      if (!modalPicker) return;\n      const wasHidden = modalPicker.classList.contains('hidden');\n      modalPicker.classList.toggle('hidden', !wasHidden);\n      if (wasHidden && modalContacts.length === 0) {\n        contactsService.getAll().then((res) => {\n          modalContacts = res?.contacts || [];\n          renderModalContactGrid(modalContactSearch?.value || '');\n        }).catch(() => {\n          if (modalContactList) modalContactList.innerHTML = '<div class=\"empty-state\">Failed to load contacts</div>';\n        });\n      } else if (wasHidden) {\n        renderModalContactGrid(modalContactSearch?.value || '');\n      }\n      if (modalContactSearch) modalContactSearch.focus();\n    }\n\n    function renderModalContactGrid(filter: string) {\n      if (!modalContactList) return;\n      const list = filter\n        ? modalContacts.filter(\n          (c) =>\n            (c.name || '').toLowerCase().includes(filter.toLowerCase()) ||\n            (c.role || '').toLowerCase().includes(filter.toLowerCase())\n        )\n        : modalContacts;\n      if (modalContacts.length === 0) {\n        modalContactList.innerHTML = '<div class=\"empty-state\">Loading...</div>';\n        return;\n      }\n      if (list.length === 0) {\n        modalContactList.innerHTML = '<div class=\"empty-state\">No contacts match</div>';\n        return;\n      }\n      const currentMadeBy = (madeByInput?.value || '').trim();\n      modalContactList.innerHTML = list\n        .map((c) => {\n          const photoUrl = getContactPhotoUrl(c);\n          const isCurrent = currentMadeBy === (c.name || '').trim();\n          return `\n            <div class=\"contact-card-picker ${isCurrent ? 'selected' : ''}\" data-contact-name=\"${escapeHtml(c.name || '')}\">\n              <div class=\"contact-avatar-picker\">${photoUrl ? `<img src=\"${escapeHtml(photoUrl)}\" alt=\"\" onerror=\"this.parentElement.innerHTML='${getInitials(c.name || '')}'\">` : getInitials(c.name || '')}</div>\n              <div class=\"contact-info-picker\">\n                <div class=\"contact-name-picker\">${escapeHtml(c.name || '')}</div>\n                ${c.role ? `<div class=\"contact-role-picker\">${escapeHtml(c.role)}</div>` : ''}\n              </div>\n            </div>`;\n        })\n        .join('');\n      modalContactList.querySelectorAll('.contact-card-picker').forEach((card) => {\n        on(card as HTMLElement, 'click', () => {\n          const name = card.getAttribute('data-contact-name') || '';\n          if (name) {\n            renderMadeByDisplay(name);\n            if (modalPicker) modalPicker.classList.add('hidden');\n          }\n        });\n      });\n    }\n\n    contactsService.getAll().then((res) => {\n      modalContacts = res?.contacts || [];\n      renderMadeByDisplay(decision?.madeBy || '');\n    }).catch(() => {\n      renderMadeByDisplay(decision?.madeBy || '');\n    });\n\n    if (modalContactSearch) {\n      modalContactSearch.addEventListener('input', () => renderModalContactGrid(modalContactSearch.value));\n    }\n  }\n\n  // Footer\n  const footer = createElement('div', { className: 'modal-footer' });\n\n  if (isView && decision) {\n    // Quick status change buttons for proposed decisions\n    if (decision.status === 'proposed') {\n      const approveBtn = createElement('button', {\n        className: 'btn btn-success',\n        textContent: 'Approve',\n      });\n\n      const rejectBtn = createElement('button', {\n        className: 'btn btn-danger',\n        textContent: 'Reject',\n      });\n\n      on(approveBtn, 'click', () => updateStatus(String(decision.id), 'approved', onSave));\n      on(rejectBtn, 'click', () => updateStatus(String(decision.id), 'rejected', onSave));\n\n      footer.appendChild(rejectBtn);\n      footer.appendChild(approveBtn);\n    }\n\n    const editBtn = createElement('button', {\n      className: 'btn btn-primary',\n      textContent: 'Edit',\n    });\n\n    const closeBtn = createElement('button', {\n      className: 'btn btn-secondary',\n      textContent: 'Close',\n    });\n\n    on(closeBtn, 'click', () => closeModal(MODAL_ID));\n    on(editBtn, 'click', () => {\n      closeModal(MODAL_ID);\n      showDecisionModal({ ...props, mode: 'edit' });\n    });\n\n    footer.appendChild(closeBtn);\n    footer.appendChild(editBtn);\n  } else {\n    const cancelBtn = createElement('button', {\n      className: 'btn btn-secondary',\n      textContent: 'Cancel',\n    });\n\n    const saveBtn = createElement('button', {\n      className: 'btn btn-primary',\n      textContent: isEdit ? 'Save Changes' : 'Create Decision',\n    });\n\n    on(cancelBtn, 'click', () => closeModal(MODAL_ID));\n\n    on(saveBtn, 'click', async () => {\n      const form = content.querySelector('#decision-form') as HTMLFormElement;\n      if (!form.checkValidity()) {\n        form.reportValidity();\n        return;\n      }\n\n      const getValue = (id: string) => (content.querySelector(`#${id}`) as HTMLInputElement | HTMLTextAreaElement | HTMLSelectElement)?.value.trim() || '';\n\n      const decisionData: Decision & { impact?: string; summary?: string } = {\n        id: decision?.id || `dec-${Date.now()}`,\n        decision: getValue('decision-text'),\n        rationale: getValue('decision-rationale') || undefined,\n        status: getValue('decision-status') as Decision['status'],\n        madeBy: getValue('decision-by') || undefined,\n        madeAt: decision?.madeAt || new Date().toISOString(),\n        impact: getValue('decision-impact') as 'low' | 'medium' | 'high' || undefined,\n        summary: getValue('decision-summary') || undefined,\n      };\n\n      saveBtn.disabled = true;\n      saveBtn.textContent = 'Saving...';\n\n      const apiPayload = {\n        content: decisionData.decision,\n        decision: decisionData.decision,\n        rationale: decisionData.rationale,\n        status: decisionData.status,\n        made_by: decisionData.madeBy,\n        impact: decisionData.impact,\n        summary: decisionData.summary,\n      };\n      try {\n        if (isEdit) {\n          await http.put(`/api/decisions/${decision!.id}`, apiPayload);\n          toast.success('Decision updated');\n        } else {\n          const response = await http.post<{ id: string }>('/api/decisions', apiPayload);\n          decisionData.id = response.data.id;\n          toast.success('Decision recorded');\n        }\n\n        onSave?.(decisionData);\n        closeModal(MODAL_ID);\n      } catch {\n        // Error shown by API service\n      } finally {\n        saveBtn.disabled = false;\n        saveBtn.textContent = isEdit ? 'Save Changes' : 'Create Decision';\n      }\n    });\n\n    if (isEdit) {\n      const deleteBtn = createElement('button', {\n        className: 'btn btn-danger',\n        textContent: 'Delete',\n      });\n\n      on(deleteBtn, 'click', async () => {\n        const { confirm } = await import('../Modal');\n        const confirmed = await confirm(\n          'Are you sure you want to delete this decision?',\n          {\n            title: 'Delete Decision',\n            confirmText: 'Delete',\n            confirmClass: 'btn-danger',\n          }\n        );\n\n        if (confirmed) {\n          try {\n            await http.delete(`/api/decisions/${decision!.id}`);\n            toast.success('Decision deleted');\n            onDelete?.(String(decision!.id));\n            closeModal(MODAL_ID);\n          } catch {\n            // Error shown by API service\n          }\n        }\n      });\n\n      footer.appendChild(deleteBtn);\n    }\n\n    footer.appendChild(cancelBtn);\n    footer.appendChild(saveBtn);\n  }\n\n  // Create modal\n  const modal = createModal({\n    id: MODAL_ID,\n    title: isView ? 'Decision Details' : (isEdit ? 'Edit Decision' : 'Record Decision'),\n    content,\n    size: 'md',\n    footer,\n  });\n\n  document.body.appendChild(modal);\n  openModal(MODAL_ID);\n}\n\n/**\n * Update decision status\n */\nasync function updateStatus(\n  decisionId: string,\n  status: Decision['status'],\n  onSave?: (decision: Decision) => void\n): Promise<void> {\n  try {\n    await http.patch(`/api/decisions/${decisionId}`, { status });\n    toast.success(`Decision ${status}`);\n    closeModal(MODAL_ID);\n    // Note: In a real app, we'd update the local state here\n  } catch {\n    // Error shown by API service\n  }\n}\n\n/**\n * Escape HTML\n */\nfunction escapeHtml(text: string): string {\n  const div = document.createElement('div');\n  div.textContent = text;\n  return div.innerHTML;\n}\n\nexport default showDecisionModal;\n","/**\n * Decision Detail View\n * Full-page view for decision details: content, status, rationale, owner, source, timeline, similar decisions\n */\n\nimport { createElement, on } from '@lib/dom';\nimport { Decision, decisionsService } from '@services/decisions';\nimport { Action, actionsService } from '@services/actions';\nimport { contactsService, Contact } from '@services/contacts';\nimport { toast } from '@services/toast';\nimport { formatRelativeTime, formatDateTime } from '@lib/format';\n\nfunction getInitials(name: string): string {\n  return name.trim().split(/\\s+/).map((s) => s[0]).join('').toUpperCase().substring(0, 2);\n}\n\nexport interface DecisionDetailViewProps {\n  decision: Decision;\n  onClose: () => void;\n  onUpdate?: (decision: Decision) => void;\n  onDecisionClick?: (decision: Decision) => void;\n  /** When user clicks an implementing action (optional, e.g. open action detail) */\n  onActionClick?: (action: { id: string | number; task?: string; content?: string; status?: string }) => void;\n}\n\nfunction escapeHtml(text: string): string {\n  const div = document.createElement('div');\n  div.textContent = text;\n  return div.innerHTML;\n}\n\nfunction formatDate(iso: string | undefined): string {\n  if (!iso) return '';\n  try {\n    return formatDateTime(iso);\n  } catch {\n    return iso;\n  }\n}\n\nexport function createDecisionDetailView(props: DecisionDetailViewProps): HTMLElement {\n  const { decision, onClose, onUpdate, onDecisionClick, onActionClick } = props;\n\n  const container = createElement('div', { className: 'decision-detail-view question-detail-view' });\n\n  container.innerHTML = `\n    <div class=\"question-detail-header decision-detail-header\">\n      <div class=\"breadcrumb\">\n        <a href=\"#\" class=\"breadcrumb-link\" id=\"back-to-list\">Decisions</a>\n        <span class=\"breadcrumb-separator\"></span>\n        <span class=\"breadcrumb-current\">Decision #${String(decision.id).substring(0, 8)}</span>\n      </div>\n      <div class=\"header-actions\">\n        <span class=\"status-badge status-${(decision.status || 'active').toLowerCase()}\">${escapeHtml(String(decision.status))}</span>\n        <button class=\"btn btn-icon\" id=\"close-detail\" title=\"Close\"></button>\n      </div>\n    </div>\n\n    <div class=\"question-detail-content decision-detail-content\">\n      <div id=\"decision-view-content\">\n      <section class=\"detail-section decision-main\">\n        <div class=\"question-badges decision-badges\">\n          ${decision.impact ? `<span class=\"priority-pill impact-${decision.impact}\">${escapeHtml(decision.impact)} impact</span>` : ''}\n          ${decision.generation_source ? `<span class=\"status-pill\">${escapeHtml(decision.generation_source)}</span>` : ''}\n          <span class=\"question-date decision-date\">Created ${formatRelativeTime(decision.created_at)}</span>\n        </div>\n        <h2 class=\"question-text decision-content-text\" id=\"decision-view-content-text\">${escapeHtml(decision.content)}</h2>\n      </section>\n\n      <div class=\"detail-columns\">\n        <div class=\"detail-column-left\">\n          <section class=\"detail-section\">\n            <div class=\"section-header-sota\">\n              <h3>Rationale / Context</h3>\n              <span class=\"section-subtitle\">Why was this decision made?</span>\n              <button type=\"button\" class=\"btn-ai-suggest\" id=\"decision-rationale-ai-suggest-btn\" title=\"Suggest rationale, impact and summary from decision text\">\n                <svg width=\"16\" height=\"16\" fill=\"none\" viewBox=\"0 0 24 24\" stroke=\"currentColor\"><path stroke-linecap=\"round\" stroke-linejoin=\"round\" stroke-width=\"2\" d=\"M13 10V3L4 14h7v7l9-11h-7z\"/></svg>\n                AI Suggest\n              </button>\n            </div>\n            <div id=\"decision-view-rationale\">${(decision.rationale || decision.context) ? `<p class=\"decision-rationale\">${escapeHtml(decision.rationale || decision.context || '')}</p>` : '<p class=\"text-muted\">No rationale recorded</p>'}</div>\n            <div id=\"decision-suggestions-panel\" class=\"suggestions-panel-sota decision-suggestions-panel hidden gm-mt-2\"></div>\n          </section>\n\n          <section class=\"detail-section\" id=\"decision-owner-section\">\n            <div class=\"section-header-sota\">\n              <h3>\n                <svg width=\"20\" height=\"20\" fill=\"none\" viewBox=\"0 0 24 24\" stroke=\"currentColor\">\n                  <path stroke-linecap=\"round\" stroke-linejoin=\"round\" stroke-width=\"2\" d=\"M16 7a4 4 0 11-8 0 4 4 0 018 0zM12 14a7 7 0 00-7 7h14a7 7 0 00-7-7z\"/>\n                </svg>\n                Owner / Made by\n                <span class=\"section-subtitle\">Who made this decision?</span>\n              </h3>\n              <button type=\"button\" class=\"btn-ai-suggest\" id=\"decision-owner-ai-suggest-btn\" title=\"Suggest owner from decision content\">\n                <svg width=\"16\" height=\"16\" fill=\"none\" viewBox=\"0 0 24 24\" stroke=\"currentColor\"><path stroke-linecap=\"round\" stroke-linejoin=\"round\" stroke-width=\"2\" d=\"M13 10V3L4 14h7v7l9-11h-7z\"/></svg>\n                AI Suggest\n              </button>\n            </div>\n\n            <div id=\"decision-current-owner\" class=\"current-assignment-card\">\n              ${(decision.made_by || decision.owner) ? `\n                <div class=\"assigned-contact-display\">\n                  <div class=\"contact-avatar-lg\" id=\"decision-owner-avatar\">${getInitials(decision.made_by || decision.owner || '')}</div>\n                  <div class=\"contact-details\">\n                    <div class=\"contact-name-lg\">${escapeHtml(decision.made_by || decision.owner || '')}</div>\n                    <div class=\"contact-role-sm\" id=\"decision-owner-role\"></div>\n                  </div>\n                  <button class=\"btn-change-assignment\" id=\"decision-change-owner-btn\" type=\"button\">\n                    <svg width=\"14\" height=\"14\" fill=\"none\" viewBox=\"0 0 24 24\" stroke=\"currentColor\"><path stroke-linecap=\"round\" stroke-linejoin=\"round\" stroke-width=\"2\" d=\"M15.232 5.232l3.536 3.536m-2.036-5.036a2.5 2.5 0 113.536 3.536L6.5 21.036H3v-3.572L16.732 3.732z\"/></svg>\n                    Change\n                  </button>\n                </div>\n              ` : `\n                <div class=\"no-assignment\">\n                  <div class=\"no-assignment-icon\">\n                    <svg width=\"32\" height=\"32\" fill=\"none\" viewBox=\"0 0 24 24\" stroke=\"currentColor\"><path stroke-linecap=\"round\" stroke-linejoin=\"round\" stroke-width=\"1.5\" d=\"M18 9v3m0 0v3m0-3h3m-3 0h-3m-2-5a4 4 0 11-8 0 4 4 0 018 0zM3 20a6 6 0 0112 0v1H3v-1z\"/></svg>\n                  </div>\n                  <span>No owner</span>\n                  <p class=\"no-assignment-hint\">Choose from contacts</p>\n                  <button class=\"btn-assign-now\" id=\"decision-show-owner-picker-btn\" type=\"button\">Choose</button>\n                </div>\n              `}\n            </div>\n\n            <div id=\"decision-contact-picker\" class=\"contact-picker-sota hidden\">\n              <div class=\"picker-search\">\n                <svg width=\"16\" height=\"16\" fill=\"none\" viewBox=\"0 0 24 24\" stroke=\"currentColor\"><path stroke-linecap=\"round\" stroke-linejoin=\"round\" stroke-width=\"2\" d=\"M21 21l-6-6m2-5a7 7 0 11-14 0 7 7 0 0114 0z\"/></svg>\n                <input type=\"text\" id=\"decision-contact-search\" placeholder=\"Search contacts...\" autocomplete=\"off\">\n              </div>\n              <div id=\"decision-contact-list\" class=\"contact-list-grid\">Loading...</div>\n            </div>\n\n            <div id=\"decision-owner-suggestions-panel\" class=\"suggestions-panel-sota decision-owner-suggestions-panel hidden gm-mt-2\"></div>\n\n            ${decision.approved_by ? `<p class=\"text-muted gm-mt-2\">Approved by: ${escapeHtml(decision.approved_by)}</p>` : ''}\n            ${decision.decided_at ? `<p class=\"text-muted\">Decided: ${formatDate(decision.decided_at)}</p>` : ''}\n          </section>\n\n          <section class=\"detail-section\">\n            <div class=\"section-header\">\n              <h3>Source</h3>\n            </div>\n            ${decision.source_file ? `<p class=\"source-file\">${escapeHtml(decision.source_file)}</p>` : ''}\n            ${decision.source_document_id ? `\n              <p class=\"source-doc\">\n                <a href=\"#\" class=\"doc-link\" data-document-id=\"${escapeHtml(String(decision.source_document_id))}\">View source document</a>\n              </p>\n            ` : ''}\n            ${!decision.source_file && !decision.source_document_id ? '<p class=\"text-muted\">No source recorded</p>' : ''}\n          </section>\n        </div>\n\n        <div class=\"detail-column-right\">\n          <section class=\"detail-section metadata-section\">\n            <div class=\"section-header\">\n              <h3>Metadata</h3>\n            </div>\n            <dl class=\"metadata-list\">\n              <dt>Created</dt>\n              <dd>${formatDate(decision.created_at)}</dd>\n              ${decision.updated_at ? `<dt>Updated</dt><dd>${formatDate(decision.updated_at)}</dd>` : ''}\n            </dl>\n          </section>\n\n          <section class=\"detail-section\" id=\"decision-implementing-tasks-section\">\n            <div class=\"section-header\">\n              <h3>Implementing tasks</h3>\n            </div>\n            <div id=\"decision-implementing-tasks-list\" class=\"decision-implementing-tasks-list\">\n              <span class=\"text-muted\">Loading</span>\n            </div>\n          </section>\n\n          <section class=\"detail-section decision-timeline-section\">\n            <div class=\"section-header\">\n              <h3>Timeline</h3>\n            </div>\n            <div id=\"decision-timeline-list\" class=\"decision-timeline-list\">\n              <span class=\"text-muted\">Loading</span>\n            </div>\n          </section>\n\n          <section class=\"detail-section decision-similar-section\">\n            <div class=\"section-header\">\n              <h3>Similar decisions</h3>\n            </div>\n            <div id=\"decision-similar-list\" class=\"decision-similar-list\">\n              <span class=\"text-muted\">Loading</span>\n            </div>\n          </section>\n        </div>\n      </div>\n\n      <div class=\"detail-actions\">\n        <button type=\"button\" class=\"btn btn-secondary\" id=\"edit-decision-btn\">Edit</button>\n        <button type=\"button\" class=\"btn btn-danger\" id=\"delete-decision-btn\">Delete</button>\n      </div>\n      </div>\n\n      <div id=\"decision-edit-form\" class=\"decision-detail-edit-form hidden\">\n        <form id=\"decision-inline-form\" class=\"decision-form\">\n          <div class=\"form-group\">\n            <label for=\"decision-edit-content\">Decision *</label>\n            <textarea id=\"decision-edit-content\" rows=\"3\" required placeholder=\"What was decided?\">${escapeHtml(decision.content || '')}</textarea>\n          </div>\n          <div class=\"form-group\">\n            <div class=\"gm-flex gm-flex-center gm-justify-between gm-flex-wrap gm-gap-2 gm-mb-2\">\n              <label for=\"decision-edit-rationale\" class=\"gm-mb-0\">Rationale</label>\n              <button type=\"button\" class=\"btn-ai-suggest btn-sm\" id=\"decision-edit-ai-suggest-btn\" title=\"Suggest rationale, impact and summary from decision text\">\n                <svg width=\"14\" height=\"14\" fill=\"none\" viewBox=\"0 0 24 24\" stroke=\"currentColor\"><path stroke-linecap=\"round\" stroke-linejoin=\"round\" stroke-width=\"2\" d=\"M13 10V3L4 14h7v7l9-11h-7z\"/></svg>\n                AI suggest\n              </button>\n            </div>\n            <textarea id=\"decision-edit-rationale\" rows=\"2\" placeholder=\"Why was this decision made?\">${escapeHtml(decision.rationale || decision.context || '')}</textarea>\n          </div>\n          <div id=\"decision-edit-suggestions-panel\" class=\"suggestions-panel-sota hidden gm-mb-3\"></div>\n          <div class=\"form-row\">\n            <div class=\"form-group\">\n              <label for=\"decision-edit-impact\">Impact</label>\n              <select id=\"decision-edit-impact\">\n                <option value=\"low\" ${decision.impact === 'low' ? 'selected' : ''}>Low</option>\n                <option value=\"medium\" ${decision.impact === 'medium' || !decision.impact ? 'selected' : ''}>Medium</option>\n                <option value=\"high\" ${decision.impact === 'high' ? 'selected' : ''}>High</option>\n              </select>\n            </div>\n            <div class=\"form-group\">\n              <label for=\"decision-edit-summary\">Summary (one line)</label>\n              <input type=\"text\" id=\"decision-edit-summary\" value=\"${escapeHtml((decision as { summary?: string }).summary || '')}\" placeholder=\"One-line summary for lists/reports\">\n            </div>\n            <div class=\"form-group\">\n              <label for=\"decision-edit-status\">Status</label>\n              <select id=\"decision-edit-status\">\n                <option value=\"proposed\" ${decision.status === 'proposed' || !decision.status ? 'selected' : ''}>Proposed</option>\n                <option value=\"approved\" ${decision.status === 'approved' ? 'selected' : ''}>Approved</option>\n                <option value=\"rejected\" ${decision.status === 'rejected' ? 'selected' : ''}>Rejected</option>\n                <option value=\"deferred\" ${decision.status === 'deferred' ? 'selected' : ''}>Deferred</option>\n                <option value=\"active\" ${decision.status === 'active' ? 'selected' : ''}>Active</option>\n                <option value=\"superseded\" ${decision.status === 'superseded' ? 'selected' : ''}>Superseded</option>\n                <option value=\"revoked\" ${decision.status === 'revoked' ? 'selected' : ''}>Revoked</option>\n              </select>\n            </div>\n          </div>\n          <div class=\"form-group\">\n            <label>Made by</label>\n            <input type=\"hidden\" id=\"decision-edit-made-by\" value=\"${escapeHtml(decision.made_by || (decision as { owner?: string }).owner || '')}\">\n            <div id=\"decision-edit-owner-display\" class=\"current-assignment-card decision-edit-owner-card\"></div>\n            <div id=\"decision-edit-contact-picker\" class=\"contact-picker-sota hidden gm-mt-2\">\n              <div class=\"picker-search\">\n                <svg width=\"16\" height=\"16\" fill=\"none\" viewBox=\"0 0 24 24\" stroke=\"currentColor\"><path stroke-linecap=\"round\" stroke-linejoin=\"round\" stroke-width=\"2\" d=\"M21 21l-6-6m2-5a7 7 0 11-14 0 7 7 0 0114 0z\"/></svg>\n                <input type=\"text\" id=\"decision-edit-contact-search\" placeholder=\"Search contacts...\" autocomplete=\"off\">\n              </div>\n              <div id=\"decision-edit-contact-list\" class=\"contact-list-grid\">Loading...</div>\n            </div>\n          </div>\n        </form>\n        <div class=\"detail-actions\">\n          <button type=\"button\" class=\"btn btn-primary\" id=\"decision-save-btn\">Save</button>\n          <button type=\"button\" class=\"btn btn-secondary\" id=\"decision-cancel-edit-btn\">Cancel</button>\n          <button type=\"button\" class=\"btn btn-danger\" id=\"decision-delete-in-edit-btn\">Delete</button>\n        </div>\n      </div>\n    </div>\n  `;\n\n  const backLink = container.querySelector('#back-to-list');\n  if (backLink) {\n    on(backLink as HTMLElement, 'click', (e) => {\n      e.preventDefault();\n      onClose();\n    });\n  }\n  const closeBtn = container.querySelector('#close-detail');\n  if (closeBtn) {\n    on(closeBtn as HTMLElement, 'click', onClose);\n  }\n\n  const viewContent = container.querySelector('#decision-view-content') as HTMLElement;\n  const editForm = container.querySelector('#decision-edit-form') as HTMLElement;\n\n  const editBtn = container.querySelector('#edit-decision-btn');\n  if (editBtn && viewContent && editForm) {\n    on(editBtn as HTMLElement, 'click', () => {\n      viewContent.classList.add('hidden');\n      editForm.classList.remove('hidden');\n      // Sync edit form owner (in case owner was changed in view)\n      renderEditFormOwnerDisplay(currentOwnerName);\n    });\n  }\n\n  const cancelEditBtn = container.querySelector('#decision-cancel-edit-btn');\n  if (cancelEditBtn && viewContent && editForm) {\n    on(cancelEditBtn as HTMLElement, 'click', () => {\n      editForm.classList.add('hidden');\n      viewContent.classList.remove('hidden');\n    });\n  }\n\n  const saveBtn = container.querySelector('#decision-save-btn');\n  if (saveBtn && editForm && onUpdate) {\n    on(saveBtn as HTMLElement, 'click', async () => {\n      const form = container.querySelector('#decision-inline-form') as HTMLFormElement;\n      if (!form?.checkValidity()) {\n        form.reportValidity();\n        return;\n      }\n      const contentEl = container.querySelector('#decision-edit-content') as HTMLTextAreaElement;\n      const rationaleEl = container.querySelector('#decision-edit-rationale') as HTMLTextAreaElement;\n      const impactEl = container.querySelector('#decision-edit-impact') as HTMLSelectElement;\n      const summaryEl = container.querySelector('#decision-edit-summary') as HTMLInputElement;\n      const statusEl = container.querySelector('#decision-edit-status') as HTMLSelectElement;\n      const madeByEl = container.querySelector('#decision-edit-made-by') as HTMLInputElement;\n      const content = contentEl?.value?.trim() || '';\n      if (!content) {\n        toast.error('Decision text is required');\n        return;\n      }\n      (saveBtn as HTMLButtonElement).disabled = true;\n      (saveBtn as HTMLButtonElement).textContent = 'Saving...';\n      try {\n        const updated = await decisionsService.update(decision.id, {\n          content,\n          rationale: rationaleEl?.value?.trim() || undefined,\n          impact: (impactEl?.value || undefined) as Decision['impact'],\n          summary: (summaryEl?.value?.trim() || undefined) as string | undefined,\n          status: (statusEl?.value || 'active') as Decision['status'],\n          made_by: madeByEl?.value?.trim() || undefined,\n        });\n        toast.success('Decision updated');\n        // Update view DOM from response\n        const viewContentText = container.querySelector('#decision-view-content-text');\n        if (viewContentText) viewContentText.textContent = updated.content || content;\n        const viewRationale = container.querySelector('#decision-view-rationale');\n        if (viewRationale) {\n          viewRationale.innerHTML = (updated.rationale || updated.context)\n            ? `<p class=\"decision-rationale\">${escapeHtml(updated.rationale || updated.context || '')}</p>`\n            : '<p class=\"text-muted\">No rationale recorded</p>';\n        }\n        const statusBadge = container.querySelector('.decision-detail-header .status-badge');\n        if (statusBadge) {\n          statusBadge.textContent = String(updated.status || 'active');\n          statusBadge.className = `status-badge status-${(updated.status || 'active').toLowerCase()}`;\n        }\n        const badges = container.querySelector('.decision-badges');\n        if (badges) {\n          const impactPill = (updated as Decision).impact\n            ? `<span class=\"priority-pill impact-${(updated as Decision).impact}\">${escapeHtml((updated as Decision).impact || '')} impact</span>`\n            : '';\n          const existing = badges.innerHTML;\n          if (impactPill && !existing.includes('impact-')) {\n            badges.insertAdjacentHTML('afterbegin', impactPill + ' ');\n          } else if (impactPill) {\n            const oldPill = badges.querySelector('.priority-pill.impact-');\n            if (oldPill) oldPill.outerHTML = impactPill;\n          }\n        }\n        currentOwnerName = updated.made_by || (updated as { owner?: string }).owner || '';\n        // Refresh owner display in view\n        const currentOwnerEl = container.querySelector('#decision-current-owner');\n        if (currentOwnerEl && currentOwnerName) {\n          const contact = findContactByOwner(currentOwnerName);\n          const photoUrl = getContactPhotoUrl(contact);\n          currentOwnerEl.innerHTML = `\n            <div class=\"assigned-contact-display\">\n              <div class=\"contact-avatar-lg\" id=\"decision-owner-avatar\">${photoUrl ? `<img src=\"${escapeHtml(photoUrl)}\" alt=\"\" onerror=\"this.parentElement.innerHTML='${getInitials(currentOwnerName)}'\">` : getInitials(currentOwnerName)}</div>\n              <div class=\"contact-details\">\n                <div class=\"contact-name-lg\">${escapeHtml(currentOwnerName)}</div>\n                <div class=\"contact-role-sm\" id=\"decision-owner-role\">${escapeHtml(contact?.role ?? '')}</div>\n              </div>\n              <button class=\"btn-change-assignment\" id=\"decision-change-owner-btn\" type=\"button\">\n                <svg width=\"14\" height=\"14\" fill=\"none\" viewBox=\"0 0 24 24\" stroke=\"currentColor\"><path stroke-linecap=\"round\" stroke-linejoin=\"round\" stroke-width=\"2\" d=\"M15.232 5.232l3.536 3.536m-2.036-5.036a2.5 2.5 0 113.536 3.536L6.5 21.036H3v-3.572L16.732 3.732z\"/></svg>\n                Change\n              </button>\n            </div>`;\n          const chBtn = currentOwnerEl.querySelector('#decision-change-owner-btn');\n          if (chBtn) on(chBtn as HTMLElement, 'click', showOwnerPicker);\n        } else if (currentOwnerEl && !currentOwnerName) {\n          currentOwnerEl.innerHTML = `\n            <div class=\"no-assignment\">\n              <div class=\"no-assignment-icon\">\n                <svg width=\"32\" height=\"32\" fill=\"none\" viewBox=\"0 0 24 24\" stroke=\"currentColor\"><path stroke-linecap=\"round\" stroke-linejoin=\"round\" stroke-width=\"1.5\" d=\"M18 9v3m0 0v3m0-3h3m-3 0h-3m-2-5a4 4 0 11-8 0 4 4 0 018 0zM3 20a6 6 0 0112 0v1H3v-1z\"/></svg>\n              </div>\n              <span>No owner</span>\n              <p class=\"no-assignment-hint\">Choose from contacts</p>\n              <button class=\"btn-assign-now\" id=\"decision-show-owner-picker-btn\" type=\"button\">Choose</button>\n            </div>`;\n          const showBtn = currentOwnerEl.querySelector('#decision-show-owner-picker-btn');\n          if (showBtn) on(showBtn as HTMLElement, 'click', showOwnerPicker);\n        }\n        onUpdate(updated);\n        editForm.classList.add('hidden');\n        viewContent.classList.remove('hidden');\n      } catch {\n        toast.error('Failed to save decision');\n      } finally {\n        (saveBtn as HTMLButtonElement).disabled = false;\n        (saveBtn as HTMLButtonElement).textContent = 'Save';\n      }\n    });\n  }\n\n  const deleteInEditBtn = container.querySelector('#decision-delete-in-edit-btn');\n  if (deleteInEditBtn) {\n    on(deleteInEditBtn as HTMLElement, 'click', async () => {\n      if (!confirm('Are you sure you want to delete this decision?')) return;\n      try {\n        await decisionsService.delete(decision.id);\n        toast.success('Decision deleted');\n        onClose();\n      } catch {\n        toast.error('Failed to delete decision');\n      }\n    });\n  }\n\n  const deleteBtn = container.querySelector('#delete-decision-btn');\n  if (deleteBtn) {\n    on(deleteBtn as HTMLElement, 'click', async () => {\n      if (!confirm('Are you sure you want to delete this decision?')) return;\n      try {\n        await decisionsService.delete(decision.id);\n        toast.success('Decision deleted');\n        onClose();\n      } catch {\n        toast.error('Failed to delete decision');\n      }\n    });\n  }\n\n  const docLink = container.querySelector('.doc-link');\n  if (docLink && decision.source_document_id) {\n    on(docLink as HTMLElement, 'click', (e) => {\n      e.preventDefault();\n      window.dispatchEvent(new CustomEvent('godmode:navigate', {\n        detail: { tab: 'files', documentId: decision.source_document_id }\n      }));\n    });\n  }\n\n  // Owner section: load contacts, show avatar/role, contact picker\n  let viewContacts: Contact[] = [];\n  let currentOwnerName = decision.made_by || (decision as { owner?: string }).owner || '';\n  const ownerPicker = container.querySelector('#decision-contact-picker') as HTMLElement;\n  const ownerList = container.querySelector('#decision-contact-list') as HTMLElement;\n  const ownerSearch = container.querySelector('#decision-contact-search') as HTMLInputElement;\n\n  function getContactPhotoUrl(c: Contact | undefined): string | null {\n    if (!c) return null;\n    const u = c as { photoUrl?: string; avatarUrl?: string; photo_url?: string; avatar_url?: string };\n    return u.photoUrl || u.avatarUrl || u.photo_url || u.avatar_url || null;\n  }\n\n  function findContactByOwner(name: string): Contact | undefined {\n    if (!name || !viewContacts.length) return undefined;\n    const n = name.trim().toLowerCase();\n    if (!n) return undefined;\n    const byExact = viewContacts.find((c) => (c.name || '').trim().toLowerCase() === n);\n    if (byExact) return byExact;\n    const byPartial = viewContacts.find(\n      (c) =>\n        (c.name || '').trim().toLowerCase().includes(n) ||\n        n.includes((c.name || '').trim().toLowerCase())\n    );\n    if (byPartial) return byPartial;\n    const byAlias = viewContacts.find((c) =>\n      (c.aliases || []).some((a) => String(a).trim().toLowerCase() === n)\n    );\n    return byAlias || viewContacts.find((c) =>\n      (c.aliases || []).some((a) => {\n        const aLower = String(a).trim().toLowerCase();\n        return aLower.includes(n) || n.includes(aLower);\n      })\n    );\n  }\n\n  const renderOwnerContactGrid = (filter = '') => {\n    if (!ownerList) return;\n    const list = filter\n      ? viewContacts.filter(\n        (c) =>\n          (c.name || '').toLowerCase().includes(filter.toLowerCase()) ||\n          (c.role || '').toLowerCase().includes(filter.toLowerCase()) ||\n          ((c as { organization?: string }).organization || '').toLowerCase().includes(filter.toLowerCase())\n      )\n      : viewContacts;\n    if (viewContacts.length === 0) {\n      ownerList.innerHTML = '<div class=\"empty-state\">Loading contacts...</div>';\n      return;\n    }\n    if (list.length === 0) {\n      ownerList.innerHTML = '<div class=\"empty-state\">No contacts match</div>';\n      return;\n    }\n    ownerList.innerHTML = list\n      .map((c) => {\n        const photoUrl = getContactPhotoUrl(c);\n        const isCurrent = (currentOwnerName || '').trim() === (c.name || '').trim();\n        return `\n          <div class=\"contact-card-picker ${isCurrent ? 'selected' : ''}\" data-contact-name=\"${escapeHtml(c.name || '')}\">\n            <div class=\"contact-avatar-picker\">${photoUrl ? `<img src=\"${escapeHtml(photoUrl)}\" alt=\"\" onerror=\"this.parentElement.innerHTML='${getInitials(c.name || '')}'\">` : getInitials(c.name || '')}</div>\n            <div class=\"contact-info-picker\">\n              <div class=\"contact-name-picker\">${escapeHtml(c.name || '')}</div>\n              ${c.role ? `<div class=\"contact-role-picker\">${escapeHtml(c.role)}</div>` : ''}\n            </div>\n          </div>`;\n      })\n      .join('');\n    ownerList.querySelectorAll('.contact-card-picker').forEach((card) => {\n      on(card as HTMLElement, 'click', async () => {\n        const name = card.getAttribute('data-contact-name') || '';\n        if (!name) return;\n        try {\n          const updated = await decisionsService.update(decision.id, { made_by: name });\n          currentOwnerName = name;\n          toast.success(`Owner set to ${name}`);\n          if (ownerPicker) ownerPicker.classList.add('hidden');\n          if (onUpdate) onUpdate({ ...decision, made_by: name, ...updated });\n          // Refresh displayed owner in current-assignment card\n          const currentEl = container.querySelector('#decision-current-owner');\n          if (currentEl) {\n            const contact = findContactByOwner(name);\n            const photoUrl = getContactPhotoUrl(contact);\n            currentEl.innerHTML = `\n              <div class=\"assigned-contact-display\">\n                <div class=\"contact-avatar-lg\" id=\"decision-owner-avatar\">${photoUrl ? `<img src=\"${escapeHtml(photoUrl)}\" alt=\"\" onerror=\"this.parentElement.innerHTML='${getInitials(name)}'\">` : getInitials(name)}</div>\n                <div class=\"contact-details\">\n                  <div class=\"contact-name-lg\">${escapeHtml(name)}</div>\n                  <div class=\"contact-role-sm\" id=\"decision-owner-role\">${escapeHtml(contact?.role ?? '')}</div>\n                </div>\n                <button class=\"btn-change-assignment\" id=\"decision-change-owner-btn\" type=\"button\">\n                  <svg width=\"14\" height=\"14\" fill=\"none\" viewBox=\"0 0 24 24\" stroke=\"currentColor\"><path stroke-linecap=\"round\" stroke-linejoin=\"round\" stroke-width=\"2\" d=\"M15.232 5.232l3.536 3.536m-2.036-5.036a2.5 2.5 0 113.536 3.536L6.5 21.036H3v-3.572L16.732 3.732z\"/></svg>\n                  Change\n                </button>\n              </div>`;\n            const changeBtn = currentEl.querySelector('#decision-change-owner-btn');\n            if (changeBtn) on(changeBtn as HTMLElement, 'click', showOwnerPicker);\n          }\n        } catch {\n          toast.error('Failed to save owner');\n        }\n      });\n    });\n  };\n\n  const showOwnerPicker = () => {\n    if (!ownerPicker) return;\n    ownerPicker.classList.toggle('hidden');\n    if (!ownerPicker.classList.contains('hidden') && viewContacts.length === 0) {\n      contactsService.getAll().then((res) => {\n        viewContacts = res?.contacts || [];\n        renderOwnerContactGrid(ownerSearch?.value || '');\n      }).catch(() => {\n        if (ownerList) ownerList.innerHTML = '<div class=\"empty-state\">Failed to load contacts</div>';\n      });\n    } else if (!ownerPicker.classList.contains('hidden')) {\n      renderOwnerContactGrid(ownerSearch?.value || '');\n    }\n    if (ownerSearch) ownerSearch.focus();\n  };\n\n  const changeOwnerBtn = container.querySelector('#decision-change-owner-btn');\n  const showOwnerPickerBtn = container.querySelector('#decision-show-owner-picker-btn');\n  if (changeOwnerBtn && ownerPicker) on(changeOwnerBtn as HTMLElement, 'click', showOwnerPicker);\n  if (showOwnerPickerBtn && ownerPicker) on(showOwnerPickerBtn as HTMLElement, 'click', showOwnerPicker);\n  if (ownerSearch) {\n    ownerSearch.addEventListener('input', () => renderOwnerContactGrid(ownerSearch.value));\n  }\n\n  contactsService.getAll().then((res) => {\n    viewContacts = res?.contacts || [];\n    const contact = findContactByOwner(currentOwnerName);\n    const roleEl = container.querySelector('#decision-owner-role');\n    if (roleEl) roleEl.textContent = contact?.role ?? '';\n    const avatarEl = container.querySelector('#decision-owner-avatar');\n    if (avatarEl && currentOwnerName) {\n      const photoUrl = getContactPhotoUrl(contact);\n      if (photoUrl) {\n        avatarEl.innerHTML = '';\n        const img = document.createElement('img');\n        img.src = photoUrl;\n        img.alt = '';\n        img.onerror = () => { avatarEl.textContent = getInitials(currentOwnerName); };\n        avatarEl.appendChild(img);\n      }\n    }\n  }).catch(() => { });\n\n  // Edit form: owner display and contact picker (reuse viewContacts)\n  const editOwnerDisplay = container.querySelector('#decision-edit-owner-display') as HTMLElement;\n  const editMadeByInput = container.querySelector('#decision-edit-made-by') as HTMLInputElement;\n  const editContactPicker = container.querySelector('#decision-edit-contact-picker') as HTMLElement;\n  const editContactList = container.querySelector('#decision-edit-contact-list') as HTMLElement;\n  const editContactSearch = container.querySelector('#decision-edit-contact-search') as HTMLInputElement;\n\n  function renderEditFormOwnerDisplay(madeBy: string) {\n    if (!editOwnerDisplay || !editMadeByInput) return;\n    editMadeByInput.value = madeBy;\n    if (madeBy) {\n      const contact = findContactByOwner(madeBy);\n      const photoUrl = getContactPhotoUrl(contact);\n      editOwnerDisplay.innerHTML = `\n        <div class=\"assigned-contact-display\">\n          <div class=\"contact-avatar-lg\">${photoUrl ? `<img src=\"${escapeHtml(photoUrl)}\" alt=\"\" onerror=\"this.parentElement.innerHTML='${getInitials(madeBy)}'\">` : getInitials(madeBy)}</div>\n          <div class=\"contact-details\">\n            <div class=\"contact-name-lg\">${escapeHtml(madeBy)}</div>\n            ${contact?.role ? `<div class=\"contact-role-sm\">${escapeHtml(contact.role)}</div>` : ''}\n          </div>\n          <button type=\"button\" class=\"btn-change-assignment\" id=\"decision-edit-change-owner-btn\">\n            <svg width=\"14\" height=\"14\" fill=\"none\" viewBox=\"0 0 24 24\" stroke=\"currentColor\"><path stroke-linecap=\"round\" stroke-linejoin=\"round\" stroke-width=\"2\" d=\"M15.232 5.232l3.536 3.536m-2.036-5.036a2.5 2.5 0 113.536 3.536L6.5 21.036H3v-3.572L16.732 3.732z\"/></svg>\n            Change\n          </button>\n        </div>`;\n    } else {\n      editOwnerDisplay.innerHTML = `\n        <div class=\"no-assignment\">\n          <span>No owner</span>\n          <button type=\"button\" class=\"btn-assign-now\" id=\"decision-edit-choose-owner-btn\">Choose</button>\n        </div>`;\n    }\n    const chBtn = editOwnerDisplay.querySelector('#decision-edit-change-owner-btn');\n    const chooseBtn = editOwnerDisplay.querySelector('#decision-edit-choose-owner-btn');\n    if (chBtn) on(chBtn as HTMLElement, 'click', showEditOwnerPicker);\n    if (chooseBtn) on(chooseBtn as HTMLElement, 'click', showEditOwnerPicker);\n  }\n\n  function renderEditFormContactGrid(filter = '') {\n    if (!editContactList) return;\n    const list = filter\n      ? viewContacts.filter(\n        (c) =>\n          (c.name || '').toLowerCase().includes(filter.toLowerCase()) ||\n          (c.role || '').toLowerCase().includes(filter.toLowerCase())\n      )\n      : viewContacts;\n    if (viewContacts.length === 0) {\n      editContactList.innerHTML = '<div class=\"empty-state\">Loading contacts...</div>';\n      return;\n    }\n    if (list.length === 0) {\n      editContactList.innerHTML = '<div class=\"empty-state\">No contacts match</div>';\n      return;\n    }\n    const currentMadeBy = (editMadeByInput?.value || '').trim();\n    editContactList.innerHTML = list\n      .map((c) => {\n        const photoUrl = getContactPhotoUrl(c);\n        const isCurrent = currentMadeBy === (c.name || '').trim();\n        return `\n          <div class=\"contact-card-picker ${isCurrent ? 'selected' : ''}\" data-contact-name=\"${escapeHtml(c.name || '')}\">\n            <div class=\"contact-avatar-picker\">${photoUrl ? `<img src=\"${escapeHtml(photoUrl)}\" alt=\"\" onerror=\"this.parentElement.innerHTML='${getInitials(c.name || '')}'\">` : getInitials(c.name || '')}</div>\n            <div class=\"contact-info-picker\">\n              <div class=\"contact-name-picker\">${escapeHtml(c.name || '')}</div>\n              ${c.role ? `<div class=\"contact-role-picker\">${escapeHtml(c.role)}</div>` : ''}\n            </div>\n          </div>`;\n      })\n      .join('');\n    editContactList.querySelectorAll('.contact-card-picker').forEach((card) => {\n      on(card as HTMLElement, 'click', () => {\n        const name = card.getAttribute('data-contact-name') || '';\n        if (name) {\n          renderEditFormOwnerDisplay(name);\n          if (editContactPicker) editContactPicker.classList.add('hidden');\n        }\n      });\n    });\n  }\n\n  function showEditOwnerPicker() {\n    if (!editContactPicker) return;\n    editContactPicker.classList.toggle('hidden');\n    if (!editContactPicker.classList.contains('hidden')) {\n      if (viewContacts.length === 0) {\n        contactsService.getAll().then((res) => {\n          viewContacts = res?.contacts || [];\n          renderEditFormContactGrid(editContactSearch?.value || '');\n        }).catch(() => {\n          if (editContactList) editContactList.innerHTML = '<div class=\"empty-state\">Failed to load contacts</div>';\n        });\n      } else {\n        renderEditFormContactGrid(editContactSearch?.value || '');\n      }\n    }\n    if (editContactSearch) editContactSearch.focus();\n  }\n\n  if (editContactSearch) {\n    editContactSearch.addEventListener('input', () => renderEditFormContactGrid(editContactSearch.value));\n  }\n\n  // Initial edit form owner display (when user opens edit, we call renderEditFormOwnerDisplay in edit button handler)\n  renderEditFormOwnerDisplay(decision.made_by || (decision as { owner?: string }).owner || '');\n\n  // AI Suggest (view mode): Owner section  suggest owner from decision content (project contacts only)\n  const ownerAiSuggestBtn = container.querySelector('#decision-owner-ai-suggest-btn');\n  const ownerSuggestionsPanel = container.querySelector('#decision-owner-suggestions-panel') as HTMLElement;\n  if (ownerAiSuggestBtn && ownerSuggestionsPanel) {\n    on(ownerAiSuggestBtn as HTMLElement, 'click', async () => {\n      (ownerAiSuggestBtn as HTMLButtonElement).disabled = true;\n      ownerSuggestionsPanel.classList.remove('hidden');\n      ownerSuggestionsPanel.innerHTML = '<div class=\"loading\">Asking AI</div>';\n      try {\n        if (viewContacts.length === 0) {\n          const res = await contactsService.getAll();\n          viewContacts = res?.contacts || [];\n        }\n        const { suggested_owners } = await decisionsService.suggestOwner(decision.content || '', decision.rationale || decision.context || '');\n        if (!suggested_owners?.length) {\n          ownerSuggestionsPanel.innerHTML = '<div class=\"no-suggestions\">No owner suggestions. <button type=\"button\" class=\"btn-link\" id=\"decision-owner-hide-suggest-btn\">Close</button></div>';\n        } else {\n          ownerSuggestionsPanel.innerHTML = `\n            <div class=\"suggestions-header-sota\">\n              <div class=\"ai-badge\">\n                <svg width=\"14\" height=\"14\" fill=\"none\" viewBox=\"0 0 24 24\" stroke=\"currentColor\"><path stroke-linecap=\"round\" stroke-linejoin=\"round\" stroke-width=\"2\" d=\"M13 10V3L4 14h7v7l9-11h-7z\"/></svg>\n                AI Recommended\n              </div>\n            </div>\n            <div class=\"suggestions-list-sota\">\n              ${suggested_owners.map((s, i) => {\n            const contact = findContactByOwner(s.name);\n            const photoUrl = getContactPhotoUrl(contact);\n            const roleOrReason = contact?.role ?? s.reason ?? '';\n            const score = s.score ?? 0;\n            const scoreColor = score >= 70 ? 'var(--success)' : score >= 50 ? 'var(--warning)' : 'var(--text-muted)';\n            return `\n                <div class=\"suggestion-card-sota decision-owner-card\" data-owner-name=\"${escapeHtml(s.name)}\">\n                  <div class=\"suggestion-rank\">#${i + 1}</div>\n                  <div class=\"suggestion-avatar-sota\">${photoUrl ? `<img src=\"${escapeHtml(photoUrl)}\" alt=\"\" onerror=\"this.parentElement.innerHTML='${getInitials(s.name)}'\">` : getInitials(s.name)}</div>\n                  <div class=\"suggestion-info-sota\">\n                    <div class=\"suggestion-name-sota\">${escapeHtml(s.name)}</div>\n                    ${roleOrReason ? `<div class=\"suggestion-reason-sota\">${escapeHtml(roleOrReason)}</div>` : ''}\n                  </div>\n                  ${score > 0 ? `<div class=\"suggestion-score-sota\" style=\"--score-color: ${scoreColor}\"><div class=\"score-value\">${score}%</div><div class=\"score-label\">Match</div></div>` : ''}\n                  <button type=\"button\" class=\"btn-select-suggestion\">Assign</button>\n                </div>`;\n          }).join('')}\n            </div>\n            <div class=\"suggestions-footer\"><button type=\"button\" class=\"btn-link\" id=\"decision-owner-hide-suggest-btn\">Close</button></div>\n          `;\n          ownerSuggestionsPanel.querySelectorAll('.decision-owner-card .btn-select-suggestion').forEach((btn) => {\n            const card = (btn as HTMLElement).closest('.decision-owner-card');\n            const name = card?.getAttribute('data-owner-name') || '';\n            if (!name) return;\n            on(btn as HTMLElement, 'click', async () => {\n              try {\n                const updated = await decisionsService.update(decision.id, { made_by: name });\n                currentOwnerName = name;\n                toast.success(`Owner set to ${name}`);\n                ownerSuggestionsPanel.classList.add('hidden');\n                const currentOwnerEl = container.querySelector('#decision-current-owner');\n                if (currentOwnerEl) {\n                  const contact = findContactByOwner(name);\n                  const photoUrl = getContactPhotoUrl(contact);\n                  currentOwnerEl.innerHTML = `\n                    <div class=\"assigned-contact-display\">\n                      <div class=\"contact-avatar-lg\" id=\"decision-owner-avatar\">${photoUrl ? `<img src=\"${escapeHtml(photoUrl)}\" alt=\"\" onerror=\"this.parentElement.innerHTML='${getInitials(name)}'\">` : getInitials(name)}</div>\n                      <div class=\"contact-details\">\n                        <div class=\"contact-name-lg\">${escapeHtml(name)}</div>\n                        <div class=\"contact-role-sm\" id=\"decision-owner-role\">${escapeHtml(contact?.role ?? '')}</div>\n                      </div>\n                      <button class=\"btn-change-assignment\" id=\"decision-change-owner-btn\" type=\"button\">\n                        <svg width=\"14\" height=\"14\" fill=\"none\" viewBox=\"0 0 24 24\" stroke=\"currentColor\"><path stroke-linecap=\"round\" stroke-linejoin=\"round\" stroke-width=\"2\" d=\"M15.232 5.232l3.536 3.536m-2.036-5.036a2.5 2.5 0 113.536 3.536L6.5 21.036H3v-3.572L16.732 3.732z\"/></svg>\n                        Change\n                      </button>\n                    </div>`;\n                  const chBtn = currentOwnerEl.querySelector('#decision-change-owner-btn');\n                  if (chBtn) on(chBtn as HTMLElement, 'click', showOwnerPicker);\n                }\n                if (onUpdate) onUpdate(updated);\n              } catch {\n                toast.error('Failed to save owner');\n              }\n            });\n          });\n        }\n        const hideBtn = ownerSuggestionsPanel.querySelector('#decision-owner-hide-suggest-btn');\n        if (hideBtn) on(hideBtn as HTMLElement, 'click', () => { ownerSuggestionsPanel.classList.add('hidden'); });\n      } catch {\n        ownerSuggestionsPanel.innerHTML = '<div class=\"error\">AI suggest failed. <button type=\"button\" class=\"btn-link\" id=\"decision-owner-hide-suggest-btn\">Close</button></div>';\n        const h = ownerSuggestionsPanel.querySelector('#decision-owner-hide-suggest-btn');\n        if (h) on(h as HTMLElement, 'click', () => { ownerSuggestionsPanel.classList.add('hidden'); });\n        toast.error('AI suggest failed');\n      } finally {\n        (ownerAiSuggestBtn as HTMLButtonElement).disabled = false;\n      }\n    });\n  }\n\n  // AI Suggest (view mode): Rationale section  fetch suggestion, show panel, Apply updates decision\n  const rationaleAiSuggestBtn = container.querySelector('#decision-rationale-ai-suggest-btn');\n  const suggestionsPanel = container.querySelector('#decision-suggestions-panel') as HTMLElement;\n  if (rationaleAiSuggestBtn && suggestionsPanel) {\n    on(rationaleAiSuggestBtn as HTMLElement, 'click', async () => {\n      (rationaleAiSuggestBtn as HTMLButtonElement).disabled = true;\n      suggestionsPanel.classList.remove('hidden');\n      suggestionsPanel.innerHTML = '<div class=\"loading\">Asking AI</div>';\n      try {\n        const result = await decisionsService.suggest(decision.content || '', decision.rationale || decision.context || '');\n        suggestionsPanel.innerHTML = `\n          <div class=\"suggestion-card\">\n            <p><strong>Rationale:</strong> ${escapeHtml((result.rationale || '').substring(0, 300))}${(result.rationale || '').length > 300 ? '' : ''}</p>\n            <p><strong>Impact:</strong> ${escapeHtml(result.impact || '')} ${result.impact_summary ? ` ${escapeHtml(result.impact_summary)}` : ''}</p>\n            <p><strong>Summary:</strong> ${escapeHtml(result.summary || '')}</p>\n            <button type=\"button\" class=\"btn btn-primary btn-sm\" id=\"decision-apply-suggestion-btn\">Apply</button>\n          </div>`;\n        const applyBtn = suggestionsPanel.querySelector('#decision-apply-suggestion-btn');\n        if (applyBtn) {\n          on(applyBtn as HTMLElement, 'click', async () => {\n            try {\n              const updated = await decisionsService.update(decision.id, {\n                rationale: result.rationale,\n                impact: result.impact,\n                summary: result.summary,\n              });\n              toast.success('Suggestion applied');\n              const viewRationale = container.querySelector('#decision-view-rationale');\n              if (viewRationale) {\n                viewRationale.innerHTML = (updated.rationale || updated.context)\n                  ? `<p class=\"decision-rationale\">${escapeHtml(updated.rationale || updated.context || '')}</p>`\n                  : '<p class=\"text-muted\">No rationale recorded</p>';\n              }\n              const badges = container.querySelector('.decision-badges');\n              if (badges && (updated as Decision).impact) {\n                const impactPill = badges.querySelector('.priority-pill.impact-low, .priority-pill.impact-medium, .priority-pill.impact-high');\n                if (impactPill) impactPill.outerHTML = `<span class=\"priority-pill impact-${(updated as Decision).impact}\">${escapeHtml((updated as Decision).impact || '')} impact</span>`;\n                else badges.insertAdjacentHTML('afterbegin', `<span class=\"priority-pill impact-${(updated as Decision).impact}\">${escapeHtml((updated as Decision).impact || '')} impact</span> `);\n              }\n              if (onUpdate) onUpdate(updated);\n              suggestionsPanel.classList.add('hidden');\n            } catch {\n              toast.error('Failed to apply');\n            }\n          });\n        }\n      } catch {\n        suggestionsPanel.innerHTML = '<div class=\"error\">AI suggest failed</div>';\n        toast.error('AI suggest failed');\n      } finally {\n        (rationaleAiSuggestBtn as HTMLButtonElement).disabled = false;\n      }\n    });\n  }\n\n  // AI Suggest (edit form): fill rationale, impact, summary\n  const editAiSuggestBtn = container.querySelector('#decision-edit-ai-suggest-btn');\n  const editSuggestionsPanel = container.querySelector('#decision-edit-suggestions-panel') as HTMLElement;\n  if (editAiSuggestBtn) {\n    on(editAiSuggestBtn as HTMLElement, 'click', async () => {\n      const contentEl = container.querySelector('#decision-edit-content') as HTMLTextAreaElement;\n      const rationaleEl = container.querySelector('#decision-edit-rationale') as HTMLTextAreaElement;\n      const impactEl = container.querySelector('#decision-edit-impact') as HTMLSelectElement;\n      const summaryEl = container.querySelector('#decision-edit-summary') as HTMLInputElement;\n      const content = contentEl?.value?.trim() || '';\n      if (!content) {\n        toast.warning('Enter decision text first');\n        return;\n      }\n      (editAiSuggestBtn as HTMLButtonElement).disabled = true;\n      if (editSuggestionsPanel) {\n        editSuggestionsPanel.classList.remove('hidden');\n        editSuggestionsPanel.innerHTML = '<span class=\"text-muted\">Asking AI</span>';\n      }\n      try {\n        const result = await decisionsService.suggest(content, rationaleEl?.value?.trim() || '');\n        if (rationaleEl) rationaleEl.value = result.rationale || '';\n        if (impactEl) impactEl.value = result.impact || 'medium';\n        if (summaryEl) summaryEl.value = result.summary || '';\n        if (editSuggestionsPanel) {\n          editSuggestionsPanel.classList.add('hidden');\n          editSuggestionsPanel.innerHTML = '';\n        }\n        toast.success('Suggestion applied');\n      } catch {\n        if (editSuggestionsPanel) {\n          editSuggestionsPanel.innerHTML = '<span class=\"error\">AI suggest failed</span>';\n        }\n        toast.error('AI suggest failed');\n      } finally {\n        (editAiSuggestBtn as HTMLButtonElement).disabled = false;\n      }\n    });\n  }\n\n  const timelineEl = container.querySelector('#decision-timeline-list');\n  if (timelineEl) {\n    decisionsService.getEvents(decision.id).then((events) => {\n      const labels: Record<string, string> = {\n        created: 'Created',\n        updated: 'Updated',\n        conflict_detected: 'Conflict detected',\n        deleted: 'Deleted',\n        restored: 'Restored',\n      };\n      const actorLabel = (ev: { actor_name?: string; event_data?: { trigger?: string } }) =>\n        ev.actor_name || (ev.event_data?.trigger === 'decision_check_flow' ? 'System' : null);\n      if (events.length === 0) {\n        (timelineEl as HTMLElement).innerHTML = '<span class=\"text-muted\">No events yet</span>';\n        return;\n      }\n      (timelineEl as HTMLElement).innerHTML = events\n        .map((ev) => {\n          const actor = actorLabel(ev);\n          return `<div class=\"decision-timeline-item decision-event-${escapeHtml(ev.event_type)}\">\n            <span class=\"decision-event-type\">${escapeHtml(labels[ev.event_type] || ev.event_type)}</span>\n            ${actor ? `<span class=\"decision-event-actor\">${escapeHtml(actor)}</span>` : ''}\n            <span class=\"decision-event-date\">${formatRelativeTime(ev.created_at)}</span>\n          </div>`;\n        })\n        .join('');\n    }).catch(() => {\n      (timelineEl as HTMLElement).innerHTML = '<span class=\"text-muted\">Could not load timeline</span>';\n    });\n  }\n\n  const similarEl = container.querySelector('#decision-similar-list');\n  if (similarEl) {\n    decisionsService.getSimilarDecisions(decision.id, 10).then((similar) => {\n      if (similar.length === 0) {\n        (similarEl as HTMLElement).innerHTML = '<span class=\"text-muted\">No similar decisions</span>';\n        return;\n      }\n      (similarEl as HTMLElement).innerHTML = similar\n        .map((s) => `\n          <div class=\"decision-similar-item\" data-decision-id=\"${s.decision.id}\" role=\"${onDecisionClick ? 'button' : 'none'}\">\n            <span class=\"decision-similar-score\">${Math.round(s.similarityScore * 100)}%</span>\n            <span class=\"decision-similar-content\">${escapeHtml((s.decision.content || '').substring(0, 80))}${(s.decision.content || '').length > 80 ? '' : ''}</span>\n          </div>\n        `)\n        .join('');\n      if (onDecisionClick) {\n        (similarEl as HTMLElement).querySelectorAll('.decision-similar-item').forEach((el) => {\n          on(el as HTMLElement, 'click', () => {\n            const item = similar.find((s) => String(s.decision.id) === (el as HTMLElement).getAttribute('data-decision-id'));\n            if (item) onDecisionClick(item.decision);\n          });\n        });\n      }\n    }).catch(() => {\n      (similarEl as HTMLElement).innerHTML = '<span class=\"text-muted\">Could not load similar decisions</span>';\n    });\n  }\n\n  const implementingTasksEl = container.querySelector('#decision-implementing-tasks-list');\n  if (implementingTasksEl) {\n    actionsService.getAll(undefined, undefined, String(decision.id)).then((actions: Action[]) => {\n      if (actions.length === 0) {\n        (implementingTasksEl as HTMLElement).innerHTML = '<span class=\"text-muted\">No tasks linked to this decision</span>';\n        return;\n      }\n      (implementingTasksEl as HTMLElement).innerHTML = actions\n        .map((a: Action) => {\n          const title = ((a.content || a.task) || '').toString().trim().substring(0, 60) + (((a.content || a.task) || '').toString().length > 60 ? '' : '');\n          const status = (a.status || 'pending').toLowerCase();\n          return `<div class=\"decision-implementing-task-item\" data-action-id=\"${escapeHtml(String(a.id))}\" role=\"${onActionClick ? 'button' : 'none'}\">\n            <span class=\"status-pill status-${status}\">${escapeHtml(String(a.status || 'pending').replace('_', ' '))}</span>\n            <span class=\"decision-implementing-task-title\">${escapeHtml(title)}</span>\n          </div>`;\n        })\n        .join('');\n      if (onActionClick) {\n        (implementingTasksEl as HTMLElement).querySelectorAll('.decision-implementing-task-item').forEach((el) => {\n          on(el as HTMLElement, 'click', () => {\n            const actionId = (el as HTMLElement).getAttribute('data-action-id');\n            const action = actions.find((a) => String(a.id) === actionId);\n            if (action) onActionClick(action);\n          });\n        });\n      }\n    }).catch(() => {\n      (implementingTasksEl as HTMLElement).innerHTML = '<span class=\"text-muted\">Could not load tasks</span>';\n    });\n  }\n\n  return container;\n}\n","/**\r\n * Decisions Panel Component\r\n * Displays and manages decisions with conflict detection, filters, detail view, and removed section\r\n */\r\n\r\nimport { createElement, on } from '@lib/dom';\r\nimport { decisionsService, Decision, DecisionConflict } from '@services/decisions';\r\nimport { dataStore } from '@stores/data';\r\nimport { showDecisionModal } from '../modals/DecisionModal';\r\nimport { createDecisionDetailView, DecisionDetailViewProps } from '../decisions/DecisionDetailView';\r\nimport { toast } from '@services/toast';\r\nimport { formatRelativeTime } from '@lib/format';\r\n\r\n/** Build DecisionDetailView props with onDecisionClick so similar-decision clicks open that decision in the same container */\r\nfunction decisionDetailProps(containerEl: HTMLElement, props: DecisionsPanelProps, decision: Decision): DecisionDetailViewProps {\r\n  return {\r\n    decision,\r\n    onClose: () => {\r\n      containerEl.innerHTML = '';\r\n      containerEl.appendChild(createDecisionsPanel(props));\r\n    },\r\n    onUpdate: () => {\r\n      containerEl.innerHTML = '';\r\n      containerEl.appendChild(createDecisionsPanel(props));\r\n    },\r\n    onDecisionClick: (clickedDecision) => {\r\n      containerEl.innerHTML = '';\r\n      containerEl.appendChild(createDecisionDetailView(decisionDetailProps(containerEl, props, clickedDecision)));\r\n    },\r\n  };\r\n}\r\n\r\nexport interface DecisionsPanelProps {\r\n  onDecisionClick?: (decision: Decision) => void;\r\n  useDetailView?: boolean;\r\n  containerElement?: HTMLElement;\r\n}\r\n\r\nlet currentFilter: string = 'all';\r\nlet currentSearch: string = '';\r\nlet currentView: 'status' | 'source' = 'status';\r\n\r\n/**\r\n * Create decisions panel\r\n */\r\nexport function createDecisionsPanel(props: DecisionsPanelProps = {}): HTMLElement {\r\n  const panel = createElement('div', { className: 'sot-panel decisions-panel' });\r\n\r\n  panel.innerHTML = `\r\n    <div class=\"panel-header\">\r\n      <div class=\"panel-title\">\r\n        <h2>Decisions</h2>\r\n        <span class=\"panel-count\" id=\"decisions-count\">0</span>\r\n      </div>\r\n      <div class=\"panel-actions\">\r\n        <select id=\"decisions-filter\" class=\"filter-select\">\r\n          <option value=\"all\">All</option>\r\n          <option value=\"proposed\">Proposed</option>\r\n          <option value=\"approved\">Approved</option>\r\n          <option value=\"rejected\">Rejected</option>\r\n          <option value=\"deferred\">Deferred</option>\r\n          <option value=\"active\">Active</option>\r\n          <option value=\"superseded\">Superseded</option>\r\n          <option value=\"revoked\">Revoked</option>\r\n        </select>\r\n        <div class=\"view-tabs\">\r\n          <button class=\"view-tab active\" data-view=\"status\">By Status</button>\r\n          <button class=\"view-tab\" data-view=\"source\">By Source</button>\r\n        </div>\r\n        <input type=\"search\" id=\"decisions-search\" class=\"search-input\" placeholder=\"Search decisions...\" title=\"Search\">\r\n        <button class=\"btn btn-secondary btn-sm\" id=\"check-conflicts-btn\" title=\"Check for conflicting decisions\">Check Conflicts</button>\r\n        <button class=\"btn btn-primary btn-sm\" id=\"add-decision-btn\">+ Add</button>\r\n      </div>\r\n    </div>\r\n    <div id=\"conflicts-container\" class=\"conflicts-container hidden\"></div>\r\n    <div class=\"panel-content\" id=\"decisions-content\">\r\n      <div class=\"loading\">Loading decisions...</div>\r\n    </div>\r\n    <div id=\"removed-decisions-container\" class=\"removed-decisions-container hidden\"></div>\r\n  `;\r\n\r\n  const filterSelect = panel.querySelector('#decisions-filter') as HTMLSelectElement;\r\n  on(filterSelect, 'change', () => {\r\n    currentFilter = filterSelect.value;\r\n    loadDecisions(panel, props);\r\n  });\r\n\r\n  const viewTabs = panel.querySelectorAll('.view-tab');\r\n  viewTabs.forEach(tab => {\r\n    on(tab as HTMLElement, 'click', () => {\r\n      viewTabs.forEach(t => t.classList.remove('active'));\r\n      tab.classList.add('active');\r\n      currentView = tab.getAttribute('data-view') as 'status' | 'source';\r\n      loadDecisions(panel, props);\r\n    });\r\n  });\r\n\r\n  const searchInput = panel.querySelector('#decisions-search') as HTMLInputElement;\r\n  let searchTimeout: number;\r\n  on(searchInput, 'input', () => {\r\n    clearTimeout(searchTimeout);\r\n    searchTimeout = window.setTimeout(() => {\r\n      currentSearch = searchInput.value.trim();\r\n      loadDecisions(panel, props);\r\n    }, 300);\r\n  });\r\n\r\n  const checkConflictsBtn = panel.querySelector('#check-conflicts-btn');\r\n  if (checkConflictsBtn) {\r\n    on(checkConflictsBtn as HTMLElement, 'click', async () => {\r\n      const container = panel.querySelector('#conflicts-container') as HTMLElement;\r\n      await checkConflicts(container, panel, props);\r\n    });\r\n  }\r\n\r\n  const addBtn = panel.querySelector('#add-decision-btn');\r\n  if (addBtn) {\r\n    on(addBtn as HTMLElement, 'click', () => {\r\n      showDecisionModal({\r\n        mode: 'create',\r\n        onSave: () => {\r\n          loadDecisions(panel, props);\r\n          refreshRemovedSection(panel, props);\r\n        },\r\n      });\r\n    });\r\n  }\r\n\r\n  loadDecisions(panel, props);\r\n  refreshRemovedSection(panel, props);\r\n\r\n  return panel;\r\n}\r\n\r\nasync function checkConflicts(container: HTMLElement, panel: HTMLElement, props: DecisionsPanelProps): Promise<void> {\r\n  container.classList.remove('hidden');\r\n  container.innerHTML = '<div class=\"loading\">Checking for conflicts...</div>';\r\n  try {\r\n    const result = await decisionsService.runDecisionCheck();\r\n    const conflicts = result.conflicts || [];\r\n    if (conflicts.length === 0) {\r\n      container.innerHTML = `\r\n        <div class=\"no-conflicts\">\r\n          <span class=\"success-icon\"></span>\r\n          <p>No conflicts detected</p>\r\n        </div>\r\n      `;\r\n      return;\r\n    }\r\n    container.innerHTML = conflicts.map((c: DecisionConflict) => createConflictCard(c, panel, props)).join('');\r\n    bindConflictCards(container, panel, props);\r\n  } catch {\r\n    container.innerHTML = '<div class=\"error\">Failed to check conflicts</div>';\r\n  }\r\n}\r\n\r\nfunction createConflictCard(c: DecisionConflict, panel: HTMLElement, props: DecisionsPanelProps): string {\r\n  const d1 = c.decision1;\r\n  const d2 = c.decision2;\r\n  const desc = (c.description || c.reason || 'Conflict').substring(0, 200);\r\n  return `\r\n    <div class=\"conflict-card-sota\" data-decision-id1=\"${d1.id}\" data-decision-id2=\"${d2.id}\">\r\n      <div class=\"conflict-card-priority-bar conflict-card-priority-bar-warning\"></div>\r\n      <div class=\"conflict-card-body\">\r\n        <div class=\"conflict-card-header\">\r\n          <span class=\"conflict-type-badge\">Conflict</span>\r\n          <p class=\"conflict-description\">${escapeHtml(desc)}</p>\r\n        </div>\r\n        <div class=\"conflict-pair\">\r\n          <div class=\"conflict-item\">\r\n            <div class=\"conflict-item-content\">${escapeHtml((d1.content || '').substring(0, 120))}${(d1.content || '').length > 120 ? '' : ''}</div>\r\n            <button type=\"button\" class=\"btn btn-sm conflict-keep-btn\" data-keep-id=\"${d1.id}\" data-discard-id=\"${d2.id}\">Keep this</button>\r\n          </div>\r\n          <div class=\"conflict-vs\">vs</div>\r\n          <div class=\"conflict-item\">\r\n            <div class=\"conflict-item-content\">${escapeHtml((d2.content || '').substring(0, 120))}${(d2.content || '').length > 120 ? '' : ''}</div>\r\n            <button type=\"button\" class=\"btn btn-sm conflict-keep-btn\" data-keep-id=\"${d2.id}\" data-discard-id=\"${d1.id}\">Keep this</button>\r\n          </div>\r\n        </div>\r\n      </div>\r\n    </div>\r\n  `;\r\n}\r\n\r\nfunction bindConflictCards(container: HTMLElement, panel: HTMLElement, props: DecisionsPanelProps): void {\r\n  container.querySelectorAll('.conflict-keep-btn').forEach((btn) => {\r\n    on(btn as HTMLElement, 'click', async (e) => {\r\n      e.stopPropagation();\r\n      const keepId = (btn as HTMLElement).getAttribute('data-keep-id');\r\n      const discardId = (btn as HTMLElement).getAttribute('data-discard-id');\r\n      if (!keepId || !discardId) return;\r\n      try {\r\n        await decisionsService.delete(discardId);\r\n        await decisionsService.runDecisionCheck();\r\n        await decisionsService.update(keepId, { status: 'approved' as const });\r\n        toast.success('Conflict resolved');\r\n        loadDecisions(panel, props);\r\n        await checkConflicts(container, panel, props);\r\n        refreshRemovedSection(panel, props);\r\n      } catch {\r\n        toast.error('Failed to resolve conflict');\r\n      }\r\n    });\r\n  });\r\n}\r\n\r\nasync function refreshRemovedSection(panel: HTMLElement, props: DecisionsPanelProps): Promise<void> {\r\n  const container = panel.querySelector('#removed-decisions-container') as HTMLElement;\r\n  if (!container) return;\r\n  try {\r\n    const deleted = await decisionsService.getDeletedDecisions();\r\n    if (deleted.length === 0) {\r\n      container.classList.add('hidden');\r\n      container.innerHTML = '';\r\n      return;\r\n    }\r\n    container.classList.remove('hidden');\r\n    container.innerHTML = `\r\n      <div class=\"removed-decisions-section\">\r\n        <div class=\"removed-decisions-header section-header-sota\">\r\n          <h3>Removed decisions</h3>\r\n          <span class=\"panel-count removed-count\">${deleted.length}</span>\r\n        </div>\r\n        <p class=\"removed-decisions-hint\">Restore to undo a conflict resolution; decision will be synced back to the graph.</p>\r\n        <div class=\"removed-decisions-list\">\r\n          ${deleted.map((d) => `\r\n            <div class=\"removed-decision-item\" data-decision-id=\"${d.id}\">\r\n              <div class=\"removed-decision-content\">${escapeHtml(truncate(d.content ?? '', 100))}</div>\r\n              <button type=\"button\" class=\"btn btn-sm conflict-resolve-restore\">Restore</button>\r\n            </div>\r\n          `).join('')}\r\n        </div>\r\n      </div>\r\n    `;\r\n    container.querySelectorAll('.conflict-resolve-restore').forEach((restoreBtn) => {\r\n      on(restoreBtn as HTMLElement, 'click', async () => {\r\n        const id = (restoreBtn as HTMLElement).closest('.removed-decision-item')?.getAttribute('data-decision-id');\r\n        if (!id) return;\r\n        try {\r\n          await decisionsService.restore(id);\r\n          toast.success('Decision restored');\r\n          loadDecisions(panel, props);\r\n          refreshRemovedSection(panel, props);\r\n        } catch {\r\n          toast.error('Failed to restore decision');\r\n        }\r\n      });\r\n    });\r\n  } catch {\r\n    container.classList.add('hidden');\r\n    container.innerHTML = '';\r\n  }\r\n}\r\n\r\nfunction truncate(s: string, len: number): string {\r\n  if (s.length <= len) return s;\r\n  return s.substring(0, len) + '';\r\n}\r\n\r\n/**\r\n * Filter decisions by search (client-side)\r\n */\r\nfunction filterDecisionsBySearch(decisions: Decision[], q: string): Decision[] {\r\n  if (!q) return decisions;\r\n  const lower = q.toLowerCase();\r\n  return decisions.filter(\r\n    d =>\r\n      (d.content || '').toLowerCase().includes(lower) ||\r\n      (d.rationale || '').toLowerCase().includes(lower) ||\r\n      (d.made_by || '').toLowerCase().includes(lower) ||\r\n      (d.source_file || '').toLowerCase().includes(lower)\r\n  );\r\n}\r\n\r\n/**\r\n * Load decisions\r\n */\r\nasync function loadDecisions(panel: HTMLElement, props: DecisionsPanelProps): Promise<void> {\r\n  const content = panel.querySelector('#decisions-content') as HTMLElement;\r\n  content.innerHTML = '<div class=\"loading\">Loading...</div>';\r\n\r\n  try {\r\n    const status = currentFilter === 'all' ? undefined : currentFilter;\r\n    const raw = await decisionsService.getAll(status);\r\n    const decisions = filterDecisionsBySearch(raw, currentSearch);\r\n\r\n    if (currentView === 'source') {\r\n      renderDecisionsBySource(content, decisions, props);\r\n    } else {\r\n      renderDecisions(content, decisions, props);\r\n    }\r\n    dataStore.setDecisions(raw as unknown as []);\r\n    updateCount(panel, decisions.length);\r\n  } catch {\r\n    content.innerHTML = '<div class=\"error\">Failed to load decisions</div>';\r\n  }\r\n}\r\n\r\n/**\r\n * Render decisions list (grouped by status when multiple statuses)\r\n */\r\nfunction renderDecisions(container: HTMLElement, decisions: Decision[], props: DecisionsPanelProps): void {\r\n  if (decisions.length === 0) {\r\n    container.innerHTML = `\r\n      <div class=\"empty-state\">\r\n        <p>${currentSearch ? 'No decisions match your search' : 'No decisions found'}</p>\r\n        <button class=\"btn btn-primary\" id=\"empty-add-btn\">Add Decision</button>\r\n      </div>\r\n    `;\r\n    const addBtn = container.querySelector('#empty-add-btn');\r\n    if (addBtn) {\r\n      on(addBtn as HTMLElement, 'click', () => {\r\n        showDecisionModal({ mode: 'create', onSave: () => loadDecisions(container.closest('.decisions-panel') as HTMLElement, props) });\r\n      });\r\n    }\r\n    return;\r\n  }\r\n\r\n  const contacts: ContactLike[] = (dataStore.getState().contacts || []) as ContactLike[];\r\n  const byStatus: Record<string, Decision[]> = {};\r\n  decisions.forEach(d => {\r\n    const s = (d.status || 'active').toLowerCase();\r\n    if (!byStatus[s]) byStatus[s] = [];\r\n    byStatus[s].push(d);\r\n  });\r\n  const statuses = Object.keys(byStatus);\r\n\r\n  if (statuses.length > 1) {\r\n    container.innerHTML = statuses.map(status => `\r\n      <div class=\"question-group\">\r\n        <div class=\"group-header\">\r\n          <h3>${escapeHtml(status)}</h3>\r\n          <span class=\"group-count\">${byStatus[status].length}</span>\r\n        </div>\r\n        <div class=\"group-items\">\r\n          ${byStatus[status].map(d => createDecisionCard(d, contacts)).join('')}\r\n        </div>\r\n      </div>\r\n    `).join('');\r\n  } else {\r\n    container.innerHTML = decisions.map(d => createDecisionCard(d, contacts)).join('');\r\n  }\r\n\r\n  bindDecisionCards(container, decisions, props);\r\n}\r\n\r\n/**\r\n * Render decisions grouped by source\r\n */\r\nfunction renderDecisionsBySource(container: HTMLElement, decisions: Decision[], props: DecisionsPanelProps): void {\r\n  if (decisions.length === 0) {\r\n    container.innerHTML = `\r\n      <div class=\"empty-state\">\r\n        <p>${currentSearch ? 'No decisions match your search' : 'No decisions found'}</p>\r\n        <button class=\"btn btn-primary\" id=\"empty-add-btn\">Add Decision</button>\r\n      </div>\r\n    `;\r\n    const addBtn = container.querySelector('#empty-add-btn');\r\n    if (addBtn) {\r\n      on(addBtn as HTMLElement, 'click', () => {\r\n        showDecisionModal({ mode: 'create', onSave: () => loadDecisions(container.closest('.decisions-panel') as HTMLElement, props) });\r\n      });\r\n    }\r\n    return;\r\n  }\r\n  const contacts: ContactLike[] = (dataStore.getState().contacts || []) as ContactLike[];\r\n  const bySource: Record<string, Decision[]> = {};\r\n  decisions.forEach(d => {\r\n    const src = d.source_file || d.source || 'Unknown source';\r\n    if (!bySource[src]) bySource[src] = [];\r\n    bySource[src].push(d);\r\n  });\r\n  container.innerHTML = Object.entries(bySource).map(([source, list]) => `\r\n    <div class=\"question-group\">\r\n      <div class=\"group-header\">\r\n        <h3>${escapeHtml(source)}</h3>\r\n        <span class=\"group-count\">${list.length}</span>\r\n      </div>\r\n      <div class=\"group-items\">\r\n        ${list.map(d => createDecisionCard(d, contacts)).join('')}\r\n      </div>\r\n    </div>\r\n  `).join('');\r\n\r\n  bindDecisionCards(container, decisions, props);\r\n}\r\n\r\nfunction bindDecisionCards(container: HTMLElement, decisions: Decision[], props: DecisionsPanelProps): void {\r\n  container.querySelectorAll('.decision-card-sota').forEach((card) => {\r\n    on(card as HTMLElement, 'click', (e) => {\r\n      if ((e.target as HTMLElement).closest('.card-actions')) return;\r\n      const id = card.getAttribute('data-id');\r\n      const decision = decisions.find((d) => String(d.id) === id);\r\n      if (!decision) return;\r\n      if (props.useDetailView && props.containerElement) {\r\n        const containerEl = props.containerElement;\r\n        containerEl.innerHTML = '';\r\n        containerEl.appendChild(createDecisionDetailView(decisionDetailProps(containerEl, props, decision)));\r\n      } else if (props.onDecisionClick) {\r\n        props.onDecisionClick(decision);\r\n      } else {\r\n        showDecisionModal({\r\n          mode: 'edit',\r\n          decision: { ...decision, decision: decision.content, madeBy: decision.made_by, madeAt: decision.created_at },\r\n          onSave: () => loadDecisions(container.closest('.decisions-panel') as HTMLElement, props),\r\n        });\r\n      }\r\n    });\r\n\r\n    const approveBtn = card.querySelector('.approve-btn');\r\n    const rejectBtn = card.querySelector('.reject-btn');\r\n    const id = card.getAttribute('data-id');\r\n\r\n    if (approveBtn && id) {\r\n      on(approveBtn as HTMLElement, 'click', async (e) => {\r\n        e.stopPropagation();\r\n        try {\r\n          await decisionsService.approve(id, 'Current User');\r\n          loadDecisions(container.closest('.decisions-panel') as HTMLElement, props);\r\n        } catch {\r\n          // no-op\r\n        }\r\n      });\r\n    }\r\n    if (rejectBtn && id) {\r\n      on(rejectBtn as HTMLElement, 'click', async (e) => {\r\n        e.stopPropagation();\r\n        try {\r\n          await decisionsService.reject(id);\r\n          loadDecisions(container.closest('.decisions-panel') as HTMLElement, props);\r\n        } catch {\r\n          // no-op\r\n        }\r\n      });\r\n    }\r\n  });\r\n}\r\n\r\n/** Status bar color (left edge) - align with fact category bar */\r\nconst STATUS_BAR_COLOR: Record<string, string> = {\r\n  proposed: '#f59e0b',\r\n  approved: '#10b981',\r\n  rejected: '#ef4444',\r\n  deferred: '#6b7280',\r\n  active: '#3b82f6',\r\n  superseded: '#8b5cf6',\r\n  revoked: '#6b7280',\r\n};\r\n\r\ntype ContactLike = { name?: string; role?: string; photoUrl?: string; avatarUrl?: string; photo_url?: string; avatar_url?: string; aliases?: string[] };\r\n\r\nfunction findContactByOwner(contacts: ContactLike[], name: string): ContactLike | undefined {\r\n  if (!name || !contacts.length) return undefined;\r\n  const n = name.trim().toLowerCase();\r\n  if (!n) return undefined;\r\n  const byExact = contacts.find((c) => (c.name || '').trim().toLowerCase() === n);\r\n  if (byExact) return byExact;\r\n  const byPartial = contacts.find(\r\n    (c) =>\r\n      (c.name || '').trim().toLowerCase().includes(n) ||\r\n      n.includes((c.name || '').trim().toLowerCase())\r\n  );\r\n  if (byPartial) return byPartial;\r\n  const byAlias = contacts.find((c) =>\r\n    (c.aliases || []).some((a) => String(a).trim().toLowerCase() === n)\r\n  );\r\n  return byAlias || contacts.find((c) =>\r\n    (c.aliases || []).some((a) => {\r\n      const aLower = String(a).trim().toLowerCase();\r\n      return aLower.includes(n) || n.includes(aLower);\r\n    })\r\n  );\r\n}\r\n\r\nfunction getContactPhotoUrl(c: ContactLike | undefined): string | null {\r\n  if (!c) return null;\r\n  return c.photoUrl || c.avatarUrl || c.photo_url || c.avatar_url || null;\r\n}\r\n\r\nfunction getInitials(name: string): string {\r\n  if (!name) return '?';\r\n  const parts = name.trim().split(/\\s+/);\r\n  return parts.length === 1 ? parts[0].substring(0, 2).toUpperCase() : (parts[0][0] + parts[parts.length - 1][0]).toUpperCase();\r\n}\r\n\r\nfunction createDecisionCard(decision: Decision, contacts: ContactLike[]): string {\r\n  const status = (decision.status || 'active').toLowerCase();\r\n  const statusClass = status.replace(/\\s+/g, '-');\r\n  const barColor = STATUS_BAR_COLOR[status] ?? STATUS_BAR_COLOR.active;\r\n  const content = decision.content || '';\r\n  const source = decision.source_file || decision.source || '';\r\n  const owner = decision.made_by || (decision as { owner?: string }).owner || '';\r\n  const contact = owner ? findContactByOwner(contacts, owner) : undefined;\r\n  const photoUrl = getContactPhotoUrl(contact);\r\n  const ownerChipHtml = owner\r\n    ? `\r\n        <div class=\"assignee-chip\">\r\n          <div class=\"assignee-avatar\">${photoUrl ? `<img src=\"${escapeHtml(photoUrl)}\" alt=\"${escapeHtml(owner)}\" onerror=\"this.parentElement.innerHTML='${getInitials(owner)}'\">` : getInitials(owner)}</div>\r\n          <div class=\"assignee-info\">\r\n            <span class=\"assignee-name\">${escapeHtml(owner)}</span>\r\n            ${contact?.role ? `<span class=\"assignee-role\">${escapeHtml(contact.role)}</span>` : ''}\r\n          </div>\r\n        </div>\r\n      `\r\n    : '<span class=\"card-owner-placeholder text-muted\">No owner</span>';\r\n  const sourceChip = source ? `<span class=\"card-source-chip\">${escapeHtml(source.substring(0, 40))}${source.length > 40 ? '' : ''}</span>` : '<span class=\"card-source-chip text-muted\">No source</span>';\r\n\r\n  return `\r\n    <div class=\"decision-card-sota question-card-sota\" data-id=\"${decision.id}\" style=\"--decision-status-bar: ${barColor}\">\r\n      <div class=\"card-priority-bar decision-status-bar\"></div>\r\n      <div class=\"card-body\">\r\n        <div class=\"card-top-row\">\r\n          <div class=\"card-badges\">\r\n            <span class=\"priority-pill status-${statusClass}\">${escapeHtml(String(decision.status))}</span>\r\n            ${decision.impact ? `<span class=\"status-pill\">${escapeHtml(decision.impact)} impact</span>` : ''}\r\n          </div>\r\n          <span class=\"card-timestamp\">${formatRelativeTime(decision.decided_at || decision.created_at)}</span>\r\n        </div>\r\n        <div class=\"card-question-text\">${escapeHtml(content)}</div>\r\n        ${(decision as any).summary ? `<div class=\"card-summary text-muted\">${escapeHtml((decision as any).summary)}</div>` : ''}\r\n        ${decision.rationale ? `<div class=\"card-rationale text-muted\">${escapeHtml((decision.rationale || '').substring(0, 100))}${(decision.rationale || '').length > 100 ? '' : ''}</div>` : ''}\r\n        <div class=\"card-bottom-row\">\r\n          <div class=\"card-requester\">\r\n            ${sourceChip}\r\n            ${ownerChipHtml}\r\n          </div>\r\n          <div class=\"card-assignment\">\r\n            ${decision.status === 'proposed' || decision.status === 'active'\r\n      ? `<span class=\"card-actions\"><button type=\"button\" class=\"btn btn-sm btn-success approve-btn\">Approve</button><button type=\"button\" class=\"btn btn-sm btn-danger reject-btn\">Reject</button></span>`\r\n      : '<button type=\"button\" class=\"btn-link decision-view-link\">View</button>'}\r\n          </div>\r\n        </div>\r\n      </div>\r\n    </div>\r\n  `;\r\n}\r\n\r\nfunction updateCount(panel: HTMLElement, count: number): void {\r\n  const countEl = panel.querySelector('#decisions-count');\r\n  if (countEl) countEl.textContent = String(count);\r\n}\r\n\r\nfunction escapeHtml(text: string): string {\r\n  const div = document.createElement('div');\r\n  div.textContent = text;\r\n  return div.innerHTML;\r\n}\r\n\r\nexport default createDecisionsPanel;\r\n","/**\r\n * Fact Detail View\r\n * Full-page view for fact details: content, category, confidence, source, verified, document link\r\n */\r\n\r\nimport { createElement, on } from '@lib/dom';\r\nimport { Fact, factsService } from '@services/facts';\r\nimport { toast } from '@services/toast';\r\nimport { formatRelativeTime, formatDateTime } from '@lib/format';\r\n\r\nexport interface FactDetailViewProps {\r\n  fact: Fact;\r\n  onClose: () => void;\r\n  onUpdate?: (fact: Fact) => void;\r\n  /** When user clicks a similar fact, open that fact (e.g. replace view) */\r\n  onFactClick?: (fact: Fact) => void;\r\n}\r\n\r\nfunction escapeHtml(text: string): string {\r\n  const div = document.createElement('div');\r\n  div.textContent = text;\r\n  return div.innerHTML;\r\n}\r\n\r\nfunction formatDate(iso: string | undefined): string {\r\n  if (!iso) return '';\r\n  try {\r\n    return formatDateTime(iso);\r\n  } catch {\r\n    return iso;\r\n  }\r\n}\r\n\r\n/**\r\n * Create and show the fact detail view\r\n */\r\nexport function createFactDetailView(props: FactDetailViewProps): HTMLElement {\r\n  const { fact, onClose, onUpdate, onFactClick } = props;\r\n\r\n  const container = createElement('div', { className: 'fact-detail-view question-detail-view' });\r\n\r\n  container.innerHTML = `\r\n    <div class=\"question-detail-header fact-detail-header\">\r\n      <div class=\"breadcrumb\">\r\n        <a href=\"#\" class=\"breadcrumb-link\" id=\"back-to-list\">Facts</a>\r\n        <span class=\"breadcrumb-separator\"></span>\r\n        <span class=\"breadcrumb-current\">Fact #${String(fact.id).substring(0, 8)}</span>\r\n      </div>\r\n      <div class=\"header-actions\">\r\n        ${fact.verified ? '<span class=\"verified-badge detail sla-badge\"> Verified</span>' : ''}\r\n        <button class=\"btn btn-icon\" id=\"close-detail\" title=\"Close\"></button>\r\n      </div>\r\n    </div>\r\n\r\n    <div class=\"question-detail-content fact-detail-content\">\r\n      <section class=\"detail-section question-main fact-main\">\r\n        <div class=\"question-badges fact-badges\">\r\n          ${fact.category ? `<span class=\"priority-pill category-${(fact.category || 'general').toLowerCase().replace(/\\s+/g, '-')}\">${escapeHtml(fact.category)}</span>` : ''}\r\n          ${fact.confidence != null ? `<span class=\"status-pill status-pending\">${Math.round((fact.confidence ?? 0) * 100)}%</span>` : ''}\r\n          ${fact.verified ? '<span class=\"auto-pill\"> Verified</span>' : ''}\r\n          <span class=\"question-date fact-date\">Created ${formatRelativeTime(fact.created_at)}</span>\r\n        </div>\r\n        <h2 class=\"question-text fact-content-text\">${escapeHtml(fact.content)}</h2>\r\n      </section>\r\n\r\n      <div class=\"detail-columns\">\r\n        <div class=\"detail-column-left\">\r\n          <section class=\"detail-section\">\r\n            <div class=\"section-header\">\r\n              <h3>Source</h3>\r\n            </div>\r\n            ${fact.source_file ? `<p class=\"source-file\">${escapeHtml(fact.source_file)}</p>` : ''}\r\n            ${fact.source ? `<p class=\"source-ref\">${escapeHtml(fact.source)}</p>` : ''}\r\n            ${fact.source_document_id ? `\r\n              <p class=\"source-doc\">\r\n                <a href=\"#\" class=\"doc-link\" data-document-id=\"${escapeHtml(String(fact.source_document_id))}\">View source document</a>\r\n              </p>\r\n            ` : ''}\r\n            ${!fact.source && !fact.source_file && !fact.source_document_id ? '<p class=\"text-muted\">No source recorded</p>' : ''}\r\n          </section>\r\n\r\n          <section class=\"detail-section verification-section\">\r\n            <div class=\"section-header\">\r\n              <h3>Verification</h3>\r\n            </div>\r\n            ${fact.verified\r\n      ? `\r\n              <div class=\"verified-info\">\r\n                <span class=\"verified-badge auto-pill\"> Verified</span>\r\n                ${fact.verified_at ? `<span class=\"text-muted\">on ${formatDate(fact.verified_at)}</span>` : ''}\r\n              </div>\r\n            `\r\n      : `\r\n              <div class=\"unverified-info\">\r\n                <p class=\"text-muted\">This fact has not been verified.</p>\r\n                <button type=\"button\" class=\"btn btn-success btn-sm\" id=\"verify-fact-btn\">Verify</button>\r\n              </div>\r\n            `}\r\n          </section>\r\n        </div>\r\n\r\n        <div class=\"detail-column-right\">\r\n          <section class=\"detail-section metadata-section\">\r\n            <div class=\"section-header\">\r\n              <h3>Metadata</h3>\r\n            </div>\r\n            <dl class=\"metadata-list\">\r\n              <dt>Created</dt>\r\n              <dd>${formatDate(fact.created_at)}</dd>\r\n              ${fact.updated_at ? `<dt>Updated</dt><dd>${formatDate(fact.updated_at)}</dd>` : ''}\r\n            </dl>\r\n          </section>\r\n\r\n          <section class=\"detail-section fact-timeline-section\">\r\n            <div class=\"section-header\">\r\n              <h3>Timeline</h3>\r\n            </div>\r\n            <div id=\"fact-timeline-list\" class=\"fact-timeline-list\">\r\n              <span class=\"text-muted\">Loading</span>\r\n            </div>\r\n          </section>\r\n\r\n          <section class=\"detail-section fact-similar-section\">\r\n            <div class=\"section-header\">\r\n              <h3>Similar facts</h3>\r\n            </div>\r\n            <div id=\"fact-similar-list\" class=\"fact-similar-list\">\r\n              <span class=\"text-muted\">Loading</span>\r\n            </div>\r\n          </section>\r\n        </div>\r\n      </div>\r\n\r\n      <div class=\"detail-actions\">\r\n        <button type=\"button\" class=\"btn btn-secondary\" id=\"edit-fact-btn\">Edit</button>\r\n        ${!fact.verified ? '<button type=\"button\" class=\"btn btn-success\" id=\"verify-btn\">Verify</button>' : ''}\r\n        <button type=\"button\" class=\"btn btn-danger\" id=\"delete-fact-btn\">Delete</button>\r\n      </div>\r\n    </div>\r\n  `;\r\n\r\n  // Back / Close\r\n  const backLink = container.querySelector('#back-to-list');\r\n  if (backLink) {\r\n    on(backLink as HTMLElement, 'click', (e) => {\r\n      e.preventDefault();\r\n      onClose();\r\n    });\r\n  }\r\n  const closeBtn = container.querySelector('#close-detail');\r\n  if (closeBtn) {\r\n    on(closeBtn as HTMLElement, 'click', onClose);\r\n  }\r\n\r\n  // Verify (header or section)\r\n  const verifyFactBtn = container.querySelector('#verify-fact-btn');\r\n  if (verifyFactBtn) {\r\n    on(verifyFactBtn as HTMLElement, 'click', async () => {\r\n      try {\r\n        const updated = await factsService.verify(fact.id);\r\n        toast.success('Fact verified');\r\n        if (onUpdate) onUpdate(updated);\r\n        onClose();\r\n      } catch {\r\n        toast.error('Failed to verify fact');\r\n      }\r\n    });\r\n  }\r\n  const verifyBtn = container.querySelector('#verify-btn');\r\n  if (verifyBtn) {\r\n    on(verifyBtn as HTMLElement, 'click', async () => {\r\n      try {\r\n        const updated = await factsService.verify(fact.id);\r\n        toast.success('Fact verified');\r\n        if (onUpdate) onUpdate(updated);\r\n        onClose();\r\n      } catch {\r\n        toast.error('Failed to verify fact');\r\n      }\r\n    });\r\n  }\r\n\r\n  // Edit\r\n  const editBtn = container.querySelector('#edit-fact-btn');\r\n  if (editBtn) {\r\n    on(editBtn as HTMLElement, 'click', () => {\r\n      import('../modals/FactModal').then(({ showFactModal }) => {\r\n        showFactModal({\r\n          mode: 'edit',\r\n          fact,\r\n          onSave: (updated) => {\r\n            if (onUpdate) onUpdate(updated);\r\n            onClose();\r\n          },\r\n        });\r\n      });\r\n    });\r\n  }\r\n\r\n  // Delete\r\n  const deleteBtn = container.querySelector('#delete-fact-btn');\r\n  if (deleteBtn) {\r\n    on(deleteBtn as HTMLElement, 'click', async () => {\r\n      if (!confirm('Are you sure you want to delete this fact?')) return;\r\n      try {\r\n        await factsService.delete(fact.id);\r\n        toast.success('Fact deleted');\r\n        onClose();\r\n      } catch {\r\n        toast.error('Failed to delete fact');\r\n      }\r\n    });\r\n  }\r\n\r\n  // Document link (navigate to files / document preview if implemented)\r\n  const docLink = container.querySelector('.doc-link');\r\n  if (docLink && fact.source_document_id) {\r\n    on(docLink as HTMLElement, 'click', (e) => {\r\n      e.preventDefault();\r\n      window.dispatchEvent(new CustomEvent('godmode:navigate', {\r\n        detail: { tab: 'files', documentId: fact.source_document_id }\r\n      }));\r\n    });\r\n  }\r\n\r\n  // Load timeline (fact events)\r\n  const timelineEl = container.querySelector('#fact-timeline-list');\r\n  if (timelineEl) {\r\n    factsService.getEvents(fact.id).then((events) => {\r\n      const labels: Record<string, string> = {\r\n        created: 'Created',\r\n        verified: 'Verified',\r\n        updated: 'Updated',\r\n        conflict_detected: 'Conflict detected',\r\n        deleted: 'Deleted',\r\n        restored: 'Restored',\r\n      };\r\n      const actorLabel = (ev: { actor_name?: string; event_data?: { trigger?: string } }) =>\r\n        ev.actor_name || (ev.event_data?.trigger === 'fact_check_flow' ? 'System' : null);\r\n      if (events.length === 0) {\r\n        (timelineEl as HTMLElement).innerHTML = '<span class=\"text-muted\">No events yet</span>';\r\n        return;\r\n      }\r\n      (timelineEl as HTMLElement).innerHTML = events\r\n        .map(\r\n          (ev) => {\r\n            const actor = actorLabel(ev);\r\n            return `<div class=\"fact-timeline-item fact-event-${escapeHtml(ev.event_type)}\">\r\n              <span class=\"fact-event-type\">${escapeHtml(labels[ev.event_type] || ev.event_type)}</span>\r\n              ${actor ? `<span class=\"fact-event-actor\">${escapeHtml(actor)}</span>` : ''}\r\n              <span class=\"fact-event-date\">${formatRelativeTime(ev.created_at)}</span>\r\n            </div>`;\r\n          }\r\n        )\r\n        .join('');\r\n    }).catch(() => {\r\n      (timelineEl as HTMLElement).innerHTML = '<span class=\"text-muted\">Could not load timeline</span>';\r\n    });\r\n  }\r\n\r\n  // Load similar facts\r\n  const similarEl = container.querySelector('#fact-similar-list');\r\n  if (similarEl) {\r\n    factsService.getSimilarFacts(fact.id, 10).then((similar) => {\r\n      if (similar.length === 0) {\r\n        (similarEl as HTMLElement).innerHTML = '<span class=\"text-muted\">No similar facts</span>';\r\n        return;\r\n      }\r\n      (similarEl as HTMLElement).innerHTML = similar\r\n        .map(\r\n          (s) => `\r\n            <div class=\"fact-similar-item\" data-fact-id=\"${s.fact.id}\" role=\"${onFactClick ? 'button' : 'none'}\">\r\n              <span class=\"fact-similar-score\">${Math.round(s.similarityScore * 100)}%</span>\r\n              <span class=\"fact-similar-content\">${escapeHtml((s.fact.content || '').substring(0, 80))}${(s.fact.content || '').length > 80 ? '' : ''}</span>\r\n            </div>\r\n          `\r\n        )\r\n        .join('');\r\n      if (onFactClick) {\r\n        (similarEl as HTMLElement).querySelectorAll('.fact-similar-item').forEach((el) => {\r\n          on(el as HTMLElement, 'click', () => {\r\n            const item = similar.find((s) => String(s.fact.id) === (el as HTMLElement).getAttribute('data-fact-id'));\r\n            if (item) onFactClick(item.fact);\r\n          });\r\n        });\r\n      }\r\n    }).catch(() => {\r\n      (similarEl as HTMLElement).innerHTML = '<span class=\"text-muted\">Could not load similar facts</span>';\r\n    });\r\n  }\r\n\r\n  return container;\r\n}\r\n","/**\r\n * Facts Panel Component\r\n * Displays and manages facts with conflict detection, filters, and detail view\r\n */\r\n\r\nimport { createElement, on } from '@lib/dom';\r\nimport { factsService, Fact, FactConflict } from '@services/facts';\r\nimport { createFactDetailView, FactDetailViewProps } from '../facts/FactDetailView';\r\nimport { toast } from '@services/toast';\r\nimport { formatRelativeTime } from '@lib/format';\r\n\r\nconst CATEGORIES = ['technical', 'process', 'policy', 'people', 'timeline', 'general'] as const;\r\n\r\n/** Build FactDetailView props with onFactClick so similar-fact clicks open that fact in the same container */\r\nfunction factDetailProps(containerEl: HTMLElement, props: FactsPanelProps, fact: Fact): FactDetailViewProps {\r\n  return {\r\n    fact,\r\n    onClose: () => {\r\n      containerEl.innerHTML = '';\r\n      containerEl.appendChild(createFactsPanel(props));\r\n    },\r\n    onUpdate: () => {\r\n      containerEl.innerHTML = '';\r\n      containerEl.appendChild(createFactsPanel(props));\r\n    },\r\n    onFactClick: (clickedFact) => {\r\n      containerEl.innerHTML = '';\r\n      containerEl.appendChild(createFactDetailView(factDetailProps(containerEl, props, clickedFact)));\r\n    },\r\n  };\r\n}\r\n\r\nexport interface FactsPanelProps {\r\n  onFactClick?: (fact: Fact) => void;\r\n  useDetailView?: boolean;\r\n  containerElement?: HTMLElement;\r\n}\r\n\r\nlet currentSearch: string = '';\r\nlet currentFilter: string = 'all';\r\nlet currentView: 'category' | 'source' = 'category';\r\nlet showConflicts: boolean = false;\r\n\r\n/**\r\n * Create facts panel\r\n */\r\nexport function createFactsPanel(props: FactsPanelProps = {}): HTMLElement {\r\n  const panel = createElement('div', { className: 'sot-panel facts-panel' });\r\n\r\n  panel.innerHTML = `\r\n    <div class=\"panel-header\">\r\n      <div class=\"panel-title\">\r\n        <h2>Facts</h2>\r\n        <span class=\"panel-count\" id=\"facts-count\">0</span>\r\n      </div>\r\n      <div class=\"panel-actions\">\r\n        <select id=\"facts-filter\" class=\"filter-select\">\r\n          <option value=\"all\">All</option>\r\n          <option value=\"verified\"> Verified</option>\r\n          <option value=\"unverified\">Unverified</option>\r\n          <option value=\"technical\">Technical</option>\r\n          <option value=\"process\">Process</option>\r\n          <option value=\"policy\">Policy</option>\r\n          <option value=\"people\">People</option>\r\n          <option value=\"timeline\">Timeline</option>\r\n          <option value=\"general\">General</option>\r\n        </select>\r\n        <div class=\"view-tabs\">\r\n          <button class=\"view-tab active\" data-view=\"category\">By Category</button>\r\n          <button class=\"view-tab\" data-view=\"source\">By Source</button>\r\n        </div>\r\n        <input type=\"search\" id=\"facts-search\" class=\"search-input\" placeholder=\"Search facts...\" title=\"Search\">\r\n        <button class=\"btn btn-secondary btn-sm\" id=\"check-conflicts-btn\" title=\"Check for conflicting facts\">Check Conflicts</button>\r\n        <button class=\"btn btn-primary btn-sm\" id=\"add-fact-btn\">+ Add</button>\r\n      </div>\r\n    </div>\r\n    <div id=\"conflicts-container\" class=\"conflicts-container hidden\"></div>\r\n    <div class=\"panel-content\" id=\"facts-content\">\r\n      <div class=\"loading\">Loading facts...</div>\r\n    </div>\r\n    <div id=\"removed-facts-container\" class=\"removed-facts-container hidden\"></div>\r\n  `;\r\n\r\n  // Filter\r\n  const filterSelect = panel.querySelector('#facts-filter') as HTMLSelectElement;\r\n  if (filterSelect) {\r\n    on(filterSelect, 'change', () => {\r\n      currentFilter = filterSelect.value;\r\n      loadFacts(panel, props);\r\n    });\r\n  }\r\n\r\n  // View tabs\r\n  const viewTabs = panel.querySelectorAll('.view-tab');\r\n  viewTabs.forEach(tab => {\r\n    on(tab as HTMLElement, 'click', () => {\r\n      viewTabs.forEach(t => t.classList.remove('active'));\r\n      tab.classList.add('active');\r\n      currentView = tab.getAttribute('data-view') as 'category' | 'source';\r\n      loadFacts(panel, props);\r\n    });\r\n  });\r\n\r\n  // Search\r\n  const searchInput = panel.querySelector('#facts-search') as HTMLInputElement;\r\n  let searchTimeout: number;\r\n  on(searchInput, 'input', () => {\r\n    clearTimeout(searchTimeout);\r\n    searchTimeout = window.setTimeout(() => {\r\n      currentSearch = searchInput.value;\r\n      loadFacts(panel, props);\r\n    }, 300);\r\n  });\r\n\r\n  const conflictsBtn = panel.querySelector('#check-conflicts-btn');\r\n  if (conflictsBtn) {\r\n    on(conflictsBtn as HTMLElement, 'click', async () => {\r\n      const container = panel.querySelector('#conflicts-container') as HTMLElement;\r\n      await checkConflicts(container, panel, props);\r\n    });\r\n  }\r\n\r\n  const addBtn = panel.querySelector('#add-fact-btn');\r\n  if (addBtn) {\r\n    on(addBtn as HTMLElement, 'click', () => {\r\n      showAddFactModal(panel, props);\r\n    });\r\n  }\r\n\r\n  // Initial load (loadFacts calls refreshRemovedFactsSection at end)\r\n  loadFacts(panel, props);\r\n\r\n  return panel;\r\n}\r\n\r\n/**\r\n * Load facts\r\n */\r\nasync function loadFacts(panel: HTMLElement, props: FactsPanelProps): Promise<void> {\r\n  const content = panel.querySelector('#facts-content') as HTMLElement;\r\n  content.innerHTML = '<div class=\"loading\">Loading...</div>';\r\n\r\n  try {\r\n    const categoryFilter = CATEGORIES.includes(currentFilter as typeof CATEGORIES[number])\r\n      ? currentFilter\r\n      : undefined;\r\n\r\n    const { facts: rawFacts, total } = await factsService.getAll({\r\n      search: currentSearch || undefined,\r\n      limit: 500,\r\n      category: categoryFilter,\r\n    });\r\n\r\n    // Client-side filter for verified/unverified (API may not support these params)\r\n    const facts =\r\n      currentFilter === 'verified' ? rawFacts.filter(f => f.verified) :\r\n        currentFilter === 'unverified' ? rawFacts.filter(f => !f.verified) :\r\n          rawFacts;\r\n\r\n    if (currentView === 'source') {\r\n      renderFactsBySource(content, facts, props);\r\n    } else {\r\n      renderFacts(content, facts, props);\r\n    }\r\n    updateCount(panel, facts.length);\r\n  } catch {\r\n    content.innerHTML = '<div class=\"error\">Failed to load facts</div>';\r\n  }\r\n  await refreshRemovedFactsSection(panel, props);\r\n}\r\n\r\n/**\r\n * Load and render the \"Removed facts\" section (for restore / undo). Syncs with graph/FalkorDB on restore.\r\n */\r\nasync function refreshRemovedFactsSection(panel: HTMLElement, props: FactsPanelProps): Promise<void> {\r\n  const container = panel.querySelector('#removed-facts-container') as HTMLElement;\r\n  if (!container) return;\r\n  try {\r\n    const deleted = await factsService.getDeletedFacts();\r\n    if (deleted.length === 0) {\r\n      container.classList.add('hidden');\r\n      container.innerHTML = '';\r\n      return;\r\n    }\r\n    container.classList.remove('hidden');\r\n    container.innerHTML = `\r\n      <div class=\"removed-facts-section\">\r\n        <div class=\"removed-facts-header section-header-sota\">\r\n          <h3>Removed facts</h3>\r\n          <span class=\"panel-count removed-count\">${deleted.length}</span>\r\n        </div>\r\n        <p class=\"removed-facts-hint\">Restore to undo a conflict resolution; fact will be synced back to the graph.</p>\r\n        <div class=\"removed-facts-list\">\r\n          ${deleted.map(f => `\r\n            <div class=\"removed-fact-item\" data-fact-id=\"${f.id}\">\r\n              <div class=\"removed-fact-content\">${escapeHtml(truncate(f.content ?? '', 100))}</div>\r\n              <button type=\"button\" class=\"btn btn-sm conflict-resolve-restore\">Restore</button>\r\n            </div>\r\n          `).join('')}\r\n        </div>\r\n      </div>\r\n    `;\r\n    container.querySelectorAll('.conflict-resolve-restore').forEach(btn => {\r\n      const item = (btn as HTMLElement).closest('.removed-fact-item');\r\n      const id = item?.getAttribute('data-fact-id');\r\n      if (id) {\r\n        on(btn as HTMLElement, 'click', async () => {\r\n          try {\r\n            await factsService.restoreFact(id);\r\n            toast.success('Fact restored');\r\n            await loadFacts(panel, props);\r\n            refreshRemovedFactsSection(panel, props);\r\n            const conflictsContainer = panel.querySelector('#conflicts-container') as HTMLElement;\r\n            if (conflictsContainer && !conflictsContainer.classList.contains('hidden')) {\r\n              await checkConflicts(conflictsContainer, panel, props);\r\n            }\r\n          } catch {\r\n            toast.error('Failed to restore fact');\r\n          }\r\n        });\r\n      }\r\n    });\r\n  } catch {\r\n    container.classList.add('hidden');\r\n    container.innerHTML = '';\r\n  }\r\n}\r\n\r\n/**\r\n * Render facts list\r\n */\r\nfunction renderFacts(container: HTMLElement, facts: Fact[], props: FactsPanelProps): void {\r\n  if (facts.length === 0) {\r\n    container.innerHTML = `\r\n      <div class=\"empty-state\">\r\n        <p>${currentSearch ? 'No facts match your search' : 'No facts found'}</p>\r\n        <button class=\"btn btn-primary\" id=\"empty-add-fact-btn\">Add Fact</button>\r\n      </div>\r\n    `;\r\n    const emptyAddBtn = container.querySelector('#empty-add-fact-btn');\r\n    if (emptyAddBtn) {\r\n      on(emptyAddBtn as HTMLElement, 'click', () => {\r\n        const panel = container.closest('.facts-panel') as HTMLElement;\r\n        if (panel) showAddFactModal(panel, props);\r\n      });\r\n    }\r\n    return;\r\n  }\r\n\r\n  // Group by category (same structure as Questions: question-group, group-header, group-items)\r\n  const factsByCategory: Record<string, Fact[]> = {};\r\n  facts.forEach(fact => {\r\n    const cat = fact.category || 'Uncategorized';\r\n    if (!factsByCategory[cat]) factsByCategory[cat] = [];\r\n    factsByCategory[cat].push(fact);\r\n  });\r\n  const categories = Object.keys(factsByCategory);\r\n\r\n  if (categories.length > 1) {\r\n    container.innerHTML = Object.entries(factsByCategory).map(([category, catFacts]) => `\r\n      <div class=\"question-group\">\r\n        <div class=\"group-header\">\r\n          <h3>${escapeHtml(category)}</h3>\r\n          <span class=\"group-count\">${catFacts.length}</span>\r\n        </div>\r\n        <div class=\"group-items\">\r\n          ${catFacts.map(fact => createFactCard(fact)).join('')}\r\n        </div>\r\n      </div>\r\n    `).join('');\r\n  } else {\r\n    container.innerHTML = facts.map(fact => createFactCard(fact)).join('');\r\n  }\r\n\r\n  // Bind click events (cards use .fact-card-sota, same click target)\r\n  container.querySelectorAll('.fact-card-sota').forEach(card => {\r\n    on(card as HTMLElement, 'click', () => {\r\n      const id = card.getAttribute('data-id');\r\n      const fact = facts.find(f => String(f.id) === id);\r\n      if (!fact) return;\r\n      if (props.useDetailView && props.containerElement) {\r\n        const containerEl = props.containerElement;\r\n        containerEl.innerHTML = '';\r\n        containerEl.appendChild(createFactDetailView(factDetailProps(containerEl, props, fact)));\r\n      } else if (props.onFactClick) {\r\n        props.onFactClick(fact);\r\n      } else {\r\n        import('../modals/FactModal').then(({ showFactModal }) => {\r\n          showFactModal({ mode: 'view', fact });\r\n        });\r\n      }\r\n    });\r\n\r\n    // Bind verify button\r\n    const verifyBtn = card.querySelector('.fact-verify-btn');\r\n    if (verifyBtn) {\r\n      on(verifyBtn as HTMLElement, 'click', async (e) => {\r\n        e.stopPropagation();\r\n        const id = card.getAttribute('data-id');\r\n        if (id) {\r\n          try {\r\n            await factsService.verify(id);\r\n            toast.success('Fact verified');\r\n            loadFacts(container.closest('.facts-panel') as HTMLElement, props);\r\n          } catch {\r\n            // Error handled by service\r\n          }\r\n        }\r\n      });\r\n    }\r\n  });\r\n}\r\n\r\n/**\r\n * Render facts grouped by source (same group structure as Questions)\r\n */\r\nfunction renderFactsBySource(container: HTMLElement, facts: Fact[], props: FactsPanelProps): void {\r\n  if (facts.length === 0) {\r\n    container.innerHTML = `\r\n      <div class=\"empty-state\">\r\n        <p>${currentSearch ? 'No facts match your search' : 'No facts found'}</p>\r\n        <button class=\"btn btn-primary\" id=\"empty-add-fact-btn\">Add Fact</button>\r\n      </div>\r\n    `;\r\n    const emptyAddBtn = container.querySelector('#empty-add-fact-btn');\r\n    if (emptyAddBtn) {\r\n      on(emptyAddBtn as HTMLElement, 'click', () => {\r\n        const panel = container.closest('.facts-panel') as HTMLElement;\r\n        if (panel) showAddFactModal(panel, props);\r\n      });\r\n    }\r\n    return;\r\n  }\r\n  const bySource: Record<string, Fact[]> = {};\r\n  facts.forEach(fact => {\r\n    const source = fact.source_file || fact.source || 'Unknown source';\r\n    if (!bySource[source]) bySource[source] = [];\r\n    bySource[source].push(fact);\r\n  });\r\n  container.innerHTML = Object.entries(bySource).map(([source, catFacts]) => `\r\n    <div class=\"question-group\">\r\n      <div class=\"group-header\">\r\n        <h3>${escapeHtml(source)}</h3>\r\n        <span class=\"group-count\">${catFacts.length}</span>\r\n      </div>\r\n      <div class=\"group-items\">\r\n        ${catFacts.map(fact => createFactCard(fact)).join('')}\r\n      </div>\r\n    </div>\r\n  `).join('');\r\n\r\n  container.querySelectorAll('.fact-card-sota').forEach(card => {\r\n    on(card as HTMLElement, 'click', () => {\r\n      const id = card.getAttribute('data-id');\r\n      const fact = facts.find(f => String(f.id) === id);\r\n      if (!fact) return;\r\n      if (props.useDetailView && props.containerElement) {\r\n        const containerEl = props.containerElement;\r\n        const detailView = createFactDetailView({\r\n          fact,\r\n          onClose: () => {\r\n            containerEl.innerHTML = '';\r\n            const newPanel = createFactsPanel(props);\r\n            containerEl.appendChild(newPanel);\r\n          },\r\n          onUpdate: () => {\r\n            containerEl.innerHTML = '';\r\n            const newPanel = createFactsPanel(props);\r\n            containerEl.appendChild(newPanel);\r\n          },\r\n        });\r\n        containerEl.innerHTML = '';\r\n        containerEl.appendChild(detailView);\r\n      } else if (props.onFactClick) {\r\n        props.onFactClick(fact);\r\n      } else {\r\n        import('../modals/FactModal').then(({ showFactModal }) => {\r\n          showFactModal({ mode: 'view', fact });\r\n        });\r\n      }\r\n    });\r\n    const verifyBtn = card.querySelector('.fact-verify-btn');\r\n    if (verifyBtn) {\r\n      on(verifyBtn as HTMLElement, 'click', async (e) => {\r\n        e.stopPropagation();\r\n        const id = card.getAttribute('data-id');\r\n        if (id) {\r\n          try {\r\n            await factsService.verify(id);\r\n            toast.success('Fact verified');\r\n            loadFacts(container.closest('.facts-panel') as HTMLElement, props);\r\n          } catch {\r\n            // Error handled by service\r\n          }\r\n        }\r\n      });\r\n    }\r\n  });\r\n}\r\n\r\n/** Category bar color (left edge) - align with question priority bar */\r\nconst CATEGORY_BAR_COLOR: Record<string, string> = {\r\n  technical: '#3b82f6',\r\n  process: '#8b5cf6',\r\n  policy: '#ec4899',\r\n  people: '#10b981',\r\n  timeline: '#f59e0b',\r\n  general: '#6b7280',\r\n};\r\n\r\n/**\r\n * Create fact card HTML - SOTA design aligned with question-card-sota\r\n */\r\nfunction createFactCard(fact: Fact): string {\r\n  const category = (fact.category || 'general').toLowerCase();\r\n  const categoryClass = category.replace(/\\s+/g, '-');\r\n  const barColor = CATEGORY_BAR_COLOR[category] || CATEGORY_BAR_COLOR.general;\r\n  const confidencePct = fact.confidence != null ? Math.round(fact.confidence * 100) : null;\r\n\r\n  return `\r\n    <div class=\"fact-card-sota question-card-sota ${fact.verified ? 'has-answer' : ''}\" data-id=\"${fact.id}\" style=\"--fact-category-bar: ${barColor}\">\r\n      <div class=\"card-priority-bar fact-category-bar\"></div>\r\n      <div class=\"card-body\">\r\n        <div class=\"card-top-row\">\r\n          <div class=\"card-badges\">\r\n            <span class=\"priority-pill fact-category-pill category-${categoryClass}\">${escapeHtml(fact.category || 'general')}</span>\r\n            ${confidencePct != null ? `<span class=\"status-pill status-pending\">${confidencePct}%</span>` : ''}\r\n            ${fact.verified ? '<span class=\"auto-pill\"> Verified</span>' : ''}\r\n          </div>\r\n          <span class=\"card-timestamp\">${formatRelativeTime(fact.created_at)}</span>\r\n        </div>\r\n        <div class=\"card-question-text\">${escapeHtml(fact.content)}</div>\r\n        <div class=\"card-bottom-row\">\r\n          <div class=\"card-requester\">\r\n            ${fact.source_file || fact.source ? `<span class=\"card-source-chip\">${escapeHtml((fact.source_file || fact.source || '').substring(0, 40))}${(fact.source_file || fact.source || '').length > 40 ? '' : ''}</span>` : '<span class=\"card-source-chip text-muted\">No source</span>'}\r\n          </div>\r\n          <div class=\"card-assignment\">\r\n            ${fact.verified ? '<span class=\"answered-badge\">Verified</span>' : '<button type=\"button\" class=\"btn-link fact-verify-btn\">Verify</button>'}\r\n          </div>\r\n        </div>\r\n      </div>\r\n    </div>\r\n  `;\r\n}\r\n\r\n/**\r\n * Check for conflicts\r\n */\r\nasync function checkConflicts(container: HTMLElement, panel: HTMLElement, props: FactsPanelProps): Promise<void> {\r\n  container.classList.remove('hidden');\r\n  container.innerHTML = '<div class=\"loading\">Checking for conflicts...</div>';\r\n\r\n  try {\r\n    const conflicts = await factsService.detectConflicts();\r\n\r\n    if (conflicts.length === 0) {\r\n      container.innerHTML = `\r\n        <div class=\"no-conflicts\">\r\n          <span class=\"success-icon\"></span>\r\n          <p>No conflicts detected</p>\r\n        </div>\r\n      `;\r\n      setTimeout(() => {\r\n        container.classList.add('hidden');\r\n      }, 3000);\r\n    } else {\r\n      renderConflicts(container, conflicts, panel, props);\r\n    }\r\n  } catch {\r\n    container.innerHTML = '<div class=\"error\">Failed to check conflicts</div>';\r\n  }\r\n}\r\n\r\n/**\r\n * Render conflicts  SOTA-style cards; each card has \"Keep left\" / \"Keep right\" to resolve.\r\n */\r\nfunction renderConflicts(container: HTMLElement, conflicts: FactConflict[], panel: HTMLElement, props: FactsPanelProps): void {\r\n  container.innerHTML = `\r\n    <div class=\"conflicts-section\">\r\n      <div class=\"conflicts-header section-header-sota\">\r\n        <h3>Conflicts Detected</h3>\r\n        <span class=\"conflicts-count panel-count\">${conflicts.length}</span>\r\n        <button type=\"button\" class=\"btn-icon close-conflicts\" title=\"Close\"></button>\r\n      </div>\r\n      <div class=\"conflicts-list question-group\">\r\n        ${conflicts.map((conflict, index) => createConflictCard(conflict, index)).join('')}\r\n      </div>\r\n    </div>\r\n  `;\r\n\r\n  const closeBtn = container.querySelector('.close-conflicts');\r\n  if (closeBtn) {\r\n    on(closeBtn as HTMLElement, 'click', () => {\r\n      container.classList.add('hidden');\r\n    });\r\n  }\r\n\r\n  conflicts.forEach((conflict, index) => {\r\n    const card = container.querySelector(`[data-conflict-index=\"${index}\"]`);\r\n    if (!card) return;\r\n    const keepLeftBtn = card.querySelector('.conflict-resolve-keep-left');\r\n    const keepRightBtn = card.querySelector('.conflict-resolve-keep-right');\r\n    if (keepLeftBtn) {\r\n      on(keepLeftBtn as HTMLElement, 'click', (e) => {\r\n        e.stopPropagation();\r\n        resolveConflict(conflict, 'left', panel, props, container);\r\n      });\r\n    }\r\n    if (keepRightBtn) {\r\n      on(keepRightBtn as HTMLElement, 'click', (e) => {\r\n        e.stopPropagation();\r\n        resolveConflict(conflict, 'right', panel, props, container);\r\n      });\r\n    }\r\n  });\r\n}\r\n\r\n/**\r\n * Resolve conflict: keep chosen fact, delete the other, refresh facts, re-run AI fact-check, optionally verify kept fact.\r\n */\r\nasync function resolveConflict(\r\n  conflict: FactConflict,\r\n  keep: 'left' | 'right',\r\n  panel: HTMLElement,\r\n  props: FactsPanelProps,\r\n  conflictsContainer: HTMLElement\r\n): Promise<void> {\r\n  const toDelete = keep === 'left' ? conflict.fact2 : conflict.fact1;\r\n  const toKeep = keep === 'left' ? conflict.fact1 : conflict.fact2;\r\n  if (!toDelete?.id) return;\r\n  try {\r\n    await factsService.deleteFact(toDelete.id);\r\n    toast.success(`Removed conflicting fact; kept: \"${truncate(toKeep?.content ?? '', 50)}\"`);\r\n    await loadFacts(panel, props);\r\n    // Re-run AI fact-check on remaining facts (automatic analysis)\r\n    try {\r\n      await factsService.runFactCheck();\r\n    } catch {\r\n      // Non-blocking\r\n    }\r\n    if (toKeep?.id) {\r\n      try {\r\n        await factsService.verifyFact(toKeep.id);\r\n      } catch {\r\n        // Non-blocking\r\n      }\r\n    }\r\n    await checkConflicts(conflictsContainer, panel, props);\r\n    const updated = await factsService.detectConflicts();\r\n    if (updated.length === 0) {\r\n      conflictsContainer.classList.add('hidden');\r\n      conflictsContainer.innerHTML = '';\r\n    } else {\r\n      renderConflicts(conflictsContainer, updated, panel, props);\r\n    }\r\n    refreshRemovedFactsSection(panel, props);\r\n  } catch {\r\n    toast.error('Failed to resolve conflict');\r\n  }\r\n}\r\n\r\n/**\r\n * Create a single conflict card  isolated layout (no fact-card-sota) + Keep left / Keep right.\r\n */\r\nfunction createConflictCard(conflict: FactConflict, index: number): string {\r\n  const type = (conflict.conflictType || 'contradiction').toLowerCase();\r\n  const desc = conflict.description || conflict.reason || 'Conflict detected';\r\n  const barClass = type === 'contradiction' ? 'conflict-bar-contradiction' : type === 'inconsistency' ? 'conflict-bar-inconsistency' : 'conflict-bar-process';\r\n\r\n  return `\r\n    <div class=\"conflict-card-sota\" data-conflict-index=\"${index}\">\r\n      <div class=\"conflict-type-bar ${barClass}\"></div>\r\n      <div class=\"conflict-card-body\">\r\n        <div class=\"conflict-card-top\">\r\n          <span class=\"conflict-type-pill conflict-type-${type}\">${escapeHtml(type)}</span>\r\n          ${conflict.confidence != null ? `<span class=\"conflict-confidence-pill\">${Math.round(conflict.confidence * 100)}%</span>` : ''}\r\n        </div>\r\n        <div class=\"conflict-facts-row\">\r\n          <div class=\"conflict-fact-cell\">\r\n            <div class=\"conflict-fact-snippet\">${escapeHtml(truncate(conflict.fact1?.content ?? '', 120))}</div>\r\n            <button type=\"button\" class=\"btn btn-sm conflict-resolve-keep-left\">Keep this</button>\r\n          </div>\r\n          <span class=\"conflict-vs\">vs</span>\r\n          <div class=\"conflict-fact-cell\">\r\n            <div class=\"conflict-fact-snippet\">${escapeHtml(truncate(conflict.fact2?.content ?? '', 120))}</div>\r\n            <button type=\"button\" class=\"btn btn-sm conflict-resolve-keep-right\">Keep this</button>\r\n          </div>\r\n        </div>\r\n        <div class=\"conflict-description-row\">\r\n          <div class=\"conflict-description\">${escapeHtml(desc)}</div>\r\n        </div>\r\n      </div>\r\n    </div>\r\n  `;\r\n}\r\n\r\nfunction truncate(s: string, max: number): string {\r\n  if (s.length <= max) return s;\r\n  return s.slice(0, max).trim() + '';\r\n}\r\n\r\n/**\r\n * Show add fact modal\r\n */\r\nasync function showAddFactModal(panel: HTMLElement, props: FactsPanelProps): Promise<void> {\r\n  // Dynamic import to avoid circular dependency\r\n  const { showFactModal } = await import('../modals/FactModal');\r\n  showFactModal({\r\n    mode: 'create',\r\n    onSave: () => loadFacts(panel, props),\r\n  });\r\n}\r\n\r\n/**\r\n * Update count badge\r\n */\r\nfunction updateCount(panel: HTMLElement, count: number): void {\r\n  const countEl = panel.querySelector('#facts-count');\r\n  if (countEl) {\r\n    countEl.textContent = String(count);\r\n  }\r\n}\r\n\r\n/**\r\n * Escape HTML\r\n */\r\nfunction escapeHtml(text: string): string {\r\n  const div = document.createElement('div');\r\n  div.textContent = text;\r\n  return div.innerHTML;\r\n}\r\n\r\nexport default createFactsPanel;\r\n","/**\r\n * Stats Card Widget\r\n * Displays a single statistic with icon and optional trend\r\n */\r\n\r\nimport { createElement, on } from '@lib/dom';\r\nimport { formatNumber } from '@lib/format';\r\n\r\nexport interface StatsCardProps {\r\n  id: string;\r\n  label: string;\r\n  value: number | string;\r\n  icon?: string;\r\n  subValue?: string;\r\n  trend?: {\r\n    direction: 'up' | 'down' | 'stable';\r\n    value: number;\r\n    sentiment: 'positive' | 'negative' | 'neutral';\r\n  };\r\n  color?: string;\r\n  onClick?: () => void;\r\n}\r\n\r\n/**\r\n * Create stats card element\r\n */\r\nexport function createStatsCard(props: StatsCardProps): HTMLElement {\r\n  const card = createElement('div', {\r\n    className: `stats-card ${props.onClick ? 'clickable' : ''} ${props.color ? `color-${props.color}` : ''}`,\r\n  });\r\n  card.setAttribute('data-stat-id', props.id);\r\n\r\n  const trendHtml = props.trend ? `\r\n    <div class=\"stat-trend ${props.trend.direction} ${props.trend.sentiment}\">\r\n      <span class=\"trend-arrow\">${getTrendArrow(props.trend.direction)}</span>\r\n      <span class=\"trend-value\">${props.trend.value}%</span>\r\n    </div>\r\n  ` : '';\r\n\r\n  card.innerHTML = `\r\n    ${props.icon ? `<div class=\"stat-icon\">${props.icon}</div>` : ''}\r\n    <div class=\"stat-value\">${typeof props.value === 'number' ? formatNumber(props.value) : props.value}</div>\r\n    <div class=\"stat-label\">${props.label}</div>\r\n    ${props.subValue ? `<div class=\"stat-sub\">${props.subValue}</div>` : ''}\r\n    ${trendHtml}\r\n  `;\r\n\r\n  if (props.onClick) {\r\n    on(card, 'click', props.onClick);\r\n  }\r\n\r\n  return card;\r\n}\r\n\r\n/**\r\n * Get trend arrow character\r\n */\r\nfunction getTrendArrow(direction: 'up' | 'down' | 'stable'): string {\r\n  switch (direction) {\r\n    case 'up': return '';\r\n    case 'down': return '';\r\n    case 'stable': return '';\r\n  }\r\n}\r\n\r\n/**\r\n * Update stats card value\r\n */\r\nexport function updateStatsCard(card: HTMLElement, value: number | string, subValue?: string): void {\r\n  const valueEl = card.querySelector('.stat-value');\r\n  const subEl = card.querySelector('.stat-sub');\r\n\r\n  if (valueEl) {\r\n    valueEl.textContent = typeof value === 'number' ? formatNumber(value) : value;\r\n  }\r\n\r\n  if (subEl && subValue !== undefined) {\r\n    subEl.textContent = subValue;\r\n  }\r\n}\r\n\r\n/**\r\n * Create stats grid with multiple cards\r\n */\r\nexport function createStatsGrid(stats: StatsCardProps[]): HTMLElement {\r\n  const grid = createElement('div', { className: 'stats-grid' });\r\n\r\n  stats.forEach(stat => {\r\n    const card = createStatsCard(stat);\r\n    grid.appendChild(card);\r\n  });\r\n\r\n  return grid;\r\n}\r\n\r\nexport default createStatsCard;\r\n","/**\r\n * Health Indicator Widget\r\n * Displays project health score with gauge and factors\r\n */\r\n\r\nimport { createElement } from '@lib/dom';\r\nimport { HealthData } from '@services/dashboard';\r\n\r\nexport interface HealthIndicatorProps {\r\n  health: HealthData;\r\n  showFactors?: boolean;\r\n  size?: 'sm' | 'md' | 'lg';\r\n}\r\n\r\n/**\r\n * Create health indicator element\r\n */\r\nexport function createHealthIndicator(props: HealthIndicatorProps): HTMLElement {\r\n  const { health, showFactors = true, size = 'md' } = props;\r\n  const statusClass = health.status.toLowerCase().replace(/\\s+/g, '-');\r\n\r\n  const indicator = createElement('div', {\r\n    className: `health-indicator ${statusClass} size-${size}`,\r\n  });\r\n\r\n  indicator.innerHTML = `\r\n    <div class=\"health-gauge\">\r\n      <svg class=\"gauge-svg\" viewBox=\"0 0 100 50\">\r\n        <path class=\"gauge-bg\" d=\"M 10 50 A 40 40 0 0 1 90 50\" />\r\n        <path class=\"gauge-fill\" d=\"M 10 50 A 40 40 0 0 1 90 50\" \r\n              style=\"stroke-dasharray: ${(health.score / 100) * 126} 126; stroke: ${health.color};\" />\r\n      </svg>\r\n      <div class=\"gauge-center\">\r\n        <span class=\"score-value\">${health.score}</span>\r\n        <span class=\"score-label\">Health</span>\r\n      </div>\r\n    </div>\r\n    <div class=\"health-status\" style=\"--health-status-color: ${health.color}\">${health.status}</div>\r\n    ${showFactors && health.factors.length > 0 ? `\r\n      <div class=\"health-factors\">\r\n        ${health.factors.slice(0, 4).map(f => `\r\n          <div class=\"factor ${f.type}\">\r\n            <span class=\"factor-icon\">${f.type === 'positive' ? '' : '!'}</span>\r\n            <span class=\"factor-text\">${f.factor}</span>\r\n          </div>\r\n        `).join('')}\r\n      </div>\r\n    ` : ''}\r\n  `;\r\n\r\n  return indicator;\r\n}\r\n\r\n/**\r\n * Create mini health badge (for header/compact views)\r\n */\r\nexport function createHealthBadge(score: number, status: string, color: string): HTMLElement {\r\n  const badge = createElement('div', { className: 'health-badge' });\r\n\r\n  badge.innerHTML = `\r\n    <span class=\"badge-score\" style=\"--badge-bg: ${color}\">${score}</span>\r\n    <span class=\"badge-status\">${status}</span>\r\n  `;\r\n\r\n  return badge;\r\n}\r\n\r\n/**\r\n * Get health color based on score\r\n */\r\nexport function getHealthColor(score: number): string {\r\n  if (score >= 80) return 'var(--color-success-500)'; // green\r\n  if (score >= 60) return 'var(--color-success-500)'; // lime\r\n  if (score >= 40) return 'var(--color-warning-500)'; // yellow\r\n  if (score >= 20) return 'var(--color-warning-600)'; // orange\r\n  return 'var(--color-danger-500)'; // red\r\n}\r\n\r\n/**\r\n * Get health status based on score\r\n */\r\nexport function getHealthStatus(score: number): string {\r\n  if (score >= 80) return 'Healthy';\r\n  if (score >= 60) return 'Good';\r\n  if (score >= 40) return 'Needs Attention';\r\n  if (score >= 20) return 'At Risk';\r\n  return 'Critical';\r\n}\r\n\r\nexport default createHealthIndicator;\r\n","/**\r\n * Trend Chart Widget\r\n * Displays trends over time using Chart.js\r\n */\r\n\r\nimport { createElement } from '@lib/dom';\r\nimport { TrendHistory } from '@services/dashboard';\r\n\r\nexport interface TrendChartProps {\r\n  data: TrendHistory[];\r\n  metrics?: ('facts' | 'questions' | 'risks' | 'actions' | 'decisions')[];\r\n  height?: number;\r\n}\r\n\r\n// Color palette for metrics\r\nconst METRIC_COLORS: Record<string, { line: string; fill: string }> = {\r\n  facts: { line: 'var(--color-info-500)', fill: 'color-mix(in srgb, var(--color-info-500), transparent 90%)' },\r\n  questions: { line: 'var(--color-warning-500)', fill: 'color-mix(in srgb, var(--color-warning-500), transparent 90%)' },\r\n  risks: { line: 'var(--color-danger-500)', fill: 'color-mix(in srgb, var(--color-danger-500), transparent 90%)' },\r\n  actions: { line: 'var(--color-success-500)', fill: 'color-mix(in srgb, var(--color-success-500), transparent 90%)' },\r\n  decisions: { line: 'var(--color-accent-500)', fill: 'color-mix(in srgb, var(--color-accent-500), transparent 90%)' },\r\n};\r\n\r\n/**\r\n * Create trend chart element\r\n */\r\nexport function createTrendChart(props: TrendChartProps): HTMLElement {\r\n  const { data, metrics = ['facts', 'questions', 'risks'], height = 200 } = props;\r\n\r\n  const container = createElement('div', { className: 'trend-chart-container' });\r\n  container.style.height = `${height}px`;\r\n\r\n  if (data.length === 0) {\r\n    container.innerHTML = '<div class=\"empty-chart\">No trend data available</div>';\r\n    return container;\r\n  }\r\n\r\n  // Create canvas for Chart.js\r\n  const canvas = createElement('canvas', { id: `trend-chart-${Date.now()}` }) as HTMLCanvasElement;\r\n  container.appendChild(canvas);\r\n\r\n  // Initialize chart (requires Chart.js to be loaded)\r\n  initChart(canvas, data, metrics);\r\n\r\n  return container;\r\n}\r\n\r\n/**\r\n * Initialize Chart.js chart\r\n */\r\nfunction initChart(\r\n  canvas: HTMLCanvasElement,\r\n  data: TrendHistory[],\r\n  metrics: string[]\r\n): void {\r\n  // Check if Chart.js is available\r\n  if (typeof (window as unknown as { Chart?: unknown }).Chart === 'undefined') {\r\n    console.warn('Chart.js not loaded, using fallback');\r\n    renderFallbackChart(canvas.parentElement as HTMLElement, data, metrics);\r\n    return;\r\n  }\r\n\r\n  const Chart = (window as unknown as { Chart: typeof import('chart.js').Chart }).Chart;\r\n\r\n  const labels = data.map(d => formatDate(d.date));\r\n  const datasets = metrics.map(metric => ({\r\n    label: capitalize(metric),\r\n    data: data.map(d => (d as Record<string, number>)[metric] || 0),\r\n    borderColor: METRIC_COLORS[metric]?.line || '#6366f1',\r\n    backgroundColor: METRIC_COLORS[metric]?.fill || 'rgba(99, 102, 241, 0.1)',\r\n    fill: true,\r\n    tension: 0.3,\r\n  }));\r\n\r\n  new Chart(canvas, {\r\n    type: 'line',\r\n    data: { labels, datasets },\r\n    options: {\r\n      responsive: true,\r\n      maintainAspectRatio: false,\r\n      plugins: {\r\n        legend: {\r\n          position: 'bottom',\r\n        },\r\n      },\r\n      scales: {\r\n        y: {\r\n          beginAtZero: true,\r\n        },\r\n      },\r\n    },\r\n  });\r\n}\r\n\r\n/**\r\n * Render fallback chart (pure CSS/HTML)\r\n */\r\nfunction renderFallbackChart(container: HTMLElement, data: TrendHistory[], metrics: string[]): void {\r\n  const maxValue = Math.max(\r\n    ...data.flatMap(d => metrics.map(m => (d as Record<string, number>)[m] || 0))\r\n  );\r\n\r\n  container.innerHTML = `\r\n    <div class=\"fallback-chart\">\r\n      <div class=\"chart-legend\">\r\n        ${metrics.map(m => `\r\n          <span class=\"legend-item\">\r\n            <span class=\"legend-color\" style=\"--legend-color: ${METRIC_COLORS[m]?.line || '#6366f1'}\"></span>\r\n            ${capitalize(m)}\r\n          </span>\r\n        `).join('')}\r\n      </div>\r\n      <div class=\"chart-bars\">\r\n        ${data.slice(-7).map(d => `\r\n          <div class=\"bar-group\">\r\n            ${metrics.map(m => {\r\n    const value = (d as Record<string, number>)[m] || 0;\r\n    const height = maxValue > 0 ? (value / maxValue) * 100 : 0;\r\n    return `<div class=\"bar\" style=\"--bar-height: ${height}; --bar-color: ${METRIC_COLORS[m]?.line || '#6366f1'}\" title=\"${capitalize(m)}: ${value}\"></div>`;\r\n  }).join('')}\r\n            <div class=\"bar-label\">${formatDate(d.date)}</div>\r\n          </div>\r\n        `).join('')}\r\n      </div>\r\n    </div>\r\n  `;\r\n}\r\n\r\n/**\r\n * Format date for display\r\n */\r\nfunction formatDate(dateStr: string): string {\r\n  const date = new Date(dateStr);\r\n  return date.toLocaleDateString(undefined, { month: 'short', day: 'numeric' });\r\n}\r\n\r\n/**\r\n * Capitalize first letter\r\n */\r\nfunction capitalize(str: string): string {\r\n  return str.charAt(0).toUpperCase() + str.slice(1);\r\n}\r\n\r\nexport default createTrendChart;\r\n","/**\r\n * Risk Matrix Widget\r\n * 5x4 matrix showing risks by impact and likelihood\r\n */\r\n\r\nimport { createElement, on } from '@lib/dom';\r\nimport { Risk, risksService } from '@services/risks';\r\n\r\nexport interface RiskMatrixProps {\r\n  risks: Risk[];\r\n  onCellClick?: (risks: Risk[], impact: string, likelihood: string) => void;\r\n  size?: 'sm' | 'md' | 'lg';\r\n}\r\n\r\nconst IMPACTS = ['critical', 'high', 'medium', 'low'];\r\nconst LIKELIHOODS = ['high', 'medium', 'low'];\r\n\r\n// Cell colors based on risk level\r\nconst CELL_COLORS: Record<string, string> = {\r\n  'critical-high': 'var(--color-danger-700)',\r\n  'critical-medium': 'var(--color-danger-600)',\r\n  'critical-low': 'var(--color-danger-500)',\r\n  'high-high': 'var(--color-danger-500)',\r\n  'high-medium': 'var(--color-warning-600)',\r\n  'high-low': 'var(--color-warning-500)',\r\n  'medium-high': 'var(--color-warning-600)',\r\n  'medium-medium': 'var(--color-warning-500)',\r\n  'medium-low': 'var(--color-warning-100)',\r\n  'low-high': 'var(--color-warning-500)',\r\n  'low-medium': 'var(--color-success-500)',\r\n  'low-low': 'var(--color-success-600)',\r\n};\r\n\r\n/**\r\n * Create risk matrix element\r\n */\r\nexport function createRiskMatrix(props: RiskMatrixProps): HTMLElement {\r\n  const { risks, onCellClick, size = 'md' } = props;\r\n\r\n  const matrix = createElement('div', { className: `risk-matrix size-${size}` });\r\n\r\n  // Group risks by cell\r\n  const grouped = groupRisksByCell(risks);\r\n\r\n  matrix.innerHTML = `\r\n    <div class=\"matrix-container\">\r\n      <div class=\"matrix-y-label\">Impact</div>\r\n      <div class=\"matrix-grid\">\r\n        <div class=\"matrix-header\">\r\n          <div class=\"matrix-corner\"></div>\r\n          ${LIKELIHOODS.map(l => `<div class=\"matrix-col-header\">${capitalize(l)}</div>`).join('')}\r\n        </div>\r\n        ${IMPACTS.map(impact => `\r\n          <div class=\"matrix-row\">\r\n            <div class=\"matrix-row-header\">${capitalize(impact)}</div>\r\n            ${LIKELIHOODS.map(likelihood => {\r\n    const key = `${impact}-${likelihood}`;\r\n    const cellRisks = grouped[key] || [];\r\n    const color = CELL_COLORS[key] || '#e5e7eb';\r\n    const count = cellRisks.length;\r\n    return `\r\n                <div class=\"matrix-cell ${count > 0 ? 'has-risks' : ''}\" \r\n                     data-impact=\"${impact}\" \r\n                     data-likelihood=\"${likelihood}\"\r\n                     style=\"background-color: ${count > 0 ? color : 'var(--color-surface-hover)'}\">\r\n                  ${count > 0 ? `<span class=\"cell-count\">${count}</span>` : ''}\r\n                </div>\r\n              `;\r\n  }).join('')}\r\n          </div>\r\n        `).join('')}\r\n      </div>\r\n      <div class=\"matrix-x-label\">Likelihood</div>\r\n    </div>\r\n    <div class=\"matrix-legend\">\r\n      <span class=\"legend-item\"><span class=\"legend-color risk-legend-low\"></span> Low</span>\r\n      <span class=\"legend-item\"><span class=\"legend-color risk-legend-medium\"></span> Medium</span>\r\n      <span class=\"legend-item\"><span class=\"legend-color risk-legend-high\"></span> High</span>\r\n      <span class=\"legend-item\"><span class=\"legend-color risk-legend-critical\"></span> Critical</span>\r\n    </div>\r\n  `;\r\n\r\n  // Bind cell click events\r\n  if (onCellClick) {\r\n    matrix.querySelectorAll('.matrix-cell.has-risks').forEach(cell => {\r\n      on(cell as HTMLElement, 'click', () => {\r\n        const impact = cell.getAttribute('data-impact') || '';\r\n        const likelihood = cell.getAttribute('data-likelihood') || '';\r\n        const key = `${impact}-${likelihood}`;\r\n        const cellRisks = grouped[key] || [];\r\n        onCellClick(cellRisks, impact, likelihood);\r\n      });\r\n    });\r\n  }\r\n\r\n  return matrix;\r\n}\r\n\r\n/**\r\n * Group risks by matrix cell\r\n */\r\nfunction groupRisksByCell(risks: Risk[]): Record<string, Risk[]> {\r\n  const grouped: Record<string, Risk[]> = {};\r\n\r\n  risks\r\n    .filter(r => r.status !== 'mitigated' && r.status !== 'closed')\r\n    .forEach(risk => {\r\n      const key = `${risk.impact}-${risk.likelihood}`;\r\n      if (!grouped[key]) grouped[key] = [];\r\n      grouped[key].push(risk);\r\n    });\r\n\r\n  return grouped;\r\n}\r\n\r\n/**\r\n * Capitalize first letter\r\n */\r\nfunction capitalize(str: string): string {\r\n  return str.charAt(0).toUpperCase() + str.slice(1);\r\n}\r\n\r\n/**\r\n * Create compact risk summary (for dashboard)\r\n */\r\nexport function createRiskSummary(risks: Risk[]): HTMLElement {\r\n  const summary = createElement('div', { className: 'risk-summary' });\r\n\r\n  const bySeverity = {\r\n    critical: risks.filter(r => r.impact === 'critical' && r.status === 'open').length,\r\n    high: risks.filter(r => r.impact === 'high' && r.status === 'open').length,\r\n    medium: risks.filter(r => r.impact === 'medium' && r.status === 'open').length,\r\n    low: risks.filter(r => r.impact === 'low' && r.status === 'open').length,\r\n  };\r\n\r\n  summary.innerHTML = `\r\n    <div class=\"summary-bars\">\r\n      ${Object.entries(bySeverity).map(([level, count]) => `\r\n        <div class=\"summary-bar\">\r\n          <span class=\"bar-label\">${capitalize(level)}</span>\r\n          <div class=\"bar-track\">\r\n            <div class=\"bar-fill impact-${level}\" style=\"--bar-width: ${Math.min(count * 20, 100)}\"></div>\r\n          </div>\r\n          <span class=\"bar-count\">${count}</span>\r\n        </div>\r\n      `).join('')}\r\n    </div>\r\n  `;\r\n\r\n  return summary;\r\n}\r\n\r\nexport default createRiskMatrix;\r\n","/**\r\n * File Uploader Component\r\n * Drag-and-drop file upload with progress and file list\r\n */\r\n\r\nimport { createElement, on } from '@lib/dom';\r\nimport { documentsService, UploadResult, ProcessingStatus } from '@services/documents';\r\nimport { toast } from '@services/toast';\r\nimport { formatFileSize } from '@lib/format';\r\n\r\nexport interface FileUploaderProps {\r\n  onUploadComplete?: (result: UploadResult) => void;\r\n  onProcessingStart?: () => void;\r\n  allowedTypes?: string[];\r\n  maxFileSize?: number; // in bytes\r\n  multiple?: boolean;\r\n}\r\n\r\ninterface QueuedFile {\r\n  file: File;\r\n  id: string;\r\n  progress: number;\r\n  status: 'pending' | 'uploading' | 'complete' | 'error';\r\n  error?: string;\r\n}\r\n\r\nlet fileQueue: QueuedFile[] = [];\r\nlet isProcessing = false;\r\n\r\n/**\r\n * Create file uploader component\r\n */\r\nexport function createFileUploader(props: FileUploaderProps = {}): HTMLElement {\r\n  const { allowedTypes, maxFileSize = 50 * 1024 * 1024, multiple = true } = props;\r\n\r\n  const uploader = createElement('div', { className: 'file-uploader' });\r\n\r\n  uploader.innerHTML = `\r\n    <div class=\"dropzone\" id=\"dropzone\">\r\n      <div class=\"dropzone-content\">\r\n        <div class=\"dropzone-icon\"></div>\r\n        <div class=\"dropzone-text\">\r\n          <p>Drag & drop files here</p>\r\n          <p class=\"dropzone-subtext\">or click to browse</p>\r\n        </div>\r\n        <input type=\"file\" id=\"file-input\" ${multiple ? 'multiple' : ''} \r\n               ${allowedTypes ? `accept=\"${allowedTypes.join(',')}\"` : ''} hidden>\r\n      </div>\r\n    </div>\r\n    <div class=\"file-queue hidden\" id=\"file-queue\"></div>\r\n    <div class=\"upload-actions hidden\" id=\"upload-actions\">\r\n      <button class=\"btn btn-secondary\" id=\"clear-queue-btn\">Clear</button>\r\n      <button class=\"btn btn-primary\" id=\"upload-btn\">Upload Files</button>\r\n    </div>\r\n    <div class=\"processing-status hidden\" id=\"processing-status\"></div>\r\n  `;\r\n\r\n  const dropzone = uploader.querySelector('#dropzone') as HTMLElement;\r\n  const fileInput = uploader.querySelector('#file-input') as HTMLInputElement;\r\n  const queueContainer = uploader.querySelector('#file-queue') as HTMLElement;\r\n  const actionsContainer = uploader.querySelector('#upload-actions') as HTMLElement;\r\n  const statusContainer = uploader.querySelector('#processing-status') as HTMLElement;\r\n\r\n  // Click to browse\r\n  on(dropzone, 'click', () => fileInput.click());\r\n\r\n  // File input change\r\n  on(fileInput, 'change', () => {\r\n    if (fileInput.files) {\r\n      addFilesToQueue(Array.from(fileInput.files), maxFileSize);\r\n      updateQueueUI(queueContainer, actionsContainer);\r\n    }\r\n    fileInput.value = ''; // Reset for same file selection\r\n  });\r\n\r\n  // Drag events\r\n  on(dropzone, 'dragover', (e) => {\r\n    e.preventDefault();\r\n    dropzone.classList.add('dragover');\r\n  });\r\n\r\n  on(dropzone, 'dragleave', () => {\r\n    dropzone.classList.remove('dragover');\r\n  });\r\n\r\n  on(dropzone, 'drop', (e) => {\r\n    e.preventDefault();\r\n    dropzone.classList.remove('dragover');\r\n    const files = Array.from(e.dataTransfer?.files || []);\r\n    if (files.length > 0) {\r\n      addFilesToQueue(files, maxFileSize);\r\n      updateQueueUI(queueContainer, actionsContainer);\r\n    }\r\n  });\r\n\r\n  // Clear queue\r\n  const clearBtn = uploader.querySelector('#clear-queue-btn');\r\n  if (clearBtn) {\r\n    on(clearBtn as HTMLElement, 'click', () => {\r\n      fileQueue = [];\r\n      updateQueueUI(queueContainer, actionsContainer);\r\n    });\r\n  }\r\n\r\n  // Upload button\r\n  const uploadBtn = uploader.querySelector('#upload-btn');\r\n  if (uploadBtn) {\r\n    on(uploadBtn as HTMLElement, 'click', async () => {\r\n      await uploadFiles(queueContainer, actionsContainer, statusContainer, props);\r\n    });\r\n  }\r\n\r\n  // Check processing status on mount\r\n  checkProcessingStatus(statusContainer);\r\n\r\n  return uploader;\r\n}\r\n\r\n/**\r\n * Add files to queue\r\n */\r\nfunction addFilesToQueue(files: File[], maxSize: number): void {\r\n  files.forEach(file => {\r\n    // Check size\r\n    if (file.size > maxSize) {\r\n      toast.warning(`${file.name} is too large (max ${formatFileSize(maxSize)})`);\r\n      return;\r\n    }\r\n\r\n    // Check if already in queue\r\n    if (fileQueue.some(f => f.file.name === file.name && f.file.size === file.size)) {\r\n      return;\r\n    }\r\n\r\n    fileQueue.push({\r\n      file,\r\n      id: `file-${Date.now()}-${Math.random().toString(36).substr(2, 9)}`,\r\n      progress: 0,\r\n      status: 'pending',\r\n    });\r\n  });\r\n}\r\n\r\n/**\r\n * Update queue UI\r\n */\r\nfunction updateQueueUI(container: HTMLElement, actionsContainer: HTMLElement): void {\r\n  if (fileQueue.length === 0) {\r\n    container.classList.add('hidden');\r\n    actionsContainer.classList.add('hidden');\r\n    return;\r\n  }\r\n\r\n  container.classList.remove('hidden');\r\n  actionsContainer.classList.remove('hidden');\r\n\r\n  container.innerHTML = fileQueue.map(qf => `\r\n    <div class=\"queued-file ${qf.status}\" data-id=\"${qf.id}\">\r\n      <div class=\"file-info\">\r\n        <span class=\"file-icon\">${getFileIcon(qf.file.type)}</span>\r\n        <span class=\"file-name\">${escapeHtml(qf.file.name)}</span>\r\n        <span class=\"file-size\">${formatFileSize(qf.file.size)}</span>\r\n      </div>\r\n      <div class=\"file-status\">\r\n        ${qf.status === 'uploading' ? `\r\n          <div class=\"progress-bar\">\r\n            <div class=\"progress-fill\" style=\"--progress: ${qf.progress}\"></div>\r\n          </div>\r\n          <span class=\"progress-text\">${qf.progress}%</span>\r\n        ` : qf.status === 'complete' ? `\r\n          <span class=\"status-icon success\"></span>\r\n        ` : qf.status === 'error' ? `\r\n          <span class=\"status-icon error\"></span>\r\n          <span class=\"error-text\">${escapeHtml(qf.error || 'Error')}</span>\r\n        ` : `\r\n          <button class=\"btn-icon remove-file\" data-id=\"${qf.id}\"></button>\r\n        `}\r\n      </div>\r\n    </div>\r\n  `).join('');\r\n\r\n  // Bind remove buttons\r\n  container.querySelectorAll('.remove-file').forEach(btn => {\r\n    on(btn as HTMLElement, 'click', (e) => {\r\n      e.stopPropagation();\r\n      const id = btn.getAttribute('data-id');\r\n      fileQueue = fileQueue.filter(f => f.id !== id);\r\n      updateQueueUI(container, actionsContainer);\r\n    });\r\n  });\r\n}\r\n\r\n/**\r\n * Upload files\r\n */\r\nasync function uploadFiles(\r\n  queueContainer: HTMLElement,\r\n  actionsContainer: HTMLElement,\r\n  statusContainer: HTMLElement,\r\n  props: FileUploaderProps\r\n): Promise<void> {\r\n  const pendingFiles = fileQueue.filter(f => f.status === 'pending');\r\n  if (pendingFiles.length === 0) return;\r\n\r\n  // Disable buttons during upload\r\n  const uploadBtn = actionsContainer.querySelector('#upload-btn') as HTMLButtonElement;\r\n  if (uploadBtn) uploadBtn.disabled = true;\r\n\r\n  try {\r\n    // Mark all as uploading\r\n    pendingFiles.forEach(f => {\r\n      f.status = 'uploading';\r\n      f.progress = 0;\r\n    });\r\n    updateQueueUI(queueContainer, actionsContainer);\r\n\r\n    // Upload files\r\n    const result = await documentsService.upload(\r\n      pendingFiles.map(f => f.file),\r\n      (progress) => {\r\n        pendingFiles.forEach(f => {\r\n          f.progress = progress;\r\n        });\r\n        updateQueueUI(queueContainer, actionsContainer);\r\n      }\r\n    );\r\n\r\n    // Mark as complete\r\n    pendingFiles.forEach(f => {\r\n      f.status = 'complete';\r\n      f.progress = 100;\r\n    });\r\n    updateQueueUI(queueContainer, actionsContainer);\r\n\r\n    toast.success(`Uploaded ${result.files.length} file(s)`);\r\n    props.onUploadComplete?.(result);\r\n\r\n    // Clear completed after delay\r\n    setTimeout(() => {\r\n      fileQueue = fileQueue.filter(f => f.status !== 'complete');\r\n      updateQueueUI(queueContainer, actionsContainer);\r\n    }, 2000);\r\n\r\n    // Check if processing started\r\n    if (result.processingStarted) {\r\n      props.onProcessingStart?.();\r\n      pollProcessingStatus(statusContainer);\r\n    }\r\n  } catch (error) {\r\n    pendingFiles.forEach(f => {\r\n      f.status = 'error';\r\n      f.error = error instanceof Error ? error.message : 'Upload failed';\r\n    });\r\n    updateQueueUI(queueContainer, actionsContainer);\r\n  } finally {\r\n    if (uploadBtn) uploadBtn.disabled = false;\r\n  }\r\n}\r\n\r\n/**\r\n * Check processing status\r\n */\r\nasync function checkProcessingStatus(container: HTMLElement): Promise<void> {\r\n  try {\r\n    const status = await documentsService.getProcessingStatus();\r\n    if (status.isProcessing || status.queueLength > 0) {\r\n      renderProcessingStatus(container, status);\r\n      pollProcessingStatus(container);\r\n    }\r\n  } catch {\r\n    // Ignore errors\r\n  }\r\n}\r\n\r\n/**\r\n * Poll processing status\r\n */\r\nlet pollingInterval: number | null = null;\r\n\r\nfunction pollProcessingStatus(container: HTMLElement): void {\r\n  if (pollingInterval) return;\r\n\r\n  pollingInterval = window.setInterval(async () => {\r\n    try {\r\n      const status = await documentsService.getProcessingStatus();\r\n      renderProcessingStatus(container, status);\r\n\r\n      if (!status.isProcessing && status.queueLength === 0) {\r\n        if (pollingInterval) {\r\n          clearInterval(pollingInterval);\r\n          pollingInterval = null;\r\n        }\r\n        setTimeout(() => container.classList.add('hidden'), 3000);\r\n      }\r\n    } catch {\r\n      if (pollingInterval) {\r\n        clearInterval(pollingInterval);\r\n        pollingInterval = null;\r\n      }\r\n    }\r\n  }, 2000);\r\n}\r\n\r\n/**\r\n * Render processing status\r\n */\r\nfunction renderProcessingStatus(container: HTMLElement, status: ProcessingStatus): void {\r\n  container.classList.remove('hidden');\r\n\r\n  container.innerHTML = `\r\n    <div class=\"processing-header\">\r\n      <span class=\"processing-icon\">${status.isProcessing ? '' : ''}</span>\r\n      <span class=\"processing-title\">${status.isProcessing ? 'Processing...' : 'Complete'}</span>\r\n    </div>\r\n    <div class=\"processing-stats\">\r\n      <span>Completed: ${status.completedCount}</span>\r\n      <span>Pending: ${status.queueLength}</span>\r\n      ${status.errorCount > 0 ? `<span class=\"error\">Errors: ${status.errorCount}</span>` : ''}\r\n    </div>\r\n    ${status.processingFile ? `<div class=\"current-file\">Current: ${escapeHtml(status.processingFile)}</div>` : ''}\r\n    ${status.isProcessing ? `\r\n      <div class=\"processing-progress\">\r\n        <div class=\"progress-bar\">\r\n          <div class=\"progress-fill\" style=\"--progress: ${(status.completedCount / (status.completedCount + status.queueLength + 1)) * 100}\"></div>\r\n        </div>\r\n      </div>\r\n    ` : ''}\r\n  `;\r\n}\r\n\r\n/**\r\n * Get file icon based on type\r\n */\r\nfunction getFileIcon(mimeType: string): string {\r\n  if (mimeType.startsWith('image/')) return '';\r\n  if (mimeType.startsWith('video/')) return '';\r\n  if (mimeType.startsWith('audio/')) return '';\r\n  if (mimeType === 'application/pdf') return '';\r\n  if (mimeType.includes('spreadsheet') || mimeType.includes('excel')) return '';\r\n  if (mimeType.includes('document') || mimeType.includes('word')) return '';\r\n  if (mimeType.includes('presentation') || mimeType.includes('powerpoint')) return '';\r\n  if (mimeType.includes('text')) return '';\r\n  return '';\r\n}\r\n\r\n/**\r\n * Escape HTML\r\n */\r\nfunction escapeHtml(text: string): string {\r\n  const div = document.createElement('div');\r\n  div.textContent = text;\r\n  return div.innerHTML;\r\n}\r\n\r\nexport default createFileUploader;\r\n","/**\n * Knowledge Graph Component\n * Interactive graph visualization using vis-network\n */\n\nimport { createElement, on } from '@lib/dom';\nimport { graphService, GraphNode, GraphEdge, GraphStats } from '@services/graph';\nimport { toast } from '@services/toast';\n\nexport interface KnowledgeGraphProps {\n  onNodeClick?: (node: GraphNode) => void;\n  onEdgeClick?: (edge: GraphEdge) => void;\n  height?: number;\n}\n\ninterface VisNetwork {\n  setData: (data: { nodes: unknown[]; edges: unknown[] }) => void;\n  on: (event: string, callback: (params: unknown) => void) => void;\n  fit: () => void;\n  focus: (nodeId: string, options?: { scale?: number }) => void;\n  destroy: () => void;\n}\n\ndeclare global {\n  interface Window {\n    vis?: {\n      Network: new (container: HTMLElement, data: unknown, options: unknown) => VisNetwork;\n      DataSet: new (data: unknown[]) => unknown;\n    };\n  }\n}\n\nconst NODE_COLORS: Record<string, string> = {\n  Person: '#6366f1',\n  Document: '#22c55e',\n  Question: '#f59e0b',\n  Risk: '#ef4444',\n  Action: '#8b5cf6',\n  Decision: '#06b6d4',\n  Fact: '#84cc16',\n  Email: '#ec4899',\n  default: '#9ca3af',\n};\n\n/**\n * Create knowledge graph component\n */\nexport function createKnowledgeGraph(props: KnowledgeGraphProps = {}): HTMLElement {\n  const { height = 500 } = props;\n\n  const container = createElement('div', { className: 'knowledge-graph' });\n\n  container.innerHTML = `\n    <div class=\"graph-toolbar\">\n      <div class=\"graph-filters\">\n        <label class=\"filter-item\">\n          <input type=\"checkbox\" checked data-type=\"Person\"> People\n        </label>\n        <label class=\"filter-item\">\n          <input type=\"checkbox\" checked data-type=\"Document\"> Documents\n        </label>\n        <label class=\"filter-item\">\n          <input type=\"checkbox\" checked data-type=\"Question\"> Questions\n        </label>\n        <label class=\"filter-item\">\n          <input type=\"checkbox\" checked data-type=\"Risk\"> Risks\n        </label>\n      </div>\n      <div class=\"graph-actions\">\n        <input type=\"search\" id=\"graph-search\" class=\"search-input\" placeholder=\"Search nodes...\">\n        <button class=\"btn btn-sm\" id=\"graph-refresh\">Refresh</button>\n        <button class=\"btn btn-sm\" id=\"graph-fit\">Fit</button>\n      </div>\n    </div>\n    <div class=\"graph-container\" id=\"graph-container\" style=\"--graph-height: ${height}px;\">\n      <div class=\"graph-loading\">Loading graph...</div>\n    </div>\n    <div class=\"graph-stats\" id=\"graph-stats\"></div>\n    <div class=\"node-details hidden\" id=\"node-details\"></div>\n  `;\n\n  // Initialize graph\n  initGraph(container, props);\n\n  return container;\n}\n\n/**\n * Initialize graph visualization\n */\nasync function initGraph(container: HTMLElement, props: KnowledgeGraphProps): Promise<void> {\n  const graphContainer = container.querySelector('#graph-container') as HTMLElement;\n  const statsContainer = container.querySelector('#graph-stats') as HTMLElement;\n\n  // Check if vis-network is available\n  if (!window.vis) {\n    graphContainer.innerHTML = `\n      <div class=\"graph-fallback\">\n        <p>Graph visualization requires vis-network library</p>\n        <p class=\"text-muted\">Add vis-network to enable interactive graph</p>\n      </div>\n    `;\n    await loadStats(statsContainer);\n    return;\n  }\n\n  try {\n    // Load graph data\n    const { nodes, edges } = await graphService.getVisualizationData();\n\n    if (nodes.length === 0) {\n      graphContainer.innerHTML = `\n        <div class=\"graph-empty\">\n          <p>No graph data available</p>\n          <p class=\"text-muted\">Process some documents to populate the knowledge graph</p>\n        </div>\n      `;\n      return;\n    }\n\n    // Create vis-network\n    const network = createVisNetwork(graphContainer, nodes, edges, props);\n\n    // Bind toolbar events\n    bindToolbarEvents(container, network, nodes, props);\n\n    // Load stats\n    await loadStats(statsContainer);\n\n  } catch (error) {\n    graphContainer.innerHTML = `\n      <div class=\"graph-error\">\n        <p>Failed to load graph</p>\n        <button class=\"btn btn-sm\" id=\"retry-graph\">Retry</button>\n      </div>\n    `;\n    const retryBtn = graphContainer.querySelector('#retry-graph');\n    if (retryBtn) {\n      on(retryBtn as HTMLElement, 'click', () => initGraph(container, props));\n    }\n  }\n}\n\n/**\n * Create vis-network instance\n */\nfunction createVisNetwork(\n  container: HTMLElement,\n  nodes: GraphNode[],\n  edges: GraphEdge[],\n  props: KnowledgeGraphProps\n): VisNetwork {\n  container.innerHTML = ''; // Clear loading\n\n  const visNodes = nodes.map(n => ({\n    id: n.id,\n    label: n.label || n.name || n.id,\n    color: NODE_COLORS[n.type] || NODE_COLORS.default,\n    title: `${n.type}: ${n.label || n.name || n.id}`,\n    shape: 'dot',\n    size: getNodeSize(n),\n  }));\n\n  const visEdges = edges.map(e => ({\n    from: e.source,\n    to: e.target,\n    label: e.type,\n    arrows: 'to',\n    color: { color: '#9ca3af', opacity: 0.6 },\n  }));\n\n  const options = {\n    nodes: {\n      borderWidth: 2,\n      shadow: true,\n      font: {\n        size: 12,\n        color: getComputedStyle(document.documentElement).getPropertyValue('--color-text').trim() || '#333',\n      },\n    },\n    edges: {\n      width: 1,\n      shadow: false,\n      smooth: {\n        type: 'continuous',\n      },\n      font: {\n        size: 10,\n        color: '#9ca3af',\n      },\n    },\n    physics: {\n      stabilization: {\n        iterations: 100,\n      },\n      barnesHut: {\n        gravitationalConstant: -5000,\n        springLength: 150,\n      },\n    },\n    interaction: {\n      hover: true,\n      tooltipDelay: 200,\n    },\n  };\n\n  const network = new window.vis!.Network(container, {\n    nodes: new window.vis!.DataSet(visNodes),\n    edges: new window.vis!.DataSet(visEdges),\n  }, options);\n\n  // Node click handler\n  // eslint-disable-next-line @typescript-eslint/no-explicit-any\n  network.on('click', (params: any) => {\n    if (params.nodes && params.nodes.length > 0) {\n      const nodeId = params.nodes[0];\n      const node = nodes.find(n => n.id === nodeId);\n      if (node && props.onNodeClick) {\n        props.onNodeClick(node);\n      }\n      showNodeDetails(container, node);\n    }\n  });\n\n  return network;\n}\n\n/**\n * Get node size based on connections\n */\nfunction getNodeSize(node: GraphNode): number {\n  const connections = (node as unknown as { connections?: number }).connections || 1;\n  return Math.min(10 + connections * 2, 30);\n}\n\n/**\n * Bind toolbar events\n */\nfunction bindToolbarEvents(\n  container: HTMLElement,\n  network: VisNetwork,\n  nodes: GraphNode[],\n  props: KnowledgeGraphProps\n): void {\n  // Search\n  const searchInput = container.querySelector('#graph-search') as HTMLInputElement;\n  on(searchInput, 'input', () => {\n    const query = searchInput.value.toLowerCase();\n    const matchingNode = nodes.find(n =>\n      (n.label || n.name || n.id).toLowerCase().includes(query)\n    );\n    if (matchingNode) {\n      network.focus(matchingNode.id, { scale: 1.5 });\n    }\n  });\n\n  // Refresh\n  const refreshBtn = container.querySelector('#graph-refresh');\n  if (refreshBtn) {\n    on(refreshBtn as HTMLElement, 'click', () => {\n      initGraph(container, props);\n    });\n  }\n\n  // Fit\n  const fitBtn = container.querySelector('#graph-fit');\n  if (fitBtn) {\n    on(fitBtn as HTMLElement, 'click', () => {\n      network.fit();\n    });\n  }\n\n  // Filters\n  container.querySelectorAll('.filter-item input').forEach(checkbox => {\n    on(checkbox as HTMLElement, 'change', () => {\n      // TODO: Implement filtering\n      toast.info('Filtering not yet implemented');\n    });\n  });\n}\n\n/**\n * Show node details\n */\nfunction showNodeDetails(container: HTMLElement, node?: GraphNode): void {\n  const detailsContainer = container.querySelector('#node-details') as HTMLElement;\n\n  if (!node) {\n    detailsContainer.classList.add('hidden');\n    return;\n  }\n\n  detailsContainer.classList.remove('hidden');\n  detailsContainer.innerHTML = `\n    <div class=\"details-header\">\n      <span class=\"node-type\" style=\"--type-color: ${NODE_COLORS[node.type] || NODE_COLORS.default}\">${node.type}</span>\n      <span class=\"node-label\">${escapeHtml(node.label || node.name || node.id)}</span>\n      <button class=\"btn-icon close-details\"></button>\n    </div>\n    ${node.properties ? `\n      <div class=\"details-properties\">\n        ${Object.entries(node.properties).map(([key, value]) => `\n          <div class=\"property\">\n            <span class=\"property-key\">${escapeHtml(key)}:</span>\n            <span class=\"property-value\">${escapeHtml(String(value))}</span>\n          </div>\n        `).join('')}\n      </div>\n    ` : ''}\n  `;\n\n  const closeBtn = detailsContainer.querySelector('.close-details');\n  if (closeBtn) {\n    on(closeBtn as HTMLElement, 'click', () => {\n      detailsContainer.classList.add('hidden');\n    });\n  }\n}\n\n/**\n * Load graph stats\n */\nasync function loadStats(container: HTMLElement): Promise<void> {\n  try {\n    const stats = await graphService.getStats();\n    renderStats(container, stats);\n  } catch {\n    container.innerHTML = '';\n  }\n}\n\n/**\n * Render stats\n */\nfunction renderStats(container: HTMLElement, stats: GraphStats): void {\n  container.innerHTML = `\n    <div class=\"stat-item\">\n      <span class=\"stat-value\">${stats.nodeCount}</span>\n      <span class=\"stat-label\">Nodes</span>\n    </div>\n    <div class=\"stat-item\">\n      <span class=\"stat-value\">${stats.edgeCount}</span>\n      <span class=\"stat-label\">Edges</span>\n    </div>\n    ${stats.nodeTypes ? Object.entries(stats.nodeTypes).map(([type, count]) => `\n      <div class=\"stat-item type-${type.toLowerCase()}\">\n        <span class=\"stat-value\">${count}</span>\n        <span class=\"stat-label\">${type}</span>\n      </div>\n    `).join('') : ''}\n  `;\n}\n\n/**\n * Escape HTML\n */\nfunction escapeHtml(text: string): string {\n  const div = document.createElement('div');\n  div.textContent = text;\n  return div.innerHTML;\n}\n\nexport default createKnowledgeGraph;\n","/**\n * Timeline Component\n * Vertical timeline with events\n */\n\nimport { createElement, on } from '@lib/dom';\nimport { timelineService, TimelineEvent } from '@services/graph';\nimport { formatRelativeTime, formatDate } from '@lib/format';\n\nexport interface TimelineProps {\n  days?: number;\n  onEventClick?: (event: TimelineEvent) => void;\n}\n\n/**\n * Create timeline component\n */\nexport function createTimeline(props: TimelineProps = {}): HTMLElement {\n  const { days = 30 } = props;\n\n  const container = createElement('div', { className: 'timeline-container' });\n\n  container.innerHTML = `\n    <div class=\"timeline-header\">\n      <h3>Timeline</h3>\n      <select id=\"timeline-days\" class=\"filter-select\">\n        <option value=\"7\" ${days === 7 ? 'selected' : ''}>Last 7 days</option>\n        <option value=\"14\" ${days === 14 ? 'selected' : ''}>Last 14 days</option>\n        <option value=\"30\" ${days === 30 ? 'selected' : ''}>Last 30 days</option>\n        <option value=\"90\" ${days === 90 ? 'selected' : ''}>Last 90 days</option>\n      </select>\n    </div>\n    <div class=\"timeline-filters\">\n      <button class=\"filter-btn active\" data-type=\"all\">All</button>\n      <button class=\"filter-btn\" data-type=\"document\">Documents</button>\n      <button class=\"filter-btn\" data-type=\"question\">Questions</button>\n      <button class=\"filter-btn\" data-type=\"decision\">Decisions</button>\n      <button class=\"filter-btn\" data-type=\"risk\">Risks</button>\n    </div>\n    <div class=\"timeline-content\" id=\"timeline-content\">\n      <div class=\"loading\">Loading timeline...</div>\n    </div>\n  `;\n\n  // Bind events\n  const daysSelect = container.querySelector('#timeline-days') as HTMLSelectElement;\n  on(daysSelect, 'change', () => {\n    loadTimeline(container, parseInt(daysSelect.value), props);\n  });\n\n  const filterBtns = container.querySelectorAll('.filter-btn');\n  filterBtns.forEach(btn => {\n    on(btn as HTMLElement, 'click', () => {\n      filterBtns.forEach(b => b.classList.remove('active'));\n      btn.classList.add('active');\n      filterEvents(container, btn.getAttribute('data-type') || 'all');\n    });\n  });\n\n  // Initial load\n  loadTimeline(container, days, props);\n\n  return container;\n}\n\n/**\n * Load timeline events\n */\nasync function loadTimeline(container: HTMLElement, days: number, props: TimelineProps): Promise<void> {\n  const content = container.querySelector('#timeline-content') as HTMLElement;\n  content.innerHTML = '<div class=\"loading\">Loading...</div>';\n\n  try {\n    const data = await timelineService.getAll({ limit: days * 10 }); // Approximate events per day\n    renderTimeline(content, data.events || [], props);\n  } catch {\n    content.innerHTML = '<div class=\"error\">Failed to load timeline</div>';\n  }\n}\n\n/**\n * Render timeline\n */\nfunction renderTimeline(container: HTMLElement, events: TimelineEvent[], props: TimelineProps): void {\n  if (events.length === 0) {\n    container.innerHTML = '<div class=\"empty-state\">No events in this period</div>';\n    return;\n  }\n\n  // Group by date\n  const grouped = groupByDate(events);\n\n  container.innerHTML = `\n    <div class=\"timeline\">\n      ${Object.entries(grouped).map(([date, dayEvents]) => `\n        <div class=\"timeline-day\">\n          <div class=\"timeline-date\">${formatDate(date)}</div>\n          ${dayEvents.map(event => `\n            <div class=\"timeline-event\" data-type=\"${event.type}\" data-id=\"${event.id}\">\n              <div class=\"event-marker ${event.type}\"></div>\n              <div class=\"event-content\">\n                <div class=\"event-header\">\n                  <span class=\"event-type\">${event.type}</span>\n                  <span class=\"event-time\">${formatTime(event.date)}</span>\n                </div>\n                <div class=\"event-title\">${escapeHtml(event.title)}</div>\n                ${event.description ? `<div class=\"event-description\">${escapeHtml(event.description)}</div>` : ''}\n                ${event.user ? `<div class=\"event-user\">by ${escapeHtml(event.user)}</div>` : ''}\n              </div>\n            </div>\n          `).join('')}\n        </div>\n      `).join('')}\n    </div>\n  `;\n\n  // Bind click events\n  container.querySelectorAll('.timeline-event').forEach(el => {\n    on(el as HTMLElement, 'click', () => {\n      const id = el.getAttribute('data-id');\n      const event = events.find(e => String(e.id) === id);\n      if (event && props.onEventClick) {\n        props.onEventClick(event);\n      }\n    });\n  });\n}\n\n/**\n * Group events by date\n */\nfunction groupByDate(events: TimelineEvent[]): Record<string, TimelineEvent[]> {\n  const grouped: Record<string, TimelineEvent[]> = {};\n\n  events.forEach(event => {\n    const date = event.date.split('T')[0];\n    if (!grouped[date]) grouped[date] = [];\n    grouped[date].push(event);\n  });\n\n  // Sort by date descending\n  return Object.fromEntries(\n    Object.entries(grouped).sort(([a], [b]) => b.localeCompare(a))\n  );\n}\n\n/**\n * Filter events by type\n */\nfunction filterEvents(container: HTMLElement, type: string): void {\n  const events = container.querySelectorAll('.timeline-event');\n  events.forEach(el => {\n    if (type === 'all' || el.getAttribute('data-type') === type) {\n      (el as HTMLElement).classList.remove('hidden');\n    } else {\n      (el as HTMLElement).classList.add('hidden');\n    }\n  });\n\n  // Hide empty days\n  container.querySelectorAll('.timeline-day').forEach(day => {\n    const visibleEvents = day.querySelectorAll('.timeline-event:not(.hidden)');\n    (day as HTMLElement).classList.toggle('hidden', visibleEvents.length === 0);\n  });\n}\n\n/**\n * Format time\n */\nfunction formatTime(dateStr: string): string {\n  const date = new Date(dateStr);\n  return date.toLocaleTimeString(undefined, { hour: '2-digit', minute: '2-digit' });\n}\n\n/**\n * Escape HTML\n */\nfunction escapeHtml(text: string): string {\n  const div = document.createElement('div');\n  div.textContent = text;\n  return div.innerHTML;\n}\n\nexport default createTimeline;\n","/**\r\n * Global Search Component\r\n * Command palette style search (Cmd+K / Ctrl+K)\r\n */\r\n\r\nimport { createElement, on } from '@lib/dom';\r\nimport { http } from '@services/api';\r\nimport { shortcuts } from '@services/shortcuts';\r\n\r\nexport interface GlobalSearchProps {\r\n  onResultClick?: (result: SearchResult) => void;\r\n}\r\n\r\nexport interface SearchResult {\r\n  id: string;\r\n  type: 'question' | 'risk' | 'action' | 'decision' | 'contact' | 'document' | 'email' | 'fact';\r\n  title: string;\r\n  subtitle?: string;\r\n  icon?: string;\r\n  url?: string;\r\n}\r\n\r\ninterface SearchResponse {\r\n  results: SearchResult[];\r\n  total: number;\r\n}\r\n\r\nlet isOpen = false;\r\nlet currentQuery = '';\r\nlet selectedIndex = 0;\r\nlet results: SearchResult[] = [];\r\n\r\nconst TYPE_ICONS: Record<string, string> = {\r\n  question: '',\r\n  risk: '',\r\n  action: '',\r\n  decision: '',\r\n  contact: '',\r\n  document: '',\r\n  email: '',\r\n  fact: '',\r\n};\r\n\r\n/**\r\n * Initialize global search\r\n */\r\nexport function initGlobalSearch(props: GlobalSearchProps = {}): void {\r\n  // Create modal if not exists\r\n  let modal = document.getElementById('global-search-modal');\r\n  if (!modal) {\r\n    modal = createSearchModal(props);\r\n    document.body.appendChild(modal);\r\n  }\r\n\r\n  // Register keyboard shortcut\r\n  shortcuts.register('mod+k', (e) => {\r\n    e.preventDefault();\r\n    toggleSearch();\r\n  });\r\n\r\n  // Also register / for quick search\r\n  shortcuts.register('/', (e) => {\r\n    // Only if not in an input\r\n    if (document.activeElement?.tagName !== 'INPUT' &&\r\n      document.activeElement?.tagName !== 'TEXTAREA') {\r\n      e.preventDefault();\r\n      toggleSearch();\r\n    }\r\n  });\r\n}\r\n\r\n/**\r\n * Create search modal\r\n */\r\nfunction createSearchModal(props: GlobalSearchProps): HTMLElement {\r\n  const modal = createElement('div', {\r\n    id: 'global-search-modal',\r\n    className: 'global-search-modal hidden',\r\n  });\r\n\r\n  modal.innerHTML = `\r\n    <div class=\"search-backdrop\"></div>\r\n    <div class=\"search-dialog\">\r\n      <div class=\"search-input-wrapper\">\r\n        <span class=\"search-icon\"></span>\r\n        <input type=\"text\" id=\"global-search-input\" class=\"search-input\" \r\n               placeholder=\"Search questions, risks, contacts...\" autocomplete=\"off\">\r\n        <kbd class=\"search-shortcut\">ESC</kbd>\r\n      </div>\r\n      <div class=\"search-results\" id=\"search-results\">\r\n        <div class=\"search-hint\">\r\n          <p>Start typing to search...</p>\r\n          <div class=\"search-tips\">\r\n            <span><kbd></kbd> Navigate</span>\r\n            <span><kbd>Enter</kbd> Select</span>\r\n            <span><kbd>ESC</kbd> Close</span>\r\n          </div>\r\n        </div>\r\n      </div>\r\n      <div class=\"search-footer\">\r\n        <span>Type to search</span>\r\n        <span>Press <kbd>?</kbd> for more shortcuts</span>\r\n      </div>\r\n    </div>\r\n  `;\r\n\r\n  const backdrop = modal.querySelector('.search-backdrop') as HTMLElement;\r\n  const input = modal.querySelector('#global-search-input') as HTMLInputElement;\r\n  const resultsContainer = modal.querySelector('#search-results') as HTMLElement;\r\n\r\n  // Close on backdrop click\r\n  on(backdrop, 'click', closeSearch);\r\n\r\n  // Input events\r\n  on(input, 'input', () => {\r\n    currentQuery = input.value;\r\n    selectedIndex = 0;\r\n    debounceSearch(resultsContainer, props);\r\n  });\r\n\r\n  on(input, 'keydown', (e) => {\r\n    handleKeydown(e, resultsContainer, props);\r\n  });\r\n\r\n  return modal;\r\n}\r\n\r\n/**\r\n * Toggle search visibility\r\n */\r\nexport function toggleSearch(): void {\r\n  if (isOpen) {\r\n    closeSearch();\r\n  } else {\r\n    openSearch();\r\n  }\r\n}\r\n\r\n/**\r\n * Open search\r\n */\r\nexport function openSearch(): void {\r\n  const modal = document.getElementById('global-search-modal');\r\n  if (!modal) return;\r\n\r\n  isOpen = true;\r\n  modal.classList.remove('hidden');\r\n\r\n  const input = modal.querySelector('#global-search-input') as HTMLInputElement;\r\n  input.value = '';\r\n  input.focus();\r\n\r\n  currentQuery = '';\r\n  results = [];\r\n  selectedIndex = 0;\r\n\r\n  // Reset results\r\n  const resultsContainer = modal.querySelector('#search-results') as HTMLElement;\r\n  resultsContainer.innerHTML = `\r\n    <div class=\"search-hint\">\r\n      <p>Start typing to search...</p>\r\n      <div class=\"search-tips\">\r\n        <span><kbd></kbd> Navigate</span>\r\n        <span><kbd>Enter</kbd> Select</span>\r\n        <span><kbd>ESC</kbd> Close</span>\r\n      </div>\r\n    </div>\r\n  `;\r\n\r\n  // Add escape listener\r\n  document.addEventListener('keydown', handleEscape);\r\n}\r\n\r\n/**\r\n * Close search\r\n */\r\nexport function closeSearch(): void {\r\n  const modal = document.getElementById('global-search-modal');\r\n  if (!modal) return;\r\n\r\n  isOpen = false;\r\n  modal.classList.add('hidden');\r\n\r\n  document.removeEventListener('keydown', handleEscape);\r\n}\r\n\r\n/**\r\n * Handle escape key\r\n */\r\nfunction handleEscape(e: KeyboardEvent): void {\r\n  if (e.key === 'Escape') {\r\n    closeSearch();\r\n  }\r\n}\r\n\r\n/**\r\n * Handle keyboard navigation\r\n */\r\nfunction handleKeydown(e: KeyboardEvent, container: HTMLElement, props: GlobalSearchProps): void {\r\n  switch (e.key) {\r\n    case 'ArrowDown':\r\n      e.preventDefault();\r\n      selectedIndex = Math.min(selectedIndex + 1, results.length - 1);\r\n      updateSelection(container);\r\n      break;\r\n    case 'ArrowUp':\r\n      e.preventDefault();\r\n      selectedIndex = Math.max(selectedIndex - 1, 0);\r\n      updateSelection(container);\r\n      break;\r\n    case 'Enter':\r\n      e.preventDefault();\r\n      const selected = results[selectedIndex];\r\n      if (selected) {\r\n        selectResult(selected, props);\r\n      }\r\n      break;\r\n    case 'Escape':\r\n      closeSearch();\r\n      break;\r\n  }\r\n}\r\n\r\n/**\r\n * Update selection highlight\r\n */\r\nfunction updateSelection(container: HTMLElement): void {\r\n  const items = container.querySelectorAll('.search-result');\r\n  items.forEach((item, i) => {\r\n    item.classList.toggle('selected', i === selectedIndex);\r\n    if (i === selectedIndex) {\r\n      item.scrollIntoView({ block: 'nearest' });\r\n    }\r\n  });\r\n}\r\n\r\n/**\r\n * Debounced search\r\n */\r\nlet searchTimeout: number;\r\nfunction debounceSearch(container: HTMLElement, props: GlobalSearchProps): void {\r\n  clearTimeout(searchTimeout);\r\n  searchTimeout = window.setTimeout(() => {\r\n    performSearch(container, props);\r\n  }, 200);\r\n}\r\n\r\n/**\r\n * Perform search\r\n */\r\nasync function performSearch(container: HTMLElement, props: GlobalSearchProps): Promise<void> {\r\n  if (!currentQuery.trim()) {\r\n    container.innerHTML = `\r\n      <div class=\"search-hint\">\r\n        <p>Start typing to search...</p>\r\n        <div class=\"search-tips\">\r\n          <span><kbd></kbd> Navigate</span>\r\n          <span><kbd>Enter</kbd> Select</span>\r\n          <span><kbd>ESC</kbd> Close</span>\r\n        </div>\r\n      </div>\r\n    `;\r\n    results = [];\r\n    return;\r\n  }\r\n\r\n  container.innerHTML = '<div class=\"search-loading\">Searching...</div>';\r\n\r\n  try {\r\n    const response = await http.get<SearchResponse>(\r\n      `/api/search?q=${encodeURIComponent(currentQuery)}&limit=10`\r\n    );\r\n    results = response.data.results || [];\r\n\r\n    renderResults(container, results, props);\r\n  } catch {\r\n    // Fallback to local search if API fails\r\n    results = performLocalSearch(currentQuery);\r\n    renderResults(container, results, props);\r\n  }\r\n}\r\n\r\n/**\r\n * Local fallback search\r\n */\r\nfunction performLocalSearch(query: string): SearchResult[] {\r\n  // TODO: Search local stores\r\n  return [];\r\n}\r\n\r\n/**\r\n * Render results\r\n */\r\nfunction renderResults(container: HTMLElement, results: SearchResult[], props: GlobalSearchProps): void {\r\n  if (results.length === 0) {\r\n    container.innerHTML = `\r\n      <div class=\"search-empty\">\r\n        <p>No results found for \"${escapeHtml(currentQuery)}\"</p>\r\n      </div>\r\n    `;\r\n    return;\r\n  }\r\n\r\n  // Group by type\r\n  const grouped = groupByType(results);\r\n\r\n  container.innerHTML = Object.entries(grouped).map(([type, items]) => `\r\n    <div class=\"search-group\">\r\n      <div class=\"group-label\">${capitalize(type)}s</div>\r\n      ${items.map((result, i) => `\r\n        <div class=\"search-result ${i === selectedIndex ? 'selected' : ''}\" data-index=\"${results.indexOf(result)}\">\r\n          <span class=\"result-icon\">${TYPE_ICONS[result.type] || ''}</span>\r\n          <div class=\"result-content\">\r\n            <div class=\"result-title\">${escapeHtml(result.title)}</div>\r\n            ${result.subtitle ? `<div class=\"result-subtitle\">${escapeHtml(result.subtitle)}</div>` : ''}\r\n          </div>\r\n          <span class=\"result-type\">${result.type}</span>\r\n        </div>\r\n      `).join('')}\r\n    </div>\r\n  `).join('');\r\n\r\n  // Bind click events\r\n  container.querySelectorAll('.search-result').forEach(el => {\r\n    on(el as HTMLElement, 'click', () => {\r\n      const index = parseInt(el.getAttribute('data-index') || '0');\r\n      const result = results[index];\r\n      if (result) {\r\n        selectResult(result, props);\r\n      }\r\n    });\r\n\r\n    on(el as HTMLElement, 'mouseenter', () => {\r\n      const index = parseInt(el.getAttribute('data-index') || '0');\r\n      selectedIndex = index;\r\n      updateSelection(container);\r\n    });\r\n  });\r\n}\r\n\r\n/**\r\n * Select result\r\n */\r\nfunction selectResult(result: SearchResult, props: GlobalSearchProps): void {\r\n  closeSearch();\r\n\r\n  if (props.onResultClick) {\r\n    props.onResultClick(result);\r\n  } else {\r\n    // Default navigation\r\n    navigateToResult(result);\r\n  }\r\n}\r\n\r\n/**\r\n * Navigate to result\r\n */\r\nfunction navigateToResult(result: SearchResult): void {\r\n  // Dispatch custom event for navigation\r\n  window.dispatchEvent(new CustomEvent('godmode:navigate', {\r\n    detail: { type: result.type, id: result.id }\r\n  }));\r\n}\r\n\r\n/**\r\n * Group results by type\r\n */\r\nfunction groupByType(results: SearchResult[]): Record<string, SearchResult[]> {\r\n  const grouped: Record<string, SearchResult[]> = {};\r\n  results.forEach(r => {\r\n    if (!grouped[r.type]) grouped[r.type] = [];\r\n    grouped[r.type].push(r);\r\n  });\r\n  return grouped;\r\n}\r\n\r\n/**\r\n * Capitalize\r\n */\r\nfunction capitalize(str: string): string {\r\n  return str.charAt(0).toUpperCase() + str.slice(1);\r\n}\r\n\r\n/**\r\n * Escape HTML\r\n */\r\nfunction escapeHtml(text: string): string {\r\n  const div = document.createElement('div');\r\n  div.textContent = text;\r\n  return div.innerHTML;\r\n}\r\n\r\nexport default initGlobalSearch;\r\n","/**\n * Bulk Actions Component\n * Selection management and bulk operations\n */\n\nimport { createElement, on } from '@lib/dom';\nimport { http } from '@services/api';\nimport { toast } from '@services/toast';\nimport { undoManager } from '@services/undo';\n\nexport interface BulkActionsProps {\n  type: 'questions' | 'risks' | 'actions' | 'decisions' | 'contacts' | 'documents';\n  onComplete?: () => void;\n}\n\ninterface BulkOperation {\n  type: string;\n  ids: string[];\n  action: string;\n  data?: Record<string, unknown>;\n}\n\nlet selectedIds: Set<string> = new Set();\n\n/**\n * Create bulk actions bar\n */\nexport function createBulkActionsBar(props: BulkActionsProps): HTMLElement {\n  const bar = createElement('div', { className: 'bulk-actions-bar hidden' });\n\n  bar.innerHTML = `\n    <div class=\"bulk-info\">\n      <span class=\"bulk-count\">0</span> selected\n    </div>\n    <div class=\"bulk-buttons\">\n      ${getActionsForType(props.type)}\n      <button class=\"btn btn-sm btn-secondary\" id=\"bulk-clear\">Clear</button>\n    </div>\n  `;\n\n  // Bind clear\n  const clearBtn = bar.querySelector('#bulk-clear');\n  if (clearBtn) {\n    on(clearBtn as HTMLElement, 'click', () => {\n      clearSelection();\n      updateBar(bar);\n    });\n  }\n\n  // Bind actions\n  bindActionButtons(bar, props);\n\n  return bar;\n}\n\n/**\n * Get action buttons for type\n */\nfunction getActionsForType(type: string): string {\n  const common = `\n    <button class=\"btn btn-sm btn-danger\" id=\"bulk-delete\">Delete</button>\n  `;\n\n  switch (type) {\n    case 'questions':\n      return `\n        <button class=\"btn btn-sm\" id=\"bulk-status\" data-status=\"resolved\">Mark Resolved</button>\n        <button class=\"btn btn-sm\" id=\"bulk-assign\">Assign To...</button>\n        ${common}\n      `;\n    case 'actions':\n      return `\n        <button class=\"btn btn-sm\" id=\"bulk-status\" data-status=\"completed\">Mark Complete</button>\n        <button class=\"btn btn-sm\" id=\"bulk-assign\">Assign To...</button>\n        ${common}\n      `;\n    case 'risks':\n      return `\n        <button class=\"btn btn-sm\" id=\"bulk-status\" data-status=\"mitigated\">Mark Mitigated</button>\n        ${common}\n      `;\n    case 'decisions':\n      return `\n        <button class=\"btn btn-sm\" id=\"bulk-status\" data-status=\"approved\">Approve</button>\n        <button class=\"btn btn-sm\" id=\"bulk-status\" data-status=\"rejected\">Reject</button>\n        ${common}\n      `;\n    default:\n      return common;\n  }\n}\n\n/**\n * Bind action buttons\n */\nfunction bindActionButtons(bar: HTMLElement, props: BulkActionsProps): void {\n  // Delete\n  const deleteBtn = bar.querySelector('#bulk-delete');\n  if (deleteBtn) {\n    on(deleteBtn as HTMLElement, 'click', async () => {\n      if (!confirm(`Delete ${selectedIds.size} items?`)) return;\n\n      await performBulkAction({\n        type: props.type,\n        ids: Array.from(selectedIds),\n        action: 'delete',\n      }, props);\n    });\n  }\n\n  // Status change\n  const statusBtns = bar.querySelectorAll('[id^=\"bulk-status\"]');\n  statusBtns.forEach(btn => {\n    on(btn as HTMLElement, 'click', async () => {\n      const status = btn.getAttribute('data-status');\n      if (!status) return;\n\n      await performBulkAction({\n        type: props.type,\n        ids: Array.from(selectedIds),\n        action: 'status',\n        data: { status },\n      }, props);\n    });\n  });\n\n  // Assign\n  const assignBtn = bar.querySelector('#bulk-assign');\n  if (assignBtn) {\n    on(assignBtn as HTMLElement, 'click', () => {\n      const assignee = prompt('Assign to:');\n      if (!assignee) return;\n\n      performBulkAction({\n        type: props.type,\n        ids: Array.from(selectedIds),\n        action: 'assign',\n        data: { assignee },\n      }, props);\n    });\n  }\n}\n\n/**\n * Perform bulk action\n */\nasync function performBulkAction(operation: BulkOperation, props: BulkActionsProps): Promise<void> {\n  try {\n    let endpoint = '';\n    let body: Record<string, unknown> = { type: operation.type, ids: operation.ids };\n\n    switch (operation.action) {\n      case 'delete':\n        endpoint = '/api/bulk/delete';\n        break;\n      case 'status':\n        endpoint = '/api/bulk/status';\n        body = { ...body, status: operation.data?.status };\n        break;\n      case 'assign':\n        endpoint = '/api/bulk/assign';\n        body = { ...body, assignee: operation.data?.assignee };\n        break;\n    }\n\n    const response = await http.post<{ actionId?: string; affected: number }>(endpoint, body);\n\n    // Register for undo if supported\n    if (response.data.actionId) {\n      undoManager.push({\n        type: `bulk-${operation.action}`,\n        description: `${operation.action} ${operation.ids.length} items`,\n        undo: async () => {\n          await http.post(`/api/undo/${response.data.actionId}`);\n          props.onComplete?.();\n        },\n      });\n    }\n\n    toast.success(`Updated ${response.data.affected || operation.ids.length} items`);\n    clearSelection();\n    props.onComplete?.();\n  } catch {\n    toast.error('Bulk operation failed');\n  }\n}\n\n/**\n * Toggle item selection\n */\nexport function toggleSelection(id: string, bar: HTMLElement): void {\n  if (selectedIds.has(id)) {\n    selectedIds.delete(id);\n  } else {\n    selectedIds.add(id);\n  }\n  updateBar(bar);\n}\n\n/**\n * Select item\n */\nexport function selectItem(id: string, bar: HTMLElement): void {\n  selectedIds.add(id);\n  updateBar(bar);\n}\n\n/**\n * Deselect item\n */\nexport function deselectItem(id: string, bar: HTMLElement): void {\n  selectedIds.delete(id);\n  updateBar(bar);\n}\n\n/**\n * Clear selection\n */\nexport function clearSelection(): void {\n  selectedIds.clear();\n  // Update checkboxes in DOM\n  document.querySelectorAll('.bulk-checkbox:checked').forEach(cb => {\n    (cb as HTMLInputElement).checked = false;\n  });\n}\n\n/**\n * Get selected IDs\n */\nexport function getSelectedIds(): string[] {\n  return Array.from(selectedIds);\n}\n\n/**\n * Is item selected\n */\nexport function isSelected(id: string): boolean {\n  return selectedIds.has(id);\n}\n\n/**\n * Update bar visibility and count\n */\nfunction updateBar(bar: HTMLElement): void {\n  const count = selectedIds.size;\n\n  bar.classList.toggle('hidden', count === 0);\n\n  const countEl = bar.querySelector('.bulk-count');\n  if (countEl) {\n    countEl.textContent = String(count);\n  }\n}\n\n/**\n * Create checkbox for bulk selection\n */\nexport function createBulkCheckbox(id: string, bar: HTMLElement): HTMLElement {\n  const checkbox = createElement('input', {\n    type: 'checkbox',\n    className: 'bulk-checkbox',\n  }) as HTMLInputElement;\n  checkbox.setAttribute('data-id', id);\n  checkbox.checked = isSelected(id);\n\n  on(checkbox, 'change', (e) => {\n    e.stopPropagation();\n    toggleSelection(id, bar);\n    checkbox.checked = isSelected(id);\n  });\n\n  return checkbox;\n}\n\nexport default createBulkActionsBar;\n","/**\r\n * Sync Status Component\r\n * Shows synchronization status and dead letters\r\n */\r\n\r\nimport { createElement, on } from '@lib/dom';\r\nimport { http } from '@services/api';\r\nimport { toast } from '@services/toast';\r\nimport { formatRelativeTime } from '@lib/format';\r\n\r\nexport interface SyncStatusProps {\r\n  showDetails?: boolean;\r\n}\r\n\r\ninterface SyncState {\r\n  connected: boolean;\r\n  lastSync: string | null;\r\n  pendingCount: number;\r\n  errorCount: number;\r\n}\r\n\r\ninterface DeadLetter {\r\n  id: string;\r\n  type: string;\r\n  payload: unknown;\r\n  error: string;\r\n  failedAt: string;\r\n  retryCount: number;\r\n}\r\n\r\n/**\r\n * Create sync status component\r\n */\r\nexport function createSyncStatus(props: SyncStatusProps = {}): HTMLElement {\r\n  const container = createElement('div', { className: 'sync-status' });\r\n\r\n  container.innerHTML = `\r\n    <div class=\"sync-indicator\" id=\"sync-indicator\">\r\n      <span class=\"sync-icon\"></span>\r\n      <span class=\"sync-text\">Checking...</span>\r\n    </div>\r\n    ${props.showDetails ? `\r\n      <div class=\"sync-details hidden\" id=\"sync-details\">\r\n        <div class=\"sync-info\"></div>\r\n        <div class=\"dead-letters\"></div>\r\n      </div>\r\n    ` : ''}\r\n  `;\r\n\r\n  const indicator = container.querySelector('#sync-indicator') as HTMLElement;\r\n\r\n  // Toggle details on click\r\n  if (props.showDetails) {\r\n    on(indicator, 'click', () => {\r\n      const details = container.querySelector('#sync-details') as HTMLElement;\r\n      const wasHidden = details.classList.contains('hidden');\r\n      details.classList.toggle('hidden');\r\n      if (wasHidden) {\r\n        loadSyncDetails(container);\r\n      }\r\n    });\r\n  }\r\n\r\n  // Initial check\r\n  checkSyncStatus(container);\r\n\r\n  // Periodic refresh\r\n  setInterval(() => checkSyncStatus(container), 30000);\r\n\r\n  return container;\r\n}\r\n\r\n/**\r\n * Check sync status\r\n */\r\nasync function checkSyncStatus(container: HTMLElement): Promise<void> {\r\n  try {\r\n    const response = await http.get<SyncState>('/api/sync/status');\r\n    updateIndicator(container, response.data);\r\n  } catch {\r\n    updateIndicator(container, {\r\n      connected: false,\r\n      lastSync: null,\r\n      pendingCount: 0,\r\n      errorCount: 0,\r\n    });\r\n  }\r\n}\r\n\r\n/**\r\n * Update indicator\r\n */\r\nfunction updateIndicator(container: HTMLElement, state: SyncState): void {\r\n  const icon = container.querySelector('.sync-icon') as HTMLElement;\r\n  const text = container.querySelector('.sync-text') as HTMLElement;\r\n  const indicator = container.querySelector('.sync-indicator') as HTMLElement;\r\n\r\n  if (!state.connected) {\r\n    icon.textContent = '';\r\n    text.textContent = 'Disconnected';\r\n    indicator.classList.remove('synced', 'syncing');\r\n    indicator.classList.add('error');\r\n  } else if (state.pendingCount > 0) {\r\n    icon.textContent = '';\r\n    text.textContent = `Syncing (${state.pendingCount})`;\r\n    indicator.classList.remove('synced', 'error');\r\n    indicator.classList.add('syncing');\r\n  } else if (state.errorCount > 0) {\r\n    icon.textContent = '!';\r\n    text.textContent = `${state.errorCount} errors`;\r\n    indicator.classList.remove('synced', 'syncing');\r\n    indicator.classList.add('error');\r\n  } else {\r\n    icon.textContent = '';\r\n    text.textContent = state.lastSync ? formatRelativeTime(state.lastSync) : 'Synced';\r\n    indicator.classList.remove('syncing', 'error');\r\n    indicator.classList.add('synced');\r\n  }\r\n}\r\n\r\n/**\r\n * Load sync details\r\n */\r\nasync function loadSyncDetails(container: HTMLElement): Promise<void> {\r\n  const infoContainer = container.querySelector('.sync-info') as HTMLElement;\r\n  const deadLettersContainer = container.querySelector('.dead-letters') as HTMLElement;\r\n\r\n  infoContainer.innerHTML = '<div class=\"loading\">Loading...</div>';\r\n\r\n  try {\r\n    // Get sync status\r\n    const statusResponse = await http.get<SyncState>('/api/sync/status');\r\n    const state = statusResponse.data;\r\n\r\n    infoContainer.innerHTML = `\r\n      <div class=\"info-grid\">\r\n        <div class=\"info-item\">\r\n          <span class=\"info-label\">Status</span>\r\n          <span class=\"info-value ${state.connected ? 'success' : 'error'}\">\r\n            ${state.connected ? 'Connected' : 'Disconnected'}\r\n          </span>\r\n        </div>\r\n        <div class=\"info-item\">\r\n          <span class=\"info-label\">Last Sync</span>\r\n          <span class=\"info-value\">${state.lastSync ? formatRelativeTime(state.lastSync) : 'Never'}</span>\r\n        </div>\r\n        <div class=\"info-item\">\r\n          <span class=\"info-label\">Pending</span>\r\n          <span class=\"info-value\">${state.pendingCount}</span>\r\n        </div>\r\n        <div class=\"info-item\">\r\n          <span class=\"info-label\">Errors</span>\r\n          <span class=\"info-value ${state.errorCount > 0 ? 'error' : ''}\">${state.errorCount}</span>\r\n        </div>\r\n      </div>\r\n    `;\r\n\r\n    // Get dead letters\r\n    const deadLettersResponse = await http.get<{ deadLetters: DeadLetter[] }>('/api/sync/dead-letters');\r\n    const deadLetters = deadLettersResponse.data.deadLetters || [];\r\n\r\n    if (deadLetters.length > 0) {\r\n      deadLettersContainer.innerHTML = `\r\n        <h4>Failed Operations</h4>\r\n        <div class=\"dead-letters-list\">\r\n          ${deadLetters.map(dl => `\r\n            <div class=\"dead-letter\" data-id=\"${dl.id}\">\r\n              <div class=\"dl-header\">\r\n                <span class=\"dl-type\">${dl.type}</span>\r\n                <span class=\"dl-time\">${formatRelativeTime(dl.failedAt)}</span>\r\n              </div>\r\n              <div class=\"dl-error\">${escapeHtml(dl.error)}</div>\r\n              <div class=\"dl-actions\">\r\n                <button class=\"btn btn-sm retry-btn\" data-id=\"${dl.id}\">Retry</button>\r\n                <span class=\"dl-retries\">${dl.retryCount} attempts</span>\r\n              </div>\r\n            </div>\r\n          `).join('')}\r\n        </div>\r\n      `;\r\n\r\n      // Bind retry buttons\r\n      deadLettersContainer.querySelectorAll('.retry-btn').forEach(btn => {\r\n        on(btn as HTMLElement, 'click', async () => {\r\n          const id = btn.getAttribute('data-id');\r\n          if (!id) return;\r\n\r\n          try {\r\n            await http.post(`/api/sync/retry/${id}`);\r\n            toast.success('Retry scheduled');\r\n            loadSyncDetails(container);\r\n          } catch {\r\n            toast.error('Retry failed');\r\n          }\r\n        });\r\n      });\r\n    } else {\r\n      deadLettersContainer.innerHTML = '';\r\n    }\r\n  } catch {\r\n    infoContainer.innerHTML = '<div class=\"error\">Failed to load details</div>';\r\n  }\r\n}\r\n\r\n/**\r\n * Create mini sync indicator for header\r\n */\r\nexport function createSyncIndicator(): HTMLElement {\r\n  const indicator = createElement('div', { className: 'sync-indicator-mini' });\r\n  indicator.innerHTML = '<span class=\"sync-dot\"></span>';\r\n\r\n  // Initial check\r\n  checkMiniStatus(indicator);\r\n\r\n  // Periodic refresh\r\n  setInterval(() => checkMiniStatus(indicator), 30000);\r\n\r\n  return indicator;\r\n}\r\n\r\n/**\r\n * Check mini status\r\n */\r\nasync function checkMiniStatus(indicator: HTMLElement): Promise<void> {\r\n  try {\r\n    const response = await http.get<SyncState>('/api/sync/status');\r\n    const dot = indicator.querySelector('.sync-dot') as HTMLElement;\r\n\r\n    if (!response.data.connected) {\r\n      dot.className = 'sync-dot error';\r\n      indicator.title = 'Disconnected';\r\n    } else if (response.data.errorCount > 0) {\r\n      dot.className = 'sync-dot warning';\r\n      indicator.title = `${response.data.errorCount} sync errors`;\r\n    } else {\r\n      dot.className = 'sync-dot success';\r\n      indicator.title = 'Synced';\r\n    }\r\n  } catch {\r\n    const dot = indicator.querySelector('.sync-dot') as HTMLElement;\r\n    dot.className = 'sync-dot error';\r\n    indicator.title = 'Connection error';\r\n  }\r\n}\r\n\r\n/**\r\n * Escape HTML\r\n */\r\nfunction escapeHtml(text: string): string {\r\n  const div = document.createElement('div');\r\n  div.textContent = text;\r\n  return div.innerHTML;\r\n}\r\n\r\nexport default createSyncStatus;\r\n","import { createElement, $, show, hide, toggle } from '@lib/dom';\r\nimport { shortcuts, toast, theme } from '@services';\r\n\r\ninterface CommandItem {\r\n    id: string;\r\n    title: string;\r\n    description?: string;\r\n    icon?: string;\r\n    section: string;\r\n    action: () => void;\r\n    keywords?: string[];\r\n}\r\n\r\nclass CommandPaletteComponent {\r\n    private dialog: HTMLDialogElement | null = null;\r\n    private input: HTMLInputElement | null = null;\r\n    private list: HTMLElement | null = null;\r\n    private items: CommandItem[] = [];\r\n    private selectedIndex: number = 0;\r\n    private visibleItems: CommandItem[] = [];\r\n\r\n    constructor() {\r\n        this.createDialog();\r\n        this.registerShortcut();\r\n        this.registerDefaultCommands();\r\n    }\r\n\r\n    private createDialog(): void {\r\n        // Create dialog element\r\n        this.dialog = createElement('dialog', { className: 'command-palette-dialog' });\r\n\r\n        // Header with search\r\n        const header = createElement('div', { className: 'cmd-header' });\r\n        const searchIcon = createElement('div', { className: 'cmd-search-icon', innerHTML: '<svg width=\"20\" height=\"20\" viewBox=\"0 0 24 24\" fill=\"none\" stroke=\"currentColor\" stroke-width=\"2\"><circle cx=\"11\" cy=\"11\" r=\"8\"/><line x1=\"21\" y1=\"21\" x2=\"16.65\" y2=\"16.65\"/></svg>' });\r\n        this.input = createElement('input', {\r\n            type: 'text',\r\n            className: 'cmd-input',\r\n            placeholder: 'Type a command or search...'\r\n        });\r\n\r\n        header.appendChild(searchIcon);\r\n        header.appendChild(this.input);\r\n\r\n        // List container\r\n        this.list = createElement('div', { className: 'cmd-list' });\r\n\r\n        // Footer\r\n        const footer = createElement('div', { className: 'cmd-footer' });\r\n        footer.innerHTML = `\r\n      <span><span class=\"cmd-shortcut\"></span> to navigate</span>\r\n      <span><span class=\"cmd-shortcut\"></span> to select</span>\r\n      <span><span class=\"cmd-shortcut\">esc</span> to close</span>\r\n    `;\r\n\r\n        this.dialog.appendChild(header);\r\n        this.dialog.appendChild(this.list);\r\n        this.dialog.appendChild(footer);\r\n\r\n        document.body.appendChild(this.dialog);\r\n\r\n        // Event listeners\r\n        this.input.addEventListener('input', () => this.filterItems());\r\n        this.input.addEventListener('keydown', (e) => this.handleKeydown(e));\r\n        this.dialog.addEventListener('click', (e) => {\r\n            if (e.target === this.dialog) this.close();\r\n        });\r\n        this.dialog.addEventListener('close', () => this.close());\r\n    }\r\n\r\n    private registerShortcut(): void {\r\n        // Register global shortcut via services\r\n        shortcuts.register({\r\n            key: 'k',\r\n            ctrl: true,\r\n            description: 'Open Command Palette',\r\n            handler: () => {\r\n                this.open();\r\n            },\r\n        });\r\n\r\n        // Also support Cmd+K on Mac logic if needed, but shortcuts service handles ctrl/meta check usually.\r\n        // If not, we can add a listener to window.\r\n        window.addEventListener('keydown', (e) => {\r\n            if ((e.ctrlKey || e.metaKey) && e.key === 'k') {\r\n                e.preventDefault();\r\n                this.open();\r\n            }\r\n        });\r\n    }\r\n\r\n    private registerDefaultCommands(): void {\r\n        this.items = [\r\n            // Navigation\r\n            { id: 'nav-dashboard', title: 'Go to Dashboard', section: 'Navigation', icon: '', action: () => this.navigate('dashboard'), keywords: ['home', 'main'] },\r\n            { id: 'nav-projects', title: 'Go to Projects', section: 'Navigation', icon: '', action: () => this.navigate('projects'), keywords: ['list', 'manage'] },\r\n            { id: 'nav-chat', title: 'Go to Chat', section: 'Navigation', icon: '', action: () => this.navigate('chat'), keywords: ['ai', 'copilot', 'assistant'] },\r\n            { id: 'nav-sot', title: 'Go to Source of Truth', section: 'Navigation', icon: '', action: () => this.navigate('sot'), keywords: ['facts', 'risks', 'decisions'] },\r\n            { id: 'nav-settings', title: 'Go to Settings', section: 'Navigation', icon: '', action: () => this.navigate('settings'), keywords: ['config', 'preferences'] },\r\n\r\n            // Actions\r\n            {\r\n                id: 'act-new-project', title: 'Create New Project', section: 'Actions', icon: '', action: () => {\r\n                    (window as any).__godmodeProjectsOpen = 'create';\r\n                    this.navigate('projects');\r\n                }, keywords: ['add', 'start']\r\n            },\r\n            { id: 'act-theme', title: 'Toggle Theme', section: 'Actions', icon: '', action: () => theme.cycle(), keywords: ['dark', 'light', 'mode'] },\r\n            { id: 'act-logout', title: 'Sign Out', section: 'Account', icon: '', action: () => document.getElementById('logout-btn')?.click(), keywords: ['log out', 'exit'] },\r\n        ];\r\n    }\r\n\r\n    public open(): void {\r\n        if (this.dialog && !this.dialog.open) {\r\n            this.dialog.showModal();\r\n            this.input?.focus();\r\n            this.input!.value = '';\r\n            this.filterItems();\r\n        }\r\n    }\r\n\r\n    public close(): void {\r\n        if (this.dialog && this.dialog.open) {\r\n            this.dialog.close();\r\n        }\r\n    }\r\n\r\n    private navigate(tab: string): void {\r\n        const navItem = document.querySelector(`.nav-item[data-tab=\"${tab}\"]`) as HTMLElement;\r\n        if (navItem) navItem.click();\r\n        this.close();\r\n    }\r\n\r\n    private filterItems(): void {\r\n        const query = this.input?.value.toLowerCase().trim() || '';\r\n\r\n        if (!query) {\r\n            this.visibleItems = this.items;\r\n        } else {\r\n            this.visibleItems = this.items.filter(item => {\r\n                return item.title.toLowerCase().includes(query) ||\r\n                    item.section.toLowerCase().includes(query) ||\r\n                    item.keywords?.some(k => k.includes(query));\r\n            });\r\n        }\r\n\r\n        this.renderList();\r\n    }\r\n\r\n    private renderList(): void {\r\n        if (!this.list) return;\r\n        this.list.innerHTML = '';\r\n        this.selectedIndex = 0;\r\n\r\n        if (this.visibleItems.length === 0) {\r\n            this.list.innerHTML = '<div style=\"padding:1rem;text-align:center;color:var(--color-text-muted)\">No commands found</div>';\r\n            return;\r\n        }\r\n\r\n        let lastSection = '';\r\n        this.visibleItems.forEach((item, index) => {\r\n            if (item.section !== lastSection) {\r\n                const sectionTitle = createElement('div', { className: 'cmd-section-title' }, [item.section]);\r\n                this.list!.appendChild(sectionTitle);\r\n                lastSection = item.section;\r\n            }\r\n\r\n            const el = createElement('div', {\r\n                className: `cmd-item ${index === 0 ? 'selected' : ''}`,\r\n                'data-index': index\r\n            });\r\n\r\n            const icon = createElement('div', { className: 'cmd-item-icon' }, [item.icon || '']);\r\n            const content = createElement('div', { className: 'cmd-item-content' });\r\n            const title = createElement('div', { className: 'cmd-item-title' }, [item.title]);\r\n            content.appendChild(title);\r\n\r\n            if (item.description) {\r\n                content.appendChild(createElement('div', { className: 'cmd-item-desc' }, [item.description]));\r\n            }\r\n\r\n            el.appendChild(icon);\r\n            el.appendChild(content);\r\n\r\n            el.addEventListener('click', () => {\r\n                item.action();\r\n                this.close();\r\n            });\r\n\r\n            el.addEventListener('mouseenter', () => {\r\n                this.selectedIndex = index;\r\n                this.updateSelection();\r\n            });\r\n\r\n            this.list!.appendChild(el);\r\n        });\r\n    }\r\n\r\n    private updateSelection(): void {\r\n        if (!this.list) return;\r\n        const items = this.list.querySelectorAll('.cmd-item');\r\n        items.forEach((item, index) => {\r\n            if (index === this.selectedIndex) {\r\n                item.classList.add('selected');\r\n                item.scrollIntoView({ block: 'nearest' });\r\n            } else {\r\n                item.classList.remove('selected');\r\n            }\r\n        });\r\n    }\r\n\r\n    private handleKeydown(e: KeyboardEvent): void {\r\n        if (e.key === 'ArrowDown') {\r\n            e.preventDefault();\r\n            this.selectedIndex = Math.min(this.selectedIndex + 1, this.visibleItems.length - 1);\r\n            this.updateSelection();\r\n        } else if (e.key === 'ArrowUp') {\r\n            e.preventDefault();\r\n            this.selectedIndex = Math.max(this.selectedIndex - 1, 0);\r\n            this.updateSelection();\r\n        } else if (e.key === 'Enter') {\r\n            e.preventDefault();\r\n            const item = this.visibleItems[this.selectedIndex];\r\n            if (item) {\r\n                item.action();\r\n                this.close();\r\n            }\r\n        } else if (e.key === 'Escape') {\r\n            this.close();\r\n        }\r\n    }\r\n}\r\n\r\n// Singleton instance\r\nlet instance: CommandPaletteComponent | null = null;\r\n\r\nexport function initCommandPalette(): CommandPaletteComponent {\r\n    if (!instance) {\r\n        instance = new CommandPaletteComponent();\r\n    }\r\n    return instance;\r\n}\r\n","/**\r\n * Companies Panel - Integrated view for Settings page\r\n * Adapted from CompaniesModal to work as a sub-view\r\n */\r\n\r\nimport { createElement, on } from '@lib/dom';\r\nimport { toast } from '@services/toast';\r\nimport {\r\n    listCompanies,\r\n    getCompany,\r\n    createCompany,\r\n    updateCompany,\r\n    deleteCompany,\r\n    analyzeCompany,\r\n    getTemplate,\r\n    updateTemplate,\r\n    generateTemplate,\r\n    type Company,\r\n    type CreateCompanyRequest,\r\n    type TemplateType,\r\n} from '@services/companies';\r\n\r\n/** UI strings - centralised for i18n */\r\nconst S = {\r\n    title: 'Companies',\r\n    newCompany: '+ New company',\r\n    noCompanies: 'No companies yet. Create one to use in projects.',\r\n    edit: 'Edit',\r\n    analyze: 'Analyze',\r\n    reAnalyze: 'Re-analyze',\r\n    viewDetail: 'View',\r\n    detail: 'Company detail',\r\n    analyzedOn: 'Analyzed',\r\n    notAnalyzed: 'Not analyzed',\r\n    delete: 'Delete',\r\n    backToList: 'Companies', // Breadcrumb root\r\n    name: 'Name *',\r\n    description: 'Description',\r\n    logoUrl: 'Logo URL',\r\n    website: 'Website',\r\n    linkedIn: 'LinkedIn',\r\n    save: 'Save',\r\n    create: 'Create',\r\n    cancel: 'Cancel',\r\n    invalidUrl: 'Please enter a valid URL',\r\n    updateFailed: 'Update failed',\r\n    createFailed: 'Create failed',\r\n    loadFailed: 'Failed to load company',\r\n    analysisComplete: 'Analysis complete',\r\n    analysisFailed: 'Analysis failed',\r\n    deleteConfirm: 'Delete this company? Projects using it must be reassigned first.',\r\n    companyDeleted: 'Company deleted',\r\n    templates: 'Templates (A4 / PPT)',\r\n    templateA4: 'A4 document',\r\n    templatePPT: 'Presentation',\r\n    generateWithAI: 'Generate base with AI',\r\n    loadCurrent: 'Load current',\r\n    saveTemplate: 'Save template',\r\n    templateLoaded: 'Template loaded',\r\n    templateSaved: 'Template saved',\r\n    templateGenerated: 'Template generated',\r\n    templateLoadFailed: 'Failed to load template',\r\n    templateSaveFailed: 'Failed to save template',\r\n    templateGenerateFailed: 'Generation failed',\r\n};\r\n\r\nfunction escapeHtml(s: string): string {\r\n    const div = document.createElement('div');\r\n    div.textContent = s;\r\n    return div.innerHTML;\r\n}\r\n\r\nfunction isValidUrl(value: string): boolean {\r\n    if (!value || !value.trim()) return true;\r\n    try {\r\n        const u = new URL(value.trim());\r\n        return u.protocol === 'http:' || u.protocol === 'https:';\r\n    } catch {\r\n        return false;\r\n    }\r\n}\r\n\r\n/**\r\n * Renders a breadcrumb navigation\r\n */\r\nfunction renderBreadcrumbs(parts: { label: string; onClick?: () => void }[]): string {\r\n    return `\r\n    <div class=\"companies-breadcrumbs\">\r\n      ${parts.map((part, index) => {\r\n        const isLast = index === parts.length - 1;\r\n        if (isLast) {\r\n            return `<span class=\"companies-breadcrumb-active\">${escapeHtml(part.label)}</span>`;\r\n        }\r\n        return `\r\n          <span class=\"breadcrumb-link companies-breadcrumb-link\">${escapeHtml(part.label)}</span>\r\n          <span class=\"companies-breadcrumb-separator\">/</span>\r\n        `;\r\n    }).join('')}\r\n    </div>\r\n  `;\r\n}\r\n\r\nexport function initCompaniesPanel(container: HTMLElement): void {\r\n    // Clear container\r\n    container.innerHTML = '';\r\n\r\n    // Create a content wrapper\r\n    const contentWrapper = createElement('div', { className: 'companies-panel-content' });\r\n    container.appendChild(contentWrapper);\r\n\r\n    function renderList(items: Company[]) {\r\n        const listEl = contentWrapper.querySelector('#companies-list');\r\n        if (!listEl) return;\r\n\r\n        // Breadcrumbs for root\r\n        const breadcrumbsContainer = contentWrapper.querySelector('.breadcrumbs-slot');\r\n        if (breadcrumbsContainer) {\r\n            breadcrumbsContainer.innerHTML = renderBreadcrumbs([{ label: 'Settings' }, { label: 'Companies' }]);\r\n        }\r\n\r\n        const list = Array.isArray(items) ? items : [];\r\n\r\n        try {\r\n            if (list.length === 0) {\r\n                listEl.innerHTML = `<p class=\"companies-empty-state\">${escapeHtml(S.noCompanies)}</p>`;\r\n                return;\r\n            }\r\n            const analyzedAt = (c: Company) => c.brand_assets?.analyzed_at;\r\n            listEl.innerHTML = list\r\n                .map(\r\n                    (c) => {\r\n                        const analyzed = !!analyzedAt(c);\r\n                        const analyzeLabel = analyzed ? S.reAnalyze : S.analyze;\r\n                        const analyzedBadge = analyzed\r\n                            ? `<span class=\"companies-analyzed-badge\" title=\"${escapeHtml(analyzedAt(c) || '')}\">${escapeHtml(S.analyzedOn)}</span>`\r\n                            : `<span class=\"companies-not-analyzed-badge\">${escapeHtml(S.notAnalyzed)}</span>`;\r\n\r\n                        return `\r\n      <div class=\"companies-row\" data-id=\"${c.id}\">\r\n        <div class=\"companies-logo-wrapper\">\r\n          ${c.logo_url ? `<img src=\"${escapeHtml(c.logo_url)}\" alt=\"\" class=\"companies-logo\">` : '<span class=\"companies-logo-placeholder\"></span>'}\r\n          <div>\r\n            <div class=\"companies-name-group\">\r\n                <strong class=\"companies-name\">${escapeHtml(c.name)}</strong>\r\n                ${analyzedBadge}\r\n            </div>\r\n            ${(c.brand_assets?.primary_color && c.brand_assets?.secondary_color) ? `<div class=\"companies-colors\"><div class=\"companies-color-pill\" style=\"background: ${escapeHtml(c.brand_assets.primary_color)};\"></div><div class=\"companies-color-pill\" style=\"background: ${escapeHtml(c.brand_assets.secondary_color)};\"></div></div>` : ''}\r\n            ${c.website_url ? `<a href=\"${escapeHtml(c.website_url)}\" target=\"_blank\" class=\"companies-website-link\">${escapeHtml(c.website_url.replace(/^https?:\\/\\//, ''))}</a>` : ''}\r\n          </div>\r\n        </div>\r\n        <div style=\"display: flex; gap: 8px;\">\r\n          <button type=\"button\" class=\"btn btn-sm btn-secondary companies-detail-btn\" data-id=\"${c.id}\" title=\"View analysis\">\r\n            <svg viewBox=\"0 0 24 24\" width=\"16\" height=\"16\" stroke=\"currentColor\" stroke-width=\"2\" fill=\"none\"><path d=\"M15 12a3 3 0 11-6 0 3 3 0 016 0z\"/><path d=\"M2.458 12C3.732 7.943 7.523 5 12 5c4.478 0 8.268 2.943 9.542 7-1.274 4.057-5.064 7-9.542 7-4.477 0-8.268-2.943-9.542-7z\"/></svg> \r\n            <span class=\"desktop-only\">${escapeHtml(S.viewDetail)}</span>\r\n          </button>\r\n          <button type=\"button\" class=\"btn btn-sm btn-secondary companies-edit-btn\" data-id=\"${c.id}\" title=\"${escapeHtml(S.edit)}\">\r\n             <svg viewBox=\"0 0 24 24\" width=\"16\" height=\"16\" stroke=\"currentColor\" stroke-width=\"2\" fill=\"none\"><path d=\"M11 4H4a2 2 0 00-2 2v14a2 2 0 002 2h14a2 2 0 002-2v-7\"/><path d=\"M18.5 2.5a2.121 2.121 0 013 3L12 15l-4 1 1-4 9.5-9.5z\"/></svg>\r\n             <span class=\"desktop-only\">${escapeHtml(S.edit)}</span>\r\n          </button>\r\n          <button type=\"button\" class=\"btn btn-sm btn-secondary companies-templates-list-btn\" data-id=\"${c.id}\" title=\"${escapeHtml(S.templates)}\">\r\n             <svg viewBox=\"0 0 24 24\" width=\"16\" height=\"16\" stroke=\"currentColor\" stroke-width=\"2\" fill=\"none\"><path d=\"M14 2H6a2 2 0 0 0-2 2v16a2 2 0 0 0 2 2h12a2 2 0 0 0 2-2V8z\"></path><polyline points=\"14 2 14 8 20 8\"></polyline><line x1=\"16\" y1=\"13\" x2=\"8\" y2=\"13\"></line><line x1=\"16\" y1=\"17\" x2=\"8\" y2=\"17\"></line><polyline points=\"10 9 9 9 8 9\"></polyline></svg>\r\n             <span class=\"desktop-only\">${escapeHtml(S.templates)}</span>\r\n          </button>\r\n          <button type=\"button\" class=\"btn btn-sm btn-secondary companies-analyze-btn\" data-id=\"${c.id}\" title=\"Analyze with AI\">\r\n             <svg viewBox=\"0 0 24 24\" width=\"16\" height=\"16\" stroke=\"currentColor\" stroke-width=\"2\" fill=\"none\"><path d=\"M13 2L3 14h9l-1 8 10-12h-9l1-8z\"/></svg>\r\n             <span class=\"desktop-only\">${escapeHtml(analyzeLabel)}</span>\r\n          </button>\r\n          <button type=\"button\" class=\"btn btn-sm btn-outline-danger companies-delete-btn\" data-id=\"${c.id}\">\r\n             <svg viewBox=\"0 0 24 24\" width=\"16\" height=\"16\" stroke=\"currentColor\" stroke-width=\"2\" fill=\"none\"><path d=\"M19 7l-.867 12.142A2 2 0 0116.138 21H7.862a2 2 0 01-1.995-1.858L5 7m5 4v6m4-6v6m1-10V4a1 1 0 00-1-1h-4a1 1 0 00-1 1v3M4 7h16\"/></svg>\r\n          </button>\r\n        </div>\r\n      </div>\r\n    `;\r\n                    }\r\n                )\r\n                .join('');\r\n        } catch {\r\n            listEl.innerHTML = `<p class=\"text-error\">${escapeHtml(S.loadFailed)}</p>`;\r\n        }\r\n    }\r\n\r\n    function loadList() {\r\n        const listEl = contentWrapper.querySelector('#companies-list');\r\n        if (listEl) listEl.innerHTML = '<div style=\"padding: 40px; text-align: center; color: var(--text-secondary);\"><div class=\"spinner\"></div> Loading companies...</div>';\r\n        listCompanies()\r\n            .then((list) => renderList(Array.isArray(list) ? list : []))\r\n            .catch(() => {\r\n                const el = contentWrapper.querySelector('#companies-list');\r\n                if (el) el.innerHTML = `<p class=\"text-error\">${escapeHtml(S.loadFailed)}</p>`;\r\n            });\r\n    }\r\n\r\n    function showListView() {\r\n        contentWrapper.innerHTML = `\r\n      <div class=\"breadcrumbs-slot\"></div>\r\n      <div style=\"display: flex; justify-content: space-between; align-items: center; margin-bottom: 24px;\">\r\n          <div>\r\n            <h2 style=\"font-size: 1.5rem; margin: 0; font-weight: 600;\">Companies</h2>\r\n             <p style=\"margin: 4px 0 0 0; color: var(--text-secondary);\">Manage company profiles and assets</p>\r\n          </div>\r\n          <button type=\"button\" class=\"btn btn-primary\" id=\"companies-new-btn\">\r\n            <svg viewBox=\"0 0 24 24\" width=\"18\" height=\"18\" stroke=\"currentColor\" stroke-width=\"2\" fill=\"none\" style=\"margin-right: 6px;\"><line x1=\"12\" y1=\"5\" x2=\"12\" y2=\"19\"></line><line x1=\"5\" y1=\"12\" x2=\"19\" y2=\"12\"></line></svg>\r\n            ${escapeHtml(S.newCompany)}\r\n          </button>\r\n      </div>\r\n      <div id=\"companies-list\" style=\"max-width: 800px;\">Loading...</div>\r\n    `;\r\n\r\n        bindListEvents(); // Re-bind since we replaced HTML\r\n        loadList();\r\n    }\r\n\r\n    function showForm(company?: Company) {\r\n        const isEdit = !!company;\r\n        const title = isEdit ? `Edit ${company.name}` : 'New Company';\r\n\r\n        // Breadcrumbs\r\n        const crumbs = [\r\n            { label: 'Settings' },\r\n            { label: 'Companies', onClick: showListView },\r\n            { label: isEdit ? 'Edit' : 'New' }\r\n        ];\r\n\r\n        contentWrapper.innerHTML = `\r\n      <div class=\"settings-breadcrumbs-container\"></div>\r\n      \r\n      <div style=\"max-width: 600px;\">\r\n          <h2 style=\"font-size: 1.5rem; margin: 0 0 24px 0; font-weight: 600;\">${escapeHtml(title)}</h2>\r\n          \r\n          <form id=\"company-form\" class=\"company-form\">\r\n            <div class=\"form-group\">\r\n              <label>${escapeHtml(S.name)}</label>\r\n              <input type=\"text\" name=\"name\" required value=\"${company ? escapeHtml(company.name) : ''}\" class=\"form-input\">\r\n            </div>\r\n            \r\n            <div class=\"form-group\">\r\n              <label>${escapeHtml(S.description)}</label>\r\n              <textarea name=\"description\" rows=\"3\" class=\"form-textarea\">${company?.description ? escapeHtml(company.description) : ''}</textarea>\r\n            </div>\r\n            \r\n            <div class=\"form-group\">\r\n              <label>${escapeHtml(S.logoUrl)}</label>\r\n              <input type=\"url\" name=\"logo_url\" value=\"${company?.logo_url ? escapeHtml(company.logo_url) : ''}\" class=\"form-input\" placeholder=\"https://...\">\r\n            </div>\r\n            \r\n            <div class=\"form-row\">\r\n                <div class=\"form-group\">\r\n                  <label>${escapeHtml(S.website)}</label>\r\n                  <input type=\"url\" name=\"website_url\" value=\"${company?.website_url ? escapeHtml(company.website_url) : ''}\" class=\"form-input\" placeholder=\"https://...\">\r\n                </div>\r\n                <div class=\"form-group\">\r\n                  <label>${escapeHtml(S.linkedIn)}</label>\r\n                  <input type=\"url\" name=\"linkedin_url\" value=\"${company?.linkedin_url ? escapeHtml(company.linkedin_url) : ''}\" class=\"form-input\" placeholder=\"https://linkedin.com/...\">\r\n                </div>\r\n            </div>\r\n\r\n            <div class=\"form-actions\">\r\n              <button type=\"submit\" class=\"btn btn-primary\" style=\"min-width: 100px;\">${isEdit ? escapeHtml(S.save) : escapeHtml(S.create)}</button>\r\n              <button type=\"button\" class=\"btn btn-secondary\" id=\"company-form-cancel\">${escapeHtml(S.cancel)}</button>\r\n            </div>\r\n            \r\n            ${isEdit && company ? `\r\n            <div style=\"margin-top: 24px; padding-top: 24px; border-top: 1px solid var(--border-color);\">\r\n              <h3 style=\"font-size: 1rem; margin-bottom: 12px;\">Documents</h3>\r\n              <button type=\"button\" class=\"btn btn-outline-secondary\" id=\"companies-templates-btn\" style=\"display: flex; align-items: center; gap: 8px;\">\r\n                <svg viewBox=\"0 0 24 24\" width=\"16\" height=\"16\" stroke=\"currentColor\" stroke-width=\"2\" fill=\"none\"><path d=\"M14 2H6a2 2 0 0 0-2 2v16a2 2 0 0 0 2 2h12a2 2 0 0 0 2-2V8z\"></path><polyline points=\"14 2 14 8 20 8\"></polyline><line x1=\"16\" y1=\"13\" x2=\"8\" y2=\"13\"></line><line x1=\"16\" y1=\"17\" x2=\"8\" y2=\"17\"></line><polyline points=\"10 9 9 9 8 9\"></polyline></svg>\r\n                ${escapeHtml(S.templates)}\r\n              </button>\r\n            </div>\r\n            ` : ''}\r\n          </form>\r\n      </div>\r\n    `;\r\n\r\n        const breadcrumbsContainer = contentWrapper.querySelector('.settings-breadcrumbs-container');\r\n        if (breadcrumbsContainer) breadcrumbsContainer.innerHTML = renderBreadcrumbs(crumbs);\r\n\r\n        // Bind breadcrumbs clicks\r\n        const listLink = breadcrumbsContainer?.querySelector('.breadcrumb-link');\r\n        if (listLink) on(listLink as HTMLElement, 'click', showListView);\r\n\r\n        on(contentWrapper.querySelector('#company-form') as HTMLFormElement, 'submit', async (e) => {\r\n            e.preventDefault();\r\n            const form = contentWrapper.querySelector('#company-form') as HTMLFormElement;\r\n            const fd = new FormData(form);\r\n            const logoUrl = (fd.get('logo_url') as string)?.trim() || undefined;\r\n            const websiteUrl = (fd.get('website_url') as string)?.trim() || undefined;\r\n            const linkedinUrl = (fd.get('linkedin_url') as string)?.trim() || undefined;\r\n            if (logoUrl && !isValidUrl(logoUrl)) { toast.error(S.invalidUrl + ' (Logo)'); return; }\r\n            if (websiteUrl && !isValidUrl(websiteUrl)) { toast.error(S.invalidUrl + ' (Website)'); return; }\r\n            if (linkedinUrl && !isValidUrl(linkedinUrl)) { toast.error(S.invalidUrl + ' (LinkedIn)'); return; }\r\n            const data: CreateCompanyRequest = {\r\n                name: (fd.get('name') as string).trim(),\r\n                description: (fd.get('description') as string)?.trim() || undefined,\r\n                logo_url: logoUrl,\r\n                website_url: websiteUrl,\r\n                linkedin_url: linkedinUrl,\r\n            };\r\n            try {\r\n                if (isEdit && company) {\r\n                    await updateCompany(company.id, data);\r\n                    toast.success('Company updated');\r\n                } else {\r\n                    await createCompany(data);\r\n                    toast.success('Company created');\r\n                }\r\n                showListView();\r\n            } catch {\r\n                toast.error(isEdit ? S.updateFailed : S.createFailed);\r\n            }\r\n        });\r\n\r\n        on(contentWrapper.querySelector('#company-form-cancel') as HTMLElement, 'click', showListView);\r\n\r\n        if (isEdit && company) {\r\n            const templatesBtn = contentWrapper.querySelector('#companies-templates-btn');\r\n            if (templatesBtn) on(templatesBtn as HTMLElement, 'click', () => showTemplateEditor(company));\r\n        }\r\n    }\r\n\r\n    function showTemplateEditor(company: Company) {\r\n        let currentType: TemplateType = 'a4';\r\n        let activeTab: 'code' | 'theme' = 'code';\r\n\r\n        const crumbs = [\r\n            { label: 'Settings' },\r\n            { label: 'Companies', onClick: showListView },\r\n            { label: 'Edit ' + company.name, onClick: () => showForm(company) },\r\n            { label: 'Templates' }\r\n        ];\r\n\r\n        contentWrapper.innerHTML = `\r\n      <div class=\"settings-breadcrumbs-container\"></div>\r\n      \r\n      <div class=\"template-editor-layout\">\r\n          <h2 class=\"companies-title\">${escapeHtml(company.name)}  ${escapeHtml(S.templates)}</h2>\r\n          <p class=\"companies-subtitle\">Manage the document templates for this company.</p>\r\n\r\n          <div class=\"template-toolbar\">\r\n              <div class=\"template-toolbar-group\">\r\n                <button type=\"button\" class=\"btn btn-sm template-type-btn active\" data-type=\"a4\">${escapeHtml(S.templateA4)}</button>\r\n                <button type=\"button\" class=\"btn btn-sm template-type-btn\" data-type=\"ppt\">${escapeHtml(S.templatePPT)}</button>\r\n              </div>\r\n              <div class=\"template-toolbar-group\">\r\n                <button type=\"button\" class=\"btn btn-sm btn-secondary\" id=\"template-load-btn\">${escapeHtml(S.loadCurrent)}</button>\r\n                <button type=\"button\" class=\"btn btn-sm btn-primary\" id=\"template-generate-btn\">${escapeHtml(S.generateWithAI)}</button>\r\n                <button type=\"button\" class=\"btn btn-sm btn-primary\" id=\"template-save-btn\">${escapeHtml(S.saveTemplate)}</button>\r\n              </div>\r\n          </div>\r\n          \r\n          <div class=\"template-workspace\">\r\n            <!-- Left Column: Editor & Controls -->\r\n            <div class=\"template-sidebar\">\r\n                <!-- Tabs -->\r\n                <div class=\"template-tabs\">\r\n                    <button type=\"button\" class=\"template-tab-btn active\" data-tab=\"code\">Code</button>\r\n                    <button type=\"button\" class=\"template-tab-btn\" data-tab=\"theme\">Theme</button>\r\n                </div>\r\n\r\n                <!-- Code Tab -->\r\n                <div id=\"editor-tab-code\" class=\"flex-1 flex-col\">\r\n                    <textarea id=\"template-html-editor\" class=\"template-code-area\" placeholder=\"HTML template...\"></textarea>\r\n                </div>\r\n\r\n                <!-- Theme Tab -->\r\n                <div id=\"editor-tab-theme\" class=\"template-theme-list hidden\">\r\n                    <p class=\"text-secondary mb-4 text-sm\">Detected styles from <code>:root</code> variables. Change colors to update the template.</p>\r\n                    <div id=\"theme-variables-list\" class=\"flex flex-col gap-3\"></div>\r\n                </div>\r\n            </div>\r\n\r\n            <!-- Right Column: Preview -->\r\n            <div class=\"template-preview-pane\">\r\n                <div class=\"template-preview-label\">Preview</div>\r\n                <div class=\"template-preview-container\">\r\n                    <iframe id=\"template-preview-frame\" class=\"template-preview-frame\" sandbox=\"allow-same-origin allow-scripts\"></iframe>\r\n                </div>\r\n            </div>\r\n          </div>\r\n      </div>\r\n      <style>\r\n        /* Template Type Buttons */\r\n        .template-type-btn {\r\n            background: var(--bg-surface);\r\n            color: var(--text-primary);\r\n            border: 1px solid var(--border-color);\r\n            padding: 6px 12px;\r\n            border-radius: 6px;\r\n            cursor: pointer;\r\n            font-size: 13px;\r\n        }\r\n        .template-type-btn:hover {\r\n            background: var(--bg-hover);\r\n        }\r\n        .template-type-btn.active {\r\n            background: var(--primary);\r\n            color: #ffffff !important;\r\n            border-color: var(--primary);\r\n        }\r\n      </style>\r\n    `;\r\n\r\n        const breadcrumbsContainer = contentWrapper.querySelector('.settings-breadcrumbs-container');\r\n        if (breadcrumbsContainer) {\r\n            breadcrumbsContainer.innerHTML = renderBreadcrumbs(crumbs);\r\n            const links = breadcrumbsContainer.querySelectorAll('.breadcrumb-link');\r\n            if (links[0]) on(links[0] as HTMLElement, 'click', showListView);\r\n            if (links[1]) on(links[1] as HTMLElement, 'click', () => showForm(company));\r\n        }\r\n\r\n        const editor = contentWrapper.querySelector('#template-html-editor') as HTMLTextAreaElement;\r\n        const loadBtn = contentWrapper.querySelector('#template-load-btn') as HTMLButtonElement;\r\n        const genBtn = contentWrapper.querySelector('#template-generate-btn') as HTMLButtonElement;\r\n        const saveBtn = contentWrapper.querySelector('#template-save-btn') as HTMLButtonElement;\r\n        const iframe = contentWrapper.querySelector('#template-preview-frame') as HTMLIFrameElement;\r\n        const themeList = contentWrapper.querySelector('#theme-variables-list') as HTMLElement;\r\n        const codeTabBtn = contentWrapper.querySelector('.template-tab-btn[data-tab=\"code\"]') as HTMLElement;\r\n        const themeTabBtn = contentWrapper.querySelector('.template-tab-btn[data-tab=\"theme\"]') as HTMLElement;\r\n        const codeTab = contentWrapper.querySelector('#editor-tab-code') as HTMLElement;\r\n        const themeTab = contentWrapper.querySelector('#editor-tab-theme') as HTMLElement;\r\n\r\n        // --- Preview Logic ---\r\n        function processTemplateForPreview(html: string): string {\r\n            if (!html) return '';\r\n            let processed = html;\r\n\r\n            // Basic Replacements\r\n            processed = processed.replace(/\\{\\{COMPANY_NAME\\}\\}/g, escapeHtml(company.name));\r\n            processed = processed.replace(/\\{\\{COMPANY_DESCRIPTION\\}\\}/g, escapeHtml(company.description || ''));\r\n            processed = processed.replace(/\\{\\{WEBSITE_URL\\}\\}/g, escapeHtml(company.website_url || ''));\r\n\r\n            // Color Replacements (from brand assets)\r\n            const primary = company.brand_assets?.primary_color || '#000000';\r\n            const secondary = company.brand_assets?.secondary_color || '#666666';\r\n            processed = processed.replace(/\\{\\{PRIMARY_COLOR\\}\\}/g, primary);\r\n            processed = processed.replace(/\\{\\{SECONDARY_COLOR\\}\\}/g, secondary);\r\n\r\n            // Logo Replacement:\r\n            // 1. If we have a logo URL on the company, always try to use it.\r\n            //    This replaces any existing {{LOGO_URL}} in the template.\r\n            if (company.logo_url) {\r\n                processed = processed.replace(/\\{\\{LOGO_URL\\}\\}/gi, company.logo_url);\r\n            } else {\r\n                // 2. If no logo URL, replace with a nice placeholder\r\n                processed = processed.replace(/\\{\\{LOGO_URL\\}\\}/gi, 'https://placehold.co/200x80/EEE/31343C?text=LOGO');\r\n            }\r\n\r\n            // Mock Report Data for Preview (so it looks populated)\r\n            const mockData = `\r\n            <h2>1. Ficha de Identidade</h2>\r\n                <p><strong>Nome: </strong> ${escapeHtml(company.name)}</p>\r\n                    <p><strong>Setor: </strong> Consultoria Tecnolgica</p>\r\n                        <p><strong>Descrio: </strong> ${escapeHtml(company.description || 'Empresa lder em inovao...')}</p>\r\n\r\n                            <h2>2. Viso Geral</h2>\r\n                                <p>A ${escapeHtml(company.name)} demonstra um forte posicionamento no mercado...</p>\r\n\r\n                                    <h2>3. Anlise SWOT</h2>\r\n                                        <ul>\r\n                                        <li><strong>Foras: </strong> Tecnologia proprietria, Equipa experiente</li>\r\n                                            <li><strong>Fraquezas: </strong> Baixa presena internacional</li>\r\n                                                </ul>\r\n                                                    `;\r\n            processed = processed.replace(/\\{\\{REPORT_DATA\\}\\}/g, mockData);\r\n\r\n            return processed;\r\n        }\r\n\r\n        function updatePreview() {\r\n            const doc = iframe.contentDocument;\r\n            if (!doc) return;\r\n\r\n            const rawHtml = editor.value || '';\r\n            const processedHtml = processTemplateForPreview(rawHtml);\r\n\r\n            doc.open();\r\n            doc.write(processedHtml);\r\n            doc.close();\r\n        }\r\n\r\n        // Debounce update\r\n        let debounceTimer: any;\r\n        editor.addEventListener('input', () => {\r\n            clearTimeout(debounceTimer);\r\n            debounceTimer = setTimeout(() => {\r\n                updatePreview();\r\n                if (activeTab === 'theme') extractAndRenderTheme();\r\n            }, 300);\r\n        });\r\n\r\n        // --- Tab Logic ---\r\n        function switchTab(tab: 'code' | 'theme') {\r\n            activeTab = tab;\r\n            if (tab === 'code') {\r\n                codeTabBtn.classList.add('active');\r\n                themeTabBtn.classList.remove('active');\r\n                codeTab.style.display = 'flex';\r\n                themeTab.style.display = 'none';\r\n            } else {\r\n                codeTabBtn.classList.remove('active');\r\n                themeTabBtn.classList.add('active');\r\n                codeTab.style.display = 'none';\r\n                themeTab.style.display = 'flex';\r\n                extractAndRenderTheme();\r\n            }\r\n        }\r\n        on(codeTabBtn, 'click', () => switchTab('code'));\r\n        on(themeTabBtn, 'click', () => switchTab('theme'));\r\n\r\n        // --- Visual Editor Logic ---\r\n        function extractAndRenderTheme() {\r\n            const html = editor.value || '';\r\n\r\n            // 1. Try to find style block content first\r\n            const styleMatch = html.match(/<style[^>]*>([\\s\\S]*?)<\\/style>/i);\r\n            const cssContent = styleMatch ? styleMatch[1] : html;\r\n\r\n            // 2. Match :root block (case insensitive, multiline)\r\n            const rootMatch = cssContent.match(/:root\\s*\\{([\\s\\S]*?)\\}/i);\r\n\r\n            if (!rootMatch) {\r\n                themeList.innerHTML = '<p style=\"color: var(--text-secondary);\">No <code>:root</code> CSS variables found. Ensure your template has a <code>&lt;style&gt;:root { ... }&lt;/style&gt;</code> block.</p>';\r\n                return;\r\n            }\r\n\r\n            const rootContent = rootMatch[1];\r\n            // Regex to find --variable: value;\r\n            // Improved to handle value ending with ; or } (last item)\r\n            // and ignore comments /* ... */ (basic handling)\r\n            const cleanContent = rootContent.replace(/\\/\\*[\\s\\S]*?\\*\\//g, '');\r\n\r\n            const varRegex = /--([a-zA-Z0-9-]+):\\s*([^;\\}]+)/g;\r\n            let match;\r\n            const vars: { name: string, value: string }[] = [];\r\n\r\n            while ((match = varRegex.exec(cleanContent)) !== null) {\r\n                vars.push({ name: match[1], value: match[2].trim() });\r\n            }\r\n\r\n            themeList.innerHTML = '';\r\n\r\n            vars.forEach(v => {\r\n                // Determine input type\r\n                const isColor = /^#[0-9A-Fa-f]{3,8}$|^rgb|^hsl/.test(v.value);\r\n\r\n                const div = document.createElement('div');\r\n                div.style.cssText = 'display: flex; align-items: center; justify-content: space-between; padding: 8px; background: var(--bg-hover); border-radius: 6px;';\r\n\r\n                div.innerHTML = `\r\n                                                <div style=\"font-weight: 500; font-size: 0.9em; color: var(--text-primary);\">${escapeHtml(v.name)}</div>\r\n                                                    <div style=\"display: flex; align-items: center; gap: 8px;\">\r\n                                                        ${isColor ? `<input type=\"color\" data-var=\"${v.name}\" value=\"${v.value.startsWith('#') ? v.value.substring(0, 7) : '#000000'}\" style=\"width: 32px; height: 32px; padding: 0; border: none; border-radius: 4px; cursor: pointer;\">` : ''}\r\n        <input type=\"text\" data-var=\"${v.name}\" value=\"${escapeHtml(v.value)}\" style=\"width: 100px; padding: 4px 8px; font-size: 0.85em; border-radius: 4px; border: 1px solid var(--border-color); color: var(--text-primary); background: var(--bg-surface);\">\r\n            </div>\r\n                `;\r\n                themeList.appendChild(div);\r\n\r\n                // Bind change events\r\n                const inputs = div.querySelectorAll('input');\r\n                inputs.forEach(input => {\r\n                    input.addEventListener('input', (e) => {\r\n                        const newVal = (e.target as HTMLInputElement).value;\r\n                        const otherInput = inputs.length > 1 ? (input.type === 'color' ? inputs[1] : inputs[0]) : null;\r\n                        if (otherInput) otherInput.value = newVal; // Sync hex text <-> color picker\r\n\r\n                        updateVariable(v.name, newVal);\r\n                    });\r\n                });\r\n            });\r\n        }\r\n\r\n        function updateVariable(name: string, value: string) {\r\n            let css = editor.value;\r\n            // Replace the specific variable value in :root\r\n            // We use a safe regex that looks for the variable definition\r\n            const re = new RegExp(`(--${name}: \\\\s *)([^;]+) (;)`);\r\n            if (re.test(css)) {\r\n                editor.value = css.replace(re, `$1${value} $3`);\r\n                updatePreview();\r\n            }\r\n        }\r\n\r\n        function setType(type: TemplateType) {\r\n            currentType = type;\r\n            contentWrapper.querySelectorAll('.template-type-btn').forEach((b) => b.classList.toggle('active', (b as HTMLElement).getAttribute('data-type') === type));\r\n\r\n            // Adjust Preview Dimensions\r\n            if (type === 'ppt') {\r\n                iframe.style.width = '297mm'; // Landscape A4 / Slide\r\n                iframe.style.minHeight = '210mm';\r\n            } else {\r\n                iframe.style.width = '210mm'; // Portrait A4\r\n                iframe.style.minHeight = '297mm';\r\n            }\r\n\r\n            // Reload template\r\n            getTemplate(company.id, currentType).then((html) => {\r\n                editor.value = html;\r\n                updatePreview();\r\n                if (activeTab === 'theme') extractAndRenderTheme();\r\n            }).catch(() => { editor.value = ''; updatePreview(); });\r\n        }\r\n\r\n        contentWrapper.querySelectorAll('.template-type-btn').forEach((btn) => {\r\n            on(btn as HTMLElement, 'click', () => setType((btn.getAttribute('data-type') as TemplateType) || 'a4'));\r\n        });\r\n\r\n        // Button Listeners\r\n        on(loadBtn, 'click', async () => {\r\n            loadBtn.disabled = true;\r\n            try {\r\n                const html = await getTemplate(company.id, currentType);\r\n                editor.value = html;\r\n                updatePreview();\r\n                if (activeTab === 'theme') extractAndRenderTheme();\r\n                toast.success(S.templateLoaded);\r\n            } catch {\r\n                toast.error(S.templateLoadFailed);\r\n            } finally {\r\n                loadBtn.disabled = false;\r\n            }\r\n        });\r\n\r\n        on(genBtn, 'click', async () => {\r\n            genBtn.disabled = true;\r\n            genBtn.textContent = '...';\r\n            try {\r\n                const { html } = await generateTemplate(company.id, currentType);\r\n                editor.value = html;\r\n                updatePreview();\r\n                if (activeTab === 'theme') extractAndRenderTheme();\r\n                toast.success(S.templateGenerated);\r\n            } catch {\r\n                toast.error(S.templateGenerateFailed);\r\n            } finally {\r\n                genBtn.disabled = false;\r\n                genBtn.textContent = S.generateWithAI;\r\n            }\r\n        });\r\n\r\n        on(saveBtn, 'click', async () => {\r\n            saveBtn.disabled = true;\r\n            try {\r\n                await updateTemplate(company.id, currentType, editor.value);\r\n                toast.success(S.templateSaved);\r\n            } catch {\r\n                toast.error(S.templateSaveFailed);\r\n            } finally {\r\n                saveBtn.disabled = false;\r\n            }\r\n        });\r\n\r\n        // Initial load\r\n        getTemplate(company.id, currentType).then((html) => {\r\n            editor.value = html;\r\n            updatePreview();\r\n        }).catch(() => { });\r\n    }\r\n\r\n    const REPORT_SECTION_LABELS: Record<string, string> = {\r\n        ficha_identidade: '1. Ficha de Identidade',\r\n        visao_geral: '2. Viso Geral e Posicionamento',\r\n        produtos_servicos: '3. Produtos e Servios',\r\n        publico_alvo: '4. Pblico-Alvo e Clientes',\r\n        equipa_lideranca: '5. Equipa e Liderana',\r\n        presenca_digital: '6. Presena Digital e Marketing',\r\n        analise_competitiva: '7. Anlise Competitiva',\r\n        indicadores_crescimento: '8. Indicadores de Crescimento',\r\n        swot: '9. Anlise SWOT',\r\n        conclusoes: '10. Concluses e Insights',\r\n    };\r\n\r\n    function showDetailView(company: Company) {\r\n        const ba = company.brand_assets;\r\n        const report = ba?.analysis_report || {};\r\n        const hasReport = Object.keys(report).length > 0;\r\n\r\n        // Section Keys\r\n        const identityKey = 'ficha_identidade';\r\n        const otherKeys = Object.keys(REPORT_SECTION_LABELS).filter(k => k !== identityKey);\r\n        const allKeys = [identityKey, ...otherKeys];\r\n\r\n        // State for active section\r\n        let activeSectionKey = identityKey;\r\n\r\n        // Breadcrumbs\r\n        const crumbs = [\r\n            { label: 'Settings' },\r\n            { label: 'Companies', onClick: showListView },\r\n            { label: company.name }\r\n        ];\r\n\r\n        // Header Elements (Logo, etc)\r\n        const logoBlock = company.logo_url\r\n            ? `<img src=\"${escapeHtml(company.logo_url)}\" alt=\"\" class=\"companies-detail-logo\" style=\"width: 56px; height: 56px; object-fit: contain; background: white; padding: 4px; border-radius: 8px; border: 1px solid var(--border-color); box-shadow: 0 1px 3px rgba(0,0,0,0.05);\" onerror=\"this.style.display='none'\">`\r\n            : '<span class=\"companies-detail-logo-placeholder\" style=\"width: 56px; height: 56px; display: inline-flex; align-items: center; justify-content: center; background: linear-gradient(135deg, var(--bg-secondary) 0%, var(--border-color) 100%); border-radius: 8px; font-size: 24px; color: var(--text-secondary);\"></span>';\r\n\r\n        const baPrimary = ba?.primary_color || '';\r\n        const baSecondary = ba?.secondary_color || '';\r\n        const colorBlock = (baPrimary !== '' || baSecondary !== '')\r\n            ? `\r\n            <div style=\"display: flex; gap: 6px; align-items: center; justify-content: center; padding: 4px 8px; background: var(--bg-surface); border: 1px solid var(--border-color); border-radius: 6px;\" title=\"Brand Colors\">\r\n                ${baPrimary !== '' ? `<span style=\"width: 14px; height: 14px; border-radius: 3px; background: ${escapeHtml(baPrimary)}; box-shadow: inset 0 0 0 1px rgba(0,0,0,0.1);\"></span>` : ''}\r\n            ${baSecondary !== '' ? `<span style=\"width: 14px; height: 14px; border-radius: 3px; background: ${escapeHtml(baSecondary)}; box-shadow: inset 0 0 0 1px rgba(0,0,0,0.1);\"></span>` : ''}\r\n        </div>\r\n            ` : '';\r\n\r\n        // Main Layout Template\r\n        // Main Layout Template\r\n        contentWrapper.innerHTML = `\r\n            <div class=\"settings-breadcrumbs-container\"></div>\r\n\r\n            <div class=\"companies-list-container\">\r\n\r\n                <!-- Header -->\r\n                <div class=\"detail-header-card\">\r\n                    ${logoBlock}\r\n                    <div class=\"flex-1\">\r\n                        <div class=\"flex-item-center gap-sm mb-1\">\r\n                            <h3 class=\"companies-title\" style=\"font-size: 1.4rem;\">${escapeHtml(company.name)}</h3>\r\n                            ${colorBlock}\r\n                        </div>\r\n                        <div class=\"flex-item-center gap-md\">\r\n                            ${company.website_url ? `<a href=\"${escapeHtml(company.website_url)}\" target=\"_blank\" class=\"companies-website-link flex-item-center gap-xs\"><svg viewBox=\"0 0 24 24\" width=\"12\" height=\"12\" stroke=\"currentColor\" stroke-width=\"2\" fill=\"none\"><circle cx=\"12\" cy=\"12\" r=\"10\"></circle><line x1=\"2\" y1=\"12\" x2=\"22\" y2=\"12\"></line><path d=\"M12 2a15.3 15.3 0 0 1 4 10 15.3 15.3 0 0 1-4 10 15.3 15.3 0 0 1-4-10 15.3 15.3 0 0 1 4-10z\"></path></svg> ${escapeHtml(company.website_url.replace(/^https?:\\/\\//, ''))}</a>` : ''}\r\n                            ${company.linkedin_url ? `<a href=\"${escapeHtml(company.linkedin_url)}\" target=\"_blank\" class=\"companies-website-link flex-item-center gap-xs\" style=\"color: #0077b5;\"><svg viewBox=\"0 0 24 24\" width=\"12\" height=\"12\" stroke=\"currentColor\" stroke-width=\"2\" fill=\"none\"><path d=\"M16 8a6 6 0 0 1 6 6v7h-4v-7a2 2 0 0 0-2-2 2 2 0 0 0-2 2v7h-4v-7a6 6 0 0 1 6-6z\"></path><rect x=\"2\" y=\"9\" width=\"4\" height=\"12\"></rect><circle cx=\"4\" cy=\"4\" r=\"2\"></circle></svg> LinkedIn</a>` : ''}\r\n                        </div>\r\n                    </div>\r\n\r\n                    <div class=\"companies-actions\">\r\n                        <button type=\"button\" class=\"btn btn-sm btn-primary\" id=\"companies-detail-reanalyze-btn\" data-id=\"${escapeHtml(company.id)}\">\r\n                            <svg viewBox=\"0 0 24 24\" width=\"14\" height=\"14\" stroke=\"currentColor\" stroke-width=\"2\" fill=\"none\" style=\"margin-right: 6px;\"><path d=\"M23 4v6h-6\"></path><path d=\"M1 20v-6h6\"></path><path d=\"M3.51 9a9 9 0 0 1 14.85-3.36L23 10M1 14l4.64 4.36A9 9 0 0 0 20.49 15\"></path></svg>\r\n                            ${escapeHtml(S.reAnalyze)}\r\n                        </button>\r\n                        <button type=\"button\" class=\"btn btn-sm btn-secondary\" id=\"companies-detail-edit-btn\" data-id=\"${escapeHtml(company.id)}\">\r\n                            ${escapeHtml(S.edit)}\r\n                        </button>\r\n                    </div>\r\n                </div>\r\n\r\n                <!-- Content Grid -->\r\n                <div class=\"companies-detail-grid\">\r\n                    \r\n                    <!-- Sidebar -->\r\n                    <div class=\"detail-sidebar\">\r\n                        <div class=\"detail-sidebar-header\">Report Sections</div>\r\n                        \r\n                        ${hasReport ? allKeys.map(key => {\r\n            const label = REPORT_SECTION_LABELS[key] || key;\r\n            const cleanLabel = label.replace(/^\\d+\\.\\s*/, '');\r\n            return `\r\n                            <div class=\"detail-sidebar-item ${key === activeSectionKey ? 'active' : ''}\" data-key=\"${key}\" role=\"button\">\r\n                                <span>${escapeHtml(cleanLabel)}</span>\r\n                                ${key === activeSectionKey ? '<svg viewBox=\"0 0 24 24\" width=\"16\" height=\"16\" stroke=\"currentColor\" stroke-width=\"2\" fill=\"none\"><polyline points=\"9 18 15 12 9 6\"></polyline></svg>' : ''}\r\n                            </div>\r\n                            `;\r\n        }).join('') : `<div class=\"companies-empty-state-sm\">No report data available.</div>`}\r\n                    </div>\r\n\r\n                    <!-- Main Content Area -->\r\n                    <div class=\"detail-content-area custom-scrollbar\" id=\"detail-content-main\">\r\n                        <!-- Content injected via JS -->\r\n                    </div>\r\n                </div>\r\n            </div>\r\n        `;\r\n        // Wire Breadcrumbs\r\n        const breadcrumbsContainer = contentWrapper.querySelector('.settings-breadcrumbs-container');\r\n        if (breadcrumbsContainer) {\r\n            breadcrumbsContainer.innerHTML = renderBreadcrumbs(crumbs);\r\n            const links = breadcrumbsContainer.querySelectorAll('.breadcrumb-link');\r\n            if (links[0]) on(links[0] as HTMLElement, 'click', showListView);\r\n        }\r\n\r\n        // Header Actions\r\n        on(contentWrapper.querySelector('#companies-detail-edit-btn') as HTMLElement, 'click', () => showForm(company));\r\n\r\n        const reanalyzeBtn = contentWrapper.querySelector('#companies-detail-reanalyze-btn') as HTMLButtonElement;\r\n        on(reanalyzeBtn, 'click', async () => {\r\n            reanalyzeBtn.disabled = true;\r\n            reanalyzeBtn.innerHTML = '<span class=\"spinner-sm\"></span> Analyzing...';\r\n            try {\r\n                const updated = await analyzeCompany(company.id);\r\n                toast.success(S.analysisComplete);\r\n                showDetailView(updated);\r\n            } catch {\r\n                toast.error(S.analysisFailed);\r\n                reanalyzeBtn.innerHTML = S.reAnalyze; // Restore icon too\r\n                reanalyzeBtn.disabled = false;\r\n            }\r\n        });\r\n\r\n        // Content Rendering Logic\r\n        const contentArea = contentWrapper.querySelector('#detail-content-main') as HTMLElement;\r\n        const sidebarItems = contentWrapper.querySelectorAll('.detail-sidebar-item');\r\n\r\n        function renderActiveContent() {\r\n            if (!hasReport) {\r\n                contentArea.innerHTML = `< div style = \"display: flex; flex-direction: column; align-items: center; justify-content: center; height: 100%; color: var(--text-secondary); text-align: center;\" >\r\n            <div style=\"font-size: 32px; margin-bottom: 16px;\" ></div>\r\n                < p > No analysis data available yet.</p>\r\n                    < p style = \"font-size: 0.9rem;\" > Click < strong > Re - analyze < /strong> to generate a comprehensive report.</p >\r\n                        </div>`;\r\n                return;\r\n            }\r\n\r\n            const label = REPORT_SECTION_LABELS[activeSectionKey] || activeSectionKey;\r\n            const cleanLabel = label.replace(/^\\d+\\.\\s*/, '');\r\n            const rawText = report[activeSectionKey as keyof typeof report] || 'No content for this section.';\r\n\r\n            // Format text (Basic markdown-like to HTML)\r\n            // Note: In production we might want a real markdown renderer, for now use escape + line breaks\r\n            const formattedText = escapeHtml(rawText)\r\n                .replace(/\\n\\n/g, '</p><p>')\r\n                .replace(/\\n/g, '<br>')\r\n                .replace(/\\*\\*(.*?)\\*\\*/g, '<strong>$1</strong>'); // Simple bold support\r\n\r\n            contentArea.innerHTML = `\r\n                <h2 style=\"font-size: 1.5rem; font-weight: 700; color: var(--text-primary); margin: 0 0 24px 0; padding-bottom: 16px; border-bottom: 1px solid var(--border-color);\">${escapeHtml(cleanLabel)}</h2>\r\n                <div class=\"content-prose\">\r\n                    <p>${formattedText}</p>\r\n                </div>\r\n            `;\r\n        }\r\n\r\n        // Sidebar Interactions\r\n        sidebarItems.forEach(item => {\r\n            on(item as HTMLElement, 'click', () => {\r\n                const key = item.getAttribute('data-key');\r\n                if (key && key !== activeSectionKey) {\r\n                    activeSectionKey = key;\r\n\r\n                    // Update active state in sidebar\r\n                    sidebarItems.forEach(i => {\r\n                        if (i.getAttribute('data-key') === activeSectionKey) {\r\n                            i.classList.add('active');\r\n                            // Re-inject the SVG arrow for the active item\r\n                            if (!i.querySelector('svg')) {\r\n                                const span = i.querySelector('span');\r\n                                if (span) span.insertAdjacentHTML('afterend', '<svg viewBox=\"0 0 24 24\" width=\"16\" height=\"16\" stroke=\"currentColor\" stroke-width=\"2\" fill=\"none\"><polyline points=\"9 18 15 12 9 6\"></polyline></svg>');\r\n                            }\r\n                        } else {\r\n                            i.classList.remove('active');\r\n                            const svg = i.querySelector('svg');\r\n                            if (svg) svg.remove();\r\n                        }\r\n                    });\r\n\r\n                    // Render content\r\n                    renderActiveContent();\r\n                }\r\n            });\r\n        });\r\n\r\n        // Initial render\r\n        renderActiveContent();\r\n    }\r\n    function bindListEvents() {\r\n        /* Event delegation for list */\r\n        on(contentWrapper, 'click', async (e) => {\r\n            const target = e.target as HTMLElement;\r\n\r\n            // New Company\r\n            if (target.closest('#companies-new-btn')) {\r\n                showForm();\r\n                return;\r\n            }\r\n\r\n            const editBtn = target.closest('.companies-edit-btn');\r\n            const templatesBtn = target.closest('.companies-templates-list-btn');\r\n            const analyzeBtn = target.closest('.companies-analyze-btn');\r\n            const detailBtn = target.closest('.companies-detail-btn');\r\n            const deleteBtn = target.closest('.companies-delete-btn');\r\n            const id = (editBtn || templatesBtn || analyzeBtn || detailBtn || deleteBtn)?.getAttribute('data-id');\r\n\r\n            if (!id) return;\r\n\r\n            if (detailBtn) {\r\n                try {\r\n                    const c = await getCompany(id);\r\n                    if (c) showDetailView(c);\r\n                } catch {\r\n                    toast.error(S.loadFailed);\r\n                }\r\n                return;\r\n            }\r\n            if (templatesBtn) {\r\n                try {\r\n                    const c = await getCompany(id);\r\n                    if (c) showTemplateEditor(c);\r\n                } catch {\r\n                    toast.error(S.loadFailed);\r\n                }\r\n                return;\r\n            }\r\n            if (editBtn) {\r\n                try {\r\n                    const c = await getCompany(id);\r\n                    if (c) showForm(c);\r\n                } catch {\r\n                    toast.error(S.loadFailed);\r\n                }\r\n                return;\r\n            }\r\n            if (analyzeBtn) {\r\n                const btn = analyzeBtn as HTMLButtonElement;\r\n                btn.disabled = true;\r\n                const origText = btn.textContent;\r\n                // Find the text node to replace if it exists, or just append spinner\r\n                // Simple way:\r\n                btn.innerHTML = '<span class=\"spinner-sm\"></span>';\r\n\r\n                try {\r\n                    await analyzeCompany(id);\r\n                    toast.success(S.analysisComplete);\r\n                    loadList();\r\n                } catch {\r\n                    toast.error(S.analysisFailed);\r\n                    btn.innerHTML = origText || ''; // Restore\r\n                    btn.disabled = false;\r\n                }\r\n                return;\r\n            }\r\n            if (deleteBtn) {\r\n                if (!confirm(S.deleteConfirm)) return;\r\n                try {\r\n                    await deleteCompany(id);\r\n                    toast.success(S.companyDeleted);\r\n                    loadList();\r\n                } catch {\r\n                    // API client already shows error toast\r\n                }\r\n            }\r\n        });\r\n    }\r\n\r\n    // Start with list view\r\n    showListView();\r\n}\r\n","/**\r\n * Settings Modal Component - User Preferences\r\n * Simplified modal for user settings (Theme, Language, Data & Privacy)\r\n * Admin/LLM settings are now in the Admin panel (sidebar)\r\n */\r\n\r\nimport { createElement, on } from '@lib/dom';\r\nimport { appStore } from '@stores/app';\r\nimport { theme } from '@services/theme';\r\nimport { toast } from '@services/toast';\r\n\r\n\r\nconst MODAL_ID = 'settings-modal';\r\n\r\nimport { initCompaniesPanel } from '@components/settings/CompaniesPanel';\r\n\r\nexport interface SettingsModalProps {\r\n  onSave?: (settings: Record<string, unknown>) => void;\r\n  initialTab?: 'general' | 'data';\r\n}\r\n\r\nexport interface SettingsBindOptions {\r\n  onClose?: () => void;\r\n  onSaveSuccess?: () => void;\r\n  onSave?: (settings: Record<string, unknown>) => void;\r\n}\r\n\r\n/**\r\n * Get settings card + styles HTML (shared by modal and full page).\r\n * When pageMode is true, uses dashboard layout styles.\r\n */\r\nexport function getSettingsMarkup(\r\n  state: ReturnType<typeof appStore.getState>,\r\n  currentTheme: string,\r\n  initialTab: 'general' | 'data' | 'companies',\r\n  options?: { pageMode?: boolean }\r\n): string {\r\n  const pageMode = options?.pageMode ?? false;\r\n  /* In Page Mode, header is handled by main layout (tab-header) */\r\n  const closeButtonHtml = pageMode\r\n    ? '' // No back button in dashboard tab mode\r\n    : `<button class=\"settings-close\" id=\"close-settings-btn\">\r\n        <svg viewBox=\"0 0 24 24\" fill=\"none\" stroke=\"currentColor\" stroke-width=\"2\">\r\n          <path d=\"M18 6L6 18M6 6l12 12\"/>\r\n        </svg>\r\n      </button>`;\r\n\r\n  return `\r\n    <style>\r\n      .settings-modal-overlay {\r\n        position: fixed;\r\n        inset: 0;\r\n        background: rgba(0, 0, 0, 0.5);\r\n        backdrop-filter: blur(4px);\r\n        display: flex;\r\n        align-items: center;\r\n        justify-content: center;\r\n        z-index: 1000;\r\n        padding: 20px;\r\n      }\r\n      \r\n      .settings-modal-container {\r\n        font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, sans-serif;\r\n        width: 100%;\r\n        max-width: 520px;\r\n      }\r\n\r\n      .settings-modal-container.full-page {\r\n        max-width: none;\r\n        width: 100%;\r\n        margin: 0;\r\n        padding: 0;\r\n        height: 100%;\r\n        display: flex;\r\n        flex-direction: column;\r\n      }\r\n      \r\n      .settings-card {\r\n        background: linear-gradient(135deg, rgba(255,255,255,0.98) 0%, rgba(248,250,252,0.98) 100%);\r\n        backdrop-filter: blur(20px);\r\n        border-radius: 20px;\r\n        box-shadow: \r\n          0 25px 50px -12px rgba(0, 0, 0, 0.15),\r\n          0 0 0 1px rgba(255, 255, 255, 0.8);\r\n        overflow: hidden;\r\n      }\r\n      \r\n      [data-theme=\"dark\"] .settings-card {\r\n        background: linear-gradient(135deg, rgba(30,41,59,0.98) 0%, rgba(15,23,42,0.98) 100%);\r\n        box-shadow: \r\n          0 25px 50px -12px rgba(0, 0, 0, 0.5),\r\n          0 0 0 1px rgba(255, 255, 255, 0.1);\r\n      }\r\n\r\n      /* =========================================\r\n       * DASHBOARD PAGE MODE STYLES\r\n       * No Modal, Clean Dashboard Layout\r\n       * ========================================= */\r\n      .settings-page-card {\r\n        box-shadow: none !important;\r\n        background: transparent !important;\r\n        backdrop-filter: none !important;\r\n        border-radius: 0 !important;\r\n        display: grid;\r\n        grid-template-columns: 260px minmax(0, 1fr);\r\n        grid-template-rows: auto auto;\r\n        grid-template-areas:\r\n          \"tabs body\"\r\n          \"tabs footer\";\r\n        gap: 0 24px;\r\n        align-items: start;\r\n        padding-top: 24px; /* Space from top (title in main layout) */\r\n      }\r\n\r\n      /* Hide Header in Page Mode (handled by main layout) */\r\n      .settings-page-card .settings-header {\r\n        display: none !important;\r\n      }\r\n\r\n      /* TABS CARD (Left Sidebar) */\r\n      .settings-page-card .settings-tabs {\r\n        grid-area: tabs;\r\n        flex-direction: column;\r\n        background: var(--bg-surface, #ffffff);\r\n        border: 1px solid var(--border-color, rgba(0,0,0,0.1));\r\n        border-radius: 12px;\r\n        padding: 12px;\r\n        margin: 0;\r\n        gap: 4px;\r\n        box-shadow: 0 1px 2px rgba(0,0,0,0.05);\r\n        height: fit-content;\r\n        position: sticky;\r\n        top: 24px;\r\n      }\r\n\r\n      [data-theme=\"dark\"] .settings-page-card .settings-tabs {\r\n        background: var(--bg-surface, #1e293b);\r\n        border-color: rgba(255,255,255,0.1);\r\n      }\r\n\r\n      .settings-page-card .settings-tab {\r\n        border-radius: 8px;\r\n        padding: 10px 14px;\r\n        font-size: 0.9rem;\r\n        font-weight: 500;\r\n        justify-content: flex-start;\r\n        width: 100%;\r\n        color: var(--text-secondary);\r\n        transition: all 0.2s ease;\r\n        border: 1px solid transparent;\r\n      }\r\n\r\n      .settings-page-card .settings-tab:hover {\r\n        background: var(--bg-secondary, #f1f5f9);\r\n        color: var(--text-primary);\r\n      }\r\n\r\n      .settings-page-card .settings-tab.active {\r\n        background: var(--bg-secondary, #f1f5f9);\r\n        color: var(--accent, #e11d48);\r\n        border-color: rgba(225, 29, 72, 0.1);\r\n      }\r\n\r\n      [data-theme=\"dark\"] .settings-page-card .settings-tab.active {\r\n        background: rgba(255,255,255,0.05);\r\n        color: #fb7185;\r\n        border-color: rgba(251, 113, 133, 0.2);\r\n      }\r\n\r\n      /* CONTENT CARD (Right Main Area) */\r\n      .settings-page-card .settings-body {\r\n        grid-area: body;\r\n        background: var(--bg-surface, #ffffff);\r\n        border: 1px solid var(--border-color, rgba(0,0,0,0.1));\r\n        border-bottom: none; /* Merged with footer */\r\n        border-radius: 12px 12px 0 0;\r\n        padding: 32px;\r\n        max-height: none;\r\n        box-shadow: 0 1px 2px rgba(0,0,0,0.05);\r\n      }\r\n\r\n      [data-theme=\"dark\"] .settings-page-card .settings-body {\r\n        background: var(--bg-surface, #1e293b);\r\n        border-color: rgba(255,255,255,0.1);\r\n      }\r\n\r\n      /* FOOTER (Merged with Body) */\r\n      .settings-page-card .settings-footer {\r\n        grid-area: footer;\r\n        margin-top: 0;\r\n        background: var(--bg-surface, #ffffff);\r\n        border: 1px solid var(--border-color, rgba(0,0,0,0.1));\r\n        border-top: 1px solid var(--border-color, rgba(0,0,0,0.05));\r\n        border-radius: 0 0 12px 12px;\r\n        padding: 24px 32px;\r\n        display: flex;\r\n        justify-content: flex-end;\r\n        gap: 12px;\r\n        box-shadow: 0 1px 2px rgba(0,0,0,0.05);\r\n      }\r\n\r\n      [data-theme=\"dark\"] .settings-page-card .settings-footer {\r\n        background: var(--bg-surface, #1e293b);\r\n        border-color: rgba(255,255,255,0.1);\r\n        border-top-color: rgba(255,255,255,0.05);\r\n      }\r\n      \r\n      /* Responsive */\r\n      @media (max-width: 900px) {\r\n        .settings-page-card {\r\n           grid-template-columns: 1fr;\r\n           grid-template-rows: auto auto auto;\r\n           grid-template-areas:\r\n             \"tabs\"\r\n             \"body\"\r\n             \"footer\";\r\n           gap: 16px;\r\n        }\r\n        .settings-page-card .settings-tabs {\r\n          flex-direction: row;\r\n          padding: 8px;\r\n          margin-bottom: 0;\r\n          overflow-x: auto;\r\n          position: static;\r\n        }\r\n        .settings-page-card .settings-tab {\r\n          white-space: nowrap;\r\n          width: auto;\r\n        }\r\n        .settings-page-card .settings-body {\r\n          border-radius: 12px 12px 0 0;\r\n          padding: 24px;\r\n        }\r\n        .settings-page-card .settings-footer {\r\n          border-radius: 0 0 12px 12px;\r\n          padding: 16px 24px;\r\n        }\r\n      }\r\n      .settings-page-card .settings-header {\r\n        grid-area: header;\r\n        border-radius: 0;\r\n        margin-bottom: 0;\r\n        background: transparent;\r\n        box-shadow: none;\r\n        border-bottom: 1px solid var(--border-color, rgba(0,0,0,0.05));\r\n        padding: 0 0 16px 0; /* Remove horizontal padding to align with content */\r\n        margin: 0 24px; /* Add margin to align with body content if needed, or remove if full bleed */\r\n      }\r\n\r\n      [data-theme=\"dark\"] .settings-page-card .settings-header {\r\n        border-bottom-color: rgba(255,255,255,0.05);\r\n      }\r\n\r\n      .settings-page-card .settings-header::before {\r\n        display: none;\r\n      }\r\n\r\n      .settings-page-card .settings-header-content {\r\n        flex-direction: row-reverse;\r\n        justify-content: flex-end;\r\n      }\r\n\r\n      .settings-page-card .settings-icon {\r\n        display: none; \r\n      }\r\n\r\n      .settings-page-card .settings-title h2 {\r\n        color: var(--text-primary);\r\n        font-size: 1.5rem;\r\n        text-shadow: none;\r\n      }\r\n\r\n      .settings-page-card .settings-title p {\r\n        color: var(--text-secondary);\r\n      }\r\n\r\n      .settings-page-card .settings-back {\r\n        position: relative;\r\n        top: auto;\r\n        right: auto;\r\n        background: transparent !important;\r\n        color: var(--text-secondary);\r\n        padding: 8px 12px;\r\n        border-radius: 8px;\r\n        margin-right: 16px; \r\n        border: 1px solid var(--border-color, rgba(0,0,0,0.1));\r\n      }\r\n      \r\n      .settings-page-card .settings-back:hover {\r\n        background: var(--bg-secondary) !important;\r\n        color: var(--text-primary);\r\n      }\r\n\r\n      .settings-page-card .settings-back svg {\r\n        stroke: currentColor;\r\n        width: 16px;\r\n        height: 16px;\r\n        margin-right: 6px;\r\n      }\r\n\r\n      .settings-page-card .settings-tabs {\r\n        grid-area: tabs;\r\n        flex-direction: column;\r\n        background: transparent;\r\n        border-bottom: none;\r\n        border-right: 1px solid var(--border-color, rgba(0,0,0,0.05));\r\n        padding: 0 24px 0 0;\r\n        margin: 0;\r\n        gap: 8px;\r\n      }\r\n\r\n      [data-theme=\"dark\"] .settings-page-card .settings-tabs {\r\n        border-right-color: rgba(255,255,255,0.05);\r\n      }\r\n\r\n      .settings-page-card .settings-tab {\r\n        border-radius: 8px;\r\n        padding: 12px 16px;\r\n        font-size: 0.95rem;\r\n        justify-content: flex-start;\r\n        width: 100%;\r\n        color: var(--text-secondary);\r\n        transition: all 0.2s ease;\r\n      }\r\n\r\n      .settings-page-card .settings-tab:hover {\r\n        background: var(--bg-secondary);\r\n        transform: translateX(4px);\r\n      }\r\n\r\n      .settings-page-card .settings-tab.active {\r\n        background: var(--bg-surface, white);\r\n        color: var(--accent, #e11d48);\r\n        box-shadow: 0 2px 8px rgba(0,0,0,0.05);\r\n        border: 1px solid var(--border-color, rgba(0,0,0,0.05));\r\n      }\r\n\r\n      [data-theme=\"dark\"] .settings-page-card .settings-tab.active {\r\n        background: rgba(255,255,255,0.05);\r\n        color: #fb7185;\r\n        border-color: rgba(255,255,255,0.1);\r\n      }\r\n\r\n      .settings-page-card .settings-body {\r\n        grid-area: body;\r\n        border-left: 1px solid transparent; \r\n        padding: 0 0 0 32px;\r\n        max-height: none;\r\n      }\r\n\r\n      .settings-page-card .settings-footer {\r\n        grid-area: footer;\r\n        margin-top: 32px;\r\n        border-top: 1px solid var(--border-color, rgba(0,0,0,0.05));\r\n        background: transparent;\r\n        padding: 24px 0;\r\n      }\r\n\r\n      [data-theme=\"dark\"] .settings-page-card .settings-footer {\r\n        border-top-color: rgba(255,255,255,0.05);\r\n        background: transparent;\r\n      }\r\n      \r\n      @media (max-width: 900px) {\r\n        .settings-page-card {\r\n           grid-template-columns: 1fr;\r\n           grid-template-rows: auto auto 1fr auto;\r\n           grid-template-areas:\r\n             \"header\"\r\n             \"tabs\"\r\n             \"body\"\r\n             \"footer\";\r\n        }\r\n        .settings-page-card .settings-tabs {\r\n          flex-direction: row;\r\n          border-right: none;\r\n          border-bottom: 1px solid var(--border-color, rgba(0,0,0,0.05));\r\n          padding: 0 0 16px 0;\r\n          margin-bottom: 24px;\r\n          overflow-x: auto;\r\n          gap: 12px;\r\n        }\r\n        .settings-page-card .settings-tab {\r\n          width: auto;\r\n          white-space: nowrap;\r\n          justify-content: center;\r\n        }\r\n        .settings-page-card .settings-body {\r\n          padding: 0;\r\n          border-left: none;\r\n        }\r\n      }\r\n      \r\n      .settings-header {\r\n        background: linear-gradient(135deg, #e11d48 0%, #be123c 100%);\r\n        padding: 24px 28px;\r\n        position: relative;\r\n        overflow: hidden;\r\n      }\r\n      \r\n      .settings-header::before {\r\n        content: '';\r\n        position: absolute;\r\n        top: -50%;\r\n        right: -50%;\r\n        width: 100%;\r\n        height: 200%;\r\n        background: radial-gradient(circle, rgba(255,255,255,0.1) 0%, transparent 60%);\r\n        pointer-events: none;\r\n      }\r\n      \r\n      .settings-header-content {\r\n        display: flex;\r\n        align-items: center;\r\n        gap: 14px;\r\n        position: relative;\r\n        z-index: 1;\r\n      }\r\n      \r\n      .settings-icon {\r\n        width: 48px;\r\n        height: 48px;\r\n        border-radius: 12px;\r\n        background: rgba(255,255,255,0.2);\r\n        display: flex;\r\n        align-items: center;\r\n        justify-content: center;\r\n        border: 2px solid rgba(255,255,255,0.3);\r\n      }\r\n      \r\n      .settings-icon svg {\r\n        width: 28px;\r\n        height: 28px;\r\n        stroke: white;\r\n        fill: none;\r\n      }\r\n      \r\n      .settings-title {\r\n        flex: 1;\r\n      }\r\n      \r\n      .settings-title h2 {\r\n        color: white;\r\n        font-size: 1.4rem;\r\n        font-weight: 600;\r\n        margin: 0;\r\n        text-shadow: 0 1px 2px rgba(0,0,0,0.1);\r\n      }\r\n      \r\n      .settings-title p {\r\n        color: rgba(255,255,255,0.85);\r\n        font-size: 0.85rem;\r\n        margin: 4px 0 0;\r\n      }\r\n      \r\n      .settings-close {\r\n        position: absolute;\r\n        top: 16px;\r\n        right: 16px;\r\n        width: 32px;\r\n        height: 32px;\r\n        border-radius: 50%;\r\n        background: rgba(255,255,255,0.2);\r\n        border: none;\r\n        cursor: pointer;\r\n        display: flex;\r\n        align-items: center;\r\n        justify-content: center;\r\n        transition: background 0.2s;\r\n        z-index: 2;\r\n      }\r\n      \r\n      .settings-close:hover {\r\n        background: rgba(255,255,255,0.3);\r\n      }\r\n      \r\n      .settings-close svg {\r\n        width: 18px;\r\n        height: 18px;\r\n        stroke: white;\r\n      }\r\n      \r\n      .settings-tabs {\r\n        display: flex;\r\n        gap: 8px;\r\n        padding: 16px 24px;\r\n        background: var(--bg-secondary, #f8fafc);\r\n        border-bottom: 1px solid var(--border-color, #e2e8f0);\r\n      }\r\n      \r\n      [data-theme=\"dark\"] .settings-tabs {\r\n        background: rgba(30,41,59,0.5);\r\n        border-bottom-color: rgba(255,255,255,0.1);\r\n      }\r\n      \r\n      .settings-tab {\r\n        display: flex;\r\n        align-items: center;\r\n        gap: 8px;\r\n        padding: 10px 16px;\r\n        border: none;\r\n        background: transparent;\r\n        color: var(--text-secondary, #64748b);\r\n        font-size: 0.9rem;\r\n        font-weight: 500;\r\n        cursor: pointer;\r\n        border-radius: 10px;\r\n        transition: all 0.2s;\r\n      }\r\n      \r\n      .settings-tab:hover {\r\n        background: var(--bg-hover, rgba(0,0,0,0.05));\r\n        color: var(--text-primary, #1e293b);\r\n      }\r\n      \r\n      .settings-tab.active {\r\n        background: white;\r\n        color: #e11d48;\r\n        box-shadow: 0 2px 8px rgba(0,0,0,0.08);\r\n      }\r\n      \r\n      [data-theme=\"dark\"] .settings-tab.active {\r\n        background: rgba(225,29,72,0.15);\r\n        color: #fb7185;\r\n      }\r\n      \r\n      .settings-tab svg {\r\n        width: 18px;\r\n        height: 18px;\r\n        stroke: currentColor;\r\n        fill: none;\r\n      }\r\n      \r\n      .settings-body {\r\n        padding: 24px;\r\n        max-height: 400px;\r\n        overflow-y: auto;\r\n      }\r\n      \r\n      .settings-section {\r\n        display: none;\r\n      }\r\n      \r\n      .settings-section.active {\r\n        display: block;\r\n      }\r\n      \r\n      .settings-section h3 {\r\n        font-size: 0.85rem;\r\n        font-weight: 600;\r\n        color: var(--text-secondary, #64748b);\r\n        text-transform: uppercase;\r\n        letter-spacing: 0.5px;\r\n        margin: 0 0 16px;\r\n        display: flex;\r\n        align-items: center;\r\n        gap: 8px;\r\n      }\r\n      \r\n      .settings-section h3 svg {\r\n        width: 16px;\r\n        height: 16px;\r\n        stroke: currentColor;\r\n      }\r\n      \r\n      .form-group {\r\n        margin-bottom: 20px;\r\n      }\r\n      \r\n      .form-group:last-child {\r\n        margin-bottom: 0;\r\n      }\r\n      \r\n      .form-group label {\r\n        display: block;\r\n        font-size: 0.9rem;\r\n        font-weight: 500;\r\n        color: var(--text-primary, #1e293b);\r\n        margin-bottom: 8px;\r\n      }\r\n      \r\n      .form-group p.hint {\r\n        font-size: 0.8rem;\r\n        color: var(--text-secondary, #64748b);\r\n        margin: 6px 0 0;\r\n      }\r\n      \r\n      .form-select {\r\n        width: 100%;\r\n        padding: 12px 14px;\r\n        border: 1px solid var(--border-color, #e2e8f0);\r\n        border-radius: 10px;\r\n        background: var(--bg-primary, white);\r\n        color: var(--text-primary, #1e293b);\r\n        font-size: 0.9rem;\r\n        transition: border-color 0.2s, box-shadow 0.2s;\r\n        appearance: none;\r\n        background-image: url(\"data:image/svg+xml,%3Csvg xmlns='http://www.w3.org/2000/svg' width='12' height='12' viewBox='0 0 12 12'%3E%3Cpath fill='%2364748b' d='M2.5 4.5L6 8l3.5-3.5'/%3E%3C/svg%3E\");\r\n        background-repeat: no-repeat;\r\n        background-position: right 12px center;\r\n        cursor: pointer;\r\n      }\r\n      \r\n      .form-select:focus {\r\n        outline: none;\r\n        border-color: #e11d48;\r\n        box-shadow: 0 0 0 3px rgba(225,29,72,0.1);\r\n      }\r\n      \r\n      [data-theme=\"dark\"] .form-select {\r\n        background-color: rgba(30,41,59,0.8);\r\n        border-color: rgba(255,255,255,0.1);\r\n      }\r\n      \r\n      .toggle-group {\r\n        display: flex;\r\n        align-items: center;\r\n        justify-content: space-between;\r\n        padding: 14px 16px;\r\n        background: var(--bg-secondary, #f8fafc);\r\n        border-radius: 10px;\r\n        margin-bottom: 12px;\r\n      }\r\n      \r\n      [data-theme=\"dark\"] .toggle-group {\r\n        background: rgba(30,41,59,0.5);\r\n      }\r\n      \r\n      .toggle-group:last-child {\r\n        margin-bottom: 0;\r\n      }\r\n      \r\n      .toggle-info {\r\n        flex: 1;\r\n      }\r\n      \r\n      .toggle-info strong {\r\n        display: block;\r\n        font-size: 0.9rem;\r\n        color: var(--text-primary, #1e293b);\r\n        margin-bottom: 2px;\r\n      }\r\n      \r\n      .toggle-info span {\r\n        font-size: 0.8rem;\r\n        color: var(--text-secondary, #64748b);\r\n      }\r\n      \r\n      .toggle-switch {\r\n        position: relative;\r\n        width: 48px;\r\n        height: 26px;\r\n        flex-shrink: 0;\r\n      }\r\n      \r\n      .toggle-switch input {\r\n        opacity: 0;\r\n        width: 0;\r\n        height: 0;\r\n      }\r\n      \r\n      .toggle-slider {\r\n        position: absolute;\r\n        cursor: pointer;\r\n        inset: 0;\r\n        background: var(--bg-tertiary, #cbd5e1);\r\n        border-radius: 26px;\r\n        transition: 0.3s;\r\n      }\r\n      \r\n      .toggle-slider::before {\r\n        content: '';\r\n        position: absolute;\r\n        width: 20px;\r\n        height: 20px;\r\n        left: 3px;\r\n        bottom: 3px;\r\n        background: white;\r\n        border-radius: 50%;\r\n        transition: 0.3s;\r\n        box-shadow: 0 2px 4px rgba(0,0,0,0.2);\r\n      }\r\n      \r\n      .toggle-switch input:checked + .toggle-slider {\r\n        background: #e11d48;\r\n      }\r\n      \r\n      .toggle-switch input:checked + .toggle-slider::before {\r\n        transform: translateX(22px);\r\n      }\r\n      \r\n      .settings-footer {\r\n        display: flex;\r\n        justify-content: flex-end;\r\n        gap: 12px;\r\n        padding: 20px 24px;\r\n        background: var(--bg-secondary, #f8fafc);\r\n        border-top: 1px solid var(--border-color, #e2e8f0);\r\n      }\r\n      \r\n      [data-theme=\"dark\"] .settings-footer {\r\n        background: rgba(30,41,59,0.5);\r\n        border-top-color: rgba(255,255,255,0.1);\r\n      }\r\n      \r\n      .btn-cancel {\r\n        padding: 10px 20px;\r\n        border: 1px solid var(--border-color, #e2e8f0);\r\n        border-radius: 10px;\r\n        background: var(--bg-primary, white);\r\n        color: var(--text-primary, #1e293b);\r\n        font-size: 0.9rem;\r\n        font-weight: 500;\r\n        cursor: pointer;\r\n        transition: background 0.2s;\r\n      }\r\n      \r\n      .btn-cancel:hover {\r\n        background: var(--bg-hover, #f1f5f9);\r\n      }\r\n      \r\n      .btn-save {\r\n        padding: 10px 24px;\r\n        border: none;\r\n        border-radius: 10px;\r\n        background: linear-gradient(135deg, #e11d48 0%, #be123c 100%);\r\n        color: white;\r\n        font-size: 0.9rem;\r\n        font-weight: 500;\r\n        cursor: pointer;\r\n        display: flex;\r\n        align-items: center;\r\n        gap: 8px;\r\n        transition: transform 0.2s, box-shadow 0.2s;\r\n      }\r\n      \r\n      .btn-save:hover {\r\n        transform: translateY(-1px);\r\n        box-shadow: 0 4px 12px rgba(225,29,72,0.3);\r\n      }\r\n      \r\n      .btn-save svg {\r\n        width: 18px;\r\n        height: 18px;\r\n        stroke: white;\r\n      }\r\n      \r\n      .admin-notice {\r\n        background: linear-gradient(135deg, rgba(59,130,246,0.1) 0%, rgba(37,99,235,0.1) 100%);\r\n        border: 1px solid rgba(59,130,246,0.3);\r\n        border-radius: 10px;\r\n        padding: 14px 16px;\r\n        margin-top: 20px;\r\n        display: flex;\r\n        align-items: center;\r\n        gap: 12px;\r\n      }\r\n      \r\n      .admin-notice svg {\r\n        width: 20px;\r\n        height: 20px;\r\n        stroke: #3b82f6;\r\n        flex-shrink: 0;\r\n      }\r\n      \r\n      .admin-notice p {\r\n        font-size: 0.85rem;\r\n        color: var(--text-secondary, #64748b);\r\n        margin: 0;\r\n      }\r\n      \r\n      .admin-notice strong {\r\n        color: #3b82f6;\r\n      }\r\n      .settings-back {\r\n        position: static;\r\n        display: inline-flex;\r\n        align-items: center;\r\n        padding: 8px 14px;\r\n        font-size: 0.9rem;\r\n        font-weight: 500;\r\n        color: rgba(255,255,255,0.95);\r\n      }\r\n      .settings-back:hover {\r\n        background: rgba(255,255,255,0.15);\r\n      }\r\n      .settings-page-card .settings-body {\r\n        max-height: none;\r\n      }\r\n    </style>\r\n    \r\n    <div class=\"settings-modal-container ${pageMode ? 'full-page' : ''}\">\r\n    <div class=\"settings-card ${pageMode ? 'settings-page-card' : ''}\">\r\n      <!-- Header -->\r\n      <div class=\"settings-header\">\r\n        <div class=\"settings-header-content\">\r\n          ${pageMode ? closeButtonHtml : ''}\r\n          <div class=\"settings-title\">\r\n            <h2>Settings</h2>\r\n            <p>Your personal preferences</p>\r\n          </div>\r\n           ${!pageMode ? `<div class=\"settings-icon\">\r\n            <svg viewBox=\"0 0 24 24\" stroke-width=\"2\">\r\n              <path d=\"M12 15a3 3 0 100-6 3 3 0 000 6z\"/>\r\n              <path d=\"M19.4 15a1.65 1.65 0 00.33 1.82l.06.06a2 2 0 010 2.83 2 2 0 01-2.83 0l-.06-.06a1.65 1.65 0 00-1.82-.33 1.65 1.65 0 00-1 1.51V21a2 2 0 01-2 2 2 2 0 01-2-2v-.09A1.65 1.65 0 009 19.4a1.65 1.65 0 00-1.82.33l-.06.06a2 2 0 01-2.83 0 2 2 0 010-2.83l.06-.06a1.65 1.65 0 00.33-1.82 1.65 1.65 0 00-1.51-1H3a2 2 0 01-2-2 2 2 0 012-2h.09A1.65 1.65 0 004.6 9a1.65 1.65 0 00-.33-1.82l-.06-.06a2 2 0 010-2.83 2 2 0 012.83 0l.06.06a1.65 1.65 0 001.82.33H9a1.65 1.65 0 001-1.51V3a2 2 0 012-2 2 2 0 012 2v.09a1.65 1.65 0 001 1.51 1.65 1.65 0 001.82-.33l.06-.06a2 2 0 012.83 0 2 2 0 010 2.83l-.06.06a1.65 1.65 0 00-.33 1.82V9a1.65 1.65 0 001.51 1H21a2 2 0 012 2 2 2 0 01-2 2h-.09a1.65 1.65 0 00-1.51 1z\"/>\r\n            </svg>\r\n          </div>` : ''}\r\n        </div>\r\n        ${!pageMode ? closeButtonHtml : ''}\r\n      </div>\r\n      \r\n      <!-- Tabs -->\r\n      <div class=\"settings-tabs\">\r\n        <button class=\"settings-tab ${initialTab === 'general' ? 'active' : ''}\" data-tab=\"general\">\r\n          <svg viewBox=\"0 0 24 24\" stroke-width=\"2\">\r\n            <circle cx=\"12\" cy=\"12\" r=\"3\"/>\r\n            <path d=\"M12 2v2m0 16v2M4.93 4.93l1.41 1.41m11.32 11.32l1.41 1.41M2 12h2m16 0h2M6.34 17.66l-1.41 1.41M19.07 4.93l-1.41 1.41\"/>\r\n          </svg>\r\n          General\r\n        </button>\r\n        <button class=\"settings-tab ${initialTab === 'data' ? 'active' : ''}\" data-tab=\"data\">\r\n          <svg viewBox=\"0 0 24 24\" stroke-width=\"2\">\r\n            <path d=\"M12 22s8-4 8-10V5l-8-3-8 3v7c0 6 8 10 8 10z\"/>\r\n          </svg>\r\n          Data & Privacy\r\n        </button>\r\n        <button class=\"settings-tab ${initialTab === 'companies' ? 'active' : ''}\" data-tab=\"companies\">\r\n          <svg viewBox=\"0 0 24 24\" stroke-width=\"2\">\r\n            <path d=\"M3 21h18M5 21V7l8-4 8 4v14M8 21v-9a2 2 0 0 1 2-2h4a2 2 0 0 1 2 2v9\"/>\r\n          </svg>\r\n          Companies\r\n        </button>\r\n      </div>\r\n      \r\n      <!-- Body -->\r\n      <div class=\"settings-body\">\r\n        <!-- General Section -->\r\n        <div class=\"settings-section ${initialTab === 'general' ? 'active' : ''}\" id=\"section-general\">\r\n          <h3>\r\n            <svg viewBox=\"0 0 24 24\" stroke-width=\"2\">\r\n              <path d=\"M12 3v1m0 16v1m9-9h-1M4 12H3m15.364 6.364l-.707-.707M6.343 6.343l-.707-.707m12.728 0l-.707.707M6.343 17.657l-.707.707\"/>\r\n            </svg>\r\n            Appearance\r\n          </h3>\r\n          \r\n          <div class=\"form-group\">\r\n            <label>Theme</label>\r\n            <select class=\"form-select\" id=\"setting-theme\">\r\n              <option value=\"system\" ${currentTheme === 'system' ? 'selected' : ''}>System (Auto)</option>\r\n              <option value=\"light\" ${currentTheme === 'light' ? 'selected' : ''}>Light</option>\r\n              <option value=\"dark\" ${currentTheme === 'dark' ? 'selected' : ''}>Dark</option>\r\n            </select>\r\n            <p class=\"hint\">Choose your preferred color scheme</p>\r\n          </div>\r\n          \r\n          <div class=\"form-group\">\r\n            <label>Language</label>\r\n            <select class=\"form-select\" id=\"setting-language\">\r\n              <option value=\"en\" ${state.config.language === 'en' ? 'selected' : ''}>English</option>\r\n              <option value=\"pt\" ${state.config.language === 'pt' ? 'selected' : ''}>Portugues</option>\r\n              <option value=\"es\" ${state.config.language === 'es' ? 'selected' : ''}>Espanol</option>\r\n            </select>\r\n            <p class=\"hint\">Interface language preference</p>\r\n          </div>\r\n          \r\n          <h3 style=\"margin-top: 20px;\">\r\n            <svg viewBox=\"0 0 24 24\" stroke-width=\"2\" style=\"width: 16px; height: 16px;\">\r\n              <path d=\"M19 21V5a2 2 0 00-2-2H7a2 2 0 00-2 2v16m14 0h2m-2 0h-5m-9 0H3m2 0h5M9 7h1m-1 4h1m4-4h1m-1 4h1m-5 10v-5a1 1 0 011-1h2a1 1 0 011 1v5m-4 0h4\"/>\r\n            </svg>\r\n            Companies\r\n          </h3>\r\n          <p class=\"hint\" style=\"margin-bottom: 10px;\">Manage company profiles for branding and document templates.</p>\r\n          <button type=\"button\" class=\"btn-save\" id=\"settings-manage-companies-btn\" style=\"margin-top: 0;\">\r\n            <svg viewBox=\"0 0 24 24\" stroke-width=\"2\" style=\"width: 18px; height: 18px;\"><path d=\"M19 21V5a2 2 0 00-2-2H7a2 2 0 00-2 2v16m14 0h2m-2 0h-5m-9 0H3m2 0h5M9 7h1m-1 4h1m4-4h1m-1 4h1m-5 10v-5a1 1 0 011-1h2a1 1 0 011 1v5m-4 0h4\"/></svg>\r\n            Manage companies\r\n          </button>\r\n          \r\n          ${state.currentUser?.role === 'superadmin' ? `\r\n            <div class=\"admin-notice\">\r\n              <svg viewBox=\"0 0 24 24\" stroke-width=\"2\">\r\n                <circle cx=\"12\" cy=\"12\" r=\"10\"/>\r\n                <path d=\"M12 16v-4M12 8h.01\"/>\r\n              </svg>\r\n              <p>For <strong>LLM configuration</strong>, <strong>Graph</strong>, and other platform settings, use the <strong>Admin</strong> section in the sidebar menu.</p>\r\n            </div>\r\n          ` : ''}\r\n        </div>\r\n        \r\n        <!-- Data & Privacy Section -->\r\n        <div class=\"settings-section ${initialTab === 'data' ? 'active' : ''}\" id=\"section-data\">\r\n          <h3>\r\n            <svg viewBox=\"0 0 24 24\" stroke-width=\"2\">\r\n              <path d=\"M12 22s8-4 8-10V5l-8-3-8 3v7c0 6 8 10 8 10z\"/>\r\n            </svg>\r\n            Privacy Settings\r\n          </h3>\r\n          \r\n          <div class=\"toggle-group\">\r\n            <div class=\"toggle-info\">\r\n              <strong>Analytics</strong>\r\n              <span>Help improve GodMode with anonymous usage data</span>\r\n            </div>\r\n            <label class=\"toggle-switch\">\r\n              <input type=\"checkbox\" id=\"setting-analytics\" ${state.config.analyticsEnabled !== false ? 'checked' : ''}>\r\n              <span class=\"toggle-slider\"></span>\r\n            </label>\r\n          </div>\r\n          \r\n          <div class=\"toggle-group\">\r\n            <div class=\"toggle-info\">\r\n              <strong>Error Reporting</strong>\r\n              <span>Automatically report errors to help fix bugs</span>\r\n            </div>\r\n            <label class=\"toggle-switch\">\r\n              <input type=\"checkbox\" id=\"setting-error-reporting\" ${state.config.errorReportingEnabled !== false ? 'checked' : ''}>\r\n              <span class=\"toggle-slider\"></span>\r\n            </label>\r\n          </div>\r\n          \r\n          <div class=\"toggle-group\">\r\n            <div class=\"toggle-info\">\r\n              <strong>AI Data Improvement</strong>\r\n              <span>Allow anonymized data to improve AI responses</span>\r\n            </div>\r\n            <label class=\"toggle-switch\">\r\n              <input type=\"checkbox\" id=\"setting-ai-improvement\" ${state.config.aiImprovementEnabled === true ? 'checked' : ''}>\r\n              <span class=\"toggle-slider\"></span>\r\n            </label>\r\n          </div>\r\n        </div>\r\n\r\n        <!-- Companies Section -->\r\n        <div class=\"settings-section ${initialTab === 'companies' ? 'active' : ''}\" id=\"section-companies\">\r\n          <!-- CompaniesPanel content will be mounted here -->\r\n        </div>\r\n      </div>\r\n      \r\n      <!-- Footer -->\r\n      <div class=\"settings-footer\">\r\n        <button class=\"btn-cancel\" id=\"cancel-settings-btn\">Cancel</button>\r\n        <button class=\"btn-save\" id=\"save-settings-btn\">\r\n          <svg viewBox=\"0 0 24 24\" stroke-width=\"2\">\r\n            <polyline points=\"20 6 9 17 4 12\"/>\r\n          </svg>\r\n          Save Settings\r\n        </button>\r\n      </div>\r\n    </div>\r\n    </div>\r\n  `;\r\n}\r\n\r\n/**\r\n * Create and show settings modal\r\n */\r\nexport function showSettingsModal(props: SettingsModalProps = {}): void {\r\n  // Remove existing modal if any\r\n  const existing = document.querySelector(`[data-modal-id=\"${MODAL_ID}\"]`);\r\n  if (existing) existing.remove();\r\n\r\n  const state = appStore.getState();\r\n  const currentTheme = theme.getMode();\r\n  const initialTab = props.initialTab || 'general';\r\n\r\n  const modalOverlay = createElement('div', { className: 'settings-modal-overlay' });\r\n  modalOverlay.setAttribute('data-modal-id', MODAL_ID);\r\n  const container = createElement('div', { className: 'settings-modal-container' }); // No 'full-page' class for modal\r\n  container.innerHTML = getSettingsMarkup(state, currentTheme, initialTab, { pageMode: false });\r\n  modalOverlay.appendChild(container);\r\n  document.body.appendChild(modalOverlay);\r\n\r\n  const closeModal = () => modalOverlay.remove();\r\n  bindSettingsEvents(modalOverlay, {\r\n    ...props,\r\n    onClose: closeModal,\r\n    onSaveSuccess: closeModal,\r\n  });\r\n}\r\n\r\n/**\r\n * Bind event handlers (shared by modal and full page).\r\n */\r\nexport function bindSettingsEvents(\r\n  container: HTMLElement,\r\n  options: SettingsModalProps & SettingsBindOptions\r\n): void {\r\n  const { onClose, onSaveSuccess, onSave } = options;\r\n\r\n  // Initialize Companies Panel\r\n  const companiesSection = container.querySelector('#section-companies');\r\n  if (companiesSection) {\r\n    initCompaniesPanel(companiesSection as HTMLElement);\r\n  }\r\n\r\n  const closeButton = container.querySelector('#close-settings-btn');\r\n  const cancelBtn = container.querySelector('#cancel-settings-btn');\r\n  const isOverlay = container.classList.contains('settings-modal-overlay');\r\n\r\n  const closeAction = () => {\r\n    if (onClose) onClose();\r\n    else if (isOverlay) container.remove();\r\n  };\r\n\r\n  if (closeButton) on(closeButton as HTMLElement, 'click', closeAction);\r\n  if (cancelBtn) on(cancelBtn as HTMLElement, 'click', closeAction);\r\n\r\n  if (isOverlay) {\r\n    on(container, 'click', (e) => {\r\n      if (e.target === container) closeAction();\r\n    });\r\n  }\r\n\r\n  // \"Manage companies\" button in General tab now switches to Companies tab\r\n  const manageCompaniesButton = container.querySelector('#settings-manage-companies-btn');\r\n  if (manageCompaniesButton) {\r\n    on(manageCompaniesButton as HTMLElement, 'click', () => {\r\n      const companiesTab = container.querySelector('.settings-tab[data-tab=\"companies\"]') as HTMLElement;\r\n      if (companiesTab) companiesTab.click();\r\n    });\r\n  }\r\n\r\n  // Tab switching\r\n  const tabs = container.querySelectorAll('.settings-tab');\r\n  tabs.forEach(tab => {\r\n    on(tab as HTMLElement, 'click', () => {\r\n      const tabId = tab.getAttribute('data-tab');\r\n      tabs.forEach(t => t.classList.remove('active'));\r\n      tab.classList.add('active');\r\n      container.querySelectorAll('.settings-section').forEach(section => {\r\n        section.classList.remove('active');\r\n      });\r\n      const targetSection = container.querySelector(`#section-${tabId}`);\r\n      if (targetSection) targetSection.classList.add('active');\r\n    });\r\n  });\r\n\r\n  const themeSelect = container.querySelector('#setting-theme') as HTMLSelectElement;\r\n  if (themeSelect) {\r\n    on(themeSelect, 'change', () => {\r\n      theme.set(themeSelect.value as 'light' | 'dark' | 'system');\r\n    });\r\n  }\r\n\r\n  const saveBtn = container.querySelector('#save-settings-btn');\r\n  if (saveBtn) {\r\n    on(saveBtn as HTMLElement, 'click', () => {\r\n      const settings = {\r\n        theme: (container.querySelector('#setting-theme') as HTMLSelectElement)?.value,\r\n        language: (container.querySelector('#setting-language') as HTMLSelectElement)?.value,\r\n        analyticsEnabled: (container.querySelector('#setting-analytics') as HTMLInputElement)?.checked,\r\n        errorReportingEnabled: (container.querySelector('#setting-error-reporting') as HTMLInputElement)?.checked,\r\n        aiImprovementEnabled: (container.querySelector('#setting-ai-improvement') as HTMLInputElement)?.checked,\r\n      };\r\n      appStore.setConfig({\r\n        ...appStore.getState().config,\r\n        ...settings,\r\n      });\r\n      options.onSave?.(settings);\r\n      toast.success('Settings saved');\r\n      options.onSaveSuccess?.();\r\n    });\r\n  }\r\n}\r\n\r\n/**\r\n * Close settings modal\r\n */\r\nexport function closeSettingsModal(): void {\r\n  const modal = document.querySelector(`[data-modal-id=\"${MODAL_ID}\"]`);\r\n  if (modal) modal.remove();\r\n}\r\n\r\nexport default showSettingsModal;\r\n","/**\r\n * Processing Modal Component\r\n * Shows progress for file processing operations\r\n */\r\n\r\nimport { createElement, on } from '@lib/dom';\r\nimport { createModal, openModal, closeModal, updateModalContent } from '@components/Modal';\r\n\r\nconst MODAL_ID = 'processing-modal';\r\n\r\nexport interface ProcessingStep {\r\n  id: string;\r\n  label: string;\r\n  status: 'pending' | 'running' | 'completed' | 'error';\r\n  progress?: number;\r\n  message?: string;\r\n}\r\n\r\nexport interface ProcessingModalProps {\r\n  title?: string;\r\n  steps?: ProcessingStep[];\r\n  onCancel?: () => void;\r\n  allowCancel?: boolean;\r\n}\r\n\r\nlet currentSteps: ProcessingStep[] = [];\r\nlet cancelCallback: (() => void) | undefined;\r\n\r\n/**\r\n * Show processing modal\r\n */\r\nexport function showProcessingModal(props: ProcessingModalProps = {}): void {\r\n  const {\r\n    title = 'Processing',\r\n    steps = [],\r\n    onCancel,\r\n    allowCancel = true,\r\n  } = props;\r\n\r\n  currentSteps = steps;\r\n  cancelCallback = onCancel;\r\n\r\n  // Remove existing modal if any\r\n  const existing = document.querySelector(`[data-modal-id=\"${MODAL_ID}\"]`);\r\n  if (existing) existing.remove();\r\n\r\n  const content = createElement('div', { className: 'processing-content' });\r\n  renderContent(content);\r\n\r\n  const footer = allowCancel ? createFooter() : null;\r\n\r\n  const modal = createModal({\r\n    id: MODAL_ID,\r\n    title,\r\n    content,\r\n    size: 'md',\r\n    closable: false,\r\n    footer,\r\n  });\r\n\r\n  document.body.appendChild(modal);\r\n  openModal(MODAL_ID);\r\n}\r\n\r\n/**\r\n * Render processing content\r\n */\r\nfunction renderContent(container: HTMLElement): void {\r\n  container.innerHTML = `\r\n    <div class=\"processing-steps\">\r\n      ${currentSteps.map(step => renderStep(step)).join('')}\r\n    </div>\r\n    <div class=\"processing-overall\">\r\n      <div class=\"progress-bar\">\r\n        <div class=\"progress-fill\" style=\"--progress: ${calculateOverallProgress()}\"></div>\r\n      </div>\r\n      <div class=\"progress-text\">${calculateOverallProgress()}% complete</div>\r\n    </div>\r\n  `;\r\n}\r\n\r\n/**\r\n * Render a single step\r\n */\r\nfunction renderStep(step: ProcessingStep): string {\r\n  const statusIcon = {\r\n    pending: '',\r\n    running: '',\r\n    completed: '',\r\n    error: '',\r\n  }[step.status];\r\n\r\n  const statusClass = step.status;\r\n\r\n  return `\r\n    <div class=\"processing-step ${statusClass}\" data-step-id=\"${step.id}\">\r\n      <span class=\"step-icon\">${statusIcon}</span>\r\n      <div class=\"step-content\">\r\n        <div class=\"step-label\">${step.label}</div>\r\n        ${step.message ? `<div class=\"step-message\">${step.message}</div>` : ''}\r\n        ${step.status === 'running' && step.progress !== undefined ? `\r\n          <div class=\"step-progress\">\r\n            <div class=\"progress-bar small\">\r\n              <div class=\"progress-fill\" style=\"--progress: ${step.progress}\"></div>\r\n            </div>\r\n          </div>\r\n        ` : ''}\r\n      </div>\r\n    </div>\r\n  `;\r\n}\r\n\r\n/**\r\n * Calculate overall progress\r\n */\r\nfunction calculateOverallProgress(): number {\r\n  if (currentSteps.length === 0) return 0;\r\n\r\n  const completed = currentSteps.filter(s => s.status === 'completed').length;\r\n  const running = currentSteps.find(s => s.status === 'running');\r\n  const runningProgress = running?.progress || 0;\r\n\r\n  return Math.round(\r\n    ((completed + (running ? runningProgress / 100 : 0)) / currentSteps.length) * 100\r\n  );\r\n}\r\n\r\n/**\r\n * Create footer with cancel button\r\n */\r\nfunction createFooter(): HTMLElement {\r\n  const footer = createElement('div', { className: 'modal-footer' });\r\n\r\n  const cancelBtn = createElement('button', {\r\n    className: 'btn btn-secondary',\r\n    textContent: 'Cancel',\r\n  });\r\n\r\n  on(cancelBtn, 'click', () => {\r\n    cancelCallback?.();\r\n    closeProcessingModal();\r\n  });\r\n\r\n  footer.appendChild(cancelBtn);\r\n  return footer;\r\n}\r\n\r\n/**\r\n * Update processing step\r\n */\r\nexport function updateProcessingStep(\r\n  stepId: string,\r\n  updates: Partial<ProcessingStep>\r\n): void {\r\n  const stepIndex = currentSteps.findIndex(s => s.id === stepId);\r\n  if (stepIndex === -1) return;\r\n\r\n  currentSteps[stepIndex] = { ...currentSteps[stepIndex], ...updates };\r\n\r\n  // Re-render\r\n  const modal = document.querySelector(`[data-modal-id=\"${MODAL_ID}\"]`);\r\n  if (modal) {\r\n    const content = modal.querySelector('.processing-content');\r\n    if (content) {\r\n      renderContent(content as HTMLElement);\r\n    }\r\n  }\r\n}\r\n\r\n/**\r\n * Add a new step\r\n */\r\nexport function addProcessingStep(step: ProcessingStep): void {\r\n  currentSteps.push(step);\r\n\r\n  const modal = document.querySelector(`[data-modal-id=\"${MODAL_ID}\"]`);\r\n  if (modal) {\r\n    const content = modal.querySelector('.processing-content');\r\n    if (content) {\r\n      renderContent(content as HTMLElement);\r\n    }\r\n  }\r\n}\r\n\r\n/**\r\n * Set all steps at once\r\n */\r\nexport function setProcessingSteps(steps: ProcessingStep[]): void {\r\n  currentSteps = steps;\r\n\r\n  const modal = document.querySelector(`[data-modal-id=\"${MODAL_ID}\"]`);\r\n  if (modal) {\r\n    const content = modal.querySelector('.processing-content');\r\n    if (content) {\r\n      renderContent(content as HTMLElement);\r\n    }\r\n  }\r\n}\r\n\r\n/**\r\n * Close processing modal\r\n */\r\nexport function closeProcessingModal(): void {\r\n  closeModal(MODAL_ID);\r\n  currentSteps = [];\r\n  cancelCallback = undefined;\r\n}\r\n\r\n/**\r\n * Check if processing modal is open\r\n */\r\nexport function isProcessingModalOpen(): boolean {\r\n  const modal = document.querySelector(`[data-modal-id=\"${MODAL_ID}\"]`);\r\n  return modal?.classList.contains('open') || false;\r\n}\r\n\r\nexport default showProcessingModal;\r\n","/**\n * Auth Modal Component\n * Login, registration, and password reset dialogs\n */\n\nimport { createElement, on } from '@lib/dom';\nimport { createModal, openModal, closeModal } from '../Modal';\nimport { auth } from '@services/auth';\nimport { toast } from '@services/toast';\n\nconst MODAL_ID = 'auth-modal';\n\nexport type AuthMode = 'login' | 'register' | 'forgot' | 'reset' | 'otp-request' | 'otp-verify' | 'email-confirm';\n\nexport interface AuthModalProps {\n  initialMode?: AuthMode;\n  resetToken?: string; // For password reset flow\n  email?: string; // For OTP flows\n  onSuccess?: (user: { id: string; email: string; name?: string }) => void;\n  onClose?: () => void;\n  required?: boolean; // If true, modal cannot be closed without logging in\n}\n\nlet currentMode: AuthMode = 'login';\nlet currentProps: AuthModalProps = {};\nlet otpEmail: string = '';\nlet resendCooldown: number = 0;\nlet resendTimer: NodeJS.Timeout | null = null;\n\n/**\n * Show auth modal\n */\nexport function showAuthModal(props: AuthModalProps = {}): void {\n  currentMode = props.initialMode || 'login';\n  currentProps = props;\n\n  // Remove existing modal if any\n  const existing = document.querySelector(`[data-modal-id=\"${MODAL_ID}\"]`);\n  if (existing) existing.remove();\n\n  const content = createElement('div', { className: 'auth-content' });\n  renderAuthContent(content);\n\n  const modal = createModal({\n    id: MODAL_ID,\n    title: getTitle(),\n    content,\n    size: 'sm',\n    closable: !props.required, // Can't close if login is required\n    onClose: props.onClose,\n    footer: null,\n  });\n\n  document.body.appendChild(modal);\n  openModal(MODAL_ID);\n\n  // Focus first input\n  setTimeout(() => {\n    const firstInput = content.querySelector('input') as HTMLInputElement;\n    if (firstInput) firstInput.focus();\n  }, 100);\n}\n\n/**\n * Get modal title based on mode\n */\nfunction getTitle(): string {\n  switch (currentMode) {\n    case 'login': return 'Sign In';\n    case 'register': return 'Create Account';\n    case 'forgot': return 'Reset Password';\n    case 'reset': return 'Set New Password';\n    case 'otp-request': return 'Sign In with Code';\n    case 'otp-verify': return 'Enter Code';\n    case 'email-confirm': return 'Confirm Email';\n  }\n}\n\n/**\n * Render auth content\n */\nfunction renderAuthContent(container: HTMLElement): void {\n  // Clear any existing timers\n  if (resendTimer) {\n    clearInterval(resendTimer);\n    resendTimer = null;\n  }\n\n  switch (currentMode) {\n    case 'login':\n      renderLoginForm(container);\n      break;\n    case 'register':\n      renderRegisterForm(container);\n      break;\n    case 'forgot':\n      renderForgotForm(container);\n      break;\n    case 'reset':\n      renderResetForm(container);\n      break;\n    case 'otp-request':\n      renderOTPRequestForm(container);\n      break;\n    case 'otp-verify':\n      renderOTPVerifyForm(container);\n      break;\n    case 'email-confirm':\n      renderEmailConfirmForm(container);\n      break;\n  }\n}\n\n/**\n * Render login form\n */\nfunction renderLoginForm(container: HTMLElement): void {\n  container.innerHTML = `\n    <form id=\"login-form\" class=\"auth-form\">\n      <div class=\"form-group\">\n        <label for=\"login-email\">Email</label>\n        <input type=\"email\" id=\"login-email\" required autocomplete=\"email\" placeholder=\"your@email.com\">\n      </div>\n      <div class=\"form-group\">\n        <label for=\"login-password\">Password</label>\n        <input type=\"password\" id=\"login-password\" required autocomplete=\"current-password\" placeholder=\"\">\n      </div>\n      <div class=\"form-error hidden\" id=\"login-error\"></div>\n      <div class=\"form-group\">\n        <button type=\"submit\" class=\"btn btn-primary btn-block\">\n          <span class=\"btn-text\">Sign In</span>\n          <span class=\"btn-loading hidden\">Signing in...</span>\n        </button>\n      </div>\n      <div class=\"auth-divider\">\n        <span>or</span>\n      </div>\n      <div class=\"form-group\">\n        <button type=\"button\" class=\"btn btn-secondary btn-block\" data-action=\"otp-request\">\n          Sign in with email code\n        </button>\n      </div>\n      <div class=\"auth-links\">\n        <button type=\"button\" class=\"btn-link\" data-action=\"forgot\">Forgot password?</button>\n        <span class=\"separator\">|</span>\n        <button type=\"button\" class=\"btn-link\" data-action=\"register\">Create account</button>\n      </div>\n    </form>\n  `;\n\n  const form = container.querySelector('#login-form') as HTMLFormElement;\n  on(form, 'submit', async (e) => {\n    e.preventDefault();\n    await handleLogin(form);\n  });\n\n  bindModeLinks(container);\n}\n\n/**\n * Render registration form\n */\nfunction renderRegisterForm(container: HTMLElement): void {\n  container.innerHTML = `\n    <form id=\"register-form\" class=\"auth-form\">\n      <div class=\"form-group\">\n        <label for=\"register-email\">Email <span class=\"required\">*</span></label>\n        <input type=\"email\" id=\"register-email\" required autocomplete=\"email\" placeholder=\"your@email.com\">\n      </div>\n      <div class=\"form-group\">\n        <label for=\"register-username\">Username</label>\n        <input type=\"text\" id=\"register-username\" autocomplete=\"username\" placeholder=\"username (optional)\" \n               pattern=\"^[a-zA-Z0-9_]+$\" minlength=\"3\">\n        <small class=\"form-hint\">Letters, numbers, and underscores only. Min 3 characters.</small>\n      </div>\n      <div class=\"form-group\">\n        <label for=\"register-display-name\">Display Name</label>\n        <input type=\"text\" id=\"register-display-name\" autocomplete=\"name\" placeholder=\"Your Name (optional)\">\n      </div>\n      <div class=\"form-group\">\n        <label for=\"register-password\">Password <span class=\"required\">*</span></label>\n        <input type=\"password\" id=\"register-password\" required autocomplete=\"new-password\" \n               minlength=\"12\" placeholder=\"Min. 12 characters\">\n        <div class=\"password-strength\" id=\"password-strength\"></div>\n      </div>\n      <div class=\"form-group\">\n        <label for=\"register-confirm\">Confirm Password <span class=\"required\">*</span></label>\n        <input type=\"password\" id=\"register-confirm\" required autocomplete=\"new-password\" placeholder=\"\">\n      </div>\n      <div class=\"form-error hidden\" id=\"register-error\"></div>\n      <div class=\"form-group\">\n        <button type=\"submit\" class=\"btn btn-primary btn-block\">\n          <span class=\"btn-text\">Create Account</span>\n          <span class=\"btn-loading hidden\">Creating account...</span>\n        </button>\n      </div>\n      <div class=\"auth-links\">\n        <button type=\"button\" class=\"btn-link\" data-action=\"login\">Already have an account? Sign in</button>\n      </div>\n    </form>\n  `;\n\n  const form = container.querySelector('#register-form') as HTMLFormElement;\n\n  // Password strength indicator\n  const passwordInput = form.querySelector('#register-password') as HTMLInputElement;\n  on(passwordInput, 'input', () => {\n    updatePasswordStrength(passwordInput.value);\n  });\n\n  on(form, 'submit', async (e) => {\n    e.preventDefault();\n    await handleRegister(form);\n  });\n\n  bindModeLinks(container);\n}\n\n/**\n * Render forgot password form\n */\nfunction renderForgotForm(container: HTMLElement): void {\n  container.innerHTML = `\n    <form id=\"forgot-form\" class=\"auth-form\">\n      <p class=\"form-description\">\n        Enter your email address and we'll send you a link to reset your password.\n      </p>\n      <div class=\"form-group\">\n        <label for=\"forgot-email\">Email</label>\n        <input type=\"email\" id=\"forgot-email\" required autocomplete=\"email\" placeholder=\"your@email.com\">\n      </div>\n      <div class=\"form-error hidden\" id=\"forgot-error\"></div>\n      <div class=\"form-group\">\n        <button type=\"submit\" class=\"btn btn-primary btn-block\">\n          <span class=\"btn-text\">Send Reset Link</span>\n          <span class=\"btn-loading hidden\">Sending...</span>\n        </button>\n      </div>\n      <div class=\"auth-links\">\n        <button type=\"button\" class=\"btn-link\" data-action=\"login\">Back to sign in</button>\n      </div>\n    </form>\n  `;\n\n  const form = container.querySelector('#forgot-form') as HTMLFormElement;\n  on(form, 'submit', async (e) => {\n    e.preventDefault();\n    await handleForgot(form);\n  });\n\n  bindModeLinks(container);\n}\n\n/**\n * Render reset password form\n */\nfunction renderResetForm(container: HTMLElement): void {\n  container.innerHTML = `\n    <form id=\"reset-form\" class=\"auth-form\">\n      <p class=\"form-description\">\n        Enter your new password below.\n      </p>\n      <div class=\"form-group\">\n        <label for=\"reset-password\">New Password</label>\n        <input type=\"password\" id=\"reset-password\" required autocomplete=\"new-password\" \n               minlength=\"12\" placeholder=\"Min. 12 characters\">\n        <div class=\"password-strength\" id=\"reset-password-strength\"></div>\n      </div>\n      <div class=\"form-group\">\n        <label for=\"reset-confirm\">Confirm Password</label>\n        <input type=\"password\" id=\"reset-confirm\" required autocomplete=\"new-password\" placeholder=\"\">\n      </div>\n      <div class=\"form-error hidden\" id=\"reset-error\"></div>\n      <div class=\"form-group\">\n        <button type=\"submit\" class=\"btn btn-primary btn-block\">\n          <span class=\"btn-text\">Reset Password</span>\n          <span class=\"btn-loading hidden\">Resetting...</span>\n        </button>\n      </div>\n    </form>\n  `;\n\n  const form = container.querySelector('#reset-form') as HTMLFormElement;\n\n  // Password strength indicator\n  const passwordInput = form.querySelector('#reset-password') as HTMLInputElement;\n  on(passwordInput, 'input', () => {\n    updatePasswordStrength(passwordInput.value, 'reset-password-strength');\n  });\n\n  on(form, 'submit', async (e) => {\n    e.preventDefault();\n    await handleReset(form);\n  });\n}\n\n/**\n * Render OTP request form (enter email to receive code)\n */\nfunction renderOTPRequestForm(container: HTMLElement): void {\n  container.innerHTML = `\n    <form id=\"otp-request-form\" class=\"auth-form\">\n      <p class=\"form-description\">\n        Enter your email address and we'll send you a one-time code to sign in.\n      </p>\n      <div class=\"form-group\">\n        <label for=\"otp-email\">Email</label>\n        <input type=\"email\" id=\"otp-email\" required autocomplete=\"email\" placeholder=\"your@email.com\" value=\"${otpEmail}\">\n      </div>\n      <div class=\"form-error hidden\" id=\"otp-request-error\"></div>\n      <div class=\"form-group\">\n        <button type=\"submit\" class=\"btn btn-primary btn-block\">\n          <span class=\"btn-text\">Send Code</span>\n          <span class=\"btn-loading hidden\">Sending...</span>\n        </button>\n      </div>\n      <div class=\"auth-links\">\n        <button type=\"button\" class=\"btn-link\" data-action=\"login\">Sign in with password</button>\n        <span class=\"separator\">|</span>\n        <button type=\"button\" class=\"btn-link\" data-action=\"register\">Create account</button>\n      </div>\n    </form>\n  `;\n\n  const form = container.querySelector('#otp-request-form') as HTMLFormElement;\n  on(form, 'submit', async (e) => {\n    e.preventDefault();\n    await handleOTPRequest(form, container);\n  });\n\n  bindModeLinks(container);\n}\n\n/**\n * Render OTP verify form (enter 6-digit code)\n */\nfunction renderOTPVerifyForm(container: HTMLElement): void {\n  const maskedEmail = otpEmail ?\n    otpEmail.replace(/(.{2})(.*)(@.*)/, '$1***$3') :\n    'your email';\n\n  container.innerHTML = `\n    <form id=\"otp-verify-form\" class=\"auth-form\">\n      <p class=\"form-description\">\n        Enter the 6-digit code sent to <strong>${maskedEmail}</strong>\n      </p>\n      <div class=\"form-group otp-input-group\">\n        <div class=\"otp-inputs\">\n          <input type=\"text\" class=\"otp-digit\" maxlength=\"1\" pattern=\"[0-9]\" inputmode=\"numeric\" autocomplete=\"one-time-code\" data-index=\"0\">\n          <input type=\"text\" class=\"otp-digit\" maxlength=\"1\" pattern=\"[0-9]\" inputmode=\"numeric\" data-index=\"1\">\n          <input type=\"text\" class=\"otp-digit\" maxlength=\"1\" pattern=\"[0-9]\" inputmode=\"numeric\" data-index=\"2\">\n          <span class=\"otp-separator\">-</span>\n          <input type=\"text\" class=\"otp-digit\" maxlength=\"1\" pattern=\"[0-9]\" inputmode=\"numeric\" data-index=\"3\">\n          <input type=\"text\" class=\"otp-digit\" maxlength=\"1\" pattern=\"[0-9]\" inputmode=\"numeric\" data-index=\"4\">\n          <input type=\"text\" class=\"otp-digit\" maxlength=\"1\" pattern=\"[0-9]\" inputmode=\"numeric\" data-index=\"5\">\n        </div>\n        <input type=\"hidden\" id=\"otp-code\" name=\"code\">\n      </div>\n      <div class=\"form-error hidden\" id=\"otp-verify-error\"></div>\n      <div class=\"form-group\">\n        <button type=\"submit\" class=\"btn btn-primary btn-block\" id=\"otp-verify-btn\" disabled>\n          <span class=\"btn-text\">Verify Code</span>\n          <span class=\"btn-loading hidden\">Verifying...</span>\n        </button>\n      </div>\n      <div class=\"otp-resend\">\n        <button type=\"button\" class=\"btn-link\" id=\"resend-code-btn\" ${resendCooldown > 0 ? 'disabled' : ''}>\n          ${resendCooldown > 0 ? `Resend code in ${resendCooldown}s` : 'Resend code'}\n        </button>\n      </div>\n      <div class=\"auth-links\">\n        <button type=\"button\" class=\"btn-link\" data-action=\"otp-request\">Use different email</button>\n        <span class=\"separator\">|</span>\n        <button type=\"button\" class=\"btn-link\" data-action=\"login\">Sign in with password</button>\n      </div>\n    </form>\n  `;\n\n  const form = container.querySelector('#otp-verify-form') as HTMLFormElement;\n  const inputs = container.querySelectorAll('.otp-digit') as NodeListOf<HTMLInputElement>;\n  const hiddenInput = container.querySelector('#otp-code') as HTMLInputElement;\n  const verifyBtn = container.querySelector('#otp-verify-btn') as HTMLButtonElement;\n  const resendBtn = container.querySelector('#resend-code-btn') as HTMLButtonElement;\n\n  // Setup OTP input handlers\n  setupOTPInputs(inputs, hiddenInput, verifyBtn);\n\n  // Setup resend cooldown timer\n  if (resendCooldown > 0) {\n    startResendCooldown(resendBtn);\n  }\n\n  // Resend handler\n  on(resendBtn, 'click', async () => {\n    await handleResendCode(container);\n  });\n\n  on(form, 'submit', async (e) => {\n    e.preventDefault();\n    await handleOTPVerify(form, container);\n  });\n\n  bindModeLinks(container);\n\n  // Focus first input\n  setTimeout(() => inputs[0]?.focus(), 100);\n}\n\n/**\n * Render email confirmation form\n */\nfunction renderEmailConfirmForm(container: HTMLElement): void {\n  const email = currentProps.email || otpEmail || '';\n\n  container.innerHTML = `\n    <form id=\"email-confirm-form\" class=\"auth-form\">\n      <div class=\"confirm-icon\"></div>\n      <p class=\"form-description\">\n        Enter the confirmation code sent to <strong>${email || 'your email'}</strong>\n      </p>\n      <div class=\"form-group otp-input-group\">\n        <div class=\"otp-inputs\">\n          <input type=\"text\" class=\"otp-digit\" maxlength=\"1\" pattern=\"[0-9]\" inputmode=\"numeric\" data-index=\"0\">\n          <input type=\"text\" class=\"otp-digit\" maxlength=\"1\" pattern=\"[0-9]\" inputmode=\"numeric\" data-index=\"1\">\n          <input type=\"text\" class=\"otp-digit\" maxlength=\"1\" pattern=\"[0-9]\" inputmode=\"numeric\" data-index=\"2\">\n          <span class=\"otp-separator\">-</span>\n          <input type=\"text\" class=\"otp-digit\" maxlength=\"1\" pattern=\"[0-9]\" inputmode=\"numeric\" data-index=\"3\">\n          <input type=\"text\" class=\"otp-digit\" maxlength=\"1\" pattern=\"[0-9]\" inputmode=\"numeric\" data-index=\"4\">\n          <input type=\"text\" class=\"otp-digit\" maxlength=\"1\" pattern=\"[0-9]\" inputmode=\"numeric\" data-index=\"5\">\n        </div>\n        <input type=\"hidden\" id=\"confirm-code\" name=\"code\">\n      </div>\n      <div class=\"form-error hidden\" id=\"email-confirm-error\"></div>\n      <div class=\"form-group\">\n        <button type=\"submit\" class=\"btn btn-primary btn-block\" id=\"confirm-btn\" disabled>\n          <span class=\"btn-text\">Confirm Email</span>\n          <span class=\"btn-loading hidden\">Confirming...</span>\n        </button>\n      </div>\n      <div class=\"auth-links\">\n        <button type=\"button\" class=\"btn-link\" data-action=\"login\">Back to sign in</button>\n      </div>\n    </form>\n  `;\n\n  const form = container.querySelector('#email-confirm-form') as HTMLFormElement;\n  const inputs = container.querySelectorAll('.otp-digit') as NodeListOf<HTMLInputElement>;\n  const hiddenInput = container.querySelector('#confirm-code') as HTMLInputElement;\n  const confirmBtn = container.querySelector('#confirm-btn') as HTMLButtonElement;\n\n  setupOTPInputs(inputs, hiddenInput, confirmBtn);\n\n  on(form, 'submit', async (e) => {\n    e.preventDefault();\n    await handleEmailConfirm(form, container, email);\n  });\n\n  bindModeLinks(container);\n  setTimeout(() => inputs[0]?.focus(), 100);\n}\n\n/**\n * Setup OTP digit inputs with auto-advance and paste support\n */\nfunction setupOTPInputs(\n  inputs: NodeListOf<HTMLInputElement>,\n  hiddenInput: HTMLInputElement,\n  submitBtn: HTMLButtonElement\n): void {\n  const updateHiddenValue = () => {\n    const code = Array.from(inputs).map(i => i.value).join('');\n    hiddenInput.value = code;\n    submitBtn.disabled = code.length !== 6 || !/^\\d{6}$/.test(code);\n  };\n\n  inputs.forEach((input, index) => {\n    // Handle input\n    on(input, 'input', (e) => {\n      const value = (e.target as HTMLInputElement).value;\n\n      // Only allow digits\n      if (!/^\\d*$/.test(value)) {\n        input.value = value.replace(/\\D/g, '');\n        return;\n      }\n\n      // If multiple digits pasted, distribute them\n      if (value.length > 1) {\n        const digits = value.split('');\n        inputs.forEach((inp, i) => {\n          inp.value = digits[i] || '';\n        });\n        const nextIndex = Math.min(digits.length, 5);\n        inputs[nextIndex]?.focus();\n        updateHiddenValue();\n        return;\n      }\n\n      // Auto-advance to next input\n      if (value && index < inputs.length - 1) {\n        inputs[index + 1].focus();\n      }\n\n      updateHiddenValue();\n    });\n\n    // Handle keydown for backspace navigation\n    on(input, 'keydown', (e) => {\n      const key = (e as KeyboardEvent).key;\n\n      if (key === 'Backspace' && !input.value && index > 0) {\n        inputs[index - 1].focus();\n        inputs[index - 1].value = '';\n        updateHiddenValue();\n      }\n\n      // Arrow navigation\n      if (key === 'ArrowLeft' && index > 0) {\n        inputs[index - 1].focus();\n      }\n      if (key === 'ArrowRight' && index < inputs.length - 1) {\n        inputs[index + 1].focus();\n      }\n    });\n\n    // Handle paste\n    on(input, 'paste', (e) => {\n      e.preventDefault();\n      const pasted = (e as ClipboardEvent).clipboardData?.getData('text') || '';\n      const digits = pasted.replace(/\\D/g, '').slice(0, 6);\n\n      if (digits) {\n        digits.split('').forEach((digit, i) => {\n          if (inputs[i]) inputs[i].value = digit;\n        });\n        const nextIndex = Math.min(digits.length, 5);\n        inputs[nextIndex]?.focus();\n        updateHiddenValue();\n      }\n    });\n\n    // Select all on focus\n    on(input, 'focus', () => input.select());\n  });\n}\n\n/**\n * Start resend cooldown timer\n */\nfunction startResendCooldown(button: HTMLButtonElement): void {\n  if (resendTimer) clearInterval(resendTimer);\n\n  const updateButton = () => {\n    if (resendCooldown > 0) {\n      button.disabled = true;\n      button.textContent = `Resend code in ${resendCooldown}s`;\n      resendCooldown--;\n    } else {\n      button.disabled = false;\n      button.textContent = 'Resend code';\n      if (resendTimer) {\n        clearInterval(resendTimer);\n        resendTimer = null;\n      }\n    }\n  };\n\n  updateButton();\n  resendTimer = setInterval(updateButton, 1000);\n}\n\n/**\n * Handle OTP request\n */\nasync function handleOTPRequest(form: HTMLFormElement, container: HTMLElement): Promise<void> {\n  const email = (form.querySelector('#otp-email') as HTMLInputElement).value.trim();\n  const errorEl = form.querySelector('#otp-request-error') as HTMLElement;\n\n  setFormLoading(form, true);\n  hideError(errorEl);\n\n  try {\n    const result = await auth.requestLoginCode(email);\n\n    // Store email for verify step\n    otpEmail = email;\n\n    // Set cooldown for resend\n    resendCooldown = 60;\n\n    toast.success(result.message || 'Code sent! Check your email.');\n\n    // Switch to verify mode\n    currentMode = 'otp-verify';\n    const titleEl = document.querySelector(`[data-modal-id=\"${MODAL_ID}\"] .modal-header h3`);\n    if (titleEl) titleEl.textContent = getTitle();\n    renderAuthContent(container);\n\n  } catch (error: unknown) {\n    const err = error as { message?: string; response?: { data?: { retryAfter?: number } } };\n    const message = err.message || 'Failed to send code';\n    showError(errorEl, message);\n  } finally {\n    setFormLoading(form, false);\n  }\n}\n\n/**\n * Handle OTP verification\n */\nasync function handleOTPVerify(form: HTMLFormElement, container: HTMLElement): Promise<void> {\n  const code = (form.querySelector('#otp-code') as HTMLInputElement).value;\n  const errorEl = form.querySelector('#otp-verify-error') as HTMLElement;\n\n  if (!code || code.length !== 6) {\n    showError(errorEl, 'Please enter the 6-digit code');\n    return;\n  }\n\n  setFormLoading(form, true);\n  hideError(errorEl);\n\n  try {\n    const user = await auth.verifyLoginCode(otpEmail, code);\n\n    toast.success('Signed in successfully');\n    currentProps.onSuccess?.(user);\n    closeModal(MODAL_ID);\n\n    // Trigger data refresh\n    window.dispatchEvent(new CustomEvent('godmode:auth-success'));\n\n  } catch (error: unknown) {\n    const err = error as {\n      message?: string;\n      attemptsRemaining?: number;\n      needsEmailVerification?: boolean;\n      fallbackToPassword?: boolean;\n    };\n\n    let message = err.message || 'Verification failed';\n\n    if (err.attemptsRemaining !== undefined && err.attemptsRemaining > 0) {\n      message += ` (${err.attemptsRemaining} attempts remaining)`;\n    }\n\n    if (err.needsEmailVerification) {\n      message = 'Please confirm your email address first.';\n      // Could switch to email-confirm mode here\n    }\n\n    if (err.fallbackToPassword) {\n      message = 'Please sign in with your password instead.';\n    }\n\n    showError(errorEl, message);\n\n    // Clear inputs on error\n    const inputs = form.querySelectorAll('.otp-digit') as NodeListOf<HTMLInputElement>;\n    inputs.forEach(i => i.value = '');\n    inputs[0]?.focus();\n\n  } finally {\n    setFormLoading(form, false);\n  }\n}\n\n/**\n * Handle resend code\n */\nasync function handleResendCode(container: HTMLElement): Promise<void> {\n  if (resendCooldown > 0) return;\n\n  const resendBtn = container.querySelector('#resend-code-btn') as HTMLButtonElement;\n  resendBtn.disabled = true;\n  resendBtn.textContent = 'Sending...';\n\n  try {\n    await auth.requestLoginCode(otpEmail);\n    toast.success('New code sent!');\n    resendCooldown = 60;\n    startResendCooldown(resendBtn);\n  } catch (error: unknown) {\n    const err = error as { message?: string };\n    toast.error(err.message || 'Failed to resend code');\n    resendBtn.disabled = false;\n    resendBtn.textContent = 'Resend code';\n  }\n}\n\n/**\n * Handle email confirmation\n */\nasync function handleEmailConfirm(form: HTMLFormElement, container: HTMLElement, email: string): Promise<void> {\n  const code = (form.querySelector('#confirm-code') as HTMLInputElement).value;\n  const errorEl = form.querySelector('#email-confirm-error') as HTMLElement;\n\n  if (!code || code.length !== 6) {\n    showError(errorEl, 'Please enter the 6-digit code');\n    return;\n  }\n\n  setFormLoading(form, true);\n  hideError(errorEl);\n\n  try {\n    await auth.confirmEmail(email, code);\n\n    toast.success('Email confirmed! You can now sign in.');\n\n    // Switch to login mode\n    currentMode = 'login';\n    const titleEl = document.querySelector(`[data-modal-id=\"${MODAL_ID}\"] .modal-header h3`);\n    if (titleEl) titleEl.textContent = getTitle();\n    renderAuthContent(container);\n\n  } catch (error: unknown) {\n    const err = error as { message?: string };\n    showError(errorEl, err.message || 'Confirmation failed');\n\n    // Clear inputs\n    const inputs = form.querySelectorAll('.otp-digit') as NodeListOf<HTMLInputElement>;\n    inputs.forEach(i => i.value = '');\n    inputs[0]?.focus();\n  } finally {\n    setFormLoading(form, false);\n  }\n}\n\n/**\n * Bind mode switch links\n */\nfunction bindModeLinks(container: HTMLElement): void {\n  const links = container.querySelectorAll('[data-action]');\n  links.forEach(link => {\n    on(link as HTMLElement, 'click', () => {\n      const action = link.getAttribute('data-action') as AuthMode;\n      currentMode = action;\n\n      // Update modal title\n      const titleEl = document.querySelector(`[data-modal-id=\"${MODAL_ID}\"] .modal-header h3`);\n      if (titleEl) titleEl.textContent = getTitle();\n\n      // Re-render content\n      renderAuthContent(container);\n    });\n  });\n}\n\n/**\n * Handle login submission\n */\nasync function handleLogin(form: HTMLFormElement): Promise<void> {\n  const email = (form.querySelector('#login-email') as HTMLInputElement).value.trim();\n  const password = (form.querySelector('#login-password') as HTMLInputElement).value;\n  const errorEl = form.querySelector('#login-error') as HTMLElement;\n\n  setFormLoading(form, true);\n  hideError(errorEl);\n\n  try {\n    const user = await auth.login({ email, password });\n\n    toast.success('Signed in successfully');\n    currentProps.onSuccess?.(user);\n    closeModal(MODAL_ID);\n\n    // Trigger data refresh\n    window.dispatchEvent(new CustomEvent('godmode:auth-success'));\n  } catch (error: unknown) {\n    const err = error as Error & {\n      response?: { data?: { needsEmailVerification?: boolean; email?: string } }\n    };\n\n    // Check if email verification is needed\n    const responseData = err.response?.data;\n    if (responseData?.needsEmailVerification) {\n      // Switch to email confirmation mode\n      otpEmail = responseData.email || email;\n      currentProps.email = otpEmail;\n      resendCooldown = 60; // Just sent a new code\n\n      toast.info('Please verify your email to continue.');\n\n      currentMode = 'email-confirm';\n      const container = form.parentElement as HTMLElement;\n      const titleEl = document.querySelector(`[data-modal-id=\"${MODAL_ID}\"] .modal-header h3`);\n      if (titleEl) titleEl.textContent = getTitle();\n      renderAuthContent(container);\n      return;\n    }\n\n    const message = err.message || 'Login failed';\n    showError(errorEl, message);\n  } finally {\n    setFormLoading(form, false);\n  }\n}\n\n/**\n * Handle registration submission\n */\nasync function handleRegister(form: HTMLFormElement): Promise<void> {\n  const email = (form.querySelector('#register-email') as HTMLInputElement).value.trim();\n  const username = (form.querySelector('#register-username') as HTMLInputElement).value.trim();\n  const displayName = (form.querySelector('#register-display-name') as HTMLInputElement).value.trim();\n  const password = (form.querySelector('#register-password') as HTMLInputElement).value;\n  const confirm = (form.querySelector('#register-confirm') as HTMLInputElement).value;\n  const errorEl = form.querySelector('#register-error') as HTMLElement;\n\n  // Validate passwords match\n  if (password !== confirm) {\n    showError(errorEl, 'Passwords do not match');\n    return;\n  }\n\n  // Validate password length\n  if (password.length < 12) {\n    showError(errorEl, 'Password must be at least 12 characters');\n    return;\n  }\n\n  setFormLoading(form, true);\n  hideError(errorEl);\n\n  try {\n    const result = await auth.register({\n      email,\n      password,\n      username: username || undefined,\n      display_name: displayName || undefined,\n    });\n\n    if (result.needsEmailVerification) {\n      toast.success('Account created! Please check your email to verify.');\n      // Switch to login mode\n      currentMode = 'login';\n      const container = form.parentElement as HTMLElement;\n      const titleEl = document.querySelector(`[data-modal-id=\"${MODAL_ID}\"] .modal-header h3`);\n      if (titleEl) titleEl.textContent = getTitle();\n      renderAuthContent(container);\n    } else {\n      toast.success('Account created successfully');\n      currentProps.onSuccess?.(result.user);\n      closeModal(MODAL_ID);\n      window.dispatchEvent(new CustomEvent('godmode:auth-success'));\n    }\n  } catch (error) {\n    const message = error instanceof Error ? error.message : 'Registration failed';\n    showError(errorEl, message);\n  } finally {\n    setFormLoading(form, false);\n  }\n}\n\n/**\n * Handle forgot password submission\n */\nasync function handleForgot(form: HTMLFormElement): Promise<void> {\n  const email = (form.querySelector('#forgot-email') as HTMLInputElement).value.trim();\n  const errorEl = form.querySelector('#forgot-error') as HTMLElement;\n\n  setFormLoading(form, true);\n  hideError(errorEl);\n\n  try {\n    await auth.forgotPassword(email);\n    toast.success('If an account exists with this email, you will receive a reset link.');\n\n    // Switch back to login\n    currentMode = 'login';\n    const container = form.parentElement as HTMLElement;\n    const titleEl = document.querySelector(`[data-modal-id=\"${MODAL_ID}\"] .modal-header h3`);\n    if (titleEl) titleEl.textContent = getTitle();\n    renderAuthContent(container);\n  } catch (error) {\n    // Always show success message to not reveal if email exists\n    toast.success('If an account exists with this email, you will receive a reset link.');\n  } finally {\n    setFormLoading(form, false);\n  }\n}\n\n/**\n * Handle password reset submission\n */\nasync function handleReset(form: HTMLFormElement): Promise<void> {\n  const password = (form.querySelector('#reset-password') as HTMLInputElement).value;\n  const confirm = (form.querySelector('#reset-confirm') as HTMLInputElement).value;\n  const errorEl = form.querySelector('#reset-error') as HTMLElement;\n\n  if (password !== confirm) {\n    showError(errorEl, 'Passwords do not match');\n    return;\n  }\n\n  if (password.length < 12) {\n    showError(errorEl, 'Password must be at least 12 characters');\n    return;\n  }\n\n  if (!currentProps.resetToken) {\n    showError(errorEl, 'Invalid reset token. Please request a new reset link.');\n    return;\n  }\n\n  setFormLoading(form, true);\n  hideError(errorEl);\n\n  try {\n    await auth.resetPassword(password, currentProps.resetToken);\n    toast.success('Password reset successfully. You can now sign in.');\n\n    // Switch to login\n    currentMode = 'login';\n    const container = form.parentElement as HTMLElement;\n    const titleEl = document.querySelector(`[data-modal-id=\"${MODAL_ID}\"] .modal-header h3`);\n    if (titleEl) titleEl.textContent = getTitle();\n    renderAuthContent(container);\n  } catch (error) {\n    const message = error instanceof Error ? error.message : 'Password reset failed';\n    showError(errorEl, message);\n  } finally {\n    setFormLoading(form, false);\n  }\n}\n\n/**\n * Set form loading state\n */\nfunction setFormLoading(form: HTMLFormElement, loading: boolean): void {\n  const submitBtn = form.querySelector('button[type=\"submit\"]') as HTMLButtonElement;\n  const inputs = form.querySelectorAll('input');\n  const btnText = submitBtn.querySelector('.btn-text') as HTMLElement;\n  const btnLoading = submitBtn.querySelector('.btn-loading') as HTMLElement;\n\n  submitBtn.disabled = loading;\n  inputs.forEach(input => input.disabled = loading);\n\n  if (btnText && btnLoading) {\n    btnText.classList.toggle('hidden', !!loading);\n    btnLoading.classList.toggle('hidden', !loading);\n  }\n}\n\n/**\n * Show error message\n */\nfunction showError(errorEl: HTMLElement, message: string): void {\n  errorEl.textContent = message;\n  errorEl.classList.remove('hidden');\n}\n\n/**\n * Hide error message\n */\nfunction hideError(errorEl: HTMLElement): void {\n  errorEl.classList.add('hidden');\n  errorEl.textContent = '';\n}\n\n/**\n * Update password strength indicator\n */\nfunction updatePasswordStrength(password: string, elementId = 'password-strength'): void {\n  const strengthEl = document.getElementById(elementId);\n  if (!strengthEl) return;\n\n  const strength = calculatePasswordStrength(password);\n\n  strengthEl.className = `password-strength strength-${strength.level}`;\n  strengthEl.innerHTML = `\n    <div class=\"strength-bar\">\n      <div class=\"strength-fill\" style=\"--strength-width: ${strength.score}%\"></div>\n    </div>\n    <span class=\"strength-label\">${strength.label}</span>\n  `;\n}\n\n/**\n * Calculate password strength\n */\nfunction calculatePasswordStrength(password: string): { level: string; score: number; label: string } {\n  let score = 0;\n\n  if (password.length >= 12) score += 25;\n  if (password.length >= 16) score += 15;\n  if (/[a-z]/.test(password)) score += 15;\n  if (/[A-Z]/.test(password)) score += 15;\n  if (/[0-9]/.test(password)) score += 15;\n  if (/[^a-zA-Z0-9]/.test(password)) score += 15;\n\n  if (score < 30) return { level: 'weak', score, label: 'Weak' };\n  if (score < 60) return { level: 'fair', score, label: 'Fair' };\n  if (score < 80) return { level: 'good', score, label: 'Good' };\n  return { level: 'strong', score: Math.min(score, 100), label: 'Strong' };\n}\n\n/**\n * Close auth modal\n */\nexport function closeAuthModal(): void {\n  closeModal(MODAL_ID);\n}\n\nexport default showAuthModal;\n","/**\r\n * Companies Modal - List, create, edit, analyze company profiles and templates (A4/PPT)\r\n */\r\n\r\nimport { createElement, on } from '@lib/dom';\r\nimport { toast } from '@services/toast';\r\nimport {\r\n  listCompanies,\r\n  getCompany,\r\n  createCompany,\r\n  updateCompany,\r\n  deleteCompany,\r\n  analyzeCompany,\r\n  getTemplate,\r\n  updateTemplate,\r\n  generateTemplate,\r\n  type Company,\r\n  type CreateCompanyRequest,\r\n  type TemplateType,\r\n} from '@services/companies';\r\n\r\nconst MODAL_ID = 'companies-modal';\r\n\r\n/** UI strings - centralised for i18n */\r\nconst S = {\r\n  title: 'Companies',\r\n  close: 'Close',\r\n  newCompany: '+ New company',\r\n  noCompanies: 'No companies yet. Create one to use in projects.',\r\n  edit: 'Edit',\r\n  analyze: 'Analyze',\r\n  reAnalyze: 'Re-analyze',\r\n  viewDetail: 'View',\r\n  detail: 'Company detail',\r\n  analyzedOn: 'Analyzed',\r\n  notAnalyzed: 'Not analyzed',\r\n  delete: 'Delete',\r\n  backToList: ' Back to list',\r\n  name: 'Name *',\r\n  description: 'Description',\r\n  logoUrl: 'Logo URL',\r\n  website: 'Website',\r\n  linkedIn: 'LinkedIn',\r\n  save: 'Save',\r\n  create: 'Create',\r\n  cancel: 'Cancel',\r\n  invalidUrl: 'Please enter a valid URL',\r\n  updateFailed: 'Update failed',\r\n  createFailed: 'Create failed',\r\n  loadFailed: 'Failed to load company',\r\n  analysisComplete: 'Analysis complete',\r\n  analysisFailed: 'Analysis failed',\r\n  deleteConfirm: 'Delete this company? Projects using it must be reassigned first.',\r\n  companyDeleted: 'Company deleted',\r\n  templates: 'Templates (A4 / PPT)',\r\n  templateA4: 'A4 document',\r\n  templatePPT: 'Presentation',\r\n  generateWithAI: 'Generate base with AI',\r\n  loadCurrent: 'Load current',\r\n  saveTemplate: 'Save template',\r\n  templateLoaded: 'Template loaded',\r\n  templateSaved: 'Template saved',\r\n  templateGenerated: 'Template generated',\r\n  templateLoadFailed: 'Failed to load template',\r\n  templateSaveFailed: 'Failed to save template',\r\n  templateGenerateFailed: 'Generation failed',\r\n};\r\n\r\nfunction escapeHtml(s: string): string {\r\n  const div = document.createElement('div');\r\n  div.textContent = s;\r\n  return div.innerHTML;\r\n}\r\n\r\nfunction isValidUrl(value: string): boolean {\r\n  if (!value || !value.trim()) return true;\r\n  try {\r\n    const u = new URL(value.trim());\r\n    return u.protocol === 'http:' || u.protocol === 'https:';\r\n  } catch {\r\n    return false;\r\n  }\r\n}\r\n\r\nexport function showCompaniesModal(): void {\r\n  const existing = document.querySelector(`[data-modal-id=\"${MODAL_ID}\"]`);\r\n  if (existing) existing.remove();\r\n\r\n  const overlay = createElement('div', { className: 'modal-overlay' });\r\n  overlay.setAttribute('data-modal-id', MODAL_ID);\r\n\r\n  const container = createElement('div', { className: 'modal-container', style: 'max-width: 640px;' });\r\n  container.innerHTML = `\r\n    <div class=\"modal-header\" style=\"display: flex; justify-content: space-between; align-items: center; padding: 16px 20px; border-bottom: 1px solid var(--border-color, #e2e8f0);\">\r\n      <h2 style=\"margin: 0; font-size: 1.25rem;\">${escapeHtml(S.title)}</h2>\r\n      <button type=\"button\" class=\"btn-icon\" id=\"companies-close-btn\" title=\"${escapeHtml(S.close)}\"></button>\r\n    </div>\r\n    <div class=\"modal-body\" style=\"padding: 20px; max-height: 60vh; overflow-y: auto;\">\r\n      <button type=\"button\" class=\"btn btn-primary\" id=\"companies-new-btn\" style=\"margin-bottom: 16px;\">${escapeHtml(S.newCompany)}</button>\r\n      <div id=\"companies-list\">Loading...</div>\r\n    </div>\r\n  `;\r\n\r\n  overlay.appendChild(container);\r\n  document.body.appendChild(overlay);\r\n\r\n  function close() {\r\n    overlay.remove();\r\n  }\r\n\r\n  function renderList(items: Company[]) {\r\n    const listEl = overlay.querySelector('#companies-list') as HTMLElement;\r\n    if (!listEl) return;\r\n    const list = Array.isArray(items) ? items : [];\r\n    try {\r\n      if (list.length === 0) {\r\n        listEl.innerHTML = `<p style=\"color: var(--text-secondary);\">${escapeHtml(S.noCompanies)}</p>`;\r\n        return;\r\n      }\r\n      const analyzedAt = (c: Company) => c.brand_assets?.analyzed_at;\r\n      listEl.innerHTML = list\r\n        .map(\r\n          (c) => {\r\n            const analyzed = !!analyzedAt(c);\r\n            const analyzeLabel = analyzed ? S.reAnalyze : S.analyze;\r\n            const analyzedBadge = analyzed\r\n              ? `<span class=\"companies-analyzed-badge\" title=\"${escapeHtml(analyzedAt(c) || '')}\" style=\"font-size: 11px; color: var(--text-secondary); margin-left: 6px;\">${escapeHtml(S.analyzedOn)}</span>`\r\n              : `<span class=\"companies-not-analyzed-badge\" style=\"font-size: 11px; color: var(--text-muted, #94a3b8); margin-left: 6px;\">${escapeHtml(S.notAnalyzed)}</span>`;\r\n            return `\r\n      <div class=\"companies-row\" data-id=\"${c.id}\" style=\"display: flex; align-items: center; justify-content: space-between; padding: 12px 14px; border: 1px solid var(--border-color); border-radius: 8px; margin-bottom: 8px;\">\r\n        <div style=\"display: flex; align-items: center; gap: 12px;\">\r\n          ${c.logo_url ? `<img src=\"${escapeHtml(c.logo_url)}\" alt=\"\" style=\"width: 36px; height: 36px; object-fit: contain; border-radius: 6px;\">` : '<span style=\"width: 36px; height: 36px; background: var(--bg-secondary); border-radius: 6px; display: inline-flex; align-items: center; justify-content: center; font-size: 18px;\"></span>'}\r\n          <div>\r\n            <strong>${escapeHtml(c.name)}</strong>${analyzedBadge}\r\n            ${(c.brand_assets?.primary_color && c.brand_assets?.secondary_color) ? `<span style=\"display: inline-flex; gap: 4px; margin-left: 8px;\"><i style=\"width: 12px; height: 12px; border-radius: 2px; background: ${escapeHtml(c.brand_assets.primary_color)};\"></i><i style=\"width: 12px; height: 12px; border-radius: 2px; background: ${escapeHtml(c.brand_assets.secondary_color)};\"></i></span>` : ''}\r\n          </div>\r\n        </div>\r\n        <div style=\"display: flex; gap: 8px;\">\r\n          <button type=\"button\" class=\"btn btn-sm btn-secondary companies-detail-btn\" data-id=\"${c.id}\" title=\"View analysis\">${escapeHtml(S.viewDetail)}</button>\r\n          <button type=\"button\" class=\"btn btn-sm btn-secondary companies-edit-btn\" data-id=\"${c.id}\">${escapeHtml(S.edit)}</button>\r\n          <button type=\"button\" class=\"btn btn-sm btn-secondary companies-analyze-btn\" data-id=\"${c.id}\" title=\"Analyze with AI\">${escapeHtml(analyzeLabel)}</button>\r\n          <button type=\"button\" class=\"btn btn-sm btn-outline-danger companies-delete-btn\" data-id=\"${c.id}\">${escapeHtml(S.delete)}</button>\r\n        </div>\r\n      </div>\r\n    `;\r\n          }\r\n        )\r\n        .join('');\r\n    } catch {\r\n      listEl.innerHTML = `<p class=\"text-error\">${escapeHtml(S.loadFailed)}</p>`;\r\n    }\r\n  }\r\n\r\n  function loadList() {\r\n    const listEl = overlay.querySelector('#companies-list') as HTMLElement;\r\n    if (listEl) listEl.innerHTML = 'Loading...';\r\n    listCompanies()\r\n      .then((list) => renderList(Array.isArray(list) ? list : []))\r\n      .catch(() => {\r\n        try {\r\n          const el = overlay.querySelector('#companies-list') as HTMLElement;\r\n          if (el) el.innerHTML = `<p class=\"text-error\">${escapeHtml(S.loadFailed)}</p>`;\r\n        } catch {\r\n          // overlay may be gone\r\n        }\r\n      });\r\n  }\r\n\r\n  const listViewBodyHtml = `\r\n    <button type=\"button\" class=\"btn btn-primary\" id=\"companies-new-btn\" style=\"margin-bottom: 16px;\">${escapeHtml(S.newCompany)}</button>\r\n    <div id=\"companies-list\">Loading...</div>\r\n  `;\r\n\r\n  function showListView() {\r\n    const body = overlay.querySelector('.modal-body') as HTMLElement;\r\n    if (!body) return;\r\n    body.innerHTML = listViewBodyHtml;\r\n    loadList();\r\n    bindListEvents();\r\n  }\r\n\r\n  function showForm(company?: Company) {\r\n    const body = overlay.querySelector('.modal-body') as HTMLElement;\r\n    if (!body) return;\r\n    const isEdit = !!company;\r\n    body.innerHTML = `\r\n      <div style=\"margin-bottom: 16px;\">\r\n        <button type=\"button\" class=\"btn btn-secondary btn-sm\" id=\"companies-back-btn\">${escapeHtml(S.backToList)}</button>\r\n      </div>\r\n      <form id=\"company-form\" style=\"display: flex; flex-direction: column; gap: 14px;\">\r\n        <div>\r\n          <label>${escapeHtml(S.name)}</label>\r\n          <input type=\"text\" name=\"name\" required value=\"${company ? escapeHtml(company.name) : ''}\" style=\"width: 100%; padding: 10px 12px; border-radius: 8px; border: 1px solid var(--border-color);\">\r\n        </div>\r\n        <div>\r\n          <label>${escapeHtml(S.description)}</label>\r\n          <textarea name=\"description\" rows=\"2\" style=\"width: 100%; padding: 10px 12px; border-radius: 8px; border: 1px solid var(--border-color);\">${company?.description ? escapeHtml(company.description) : ''}</textarea>\r\n        </div>\r\n        <div>\r\n          <label>${escapeHtml(S.logoUrl)}</label>\r\n          <input type=\"url\" name=\"logo_url\" value=\"${company?.logo_url ? escapeHtml(company.logo_url) : ''}\" style=\"width: 100%; padding: 10px 12px; border-radius: 8px; border: 1px solid var(--border-color);\" placeholder=\"https://...\">\r\n        </div>\r\n        <div>\r\n          <label>${escapeHtml(S.website)}</label>\r\n          <input type=\"url\" name=\"website_url\" value=\"${company?.website_url ? escapeHtml(company.website_url) : ''}\" style=\"width: 100%; padding: 10px 12px; border-radius: 8px; border: 1px solid var(--border-color);\" placeholder=\"https://...\">\r\n        </div>\r\n        <div>\r\n          <label>${escapeHtml(S.linkedIn)}</label>\r\n          <input type=\"url\" name=\"linkedin_url\" value=\"${company?.linkedin_url ? escapeHtml(company.linkedin_url) : ''}\" style=\"width: 100%; padding: 10px 12px; border-radius: 8px; border: 1px solid var(--border-color);\" placeholder=\"https://linkedin.com/...\">\r\n        </div>\r\n        <div style=\"display: flex; gap: 8px;\">\r\n          <button type=\"submit\" class=\"btn btn-primary\">${isEdit ? escapeHtml(S.save) : escapeHtml(S.create)}</button>\r\n          <button type=\"button\" class=\"btn btn-secondary\" id=\"company-form-cancel\">${escapeHtml(S.cancel)}</button>\r\n        </div>\r\n        ${isEdit && company ? `\r\n        <div style=\"margin-top: 12px; padding-top: 12px; border-top: 1px solid var(--border-color);\">\r\n          <button type=\"button\" class=\"btn btn-secondary btn-sm\" id=\"companies-templates-btn\">${escapeHtml(S.templates)}</button>\r\n        </div>\r\n        ` : ''}\r\n      </form>\r\n    `;\r\n\r\n    on(body.querySelector('#companies-back-btn') as HTMLElement, 'click', showListView);\r\n\r\n    on(body.querySelector('#company-form') as HTMLFormElement, 'submit', async (e) => {\r\n      e.preventDefault();\r\n      const form = body.querySelector('#company-form') as HTMLFormElement;\r\n      const fd = new FormData(form);\r\n      const logoUrl = (fd.get('logo_url') as string)?.trim() || undefined;\r\n      const websiteUrl = (fd.get('website_url') as string)?.trim() || undefined;\r\n      const linkedinUrl = (fd.get('linkedin_url') as string)?.trim() || undefined;\r\n      if (logoUrl && !isValidUrl(logoUrl)) { toast.error(S.invalidUrl + ' (Logo)'); return; }\r\n      if (websiteUrl && !isValidUrl(websiteUrl)) { toast.error(S.invalidUrl + ' (Website)'); return; }\r\n      if (linkedinUrl && !isValidUrl(linkedinUrl)) { toast.error(S.invalidUrl + ' (LinkedIn)'); return; }\r\n      const data: CreateCompanyRequest = {\r\n        name: (fd.get('name') as string).trim(),\r\n        description: (fd.get('description') as string)?.trim() || undefined,\r\n        logo_url: logoUrl,\r\n        website_url: websiteUrl,\r\n        linkedin_url: linkedinUrl,\r\n      };\r\n      try {\r\n        if (isEdit && company) {\r\n          await updateCompany(company.id, data);\r\n          toast.success('Company updated');\r\n        } else {\r\n          await createCompany(data);\r\n          toast.success('Company created');\r\n        }\r\n        showListView();\r\n      } catch {\r\n        toast.error(isEdit ? S.updateFailed : S.createFailed);\r\n      }\r\n    });\r\n\r\n    on(body.querySelector('#company-form-cancel') as HTMLElement, 'click', showListView);\r\n\r\n    if (isEdit && company) {\r\n      const templatesBtn = body.querySelector('#companies-templates-btn');\r\n      if (templatesBtn) on(templatesBtn as HTMLElement, 'click', () => showTemplateEditor(company));\r\n    }\r\n  }\r\n\r\n  function showTemplateEditor(company: Company) {\r\n    const body = overlay.querySelector('.modal-body') as HTMLElement;\r\n    if (!body) return;\r\n    let currentType: TemplateType = 'a4';\r\n    body.innerHTML = `\r\n      <div style=\"margin-bottom: 16px;\">\r\n        <button type=\"button\" class=\"btn btn-secondary btn-sm\" id=\"templates-back-btn\">${escapeHtml(S.backToList)}</button>\r\n      </div>\r\n      <h3 style=\"margin: 0 0 12px 0; font-size: 1rem;\">${escapeHtml(company.name)}  ${escapeHtml(S.templates)}</h3>\r\n      <div style=\"display: flex; gap: 8px; margin-bottom: 12px;\">\r\n        <button type=\"button\" class=\"btn btn-sm btn-secondary template-type-btn active\" data-type=\"a4\">${escapeHtml(S.templateA4)}</button>\r\n        <button type=\"button\" class=\"btn btn-sm btn-secondary template-type-btn\" data-type=\"ppt\">${escapeHtml(S.templatePPT)}</button>\r\n      </div>\r\n      <div style=\"display: flex; gap: 8px; margin-bottom: 8px;\">\r\n        <button type=\"button\" class=\"btn btn-sm btn-secondary\" id=\"template-load-btn\">${escapeHtml(S.loadCurrent)}</button>\r\n        <button type=\"button\" class=\"btn btn-sm btn-primary\" id=\"template-generate-btn\">${escapeHtml(S.generateWithAI)}</button>\r\n        <button type=\"button\" class=\"btn btn-sm btn-primary\" id=\"template-save-btn\">${escapeHtml(S.saveTemplate)}</button>\r\n      </div>\r\n      <textarea id=\"template-html-editor\" rows=\"14\" style=\"width: 100%; padding: 10px 12px; border-radius: 8px; border: 1px solid var(--border-color); font-family: monospace; font-size: 12px;\" placeholder=\"HTML template...\"></textarea>\r\n    `;\r\n\r\n    const editor = body.querySelector('#template-html-editor') as HTMLTextAreaElement;\r\n    const loadBtn = body.querySelector('#template-load-btn') as HTMLButtonElement;\r\n    const genBtn = body.querySelector('#template-generate-btn') as HTMLButtonElement;\r\n    const saveBtn = body.querySelector('#template-save-btn') as HTMLButtonElement;\r\n\r\n    function setType(type: TemplateType) {\r\n      currentType = type;\r\n      body.querySelectorAll('.template-type-btn').forEach((b) => b.classList.toggle('active', (b as HTMLElement).getAttribute('data-type') === type));\r\n    }\r\n\r\n    on(body.querySelector('#templates-back-btn') as HTMLElement, 'click', () => showForm(company));\r\n    body.querySelectorAll('.template-type-btn').forEach((btn) => {\r\n      on(btn as HTMLElement, 'click', () => setType((btn.getAttribute('data-type') as TemplateType) || 'a4'));\r\n    });\r\n    on(loadBtn, 'click', async () => {\r\n      loadBtn.disabled = true;\r\n      try {\r\n        const html = await getTemplate(company.id, currentType);\r\n        editor.value = html;\r\n        toast.success(S.templateLoaded);\r\n      } catch {\r\n        toast.error(S.templateLoadFailed);\r\n      } finally {\r\n        loadBtn.disabled = false;\r\n      }\r\n    });\r\n    on(genBtn, 'click', async () => {\r\n      genBtn.disabled = true;\r\n      genBtn.textContent = '...';\r\n      try {\r\n        const { html } = await generateTemplate(company.id, currentType);\r\n        editor.value = html;\r\n        toast.success(S.templateGenerated);\r\n      } catch {\r\n        toast.error(S.templateGenerateFailed);\r\n      } finally {\r\n        genBtn.disabled = false;\r\n        genBtn.textContent = S.generateWithAI;\r\n      }\r\n    });\r\n    on(saveBtn, 'click', async () => {\r\n      saveBtn.disabled = true;\r\n      try {\r\n        await updateTemplate(company.id, currentType, editor.value);\r\n        toast.success(S.templateSaved);\r\n      } catch {\r\n        toast.error(S.templateSaveFailed);\r\n      } finally {\r\n        saveBtn.disabled = false;\r\n      }\r\n    });\r\n    getTemplate(company.id, currentType).then((html) => { editor.value = html; }).catch(() => { });\r\n  }\r\n\r\n  const REPORT_SECTION_LABELS: Record<string, string> = {\r\n    ficha_identidade: '1. Ficha de Identidade',\r\n    visao_geral: '2. Viso Geral e Posicionamento',\r\n    produtos_servicos: '3. Produtos e Servios',\r\n    publico_alvo: '4. Pblico-Alvo e Clientes',\r\n    equipa_lideranca: '5. Equipa e Liderana',\r\n    presenca_digital: '6. Presena Digital e Marketing',\r\n    analise_competitiva: '7. Anlise Competitiva',\r\n    indicadores_crescimento: '8. Indicadores de Crescimento',\r\n    swot: '9. Anlise SWOT',\r\n    conclusoes: '10. Concluses e Insights',\r\n  };\r\n\r\n  function showDetailView(company: Company) {\r\n    const body = overlay.querySelector('.modal-body') as HTMLElement;\r\n    if (!body) return;\r\n    const ba = company.brand_assets;\r\n    const analyzedAt = ba?.analyzed_at ? new Date(ba.analyzed_at).toLocaleString() : '';\r\n    const aiContext = (ba?.ai_context || '').trim() || '';\r\n    const primaryColor = ba?.primary_color || '';\r\n    const secondaryColor = ba?.secondary_color || '';\r\n    const report = ba?.analysis_report || {};\r\n    const hasReport = Object.keys(report).length > 0;\r\n    const reportSectionKeys = Object.keys(REPORT_SECTION_LABELS);\r\n    const reportHtml = hasReport\r\n      ? reportSectionKeys\r\n        .map((key) => {\r\n          const label = REPORT_SECTION_LABELS[key];\r\n          const text = (report[key as keyof typeof report] || '').trim() || '';\r\n          return `<div class=\"companies-report-section\"><strong>${escapeHtml(label)}</strong><div class=\"companies-report-text\">${escapeHtml(text)}</div></div>`;\r\n        })\r\n        .join('')\r\n      : `<div><strong>AI context</strong><div class=\"companies-report-text\">${escapeHtml(aiContext)}</div></div>\r\n        <div><strong>Primary color</strong> <span style=\"display: inline-flex; align-items: center; gap: 6px;\">${primaryColor !== '' ? `<span style=\"width: 20px; height: 20px; border-radius: 4px; background: ${escapeHtml(primaryColor)};\"></span><code>${escapeHtml(primaryColor)}</code>` : ''}</span></div>\r\n        <div><strong>Secondary color</strong> <span style=\"display: inline-flex; align-items: center; gap: 6px;\">${secondaryColor !== '' ? `<span style=\"width: 20px; height: 20px; border-radius: 4px; background: ${escapeHtml(secondaryColor)};\"></span><code>${escapeHtml(secondaryColor)}</code>` : ''}</span></div>`;\r\n\r\n    const logoBlock = company.logo_url\r\n      ? `<img src=\"${escapeHtml(company.logo_url)}\" alt=\"\" class=\"companies-detail-logo\" onerror=\"this.style.display='none'\">`\r\n      : '<span class=\"companies-detail-logo-placeholder\"></span>';\r\n\r\n    body.innerHTML = `\r\n      <div style=\"margin-bottom: 16px;\">\r\n        <button type=\"button\" class=\"btn btn-secondary btn-sm\" id=\"companies-detail-back-btn\">${escapeHtml(S.backToList)}</button>\r\n      </div>\r\n      <div class=\"companies-detail-header\" style=\"display: flex; align-items: center; gap: 16px; margin-bottom: 16px;\">\r\n        ${logoBlock}\r\n        <div>\r\n          <h3 style=\"margin: 0 0 4px 0; font-size: 1.25rem;\">${escapeHtml(company.name)}</h3>\r\n          <div style=\"font-size: 12px; color: var(--text-secondary);\">${escapeHtml(S.analyzedOn)} ${escapeHtml(analyzedAt)}</div>\r\n        </div>\r\n      </div>\r\n      <div class=\"companies-detail-report\" style=\"display: flex; flex-direction: column; gap: 14px; max-height: 55vh; overflow-y: auto;\">\r\n        ${reportHtml}\r\n      </div>\r\n      ${hasReport ? `<div style=\"margin-top: 8px;\"><strong>Primary color</strong> ${primaryColor !== '' ? `<span style=\"display: inline-flex; align-items: center; gap: 6px;\"><span style=\"width: 16px; height: 16px; border-radius: 4px; background: ${escapeHtml(primaryColor)};\"></span><code>${escapeHtml(primaryColor)}</code></span>` : ''} &nbsp; <strong>Secondary</strong> ${secondaryColor !== '' ? `<span style=\"display: inline-flex; align-items: center; gap: 6px;\"><span style=\"width: 16px; height: 16px; border-radius: 4px; background: ${escapeHtml(secondaryColor)};\"></span><code>${escapeHtml(secondaryColor)}</code></span>` : ''}</div>` : ''}\r\n      <div style=\"margin-top: 16px; display: flex; gap: 8px;\">\r\n        <button type=\"button\" class=\"btn btn-primary\" id=\"companies-detail-reanalyze-btn\" data-id=\"${escapeHtml(company.id)}\">${escapeHtml(S.reAnalyze)}</button>\r\n        <button type=\"button\" class=\"btn btn-secondary\" id=\"companies-detail-edit-btn\" data-id=\"${escapeHtml(company.id)}\">${escapeHtml(S.edit)}</button>\r\n      </div>\r\n    `;\r\n    on(body.querySelector('#companies-detail-back-btn') as HTMLElement, 'click', showListView);\r\n    on(body.querySelector('#companies-detail-edit-btn') as HTMLElement, 'click', () => showForm(company));\r\n    const reanalyzeBtn = body.querySelector('#companies-detail-reanalyze-btn') as HTMLButtonElement;\r\n    on(reanalyzeBtn, 'click', async () => {\r\n      reanalyzeBtn.disabled = true;\r\n      reanalyzeBtn.textContent = '...';\r\n      try {\r\n        const updated = await analyzeCompany(company.id);\r\n        toast.success(S.analysisComplete);\r\n        showDetailView(updated);\r\n      } catch {\r\n        toast.error(S.analysisFailed);\r\n      } finally {\r\n        reanalyzeBtn.disabled = false;\r\n        reanalyzeBtn.textContent = S.reAnalyze;\r\n      }\r\n    });\r\n  }\r\n\r\n  function bindListEvents() {\r\n    on(overlay.querySelector('#companies-close-btn') as HTMLElement, 'click', close);\r\n    on(overlay, 'click', (e) => { if (e.target === overlay) close(); });\r\n    on(container, 'click', (e) => e.stopPropagation());\r\n\r\n    /* Event delegation: list buttons and New are re-created when body is replaced, so bind once on container */\r\n    on(container, 'click', async (e) => {\r\n      const target = e.target as HTMLElement;\r\n      if (target.closest('#companies-new-btn')) {\r\n        showForm();\r\n        return;\r\n      }\r\n      const editBtn = target.closest('.companies-edit-btn');\r\n      const analyzeBtn = target.closest('.companies-analyze-btn');\r\n      const detailBtn = target.closest('.companies-detail-btn');\r\n      const deleteBtn = target.closest('.companies-delete-btn');\r\n      const id = (editBtn || analyzeBtn || detailBtn || deleteBtn)?.getAttribute('data-id');\r\n      if (!id) return;\r\n\r\n      if (detailBtn) {\r\n        try {\r\n          const c = await getCompany(id);\r\n          if (c) showDetailView(c);\r\n        } catch {\r\n          toast.error(S.loadFailed);\r\n        }\r\n        return;\r\n      }\r\n      if (editBtn) {\r\n        try {\r\n          const c = await getCompany(id);\r\n          if (c) showForm(c);\r\n        } catch {\r\n          toast.error(S.loadFailed);\r\n        }\r\n        return;\r\n      }\r\n      if (analyzeBtn) {\r\n        const btn = analyzeBtn as HTMLButtonElement;\r\n        btn.disabled = true;\r\n        const origText = btn.textContent;\r\n        btn.textContent = '...';\r\n        try {\r\n          await analyzeCompany(id);\r\n          toast.success(S.analysisComplete);\r\n          loadList();\r\n        } catch {\r\n          toast.error(S.analysisFailed);\r\n        } finally {\r\n          btn.disabled = false;\r\n          btn.textContent = origText || S.analyze;\r\n        }\r\n        return;\r\n      }\r\n      if (deleteBtn) {\r\n        if (!confirm(S.deleteConfirm)) return;\r\n        try {\r\n          await deleteCompany(id);\r\n          toast.success(S.companyDeleted);\r\n          loadList();\r\n        } catch {\r\n          // API client already shows error toast\r\n        }\r\n      }\r\n    });\r\n  }\r\n\r\n  loadList();\r\n  bindListEvents();\r\n}\r\n","/**\r\n * Contact Modal Component - SOTA Design\r\n * Create and edit contacts with tabs for Info, Projects, Relations, Activity\r\n */\r\n\r\nimport { createElement, on } from '@lib/dom';\r\nimport { createModal, openModal, closeModal, confirm } from '../Modal';\r\nimport { Contact } from '@stores/data';\r\nimport { http } from '@services/api';\r\nimport { toast } from '@services/toast';\r\n\r\nconst MODAL_ID = 'contact-modal';\r\n\r\n// Types\r\ninterface RoleTemplate {\r\n  id: string;\r\n  name: string;\r\n  display_name: string;\r\n  description?: string;\r\n  prompt_template?: string;\r\n  is_active: boolean;\r\n}\r\n\r\ninterface ContactRelation {\r\n  id: string;\r\n  from_contact_id: string;\r\n  to_contact_id: string;\r\n  relationship_type: string;\r\n  to_contact?: {\r\n    id: string;\r\n    name: string;\r\n    role?: string;\r\n    organization?: string;\r\n    avatar_url?: string;\r\n  };\r\n}\r\n\r\ninterface ContactActivity {\r\n  id: string;\r\n  activity_type: string;\r\n  description: string;\r\n  occurred_at: string;\r\n  source_type?: string;\r\n}\r\n\r\ninterface ContactProject {\r\n  id: string;\r\n  name: string;\r\n  role?: string;\r\n  is_primary?: boolean;\r\n}\r\n\r\nexport interface ContactModalProps {\r\n  mode: 'create' | 'edit' | 'view';\r\n  contact?: Contact;\r\n  onSave?: (contact: Contact) => void;\r\n  onDelete?: (contactId: string) => void;\r\n}\r\n\r\n// State\r\nlet currentContact: Contact | null = null;\r\nlet contactProjects: ContactProject[] = [];\r\nlet contactRelations: ContactRelation[] = [];\r\nlet contactActivity: ContactActivity[] = [];\r\nlet allProjects: { id: string; name: string }[] = [];\r\nlet roleTemplates: RoleTemplate[] = [];\r\n\r\n/**\r\n * Show contact modal\r\n */\r\nexport function showContactModal(props: ContactModalProps): void {\r\n  const { mode, contact } = props;\r\n  currentContact = contact || null;\r\n\r\n  // Remove existing modal\r\n  const existing = document.querySelector(`[data-modal-id=\"${MODAL_ID}\"]`);\r\n  if (existing) existing.remove();\r\n\r\n  const content = createModalContent(mode, contact);\r\n\r\n  // Create modal\r\n  const modal = createModal({\r\n    id: MODAL_ID,\r\n    title: '',\r\n    content,\r\n    size: 'lg',\r\n  });\r\n\r\n  // Remove default modal styling for custom design\r\n  const modalContent = modal.querySelector('.modal-content') as HTMLElement;\r\n  if (modalContent) {\r\n    modalContent.classList.add('modal-content-transparent');\r\n  }\r\n  const modalHeader = modal.querySelector('.modal-header') as HTMLElement;\r\n  if (modalHeader) {\r\n    modalHeader.classList.add('hidden');\r\n  }\r\n\r\n  document.body.appendChild(modal);\r\n  openModal(MODAL_ID);\r\n\r\n  // Load data for edit mode\r\n  if (mode === 'edit' && contact?.id) {\r\n    loadContactData(content, contact.id);\r\n  } else {\r\n    loadRoleTemplates(content);\r\n    loadAllProjects(content);\r\n    loadTimezones(content);\r\n  }\r\n\r\n  // Bind events\r\n  bindEvents(content, props);\r\n}\r\n\r\n/**\r\n * Create modal content\r\n */\r\nfunction createModalContent(mode: 'create' | 'edit' | 'view', contact?: Contact): HTMLElement {\r\n  const container = createElement('div', { className: 'contact-modal-sota' });\r\n  const isEdit = mode === 'edit';\r\n  const initials = contact ? getInitials(contact.name) : '?';\r\n  const hasPhoto = !!(contact?.photoUrl || contact?.avatarUrl);\r\n  const photoUrl = contact?.photoUrl || contact?.avatarUrl;\r\n\r\n  container.innerHTML = `\r\n    <style>\r\n      .contact-modal-sota {\r\n        background: var(--bg-primary);\r\n        border-radius: 20px;\r\n        overflow: hidden;\r\n        box-shadow: 0 25px 60px rgba(0,0,0,0.3);\r\n      }\r\n\r\n      /* Header */\r\n      .contact-modal-header {\r\n        background: linear-gradient(135deg, #e11d48 0%, #be123c 50%, #9f1239 100%);\r\n        padding: 32px 32px 24px;\r\n        position: relative;\r\n      }\r\n\r\n      .contact-modal-close {\r\n        position: absolute;\r\n        top: 16px;\r\n        right: 16px;\r\n        width: 36px;\r\n        height: 36px;\r\n        border-radius: 50%;\r\n        background: rgba(255,255,255,0.2);\r\n        border: none;\r\n        cursor: pointer;\r\n        display: flex;\r\n        align-items: center;\r\n        justify-content: center;\r\n        color: white;\r\n        transition: all 0.2s;\r\n      }\r\n\r\n      .contact-modal-close:hover {\r\n        background: rgba(255,255,255,0.3);\r\n        transform: scale(1.1);\r\n      }\r\n\r\n      .contact-modal-close svg {\r\n        width: 20px;\r\n        height: 20px;\r\n      }\r\n\r\n      .contact-header-content {\r\n        display: flex;\r\n        align-items: center;\r\n        gap: 20px;\r\n      }\r\n\r\n      .contact-avatar-large {\r\n        width: 90px;\r\n        height: 90px;\r\n        border-radius: 50%;\r\n        background: rgba(255,255,255,0.2);\r\n        display: flex;\r\n        align-items: center;\r\n        justify-content: center;\r\n        font-size: 32px;\r\n        font-weight: 700;\r\n        color: white;\r\n        border: 4px solid rgba(255,255,255,0.3);\r\n        overflow: hidden;\r\n        cursor: pointer;\r\n        transition: all 0.2s;\r\n        position: relative;\r\n      }\r\n\r\n      .contact-avatar-large:hover {\r\n        border-color: rgba(255,255,255,0.5);\r\n      }\r\n\r\n      .contact-avatar-large img {\r\n        width: 100%;\r\n        height: 100%;\r\n        object-fit: cover;\r\n      }\r\n\r\n      .contact-avatar-large .avatar-upload-hint {\r\n        position: absolute;\r\n        inset: 0;\r\n        background: rgba(0,0,0,0.5);\r\n        display: flex;\r\n        align-items: center;\r\n        justify-content: center;\r\n        opacity: 0;\r\n        transition: opacity 0.2s;\r\n      }\r\n\r\n      .contact-avatar-large:hover .avatar-upload-hint {\r\n        opacity: 1;\r\n      }\r\n\r\n      .contact-avatar-large .avatar-upload-hint svg {\r\n        width: 28px;\r\n        height: 28px;\r\n        color: white;\r\n      }\r\n\r\n      .contact-header-info {\r\n        flex: 1;\r\n        color: white;\r\n      }\r\n\r\n      .contact-header-info h2 {\r\n        margin: 0 0 4px 0;\r\n        font-size: 26px;\r\n        font-weight: 700;\r\n      }\r\n\r\n      .contact-header-info p {\r\n        margin: 0;\r\n        font-size: 15px;\r\n        opacity: 0.85;\r\n      }\r\n\r\n      .contact-header-actions {\r\n        display: flex;\r\n        gap: 10px;\r\n      }\r\n\r\n      .header-action-btn {\r\n        padding: 10px 16px;\r\n        border-radius: 10px;\r\n        background: rgba(255,255,255,0.15);\r\n        border: 1px solid rgba(255,255,255,0.2);\r\n        color: white;\r\n        font-size: 13px;\r\n        font-weight: 600;\r\n        cursor: pointer;\r\n        display: flex;\r\n        align-items: center;\r\n        gap: 6px;\r\n        transition: all 0.2s;\r\n      }\r\n\r\n      .header-action-btn:hover {\r\n        background: rgba(255,255,255,0.25);\r\n      }\r\n\r\n      .header-action-btn svg {\r\n        width: 16px;\r\n        height: 16px;\r\n      }\r\n\r\n      /* Tabs */\r\n      .contact-tabs {\r\n        display: flex;\r\n        border-bottom: 1px solid var(--border-color);\r\n        padding: 0 32px;\r\n        background: var(--bg-secondary);\r\n      }\r\n\r\n      .contact-tab-btn {\r\n        padding: 14px 20px;\r\n        font-size: 14px;\r\n        font-weight: 600;\r\n        color: var(--text-secondary);\r\n        background: none;\r\n        border: none;\r\n        cursor: pointer;\r\n        display: flex;\r\n        align-items: center;\r\n        gap: 8px;\r\n        position: relative;\r\n        transition: color 0.2s;\r\n      }\r\n\r\n      .contact-tab-btn:hover {\r\n        color: var(--text-primary);\r\n      }\r\n\r\n      .contact-tab-btn.active {\r\n        color: #e11d48;\r\n      }\r\n\r\n      .contact-tab-btn.active::after {\r\n        content: '';\r\n        position: absolute;\r\n        bottom: -1px;\r\n        left: 0;\r\n        right: 0;\r\n        height: 3px;\r\n        background: linear-gradient(90deg, #e11d48, #f59e0b);\r\n        border-radius: 3px 3px 0 0;\r\n      }\r\n\r\n      .contact-tab-btn svg {\r\n        width: 16px;\r\n        height: 16px;\r\n      }\r\n\r\n      .contact-tab-btn .tab-count {\r\n        background: rgba(225,29,72,0.1);\r\n        color: #e11d48;\r\n        padding: 2px 8px;\r\n        border-radius: 10px;\r\n        font-size: 11px;\r\n      }\r\n\r\n      /* Tab Content */\r\n      .contact-tab-content {\r\n        padding: 28px 32px;\r\n        min-height: 400px;\r\n        max-height: 500px;\r\n        overflow-y: auto;\r\n      }\r\n\r\n      .contact-section {\r\n        display: none;\r\n      }\r\n\r\n      .contact-section.active {\r\n        display: block;\r\n      }\r\n\r\n      /* Form Styles */\r\n      .form-grid {\r\n        display: grid;\r\n        grid-template-columns: 1fr 1fr;\r\n        gap: 20px;\r\n      }\r\n\r\n      .form-grid.full {\r\n        grid-template-columns: 1fr;\r\n      }\r\n\r\n      .form-field {\r\n        display: flex;\r\n        flex-direction: column;\r\n        gap: 6px;\r\n      }\r\n\r\n      .form-field.full-width {\r\n        grid-column: 1 / -1;\r\n      }\r\n\r\n      .form-field label {\r\n        font-size: 13px;\r\n        font-weight: 600;\r\n        color: var(--text-secondary);\r\n        display: flex;\r\n        align-items: center;\r\n        gap: 6px;\r\n      }\r\n\r\n      .form-field label svg {\r\n        width: 14px;\r\n        height: 14px;\r\n        color: #e11d48;\r\n      }\r\n\r\n      .form-field input,\r\n      .form-field textarea,\r\n      .form-field select {\r\n        padding: 12px 14px;\r\n        border: 1px solid var(--border-color);\r\n        border-radius: 10px;\r\n        font-size: 14px;\r\n        background: var(--bg-secondary);\r\n        color: var(--text-primary);\r\n        transition: all 0.2s;\r\n      }\r\n\r\n      .form-field input:focus,\r\n      .form-field textarea:focus,\r\n      .form-field select:focus {\r\n        outline: none;\r\n        border-color: #e11d48;\r\n        box-shadow: 0 0 0 3px rgba(225,29,72,0.1);\r\n      }\r\n\r\n      .form-field textarea {\r\n        resize: vertical;\r\n        min-height: 100px;\r\n      }\r\n\r\n      .form-hint {\r\n        font-size: 12px;\r\n        color: var(--text-tertiary);\r\n      }\r\n\r\n      /* Projects Section */\r\n      .projects-list {\r\n        display: flex;\r\n        flex-direction: column;\r\n        gap: 10px;\r\n      }\r\n\r\n      .project-item {\r\n        display: flex;\r\n        align-items: center;\r\n        gap: 12px;\r\n        padding: 14px;\r\n        background: var(--bg-secondary);\r\n        border: 1px solid var(--border-color);\r\n        border-radius: 10px;\r\n        transition: all 0.2s;\r\n      }\r\n\r\n      .project-item:hover {\r\n        border-color: rgba(225,29,72,0.3);\r\n      }\r\n\r\n      .project-checkbox {\r\n        width: 20px;\r\n        height: 20px;\r\n        accent-color: #e11d48;\r\n      }\r\n\r\n      .project-item label {\r\n        flex: 1;\r\n        font-size: 14px;\r\n        color: var(--text-primary);\r\n        cursor: pointer;\r\n      }\r\n\r\n      .project-item .primary-badge {\r\n        padding: 3px 8px;\r\n        background: linear-gradient(135deg, #e11d48, #be123c);\r\n        color: white;\r\n        border-radius: 4px;\r\n        font-size: 10px;\r\n        font-weight: 600;\r\n      }\r\n\r\n      /* Relations Section */\r\n      .relations-list {\r\n        display: flex;\r\n        flex-direction: column;\r\n        gap: 12px;\r\n      }\r\n\r\n      .relation-card {\r\n        display: flex;\r\n        align-items: center;\r\n        gap: 14px;\r\n        padding: 14px;\r\n        background: var(--bg-secondary);\r\n        border: 1px solid var(--border-color);\r\n        border-radius: 12px;\r\n        transition: all 0.2s;\r\n      }\r\n\r\n      .relation-card:hover {\r\n        border-color: rgba(225,29,72,0.3);\r\n        transform: translateX(4px);\r\n      }\r\n\r\n      .relation-avatar {\r\n        width: 44px;\r\n        height: 44px;\r\n        border-radius: 50%;\r\n        background: linear-gradient(135deg, #6366f1, #4f46e5);\r\n        display: flex;\r\n        align-items: center;\r\n        justify-content: center;\r\n        font-size: 16px;\r\n        font-weight: 600;\r\n        color: white;\r\n        overflow: hidden;\r\n      }\r\n\r\n      .relation-avatar img {\r\n        width: 100%;\r\n        height: 100%;\r\n        object-fit: cover;\r\n      }\r\n\r\n      .relation-info {\r\n        flex: 1;\r\n      }\r\n\r\n      .relation-info h4 {\r\n        margin: 0 0 2px 0;\r\n        font-size: 14px;\r\n        font-weight: 600;\r\n        color: var(--text-primary);\r\n      }\r\n\r\n      .relation-info p {\r\n        margin: 0;\r\n        font-size: 12px;\r\n        color: var(--text-secondary);\r\n      }\r\n\r\n      .relation-type {\r\n        padding: 4px 10px;\r\n        background: rgba(99,102,241,0.1);\r\n        color: #6366f1;\r\n        border-radius: 6px;\r\n        font-size: 12px;\r\n        font-weight: 600;\r\n      }\r\n\r\n      .add-relation-btn {\r\n        display: flex;\r\n        align-items: center;\r\n        justify-content: center;\r\n        gap: 8px;\r\n        padding: 14px;\r\n        background: var(--bg-secondary);\r\n        border: 2px dashed var(--border-color);\r\n        border-radius: 12px;\r\n        color: var(--text-secondary);\r\n        font-size: 14px;\r\n        font-weight: 500;\r\n        cursor: pointer;\r\n        transition: all 0.2s;\r\n      }\r\n\r\n      .add-relation-btn:hover {\r\n        border-color: #e11d48;\r\n        color: #e11d48;\r\n      }\r\n\r\n      .add-relation-btn svg {\r\n        width: 18px;\r\n        height: 18px;\r\n      }\r\n\r\n      /* Activity Section */\r\n      .activity-timeline {\r\n        position: relative;\r\n        padding-left: 28px;\r\n      }\r\n\r\n      .activity-timeline::before {\r\n        content: '';\r\n        position: absolute;\r\n        left: 8px;\r\n        top: 0;\r\n        bottom: 0;\r\n        width: 2px;\r\n        background: var(--border-color);\r\n      }\r\n\r\n      .activity-item {\r\n        position: relative;\r\n        padding-bottom: 20px;\r\n      }\r\n\r\n      .activity-item::before {\r\n        content: '';\r\n        position: absolute;\r\n        left: -24px;\r\n        top: 4px;\r\n        width: 12px;\r\n        height: 12px;\r\n        border-radius: 50%;\r\n        background: #e11d48;\r\n        border: 2px solid var(--bg-primary);\r\n      }\r\n\r\n      .activity-item.email::before { background: #3b82f6; }\r\n      .activity-item.meeting::before { background: #10b981; }\r\n      .activity-item.note::before { background: #f59e0b; }\r\n\r\n      .activity-time {\r\n        font-size: 11px;\r\n        color: var(--text-tertiary);\r\n        margin-bottom: 4px;\r\n      }\r\n\r\n      .activity-content {\r\n        font-size: 14px;\r\n        color: var(--text-primary);\r\n        line-height: 1.5;\r\n      }\r\n\r\n      .activity-empty {\r\n        text-align: center;\r\n        padding: 40px;\r\n        color: var(--text-secondary);\r\n      }\r\n\r\n      .activity-empty svg {\r\n        width: 48px;\r\n        height: 48px;\r\n        opacity: 0.4;\r\n        margin-bottom: 12px;\r\n      }\r\n\r\n      /* Footer */\r\n      .contact-modal-footer {\r\n        display: flex;\r\n        justify-content: space-between;\r\n        align-items: center;\r\n        padding: 20px 32px;\r\n        border-top: 1px solid var(--border-color);\r\n        background: var(--bg-secondary);\r\n      }\r\n\r\n      .footer-left {\r\n        display: flex;\r\n        gap: 10px;\r\n      }\r\n\r\n      .footer-right {\r\n        display: flex;\r\n        gap: 10px;\r\n      }\r\n\r\n      .btn-sota {\r\n        display: inline-flex;\r\n        align-items: center;\r\n        gap: 8px;\r\n        padding: 12px 20px;\r\n        border-radius: 10px;\r\n        font-size: 14px;\r\n        font-weight: 600;\r\n        cursor: pointer;\r\n        transition: all 0.2s;\r\n        border: none;\r\n      }\r\n\r\n      .btn-sota.primary {\r\n        background: linear-gradient(135deg, #e11d48 0%, #be123c 100%);\r\n        color: white;\r\n        box-shadow: 0 4px 12px rgba(225,29,72,0.3);\r\n      }\r\n\r\n      .btn-sota.primary:hover {\r\n        transform: translateY(-2px);\r\n        box-shadow: 0 6px 16px rgba(225,29,72,0.4);\r\n      }\r\n\r\n      .btn-sota.secondary {\r\n        background: var(--bg-primary);\r\n        color: var(--text-primary);\r\n        border: 1px solid var(--border-color);\r\n      }\r\n\r\n      .btn-sota.secondary:hover {\r\n        background: var(--bg-tertiary);\r\n        border-color: #e11d48;\r\n      }\r\n\r\n      .btn-sota.danger {\r\n        background: transparent;\r\n        color: #dc2626;\r\n        border: 1px solid #dc2626;\r\n      }\r\n\r\n      .btn-sota.danger:hover {\r\n        background: #dc2626;\r\n        color: white;\r\n      }\r\n\r\n      .btn-sota svg {\r\n        width: 16px;\r\n        height: 16px;\r\n      }\r\n\r\n      .btn-sota:disabled {\r\n        opacity: 0.6;\r\n        cursor: not-allowed;\r\n      }\r\n\r\n      /* Loading */\r\n      .loading-spinner {\r\n        display: flex;\r\n        align-items: center;\r\n        justify-content: center;\r\n        padding: 40px;\r\n        color: var(--text-secondary);\r\n      }\r\n\r\n      .loading-spinner::after {\r\n        content: '';\r\n        width: 24px;\r\n        height: 24px;\r\n        border: 3px solid var(--border-color);\r\n        border-top-color: #e11d48;\r\n        border-radius: 50%;\r\n        animation: spin 0.8s linear infinite;\r\n        margin-left: 12px;\r\n      }\r\n\r\n      @keyframes spin {\r\n        to { transform: rotate(360deg); }\r\n      }\r\n    </style>\r\n\r\n    <!-- Header -->\r\n    <div class=\"contact-modal-header\">\r\n      <button class=\"contact-modal-close\" id=\"close-contact-btn\">\r\n        <svg fill=\"none\" viewBox=\"0 0 24 24\" stroke=\"currentColor\">\r\n          <path stroke-linecap=\"round\" stroke-linejoin=\"round\" stroke-width=\"2\" d=\"M6 18L18 6M6 6l12 12\"/>\r\n        </svg>\r\n      </button>\r\n\r\n      <div class=\"contact-header-content\">\r\n        <div class=\"contact-avatar-large\" id=\"contact-avatar-upload\">\r\n          ${hasPhoto\r\n      ? `<img src=\"${photoUrl}\" alt=\"\">`\r\n      : `<span>${initials}</span>`\r\n    }\r\n          <div class=\"avatar-upload-hint\">\r\n            <svg fill=\"none\" viewBox=\"0 0 24 24\" stroke=\"currentColor\">\r\n              <path stroke-linecap=\"round\" stroke-linejoin=\"round\" stroke-width=\"2\" d=\"M3 9a2 2 0 012-2h.93a2 2 0 001.664-.89l.812-1.22A2 2 0 0110.07 4h3.86a2 2 0 011.664.89l.812 1.22A2 2 0 0018.07 7H19a2 2 0 012 2v9a2 2 0 01-2 2H5a2 2 0 01-2-2V9z\"/>\r\n              <path stroke-linecap=\"round\" stroke-linejoin=\"round\" stroke-width=\"2\" d=\"M15 13a3 3 0 11-6 0 3 3 0 016 0z\"/>\r\n            </svg>\r\n          </div>\r\n        </div>\r\n\r\n        <div class=\"contact-header-info\">\r\n          <h2 id=\"header-contact-name\">${isEdit ? escapeHtml(contact?.name || '') : 'New Contact'}</h2>\r\n          <p id=\"header-contact-org\">${isEdit && contact?.organization ? escapeHtml(contact.organization) : 'Add organization'}</p>\r\n        </div>\r\n\r\n        ${isEdit ? `\r\n          <div class=\"contact-header-actions\">\r\n            <button class=\"header-action-btn\" id=\"enrich-ai-btn\" title=\"Enrich with AI\">\r\n              <svg fill=\"none\" viewBox=\"0 0 24 24\" stroke=\"currentColor\">\r\n                <path stroke-linecap=\"round\" stroke-linejoin=\"round\" stroke-width=\"2\" d=\"M13 10V3L4 14h7v7l9-11h-7z\"/>\r\n              </svg>\r\n              Enrich with AI\r\n            </button>\r\n          </div>\r\n        ` : ''}\r\n      </div>\r\n    </div>\r\n\r\n    <!-- Tabs -->\r\n    <div class=\"contact-tabs\">\r\n      <button class=\"contact-tab-btn active\" data-tab=\"info\">\r\n        <svg fill=\"none\" viewBox=\"0 0 24 24\" stroke=\"currentColor\">\r\n          <path stroke-linecap=\"round\" stroke-linejoin=\"round\" stroke-width=\"2\" d=\"M16 7a4 4 0 11-8 0 4 4 0 018 0zM12 14a7 7 0 00-7 7h14a7 7 0 00-7-7z\"/>\r\n        </svg>\r\n        Info\r\n      </button>\r\n      <button class=\"contact-tab-btn\" data-tab=\"projects\">\r\n        <svg fill=\"none\" viewBox=\"0 0 24 24\" stroke=\"currentColor\">\r\n          <path stroke-linecap=\"round\" stroke-linejoin=\"round\" stroke-width=\"2\" d=\"M3 7v10a2 2 0 002 2h14a2 2 0 002-2V9a2 2 0 00-2-2h-6l-2-2H5a2 2 0 00-2 2z\"/>\r\n        </svg>\r\n        Projects\r\n        <span class=\"tab-count\" id=\"projects-count\">0</span>\r\n      </button>\r\n      <button class=\"contact-tab-btn\" data-tab=\"relations\">\r\n        <svg fill=\"none\" viewBox=\"0 0 24 24\" stroke=\"currentColor\">\r\n          <path stroke-linecap=\"round\" stroke-linejoin=\"round\" stroke-width=\"2\" d=\"M17 20h5v-2a3 3 0 00-5.356-1.857M17 20H7m10 0v-2c0-.656-.126-1.283-.356-1.857M7 20H2v-2a3 3 0 015.356-1.857M7 20v-2c0-.656.126-1.283.356-1.857m0 0a5.002 5.002 0 019.288 0M15 7a3 3 0 11-6 0 3 3 0 016 0zm6 3a2 2 0 11-4 0 2 2 0 014 0zM7 10a2 2 0 11-4 0 2 2 0 014 0z\"/>\r\n        </svg>\r\n        Relations\r\n        <span class=\"tab-count\" id=\"relations-count\">0</span>\r\n      </button>\r\n      <button class=\"contact-tab-btn\" data-tab=\"activity\">\r\n        <svg fill=\"none\" viewBox=\"0 0 24 24\" stroke=\"currentColor\">\r\n          <path stroke-linecap=\"round\" stroke-linejoin=\"round\" stroke-width=\"2\" d=\"M12 8v4l3 3m6-3a9 9 0 11-18 0 9 9 0 0118 0z\"/>\r\n        </svg>\r\n        Activity\r\n      </button>\r\n    </div>\r\n\r\n    <!-- Tab Content -->\r\n    <div class=\"contact-tab-content\">\r\n      <!-- Info Section -->\r\n      <div class=\"contact-section active\" id=\"section-info\">\r\n        <form id=\"contact-form\">\r\n          <div class=\"form-grid\">\r\n            <div class=\"form-field\">\r\n              <label>\r\n                <svg fill=\"none\" viewBox=\"0 0 24 24\" stroke=\"currentColor\">\r\n                  <path stroke-linecap=\"round\" stroke-linejoin=\"round\" stroke-width=\"2\" d=\"M16 7a4 4 0 11-8 0 4 4 0 018 0zM12 14a7 7 0 00-7 7h14a7 7 0 00-7-7z\"/>\r\n                </svg>\r\n                Name *\r\n              </label>\r\n              <input type=\"text\" id=\"contact-name\" required value=\"${escapeHtml(contact?.name || '')}\" placeholder=\"Full name\">\r\n            </div>\r\n\r\n            <div class=\"form-field\">\r\n              <label>\r\n                <svg fill=\"none\" viewBox=\"0 0 24 24\" stroke=\"currentColor\">\r\n                  <path stroke-linecap=\"round\" stroke-linejoin=\"round\" stroke-width=\"2\" d=\"M21 13.255A23.931 23.931 0 0112 15c-3.183 0-6.22-.62-9-1.745M16 6V4a2 2 0 00-2-2h-4a2 2 0 00-2 2v2m4 6h.01M5 20h14a2 2 0 002-2V8a2 2 0 00-2-2H5a2 2 0 00-2 2v10a2 2 0 002 2z\"/>\r\n                </svg>\r\n                Role\r\n              </label>\r\n              <select id=\"contact-role\">\r\n                <option value=\"\">-- Select role --</option>\r\n                <option value=\"__custom__\">Custom role...</option>\r\n              </select>\r\n              <input type=\"text\" id=\"contact-role-custom\" class=\"contact-role-custom hidden\" placeholder=\"Enter custom role\" value=\"${contact?.role && !roleTemplates.some(r => r.display_name === contact.role) ? escapeHtml(contact.role) : ''}\">\r\n            </div>\r\n\r\n            <div class=\"form-field\">\r\n              <label>\r\n                <svg fill=\"none\" viewBox=\"0 0 24 24\" stroke=\"currentColor\">\r\n                  <path stroke-linecap=\"round\" stroke-linejoin=\"round\" stroke-width=\"2\" d=\"M3 8l7.89 5.26a2 2 0 002.22 0L21 8M5 19h14a2 2 0 002-2V7a2 2 0 00-2-2H5a2 2 0 00-2 2v10a2 2 0 002 2z\"/>\r\n                </svg>\r\n                Email\r\n              </label>\r\n              <input type=\"email\" id=\"contact-email\" value=\"${escapeHtml(contact?.email || '')}\" placeholder=\"email@example.com\">\r\n            </div>\r\n\r\n            <div class=\"form-field\">\r\n              <label>\r\n                <svg fill=\"none\" viewBox=\"0 0 24 24\" stroke=\"currentColor\">\r\n                  <path stroke-linecap=\"round\" stroke-linejoin=\"round\" stroke-width=\"2\" d=\"M3 5a2 2 0 012-2h3.28a1 1 0 01.948.684l1.498 4.493a1 1 0 01-.502 1.21l-2.257 1.13a11.042 11.042 0 005.516 5.516l1.13-2.257a1 1 0 011.21-.502l4.493 1.498a1 1 0 01.684.949V19a2 2 0 01-2 2h-1C9.716 21 3 14.284 3 6V5z\"/>\r\n                </svg>\r\n                Phone\r\n              </label>\r\n              <input type=\"tel\" id=\"contact-phone\" value=\"${escapeHtml(contact?.phone || '')}\" placeholder=\"+1 234 567 890\">\r\n            </div>\r\n\r\n            <div class=\"form-field\">\r\n              <label>\r\n                <svg fill=\"none\" viewBox=\"0 0 24 24\" stroke=\"currentColor\">\r\n                  <path stroke-linecap=\"round\" stroke-linejoin=\"round\" stroke-width=\"2\" d=\"M19 21V5a2 2 0 00-2-2H7a2 2 0 00-2 2v16m14 0h2m-2 0h-5m-9 0H3m2 0h5M9 7h1m-1 4h1m4-4h1m-1 4h1m-5 10v-5a1 1 0 011-1h2a1 1 0 011 1v5m-4 0h4\"/>\r\n                </svg>\r\n                Organization\r\n              </label>\r\n              <input type=\"text\" id=\"contact-organization\" value=\"${escapeHtml(contact?.organization || contact?.company || '')}\" placeholder=\"Company name\">\r\n            </div>\r\n\r\n            <div class=\"form-field\">\r\n              <label>\r\n                <svg fill=\"none\" viewBox=\"0 0 24 24\" stroke=\"currentColor\">\r\n                  <path stroke-linecap=\"round\" stroke-linejoin=\"round\" stroke-width=\"2\" d=\"M21 12a9 9 0 01-9 9m9-9a9 9 0 00-9-9m9 9H3m9 9a9 9 0 01-9-9m9 9c1.657 0 3-4.03 3-9s-1.343-9-3-9m0 18c-1.657 0-3-4.03-3-9s1.343-9 3-9m-9 9a9 9 0 019-9\"/>\r\n                </svg>\r\n                LinkedIn\r\n              </label>\r\n              <input type=\"url\" id=\"contact-linkedin\" value=\"${escapeHtml(contact?.linkedin || '')}\" placeholder=\"https://linkedin.com/in/...\">\r\n            </div>\r\n\r\n            <div class=\"form-field full-width\">\r\n              <label>\r\n                <svg fill=\"none\" viewBox=\"0 0 24 24\" stroke=\"currentColor\">\r\n                  <path stroke-linecap=\"round\" stroke-linejoin=\"round\" stroke-width=\"2\" d=\"M4 16l4.586-4.586a2 2 0 012.828 0L16 16m-2-2l1.586-1.586a2 2 0 012.828 0L20 14m-6-6h.01M6 20h12a2 2 0 002-2V6a2 2 0 00-2-2H6a2 2 0 00-2 2v12a2 2 0 002 2z\"/>\r\n                </svg>\r\n                Avatar URL\r\n              </label>\r\n              <input type=\"url\" id=\"contact-avatar-url\" value=\"${escapeHtml(contact?.photoUrl || contact?.avatarUrl || contact?.photo_url || contact?.avatar_url || '')}\" placeholder=\"https://example.com/photo.jpg\">\r\n              <div class=\"form-hint\">Enter a URL to set the contact's profile picture</div>\r\n            </div>\r\n\r\n            <div class=\"form-field\">\r\n              <label>\r\n                <svg fill=\"none\" viewBox=\"0 0 24 24\" stroke=\"currentColor\">\r\n                  <path stroke-linecap=\"round\" stroke-linejoin=\"round\" stroke-width=\"2\" d=\"M19 21V5a2 2 0 00-2-2H7a2 2 0 00-2 2v16m14 0h2m-2 0h-5m-9 0H3m2 0h5M9 7h1m-1 4h1m4-4h1m-1 4h1m-5 10v-5a1 1 0 011-1h2a1 1 0 011 1v5m-4 0h4\"/>\r\n                </svg>\r\n                Department\r\n              </label>\r\n              <input type=\"text\" id=\"contact-department\" value=\"${escapeHtml(contact?.department || '')}\" placeholder=\"Engineering, Sales, etc.\">\r\n            </div>\r\n\r\n            <div class=\"form-field\">\r\n              <label>\r\n                <svg fill=\"none\" viewBox=\"0 0 24 24\" stroke=\"currentColor\">\r\n                  <path stroke-linecap=\"round\" stroke-linejoin=\"round\" stroke-width=\"2\" d=\"M17.657 16.657L13.414 20.9a1.998 1.998 0 01-2.827 0l-4.244-4.243a8 8 0 1111.314 0z\"/>\r\n                  <path stroke-linecap=\"round\" stroke-linejoin=\"round\" stroke-width=\"2\" d=\"M15 11a3 3 0 11-6 0 3 3 0 016 0z\"/>\r\n                </svg>\r\n                Location\r\n              </label>\r\n              <input type=\"text\" id=\"contact-location\" value=\"${escapeHtml(contact?.location || '')}\" placeholder=\"City, Country\">\r\n            </div>\r\n\r\n            <div class=\"form-field\">\r\n              <label>\r\n                <svg fill=\"none\" viewBox=\"0 0 24 24\" stroke=\"currentColor\">\r\n                  <path stroke-linecap=\"round\" stroke-linejoin=\"round\" stroke-width=\"2\" d=\"M12 8v4l3 3m6-3a9 9 0 11-18 0 9 9 0 0118 0z\"/>\r\n                </svg>\r\n                Timezone\r\n              </label>\r\n              <select id=\"contact-timezone\" data-current=\"${escapeHtml(contact?.timezone || '')}\">\r\n                <option value=\"\">Select timezone...</option>\r\n              </select>\r\n            </div>\r\n\r\n            <div class=\"form-field full-width\">\r\n              <label>\r\n                <svg fill=\"none\" viewBox=\"0 0 24 24\" stroke=\"currentColor\">\r\n                  <path stroke-linecap=\"round\" stroke-linejoin=\"round\" stroke-width=\"2\" d=\"M17 20h5v-2a3 3 0 00-5.356-1.857M17 20H7m10 0v-2c0-.656-.126-1.283-.356-1.857M7 20H2v-2a3 3 0 015.356-1.857M7 20v-2c0-.656.126-1.283.356-1.857m0 0a5.002 5.002 0 019.288 0M15 7a3 3 0 11-6 0 3 3 0 016 0z\"/>\r\n                </svg>\r\n                Aliases\r\n              </label>\r\n              <input type=\"text\" id=\"contact-aliases\" value=\"${contact?.aliases?.join(', ') || ''}\" placeholder=\"Alternative names (comma separated)\">\r\n              <div class=\"form-hint\">Names used to identify this person in documents (e.g., \"Luuc\" for \"Luuk\")</div>\r\n            </div>\r\n\r\n            <div class=\"form-field full-width\">\r\n              <label>\r\n                <svg fill=\"none\" viewBox=\"0 0 24 24\" stroke=\"currentColor\">\r\n                  <path stroke-linecap=\"round\" stroke-linejoin=\"round\" stroke-width=\"2\" d=\"M11 5H6a2 2 0 00-2 2v11a2 2 0 002 2h11a2 2 0 002-2v-5m-1.414-9.414a2 2 0 112.828 2.828L11.828 15H9v-2.828l8.586-8.586z\"/>\r\n                </svg>\r\n                Notes\r\n              </label>\r\n              <textarea id=\"contact-notes\" placeholder=\"Additional notes about this contact...\">${escapeHtml(contact?.notes || '')}</textarea>\r\n            </div>\r\n\r\n            <div class=\"form-field full-width\">\r\n              <label>\r\n                <svg fill=\"none\" viewBox=\"0 0 24 24\" stroke=\"currentColor\">\r\n                  <path stroke-linecap=\"round\" stroke-linejoin=\"round\" stroke-width=\"2\" d=\"M7 7h.01M7 3h5c.512 0 1.024.195 1.414.586l7 7a2 2 0 010 2.828l-7 7a2 2 0 01-2.828 0l-7-7A1.994 1.994 0 013 12V7a4 4 0 014-4z\"/>\r\n                </svg>\r\n                Tags\r\n              </label>\r\n              <input type=\"text\" id=\"contact-tags\" value=\"${contact?.tags?.join(', ') || ''}\" placeholder=\"client, vip, technical (comma separated)\">\r\n              <div class=\"form-hint\">Separate tags with commas</div>\r\n            </div>\r\n          </div>\r\n        </form>\r\n      </div>\r\n\r\n      <!-- Projects Section -->\r\n      <div class=\"contact-section\" id=\"section-projects\">\r\n        <div class=\"projects-list\" id=\"projects-list\">\r\n          <div class=\"loading-spinner\">Loading projects</div>\r\n        </div>\r\n      </div>\r\n\r\n      <!-- Relations Section -->\r\n      <div class=\"contact-section\" id=\"section-relations\">\r\n        <div class=\"relations-list\" id=\"relations-list\">\r\n          <div class=\"loading-spinner\">Loading relations</div>\r\n        </div>\r\n        <button class=\"add-relation-btn\" id=\"add-relation-btn\">\r\n          <svg fill=\"none\" viewBox=\"0 0 24 24\" stroke=\"currentColor\">\r\n            <path stroke-linecap=\"round\" stroke-linejoin=\"round\" stroke-width=\"2\" d=\"M12 4v16m8-8H4\"/>\r\n          </svg>\r\n          Add Relationship\r\n        </button>\r\n      </div>\r\n\r\n      <!-- Activity Section -->\r\n      <div class=\"contact-section\" id=\"section-activity\">\r\n        <div class=\"activity-timeline\" id=\"activity-timeline\">\r\n          <div class=\"loading-spinner\">Loading activity</div>\r\n        </div>\r\n      </div>\r\n    </div>\r\n\r\n    <!-- Footer -->\r\n    <div class=\"contact-modal-footer\">\r\n      <div class=\"footer-left\">\r\n        ${isEdit ? `\r\n          <button class=\"btn-sota danger\" id=\"delete-contact-btn\">\r\n            <svg fill=\"none\" viewBox=\"0 0 24 24\" stroke=\"currentColor\">\r\n              <path stroke-linecap=\"round\" stroke-linejoin=\"round\" stroke-width=\"2\" d=\"M19 7l-.867 12.142A2 2 0 0116.138 21H7.862a2 2 0 01-1.995-1.858L5 7m5 4v6m4-6v6m1-10V4a1 1 0 00-1-1h-4a1 1 0 00-1 1v3M4 7h16\"/>\r\n            </svg>\r\n            Delete\r\n          </button>\r\n        ` : ''}\r\n      </div>\r\n      <div class=\"footer-right\">\r\n        <button class=\"btn-sota secondary\" id=\"cancel-contact-btn\">Cancel</button>\r\n        <button class=\"btn-sota primary\" id=\"save-contact-btn\">\r\n          <svg fill=\"none\" viewBox=\"0 0 24 24\" stroke=\"currentColor\">\r\n            <path stroke-linecap=\"round\" stroke-linejoin=\"round\" stroke-width=\"2\" d=\"M5 13l4 4L19 7\"/>\r\n          </svg>\r\n          ${isEdit ? 'Save Changes' : 'Create Contact'}\r\n        </button>\r\n      </div>\r\n    </div>\r\n  `;\r\n\r\n  return container;\r\n}\r\n\r\n/**\r\n * Load contact data for edit mode\r\n */\r\nasync function loadContactData(container: HTMLElement, contactId: string): Promise<void> {\r\n  try {\r\n    const [projectsRes, relationsRes, activityRes, rolesRes, allProjectsRes, timezonesRes] = await Promise.all([\r\n      http.get<{ projects: ContactProject[] }>(`/api/contacts/${contactId}/projects`).catch(() => ({ data: { projects: [] } })),\r\n      http.get<{ relationships: ContactRelation[] }>(`/api/contacts/${contactId}/relationships`).catch(() => ({ data: { relationships: [] } })),\r\n      http.get<{ activities: ContactActivity[] }>(`/api/contacts/${contactId}/activity`).catch(() => ({ data: { activities: [] } })),\r\n      http.get<{ roles: RoleTemplate[] }>('/api/role-templates').catch(() => ({ data: { roles: [] } })),\r\n      http.get<{ projects: { id: string; name: string }[] }>('/api/projects').catch(() => ({ data: { projects: [] } })),\r\n      http.get<{ timezones: { code: string; name: string; utc_offset: string }[] }>('/api/timezones').catch(() => ({ data: { timezones: [] } })),\r\n    ]);\r\n\r\n    contactProjects = projectsRes.data?.projects || [];\r\n    contactRelations = relationsRes.data?.relationships || [];\r\n    contactActivity = activityRes.data?.activities || [];\r\n    roleTemplates = rolesRes.data?.roles || [];\r\n    allProjects = allProjectsRes.data?.projects || [];\r\n    const timezones = timezonesRes.data?.timezones || [];\r\n\r\n    // Render timezone dropdown\r\n    renderTimezoneDropdown(container, timezones);\r\n\r\n    // Render sections\r\n    renderRoleDropdown(container);\r\n    renderProjectsList(container);\r\n    renderRelationsList(container);\r\n    renderActivityTimeline(container);\r\n\r\n    // Update counts\r\n    updateTabCounts(container);\r\n  } catch (error) {\r\n    console.error('Failed to load contact data:', error);\r\n  }\r\n}\r\n\r\n/**\r\n * Load role templates\r\n */\r\nasync function loadRoleTemplates(container: HTMLElement): Promise<void> {\r\n  try {\r\n    const response = await http.get<{ roles: RoleTemplate[] }>('/api/role-templates');\r\n    roleTemplates = response.data?.roles || [];\r\n    renderRoleDropdown(container);\r\n  } catch {\r\n    roleTemplates = [];\r\n  }\r\n}\r\n\r\n/**\r\n * Load timezones for new contact\r\n */\r\nasync function loadTimezones(container: HTMLElement): Promise<void> {\r\n  try {\r\n    const response = await http.get<{ timezones: { code: string; name: string; utc_offset: string }[] }>('/api/timezones');\r\n    const timezones = response.data?.timezones || [];\r\n    renderTimezoneDropdown(container, timezones);\r\n  } catch {\r\n    // Leave empty\r\n  }\r\n}\r\n\r\n/**\r\n * Load all projects\r\n */\r\nasync function loadAllProjects(container: HTMLElement): Promise<void> {\r\n  try {\r\n    const response = await http.get<{ projects: { id: string; name: string }[] }>('/api/projects');\r\n    allProjects = response.data?.projects || [];\r\n    renderProjectsList(container);\r\n  } catch {\r\n    allProjects = [];\r\n  }\r\n}\r\n\r\n/**\r\n * Render timezone dropdown\r\n */\r\nfunction renderTimezoneDropdown(container: HTMLElement, timezones: { code: string; name: string; utc_offset: string }[]): void {\r\n  const tzSelect = container.querySelector('#contact-timezone') as HTMLSelectElement;\r\n  if (!tzSelect) return;\r\n\r\n  const currentTz = tzSelect.dataset.current || '';\r\n\r\n  // Group timezones by region\r\n  const grouped: Record<string, typeof timezones> = {};\r\n  for (const tz of timezones) {\r\n    const region = tz.code.includes('/') ? tz.code.split('/')[0] : 'Other';\r\n    if (!grouped[region]) grouped[region] = [];\r\n    grouped[region].push(tz);\r\n  }\r\n\r\n  // Sort regions\r\n  const sortedRegions = Object.keys(grouped).sort();\r\n\r\n  tzSelect.innerHTML = `\r\n    <option value=\"\">Select timezone...</option>\r\n    ${sortedRegions.map(region => `\r\n      <optgroup label=\"${region}\">\r\n        ${grouped[region].map(tz => `\r\n          <option value=\"${escapeHtml(tz.code)}\" ${currentTz === tz.code ? 'selected' : ''}>\r\n            ${escapeHtml(tz.name || tz.code)} (${tz.utc_offset})\r\n          </option>\r\n        `).join('')}\r\n      </optgroup>\r\n    `).join('')}\r\n  `;\r\n}\r\n\r\n/**\r\n * Render role dropdown\r\n */\r\nfunction renderRoleDropdown(container: HTMLElement): void {\r\n  const roleSelect = container.querySelector('#contact-role') as HTMLSelectElement;\r\n  const customInput = container.querySelector('#contact-role-custom') as HTMLInputElement;\r\n  if (!roleSelect) return;\r\n\r\n  const currentRole = currentContact?.role;\r\n  const isCustomRole = currentRole && !roleTemplates.some(r => r.display_name === currentRole || r.name === currentRole);\r\n\r\n  roleSelect.innerHTML = `\r\n    <option value=\"\">-- Select role --</option>\r\n    ${roleTemplates.filter(r => r.is_active).map(r => `\r\n      <option value=\"${escapeHtml(r.display_name || r.name)}\" ${currentRole === r.display_name || currentRole === r.name ? 'selected' : ''}>\r\n        ${escapeHtml(r.display_name || r.name)}\r\n      </option>\r\n    `).join('')}\r\n    <option value=\"__custom__\" ${isCustomRole ? 'selected' : ''}>Custom role...</option>\r\n  `;\r\n\r\n  // Show custom input if custom is selected\r\n  if (isCustomRole && customInput) {\r\n    customInput.classList.remove('hidden');\r\n    customInput.value = currentRole;\r\n  }\r\n\r\n  // Handle role change\r\n  on(roleSelect, 'change', () => {\r\n    const isCustom = roleSelect.value === '__custom__';\r\n    customInput.classList.toggle('hidden', !isCustom);\r\n    if (isCustom) {\r\n      customInput.focus();\r\n    }\r\n  });\r\n}\r\n\r\n/**\r\n * Render projects list\r\n */\r\nfunction renderProjectsList(container: HTMLElement): void {\r\n  const listContainer = container.querySelector('#projects-list') as HTMLElement;\r\n  if (!listContainer) return;\r\n\r\n  if (allProjects.length === 0) {\r\n    listContainer.innerHTML = '<p class=\"contact-no-projects-hint\">No projects available</p>';\r\n    return;\r\n  }\r\n\r\n  const associatedIds = new Set(contactProjects.map(p => p.id));\r\n\r\n  listContainer.innerHTML = allProjects.map(project => `\r\n    <div class=\"project-item\">\r\n      <input type=\"checkbox\" class=\"project-checkbox\" name=\"contact-project\" value=\"${project.id}\" \r\n             ${associatedIds.has(project.id) ? 'checked' : ''}>\r\n      <label>${escapeHtml(project.name)}</label>\r\n      ${contactProjects.find(p => p.id === project.id)?.is_primary ? '<span class=\"primary-badge\">Primary</span>' : ''}\r\n    </div>\r\n  `).join('');\r\n\r\n  container.querySelector('#projects-count')!.textContent = String(associatedIds.size);\r\n}\r\n\r\n/**\r\n * Render relations list\r\n */\r\nfunction renderRelationsList(container: HTMLElement): void {\r\n  const listContainer = container.querySelector('#relations-list') as HTMLElement;\r\n  if (!listContainer) return;\r\n\r\n  if (contactRelations.length === 0) {\r\n    listContainer.innerHTML = `\r\n      <div class=\"activity-empty\">\r\n        <svg fill=\"none\" viewBox=\"0 0 24 24\" stroke=\"currentColor\">\r\n          <path stroke-linecap=\"round\" stroke-linejoin=\"round\" stroke-width=\"1.5\" d=\"M17 20h5v-2a3 3 0 00-5.356-1.857M17 20H7m10 0v-2c0-.656-.126-1.283-.356-1.857M7 20H2v-2a3 3 0 015.356-1.857M7 20v-2c0-.656.126-1.283.356-1.857m0 0a5.002 5.002 0 019.288 0M15 7a3 3 0 11-6 0 3 3 0 016 0z\"/>\r\n        </svg>\r\n        <p>No relationships yet</p>\r\n      </div>\r\n    `;\r\n    return;\r\n  }\r\n\r\n  listContainer.innerHTML = contactRelations.map(relation => {\r\n    const contact = relation.to_contact;\r\n    const initials = contact ? getInitials(contact.name) : '?';\r\n\r\n    return `\r\n      <div class=\"relation-card\" data-id=\"${relation.id}\">\r\n        <div class=\"relation-avatar\">\r\n          ${contact?.avatar_url\r\n        ? `<img src=\"${contact.avatar_url}\" alt=\"\">`\r\n        : initials\r\n      }\r\n        </div>\r\n        <div class=\"relation-info\">\r\n          <h4>${escapeHtml(contact?.name || 'Unknown')}</h4>\r\n          <p>${escapeHtml(contact?.organization || contact?.role || '')}</p>\r\n        </div>\r\n        <span class=\"relation-type\">${formatRelationType(relation.relationship_type)}</span>\r\n      </div>\r\n    `;\r\n  }).join('');\r\n\r\n  container.querySelector('#relations-count')!.textContent = String(contactRelations.length);\r\n}\r\n\r\n/**\r\n * Render activity timeline\r\n */\r\nfunction renderActivityTimeline(container: HTMLElement): void {\r\n  const timeline = container.querySelector('#activity-timeline') as HTMLElement;\r\n  if (!timeline) return;\r\n\r\n  if (contactActivity.length === 0) {\r\n    timeline.innerHTML = `\r\n      <div class=\"activity-empty\">\r\n        <svg fill=\"none\" viewBox=\"0 0 24 24\" stroke=\"currentColor\">\r\n          <path stroke-linecap=\"round\" stroke-linejoin=\"round\" stroke-width=\"1.5\" d=\"M12 8v4l3 3m6-3a9 9 0 11-18 0 9 9 0 0118 0z\"/>\r\n        </svg>\r\n        <p>No activity recorded yet</p>\r\n      </div>\r\n    `;\r\n    return;\r\n  }\r\n\r\n  timeline.innerHTML = contactActivity.map(activity => `\r\n    <div class=\"activity-item ${activity.activity_type}\">\r\n      <div class=\"activity-time\">${formatDate(activity.occurred_at)}</div>\r\n      <div class=\"activity-content\">${escapeHtml(activity.description)}</div>\r\n    </div>\r\n  `).join('');\r\n}\r\n\r\n/**\r\n * Update tab counts\r\n */\r\nfunction updateTabCounts(container: HTMLElement): void {\r\n  const projectsCount = container.querySelector('#projects-count');\r\n  const relationsCount = container.querySelector('#relations-count');\r\n\r\n  if (projectsCount) projectsCount.textContent = String(contactProjects.length);\r\n  if (relationsCount) relationsCount.textContent = String(contactRelations.length);\r\n}\r\n\r\n/**\r\n * Bind events\r\n */\r\nfunction bindEvents(container: HTMLElement, props: ContactModalProps): void {\r\n  const { mode, contact, onSave, onDelete } = props;\r\n  const isEdit = mode === 'edit';\r\n\r\n  // Close button\r\n  const closeBtn = container.querySelector('#close-contact-btn');\r\n  if (closeBtn) {\r\n    on(closeBtn as HTMLElement, 'click', () => closeModal(MODAL_ID));\r\n  }\r\n\r\n  // Cancel button\r\n  const cancelBtn = container.querySelector('#cancel-contact-btn');\r\n  if (cancelBtn) {\r\n    on(cancelBtn as HTMLElement, 'click', () => closeModal(MODAL_ID));\r\n  }\r\n\r\n  // Tab switching\r\n  const tabs = container.querySelectorAll('.contact-tab-btn');\r\n  tabs.forEach(tab => {\r\n    on(tab as HTMLElement, 'click', () => {\r\n      tabs.forEach(t => t.classList.remove('active'));\r\n      tab.classList.add('active');\r\n\r\n      const tabId = tab.getAttribute('data-tab');\r\n      container.querySelectorAll('.contact-section').forEach(section => {\r\n        section.classList.toggle('active', section.id === `section-${tabId}`);\r\n      });\r\n    });\r\n  });\r\n\r\n  // Save button\r\n  const saveBtn = container.querySelector('#save-contact-btn') as HTMLButtonElement;\r\n  if (saveBtn) {\r\n    on(saveBtn, 'click', async () => {\r\n      const form = container.querySelector('#contact-form') as HTMLFormElement;\r\n      if (!form.checkValidity()) {\r\n        form.reportValidity();\r\n        return;\r\n      }\r\n\r\n      const getValue = (id: string) => (container.querySelector(`#${id}`) as HTMLInputElement)?.value.trim() || '';\r\n\r\n      // Get role value\r\n      const roleSelect = container.querySelector('#contact-role') as HTMLSelectElement;\r\n      const customRoleInput = container.querySelector('#contact-role-custom') as HTMLInputElement;\r\n      const role = roleSelect.value === '__custom__' ? customRoleInput.value.trim() : roleSelect.value;\r\n\r\n      const tagsInput = getValue('contact-tags');\r\n      const tags = tagsInput ? tagsInput.split(',').map(t => t.trim()).filter(Boolean) : [];\r\n\r\n      // Get aliases\r\n      const aliasesInput = getValue('contact-aliases');\r\n      const aliases = aliasesInput ? aliasesInput.split(',').map(a => a.trim()).filter(Boolean) : [];\r\n\r\n      const contactData: Contact = {\r\n        id: contact?.id || `contact-${Date.now()}`,\r\n        name: getValue('contact-name'),\r\n        email: getValue('contact-email') || undefined,\r\n        phone: getValue('contact-phone') || undefined,\r\n        organization: getValue('contact-organization') || undefined,\r\n        company: getValue('contact-organization') || undefined,\r\n        role: role || undefined,\r\n        department: getValue('contact-department') || undefined,\r\n        linkedin: getValue('contact-linkedin') || undefined,\r\n        location: getValue('contact-location') || undefined,\r\n        timezone: getValue('contact-timezone') || undefined,\r\n        photoUrl: getValue('contact-avatar-url') || undefined,\r\n        avatarUrl: getValue('contact-avatar-url') || undefined,\r\n        aliases: aliases.length > 0 ? aliases : undefined,\r\n        notes: getValue('contact-notes') || undefined,\r\n        tags: tags.length > 0 ? tags : undefined,\r\n      };\r\n\r\n      // Get selected projects\r\n      const selectedProjects: string[] = [];\r\n      container.querySelectorAll('input[name=\"contact-project\"]:checked').forEach(input => {\r\n        selectedProjects.push((input as HTMLInputElement).value);\r\n      });\r\n\r\n      saveBtn.disabled = true;\r\n      saveBtn.textContent = 'Saving...';\r\n\r\n      try {\r\n        let savedContactId = contact?.id;\r\n\r\n        if (isEdit) {\r\n          await http.put(`/api/contacts/${contact!.id}`, contactData);\r\n          toast.success('Contact updated');\r\n        } else {\r\n          const response = await http.post<{ id: string }>('/api/contacts', contactData);\r\n          contactData.id = response.data.id;\r\n          savedContactId = response.data.id;\r\n          toast.success('Contact created');\r\n        }\r\n\r\n        // Save project associations\r\n        if (savedContactId && selectedProjects.length >= 0) {\r\n          try {\r\n            await http.post(`/api/contacts/${savedContactId}/projects/sync`, {\r\n              projectIds: selectedProjects\r\n            });\r\n          } catch (err) {\r\n            console.warn('Failed to sync project associations:', err);\r\n          }\r\n        }\r\n\r\n        onSave?.(contactData);\r\n        closeModal(MODAL_ID);\r\n      } catch {\r\n        toast.error('Failed to save contact');\r\n      } finally {\r\n        saveBtn.disabled = false;\r\n        saveBtn.innerHTML = `\r\n          <svg fill=\"none\" viewBox=\"0 0 24 24\" stroke=\"currentColor\">\r\n            <path stroke-linecap=\"round\" stroke-linejoin=\"round\" stroke-width=\"2\" d=\"M5 13l4 4L19 7\"/>\r\n          </svg>\r\n          ${isEdit ? 'Save Changes' : 'Create Contact'}\r\n        `;\r\n      }\r\n    });\r\n  }\r\n\r\n  // Delete button\r\n  const deleteBtn = container.querySelector('#delete-contact-btn');\r\n  if (deleteBtn && isEdit) {\r\n    on(deleteBtn as HTMLElement, 'click', async () => {\r\n      const confirmed = await confirm(\r\n        `Are you sure you want to delete \"${contact!.name}\"?`,\r\n        {\r\n          title: 'Delete Contact',\r\n          confirmText: 'Delete',\r\n          confirmClass: 'btn-danger',\r\n        }\r\n      );\r\n\r\n      if (confirmed) {\r\n        try {\r\n          await http.delete(`/api/contacts/${contact!.id}`);\r\n          toast.success('Contact deleted');\r\n          onDelete?.(contact!.id);\r\n          closeModal(MODAL_ID);\r\n        } catch {\r\n          toast.error('Failed to delete contact');\r\n        }\r\n      }\r\n    });\r\n  }\r\n\r\n  // AI Enrich button\r\n  const enrichBtn = container.querySelector('#enrich-ai-btn');\r\n  if (enrichBtn && isEdit) {\r\n    on(enrichBtn as HTMLElement, 'click', async () => {\r\n      toast.info('AI enrichment is processing...');\r\n      try {\r\n        await http.post(`/api/contacts/${contact!.id}/enrich`);\r\n        toast.success('Contact enriched! Refreshing...');\r\n        // Reload modal with updated data\r\n        closeModal(MODAL_ID);\r\n        const response = await http.get<{ contact: Contact }>(`/api/contacts/${contact!.id}`);\r\n        showContactModal({ ...props, contact: response.data.contact });\r\n      } catch {\r\n        toast.error('AI enrichment failed');\r\n      }\r\n    });\r\n  }\r\n\r\n  // Add relation button\r\n  const addRelationBtn = container.querySelector('#add-relation-btn');\r\n  if (addRelationBtn && contact?.id) {\r\n    on(addRelationBtn as HTMLElement, 'click', () => {\r\n      showAddRelationDialog(container, contact.id, props);\r\n    });\r\n  }\r\n\r\n  // Update header on name/org input change\r\n  const nameInput = container.querySelector('#contact-name') as HTMLInputElement;\r\n  const orgInput = container.querySelector('#contact-organization') as HTMLInputElement;\r\n  const headerName = container.querySelector('#header-contact-name');\r\n  const headerOrg = container.querySelector('#header-contact-org');\r\n\r\n  if (nameInput && headerName) {\r\n    on(nameInput, 'input', () => {\r\n      headerName.textContent = nameInput.value || 'New Contact';\r\n      // Update avatar initials\r\n      const avatar = container.querySelector('.contact-avatar-large');\r\n      if (avatar && !avatar.querySelector('img')) {\r\n        const span = avatar.querySelector('span');\r\n        if (span) span.textContent = getInitials(nameInput.value || '?');\r\n      }\r\n    });\r\n  }\r\n\r\n  if (orgInput && headerOrg) {\r\n    on(orgInput, 'input', () => {\r\n      headerOrg.textContent = orgInput.value || 'Add organization';\r\n    });\r\n  }\r\n\r\n  // Update avatar preview on URL input change\r\n  const avatarUrlInput = container.querySelector('#contact-avatar-url') as HTMLInputElement;\r\n  const avatarContainer = container.querySelector('.contact-avatar-large');\r\n\r\n  if (avatarUrlInput && avatarContainer) {\r\n    on(avatarUrlInput, 'input', () => {\r\n      const url = avatarUrlInput.value.trim();\r\n      if (url) {\r\n        // Test if image loads\r\n        const img = new Image();\r\n        img.onload = () => {\r\n          avatarContainer.innerHTML = `\r\n            <img src=\"${url}\" alt=\"\">\r\n            <div class=\"avatar-upload-hint\">\r\n              <svg fill=\"none\" viewBox=\"0 0 24 24\" stroke=\"currentColor\">\r\n                <path stroke-linecap=\"round\" stroke-linejoin=\"round\" stroke-width=\"2\" d=\"M3 9a2 2 0 012-2h.93a2 2 0 001.664-.89l.812-1.22A2 2 0 0110.07 4h3.86a2 2 0 011.664.89l.812 1.22A2 2 0 0018.07 7H19a2 2 0 012 2v9a2 2 0 01-2 2H5a2 2 0 01-2-2V9z\"/>\r\n                <path stroke-linecap=\"round\" stroke-linejoin=\"round\" stroke-width=\"2\" d=\"M15 13a3 3 0 11-6 0 3 3 0 016 0z\"/>\r\n              </svg>\r\n            </div>\r\n          `;\r\n        };\r\n        img.onerror = () => {\r\n          // Keep initials if image fails\r\n          const currentName = (container.querySelector('#contact-name') as HTMLInputElement)?.value || '?';\r\n          avatarContainer.innerHTML = `\r\n            <span>${getInitials(currentName)}</span>\r\n            <div class=\"avatar-upload-hint\">\r\n              <svg fill=\"none\" viewBox=\"0 0 24 24\" stroke=\"currentColor\">\r\n                <path stroke-linecap=\"round\" stroke-linejoin=\"round\" stroke-width=\"2\" d=\"M3 9a2 2 0 012-2h.93a2 2 0 001.664-.89l.812-1.22A2 2 0 0110.07 4h3.86a2 2 0 011.664.89l.812 1.22A2 2 0 0018.07 7H19a2 2 0 012 2v9a2 2 0 01-2 2H5a2 2 0 01-2-2V9z\"/>\r\n                <path stroke-linecap=\"round\" stroke-linejoin=\"round\" stroke-width=\"2\" d=\"M15 13a3 3 0 11-6 0 3 3 0 016 0z\"/>\r\n              </svg>\r\n            </div>\r\n          `;\r\n        };\r\n        img.src = url;\r\n      } else {\r\n        // No URL - show initials\r\n        const currentName = (container.querySelector('#contact-name') as HTMLInputElement)?.value || '?';\r\n        avatarContainer.innerHTML = `\r\n          <span>${getInitials(currentName)}</span>\r\n          <div class=\"avatar-upload-hint\">\r\n            <svg fill=\"none\" viewBox=\"0 0 24 24\" stroke=\"currentColor\">\r\n              <path stroke-linecap=\"round\" stroke-linejoin=\"round\" stroke-width=\"2\" d=\"M3 9a2 2 0 012-2h.93a2 2 0 001.664-.89l.812-1.22A2 2 0 0110.07 4h3.86a2 2 0 011.664.89l.812 1.22A2 2 0 0018.07 7H19a2 2 0 012 2v9a2 2 0 01-2 2H5a2 2 0 01-2-2V9z\"/>\r\n              <path stroke-linecap=\"round\" stroke-linejoin=\"round\" stroke-width=\"2\" d=\"M15 13a3 3 0 11-6 0 3 3 0 016 0z\"/>\r\n            </svg>\r\n          </div>\r\n        `;\r\n      }\r\n    });\r\n  }\r\n}\r\n\r\n/**\r\n * Show dialog to add a relationship to another contact\r\n */\r\nasync function showAddRelationDialog(parentContainer: HTMLElement, contactId: string, props: ContactModalProps): Promise<void> {\r\n  // Fetch all contacts for selection\r\n  let availableContacts: { id: string; name: string; organization?: string }[] = [];\r\n  try {\r\n    const response = await http.get<{ contacts: { id: string; name: string; organization?: string }[] }>('/api/contacts');\r\n    availableContacts = (response.data?.contacts || []).filter(c => c.id !== contactId);\r\n  } catch {\r\n    toast.error('Failed to load contacts');\r\n    return;\r\n  }\r\n\r\n  if (availableContacts.length === 0) {\r\n    toast.info('No other contacts available to create a relationship');\r\n    return;\r\n  }\r\n\r\n  // Create overlay dialog\r\n  const overlay = createElement('div', { className: 'relation-dialog-overlay' });\r\n  overlay.innerHTML = `\r\n    <style>\r\n      .relation-dialog-overlay {\r\n        position: fixed;\r\n        inset: 0;\r\n        background: rgba(0,0,0,0.5);\r\n        display: flex;\r\n        align-items: center;\r\n        justify-content: center;\r\n        z-index: 10000;\r\n        animation: fadeIn 0.2s ease;\r\n      }\r\n      \r\n      @keyframes fadeIn {\r\n        from { opacity: 0; }\r\n        to { opacity: 1; }\r\n      }\r\n      \r\n      .relation-dialog {\r\n        background: var(--bg-primary);\r\n        border-radius: 16px;\r\n        padding: 24px;\r\n        width: 400px;\r\n        max-width: 90vw;\r\n        box-shadow: 0 25px 50px rgba(0,0,0,0.25);\r\n        animation: slideUp 0.2s ease;\r\n      }\r\n      \r\n      @keyframes slideUp {\r\n        from { transform: translateY(20px); opacity: 0; }\r\n        to { transform: translateY(0); opacity: 1; }\r\n      }\r\n      \r\n      .relation-dialog h3 {\r\n        margin: 0 0 20px 0;\r\n        font-size: 18px;\r\n        font-weight: 600;\r\n        color: var(--text-primary);\r\n        display: flex;\r\n        align-items: center;\r\n        gap: 10px;\r\n      }\r\n      \r\n      .relation-dialog h3 svg {\r\n        width: 22px;\r\n        height: 22px;\r\n        color: #e11d48;\r\n      }\r\n      \r\n      .relation-dialog-field {\r\n        margin-bottom: 16px;\r\n      }\r\n      \r\n      .relation-dialog-field label {\r\n        display: block;\r\n        font-size: 13px;\r\n        font-weight: 600;\r\n        color: var(--text-secondary);\r\n        margin-bottom: 6px;\r\n      }\r\n      \r\n      .relation-dialog-field select {\r\n        width: 100%;\r\n        padding: 12px;\r\n        border: 1px solid var(--border-color);\r\n        border-radius: 10px;\r\n        background: var(--bg-secondary);\r\n        color: var(--text-primary);\r\n        font-size: 14px;\r\n      }\r\n      \r\n      .relation-dialog-field select:focus {\r\n        outline: none;\r\n        border-color: #e11d48;\r\n      }\r\n      \r\n      .relation-dialog-actions {\r\n        display: flex;\r\n        justify-content: flex-end;\r\n        gap: 10px;\r\n        margin-top: 24px;\r\n      }\r\n      \r\n      .relation-dialog-actions button {\r\n        padding: 10px 20px;\r\n        border-radius: 8px;\r\n        font-size: 14px;\r\n        font-weight: 600;\r\n        cursor: pointer;\r\n        transition: all 0.2s;\r\n      }\r\n      \r\n      .relation-dialog-actions .cancel-btn {\r\n        background: var(--bg-secondary);\r\n        border: 1px solid var(--border-color);\r\n        color: var(--text-primary);\r\n      }\r\n      \r\n      .relation-dialog-actions .cancel-btn:hover {\r\n        background: var(--bg-tertiary);\r\n      }\r\n      \r\n      .relation-dialog-actions .save-btn {\r\n        background: linear-gradient(135deg, #e11d48, #be123c);\r\n        border: none;\r\n        color: white;\r\n      }\r\n      \r\n      .relation-dialog-actions .save-btn:hover {\r\n        transform: translateY(-1px);\r\n        box-shadow: 0 4px 12px rgba(225,29,72,0.3);\r\n      }\r\n      \r\n      .relation-dialog-actions .save-btn:disabled {\r\n        opacity: 0.6;\r\n        cursor: not-allowed;\r\n        transform: none;\r\n      }\r\n    </style>\r\n    \r\n    <div class=\"relation-dialog\">\r\n      <h3>\r\n        <svg fill=\"none\" viewBox=\"0 0 24 24\" stroke=\"currentColor\">\r\n          <path stroke-linecap=\"round\" stroke-linejoin=\"round\" stroke-width=\"2\" d=\"M17 20h5v-2a3 3 0 00-5.356-1.857M17 20H7m10 0v-2c0-.656-.126-1.283-.356-1.857M7 20H2v-2a3 3 0 015.356-1.857M7 20v-2c0-.656.126-1.283.356-1.857m0 0a5.002 5.002 0 019.288 0M15 7a3 3 0 11-6 0 3 3 0 016 0z\"/>\r\n        </svg>\r\n        Add Relationship\r\n      </h3>\r\n      \r\n      <div class=\"relation-dialog-field\">\r\n        <label>Related Contact</label>\r\n        <select id=\"rel-contact-select\">\r\n          <option value=\"\">-- Select contact --</option>\r\n          ${availableContacts.map(c => `\r\n            <option value=\"${c.id}\">${escapeHtml(c.name)}${c.organization ? ` (${escapeHtml(c.organization)})` : ''}</option>\r\n          `).join('')}\r\n        </select>\r\n      </div>\r\n      \r\n      <div class=\"relation-dialog-field\">\r\n        <label>Relationship Type</label>\r\n        <select id=\"rel-type-select\">\r\n          <option value=\"\">-- Select type --</option>\r\n          <option value=\"reports_to\">Reports to</option>\r\n          <option value=\"manages\">Manages</option>\r\n          <option value=\"works_with\">Works with</option>\r\n          <option value=\"knows\">Knows</option>\r\n          <option value=\"referred_by\">Referred by</option>\r\n        </select>\r\n      </div>\r\n      \r\n      <div class=\"relation-dialog-actions\">\r\n        <button class=\"cancel-btn\" id=\"rel-cancel-btn\">Cancel</button>\r\n        <button class=\"save-btn\" id=\"rel-save-btn\">Add Relationship</button>\r\n      </div>\r\n    </div>\r\n  `;\r\n\r\n  document.body.appendChild(overlay);\r\n\r\n  // Bind events\r\n  const cancelBtn = overlay.querySelector('#rel-cancel-btn');\r\n  const saveBtn = overlay.querySelector('#rel-save-btn') as HTMLButtonElement;\r\n  const contactSelect = overlay.querySelector('#rel-contact-select') as HTMLSelectElement;\r\n  const typeSelect = overlay.querySelector('#rel-type-select') as HTMLSelectElement;\r\n\r\n  // Close on cancel or overlay click\r\n  const closeDialog = () => overlay.remove();\r\n\r\n  on(cancelBtn as HTMLElement, 'click', closeDialog);\r\n  on(overlay, 'click', (e: Event) => {\r\n    if (e.target === overlay) closeDialog();\r\n  });\r\n\r\n  // Save relationship\r\n  on(saveBtn, 'click', async () => {\r\n    const toContactId = contactSelect.value;\r\n    const relationType = typeSelect.value;\r\n\r\n    if (!toContactId || !relationType) {\r\n      toast.error('Please select both a contact and relationship type');\r\n      return;\r\n    }\r\n\r\n    saveBtn.disabled = true;\r\n    saveBtn.textContent = 'Saving...';\r\n\r\n    try {\r\n      await http.post(`/api/contacts/${contactId}/relationships`, {\r\n        toContactId,\r\n        type: relationType\r\n      });\r\n\r\n      toast.success('Relationship added');\r\n      closeDialog();\r\n\r\n      // Reload contact data to show new relationship\r\n      const relationsRes = await http.get<{ relationships: ContactRelation[] }>(`/api/contacts/${contactId}/relationships`);\r\n      contactRelations = relationsRes.data?.relationships || [];\r\n      renderRelationsList(parentContainer);\r\n      updateTabCounts(parentContainer);\r\n    } catch (error: unknown) {\r\n      const message = error instanceof Error ? error.message : 'Failed to add relationship';\r\n      toast.error(message);\r\n      saveBtn.disabled = false;\r\n      saveBtn.textContent = 'Add Relationship';\r\n    }\r\n  });\r\n}\r\n\r\n// Helpers\r\nfunction getInitials(name: string): string {\r\n  return name\r\n    .split(' ')\r\n    .map(n => n[0])\r\n    .join('')\r\n    .toUpperCase()\r\n    .slice(0, 2) || '?';\r\n}\r\n\r\nfunction escapeHtml(text: string): string {\r\n  const div = document.createElement('div');\r\n  div.textContent = text;\r\n  return div.innerHTML;\r\n}\r\n\r\nfunction formatRelationType(type: string): string {\r\n  const types: Record<string, string> = {\r\n    reports_to: 'Reports to',\r\n    manages: 'Manages',\r\n    works_with: 'Works with',\r\n    knows: 'Knows',\r\n    referred_by: 'Referred by',\r\n  };\r\n  return types[type] || type.replace(/_/g, ' ');\r\n}\r\n\r\nfunction formatDate(dateStr: string): string {\r\n  const date = new Date(dateStr);\r\n  const now = new Date();\r\n  const diffMs = now.getTime() - date.getTime();\r\n  const diffDays = Math.floor(diffMs / (1000 * 60 * 60 * 24));\r\n\r\n  if (diffDays === 0) return 'Today';\r\n  if (diffDays === 1) return 'Yesterday';\r\n  if (diffDays < 7) return `${diffDays} days ago`;\r\n\r\n  return date.toLocaleDateString('en-US', { month: 'short', day: 'numeric', year: 'numeric' });\r\n}\r\n\r\nexport default showContactModal;\r\n","/**\r\n * Team Modal Component\r\n * Manage project team members\r\n */\r\n\r\nimport { createElement, on } from '@lib/dom';\r\nimport { createModal, openModal, closeModal } from '@components/Modal';\r\nimport { http } from '@services/api';\r\nimport { toast } from '@services/toast';\r\n\r\nconst MODAL_ID = 'team-modal';\r\n\r\nexport interface TeamMember {\r\n  id: string;\r\n  name: string;\r\n  email: string;\r\n  role: 'superadmin' | 'admin' | 'member';\r\n  joinedAt: string;\r\n  avatarUrl?: string;\r\n}\r\n\r\nexport interface TeamModalProps {\r\n  projectId?: string;\r\n  mode?: 'view' | 'edit' | 'manage' | 'create';\r\n  team?: { id: string; name: string };\r\n  onInvite?: () => void;\r\n  onSave?: (team: { name: string; description?: string }) => void;\r\n  onRemove?: (memberId: string) => void;\r\n  onRoleChange?: (memberId: string, role: TeamMember['role']) => void;\r\n}\r\n\r\nlet currentMembers: TeamMember[] = [];\r\n\r\n/**\r\n * Show team modal\r\n */\r\nexport async function showTeamModal(props: TeamModalProps): Promise<void> {\r\n  const { projectId, onInvite, onRemove, onRoleChange } = props;\r\n\r\n  // Remove existing modal\r\n  const existing = document.querySelector(`[data-modal-id=\"${MODAL_ID}\"]`);\r\n  if (existing) existing.remove();\r\n\r\n  const content = createElement('div', { className: 'team-modal-content' });\r\n  content.innerHTML = '<div class=\"loading\">Loading team members...</div>';\r\n\r\n  // Footer\r\n  const footer = createElement('div', { className: 'modal-footer' });\r\n\r\n  const inviteBtn = createElement('button', {\r\n    className: 'btn btn-primary',\r\n    textContent: 'Invite Member',\r\n  });\r\n\r\n  const closeBtn = createElement('button', {\r\n    className: 'btn btn-secondary',\r\n    textContent: 'Close',\r\n  });\r\n\r\n  on(closeBtn, 'click', () => closeModal(MODAL_ID));\r\n  on(inviteBtn, 'click', () => {\r\n    closeModal(MODAL_ID);\r\n    onInvite?.();\r\n  });\r\n\r\n  footer.appendChild(closeBtn);\r\n  footer.appendChild(inviteBtn);\r\n\r\n  // Create modal\r\n  const modal = createModal({\r\n    id: MODAL_ID,\r\n    title: 'Team Members',\r\n    content,\r\n    size: 'lg',\r\n    footer,\r\n  });\r\n\r\n  document.body.appendChild(modal);\r\n  openModal(MODAL_ID);\r\n\r\n  // Load team members\r\n  try {\r\n    const response = await http.get<TeamMember[]>(`/api/projects/${projectId}/members`);\r\n    currentMembers = response.data;\r\n    renderMembers(content, props);\r\n  } catch {\r\n    content.innerHTML = '<div class=\"error\">Failed to load team members</div>';\r\n  }\r\n}\r\n\r\n/**\r\n * Render team members list\r\n */\r\nfunction renderMembers(container: HTMLElement, props: TeamModalProps): void {\r\n  if (currentMembers.length === 0) {\r\n    container.innerHTML = `\r\n      <div class=\"empty-state\">\r\n        <p>No team members yet</p>\r\n        <p class=\"text-muted\">Invite members to collaborate on this project</p>\r\n      </div>\r\n    `;\r\n    return;\r\n  }\r\n\r\n  container.innerHTML = `\r\n    <div class=\"team-list\">\r\n      ${currentMembers.map(member => renderMemberCard(member)).join('')}\r\n    </div>\r\n  `;\r\n\r\n  // Bind actions\r\n  container.querySelectorAll('.member-card').forEach(card => {\r\n    const memberId = card.getAttribute('data-member-id');\r\n    if (!memberId) return;\r\n\r\n    const member = currentMembers.find(m => m.id === memberId);\r\n    if (!member) return;\r\n\r\n    // Role change\r\n    const roleSelect = card.querySelector('.role-select') as HTMLSelectElement;\r\n    if (roleSelect) {\r\n      on(roleSelect, 'change', async () => {\r\n        const newRole = roleSelect.value as TeamMember['role'];\r\n        try {\r\n          await http.patch(`/api/projects/${props.projectId}/members/${memberId}`, { role: newRole });\r\n          member.role = newRole;\r\n          toast.success('Role updated');\r\n          props.onRoleChange?.(memberId, newRole);\r\n        } catch {\r\n          roleSelect.value = member.role;\r\n        }\r\n      });\r\n    }\r\n\r\n    // Remove member\r\n    const removeBtn = card.querySelector('.btn-remove');\r\n    if (removeBtn) {\r\n      on(removeBtn as HTMLElement, 'click', async () => {\r\n        const { confirm } = await import('@components/Modal');\r\n        const confirmed = await confirm(\r\n          `Remove ${member.name} from this project?`,\r\n          {\r\n            title: 'Remove Member',\r\n            confirmText: 'Remove',\r\n            confirmClass: 'btn-danger',\r\n          }\r\n        );\r\n\r\n        if (confirmed) {\r\n          try {\r\n            await http.delete(`/api/projects/${props.projectId}/members/${memberId}`);\r\n            currentMembers = currentMembers.filter(m => m.id !== memberId);\r\n            renderMembers(container, props);\r\n            toast.success('Member removed');\r\n            props.onRemove?.(memberId);\r\n          } catch {\r\n            // Error shown by API service\r\n          }\r\n        }\r\n      });\r\n    }\r\n  });\r\n}\r\n\r\n/**\r\n * Render individual member card\r\n */\r\nfunction renderMemberCard(member: TeamMember): string {\r\n  const initials = member.name\r\n    .split(' ')\r\n    .map(n => n[0])\r\n    .join('')\r\n    .toUpperCase()\r\n    .slice(0, 2);\r\n\r\n  const isSuperadmin = member.role === 'superadmin';\r\n\r\n  return `\r\n    <div class=\"member-card\" data-member-id=\"${member.id}\">\r\n      <div class=\"member-avatar\">\r\n        ${member.avatarUrl\r\n      ? `<img src=\"${member.avatarUrl}\" alt=\"${escapeHtml(member.name)}\">`\r\n      : initials\r\n    }\r\n      </div>\r\n      <div class=\"member-info\">\r\n        <div class=\"member-name\">${escapeHtml(member.name)}</div>\r\n        <div class=\"member-email\">${escapeHtml(member.email)}</div>\r\n      </div>\r\n      <div class=\"member-role\">\r\n        ${isSuperadmin\r\n      ? `<span class=\"role-badge superadmin\">Owner</span>`\r\n      : `<select class=\"role-select form-control\">\r\n              <option value=\"admin\" ${member.role === 'admin' ? 'selected' : ''}>Admin</option>\r\n              <option value=\"member\" ${member.role === 'member' ? 'selected' : ''}>Member</option>\r\n            </select>`\r\n    }\r\n      </div>\r\n      <div class=\"member-actions\">\r\n        ${!isSuperadmin\r\n      ? `<button class=\"btn btn-sm btn-danger btn-remove\" title=\"Remove member\"></button>`\r\n      : ''\r\n    }\r\n      </div>\r\n    </div>\r\n  `;\r\n}\r\n\r\n/**\r\n * Escape HTML\r\n */\r\nfunction escapeHtml(text: string): string {\r\n  const div = document.createElement('div');\r\n  div.textContent = text;\r\n  return div.innerHTML;\r\n}\r\n\r\nexport default showTeamModal;\r\n","/**\n * Invite Modal Component\n * Invite new team members\n */\n\nimport { createElement, on } from '@lib/dom';\nimport { createModal, openModal, closeModal } from '@components/Modal';\nimport { http } from '@services/api';\nimport { toast } from '@services/toast';\n\nconst MODAL_ID = 'invite-modal';\n\ninterface Contact {\n  id: string;\n  name: string;\n  email?: string;\n  avatar_url?: string;\n  photo_url?: string;\n  organization?: string;\n  role?: string;\n}\n\ninterface ProjectMember {\n  user_id: string;\n  linked_contact_id?: string;\n}\n\nexport interface InviteModalProps {\n  projectId: string;\n  onInvite?: () => void;\n  onInviteSent?: (email: string) => void;\n}\n\n// Cache for loaded data\nlet cachedMembers: ProjectMember[] = [];\n\n/**\n * Show invite modal\n */\nexport function showInviteModal(props: InviteModalProps): void {\n  const { projectId, onInviteSent } = props;\n\n  // Remove existing modal\n  const existing = document.querySelector(`[data-modal-id=\"${MODAL_ID}\"]`);\n  if (existing) existing.remove();\n\n  const content = createElement('div', { className: 'invite-modal-content' });\n\n  content.innerHTML = `\n    <style>\n      .invite-tabs {\n        display: flex;\n        gap: 0;\n        margin-bottom: 20px;\n        border-bottom: 1px solid var(--border-color, #e2e8f0);\n      }\n      \n      .invite-tab-btn {\n        flex: 1;\n        padding: 12px 16px;\n        background: transparent;\n        border: none;\n        font-size: 14px;\n        font-weight: 500;\n        color: var(--text-secondary, #64748b);\n        cursor: pointer;\n        position: relative;\n        transition: all 0.2s;\n      }\n      \n      .invite-tab-btn:hover {\n        color: var(--text-primary, #1e293b);\n      }\n      \n      .invite-tab-btn.active {\n        color: #e11d48;\n      }\n      \n      .invite-tab-btn.active::after {\n        content: '';\n        position: absolute;\n        bottom: -1px;\n        left: 0;\n        right: 0;\n        height: 2px;\n        background: #e11d48;\n      }\n      \n      .invite-tab-content {\n        display: none;\n      }\n      \n      .invite-tab-content.active {\n        display: block;\n      }\n      \n      .contacts-list {\n        max-height: 300px;\n        overflow-y: auto;\n        border: 1px solid var(--border-color, #e2e8f0);\n        border-radius: 8px;\n        margin-bottom: 16px;\n      }\n      \n      .contact-option {\n        display: flex;\n        align-items: center;\n        gap: 12px;\n        padding: 12px 16px;\n        cursor: pointer;\n        transition: background 0.2s;\n        border-bottom: 1px solid var(--border-color, #e2e8f0);\n      }\n      \n      .contact-option:last-child {\n        border-bottom: none;\n      }\n      \n      .contact-option:hover {\n        background: var(--bg-secondary, #f8fafc);\n      }\n      \n      .contact-option.selected {\n        background: linear-gradient(135deg, rgba(225,29,72,0.08) 0%, rgba(225,29,72,0.04) 100%);\n      }\n      \n      .contact-option input[type=\"radio\"] {\n        display: none;\n      }\n      \n      .contact-option .radio-circle {\n        width: 18px;\n        height: 18px;\n        border: 2px solid var(--border-color, #cbd5e1);\n        border-radius: 50%;\n        flex-shrink: 0;\n        position: relative;\n        transition: all 0.2s;\n      }\n      \n      .contact-option.selected .radio-circle {\n        border-color: #e11d48;\n      }\n      \n      .contact-option.selected .radio-circle::after {\n        content: '';\n        position: absolute;\n        top: 3px;\n        left: 3px;\n        width: 8px;\n        height: 8px;\n        background: #e11d48;\n        border-radius: 50%;\n      }\n      \n      .contact-avatar {\n        width: 36px;\n        height: 36px;\n        border-radius: 50%;\n        background: linear-gradient(135deg, #667eea, #764ba2);\n        display: flex;\n        align-items: center;\n        justify-content: center;\n        color: white;\n        font-size: 14px;\n        font-weight: 600;\n        flex-shrink: 0;\n        overflow: hidden;\n      }\n      \n      .contact-avatar img {\n        width: 100%;\n        height: 100%;\n        object-fit: cover;\n      }\n      \n      .contact-info {\n        flex: 1;\n        min-width: 0;\n      }\n      \n      .contact-name {\n        font-weight: 500;\n        color: var(--text-primary, #1e293b);\n        margin-bottom: 2px;\n      }\n      \n      .contact-email {\n        font-size: 12px;\n        color: var(--text-secondary, #64748b);\n        white-space: nowrap;\n        overflow: hidden;\n        text-overflow: ellipsis;\n      }\n      \n      .no-contacts-msg {\n        padding: 24px;\n        text-align: center;\n        color: var(--text-secondary, #64748b);\n      }\n      \n      .email-status {\n        margin-top: 8px;\n        padding: 8px 12px;\n        background: #f0fdf4;\n        border: 1px solid #bbf7d0;\n        border-radius: 8px;\n        font-size: 12px;\n        color: #166534;\n        display: none;\n      }\n      \n      .email-status.show {\n        display: block;\n      }\n      \n      .email-status.error {\n        background: #fef2f2;\n        border-color: #fecaca;\n        color: #991b1b;\n      }\n    </style>\n    \n    <!-- Tabs -->\n    <div class=\"invite-tabs\">\n      <button type=\"button\" class=\"invite-tab-btn active\" data-tab=\"new\">\n        New Email\n      </button>\n      <button type=\"button\" class=\"invite-tab-btn\" data-tab=\"contacts\">\n        Existing Contacts\n      </button>\n    </div>\n    \n    <!-- Tab: New Email -->\n    <div class=\"invite-tab-content active\" id=\"tab-new\">\n      <form id=\"invite-form\" class=\"invite-form\">\n        <div class=\"form-group\">\n          <label for=\"invite-email\">Email Address *</label>\n          <input type=\"email\" id=\"invite-email\" required \n                 placeholder=\"colleague@example.com\">\n          <div class=\"form-hint\">They will receive an email invitation to join this project</div>\n        </div>\n        \n        <div class=\"form-group\">\n          <label for=\"invite-role\">Access Level</label>\n          <select id=\"invite-role\">\n            <option value=\"read\">Viewer - Can view data only</option>\n            <option value=\"write\" selected>Member - Can view and edit data</option>\n            <option value=\"admin\">Admin - Can manage team and settings</option>\n          </select>\n          <div class=\"form-hint invite-form-hint\">You can assign a project role after they join.</div>\n        </div>\n        \n        <div class=\"form-group\">\n          <label for=\"invite-message\">Personal Message (optional)</label>\n          <textarea id=\"invite-message\" rows=\"2\" \n                    placeholder=\"Add a personal note to the invitation...\"></textarea>\n        </div>\n        \n        <div class=\"email-status\" id=\"email-status\"></div>\n      </form>\n    </div>\n    \n    <!-- Tab: Existing Contacts -->\n    <div class=\"invite-tab-content\" id=\"tab-contacts\">\n      <div id=\"contacts-list\" class=\"contacts-list\">\n        <div class=\"no-contacts-msg\">Loading contacts...</div>\n      </div>\n      \n      <div class=\"form-group\">\n        <label for=\"invite-role-contact\">Access Level</label>\n        <select id=\"invite-role-contact\">\n          <option value=\"read\">Viewer - Can view data only</option>\n          <option value=\"write\" selected>Member - Can view and edit data</option>\n          <option value=\"admin\">Admin - Can manage team and settings</option>\n        </select>\n      </div>\n      \n      <div class=\"add-options\">\n        <button type=\"button\" id=\"btn-add-direct\" class=\"btn btn-primary invite-btn-flex\">\n          <svg width=\"16\" height=\"16\" viewBox=\"0 0 24 24\" fill=\"none\" stroke=\"currentColor\" stroke-width=\"2\" class=\"invite-btn-icon\">\n            <path d=\"M16 21v-2a4 4 0 0 0-4-4H5a4 4 0 0 0-4 4v2\"/>\n            <circle cx=\"8.5\" cy=\"7\" r=\"4\"/>\n            <line x1=\"20\" y1=\"8\" x2=\"20\" y2=\"14\"/>\n            <line x1=\"23\" y1=\"11\" x2=\"17\" y2=\"11\"/>\n          </svg>\n          Add to Team\n        </button>\n        <button type=\"button\" id=\"btn-send-invite\" class=\"btn btn-secondary invite-btn-flex\">\n          <svg width=\"16\" height=\"16\" viewBox=\"0 0 24 24\" fill=\"none\" stroke=\"currentColor\" stroke-width=\"2\" class=\"invite-btn-icon\">\n            <path d=\"M4 4h16c1.1 0 2 .9 2 2v12c0 1.1-.9 2-2 2H4c-1.1 0-2-.9-2-2V6c0-1.1.9-2 2-2z\"/>\n            <polyline points=\"22,6 12,13 2,6\"/>\n          </svg>\n          Send Invitation\n        </button>\n      </div>\n      <div class=\"form-hint invite-form-hint-sm\">\n        <strong>Add to Team:</strong> Adds contact as team member directly (no email sent)<br>\n        <strong>Send Invitation:</strong> Sends an email invitation to join\n      </div>\n      \n      <div class=\"email-status\" id=\"email-status-contact\"></div>\n    </div>\n    \n    <div class=\"invite-link-section\">\n      <h4 class=\"invite-link-title\">Or share invite link</h4>\n      <div class=\"input-group invite-input-group\">\n        <input type=\"text\" id=\"invite-link\" readonly \n               value=\"Generating link...\" class=\"form-control invite-link-input\">\n        <button type=\"button\" id=\"btn-copy-link\" class=\"btn btn-secondary\">Copy</button>\n      </div>\n    </div>\n  `;\n\n  // State\n  let activeTab = 'new';\n  let selectedContact: Contact | null = null;\n\n  // Footer\n  const footer = createElement('div', { className: 'modal-footer' });\n\n  const cancelBtn = createElement('button', {\n    className: 'btn btn-secondary',\n    textContent: 'Cancel',\n  });\n\n  const sendBtn = createElement('button', {\n    className: 'btn btn-primary',\n    textContent: 'Send Invitation',\n  });\n\n  on(cancelBtn, 'click', () => closeModal(MODAL_ID));\n\n  // Handler for sending email invitation (New Email tab)\n  on(sendBtn, 'click', async () => {\n    if (activeTab !== 'new') return; // Only for new email tab\n\n    const form = content.querySelector('#invite-form') as HTMLFormElement;\n    if (!form.checkValidity()) {\n      form.reportValidity();\n      return;\n    }\n    const email = (content.querySelector('#invite-email') as HTMLInputElement).value.trim();\n    const role = (content.querySelector('#invite-role') as HTMLSelectElement).value;\n    const message = (content.querySelector('#invite-message') as HTMLTextAreaElement).value.trim();\n\n    sendBtn.disabled = true;\n    sendBtn.textContent = 'Sending...';\n\n    const statusEl = content.querySelector('#email-status') as HTMLElement;\n\n    try {\n      const response = await http.post<{ success: boolean; email_sent: boolean }>(`/api/projects/${projectId}/invites`, {\n        email,\n        role,\n        message: message || undefined,\n      });\n\n      if (response.data.email_sent) {\n        statusEl.textContent = ` Invitation email sent to ${email}`;\n        statusEl.classList.remove('error');\n        statusEl.classList.add('show');\n      } else {\n        statusEl.textContent = `Invitation created, but email could not be sent. Share the link manually.`;\n        statusEl.classList.add('error', 'show');\n      }\n\n      toast.success(`Invitation sent to ${email}`);\n      onInviteSent?.(email);\n      setTimeout(() => closeModal(MODAL_ID), 1500);\n    } catch {\n      statusEl.textContent = 'Failed to create invitation';\n      statusEl.classList.add('error', 'show');\n    } finally {\n      sendBtn.disabled = false;\n      sendBtn.textContent = 'Send Invitation';\n    }\n  });\n\n  footer.appendChild(cancelBtn);\n  footer.appendChild(sendBtn);\n\n  // Bind contacts tab buttons after modal is created\n  setTimeout(() => {\n    const btnAddDirect = content.querySelector('#btn-add-direct') as HTMLButtonElement;\n    const btnSendInvite = content.querySelector('#btn-send-invite') as HTMLButtonElement;\n    const statusEl = content.querySelector('#email-status-contact') as HTMLElement;\n\n    // Add directly without email\n    if (btnAddDirect) {\n      on(btnAddDirect, 'click', async () => {\n        if (!selectedContact) {\n          toast.error('Please select a contact');\n          return;\n        }\n\n        const role = (content.querySelector('#invite-role-contact') as HTMLSelectElement).value;\n\n        btnAddDirect.disabled = true;\n        btnAddDirect.innerHTML = '<span class=\"spinner\"></span> Adding...';\n\n        try {\n          // Add contact as team member directly (without email)\n          await http.post(`/api/projects/${projectId}/members/add-contact`, {\n            contact_id: selectedContact.id,\n            role,\n          });\n\n          statusEl.textContent = ` ${selectedContact.name} added to team`;\n          statusEl.classList.remove('error');\n          statusEl.classList.add('show');\n\n          toast.success(`${selectedContact.name} added to team`);\n          onInviteSent?.(selectedContact.email || selectedContact.name);\n          setTimeout(() => closeModal(MODAL_ID), 1000);\n        } catch (error: any) {\n          const msg = error?.response?.data?.error || 'Failed to add member';\n          statusEl.textContent = msg;\n          statusEl.classList.add('error', 'show');\n          toast.error(msg);\n        } finally {\n          btnAddDirect.disabled = false;\n          btnAddDirect.innerHTML = `\n            <svg width=\"16\" height=\"16\" viewBox=\"0 0 24 24\" fill=\"none\" stroke=\"currentColor\" stroke-width=\"2\" class=\"invite-btn-icon\">\n              <path d=\"M16 21v-2a4 4 0 0 0-4-4H5a4 4 0 0 0-4 4v2\"/>\n              <circle cx=\"8.5\" cy=\"7\" r=\"4\"/>\n              <line x1=\"20\" y1=\"8\" x2=\"20\" y2=\"14\"/>\n              <line x1=\"23\" y1=\"11\" x2=\"17\" y2=\"11\"/>\n            </svg>\n            Add to Team\n          `;\n        }\n      });\n    }\n\n    // Send invitation email\n    if (btnSendInvite) {\n      on(btnSendInvite, 'click', async () => {\n        if (!selectedContact || !selectedContact.email) {\n          toast.error('Please select a contact with an email address');\n          return;\n        }\n\n        const role = (content.querySelector('#invite-role-contact') as HTMLSelectElement).value;\n\n        btnSendInvite.disabled = true;\n        btnSendInvite.innerHTML = '<span class=\"spinner\"></span> Sending...';\n\n        try {\n          const response = await http.post<{ success: boolean; email_sent: boolean }>(`/api/projects/${projectId}/invites`, {\n            email: selectedContact.email,\n            role,\n          });\n\n          if (response.data.email_sent) {\n            statusEl.textContent = ` Invitation email sent to ${selectedContact.email}`;\n            statusEl.classList.remove('error');\n            statusEl.classList.add('show');\n          } else {\n            statusEl.textContent = `Invitation created, but email could not be sent.`;\n            statusEl.classList.add('error', 'show');\n          }\n\n          toast.success(`Invitation sent to ${selectedContact.name}`);\n          onInviteSent?.(selectedContact.email);\n          setTimeout(() => closeModal(MODAL_ID), 1500);\n        } catch {\n          statusEl.textContent = 'Failed to send invitation';\n          statusEl.classList.add('error', 'show');\n        } finally {\n          btnSendInvite.disabled = false;\n          btnSendInvite.innerHTML = `\n            <svg width=\"16\" height=\"16\" viewBox=\"0 0 24 24\" fill=\"none\" stroke=\"currentColor\" stroke-width=\"2\" class=\"invite-btn-icon\">\n              <path d=\"M4 4h16c1.1 0 2 .9 2 2v12c0 1.1-.9 2-2 2H4c-1.1 0-2-.9-2-2V6c0-1.1.9-2 2-2z\"/>\n              <polyline points=\"22,6 12,13 2,6\"/>\n            </svg>\n            Send Invitation\n          `;\n        }\n      });\n    }\n  }, 0);\n\n  // Create modal\n  const modal = createModal({\n    id: MODAL_ID,\n    title: 'Invite Team Member',\n    content,\n    size: 'md',\n    footer,\n  });\n\n  document.body.appendChild(modal);\n  openModal(MODAL_ID);\n\n  // Generate invite link\n  generateInviteLink(content, projectId);\n\n  // Tab switching\n  const tabBtns = content.querySelectorAll('.invite-tab-btn');\n  tabBtns.forEach(btn => {\n    on(btn as HTMLElement, 'click', () => {\n      const tabId = btn.getAttribute('data-tab') || 'new';\n      activeTab = tabId;\n\n      tabBtns.forEach(b => b.classList.remove('active'));\n      btn.classList.add('active');\n\n      content.querySelectorAll('.invite-tab-content').forEach(tab => {\n        tab.classList.toggle('active', tab.id === `tab-${tabId}`);\n      });\n    });\n  });\n\n  // Load contacts for the contacts tab (pass projectId to filter already-linked contacts)\n  loadContacts(content, projectId, (contact) => {\n    selectedContact = contact;\n  });\n\n  // Bind copy button\n  setTimeout(() => {\n    const copyBtn = content.querySelector('#btn-copy-link');\n    if (copyBtn) {\n      on(copyBtn as HTMLElement, 'click', () => {\n        const linkInput = content.querySelector('#invite-link') as HTMLInputElement;\n        navigator.clipboard.writeText(linkInput.value).then(() => {\n          toast.success('Link copied to clipboard');\n        }).catch(() => {\n          // Fallback\n          linkInput.select();\n          document.execCommand('copy');\n          toast.success('Link copied');\n        });\n      });\n    }\n  }, 0);\n}\n\n/**\n * Generate invite link\n */\nasync function generateInviteLink(container: HTMLElement, projectId: string): Promise<void> {\n  const linkInput = container.querySelector('#invite-link') as HTMLInputElement;\n\n  try {\n    const response = await http.get<{ link?: string; invite_url?: string }>(`/api/projects/${projectId}/invites/link`);\n    linkInput.value = response.data.link || response.data.invite_url || 'Link not available';\n  } catch {\n    // Try alternate endpoint\n    try {\n      const response = await http.post<{ invite_url?: string; token?: string }>(`/api/projects/${projectId}/invites`, {\n        email: '',\n        role: 'member',\n        generate_link_only: true,\n      });\n      if (response.data.invite_url) {\n        linkInput.value = response.data.invite_url;\n      } else {\n        linkInput.value = 'Use email invitation instead';\n      }\n    } catch {\n      linkInput.value = 'Use email invitation instead';\n    }\n  }\n}\n\n/**\n * Load project members to filter out already-linked contacts\n */\nasync function loadProjectMembers(projectId: string): Promise<void> {\n  try {\n    const response = await http.get<{ members: ProjectMember[] }>(`/api/projects/${projectId}/members`);\n    cachedMembers = response.data.members || [];\n  } catch (error) {\n    console.warn('[InviteModal] Failed to load project members:', error);\n    cachedMembers = [];\n  }\n}\n\n/**\n * Load contacts for selection\n */\nasync function loadContacts(container: HTMLElement, projectId: string, onSelect: (contact: Contact | null) => void): Promise<void> {\n  const listEl = container.querySelector('#contacts-list') as HTMLElement;\n  if (!listEl) return;\n\n  try {\n    // Load members first to know which contacts are already linked\n    await loadProjectMembers(projectId);\n\n    const response = await http.get<{ contacts: Contact[] }>('/api/contacts');\n    const contacts = response.data.contacts || [];\n\n    // Get IDs of contacts already linked to project members\n    const linkedContactIds = new Set(\n      cachedMembers\n        .filter(m => m.linked_contact_id)\n        .map(m => m.linked_contact_id)\n    );\n\n    // Filter to contacts not already linked to a member\n    // Note: For \"Add to Team\" we don't require email, only for \"Send Invitation\"\n    const availableContacts = contacts.filter(c => !linkedContactIds.has(c.id));\n\n    if (availableContacts.length === 0) {\n      listEl.innerHTML = `\n        <div class=\"no-contacts-msg\">\n          ${linkedContactIds.size > 0\n          ? 'All contacts are already team members.'\n          : 'No contacts found.'}\n          <br>\n          <small class=\"invite-no-contacts-hint\">Add contacts in the Contacts panel.</small>\n        </div>\n      `;\n      return;\n    }\n\n    listEl.innerHTML = availableContacts.map(contact => {\n      const initials = contact.name.split(' ').map(n => n[0]).join('').substring(0, 2).toUpperCase();\n      const avatarUrl = contact.avatar_url || contact.photo_url;\n      const hasEmail = !!contact.email;\n      const subtitle = [contact.email, contact.organization].filter(Boolean).join('  ') || contact.role || 'No email';\n\n      return `\n        <label class=\"contact-option\" data-id=\"${contact.id}\" data-has-email=\"${hasEmail}\">\n          <input type=\"radio\" name=\"contact-select\" value=\"${contact.id}\">\n          <span class=\"radio-circle\"></span>\n          <div class=\"contact-avatar\">\n            ${avatarUrl ? `<img src=\"${avatarUrl}\" alt=\"${escapeHtml(contact.name)}\">` : initials}\n          </div>\n          <div class=\"contact-info\">\n            <div class=\"contact-name\">${escapeHtml(contact.name)}</div>\n            <div class=\"contact-email\">${escapeHtml(subtitle)}${!hasEmail ? ' <span class=\"contact-no-email\">(no email)</span>' : ''}</div>\n          </div>\n        </label>\n      `;\n    }).join('');\n\n    // Bind selection events\n    const options = listEl.querySelectorAll('.contact-option');\n    options.forEach(option => {\n      on(option as HTMLElement, 'click', () => {\n        options.forEach(o => o.classList.remove('selected'));\n        option.classList.add('selected');\n\n        const contactId = option.getAttribute('data-id');\n        const selectedContact = availableContacts.find(c => c.id === contactId) || null;\n        onSelect(selectedContact);\n      });\n    });\n  } catch (error) {\n    listEl.innerHTML = `\n      <div class=\"no-contacts-msg\">\n        Failed to load contacts\n      </div>\n    `;\n  }\n}\n\n/**\n * Escape HTML\n */\nfunction escapeHtml(text: string): string {\n  const div = document.createElement('div');\n  div.textContent = text;\n  return div.innerHTML;\n}\n\nexport default showInviteModal;\n","/**\r\n * Role Modal Component\r\n * Manage user roles and permissions\r\n */\r\n\r\nimport { createElement, on } from '@lib/dom';\r\nimport { createModal, openModal, closeModal } from '@components/Modal';\r\nimport { http } from '@services/api';\r\nimport { toast } from '@services/toast';\r\n\r\nconst MODAL_ID = 'role-modal';\r\n\r\nexport interface Role {\r\n  id: string;\r\n  name: string;\r\n  description?: string;\r\n  permissions: string[];\r\n  color?: string;\r\n  isDefault?: boolean;\r\n}\r\n\r\nexport interface RoleModalProps {\r\n  mode: 'view' | 'edit' | 'create';\r\n  role?: Role;\r\n  availablePermissions?: string[];\r\n  onSave?: (role: Role) => void;\r\n  onDelete?: (roleId: string) => void;\r\n}\r\n\r\nconst defaultPermissions = [\r\n  'view:dashboard',\r\n  'view:chat',\r\n  'view:sot',\r\n  'view:contacts',\r\n  'edit:questions',\r\n  'edit:risks',\r\n  'edit:actions',\r\n  'edit:decisions',\r\n  'edit:contacts',\r\n  'manage:team',\r\n  'manage:settings',\r\n  'manage:roles',\r\n  'delete:data',\r\n  'export:data',\r\n];\r\n\r\n/**\r\n * Show role modal\r\n */\r\nexport function showRoleModal(props: RoleModalProps): void {\r\n  const { mode, role, availablePermissions = defaultPermissions, onSave, onDelete } = props;\r\n  const isEdit = mode === 'edit' && role?.id;\r\n  const isView = mode === 'view';\r\n\r\n  // Remove existing modal\r\n  const existing = document.querySelector(`[data-modal-id=\"${MODAL_ID}\"]`);\r\n  if (existing) existing.remove();\r\n\r\n  const content = createElement('div', { className: 'role-modal-content' });\r\n\r\n  if (isView && role) {\r\n    content.innerHTML = `\r\n      <div class=\"role-view\">\r\n        <div class=\"role-header-info\">\r\n          <div class=\"role-color-badge\" style=\"--role-color: ${role.color || '#e94560'}\"></div>\r\n          <div>\r\n            <h3>${escapeHtml(role.name)}</h3>\r\n            ${role.description ? `<p class=\"text-muted\">${escapeHtml(role.description)}</p>` : ''}\r\n          </div>\r\n        </div>\r\n        \r\n        <div class=\"role-permissions\">\r\n          <h4>Permissions (${role.permissions.length})</h4>\r\n          <div class=\"permissions-list\">\r\n            ${role.permissions.map(p => `\r\n              <span class=\"permission-tag\">${formatPermission(p)}</span>\r\n            `).join('')}\r\n          </div>\r\n        </div>\r\n        \r\n        ${role.isDefault ? '<p class=\"text-muted\"><em>This is a system role and cannot be modified.</em></p>' : ''}\r\n      </div>\r\n    `;\r\n  } else {\r\n    const rolePermissions = role?.permissions || [];\r\n\r\n    content.innerHTML = `\r\n      <form id=\"role-form\" class=\"role-form\">\r\n        <div class=\"form-row\">\r\n          <div class=\"form-group role-form-flex-1\">\r\n            <label for=\"role-name\">Role Name *</label>\r\n            <input type=\"text\" id=\"role-name\" required \r\n                   value=\"${role?.name || ''}\" \r\n                   placeholder=\"e.g., Project Manager\">\r\n          </div>\r\n          <div class=\"form-group role-form-w-80\">\r\n            <label for=\"role-color\">Color</label>\r\n            <input type=\"color\" id=\"role-color\" \r\n                   value=\"${role?.color || '#e94560'}\">\r\n          </div>\r\n        </div>\r\n        \r\n        <div class=\"form-group\">\r\n          <label for=\"role-description\">Description</label>\r\n          <textarea id=\"role-description\" rows=\"2\" \r\n                    placeholder=\"Brief description of this role...\">${role?.description || ''}</textarea>\r\n        </div>\r\n        \r\n        <div class=\"form-group\">\r\n          <label>Permissions</label>\r\n          <div class=\"permissions-grid\">\r\n            ${availablePermissions.map(p => `\r\n              <label class=\"permission-checkbox\">\r\n                <input type=\"checkbox\" name=\"permissions\" value=\"${p}\" \r\n                       ${rolePermissions.includes(p) ? 'checked' : ''}>\r\n                <span>${formatPermission(p)}</span>\r\n              </label>\r\n            `).join('')}\r\n          </div>\r\n        </div>\r\n        \r\n        <div class=\"form-group\">\r\n          <button type=\"button\" class=\"btn btn-sm btn-secondary\" data-action=\"select-all\">Select All</button>\r\n          <button type=\"button\" class=\"btn btn-sm btn-secondary\" data-action=\"select-none\">Select None</button>\r\n        </div>\r\n      </form>\r\n    `;\r\n\r\n    // Bind select all/none\r\n    setTimeout(() => {\r\n      const selectAll = content.querySelector('[data-action=\"select-all\"]');\r\n      const selectNone = content.querySelector('[data-action=\"select-none\"]');\r\n\r\n      if (selectAll) {\r\n        on(selectAll as HTMLElement, 'click', () => {\r\n          content.querySelectorAll('[name=\"permissions\"]').forEach(cb => {\r\n            (cb as HTMLInputElement).checked = true;\r\n          });\r\n        });\r\n      }\r\n\r\n      if (selectNone) {\r\n        on(selectNone as HTMLElement, 'click', () => {\r\n          content.querySelectorAll('[name=\"permissions\"]').forEach(cb => {\r\n            (cb as HTMLInputElement).checked = false;\r\n          });\r\n        });\r\n      }\r\n    }, 0);\r\n  }\r\n\r\n  // Footer\r\n  const footer = createElement('div', { className: 'modal-footer' });\r\n\r\n  if (isView) {\r\n    const editBtn = createElement('button', {\r\n      className: 'btn btn-primary',\r\n      textContent: 'Edit',\r\n    });\r\n\r\n    const closeBtn = createElement('button', {\r\n      className: 'btn btn-secondary',\r\n      textContent: 'Close',\r\n    });\r\n\r\n    on(closeBtn, 'click', () => closeModal(MODAL_ID));\r\n\r\n    if (!role?.isDefault) {\r\n      on(editBtn, 'click', () => {\r\n        closeModal(MODAL_ID);\r\n        showRoleModal({ ...props, mode: 'edit' });\r\n      });\r\n      footer.appendChild(editBtn);\r\n    }\r\n\r\n    footer.appendChild(closeBtn);\r\n  } else {\r\n    const cancelBtn = createElement('button', {\r\n      className: 'btn btn-secondary',\r\n      textContent: 'Cancel',\r\n    });\r\n\r\n    const saveBtn = createElement('button', {\r\n      className: 'btn btn-primary',\r\n      textContent: isEdit ? 'Save Changes' : 'Create Role',\r\n    });\r\n\r\n    on(cancelBtn, 'click', () => closeModal(MODAL_ID));\r\n\r\n    on(saveBtn, 'click', async () => {\r\n      const form = content.querySelector('#role-form') as HTMLFormElement;\r\n      if (!form.checkValidity()) {\r\n        form.reportValidity();\r\n        return;\r\n      }\r\n\r\n      const name = (content.querySelector('#role-name') as HTMLInputElement).value.trim();\r\n      const description = (content.querySelector('#role-description') as HTMLTextAreaElement).value.trim();\r\n      const color = (content.querySelector('#role-color') as HTMLInputElement).value;\r\n\r\n      const permissions: string[] = [];\r\n      content.querySelectorAll('[name=\"permissions\"]:checked').forEach(cb => {\r\n        permissions.push((cb as HTMLInputElement).value);\r\n      });\r\n\r\n      const roleData: Role = {\r\n        id: role?.id || `role-${Date.now()}`,\r\n        name,\r\n        description: description || undefined,\r\n        color,\r\n        permissions,\r\n      };\r\n\r\n      saveBtn.disabled = true;\r\n      saveBtn.textContent = 'Saving...';\r\n\r\n      try {\r\n        if (isEdit) {\r\n          await http.put(`/api/roles/${role!.id}`, roleData);\r\n          toast.success('Role updated');\r\n        } else {\r\n          const response = await http.post<{ id: string }>('/api/roles', roleData);\r\n          roleData.id = response.data.id;\r\n          toast.success('Role created');\r\n        }\r\n\r\n        onSave?.(roleData);\r\n        closeModal(MODAL_ID);\r\n      } catch {\r\n        // Error shown by API service\r\n      } finally {\r\n        saveBtn.disabled = false;\r\n        saveBtn.textContent = isEdit ? 'Save Changes' : 'Create Role';\r\n      }\r\n    });\r\n\r\n    if (isEdit && !role?.isDefault) {\r\n      const deleteBtn = createElement('button', {\r\n        className: 'btn btn-danger',\r\n        textContent: 'Delete',\r\n      });\r\n\r\n      on(deleteBtn, 'click', async () => {\r\n        const { confirm } = await import('@components/Modal');\r\n        const confirmed = await confirm(\r\n          `Are you sure you want to delete the \"${role!.name}\" role?`,\r\n          {\r\n            title: 'Delete Role',\r\n            confirmText: 'Delete',\r\n            confirmClass: 'btn-danger',\r\n          }\r\n        );\r\n\r\n        if (confirmed) {\r\n          try {\r\n            await http.delete(`/api/roles/${role!.id}`);\r\n            toast.success('Role deleted');\r\n            onDelete?.(role!.id);\r\n            closeModal(MODAL_ID);\r\n          } catch {\r\n            // Error shown by API service\r\n          }\r\n        }\r\n      });\r\n\r\n      footer.appendChild(deleteBtn);\r\n    }\r\n\r\n    footer.appendChild(cancelBtn);\r\n    footer.appendChild(saveBtn);\r\n  }\r\n\r\n  // Create modal\r\n  const modal = createModal({\r\n    id: MODAL_ID,\r\n    title: isView ? 'Role Details' : (isEdit ? 'Edit Role' : 'New Role'),\r\n    content,\r\n    size: 'md',\r\n    footer,\r\n  });\r\n\r\n  document.body.appendChild(modal);\r\n  openModal(MODAL_ID);\r\n}\r\n\r\n/**\r\n * Format permission for display\r\n */\r\nfunction formatPermission(permission: string): string {\r\n  return permission\r\n    .replace(':', ': ')\r\n    .split(/[_:]/)\r\n    .map(word => word.charAt(0).toUpperCase() + word.slice(1))\r\n    .join(' ');\r\n}\r\n\r\n/**\r\n * Escape HTML\r\n */\r\nfunction escapeHtml(text: string): string {\r\n  const div = document.createElement('div');\r\n  div.textContent = text;\r\n  return div.innerHTML;\r\n}\r\n\r\nexport default showRoleModal;\r\n","/**\r\n * Export Modal Component\r\n * Export project data in various formats\r\n */\r\n\r\nimport { createElement, on, addClass, removeClass } from '@lib/dom';\r\nimport { createModal, openModal, closeModal } from '@components/Modal';\r\nimport { http } from '@services/api';\r\nimport { toast } from '@services/toast';\r\nimport { appStore } from '@stores/app';\r\n\r\nconst MODAL_ID = 'export-modal';\r\n\r\nexport type ExportFormat = 'json' | 'csv' | 'pdf' | 'markdown';\r\nexport type ExportScope = 'all' | 'questions' | 'risks' | 'actions' | 'decisions' | 'contacts';\r\n\r\nexport interface ExportModalProps {\r\n  defaultFormat?: ExportFormat;\r\n  defaultScope?: ExportScope;\r\n  onExport?: (format: ExportFormat, scope: ExportScope) => void;\r\n}\r\n\r\n/**\r\n * Show export modal\r\n */\r\nexport function showExportModal(props: ExportModalProps = {}): void {\r\n  const { defaultFormat = 'json', defaultScope = 'all' } = props;\r\n\r\n  // Remove existing modal\r\n  const existing = document.querySelector(`[data-modal-id=\"${MODAL_ID}\"]`);\r\n  if (existing) existing.remove();\r\n\r\n  const content = createElement('div', { className: 'export-modal-content' });\r\n\r\n  content.innerHTML = `\r\n    <div class=\"export-options\">\r\n      <div class=\"form-group\">\r\n        <label>What to Export</label>\r\n        <div class=\"scope-options\">\r\n          <label class=\"radio-card ${defaultScope === 'all' ? 'selected' : ''}\">\r\n            <input type=\"radio\" name=\"export-scope\" value=\"all\" ${defaultScope === 'all' ? 'checked' : ''}>\r\n            <div class=\"radio-card-content\">\r\n              <span class=\"icon\"></span>\r\n              <span class=\"label\">Everything</span>\r\n            </div>\r\n          </label>\r\n          <label class=\"radio-card ${defaultScope === 'questions' ? 'selected' : ''}\">\r\n            <input type=\"radio\" name=\"export-scope\" value=\"questions\" ${defaultScope === 'questions' ? 'checked' : ''}>\r\n            <div class=\"radio-card-content\">\r\n              <span class=\"icon\"></span>\r\n              <span class=\"label\">Questions</span>\r\n            </div>\r\n          </label>\r\n          <label class=\"radio-card ${defaultScope === 'risks' ? 'selected' : ''}\">\r\n            <input type=\"radio\" name=\"export-scope\" value=\"risks\" ${defaultScope === 'risks' ? 'checked' : ''}>\r\n            <div class=\"radio-card-content\">\r\n              <span class=\"icon\"></span>\r\n              <span class=\"label\">Risks</span>\r\n            </div>\r\n          </label>\r\n          <label class=\"radio-card ${defaultScope === 'actions' ? 'selected' : ''}\">\r\n            <input type=\"radio\" name=\"export-scope\" value=\"actions\" ${defaultScope === 'actions' ? 'checked' : ''}>\r\n            <div class=\"radio-card-content\">\r\n              <span class=\"icon\"></span>\r\n              <span class=\"label\">Actions</span>\r\n            </div>\r\n          </label>\r\n          <label class=\"radio-card ${defaultScope === 'decisions' ? 'selected' : ''}\">\r\n            <input type=\"radio\" name=\"export-scope\" value=\"decisions\" ${defaultScope === 'decisions' ? 'checked' : ''}>\r\n            <div class=\"radio-card-content\">\r\n              <span class=\"icon\"></span>\r\n              <span class=\"label\">Decisions</span>\r\n            </div>\r\n          </label>\r\n          <label class=\"radio-card ${defaultScope === 'contacts' ? 'selected' : ''}\">\r\n            <input type=\"radio\" name=\"export-scope\" value=\"contacts\" ${defaultScope === 'contacts' ? 'checked' : ''}>\r\n            <div class=\"radio-card-content\">\r\n              <span class=\"icon\"></span>\r\n              <span class=\"label\">Contacts</span>\r\n            </div>\r\n          </label>\r\n        </div>\r\n      </div>\r\n      \r\n      <div class=\"form-group\">\r\n        <label>Format</label>\r\n        <div class=\"format-options\">\r\n          <label class=\"radio-card ${defaultFormat === 'json' ? 'selected' : ''}\">\r\n            <input type=\"radio\" name=\"export-format\" value=\"json\" ${defaultFormat === 'json' ? 'checked' : ''}>\r\n            <div class=\"radio-card-content\">\r\n              <span class=\"icon\">{ }</span>\r\n              <span class=\"label\">JSON</span>\r\n              <span class=\"hint\">Full data backup</span>\r\n            </div>\r\n          </label>\r\n          <label class=\"radio-card ${defaultFormat === 'csv' ? 'selected' : ''}\">\r\n            <input type=\"radio\" name=\"export-format\" value=\"csv\" ${defaultFormat === 'csv' ? 'checked' : ''}>\r\n            <div class=\"radio-card-content\">\r\n              <span class=\"icon\"></span>\r\n              <span class=\"label\">CSV</span>\r\n              <span class=\"hint\">Spreadsheet</span>\r\n            </div>\r\n          </label>\r\n          <label class=\"radio-card ${defaultFormat === 'markdown' ? 'selected' : ''}\">\r\n            <input type=\"radio\" name=\"export-format\" value=\"markdown\" ${defaultFormat === 'markdown' ? 'checked' : ''}>\r\n            <div class=\"radio-card-content\">\r\n              <span class=\"icon\"></span>\r\n              <span class=\"label\">Markdown</span>\r\n              <span class=\"hint\">Documentation</span>\r\n            </div>\r\n          </label>\r\n          <label class=\"radio-card ${defaultFormat === 'pdf' ? 'selected' : ''}\">\r\n            <input type=\"radio\" name=\"export-format\" value=\"pdf\" ${defaultFormat === 'pdf' ? 'checked' : ''}>\r\n            <div class=\"radio-card-content\">\r\n              <span class=\"icon\"></span>\r\n              <span class=\"label\">PDF</span>\r\n              <span class=\"hint\">Report</span>\r\n            </div>\r\n          </label>\r\n        </div>\r\n      </div>\r\n    </div>\r\n  `;\r\n\r\n  // Handle radio card selection styling\r\n  content.querySelectorAll('.radio-card input').forEach(input => {\r\n    on(input as HTMLElement, 'change', () => {\r\n      const group = (input as HTMLInputElement).name;\r\n      content.querySelectorAll(`[name=\"${group}\"]`).forEach(radio => {\r\n        const card = radio.closest('.radio-card');\r\n        if (card) {\r\n          if ((radio as HTMLInputElement).checked) {\r\n            addClass(card as HTMLElement, 'selected');\r\n          } else {\r\n            removeClass(card as HTMLElement, 'selected');\r\n          }\r\n        }\r\n      });\r\n    });\r\n  });\r\n\r\n  // Footer\r\n  const footer = createElement('div', { className: 'modal-footer' });\r\n\r\n  const cancelBtn = createElement('button', {\r\n    className: 'btn btn-secondary',\r\n    textContent: 'Cancel',\r\n  });\r\n\r\n  const exportBtn = createElement('button', {\r\n    className: 'btn btn-primary',\r\n    textContent: 'Export',\r\n  });\r\n\r\n  on(cancelBtn, 'click', () => closeModal(MODAL_ID));\r\n\r\n  on(exportBtn, 'click', async () => {\r\n    const format = (content.querySelector('[name=\"export-format\"]:checked') as HTMLInputElement)?.value as ExportFormat;\r\n    const scope = (content.querySelector('[name=\"export-scope\"]:checked') as HTMLInputElement)?.value as ExportScope;\r\n\r\n    exportBtn.disabled = true;\r\n    exportBtn.textContent = 'Exporting...';\r\n\r\n    try {\r\n      await performExport(format, scope);\r\n      props.onExport?.(format, scope);\r\n      closeModal(MODAL_ID);\r\n    } catch {\r\n      // Error handled in performExport\r\n    } finally {\r\n      exportBtn.disabled = false;\r\n      exportBtn.textContent = 'Export';\r\n    }\r\n  });\r\n\r\n  footer.appendChild(cancelBtn);\r\n  footer.appendChild(exportBtn);\r\n\r\n  // Create modal\r\n  const modal = createModal({\r\n    id: MODAL_ID,\r\n    title: 'Export Data',\r\n    content,\r\n    size: 'md',\r\n    footer,\r\n  });\r\n\r\n  document.body.appendChild(modal);\r\n  openModal(MODAL_ID);\r\n}\r\n\r\n/**\r\n * Perform the export\r\n */\r\nasync function performExport(format: ExportFormat, scope: ExportScope): Promise<void> {\r\n  const projectId = appStore.getState().currentProjectId;\r\n  if (!projectId) {\r\n    toast.error('No project selected');\r\n    return;\r\n  }\r\n\r\n  try {\r\n    const response = await http.get<unknown>(`/api/projects/${projectId}/export`, {\r\n      headers: {\r\n        'Accept': getContentType(format),\r\n      },\r\n    });\r\n\r\n    // Create download\r\n    const blob = createBlob(response.data, format);\r\n    const url = URL.createObjectURL(blob);\r\n    const a = document.createElement('a');\r\n    a.href = url;\r\n    a.download = `godmode-${scope}-${new Date().toISOString().split('T')[0]}.${getExtension(format)}`;\r\n    a.click();\r\n    URL.revokeObjectURL(url);\r\n\r\n    toast.success('Export completed');\r\n  } catch {\r\n    toast.error('Export failed');\r\n    throw new Error('Export failed');\r\n  }\r\n}\r\n\r\n/**\r\n * Get content type for format\r\n */\r\nfunction getContentType(format: ExportFormat): string {\r\n  switch (format) {\r\n    case 'json': return 'application/json';\r\n    case 'csv': return 'text/csv';\r\n    case 'markdown': return 'text/markdown';\r\n    case 'pdf': return 'application/pdf';\r\n  }\r\n}\r\n\r\n/**\r\n * Get file extension for format\r\n */\r\nfunction getExtension(format: ExportFormat): string {\r\n  switch (format) {\r\n    case 'json': return 'json';\r\n    case 'csv': return 'csv';\r\n    case 'markdown': return 'md';\r\n    case 'pdf': return 'pdf';\r\n  }\r\n}\r\n\r\n/**\r\n * Create blob from data\r\n */\r\nfunction createBlob(data: unknown, format: ExportFormat): Blob {\r\n  let content: string;\r\n  let type: string;\r\n\r\n  switch (format) {\r\n    case 'json':\r\n      content = JSON.stringify(data, null, 2);\r\n      type = 'application/json';\r\n      break;\r\n    case 'csv':\r\n      content = typeof data === 'string' ? data : JSON.stringify(data);\r\n      type = 'text/csv';\r\n      break;\r\n    case 'markdown':\r\n      content = typeof data === 'string' ? data : JSON.stringify(data, null, 2);\r\n      type = 'text/markdown';\r\n      break;\r\n    case 'pdf':\r\n      // PDF would need special handling\r\n      content = typeof data === 'string' ? data : '';\r\n      type = 'application/pdf';\r\n      break;\r\n  }\r\n\r\n  return new Blob([content], { type });\r\n}\r\n\r\nexport default showExportModal;\r\n","/**\r\n * File Upload Modal Component\r\n * Handle file uploads with progress\r\n */\r\n\r\nimport { createElement, on, addClass, removeClass } from '@lib/dom';\r\nimport { createModal, openModal, closeModal } from '@components/Modal';\r\nimport { toast } from '@services/toast';\r\nimport { formatFileSize } from '@lib/format';\r\nimport { getSprints } from '@services/sprints';\r\nimport { getActions } from '@services/actions';\r\nimport type { Sprint } from '@services/sprints';\r\nimport type { Action } from '@services/actions';\r\n\r\nconst MODAL_ID = 'file-upload-modal';\r\n\r\nexport interface UploadFile {\r\n  id: string;\r\n  file: File;\r\n  progress: number;\r\n  status: 'pending' | 'uploading' | 'completed' | 'error';\r\n  error?: string;\r\n}\r\n\r\nexport interface FileUploadModalProps {\r\n  accept?: string;\r\n  multiple?: boolean;\r\n  maxSize?: number; // bytes\r\n  onUpload?: (files: File[]) => Promise<void>;\r\n  onComplete?: (results: UploadFile[]) => void;\r\n}\r\n\r\nlet uploadQueue: UploadFile[] = [];\r\nlet isUploading = false;\r\nlet sprintsList: Sprint[] = [];\r\nlet actionsList: Action[] = [];\r\nlet selectedSprintId = '';\r\nlet selectedActionId = '';\r\n\r\n/**\r\n * Show file upload modal\r\n */\r\nexport function showFileUploadModal(props: FileUploadModalProps = {}): void {\r\n  const {\r\n    accept = '*/*',\r\n    multiple = true,\r\n    maxSize = 50 * 1024 * 1024, // 50MB default\r\n    onUpload,\r\n    onComplete,\r\n  } = props;\r\n\r\n  uploadQueue = [];\r\n  isUploading = false;\r\n  selectedSprintId = '';\r\n  selectedActionId = '';\r\n\r\n  // Remove existing modal\r\n  const existing = document.querySelector(`[data-modal-id=\"${MODAL_ID}\"]`);\r\n  if (existing) existing.remove();\r\n\r\n  const content = createElement('div', { className: 'file-upload-modal-content' });\r\n\r\n  function render(): void {\r\n    const sprintOptions = sprintsList.map(s => `<option value=\"${s.id}\" ${s.id === selectedSprintId ? 'selected' : ''}>${escapeHtml(s.name)}</option>`).join('');\r\n    const actionOptions = actionsList.map(a => `<option value=\"${a.id}\" ${a.id === selectedActionId ? 'selected' : ''}>${escapeHtml((a.content || a.task || String(a.id)).slice(0, 60))}${(a.content || a.task || '').length > 60 ? '' : ''}</option>`).join('');\r\n\r\n    content.innerHTML = `\r\n      <div class=\"drop-zone\" id=\"drop-zone\">\r\n        <div class=\"drop-zone-icon\"></div>\r\n        <div class=\"drop-zone-text\">\r\n          <strong>Drop files here</strong> or click to browse\r\n        </div>\r\n        <div class=\"drop-zone-hint\">\r\n          ${multiple ? 'You can upload multiple files' : 'Single file only'}\r\n          ${maxSize ? `  Max ${formatFileSize(maxSize)}` : ''}\r\n        </div>\r\n        <input type=\"file\" id=\"file-input\" ${accept !== '*/*' ? `accept=\"${accept}\"` : ''} ${multiple ? 'multiple' : ''} hidden>\r\n      </div>\r\n\r\n      <div class=\"upload-association\" style=\"margin-top: 1rem; padding-top: 1rem; border-top: 1px solid var(--border-color, #e2e8f0);\">\r\n        <label class=\"form-label\" style=\"display: block; margin-bottom: 0.5rem; font-weight: 500;\">Associate with (optional)</label>\r\n        <div style=\"display: flex; gap: 12px; flex-wrap: wrap;\">\r\n          <div style=\"flex: 1; min-width: 140px;\">\r\n            <select id=\"upload-sprint-select\" class=\"form-select\" style=\"width: 100%;\">\r\n              <option value=\"\">No sprint</option>\r\n              ${sprintOptions}\r\n            </select>\r\n            <span class=\"form-hint\" style=\"font-size: 0.75rem; color: var(--text-tertiary);\">Sprint</span>\r\n          </div>\r\n          <div style=\"flex: 1; min-width: 180px;\">\r\n            <select id=\"upload-action-select\" class=\"form-select\" style=\"width: 100%;\">\r\n              <option value=\"\">No task</option>\r\n              ${actionOptions}\r\n            </select>\r\n            <span class=\"form-hint\" style=\"font-size: 0.75rem; color: var(--text-tertiary);\">Task</span>\r\n          </div>\r\n        </div>\r\n      </div>\r\n      \r\n      ${uploadQueue.length > 0 ? `\r\n        <div class=\"upload-list\">\r\n          <h4>Files (${uploadQueue.length})</h4>\r\n          ${uploadQueue.map(f => renderFileItem(f)).join('')}\r\n        </div>\r\n      ` : ''}\r\n    `;\r\n\r\n    bindDropZone();\r\n    bindFileItems();\r\n    bindSprintTaskSelectors();\r\n  }\r\n\r\n  function bindDropZone(): void {\r\n    const dropZone = content.querySelector('#drop-zone') as HTMLElement;\r\n    const fileInput = content.querySelector('#file-input') as HTMLInputElement;\r\n\r\n    if (!dropZone || !fileInput) return;\r\n\r\n    // Click to browse\r\n    on(dropZone, 'click', () => fileInput.click());\r\n\r\n    // File input change\r\n    on(fileInput, 'change', () => {\r\n      if (fileInput.files) {\r\n        addFiles(Array.from(fileInput.files), maxSize);\r\n        render();\r\n      }\r\n    });\r\n\r\n    // Drag and drop\r\n    on(dropZone, 'dragover', (e) => {\r\n      e.preventDefault();\r\n      addClass(dropZone, 'drag-over');\r\n    });\r\n\r\n    on(dropZone, 'dragleave', () => {\r\n      removeClass(dropZone, 'drag-over');\r\n    });\r\n\r\n    on(dropZone, 'drop', (e) => {\r\n      e.preventDefault();\r\n      removeClass(dropZone, 'drag-over');\r\n\r\n      const dt = (e as DragEvent).dataTransfer;\r\n      if (dt?.files) {\r\n        addFiles(Array.from(dt.files), maxSize);\r\n        render();\r\n      }\r\n    });\r\n  }\r\n\r\n  function bindFileItems(): void {\r\n    content.querySelectorAll('[data-action=\"remove\"]').forEach(btn => {\r\n      on(btn as HTMLElement, 'click', () => {\r\n        const fileId = btn.getAttribute('data-file-id');\r\n        if (fileId) {\r\n          uploadQueue = uploadQueue.filter(f => f.id !== fileId);\r\n          render();\r\n        }\r\n      });\r\n    });\r\n  }\r\n\r\n  async function loadSprints(): Promise<void> {\r\n    try {\r\n      sprintsList = await getSprints();\r\n    } catch {\r\n      sprintsList = [];\r\n    }\r\n  }\r\n\r\n  async function loadActionsForSprint(sprintId: string): Promise<void> {\r\n    try {\r\n      actionsList = await getActions(undefined, sprintId || undefined);\r\n    } catch {\r\n      actionsList = [];\r\n    }\r\n  }\r\n\r\n  function bindSprintTaskSelectors(): void {\r\n    const sprintSelect = content.querySelector('#upload-sprint-select') as HTMLSelectElement;\r\n    const actionSelect = content.querySelector('#upload-action-select') as HTMLSelectElement;\r\n    if (sprintSelect) {\r\n      on(sprintSelect, 'change', async () => {\r\n        selectedSprintId = sprintSelect.value || '';\r\n        selectedActionId = '';\r\n        await loadActionsForSprint(selectedSprintId);\r\n        render();\r\n      });\r\n    }\r\n    if (actionSelect) {\r\n      on(actionSelect, 'change', () => {\r\n        selectedActionId = actionSelect.value || '';\r\n      });\r\n    }\r\n  }\r\n\r\n  render();\r\n  loadSprints().then(() => render());\r\n\r\n  // Footer\r\n  const footer = createElement('div', { className: 'modal-footer' });\r\n\r\n  const cancelBtn = createElement('button', {\r\n    className: 'btn btn-secondary',\r\n    textContent: 'Cancel',\r\n  });\r\n\r\n  const uploadBtn = createElement('button', {\r\n    className: 'btn btn-primary',\r\n    textContent: 'Upload',\r\n  });\r\n\r\n  on(cancelBtn, 'click', () => {\r\n    if (isUploading) {\r\n      toast.warning('Upload in progress');\r\n      return;\r\n    }\r\n    closeModal(MODAL_ID);\r\n  });\r\n\r\n  on(uploadBtn, 'click', async () => {\r\n    if (uploadQueue.length === 0) {\r\n      toast.warning('No files selected');\r\n      return;\r\n    }\r\n\r\n    if (isUploading) return;\r\n\r\n    isUploading = true;\r\n    uploadBtn.disabled = true;\r\n    uploadBtn.textContent = 'Uploading...';\r\n\r\n    try {\r\n      if (onUpload) {\r\n        const files = uploadQueue.map(f => f.file);\r\n        await onUpload(files);\r\n\r\n        // Mark all as completed\r\n        uploadQueue.forEach(f => {\r\n          f.status = 'completed';\r\n          f.progress = 100;\r\n        });\r\n      } else {\r\n        // Default upload behavior\r\n        await uploadFiles(uploadQueue, render);\r\n      }\r\n\r\n      toast.success('Upload complete');\r\n      onComplete?.(uploadQueue);\r\n      closeModal(MODAL_ID);\r\n    } catch (error) {\r\n      toast.error('Upload failed');\r\n    } finally {\r\n      isUploading = false;\r\n      uploadBtn.disabled = false;\r\n      uploadBtn.textContent = 'Upload';\r\n      render();\r\n    }\r\n  });\r\n\r\n  footer.appendChild(cancelBtn);\r\n  footer.appendChild(uploadBtn);\r\n\r\n  // Create modal\r\n  const modal = createModal({\r\n    id: MODAL_ID,\r\n    title: 'Upload Files',\r\n    content,\r\n    size: 'md',\r\n    footer,\r\n  });\r\n\r\n  document.body.appendChild(modal);\r\n  openModal(MODAL_ID);\r\n}\r\n\r\n/**\r\n * Add files to queue\r\n */\r\nfunction addFiles(files: File[], maxSize: number): void {\r\n  files.forEach(file => {\r\n    if (file.size > maxSize) {\r\n      toast.error(`${file.name} exceeds max size`);\r\n      return;\r\n    }\r\n\r\n    // Check for duplicates\r\n    if (uploadQueue.some(f => f.file.name === file.name && f.file.size === file.size)) {\r\n      return;\r\n    }\r\n\r\n    uploadQueue.push({\r\n      id: `file-${Date.now()}-${Math.random().toString(36).slice(2)}`,\r\n      file,\r\n      progress: 0,\r\n      status: 'pending',\r\n    });\r\n  });\r\n}\r\n\r\n/**\r\n * Render file item\r\n */\r\nfunction renderFileItem(item: UploadFile): string {\r\n  const icon = getFileIcon(item.file.type);\r\n  const statusClass = item.status;\r\n\r\n  return `\r\n    <div class=\"upload-item ${statusClass}\" data-file-id=\"${item.id}\">\r\n      <span class=\"file-icon\">${icon}</span>\r\n      <div class=\"file-info\">\r\n        <div class=\"file-name\">${escapeHtml(item.file.name)}</div>\r\n        <div class=\"file-size\">${formatFileSize(item.file.size)}</div>\r\n        ${item.status === 'uploading' ? `\r\n          <div class=\"progress-bar\">\r\n            <div class=\"progress-fill\" style=\"--progress: ${item.progress}\"></div>\r\n          </div>\r\n        ` : ''}\r\n        ${item.error ? `<div class=\"file-error\">${escapeHtml(item.error)}</div>` : ''}\r\n      </div>\r\n      <div class=\"file-status\">\r\n        ${item.status === 'completed' ? '' : ''}\r\n        ${item.status === 'error' ? '' : ''}\r\n        ${item.status === 'pending' ? `\r\n          <button class=\"btn-sm btn-danger\" data-action=\"remove\" data-file-id=\"${item.id}\"></button>\r\n        ` : ''}\r\n      </div>\r\n    </div>\r\n  `;\r\n}\r\n\r\n/**\r\n * Default upload handler\r\n */\r\nasync function uploadFiles(\r\n  files: UploadFile[],\r\n  rerender: () => void\r\n): Promise<void> {\r\n  for (const file of files) {\r\n    file.status = 'uploading';\r\n    rerender();\r\n\r\n    try {\r\n      const formData = new FormData();\r\n      formData.append('file', file.file);\r\n      if (selectedSprintId) formData.append('sprintId', selectedSprintId);\r\n      if (selectedActionId) formData.append('actionId', selectedActionId);\r\n\r\n      const xhr = new XMLHttpRequest();\r\n\r\n      await new Promise<void>((resolve, reject) => {\r\n        xhr.upload.addEventListener('progress', (e) => {\r\n          if (e.lengthComputable) {\r\n            file.progress = Math.round((e.loaded / e.total) * 100);\r\n            rerender();\r\n          }\r\n        });\r\n\r\n        xhr.addEventListener('load', () => {\r\n          if (xhr.status >= 200 && xhr.status < 300) {\r\n            file.status = 'completed';\r\n            file.progress = 100;\r\n            resolve();\r\n          } else {\r\n            file.status = 'error';\r\n            file.error = 'Upload failed';\r\n            reject(new Error('Upload failed'));\r\n          }\r\n        });\r\n\r\n        xhr.addEventListener('error', () => {\r\n          file.status = 'error';\r\n          file.error = 'Network error';\r\n          reject(new Error('Network error'));\r\n        });\r\n\r\n        xhr.open('POST', '/api/upload');\r\n        xhr.send(formData);\r\n      });\r\n    } catch {\r\n      file.status = 'error';\r\n    }\r\n\r\n    rerender();\r\n  }\r\n}\r\n\r\n/**\r\n * Get icon for file type\r\n */\r\nfunction getFileIcon(mimeType: string): string {\r\n  if (mimeType.startsWith('image/')) return '';\r\n  if (mimeType.startsWith('video/')) return '';\r\n  if (mimeType.startsWith('audio/')) return '';\r\n  if (mimeType.includes('pdf')) return '';\r\n  if (mimeType.includes('word') || mimeType.includes('document')) return '';\r\n  if (mimeType.includes('sheet') || mimeType.includes('excel')) return '';\r\n  if (mimeType.includes('presentation') || mimeType.includes('powerpoint')) return '';\r\n  if (mimeType.includes('zip') || mimeType.includes('archive')) return '';\r\n  if (mimeType.includes('text')) return '';\r\n  return '';\r\n}\r\n\r\n/**\r\n * Escape HTML\r\n */\r\nfunction escapeHtml(text: string): string {\r\n  const div = document.createElement('div');\r\n  div.textContent = text;\r\n  return div.innerHTML;\r\n}\r\n\r\nexport default showFileUploadModal;\r\n","/**\r\n * Developer Modal Component\r\n * Developer tools and debugging options\r\n */\r\n\r\nimport { createElement, on } from '@lib/dom';\r\nimport { createModal, openModal, closeModal } from '@components/Modal';\r\nimport { appStore } from '@stores/app';\r\nimport { dataStore } from '@stores/data';\r\nimport { uiStore } from '@stores/ui';\r\nimport { http, fetchWithProject } from '@services/api';\r\nimport { toast } from '@services/toast';\r\n\r\nconst MODAL_ID = 'developer-modal';\r\n\r\ntype DevTab = 'info' | 'logs' | 'cache' | 'api';\r\n\r\n/**\r\n * Show developer modal\r\n */\r\nexport function showDeveloperModal(): void {\r\n  // Remove existing modal\r\n  const existing = document.querySelector(`[data-modal-id=\"${MODAL_ID}\"]`);\r\n  if (existing) existing.remove();\r\n\r\n  const content = createElement('div', { className: 'developer-modal-content' });\r\n\r\n  let currentTab: DevTab = 'info';\r\n\r\n  function render(): void {\r\n    content.innerHTML = `\r\n      <div class=\"dev-tabs\">\r\n        <button class=\"dev-tab ${currentTab === 'info' ? 'active' : ''}\" data-tab=\"info\">Info</button>\r\n        <button class=\"dev-tab ${currentTab === 'logs' ? 'active' : ''}\" data-tab=\"logs\">Logs</button>\r\n        <button class=\"dev-tab ${currentTab === 'cache' ? 'active' : ''}\" data-tab=\"cache\">Cache</button>\r\n        <button class=\"dev-tab ${currentTab === 'api' ? 'active' : ''}\" data-tab=\"api\">API Test</button>\r\n      </div>\r\n      <div class=\"dev-content\">\r\n        ${renderTabContent(currentTab)}\r\n      </div>\r\n    `;\r\n\r\n    // Bind tab clicks\r\n    content.querySelectorAll('.dev-tab').forEach(tab => {\r\n      on(tab as HTMLElement, 'click', () => {\r\n        currentTab = tab.getAttribute('data-tab') as DevTab;\r\n        render();\r\n      });\r\n    });\r\n\r\n    // Bind actions\r\n    bindActions(content);\r\n  }\r\n\r\n  render();\r\n\r\n  // Footer\r\n  const footer = createElement('div', { className: 'modal-footer' });\r\n  const closeBtn = createElement('button', {\r\n    className: 'btn btn-secondary',\r\n    textContent: 'Close',\r\n  });\r\n  on(closeBtn, 'click', () => closeModal(MODAL_ID));\r\n  footer.appendChild(closeBtn);\r\n\r\n  // Create modal\r\n  const modal = createModal({\r\n    id: MODAL_ID,\r\n    title: 'Developer Tools',\r\n    content,\r\n    size: 'lg',\r\n    footer,\r\n  });\r\n\r\n  document.body.appendChild(modal);\r\n  openModal(MODAL_ID);\r\n}\r\n\r\n/**\r\n * Render tab content\r\n */\r\nfunction renderTabContent(tab: DevTab): string {\r\n  switch (tab) {\r\n    case 'info':\r\n      return renderInfoTab();\r\n    case 'logs':\r\n      return renderLogsTab();\r\n    case 'cache':\r\n      return renderCacheTab();\r\n    case 'api':\r\n      return renderApiTab();\r\n  }\r\n}\r\n\r\n/**\r\n * Render info tab\r\n */\r\nfunction renderInfoTab(): string {\r\n  const appState = appStore.getState();\r\n  const dataState = dataStore.getState();\r\n  const uiState = uiStore.getState();\r\n\r\n  return `\r\n    <div class=\"dev-section\">\r\n      <h4>Application State</h4>\r\n      <pre class=\"code-block\">${JSON.stringify({\r\n    projectId: appState.currentProjectId,\r\n    user: appState.currentUser?.email,\r\n    authConfigured: appState.authConfigured,\r\n  }, null, 2)}</pre>\r\n    </div>\r\n    \r\n    <div class=\"dev-section\">\r\n      <h4>Data Counts</h4>\r\n      <table class=\"dev-table\">\r\n        <tr><td>Questions</td><td>${dataState.questions.length}</td></tr>\r\n        <tr><td>Risks</td><td>${dataState.risks.length}</td></tr>\r\n        <tr><td>Actions</td><td>${dataState.actions.length}</td></tr>\r\n        <tr><td>Decisions</td><td>${dataState.decisions.length}</td></tr>\r\n        <tr><td>Contacts</td><td>${dataState.contacts.length}</td></tr>\r\n        <tr><td>Chat Messages</td><td>${dataState.chatHistory.length}</td></tr>\r\n      </table>\r\n    </div>\r\n    \r\n    <div class=\"dev-section\">\r\n      <h4>UI State</h4>\r\n      <pre class=\"code-block\">${JSON.stringify({\r\n    currentTab: uiState.currentTab,\r\n    sotView: uiState.sotCurrentView,\r\n    sidebarOpen: uiState.sidebarOpen,\r\n    modalOpen: uiState.modalOpen,\r\n  }, null, 2)}</pre>\r\n    </div>\r\n    \r\n    <div class=\"dev-section\">\r\n      <h4>Environment</h4>\r\n      <table class=\"dev-table\">\r\n        <tr><td>User Agent</td><td>${navigator.userAgent.slice(0, 50)}...</td></tr>\r\n        <tr><td>Screen</td><td>${window.innerWidth}x${window.innerHeight}</td></tr>\r\n        <tr><td>Theme</td><td>${document.documentElement.getAttribute('data-theme')}</td></tr>\r\n      </table>\r\n    </div>\r\n  `;\r\n}\r\n\r\n/**\r\n * Render logs tab\r\n */\r\nfunction renderLogsTab(): string {\r\n  return `\r\n    <div class=\"dev-section\">\r\n      <h4>Console Logs</h4>\r\n      <p class=\"text-muted\">Open browser DevTools (F12) to view console logs.</p>\r\n      <div class=\"dev-actions\">\r\n        <button class=\"btn btn-secondary btn-sm\" data-action=\"clear-console\">Clear Console</button>\r\n        <button class=\"btn btn-secondary btn-sm\" data-action=\"log-state\">Log State</button>\r\n      </div>\r\n    </div>\r\n    \r\n    <div class=\"dev-section\">\r\n      <h4>Performance</h4>\r\n      <table class=\"dev-table\">\r\n        <tr><td>Page Load</td><td>${Math.round(performance.now())}ms</td></tr>\r\n        <tr><td>Memory</td><td>${getMemoryUsage()}</td></tr>\r\n      </table>\r\n    </div>\r\n  `;\r\n}\r\n\r\n/**\r\n * Render cache tab\r\n */\r\nfunction renderCacheTab(): string {\r\n  const keys = Object.keys(localStorage);\r\n  const totalSize = keys.reduce((acc, key) => acc + (localStorage.getItem(key)?.length || 0), 0);\r\n\r\n  return `\r\n    <div class=\"dev-section\">\r\n      <h4>LocalStorage</h4>\r\n      <p>Items: ${keys.length} | Size: ${formatBytes(totalSize * 2)}</p>\r\n      <div class=\"dev-actions\">\r\n        <button class=\"btn btn-danger btn-sm\" data-action=\"clear-storage\">Clear All Storage</button>\r\n        <button class=\"btn btn-secondary btn-sm\" data-action=\"export-storage\">Export Storage</button>\r\n      </div>\r\n      <div class=\"storage-list\">\r\n        ${keys.map(key => `\r\n          <div class=\"storage-item\">\r\n            <span class=\"storage-key\">${key}</span>\r\n            <span class=\"storage-size\">${formatBytes((localStorage.getItem(key)?.length || 0) * 2)}</span>\r\n            <button class=\"btn-sm btn-danger\" data-action=\"delete-key\" data-key=\"${key}\"></button>\r\n          </div>\r\n        `).join('')}\r\n      </div>\r\n    </div>\r\n  `;\r\n}\r\n\r\n/**\r\n * Render API tab\r\n */\r\nfunction renderApiTab(): string {\r\n  return `\r\n    <div class=\"dev-section\">\r\n      <h4>API Test</h4>\r\n      <div class=\"form-group\">\r\n        <label>Endpoint</label>\r\n        <div class=\"input-group\">\r\n          <select id=\"api-method\" class=\"form-control api-method-select\">\r\n            <option value=\"GET\">GET</option>\r\n            <option value=\"POST\">POST</option>\r\n            <option value=\"PUT\">PUT</option>\r\n            <option value=\"DELETE\">DELETE</option>\r\n          </select>\r\n          <input type=\"text\" id=\"api-endpoint\" class=\"form-control\" value=\"/api/health\" placeholder=\"/api/...\">\r\n        </div>\r\n      </div>\r\n      <div class=\"form-group\">\r\n        <label>Body (JSON)</label>\r\n        <textarea id=\"api-body\" class=\"form-control\" rows=\"3\" placeholder='{\"key\": \"value\"}'></textarea>\r\n      </div>\r\n      <button class=\"btn btn-primary\" data-action=\"test-api\">Send Request</button>\r\n    </div>\r\n    \r\n    <div class=\"dev-section\">\r\n      <h4>Response</h4>\r\n      <pre id=\"api-response\" class=\"code-block\">No request sent yet</pre>\r\n    </div>\r\n  `;\r\n}\r\n\r\n/**\r\n * Bind action handlers\r\n */\r\nfunction bindActions(container: HTMLElement): void {\r\n  container.querySelectorAll('[data-action]').forEach(el => {\r\n    const action = el.getAttribute('data-action');\r\n\r\n    on(el as HTMLElement, 'click', async () => {\r\n      switch (action) {\r\n        case 'clear-console':\r\n          console.clear();\r\n          toast.success('Console cleared');\r\n          break;\r\n\r\n        case 'log-state':\r\n          console.group('Application State');\r\n          console.log('App:', appStore.getState());\r\n          console.log('Data:', dataStore.getState());\r\n          console.log('UI:', uiStore.getState());\r\n          console.groupEnd();\r\n          toast.success('State logged to console');\r\n          break;\r\n\r\n        case 'clear-storage':\r\n          localStorage.clear();\r\n          toast.success('Storage cleared');\r\n          location.reload();\r\n          break;\r\n\r\n        case 'export-storage':\r\n          const data = { ...localStorage };\r\n          const blob = new Blob([JSON.stringify(data, null, 2)], { type: 'application/json' });\r\n          const url = URL.createObjectURL(blob);\r\n          const a = document.createElement('a');\r\n          a.href = url;\r\n          a.download = 'localstorage-backup.json';\r\n          a.click();\r\n          toast.success('Storage exported');\r\n          break;\r\n\r\n        case 'delete-key':\r\n          const key = el.getAttribute('data-key');\r\n          if (key) {\r\n            localStorage.removeItem(key);\r\n            toast.success(`Removed: ${key}`);\r\n            showDeveloperModal(); // Refresh\r\n          }\r\n          break;\r\n\r\n        case 'test-api':\r\n          await testApi(container);\r\n          break;\r\n      }\r\n    });\r\n  });\r\n}\r\n\r\n/**\r\n * Test API endpoint\r\n */\r\nasync function testApi(container: HTMLElement): Promise<void> {\r\n  const method = (container.querySelector('#api-method') as HTMLSelectElement).value;\r\n  const endpoint = (container.querySelector('#api-endpoint') as HTMLInputElement).value;\r\n  const bodyText = (container.querySelector('#api-body') as HTMLTextAreaElement).value;\r\n  const responseEl = container.querySelector('#api-response') as HTMLPreElement;\r\n\r\n  responseEl.textContent = 'Loading...';\r\n\r\n  try {\r\n    const options: RequestInit = { method };\r\n    if (bodyText && method !== 'GET') {\r\n      options.body = bodyText;\r\n      options.headers = { 'Content-Type': 'application/json' };\r\n    }\r\n\r\n    const start = performance.now();\r\n    const response = await fetchWithProject(endpoint, options);\r\n    const elapsed = Math.round(performance.now() - start);\r\n    const data = await response.json().catch(() => response.text());\r\n\r\n    responseEl.textContent = `Status: ${response.status} (${elapsed}ms)\\n\\n${JSON.stringify(data, null, 2)}`;\r\n  } catch (error) {\r\n    responseEl.textContent = `Error: ${error instanceof Error ? error.message : 'Unknown error'}`;\r\n  }\r\n}\r\n\r\n/**\r\n * Get memory usage\r\n */\r\nfunction getMemoryUsage(): string {\r\n  const perf = performance as Performance & { memory?: { usedJSHeapSize: number } };\r\n  if (perf.memory) {\r\n    return formatBytes(perf.memory.usedJSHeapSize);\r\n  }\r\n  return 'N/A';\r\n}\r\n\r\n/**\r\n * Format bytes\r\n */\r\nfunction formatBytes(bytes: number): string {\r\n  if (bytes === 0) return '0 B';\r\n  const k = 1024;\r\n  const sizes = ['B', 'KB', 'MB', 'GB'];\r\n  const i = Math.floor(Math.log(bytes) / Math.log(k));\r\n  return parseFloat((bytes / Math.pow(k, i)).toFixed(1)) + ' ' + sizes[i];\r\n}\r\n\r\nexport default showDeveloperModal;\r\n","/**\r\n * Shortcuts Modal Component\r\n * Display keyboard shortcuts reference\r\n */\r\n\r\nimport { createElement, on } from '@lib/dom';\r\nimport { createModal, openModal, closeModal } from '@components/Modal';\r\nimport { shortcuts } from '@services/shortcuts';\r\n\r\nconst MODAL_ID = 'shortcuts-modal';\r\n\r\ninterface ShortcutGroup {\r\n  title: string;\r\n  shortcuts: Array<{\r\n    keys: string[];\r\n    description: string;\r\n  }>;\r\n}\r\n\r\nconst shortcutGroups: ShortcutGroup[] = [\r\n  {\r\n    title: 'General',\r\n    shortcuts: [\r\n      { keys: ['Ctrl', 'Z'], description: 'Undo last action' },\r\n      { keys: ['Ctrl', 'Shift', 'Z'], description: 'Redo' },\r\n      { keys: ['Ctrl', 'S'], description: 'Save current item' },\r\n      { keys: ['Esc'], description: 'Close modal / Cancel' },\r\n      { keys: ['?'], description: 'Show this help' },\r\n    ],\r\n  },\r\n  {\r\n    title: 'Navigation',\r\n    shortcuts: [\r\n      { keys: ['Ctrl', '1'], description: 'Go to Dashboard' },\r\n      { keys: ['Ctrl', '2'], description: 'Go to Chat' },\r\n      { keys: ['Ctrl', '3'], description: 'Go to Source of Truth' },\r\n      { keys: ['Ctrl', '4'], description: 'Go to Timeline' },\r\n      { keys: ['Ctrl', '5'], description: 'Go to Contacts' },\r\n    ],\r\n  },\r\n  {\r\n    title: 'Actions',\r\n    shortcuts: [\r\n      { keys: ['Ctrl', 'K'], description: 'Quick search' },\r\n      { keys: ['Ctrl', 'N'], description: 'New item' },\r\n      { keys: ['Ctrl', 'E'], description: 'Export data' },\r\n      { keys: ['Ctrl', 'Shift', 'T'], description: 'Toggle theme' },\r\n    ],\r\n  },\r\n  {\r\n    title: 'Chat',\r\n    shortcuts: [\r\n      { keys: ['Enter'], description: 'Send message' },\r\n      { keys: ['Shift', 'Enter'], description: 'New line' },\r\n      { keys: [''], description: 'Previous message' },\r\n    ],\r\n  },\r\n];\r\n\r\n/**\r\n * Show shortcuts modal\r\n */\r\nexport function showShortcutsModal(): void {\r\n  // Remove existing modal\r\n  const existing = document.querySelector(`[data-modal-id=\"${MODAL_ID}\"]`);\r\n  if (existing) existing.remove();\r\n\r\n  const content = createElement('div', { className: 'shortcuts-modal-content' });\r\n\r\n  // Get registered shortcuts from service\r\n  const registeredShortcuts = shortcuts.getAll();\r\n\r\n  content.innerHTML = `\r\n    <div class=\"shortcuts-grid\">\r\n      ${shortcutGroups.map(group => `\r\n        <div class=\"shortcut-group\">\r\n          <h4>${group.title}</h4>\r\n          <div class=\"shortcut-list\">\r\n            ${group.shortcuts.map(s => `\r\n              <div class=\"shortcut-item\">\r\n                <div class=\"shortcut-keys\">\r\n                  ${s.keys.map(k => `<kbd>${k}</kbd>`).join(' + ')}\r\n                </div>\r\n                <div class=\"shortcut-desc\">${s.description}</div>\r\n              </div>\r\n            `).join('')}\r\n          </div>\r\n        </div>\r\n      `).join('')}\r\n    </div>\r\n    \r\n    ${registeredShortcuts.length > 0 ? `\r\n      <div class=\"shortcuts-custom\">\r\n        <h4>Active Shortcuts</h4>\r\n        <div class=\"shortcut-list\">\r\n          ${registeredShortcuts.map(s => {\r\n    const keys: string[] = [];\r\n    if (s.ctrl) keys.push('Ctrl');\r\n    if (s.shift) keys.push('Shift');\r\n    if (s.alt) keys.push('Alt');\r\n    if (s.meta) keys.push('Cmd');\r\n    keys.push(s.key.toUpperCase());\r\n\r\n    return `\r\n              <div class=\"shortcut-item\">\r\n                <div class=\"shortcut-keys\">\r\n                  ${keys.map(k => `<kbd>${k}</kbd>`).join(' + ')}\r\n                </div>\r\n                <div class=\"shortcut-desc\">${s.description}</div>\r\n              </div>\r\n            `;\r\n  }).join('')}\r\n        </div>\r\n      </div>\r\n    ` : ''}\r\n    \r\n    <div class=\"shortcuts-tip\">\r\n      <p class=\"text-muted\">\r\n         Tip: Most shortcuts use Ctrl on Windows/Linux or Cmd on Mac.\r\n      </p>\r\n    </div>\r\n  `;\r\n\r\n  // Footer\r\n  const footer = createElement('div', { className: 'modal-footer' });\r\n\r\n  const closeBtn = createElement('button', {\r\n    className: 'btn btn-primary',\r\n    textContent: 'Got it',\r\n  });\r\n\r\n  on(closeBtn, 'click', () => closeModal(MODAL_ID));\r\n  footer.appendChild(closeBtn);\r\n\r\n  // Create modal\r\n  const modal = createModal({\r\n    id: MODAL_ID,\r\n    title: 'Keyboard Shortcuts',\r\n    content,\r\n    size: 'lg',\r\n    footer,\r\n  });\r\n\r\n  document.body.appendChild(modal);\r\n  openModal(MODAL_ID);\r\n}\r\n\r\nexport default showShortcutsModal;\r\n","/**\r\n * Notifications Modal Component\r\n * Display and manage notifications\r\n */\r\n\r\nimport { createElement, on, addClass, removeClass } from '@lib/dom';\r\nimport { createModal, openModal, closeModal } from '@components/Modal';\r\nimport { http } from '@services/api';\r\nimport { toast } from '@services/toast';\r\nimport { formatRelativeTime } from '@lib/format';\r\n\r\nconst MODAL_ID = 'notifications-modal';\r\n\r\nexport interface Notification {\r\n  id: string;\r\n  type: 'info' | 'success' | 'warning' | 'error' | 'mention' | 'update';\r\n  title: string;\r\n  message: string;\r\n  read: boolean;\r\n  createdAt: string;\r\n  link?: string;\r\n  actor?: {\r\n    name: string;\r\n    avatar?: string;\r\n  };\r\n}\r\n\r\nexport interface NotificationsModalProps {\r\n  onMarkAllRead?: () => void;\r\n  onNotificationClick?: (notification: Notification) => void;\r\n}\r\n\r\nlet notifications: Notification[] = [];\r\nlet filter: 'all' | 'unread' = 'all';\r\n\r\n/**\r\n * Show notifications modal\r\n */\r\nexport async function showNotificationsModal(props: NotificationsModalProps = {}): Promise<void> {\r\n  filter = 'all';\r\n\r\n  // Remove existing modal\r\n  const existing = document.querySelector(`[data-modal-id=\"${MODAL_ID}\"]`);\r\n  if (existing) existing.remove();\r\n\r\n  const content = createElement('div', { className: 'notifications-modal-content' });\r\n  content.innerHTML = '<div class=\"loading\">Loading notifications...</div>';\r\n\r\n  // Footer\r\n  const footer = createElement('div', { className: 'modal-footer' });\r\n\r\n  const markAllBtn = createElement('button', {\r\n    className: 'btn btn-secondary',\r\n    textContent: 'Mark All Read',\r\n  });\r\n\r\n  const closeBtn = createElement('button', {\r\n    className: 'btn btn-primary',\r\n    textContent: 'Close',\r\n  });\r\n\r\n  on(markAllBtn, 'click', async () => {\r\n    try {\r\n      await http.post('/api/notifications/mark-all-read');\r\n      notifications.forEach(n => n.read = true);\r\n      render();\r\n      toast.success('All marked as read');\r\n      props.onMarkAllRead?.();\r\n    } catch {\r\n      // Error shown by API service\r\n    }\r\n  });\r\n\r\n  on(closeBtn, 'click', () => closeModal(MODAL_ID));\r\n\r\n  footer.appendChild(markAllBtn);\r\n  footer.appendChild(closeBtn);\r\n\r\n  // Create modal\r\n  const modal = createModal({\r\n    id: MODAL_ID,\r\n    title: 'Notifications',\r\n    content,\r\n    size: 'md',\r\n    footer,\r\n  });\r\n\r\n  document.body.appendChild(modal);\r\n  openModal(MODAL_ID);\r\n\r\n  // Load notifications\r\n  try {\r\n    const response = await http.get<Notification[]>('/api/notifications');\r\n    notifications = response.data;\r\n    render();\r\n  } catch {\r\n    content.innerHTML = '<div class=\"error\">Failed to load notifications</div>';\r\n  }\r\n\r\n  function render(): void {\r\n    const filtered = filter === 'unread'\r\n      ? notifications.filter(n => !n.read)\r\n      : notifications;\r\n\r\n    const unreadCount = notifications.filter(n => !n.read).length;\r\n\r\n    content.innerHTML = `\r\n      <div class=\"notifications-header\">\r\n        <div class=\"filter-tabs\">\r\n          <button class=\"filter-tab ${filter === 'all' ? 'active' : ''}\" data-filter=\"all\">\r\n            All (${notifications.length})\r\n          </button>\r\n          <button class=\"filter-tab ${filter === 'unread' ? 'active' : ''}\" data-filter=\"unread\">\r\n            Unread (${unreadCount})\r\n          </button>\r\n        </div>\r\n      </div>\r\n      \r\n      ${filtered.length === 0 ? `\r\n        <div class=\"empty-state\">\r\n          <span class=\"empty-icon\"></span>\r\n          <p>${filter === 'unread' ? 'No unread notifications' : 'No notifications yet'}</p>\r\n        </div>\r\n      ` : `\r\n        <div class=\"notifications-list\">\r\n          ${filtered.map(n => renderNotification(n)).join('')}\r\n        </div>\r\n      `}\r\n    `;\r\n\r\n    // Bind filter tabs\r\n    content.querySelectorAll('.filter-tab').forEach(tab => {\r\n      on(tab as HTMLElement, 'click', () => {\r\n        filter = tab.getAttribute('data-filter') as 'all' | 'unread';\r\n        render();\r\n      });\r\n    });\r\n\r\n    // Bind notification clicks\r\n    content.querySelectorAll('.notification-item').forEach(item => {\r\n      const id = item.getAttribute('data-notification-id');\r\n      const notification = notifications.find(n => n.id === id);\r\n\r\n      if (notification) {\r\n        on(item as HTMLElement, 'click', async () => {\r\n          // Mark as read\r\n          if (!notification.read) {\r\n            try {\r\n              await http.patch(`/api/notifications/${id}/read`);\r\n              notification.read = true;\r\n              removeClass(item as HTMLElement, 'unread');\r\n            } catch {\r\n              // Silent fail\r\n            }\r\n          }\r\n\r\n          props.onNotificationClick?.(notification);\r\n\r\n          // Navigate if link exists\r\n          if (notification.link) {\r\n            closeModal(MODAL_ID);\r\n            // Handle navigation\r\n          }\r\n        });\r\n      }\r\n    });\r\n  }\r\n}\r\n\r\n/**\r\n * Render single notification\r\n */\r\nfunction renderNotification(notification: Notification): string {\r\n  const icon = getNotificationIcon(notification.type);\r\n\r\n  return `\r\n    <div class=\"notification-item ${notification.read ? '' : 'unread'}\" \r\n         data-notification-id=\"${notification.id}\">\r\n      <div class=\"notification-icon ${notification.type}\">${icon}</div>\r\n      <div class=\"notification-content\">\r\n        <div class=\"notification-title\">${escapeHtml(notification.title)}</div>\r\n        <div class=\"notification-message\">${escapeHtml(notification.message)}</div>\r\n        <div class=\"notification-meta\">\r\n          ${notification.actor ? `<span class=\"notification-actor\">${escapeHtml(notification.actor.name)}</span>  ` : ''}\r\n          <span class=\"notification-time\">${formatRelativeTime(notification.createdAt)}</span>\r\n        </div>\r\n      </div>\r\n      ${!notification.read ? '<div class=\"notification-dot\"></div>' : ''}\r\n    </div>\r\n  `;\r\n}\r\n\r\n/**\r\n * Get icon for notification type\r\n */\r\nfunction getNotificationIcon(type: Notification['type']): string {\r\n  switch (type) {\r\n    case 'info': return '';\r\n    case 'success': return '';\r\n    case 'warning': return '';\r\n    case 'error': return '';\r\n    case 'mention': return '';\r\n    case 'update': return '';\r\n    default: return '';\r\n  }\r\n}\r\n\r\n/**\r\n * Escape HTML\r\n */\r\nfunction escapeHtml(text: string): string {\r\n  const div = document.createElement('div');\r\n  div.textContent = text;\r\n  return div.innerHTML;\r\n}\r\n\r\nexport default showNotificationsModal;\r\n","/**\r\n * Email Modal Component\r\n * View and compose emails\r\n */\r\n\r\nimport { createElement, on } from '@lib/dom';\r\nimport { createModal, openModal, closeModal } from '@components/Modal';\r\nimport { http } from '@services/api';\r\nimport { toast } from '@services/toast';\r\nimport { formatRelativeTime } from '@lib/format';\r\n\r\nconst MODAL_ID = 'email-modal';\r\n\r\nexport interface Email {\r\n  id: string;\r\n  from: { name: string; email: string };\r\n  to: Array<{ name: string; email: string }>;\r\n  cc?: Array<{ name: string; email: string }>;\r\n  subject: string;\r\n  body: string;\r\n  bodyHtml?: string;\r\n  date: string;\r\n  read: boolean;\r\n  attachments?: Array<{ name: string; size: number; type: string }>;\r\n  thread?: Email[];\r\n}\r\n\r\nexport interface EmailModalProps {\r\n  mode: 'view' | 'compose' | 'reply';\r\n  email?: Email;\r\n  onSend?: (email: Partial<Email>) => Promise<void>;\r\n}\r\n\r\n/**\r\n * Show email modal\r\n */\r\nexport function showEmailModal(props: EmailModalProps): void {\r\n  const { mode, email, onSend } = props;\r\n\r\n  // Remove existing modal\r\n  const existing = document.querySelector(`[data-modal-id=\"${MODAL_ID}\"]`);\r\n  if (existing) existing.remove();\r\n\r\n  const content = createElement('div', { className: 'email-modal-content' });\r\n\r\n  if (mode === 'view' && email) {\r\n    content.innerHTML = `\r\n      <div class=\"email-view\">\r\n        <div class=\"email-header\">\r\n          <div class=\"email-subject\">${escapeHtml(email.subject)}</div>\r\n          <div class=\"email-meta\">\r\n            <div class=\"email-from\">\r\n              <strong>${escapeHtml(email.from.name)}</strong>\r\n              <span class=\"text-muted\">&lt;${escapeHtml(email.from.email)}&gt;</span>\r\n            </div>\r\n            <div class=\"email-to\">\r\n              To: ${email.to.map(r => escapeHtml(r.name || r.email)).join(', ')}\r\n            </div>\r\n            ${email.cc?.length ? `\r\n              <div class=\"email-cc\">\r\n                Cc: ${email.cc.map(r => escapeHtml(r.name || r.email)).join(', ')}\r\n              </div>\r\n            ` : ''}\r\n            <div class=\"email-date\">${formatRelativeTime(email.date)}</div>\r\n          </div>\r\n        </div>\r\n        \r\n        <div class=\"email-body\">\r\n          ${email.bodyHtml || escapeHtml(email.body).replace(/\\n/g, '<br>')}\r\n        </div>\r\n        \r\n        ${email.attachments?.length ? `\r\n          <div class=\"email-attachments\">\r\n            <h4>Attachments (${email.attachments.length})</h4>\r\n            <div class=\"attachments-list\">\r\n              ${email.attachments.map(a => `\r\n                <div class=\"attachment-item\">\r\n                  <span class=\"attachment-icon\"></span>\r\n                  <span class=\"attachment-name\">${escapeHtml(a.name)}</span>\r\n                  <span class=\"attachment-size\">${formatBytes(a.size)}</span>\r\n                </div>\r\n              `).join('')}\r\n            </div>\r\n          </div>\r\n        ` : ''}\r\n        \r\n        ${email.thread?.length ? `\r\n          <div class=\"email-thread\">\r\n            <h4>Thread (${email.thread.length} messages)</h4>\r\n            ${email.thread.map(t => `\r\n              <div class=\"thread-message\">\r\n                <div class=\"thread-header\">\r\n                  <strong>${escapeHtml(t.from.name)}</strong>\r\n                  <span>${formatRelativeTime(t.date)}</span>\r\n                </div>\r\n                <div class=\"thread-preview\">${escapeHtml(t.body.slice(0, 100))}...</div>\r\n              </div>\r\n            `).join('')}\r\n          </div>\r\n        ` : ''}\r\n      </div>\r\n    `;\r\n  } else {\r\n    // Compose / Reply mode\r\n    const isReply = mode === 'reply' && email;\r\n    const replyTo = isReply ? email.from.email : '';\r\n    const replySubject = isReply ? `Re: ${email.subject}` : '';\r\n\r\n    content.innerHTML = `\r\n      <form id=\"email-form\" class=\"email-form\">\r\n        <div class=\"form-group\">\r\n          <label for=\"email-to\">To *</label>\r\n          <input type=\"text\" id=\"email-to\" required \r\n                 value=\"${replyTo}\" \r\n                 placeholder=\"recipient@example.com\">\r\n        </div>\r\n        \r\n        <div class=\"form-group\">\r\n          <label for=\"email-cc\">Cc</label>\r\n          <input type=\"text\" id=\"email-cc\" \r\n                 placeholder=\"cc@example.com\">\r\n        </div>\r\n        \r\n        <div class=\"form-group\">\r\n          <label for=\"email-subject\">Subject *</label>\r\n          <input type=\"text\" id=\"email-subject\" required \r\n                 value=\"${escapeHtml(replySubject)}\" \r\n                 placeholder=\"Email subject\">\r\n        </div>\r\n        \r\n        <div class=\"form-group\">\r\n          <label for=\"email-body\">Message *</label>\r\n          <textarea id=\"email-body\" rows=\"10\" required \r\n                    placeholder=\"Write your message...\">${isReply ? `\\n\\n---\\nOn ${email.date}, ${email.from.name} wrote:\\n${email.body}` : ''}</textarea>\r\n        </div>\r\n        \r\n        <div class=\"form-group\">\r\n          <label>Attachments</label>\r\n          <div class=\"attachment-dropzone\" id=\"attachment-zone\">\r\n            <span>Drop files here or click to attach</span>\r\n            <input type=\"file\" id=\"attachment-input\" multiple hidden>\r\n          </div>\r\n          <div id=\"attachments-preview\"></div>\r\n        </div>\r\n      </form>\r\n    `;\r\n\r\n    // Bind attachment zone\r\n    setTimeout(() => {\r\n      const zone = content.querySelector('#attachment-zone') as HTMLElement;\r\n      const input = content.querySelector('#attachment-input') as HTMLInputElement;\r\n\r\n      if (zone && input) {\r\n        on(zone, 'click', () => input.click());\r\n        on(input, 'change', () => {\r\n          // Handle file selection\r\n          if (input.files) {\r\n            const preview = content.querySelector('#attachments-preview') as HTMLElement;\r\n            preview.innerHTML = Array.from(input.files)\r\n              .map(f => `<div class=\"attachment-item\">${escapeHtml(f.name)}</div>`)\r\n              .join('');\r\n          }\r\n        });\r\n      }\r\n    }, 0);\r\n  }\r\n\r\n  // Footer\r\n  const footer = createElement('div', { className: 'modal-footer' });\r\n\r\n  if (mode === 'view') {\r\n    const replyBtn = createElement('button', {\r\n      className: 'btn btn-primary',\r\n      textContent: 'Reply',\r\n    });\r\n\r\n    const forwardBtn = createElement('button', {\r\n      className: 'btn btn-secondary',\r\n      textContent: 'Forward',\r\n    });\r\n\r\n    const closeBtn = createElement('button', {\r\n      className: 'btn btn-secondary',\r\n      textContent: 'Close',\r\n    });\r\n\r\n    on(replyBtn, 'click', () => {\r\n      closeModal(MODAL_ID);\r\n      showEmailModal({ ...props, mode: 'reply' });\r\n    });\r\n\r\n    on(forwardBtn, 'click', () => {\r\n      // Forward logic\r\n      toast.info('Forward not implemented');\r\n    });\r\n\r\n    on(closeBtn, 'click', () => closeModal(MODAL_ID));\r\n\r\n    footer.appendChild(closeBtn);\r\n    footer.appendChild(forwardBtn);\r\n    footer.appendChild(replyBtn);\r\n  } else {\r\n    const cancelBtn = createElement('button', {\r\n      className: 'btn btn-secondary',\r\n      textContent: 'Cancel',\r\n    });\r\n\r\n    const sendBtn = createElement('button', {\r\n      className: 'btn btn-primary',\r\n      textContent: 'Send',\r\n    });\r\n\r\n    on(cancelBtn, 'click', () => closeModal(MODAL_ID));\r\n\r\n    on(sendBtn, 'click', async () => {\r\n      const form = content.querySelector('#email-form') as HTMLFormElement;\r\n      if (!form.checkValidity()) {\r\n        form.reportValidity();\r\n        return;\r\n      }\r\n\r\n      const to = (content.querySelector('#email-to') as HTMLInputElement).value;\r\n      const cc = (content.querySelector('#email-cc') as HTMLInputElement).value;\r\n      const subject = (content.querySelector('#email-subject') as HTMLInputElement).value;\r\n      const body = (content.querySelector('#email-body') as HTMLTextAreaElement).value;\r\n\r\n      const emailData: Partial<Email> = {\r\n        to: to.split(',').map(e => ({ name: '', email: e.trim() })),\r\n        cc: cc ? cc.split(',').map(e => ({ name: '', email: e.trim() })) : undefined,\r\n        subject,\r\n        body,\r\n      };\r\n\r\n      sendBtn.disabled = true;\r\n      sendBtn.textContent = 'Sending...';\r\n\r\n      try {\r\n        if (onSend) {\r\n          await onSend(emailData);\r\n        } else {\r\n          await http.post('/api/emails/send', emailData);\r\n        }\r\n        toast.success('Email sent');\r\n        closeModal(MODAL_ID);\r\n      } catch {\r\n        // Error shown by API service\r\n      } finally {\r\n        sendBtn.disabled = false;\r\n        sendBtn.textContent = 'Send';\r\n      }\r\n    });\r\n\r\n    footer.appendChild(cancelBtn);\r\n    footer.appendChild(sendBtn);\r\n  }\r\n\r\n  // Create modal\r\n  const modal = createModal({\r\n    id: MODAL_ID,\r\n    title: mode === 'view' ? 'Email' : (mode === 'reply' ? 'Reply' : 'Compose Email'),\r\n    content,\r\n    size: 'lg',\r\n    footer,\r\n  });\r\n\r\n  document.body.appendChild(modal);\r\n  openModal(MODAL_ID);\r\n}\r\n\r\n/**\r\n * Format bytes\r\n */\r\nfunction formatBytes(bytes: number): string {\r\n  if (bytes === 0) return '0 B';\r\n  const k = 1024;\r\n  const sizes = ['B', 'KB', 'MB'];\r\n  const i = Math.floor(Math.log(bytes) / Math.log(k));\r\n  return parseFloat((bytes / Math.pow(k, i)).toFixed(1)) + ' ' + sizes[i];\r\n}\r\n\r\n/**\r\n * Escape HTML\r\n */\r\nfunction escapeHtml(text: string): string {\r\n  const div = document.createElement('div');\r\n  div.textContent = text;\r\n  return div.innerHTML;\r\n}\r\n\r\nexport default showEmailModal;\r\n","/**\r\n * Charts Store\r\n * Chart instances and visualization state\r\n */\r\n\r\nimport type { Chart } from 'chart.js';\r\n\r\n// Types\r\nexport interface ChartInstance {\r\n  id: string;\r\n  chart: Chart | null;\r\n  container: string;\r\n  type: 'bar' | 'line' | 'pie' | 'doughnut' | 'radar';\r\n}\r\n\r\nexport interface NetworkInstance {\r\n  id: string;\r\n  network: unknown | null;\r\n  container: string;\r\n}\r\n\r\nexport interface ChartsState {\r\n  charts: Map<string, ChartInstance>;\r\n  networks: Map<string, NetworkInstance>;\r\n  activeChart: string | null;\r\n}\r\n\r\n// State\r\nconst state: ChartsState = {\r\n  charts: new Map(),\r\n  networks: new Map(),\r\n  activeChart: null,\r\n};\r\n\r\n// Listeners\r\nconst listeners: Set<() => void> = new Set();\r\n\r\n/**\r\n * Notify listeners\r\n */\r\nfunction notify(): void {\r\n  listeners.forEach(fn => fn());\r\n}\r\n\r\n/**\r\n * Register a chart instance\r\n */\r\nexport function registerChart(id: string, chart: Chart, container: string, type: ChartInstance['type']): void {\r\n  state.charts.set(id, { id, chart, container, type });\r\n  notify();\r\n}\r\n\r\n/**\r\n * Get a chart instance\r\n */\r\nexport function getChart(id: string): Chart | null {\r\n  return state.charts.get(id)?.chart ?? null;\r\n}\r\n\r\n/**\r\n * Destroy and remove a chart\r\n */\r\nexport function destroyChart(id: string): void {\r\n  const instance = state.charts.get(id);\r\n  if (instance?.chart) {\r\n    instance.chart.destroy();\r\n  }\r\n  state.charts.delete(id);\r\n  notify();\r\n}\r\n\r\n/**\r\n * Update chart data\r\n */\r\nexport function updateChartData(id: string, data: unknown): void {\r\n  const instance = state.charts.get(id);\r\n  if (instance?.chart) {\r\n    instance.chart.data = data as Chart['data'];\r\n    instance.chart.update();\r\n  }\r\n}\r\n\r\n/**\r\n * Register a network visualization\r\n */\r\nexport function registerNetwork(id: string, network: unknown, container: string): void {\r\n  state.networks.set(id, { id, network, container });\r\n  notify();\r\n}\r\n\r\n/**\r\n * Get a network instance\r\n */\r\nexport function getNetwork(id: string): unknown | null {\r\n  return state.networks.get(id)?.network ?? null;\r\n}\r\n\r\n/**\r\n * Destroy and remove a network\r\n */\r\nexport function destroyNetwork(id: string): void {\r\n  const instance = state.networks.get(id);\r\n  if (instance?.network && typeof (instance.network as { destroy?: () => void }).destroy === 'function') {\r\n    (instance.network as { destroy: () => void }).destroy();\r\n  }\r\n  state.networks.delete(id);\r\n  notify();\r\n}\r\n\r\n/**\r\n * Set active chart for highlighting\r\n */\r\nexport function setActiveChart(id: string | null): void {\r\n  state.activeChart = id;\r\n  notify();\r\n}\r\n\r\n/**\r\n * Get all chart IDs\r\n */\r\nexport function getChartIds(): string[] {\r\n  return Array.from(state.charts.keys());\r\n}\r\n\r\n/**\r\n * Get all network IDs\r\n */\r\nexport function getNetworkIds(): string[] {\r\n  return Array.from(state.networks.keys());\r\n}\r\n\r\n/**\r\n * Destroy all charts and networks\r\n */\r\nexport function destroyAll(): void {\r\n  state.charts.forEach((instance) => {\r\n    if (instance.chart) {\r\n      instance.chart.destroy();\r\n    }\r\n  });\r\n  state.networks.forEach((instance) => {\r\n    if (instance.network && typeof (instance.network as { destroy?: () => void }).destroy === 'function') {\r\n      (instance.network as { destroy: () => void }).destroy();\r\n    }\r\n  });\r\n  state.charts.clear();\r\n  state.networks.clear();\r\n  state.activeChart = null;\r\n  notify();\r\n}\r\n\r\n/**\r\n * Subscribe to changes\r\n */\r\nexport function subscribe(callback: () => void): () => void {\r\n  listeners.add(callback);\r\n  return () => listeners.delete(callback);\r\n}\r\n\r\n// Export as namespace\r\nexport const chartsStore = {\r\n  registerChart,\r\n  getChart,\r\n  destroyChart,\r\n  updateChartData,\r\n  registerNetwork,\r\n  getNetwork,\r\n  destroyNetwork,\r\n  setActiveChart,\r\n  getChartIds,\r\n  getNetworkIds,\r\n  destroyAll,\r\n  subscribe,\r\n};\r\n","/**\r\n * Graph Modal Component\r\n * Display graph/network visualizations\r\n */\r\n\r\nimport { createElement, on } from '@lib/dom';\r\nimport { createModal, openModal, closeModal } from '@components/Modal';\r\nimport { chartsStore } from '@stores/charts';\r\n\r\nconst MODAL_ID = 'graph-modal';\r\n\r\nexport interface GraphNode {\r\n  id: string;\r\n  label: string;\r\n  type?: string;\r\n  color?: string;\r\n  size?: number;\r\n  data?: Record<string, unknown>;\r\n}\r\n\r\nexport interface GraphEdge {\r\n  id: string;\r\n  from: string;\r\n  to: string;\r\n  label?: string;\r\n  type?: string;\r\n  color?: string;\r\n}\r\n\r\nexport interface GraphModalProps {\r\n  title?: string;\r\n  nodes: GraphNode[];\r\n  edges: GraphEdge[];\r\n  onNodeClick?: (node: GraphNode) => void;\r\n  onEdgeClick?: (edge: GraphEdge) => void;\r\n}\r\n\r\n/**\r\n * Show graph modal\r\n */\r\nexport function showGraphModal(props: GraphModalProps): void {\r\n  const { title = 'Graph View', nodes, edges, onNodeClick, onEdgeClick } = props;\r\n\r\n  // Remove existing modal\r\n  const existing = document.querySelector(`[data-modal-id=\"${MODAL_ID}\"]`);\r\n  if (existing) existing.remove();\r\n\r\n  const content = createElement('div', { className: 'graph-modal-content' });\r\n\r\n  content.innerHTML = `\r\n    <div class=\"graph-toolbar\">\r\n      <div class=\"graph-info\">\r\n        <span>Nodes: ${nodes.length}</span>\r\n        <span>Edges: ${edges.length}</span>\r\n      </div>\r\n      <div class=\"graph-controls\">\r\n        <button class=\"btn btn-sm btn-secondary\" data-action=\"zoom-in\" title=\"Zoom In\">+</button>\r\n        <button class=\"btn btn-sm btn-secondary\" data-action=\"zoom-out\" title=\"Zoom Out\"></button>\r\n        <button class=\"btn btn-sm btn-secondary\" data-action=\"fit\" title=\"Fit to View\"></button>\r\n        <button class=\"btn btn-sm btn-secondary\" data-action=\"fullscreen\" title=\"Fullscreen\"></button>\r\n      </div>\r\n    </div>\r\n    <div id=\"graph-container\" class=\"graph-container\">\r\n      <div class=\"graph-placeholder\">\r\n        <p>Loading graph visualization...</p>\r\n        <p class=\"text-muted\">Requires vis-network library</p>\r\n      </div>\r\n    </div>\r\n    <div class=\"graph-legend\">\r\n      ${getUniqueTypes(nodes).map(type => `\r\n        <span class=\"legend-item\">\r\n          <span class=\"legend-color\" style=\"--legend-color: ${getTypeColor(type)}\"></span>\r\n          ${type}\r\n        </span>\r\n      `).join('')}\r\n    </div>\r\n  `;\r\n\r\n  // Footer\r\n  const footer = createElement('div', { className: 'modal-footer' });\r\n\r\n  const exportBtn = createElement('button', {\r\n    className: 'btn btn-secondary',\r\n    textContent: 'Export Image',\r\n  });\r\n\r\n  const closeBtn = createElement('button', {\r\n    className: 'btn btn-primary',\r\n    textContent: 'Close',\r\n  });\r\n\r\n  on(exportBtn, 'click', () => {\r\n    // Export graph as image\r\n    const canvas = content.querySelector('canvas') as HTMLCanvasElement;\r\n    if (canvas) {\r\n      const link = document.createElement('a');\r\n      link.download = 'graph.png';\r\n      link.href = canvas.toDataURL();\r\n      link.click();\r\n    } else {\r\n      toast.warning('Graph not rendered');\r\n    }\r\n  });\r\n\r\n  on(closeBtn, 'click', () => {\r\n    // Destroy network before closing\r\n    chartsStore.destroyNetwork('modal-graph');\r\n    closeModal(MODAL_ID);\r\n  });\r\n\r\n  footer.appendChild(exportBtn);\r\n  footer.appendChild(closeBtn);\r\n\r\n  // Create modal\r\n  const modal = createModal({\r\n    id: MODAL_ID,\r\n    title,\r\n    content,\r\n    size: 'xl',\r\n    footer,\r\n  });\r\n\r\n  document.body.appendChild(modal);\r\n  openModal(MODAL_ID);\r\n\r\n  // Initialize graph after modal is visible\r\n  setTimeout(() => {\r\n    initializeGraph(content, nodes, edges, onNodeClick, onEdgeClick);\r\n    bindControls(content);\r\n  }, 100);\r\n}\r\n\r\n/**\r\n * Initialize graph visualization\r\n */\r\nfunction initializeGraph(\r\n  container: HTMLElement,\r\n  nodes: GraphNode[],\r\n  edges: GraphEdge[],\r\n  onNodeClick?: (node: GraphNode) => void,\r\n  onEdgeClick?: (edge: GraphEdge) => void\r\n): void {\r\n  const graphContainer = container.querySelector('#graph-container') as HTMLElement;\r\n\r\n  // Check if vis-network is available\r\n  if (typeof (window as unknown as { vis?: unknown }).vis === 'undefined') {\r\n    graphContainer.innerHTML = `\r\n      <div class=\"graph-fallback\">\r\n        <h4>Graph Data</h4>\r\n        <div class=\"graph-data\">\r\n          <strong>Nodes (${nodes.length}):</strong>\r\n          <ul>${nodes.slice(0, 10).map(n => `<li>${n.label} (${n.type || 'default'})</li>`).join('')}</ul>\r\n          ${nodes.length > 10 ? `<p class=\"text-muted\">...and ${nodes.length - 10} more</p>` : ''}\r\n        </div>\r\n        <div class=\"graph-data\">\r\n          <strong>Edges (${edges.length}):</strong>\r\n          <ul>${edges.slice(0, 10).map(e => `<li>${e.from}  ${e.to}${e.label ? ` (${e.label})` : ''}</li>`).join('')}</ul>\r\n          ${edges.length > 10 ? `<p class=\"text-muted\">...and ${edges.length - 10} more</p>` : ''}\r\n        </div>\r\n        <p class=\"text-muted\"><em>vis-network library not loaded</em></p>\r\n      </div>\r\n    `;\r\n    return;\r\n  }\r\n\r\n  const vis = (window as unknown as { vis: typeof import('vis-network') }).vis;\r\n\r\n  // Prepare data\r\n  const visNodes = new vis.DataSet(\r\n    nodes.map(n => ({\r\n      id: n.id,\r\n      label: n.label,\r\n      color: n.color || getTypeColor(n.type),\r\n      size: n.size || 20,\r\n    }))\r\n  );\r\n\r\n  const visEdges = new vis.DataSet(\r\n    edges.map(e => ({\r\n      id: e.id,\r\n      from: e.from,\r\n      to: e.to,\r\n      label: e.label,\r\n      color: e.color,\r\n    }))\r\n  );\r\n\r\n  const options = {\r\n    nodes: {\r\n      shape: 'dot',\r\n      font: { color: '#eaeaea', size: 12 },\r\n      borderWidth: 2,\r\n    },\r\n    edges: {\r\n      arrows: 'to',\r\n      color: { color: '#2a2a4a', highlight: '#e94560' },\r\n      font: { color: '#a0a0a0', size: 10 },\r\n    },\r\n    physics: {\r\n      enabled: true,\r\n      stabilization: { iterations: 100 },\r\n    },\r\n    interaction: {\r\n      hover: true,\r\n      tooltipDelay: 200,\r\n    },\r\n  };\r\n\r\n  graphContainer.innerHTML = '';\r\n  const network = new vis.Network(graphContainer, { nodes: visNodes, edges: visEdges }, options);\r\n\r\n  // Store reference\r\n  chartsStore.registerNetwork('modal-graph', network, '#graph-container');\r\n\r\n  // Bind events\r\n  if (onNodeClick) {\r\n    network.on('click', (params: { nodes: string[] }) => {\r\n      if (params.nodes.length > 0) {\r\n        const node = nodes.find(n => n.id === params.nodes[0]);\r\n        if (node) onNodeClick(node);\r\n      }\r\n    });\r\n  }\r\n\r\n  if (onEdgeClick) {\r\n    network.on('click', (params: { edges: string[] }) => {\r\n      if (params.edges.length > 0) {\r\n        const edge = edges.find(e => e.id === params.edges[0]);\r\n        if (edge) onEdgeClick(edge);\r\n      }\r\n    });\r\n  }\r\n}\r\n\r\n/**\r\n * Bind control buttons\r\n */\r\nfunction bindControls(container: HTMLElement): void {\r\n  const network = chartsStore.getNetwork('modal-graph') as {\r\n    moveTo?: (options: object) => void;\r\n    fit?: () => void;\r\n  } | null;\r\n\r\n  if (!network) return;\r\n\r\n  container.querySelectorAll('[data-action]').forEach(btn => {\r\n    on(btn as HTMLElement, 'click', () => {\r\n      const action = btn.getAttribute('data-action');\r\n\r\n      switch (action) {\r\n        case 'zoom-in':\r\n          network.moveTo?.({ scale: 1.2 });\r\n          break;\r\n        case 'zoom-out':\r\n          network.moveTo?.({ scale: 0.8 });\r\n          break;\r\n        case 'fit':\r\n          network.fit?.();\r\n          break;\r\n        case 'fullscreen':\r\n          const graphContainer = container.querySelector('.graph-container') as HTMLElement;\r\n          if (graphContainer) {\r\n            graphContainer.requestFullscreen?.();\r\n          }\r\n          break;\r\n      }\r\n    });\r\n  });\r\n}\r\n\r\n/**\r\n * Get unique node types\r\n */\r\nfunction getUniqueTypes(nodes: GraphNode[]): string[] {\r\n  const types = new Set(nodes.map(n => n.type || 'default'));\r\n  return Array.from(types);\r\n}\r\n\r\n/**\r\n * Get color for type\r\n */\r\nfunction getTypeColor(type?: string): string {\r\n  const colors: Record<string, string> = {\r\n    person: '#4ecdc4',\r\n    organization: '#e94560',\r\n    document: '#ffe66d',\r\n    event: '#ff6b6b',\r\n    location: '#45b7d1',\r\n    default: '#a0a0a0',\r\n  };\r\n  return colors[type || 'default'] || colors.default;\r\n}\r\n\r\n// Toast import for export feedback\r\nimport { toast } from '@services/toast';\r\n\r\nexport default showGraphModal;\r\n","/**\r\n * History Modal Component\r\n * Display change history / audit log\r\n */\r\n\r\nimport { createElement, on } from '@lib/dom';\r\nimport { createModal, openModal, closeModal } from '@components/Modal';\r\nimport { http } from '@services/api';\r\nimport { formatRelativeTime } from '@lib/format';\r\n\r\nconst MODAL_ID = 'history-modal';\r\n\r\nexport interface HistoryEntry {\r\n  id: string;\r\n  action: 'create' | 'update' | 'delete' | 'restore';\r\n  entityType: string;\r\n  entityId: string;\r\n  entityName?: string;\r\n  changes?: Record<string, { old: unknown; new: unknown }>;\r\n  actor: {\r\n    id: string;\r\n    name: string;\r\n    email?: string;\r\n  };\r\n  timestamp: string;\r\n  metadata?: Record<string, unknown>;\r\n}\r\n\r\nexport interface HistoryModalProps {\r\n  entityType?: string;\r\n  entityId?: string;\r\n  title?: string;\r\n  onRestore?: (entry: HistoryEntry) => void;\r\n}\r\n\r\nlet entries: HistoryEntry[] = [];\r\nlet page = 1;\r\nlet hasMore = true;\r\nlet loading = false;\r\n\r\n/**\r\n * Show history modal\r\n */\r\nexport async function showHistoryModal(props: HistoryModalProps = {}): Promise<void> {\r\n  const { entityType, entityId, title = 'History', onRestore } = props;\r\n\r\n  entries = [];\r\n  page = 1;\r\n  hasMore = true;\r\n\r\n  // Remove existing modal\r\n  const existing = document.querySelector(`[data-modal-id=\"${MODAL_ID}\"]`);\r\n  if (existing) existing.remove();\r\n\r\n  const content = createElement('div', { className: 'history-modal-content' });\r\n  content.innerHTML = '<div class=\"loading\">Loading history...</div>';\r\n\r\n  // Footer\r\n  const footer = createElement('div', { className: 'modal-footer' });\r\n\r\n  const closeBtn = createElement('button', {\r\n    className: 'btn btn-primary',\r\n    textContent: 'Close',\r\n  });\r\n\r\n  on(closeBtn, 'click', () => closeModal(MODAL_ID));\r\n  footer.appendChild(closeBtn);\r\n\r\n  // Create modal\r\n  const modal = createModal({\r\n    id: MODAL_ID,\r\n    title,\r\n    content,\r\n    size: 'lg',\r\n    footer,\r\n  });\r\n\r\n  document.body.appendChild(modal);\r\n  openModal(MODAL_ID);\r\n\r\n  // Load initial data\r\n  await loadHistory(content, entityType, entityId, onRestore);\r\n}\r\n\r\n/**\r\n * Load history entries\r\n */\r\nasync function loadHistory(\r\n  container: HTMLElement,\r\n  entityType?: string,\r\n  entityId?: string,\r\n  onRestore?: (entry: HistoryEntry) => void\r\n): Promise<void> {\r\n  if (loading || !hasMore) return;\r\n\r\n  loading = true;\r\n\r\n  try {\r\n    const params = new URLSearchParams({ page: String(page), limit: '20' });\r\n    if (entityType) params.set('entityType', entityType);\r\n    if (entityId) params.set('entityId', entityId);\r\n\r\n    const response = await http.get<{ entries: HistoryEntry[]; hasMore: boolean }>(\r\n      `/api/history?${params}`\r\n    );\r\n\r\n    entries = [...entries, ...response.data.entries];\r\n    hasMore = response.data.hasMore;\r\n    page++;\r\n\r\n    render(container, onRestore);\r\n  } catch {\r\n    container.innerHTML = '<div class=\"error\">Failed to load history</div>';\r\n  } finally {\r\n    loading = false;\r\n  }\r\n}\r\n\r\n/**\r\n * Render history\r\n */\r\nfunction render(container: HTMLElement, onRestore?: (entry: HistoryEntry) => void): void {\r\n  if (entries.length === 0) {\r\n    container.innerHTML = `\r\n      <div class=\"empty-state\">\r\n        <span class=\"empty-icon\"></span>\r\n        <p>No history entries</p>\r\n      </div>\r\n    `;\r\n    return;\r\n  }\r\n\r\n  // Group by date\r\n  const grouped = groupByDate(entries);\r\n\r\n  container.innerHTML = `\r\n    <div class=\"history-timeline\">\r\n      ${Object.entries(grouped).map(([date, items]) => `\r\n        <div class=\"history-date-group\">\r\n          <div class=\"history-date\">${date}</div>\r\n          ${items.map(entry => renderEntry(entry)).join('')}\r\n        </div>\r\n      `).join('')}\r\n    </div>\r\n    ${hasMore ? `\r\n      <div class=\"history-load-more\">\r\n        <button class=\"btn btn-secondary\" data-action=\"load-more\">Load More</button>\r\n      </div>\r\n    ` : ''}\r\n  `;\r\n\r\n  // Bind load more\r\n  const loadMoreBtn = container.querySelector('[data-action=\"load-more\"]');\r\n  if (loadMoreBtn) {\r\n    on(loadMoreBtn as HTMLElement, 'click', async () => {\r\n      await loadHistory(container, undefined, undefined, onRestore);\r\n    });\r\n  }\r\n\r\n  // Bind restore buttons\r\n  if (onRestore) {\r\n    container.querySelectorAll('[data-action=\"restore\"]').forEach(btn => {\r\n      on(btn as HTMLElement, 'click', async () => {\r\n        const entryId = btn.getAttribute('data-entry-id');\r\n        const entry = entries.find(e => e.id === entryId);\r\n        if (entry) {\r\n          const { confirm } = await import('@components/Modal');\r\n          const confirmed = await confirm(\r\n            'Are you sure you want to restore this version?',\r\n            { title: 'Restore', confirmText: 'Restore' }\r\n          );\r\n          if (confirmed) {\r\n            onRestore(entry);\r\n          }\r\n        }\r\n      });\r\n    });\r\n  }\r\n\r\n  // Bind expand buttons\r\n  container.querySelectorAll('[data-action=\"expand\"]').forEach(btn => {\r\n    on(btn as HTMLElement, 'click', () => {\r\n      const changesEl = btn.closest('.history-entry')?.querySelector('.history-changes');\r\n      if (changesEl) {\r\n        changesEl.classList.toggle('expanded');\r\n        btn.textContent = changesEl.classList.contains('expanded') ? 'Hide details' : 'Show details';\r\n      }\r\n    });\r\n  });\r\n}\r\n\r\n/**\r\n * Render single entry\r\n */\r\nfunction renderEntry(entry: HistoryEntry): string {\r\n  const actionIcons: Record<string, string> = {\r\n    create: '',\r\n    update: '',\r\n    delete: '',\r\n    restore: '',\r\n  };\r\n\r\n  const actionColors: Record<string, string> = {\r\n    create: 'success',\r\n    update: 'info',\r\n    delete: 'danger',\r\n    restore: 'warning',\r\n  };\r\n\r\n  const hasChanges = entry.changes && Object.keys(entry.changes).length > 0;\r\n\r\n  return `\r\n    <div class=\"history-entry ${actionColors[entry.action]}\" data-entry-id=\"${entry.id}\">\r\n      <div class=\"history-icon\">${actionIcons[entry.action]}</div>\r\n      <div class=\"history-content\">\r\n        <div class=\"history-summary\">\r\n          <strong>${entry.actor.name}</strong>\r\n          ${entry.action}d\r\n          <span class=\"entity-type\">${entry.entityType}</span>\r\n          ${entry.entityName ? `\"${escapeHtml(entry.entityName)}\"` : ''}\r\n        </div>\r\n        <div class=\"history-time\">${formatRelativeTime(entry.timestamp)}</div>\r\n        \r\n        ${hasChanges ? `\r\n          <div class=\"history-changes\">\r\n            ${Object.entries(entry.changes!).map(([field, change]) => `\r\n              <div class=\"change-item\">\r\n                <span class=\"change-field\">${field}:</span>\r\n                <span class=\"change-old\">${formatValue(change.old)}</span>\r\n                <span class=\"change-arrow\"></span>\r\n                <span class=\"change-new\">${formatValue(change.new)}</span>\r\n              </div>\r\n            `).join('')}\r\n          </div>\r\n          <button class=\"btn-link\" data-action=\"expand\">Show details</button>\r\n        ` : ''}\r\n        \r\n        ${entry.action === 'delete' ? `\r\n          <button class=\"btn btn-sm btn-secondary\" data-action=\"restore\" data-entry-id=\"${entry.id}\">\r\n            Restore\r\n          </button>\r\n        ` : ''}\r\n      </div>\r\n    </div>\r\n  `;\r\n}\r\n\r\n/**\r\n * Group entries by date\r\n */\r\nfunction groupByDate(items: HistoryEntry[]): Record<string, HistoryEntry[]> {\r\n  const groups: Record<string, HistoryEntry[]> = {};\r\n\r\n  items.forEach(item => {\r\n    const date = new Date(item.timestamp).toLocaleDateString();\r\n    if (!groups[date]) {\r\n      groups[date] = [];\r\n    }\r\n    groups[date].push(item);\r\n  });\r\n\r\n  return groups;\r\n}\r\n\r\n/**\r\n * Format value for display\r\n */\r\nfunction formatValue(value: unknown): string {\r\n  if (value === null || value === undefined) return '(empty)';\r\n  if (typeof value === 'object') return JSON.stringify(value);\r\n  return String(value);\r\n}\r\n\r\n/**\r\n * Escape HTML\r\n */\r\nfunction escapeHtml(text: string): string {\r\n  const div = document.createElement('div');\r\n  div.textContent = text;\r\n  return div.innerHTML;\r\n}\r\n\r\nexport default showHistoryModal;\r\n","/**\r\n * Comment Modal Component\r\n * Add and view comments on entities\r\n */\r\n\r\nimport { createElement, on } from '@lib/dom';\r\nimport { createModal, openModal, closeModal } from '../Modal';\r\nimport { appStore } from '@stores/app';\r\nimport { http } from '@services/api';\r\nimport { toast } from '@services/toast';\r\nimport { formatRelativeTime } from '@lib/format';\r\n\r\nconst MODAL_ID = 'comment-modal';\r\n\r\nexport interface Comment {\r\n  id: string;\r\n  content: string;\r\n  author: {\r\n    id: string;\r\n    name: string;\r\n    email?: string;\r\n    avatar?: string;\r\n  };\r\n  createdAt: string;\r\n  updatedAt?: string;\r\n  edited?: boolean;\r\n  replies?: Comment[];\r\n}\r\n\r\nexport interface CommentModalProps {\r\n  entityType: string;\r\n  entityId: string;\r\n  entityName?: string;\r\n  onCommentAdded?: (comment: Comment) => void;\r\n}\r\n\r\nlet comments: Comment[] = [];\r\n\r\n/**\r\n * Show comment modal\r\n */\r\nexport async function showCommentModal(props: CommentModalProps): Promise<void> {\r\n  const { entityType, entityId, entityName, onCommentAdded } = props;\r\n\r\n  comments = [];\r\n\r\n  // Remove existing modal\r\n  const existing = document.querySelector(`[data-modal-id=\"${MODAL_ID}\"]`);\r\n  if (existing) existing.remove();\r\n\r\n  const content = createElement('div', { className: 'comment-modal-content' });\r\n  content.innerHTML = '<div class=\"loading\">Loading comments...</div>';\r\n\r\n  // Footer with comment input\r\n  const footer = createElement('div', { className: 'modal-footer comment-footer' });\r\n  footer.innerHTML = `\r\n    <div class=\"comment-input-wrapper\">\r\n      <textarea id=\"comment-input\" placeholder=\"Write a comment...\" rows=\"2\"></textarea>\r\n      <button id=\"submit-comment\" class=\"btn btn-primary\">Post</button>\r\n    </div>\r\n  `;\r\n\r\n  // Create modal\r\n  const modal = createModal({\r\n    id: MODAL_ID,\r\n    title: entityName ? `Comments on \"${entityName}\"` : 'Comments',\r\n    content,\r\n    size: 'md',\r\n    footer,\r\n  });\r\n\r\n  document.body.appendChild(modal);\r\n  openModal(MODAL_ID);\r\n\r\n  // Bind submit\r\n  const submitBtn = footer.querySelector('#submit-comment') as HTMLButtonElement;\r\n  const input = footer.querySelector('#comment-input') as HTMLTextAreaElement;\r\n\r\n  on(submitBtn, 'click', async () => {\r\n    const text = input.value.trim();\r\n    if (!text) {\r\n      toast.warning('Please write a comment');\r\n      return;\r\n    }\r\n\r\n    submitBtn.disabled = true;\r\n    submitBtn.textContent = 'Posting...';\r\n\r\n    try {\r\n      const response = await http.post<Comment>(`/api/${entityType}/${entityId}/comments`, {\r\n        content: text,\r\n      });\r\n\r\n      comments.unshift(response.data);\r\n      input.value = '';\r\n      render(content, props);\r\n      onCommentAdded?.(response.data);\r\n      toast.success('Comment added');\r\n    } catch {\r\n      // Error shown by API service\r\n    } finally {\r\n      submitBtn.disabled = false;\r\n      submitBtn.textContent = 'Post';\r\n    }\r\n  });\r\n\r\n  // Ctrl+Enter to submit\r\n  on(input, 'keydown', (e) => {\r\n    if (e.key === 'Enter' && e.ctrlKey) {\r\n      submitBtn.click();\r\n    }\r\n  });\r\n\r\n  // Load comments\r\n  try {\r\n    const response = await http.get<Comment[]>(`/api/${entityType}/${entityId}/comments`);\r\n    comments = response.data;\r\n    render(content, props);\r\n  } catch {\r\n    content.innerHTML = '<div class=\"error\">Failed to load comments</div>';\r\n  }\r\n}\r\n\r\n/**\r\n * Render comments\r\n */\r\nfunction render(container: HTMLElement, props: CommentModalProps): void {\r\n  if (comments.length === 0) {\r\n    container.innerHTML = `\r\n      <div class=\"empty-state\">\r\n        <span class=\"empty-icon\"></span>\r\n        <p>No comments yet</p>\r\n        <p class=\"text-muted\">Be the first to comment!</p>\r\n      </div>\r\n    `;\r\n    return;\r\n  }\r\n\r\n  container.innerHTML = `\r\n    <div class=\"comments-list\">\r\n      ${comments.map(c => renderComment(c, props)).join('')}\r\n    </div>\r\n  `;\r\n\r\n  // Bind actions\r\n  bindCommentActions(container, props);\r\n}\r\n\r\n/**\r\n * Render single comment\r\n */\r\nfunction renderComment(comment: Comment, props: CommentModalProps, depth = 0): string {\r\n  const currentUser = appStore.getState().currentUser;\r\n  const isAuthor = currentUser?.id === comment.author.id;\r\n  const initials = comment.author.name\r\n    .split(' ')\r\n    .map(n => n[0])\r\n    .join('')\r\n    .toUpperCase()\r\n    .slice(0, 2);\r\n\r\n  return `\r\n    <div class=\"comment ${depth > 0 ? 'reply' : ''}\" data-comment-id=\"${comment.id}\" style=\"--reply-offset: ${depth * 20}px\">\r\n      <div class=\"comment-avatar\">\r\n        ${comment.author.avatar\r\n      ? `<img src=\"${comment.author.avatar}\" alt=\"${escapeHtml(comment.author.name)}\">`\r\n      : initials\r\n    }\r\n      </div>\r\n      <div class=\"comment-body\">\r\n        <div class=\"comment-header\">\r\n          <strong class=\"comment-author\">${escapeHtml(comment.author.name)}</strong>\r\n          <span class=\"comment-time\">${formatRelativeTime(comment.createdAt)}</span>\r\n          ${comment.edited ? '<span class=\"comment-edited\">(edited)</span>' : ''}\r\n        </div>\r\n        <div class=\"comment-content\">${escapeHtml(comment.content)}</div>\r\n        <div class=\"comment-actions\">\r\n          <button class=\"btn-link\" data-action=\"reply\" data-comment-id=\"${comment.id}\">Reply</button>\r\n          ${isAuthor ? `\r\n            <button class=\"btn-link\" data-action=\"edit\" data-comment-id=\"${comment.id}\">Edit</button>\r\n            <button class=\"btn-link text-danger\" data-action=\"delete\" data-comment-id=\"${comment.id}\">Delete</button>\r\n          ` : ''}\r\n        </div>\r\n      </div>\r\n    </div>\r\n    ${comment.replies?.map(r => renderComment(r, props, depth + 1)).join('') || ''}\r\n  `;\r\n}\r\n\r\n/**\r\n * Bind comment action handlers\r\n */\r\nfunction bindCommentActions(container: HTMLElement, props: CommentModalProps): void {\r\n  container.querySelectorAll('[data-action]').forEach(btn => {\r\n    const action = btn.getAttribute('data-action');\r\n    const commentId = btn.getAttribute('data-comment-id');\r\n\r\n    on(btn as HTMLElement, 'click', async () => {\r\n      const comment = findComment(comments, commentId!);\r\n      if (!comment) return;\r\n\r\n      switch (action) {\r\n        case 'reply':\r\n          // Show reply input\r\n          const replyContainer = btn.closest('.comment')?.querySelector('.comment-body');\r\n          if (replyContainer && !replyContainer.querySelector('.reply-input')) {\r\n            const replyInput = createElement('div', { className: 'reply-input' });\r\n            replyInput.innerHTML = `\r\n              <textarea placeholder=\"Write a reply...\" rows=\"2\"></textarea>\r\n              <div class=\"reply-actions\">\r\n                <button class=\"btn btn-sm btn-secondary cancel-reply\">Cancel</button>\r\n                <button class=\"btn btn-sm btn-primary submit-reply\">Reply</button>\r\n              </div>\r\n            `;\r\n\r\n            replyContainer.appendChild(replyInput);\r\n\r\n            const cancelBtn = replyInput.querySelector('.cancel-reply');\r\n            const submitBtn = replyInput.querySelector('.submit-reply');\r\n            const textarea = replyInput.querySelector('textarea') as HTMLTextAreaElement;\r\n\r\n            on(cancelBtn as HTMLElement, 'click', () => replyInput.remove());\r\n            on(submitBtn as HTMLElement, 'click', async () => {\r\n              const text = textarea.value.trim();\r\n              if (!text) return;\r\n\r\n              try {\r\n                const response = await http.post<Comment>(\r\n                  `/api/${props.entityType}/${props.entityId}/comments/${commentId}/replies`,\r\n                  { content: text }\r\n                );\r\n\r\n                if (!comment.replies) comment.replies = [];\r\n                comment.replies.push(response.data);\r\n                render(container, props);\r\n              } catch {\r\n                // Error shown by API service\r\n              }\r\n            });\r\n\r\n            textarea.focus();\r\n          }\r\n          break;\r\n\r\n        case 'edit':\r\n          // Inline edit\r\n          const contentEl = btn.closest('.comment')?.querySelector('.comment-content');\r\n          if (contentEl) {\r\n            const originalText = comment.content;\r\n            contentEl.innerHTML = `\r\n              <textarea class=\"edit-textarea\">${escapeHtml(originalText)}</textarea>\r\n              <div class=\"edit-actions\">\r\n                <button class=\"btn btn-sm btn-secondary cancel-edit\">Cancel</button>\r\n                <button class=\"btn btn-sm btn-primary save-edit\">Save</button>\r\n              </div>\r\n            `;\r\n\r\n            const textarea = contentEl.querySelector('textarea') as HTMLTextAreaElement;\r\n            const cancelBtn = contentEl.querySelector('.cancel-edit');\r\n            const saveBtn = contentEl.querySelector('.save-edit');\r\n\r\n            on(cancelBtn as HTMLElement, 'click', () => {\r\n              contentEl.textContent = originalText;\r\n            });\r\n\r\n            on(saveBtn as HTMLElement, 'click', async () => {\r\n              const newText = textarea.value.trim();\r\n              if (!newText) return;\r\n\r\n              try {\r\n                await http.patch(\r\n                  `/api/${props.entityType}/${props.entityId}/comments/${commentId}`,\r\n                  { content: newText }\r\n                );\r\n                comment.content = newText;\r\n                comment.edited = true;\r\n                render(container, props);\r\n              } catch {\r\n                // Error shown by API service\r\n              }\r\n            });\r\n\r\n            textarea.focus();\r\n          }\r\n          break;\r\n\r\n        case 'delete':\r\n          const { confirm } = await import('../Modal');\r\n          const confirmed = await confirm('Delete this comment?', {\r\n            title: 'Delete Comment',\r\n            confirmText: 'Delete',\r\n            confirmClass: 'btn-danger',\r\n          });\r\n\r\n          if (confirmed) {\r\n            try {\r\n              await http.delete(\r\n                `/api/${props.entityType}/${props.entityId}/comments/${commentId}`\r\n              );\r\n              removeComment(comments, commentId!);\r\n              render(container, props);\r\n              toast.success('Comment deleted');\r\n            } catch {\r\n              // Error shown by API service\r\n            }\r\n          }\r\n          break;\r\n      }\r\n    });\r\n  });\r\n}\r\n\r\n/**\r\n * Find comment by ID (recursive)\r\n */\r\nfunction findComment(list: Comment[], id: string): Comment | undefined {\r\n  for (const comment of list) {\r\n    if (comment.id === id) return comment;\r\n    if (comment.replies) {\r\n      const found = findComment(comment.replies, id);\r\n      if (found) return found;\r\n    }\r\n  }\r\n  return undefined;\r\n}\r\n\r\n/**\r\n * Remove comment by ID (recursive)\r\n */\r\nfunction removeComment(list: Comment[], id: string): boolean {\r\n  const index = list.findIndex(c => c.id === id);\r\n  if (index !== -1) {\r\n    list.splice(index, 1);\r\n    return true;\r\n  }\r\n\r\n  for (const comment of list) {\r\n    if (comment.replies && removeComment(comment.replies, id)) {\r\n      return true;\r\n    }\r\n  }\r\n  return false;\r\n}\r\n\r\n/**\r\n * Escape HTML\r\n */\r\nfunction escapeHtml(text: string): string {\r\n  const div = document.createElement('div');\r\n  div.textContent = text;\r\n  return div.innerHTML;\r\n}\r\n\r\nexport default showCommentModal;\r\n","/**\n * Profile Modal - SOTA Design\n * View and edit user profile with modern glassmorphism design\n */\n\nimport { createModal, openModal, closeModal } from '@components/Modal';\nimport { createElement, on } from '@lib/dom';\nimport { profileService, UserProfile } from '@services/profile';\nimport { appStore } from '@stores/app';\nimport { toast } from '@services/toast';\nimport { http } from '@services/api';\nimport * as krispService from '@services/krisp';\n\nconst MODAL_ID = 'profile-modal';\n\ninterface Timezone {\n  code: string;\n  name: string;\n  region?: string;\n  utc_offset: string;\n  abbreviation?: string;\n}\n\nexport interface ProfileModalProps {\n  onClose?: () => void;\n  onUpdate?: (profile: UserProfile) => void;\n}\n\nlet currentProps: ProfileModalProps = {};\nlet currentProfile: UserProfile | null = null;\nlet cachedTimezones: Timezone[] | null = null;\n\n/**\n * Show profile modal\n */\nexport function showProfileModal(props: ProfileModalProps = {}): void {\n  currentProps = props;\n\n  const content = createModalContent();\n\n  const modal = createModal({\n    id: MODAL_ID,\n    title: '',\n    size: 'lg',\n    content: content,\n    onClose: props.onClose,\n  });\n\n  modal.classList.add('profile-modal-overlay');\n\n  const modalContent = modal.querySelector('.modal-content') as HTMLElement;\n  if (modalContent) {\n    modalContent.classList.add('profile-modal-content');\n  }\n  const modalHeader = modal.querySelector('.modal-header') as HTMLElement;\n  if (modalHeader) {\n    modalHeader.classList.add('hidden');\n  }\n\n  document.body.appendChild(modal);\n  openModal(MODAL_ID);\n\n  loadProfile(content);\n}\n\n/**\n * Create modal content\n */\nfunction createModalContent(): HTMLElement {\n  const container = createElement('div', { className: 'profile-modal-sota' });\n\n  container.innerHTML = `\n    <style>\n      .profile-modal-sota {\n        font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, sans-serif;\n      }\n      \n      .profile-card {\n        background: linear-gradient(135deg, rgba(255,255,255,0.95) 0%, rgba(248,250,252,0.95) 100%);\n        backdrop-filter: blur(20px);\n        border-radius: 24px;\n        box-shadow: \n          0 25px 50px -12px rgba(0, 0, 0, 0.15),\n          0 0 0 1px rgba(255, 255, 255, 0.8),\n          inset 0 1px 0 rgba(255, 255, 255, 0.9);\n        overflow: hidden;\n      }\n      \n      [data-theme=\"dark\"] .profile-card {\n        background: linear-gradient(135deg, rgba(30,41,59,0.95) 0%, rgba(15,23,42,0.95) 100%);\n        box-shadow: \n          0 25px 50px -12px rgba(0, 0, 0, 0.5),\n          0 0 0 1px rgba(255, 255, 255, 0.1),\n          inset 0 1px 0 rgba(255, 255, 255, 0.05);\n      }\n      \n      .profile-header {\n        background: linear-gradient(135deg, #e11d48 0%, #be123c 100%);\n        padding: 32px;\n        position: relative;\n        overflow: hidden;\n      }\n      \n      .profile-header::before {\n        content: '';\n        position: absolute;\n        top: -50%;\n        right: -50%;\n        width: 100%;\n        height: 200%;\n        background: radial-gradient(circle, rgba(255,255,255,0.1) 0%, transparent 60%);\n        pointer-events: none;\n      }\n      \n      .profile-header-content {\n        display: flex;\n        align-items: center;\n        gap: 24px;\n        position: relative;\n        z-index: 1;\n      }\n      \n      .profile-avatar-large {\n        width: 100px;\n        height: 100px;\n        border-radius: 50%;\n        background: rgba(255,255,255,0.2);\n        display: flex;\n        align-items: center;\n        justify-content: center;\n        font-size: 36px;\n        font-weight: 600;\n        color: white;\n        border: 4px solid rgba(255,255,255,0.3);\n        overflow: hidden;\n        flex-shrink: 0;\n        cursor: pointer;\n        transition: all 0.2s ease;\n        position: relative;\n      }\n      \n      .profile-avatar-large:hover {\n        border-color: rgba(255,255,255,0.5);\n        transform: scale(1.05);\n      }\n      \n      .profile-avatar-large img {\n        width: 100%;\n        height: 100%;\n        object-fit: cover;\n      }\n      \n      .avatar-overlay {\n        position: absolute;\n        inset: 0;\n        background: rgba(0,0,0,0.5);\n        display: flex;\n        align-items: center;\n        justify-content: center;\n        opacity: 0;\n        transition: opacity 0.2s;\n        border-radius: 50%;\n      }\n      \n      .profile-avatar-large:hover .avatar-overlay {\n        opacity: 1;\n      }\n      \n      .avatar-overlay svg {\n        width: 28px;\n        height: 28px;\n        color: white;\n      }\n      \n      .profile-user-info h2 {\n        margin: 0 0 4px 0;\n        font-size: 28px;\n        font-weight: 700;\n        color: white;\n      }\n      \n      .profile-user-info .email {\n        color: rgba(255,255,255,0.8);\n        font-size: 14px;\n        display: flex;\n        align-items: center;\n        gap: 8px;\n      }\n      \n      .profile-user-info .role-badge {\n        display: inline-flex;\n        align-items: center;\n        gap: 4px;\n        background: rgba(255,255,255,0.2);\n        padding: 4px 10px;\n        border-radius: 20px;\n        font-size: 11px;\n        font-weight: 600;\n        text-transform: uppercase;\n        letter-spacing: 0.5px;\n        color: white;\n      }\n      \n      .profile-close-btn {\n        position: absolute;\n        top: 16px;\n        right: 16px;\n        width: 36px;\n        height: 36px;\n        border-radius: 50%;\n        background: rgba(255,255,255,0.2);\n        border: none;\n        cursor: pointer;\n        display: flex;\n        align-items: center;\n        justify-content: center;\n        transition: all 0.2s;\n        z-index: 10;\n      }\n      \n      .profile-close-btn:hover {\n        background: rgba(255,255,255,0.3);\n        transform: rotate(90deg);\n      }\n      \n      .profile-close-btn svg {\n        width: 20px;\n        height: 20px;\n        color: white;\n      }\n      \n      .profile-tabs-nav {\n        display: flex;\n        gap: 0;\n        padding: 0 24px;\n        background: rgba(0,0,0,0.02);\n        border-bottom: 1px solid rgba(0,0,0,0.06);\n      }\n      \n      [data-theme=\"dark\"] .profile-tabs-nav {\n        background: rgba(255,255,255,0.02);\n        border-bottom-color: rgba(255,255,255,0.06);\n      }\n      \n      .profile-tab-btn {\n        padding: 16px 24px;\n        background: transparent;\n        border: none;\n        font-size: 14px;\n        font-weight: 500;\n        color: #64748b;\n        cursor: pointer;\n        position: relative;\n        transition: all 0.2s;\n      }\n      \n      .profile-tab-btn:hover {\n        color: #1e293b;\n      }\n      \n      [data-theme=\"dark\"] .profile-tab-btn:hover {\n        color: #e2e8f0;\n      }\n      \n      .profile-tab-btn.active {\n        color: #e11d48;\n      }\n      \n      .profile-tab-btn.active::after {\n        content: '';\n        position: absolute;\n        bottom: 0;\n        left: 24px;\n        right: 24px;\n        height: 2px;\n        background: #e11d48;\n        border-radius: 2px 2px 0 0;\n      }\n      \n      .profile-tab-icon {\n        width: 18px;\n        height: 18px;\n        margin-right: 8px;\n        vertical-align: middle;\n      }\n      \n      .profile-body {\n        padding: 32px;\n      }\n      \n      .profile-section {\n        display: none;\n      }\n      \n      .profile-section.active {\n        display: block;\n      }\n      \n      .form-grid {\n        display: grid;\n        grid-template-columns: repeat(2, 1fr);\n        gap: 20px;\n      }\n      \n      .form-grid .full-width {\n        grid-column: 1 / -1;\n      }\n      \n      .form-field {\n        display: flex;\n        flex-direction: column;\n        gap: 6px;\n      }\n      \n      .form-field label {\n        font-size: 13px;\n        font-weight: 600;\n        color: #475569;\n        display: flex;\n        align-items: center;\n        gap: 6px;\n      }\n      \n      [data-theme=\"dark\"] .form-field label {\n        color: #94a3b8;\n      }\n      \n      .form-field input,\n      .form-field select,\n      .form-field textarea {\n        padding: 12px 16px;\n        border: 1px solid #e2e8f0;\n        border-radius: 12px;\n        font-size: 14px;\n        background: #f8fafc;\n        color: #1e293b;\n        transition: all 0.2s;\n        outline: none;\n      }\n      \n      [data-theme=\"dark\"] .form-field input,\n      [data-theme=\"dark\"] .form-field select,\n      [data-theme=\"dark\"] .form-field textarea {\n        background: rgba(255,255,255,0.05);\n        border-color: rgba(255,255,255,0.1);\n        color: #f1f5f9;\n      }\n      \n      .form-field input:focus,\n      .form-field select:focus,\n      .form-field textarea:focus {\n        border-color: #e11d48;\n        box-shadow: 0 0 0 3px rgba(225, 29, 72, 0.1);\n      }\n      \n      .form-field input:disabled {\n        background: #f1f5f9;\n        color: #94a3b8;\n        cursor: not-allowed;\n      }\n      \n      [data-theme=\"dark\"] .form-field input:disabled {\n        background: rgba(255,255,255,0.02);\n        color: #64748b;\n      }\n      \n      .form-field textarea {\n        resize: vertical;\n        min-height: 100px;\n      }\n      \n      .form-hint {\n        font-size: 12px;\n        color: #94a3b8;\n      }\n      \n      .form-actions {\n        display: flex;\n        justify-content: flex-end;\n        gap: 12px;\n        margin-top: 24px;\n        padding-top: 24px;\n        border-top: 1px solid rgba(0,0,0,0.06);\n      }\n      \n      [data-theme=\"dark\"] .form-actions {\n        border-top-color: rgba(255,255,255,0.06);\n      }\n      \n      .btn-sota {\n        padding: 12px 24px;\n        border-radius: 12px;\n        font-size: 14px;\n        font-weight: 600;\n        cursor: pointer;\n        transition: all 0.2s;\n        border: none;\n        display: inline-flex;\n        align-items: center;\n        gap: 8px;\n      }\n      \n      .btn-sota.primary {\n        background: linear-gradient(135deg, #e11d48 0%, #be123c 100%);\n        color: white;\n        box-shadow: 0 4px 14px rgba(225, 29, 72, 0.3);\n      }\n      \n      .btn-sota.primary:hover {\n        transform: translateY(-1px);\n        box-shadow: 0 6px 20px rgba(225, 29, 72, 0.4);\n      }\n      \n      .btn-sota.secondary {\n        background: #f1f5f9;\n        color: #475569;\n      }\n      \n      [data-theme=\"dark\"] .btn-sota.secondary {\n        background: rgba(255,255,255,0.1);\n        color: #e2e8f0;\n      }\n      \n      .btn-sota.secondary:hover {\n        background: #e2e8f0;\n      }\n      \n      [data-theme=\"dark\"] .btn-sota.secondary:hover {\n        background: rgba(255,255,255,0.15);\n      }\n      \n      .btn-sota.danger {\n        background: transparent;\n        color: #dc2626;\n        border: 1px solid #fecaca;\n      }\n      \n      .btn-sota.danger:hover {\n        background: #fef2f2;\n        border-color: #dc2626;\n      }\n      \n      /* Security Section */\n      .security-section {\n        margin-bottom: 32px;\n      }\n      \n      .security-section h3 {\n        font-size: 16px;\n        font-weight: 600;\n        color: #1e293b;\n        margin: 0 0 16px 0;\n        display: flex;\n        align-items: center;\n        gap: 8px;\n      }\n      \n      [data-theme=\"dark\"] .security-section h3 {\n        color: #f1f5f9;\n      }\n      \n      .danger-zone {\n        background: linear-gradient(135deg, #fef2f2 0%, #fff 100%);\n        border: 1px solid #fecaca;\n        border-radius: 16px;\n        padding: 24px;\n      }\n      \n      [data-theme=\"dark\"] .danger-zone {\n        background: linear-gradient(135deg, rgba(220,38,38,0.1) 0%, rgba(220,38,38,0.05) 100%);\n        border-color: rgba(220,38,38,0.3);\n      }\n      \n      .danger-zone h3 {\n        color: #dc2626 !important;\n      }\n      \n      .danger-zone p {\n        color: #991b1b;\n        font-size: 14px;\n        margin: 0 0 16px 0;\n      }\n      \n      [data-theme=\"dark\"] .danger-zone p {\n        color: #fca5a5;\n      }\n      \n      /* Sessions */\n      .sessions-list {\n        display: flex;\n        flex-direction: column;\n        gap: 12px;\n      }\n      \n      .session-card {\n        display: flex;\n        align-items: center;\n        justify-content: space-between;\n        padding: 16px 20px;\n        background: #f8fafc;\n        border-radius: 12px;\n        border: 1px solid transparent;\n      }\n      \n      [data-theme=\"dark\"] .session-card {\n        background: rgba(255,255,255,0.03);\n      }\n      \n      .session-card.current {\n        border-color: #e11d48;\n        background: linear-gradient(135deg, rgba(225,29,72,0.05) 0%, rgba(225,29,72,0.02) 100%);\n      }\n      \n      .session-info {\n        display: flex;\n        align-items: center;\n        gap: 16px;\n      }\n      \n      .session-icon {\n        width: 44px;\n        height: 44px;\n        background: #e2e8f0;\n        border-radius: 12px;\n        display: flex;\n        align-items: center;\n        justify-content: center;\n      }\n      \n      [data-theme=\"dark\"] .session-icon {\n        background: rgba(255,255,255,0.1);\n      }\n      \n      .session-icon svg {\n        width: 22px;\n        height: 22px;\n        color: #64748b;\n      }\n      \n      .session-details h4 {\n        margin: 0 0 4px 0;\n        font-size: 14px;\n        font-weight: 600;\n        color: #1e293b;\n      }\n      \n      [data-theme=\"dark\"] .session-details h4 {\n        color: #f1f5f9;\n      }\n      \n      .session-details p {\n        margin: 0;\n        font-size: 12px;\n        color: #64748b;\n      }\n      \n      .session-badge {\n        font-size: 11px;\n        font-weight: 600;\n        padding: 4px 10px;\n        border-radius: 20px;\n        background: #e11d48;\n        color: white;\n      }\n      \n      .empty-state {\n        text-align: center;\n        padding: 48px 24px;\n        color: #94a3b8;\n      }\n      \n      .empty-state svg {\n        width: 48px;\n        height: 48px;\n        margin-bottom: 16px;\n        opacity: 0.5;\n      }\n      \n      .loading-spinner {\n        display: flex;\n        justify-content: center;\n        align-items: center;\n        padding: 48px;\n      }\n      \n      .loading-spinner::after {\n        content: '';\n        width: 32px;\n        height: 32px;\n        border: 3px solid #e2e8f0;\n        border-top-color: #e11d48;\n        border-radius: 50%;\n        animation: spin 0.8s linear infinite;\n      }\n      \n      @keyframes spin {\n        to { transform: rotate(360deg); }\n      }\n    </style>\n    \n    <div class=\"profile-card\">\n      <div class=\"loading-spinner\"></div>\n    </div>\n  `;\n\n  return container;\n}\n\n/**\n * Load profile data\n * @param bindOptions - When onBack is set (page mode), close button calls it instead of closeModal\n */\nasync function loadProfile(container: HTMLElement, bindOptions?: { onBack?: () => void }): Promise<void> {\n  const card = container.querySelector('.profile-card') as HTMLElement;\n  if (!card) return;\n\n  try {\n    // Load profile and timezones in parallel\n    const [apiProfile, timezones] = await Promise.all([\n      profileService.get(),\n      loadTimezones()\n    ]);\n\n    if (apiProfile) {\n      currentProfile = apiProfile;\n      renderProfile(card, currentProfile, timezones, bindOptions);\n    } else {\n      // Fallback to current user from store\n      const currentUser = appStore.getState().currentUser;\n      if (currentUser) {\n        currentProfile = {\n          id: currentUser.id,\n          email: currentUser.email,\n          display_name: currentUser.name || currentUser.email?.split('@')[0] || 'User',\n          avatar_url: currentUser.avatar,\n          created_at: new Date().toISOString(),\n        };\n        renderProfile(card, currentProfile, timezones, bindOptions);\n      } else {\n        card.innerHTML = '<div class=\"empty-state\">Please log in to view your profile</div>';\n      }\n    }\n  } catch {\n    // Fallback to current user\n    const currentUser = appStore.getState().currentUser;\n    if (currentUser) {\n      currentProfile = {\n        id: currentUser.id,\n        email: currentUser.email,\n        display_name: currentUser.name || 'User',\n        avatar_url: currentUser.avatar,\n        created_at: new Date().toISOString(),\n      };\n      renderProfile(card, currentProfile, undefined, bindOptions);\n    } else {\n      card.innerHTML = '<div class=\"empty-state\">Failed to load profile</div>';\n    }\n  }\n}\n\n/**\n * Render profile\n */\nfunction renderProfile(container: HTMLElement, profile: UserProfile, timezones?: Timezone[], bindOptions?: { onBack?: () => void }): void {\n  const initials = getInitials(profile.display_name || profile.email);\n  const currentUser = appStore.getState().currentUser;\n  const role = currentUser?.role || profile.role || 'user';\n\n  container.innerHTML = `\n    <!-- Header -->\n    <div class=\"profile-header\">\n      <button class=\"profile-close-btn\" id=\"close-profile-btn\">\n        <svg fill=\"none\" viewBox=\"0 0 24 24\" stroke=\"currentColor\">\n          <path stroke-linecap=\"round\" stroke-linejoin=\"round\" stroke-width=\"2\" d=\"M6 18L18 6M6 6l12 12\"/>\n        </svg>\n      </button>\n      \n      <div class=\"profile-header-content\">\n        <label class=\"profile-avatar-large\" for=\"avatar-input-hidden\" id=\"profile-avatar-display\">\n          <img src=\"${profile.avatar_url || generateFallbackAvatar(profile.display_name || profile.email)}\" alt=\"Avatar\" onerror=\"this.src='${generateFallbackAvatar(profile.display_name || profile.email)}'\">\n          <div class=\"avatar-overlay\">\n            <svg fill=\"none\" viewBox=\"0 0 24 24\" stroke=\"currentColor\">\n              <path stroke-linecap=\"round\" stroke-linejoin=\"round\" stroke-width=\"2\" d=\"M3 9a2 2 0 012-2h.93a2 2 0 001.664-.89l.812-1.22A2 2 0 0110.07 4h3.86a2 2 0 011.664.89l.812 1.22A2 2 0 0018.07 7H19a2 2 0 012 2v9a2 2 0 01-2 2H5a2 2 0 01-2-2V9z\"/>\n              <path stroke-linecap=\"round\" stroke-linejoin=\"round\" stroke-width=\"2\" d=\"M15 13a3 3 0 11-6 0 3 3 0 016 0z\"/>\n            </svg>\n          </div>\n          <input type=\"file\" id=\"avatar-input-hidden\" accept=\"image/*\" hidden>\n        </label>\n        \n        <div class=\"profile-user-info\">\n          <h2>${escapeHtml(profile.display_name || profile.username || 'User')}</h2>\n          <div class=\"email\">\n            ${escapeHtml(profile.email)}\n            <span class=\"role-badge\">\n              <svg width=\"12\" height=\"12\" fill=\"currentColor\" viewBox=\"0 0 20 20\">\n                ${role === 'superadmin'\n      ? '<path fill-rule=\"evenodd\" d=\"M10 18a8 8 0 100-16 8 8 0 000 16zm3.707-9.293a1 1 0 00-1.414-1.414L9 10.586 7.707 9.293a1 1 0 00-1.414 1.414l2 2a1 1 0 001.414 0l4-4z\" clip-rule=\"evenodd\"/>'\n      : '<path fill-rule=\"evenodd\" d=\"M10 9a3 3 0 100-6 3 3 0 000 6zm-7 9a7 7 0 1114 0H3z\" clip-rule=\"evenodd\"/>'\n    }\n              </svg>\n              ${role === 'superadmin' ? 'Super Admin' : 'User'}\n            </span>\n          </div>\n        </div>\n      </div>\n    </div>\n    \n    <!-- Tabs Navigation -->\n    <nav class=\"profile-tabs-nav\">\n      <button class=\"profile-tab-btn active\" data-tab=\"general\">\n        <svg class=\"profile-tab-icon\" fill=\"none\" viewBox=\"0 0 24 24\" stroke=\"currentColor\">\n          <path stroke-linecap=\"round\" stroke-linejoin=\"round\" stroke-width=\"2\" d=\"M16 7a4 4 0 11-8 0 4 4 0 018 0zM12 14a7 7 0 00-7 7h14a7 7 0 00-7-7z\"/>\n        </svg>\n        General\n      </button>\n      <button class=\"profile-tab-btn\" data-tab=\"security\">\n        <svg class=\"profile-tab-icon\" fill=\"none\" viewBox=\"0 0 24 24\" stroke=\"currentColor\">\n          <path stroke-linecap=\"round\" stroke-linejoin=\"round\" stroke-width=\"2\" d=\"M12 15v2m-6 4h12a2 2 0 002-2v-6a2 2 0 00-2-2H6a2 2 0 00-2 2v6a2 2 0 002 2zm10-10V7a4 4 0 00-8 0v4h8z\"/>\n        </svg>\n        Security\n      </button>\n      <button class=\"profile-tab-btn\" data-tab=\"sessions\">\n        <svg class=\"profile-tab-icon\" fill=\"none\" viewBox=\"0 0 24 24\" stroke=\"currentColor\">\n          <path stroke-linecap=\"round\" stroke-linejoin=\"round\" stroke-width=\"2\" d=\"M9.75 17L9 20l-1 1h8l-1-1-.75-3M3 13h18M5 17h14a2 2 0 002-2V5a2 2 0 00-2-2H5a2 2 0 00-2 2v10a2 2 0 002 2z\"/>\n        </svg>\n        Sessions\n      </button>\n      <button class=\"profile-tab-btn\" data-tab=\"integrations\">\n        <svg class=\"profile-tab-icon\" fill=\"none\" viewBox=\"0 0 24 24\" stroke=\"currentColor\">\n          <path stroke-linecap=\"round\" stroke-linejoin=\"round\" stroke-width=\"2\" d=\"M13.828 10.172a4 4 0 00-5.656 0l-4 4a4 4 0 105.656 5.656l1.102-1.101m-.758-4.899a4 4 0 005.656 0l4-4a4 4 0 00-5.656-5.656l-1.1 1.1\"/>\n        </svg>\n        Integrations\n      </button>\n    </nav>\n    \n    <!-- Tab Content -->\n    <div class=\"profile-body\">\n      <!-- General Tab -->\n      <div class=\"profile-section active\" id=\"section-general\">\n        <form id=\"profile-form\">\n          <div class=\"form-grid\">\n            <div class=\"form-field\">\n              <label>\n                <svg width=\"14\" height=\"14\" fill=\"none\" viewBox=\"0 0 24 24\" stroke=\"currentColor\">\n                  <path stroke-linecap=\"round\" stroke-linejoin=\"round\" stroke-width=\"2\" d=\"M3 8l7.89 5.26a2 2 0 002.22 0L21 8M5 19h14a2 2 0 002-2V7a2 2 0 00-2-2H5a2 2 0 00-2 2v10a2 2 0 002 2z\"/>\n                </svg>\n                Email\n              </label>\n              <input type=\"email\" value=\"${escapeHtml(profile.email)}\" disabled>\n              <span class=\"form-hint\">Email cannot be changed</span>\n            </div>\n            \n            <div class=\"form-field\">\n              <label>\n                <svg width=\"14\" height=\"14\" fill=\"none\" viewBox=\"0 0 24 24\" stroke=\"currentColor\">\n                  <path stroke-linecap=\"round\" stroke-linejoin=\"round\" stroke-width=\"2\" d=\"M16 12a4 4 0 10-8 0 4 4 0 008 0zm0 0v1.5a2.5 2.5 0 005 0V12a9 9 0 10-9 9m4.5-1.206a8.959 8.959 0 01-4.5 1.207\"/>\n                </svg>\n                Username\n              </label>\n              <input type=\"text\" name=\"username\" value=\"${escapeHtml(profile.username || '')}\" placeholder=\"Enter username\">\n            </div>\n            \n            <div class=\"form-field full-width\">\n              <label>\n                <svg width=\"14\" height=\"14\" fill=\"none\" viewBox=\"0 0 24 24\" stroke=\"currentColor\">\n                  <path stroke-linecap=\"round\" stroke-linejoin=\"round\" stroke-width=\"2\" d=\"M5.121 17.804A13.937 13.937 0 0112 16c2.5 0 4.847.655 6.879 1.804M15 10a3 3 0 11-6 0 3 3 0 016 0zm6 2a9 9 0 11-18 0 9 9 0 0118 0z\"/>\n                </svg>\n                Display Name\n              </label>\n              <input type=\"text\" name=\"display_name\" value=\"${escapeHtml(profile.display_name || '')}\" placeholder=\"Your display name\">\n            </div>\n            \n            <div class=\"form-field full-width\">\n              <label>\n                <svg width=\"14\" height=\"14\" fill=\"none\" viewBox=\"0 0 24 24\" stroke=\"currentColor\">\n                  <path stroke-linecap=\"round\" stroke-linejoin=\"round\" stroke-width=\"2\" d=\"M4 6h16M4 12h16M4 18h7\"/>\n                </svg>\n                Bio\n              </label>\n              <textarea name=\"bio\" placeholder=\"Tell us a bit about yourself\">${escapeHtml(profile.bio || '')}</textarea>\n            </div>\n            \n            <div class=\"form-field full-width\">\n              <label>\n                <svg width=\"14\" height=\"14\" fill=\"none\" viewBox=\"0 0 24 24\" stroke=\"currentColor\">\n                  <path stroke-linecap=\"round\" stroke-linejoin=\"round\" stroke-width=\"2\" d=\"M4 16l4.586-4.586a2 2 0 012.828 0L16 16m-2-2l1.586-1.586a2 2 0 012.828 0L20 14m-6-6h.01M6 20h12a2 2 0 002-2V6a2 2 0 00-2-2H6a2 2 0 00-2 2v12a2 2 0 002 2z\"/>\n                </svg>\n                Avatar URL\n              </label>\n              <input type=\"url\" name=\"avatar_url\" id=\"avatar-url-input\" value=\"${escapeHtml(profile.avatar_url || '')}\" placeholder=\"https://example.com/avatar.jpg\">\n              <span class=\"form-hint\">Enter an image URL or upload using the avatar above. Leave empty for auto-generated avatar.</span>\n            </div>\n            \n            <div class=\"form-field\">\n              <label>\n                <svg width=\"14\" height=\"14\" fill=\"none\" viewBox=\"0 0 24 24\" stroke=\"currentColor\">\n                  <path stroke-linecap=\"round\" stroke-linejoin=\"round\" stroke-width=\"2\" d=\"M12 8v4l3 3m6-3a9 9 0 11-18 0 9 9 0 0118 0z\"/>\n                </svg>\n                Timezone\n              </label>\n              <select name=\"timezone\">\n                ${generateTimezoneOptions(profile.timezone, timezones)}\n              </select>\n            </div>\n            \n            <div class=\"form-field\">\n              <label>\n                <svg width=\"14\" height=\"14\" fill=\"none\" viewBox=\"0 0 24 24\" stroke=\"currentColor\">\n                  <path stroke-linecap=\"round\" stroke-linejoin=\"round\" stroke-width=\"2\" d=\"M3 5h12M9 3v2m1.048 9.5A18.022 18.022 0 016.412 9m6.088 9h7M11 21l5-10 5 10M12.751 5C11.783 10.77 8.07 15.61 3 18.129\"/>\n                </svg>\n                Language\n              </label>\n              <select name=\"locale\">\n                <option value=\"en\" ${profile.locale === 'en' ? 'selected' : ''}>English</option>\n                <option value=\"pt\" ${profile.locale === 'pt' ? 'selected' : ''}>Portugus</option>\n                <option value=\"es\" ${profile.locale === 'es' ? 'selected' : ''}>Espaol</option>\n                <option value=\"fr\" ${profile.locale === 'fr' ? 'selected' : ''}>Franais</option>\n              </select>\n            </div>\n          </div>\n          \n          <div class=\"form-actions\">\n            <button type=\"submit\" class=\"btn-sota primary\">\n              <svg width=\"16\" height=\"16\" fill=\"none\" viewBox=\"0 0 24 24\" stroke=\"currentColor\">\n                <path stroke-linecap=\"round\" stroke-linejoin=\"round\" stroke-width=\"2\" d=\"M5 13l4 4L19 7\"/>\n              </svg>\n              Save Changes\n            </button>\n          </div>\n        </form>\n      </div>\n      \n      <!-- Security Tab -->\n      <div class=\"profile-section\" id=\"section-security\">\n        <div class=\"security-section\">\n          <h3>\n            <svg width=\"18\" height=\"18\" fill=\"none\" viewBox=\"0 0 24 24\" stroke=\"currentColor\">\n              <path stroke-linecap=\"round\" stroke-linejoin=\"round\" stroke-width=\"2\" d=\"M15 7a2 2 0 012 2m4 0a6 6 0 01-7.743 5.743L11 17H9v2H7v2H4a1 1 0 01-1-1v-2.586a1 1 0 01.293-.707l5.964-5.964A6 6 0 1121 9z\"/>\n            </svg>\n            Change Password\n          </h3>\n          \n          <form id=\"password-form\">\n            <div class=\"form-grid\">\n              <div class=\"form-field full-width\">\n                <label>Current Password</label>\n                <input type=\"password\" name=\"current_password\" required>\n              </div>\n              \n              <div class=\"form-field\">\n                <label>New Password</label>\n                <input type=\"password\" name=\"new_password\" minlength=\"12\" required>\n                <span class=\"form-hint\">Minimum 12 characters</span>\n              </div>\n              \n              <div class=\"form-field\">\n                <label>Confirm Password</label>\n                <input type=\"password\" name=\"confirm_password\" required>\n              </div>\n            </div>\n            \n            <div class=\"form-actions\">\n              <button type=\"submit\" class=\"btn-sota primary\">Update Password</button>\n            </div>\n          </form>\n        </div>\n        \n        <div class=\"danger-zone\">\n          <h3>\n            <svg width=\"18\" height=\"18\" fill=\"none\" viewBox=\"0 0 24 24\" stroke=\"currentColor\">\n              <path stroke-linecap=\"round\" stroke-linejoin=\"round\" stroke-width=\"2\" d=\"M12 9v2m0 4h.01m-6.938 4h13.856c1.54 0 2.502-1.667 1.732-3L13.732 4c-.77-1.333-2.694-1.333-3.464 0L3.34 16c-.77 1.333.192 3 1.732 3z\"/>\n            </svg>\n            Danger Zone\n          </h3>\n          <p>Permanently delete your account and all associated data. This action cannot be undone.</p>\n          <button type=\"button\" class=\"btn-sota danger\" id=\"delete-account-btn\">\n            <svg width=\"16\" height=\"16\" fill=\"none\" viewBox=\"0 0 24 24\" stroke=\"currentColor\">\n              <path stroke-linecap=\"round\" stroke-linejoin=\"round\" stroke-width=\"2\" d=\"M19 7l-.867 12.142A2 2 0 0116.138 21H7.862a2 2 0 01-1.995-1.858L5 7m5 4v6m4-6v6m1-10V4a1 1 0 00-1-1h-4a1 1 0 00-1 1v3M4 7h16\"/>\n            </svg>\n            Delete Account\n          </button>\n        </div>\n      </div>\n      \n      <!-- Sessions Tab -->\n      <div class=\"profile-section\" id=\"section-sessions\">\n        <div id=\"sessions-list\" class=\"sessions-list\">\n          <div class=\"loading-spinner\"></div>\n        </div>\n        \n        <div class=\"form-actions\">\n          <button type=\"button\" class=\"btn-sota secondary\" id=\"revoke-all-btn\">\n            <svg width=\"16\" height=\"16\" fill=\"none\" viewBox=\"0 0 24 24\" stroke=\"currentColor\">\n              <path stroke-linecap=\"round\" stroke-linejoin=\"round\" stroke-width=\"2\" d=\"M17 16l4-4m0 0l-4-4m4 4H7m6 4v1a3 3 0 01-3 3H6a3 3 0 01-3-3V7a3 3 0 013-3h4a3 3 0 013 3v1\"/>\n            </svg>\n            Sign out all other sessions\n          </button>\n        </div>\n      </div>\n      \n      <!-- Integrations Tab -->\n      <div class=\"profile-section\" id=\"section-integrations\">\n        <div class=\"security-section\">\n          <h3>\n            <svg width=\"18\" height=\"18\" fill=\"none\" viewBox=\"0 0 24 24\" stroke=\"currentColor\">\n              <path stroke-linecap=\"round\" stroke-linejoin=\"round\" stroke-width=\"2\" d=\"M19 11a7 7 0 01-7 7m0 0a7 7 0 01-7-7m7 7v4m0 0H8m4 0h4m-4-8a3 3 0 01-3-3V5a3 3 0 116 0v6a3 3 0 01-3 3z\"/>\n            </svg>\n            Krisp AI Meeting Assistant\n          </h3>\n          <p class=\"form-hint form-hint-mb\">\n            Connect your Krisp account to automatically import meeting transcriptions into GodMode.\n          </p>\n          \n          <div id=\"krisp-integration-content\">\n            <div class=\"loading-spinner\"></div>\n          </div>\n        </div>\n      </div>\n    </div>\n  `;\n\n  bindEvents(container, bindOptions);\n}\n\n/**\n * Bind event handlers\n * @param container - Root profile view container\n * @param options - When onBack is set (page mode), close button calls it instead of closeModal\n */\nfunction bindEvents(container: HTMLElement, options?: { onBack?: () => void }): void {\n  // Close button\n  const closeBtn = container.querySelector('#close-profile-btn');\n  if (closeBtn) {\n    on(closeBtn as HTMLElement, 'click', () => {\n      if (options?.onBack) {\n        options.onBack();\n      } else {\n        closeModal(MODAL_ID);\n        currentProps.onClose?.();\n      }\n    });\n  }\n\n  // Tab switching\n  const tabs = container.querySelectorAll('.profile-tab-btn');\n  tabs.forEach(tab => {\n    on(tab as HTMLElement, 'click', () => {\n      tabs.forEach(t => t.classList.remove('active'));\n      tab.classList.add('active');\n\n      const tabId = tab.getAttribute('data-tab');\n      container.querySelectorAll('.profile-section').forEach(section => {\n        section.classList.toggle('active', section.id === `section-${tabId}`);\n      });\n\n      if (tabId === 'sessions') {\n        loadSessions();\n      }\n      if (tabId === 'integrations') {\n        loadKrispIntegration(container);\n      }\n    });\n  });\n\n  // Avatar upload\n  const avatarInput = container.querySelector('#avatar-input-hidden') as HTMLInputElement;\n  if (avatarInput) {\n    on(avatarInput, 'change', async () => {\n      const file = avatarInput.files?.[0];\n      if (file) {\n        try {\n          const avatarUrl = await profileService.uploadAvatar(file);\n          const avatarEl = container.querySelector('.profile-avatar-large') as HTMLElement;\n          if (avatarEl) {\n            const img = avatarEl.querySelector('img');\n            if (img) {\n              img.src = avatarUrl;\n            } else {\n              avatarEl.innerHTML = `\n                <img src=\"${avatarUrl}\" alt=\"Avatar\">\n                <div class=\"avatar-overlay\">\n                  <svg fill=\"none\" viewBox=\"0 0 24 24\" stroke=\"currentColor\">\n                    <path stroke-linecap=\"round\" stroke-linejoin=\"round\" stroke-width=\"2\" d=\"M3 9a2 2 0 012-2h.93a2 2 0 001.664-.89l.812-1.22A2 2 0 0110.07 4h3.86a2 2 0 011.664.89l.812 1.22A2 2 0 0018.07 7H19a2 2 0 012 2v9a2 2 0 01-2 2H5a2 2 0 01-2-2V9z\"/>\n                    <path stroke-linecap=\"round\" stroke-linejoin=\"round\" stroke-width=\"2\" d=\"M15 13a3 3 0 11-6 0 3 3 0 016 0z\"/>\n                  </svg>\n                </div>\n                <input type=\"file\" id=\"avatar-input-hidden\" accept=\"image/*\" hidden>\n              `;\n            }\n          }\n          toast.success('Avatar updated');\n        } catch {\n          toast.error('Failed to upload avatar');\n        }\n      }\n    });\n  }\n\n  // Avatar URL input - live preview\n  const avatarUrlInput = container.querySelector('#avatar-url-input') as HTMLInputElement;\n  const avatarDisplay = container.querySelector('#profile-avatar-display img') as HTMLImageElement;\n  if (avatarUrlInput && avatarDisplay) {\n    on(avatarUrlInput, 'input', () => {\n      const url = avatarUrlInput.value.trim();\n      if (url) {\n        avatarDisplay.src = url;\n      } else if (currentProfile) {\n        // Use fallback if empty\n        avatarDisplay.src = generateFallbackAvatar(currentProfile.display_name || currentProfile.email);\n      }\n    });\n  }\n\n  // Profile form submit\n  const profileForm = container.querySelector('#profile-form') as HTMLFormElement;\n  if (profileForm) {\n    on(profileForm, 'submit', async (e) => {\n      e.preventDefault();\n      const formData = new FormData(profileForm);\n      const avatarUrl = (formData.get('avatar_url') as string)?.trim();\n      const displayName = formData.get('display_name') as string || undefined;\n\n      const data = {\n        username: formData.get('username') as string || undefined,\n        display_name: displayName,\n        bio: formData.get('bio') as string || undefined,\n        timezone: formData.get('timezone') as string || undefined,\n        locale: formData.get('locale') as string || undefined,\n        avatar_url: avatarUrl || (displayName ? generateFallbackAvatar(displayName) : undefined),\n      };\n\n      try {\n        const updated = await profileService.update(data);\n        currentProfile = updated;\n        toast.success('Profile updated');\n        currentProps.onUpdate?.(updated);\n\n        // Update the avatar display\n        if (avatarDisplay) {\n          avatarDisplay.src = updated.avatar_url || generateFallbackAvatar(updated.display_name || updated.email);\n        }\n      } catch {\n        toast.error('Failed to update profile');\n      }\n    });\n  }\n\n  // Password form submit\n  const passwordForm = container.querySelector('#password-form') as HTMLFormElement;\n  if (passwordForm) {\n    on(passwordForm, 'submit', async (e) => {\n      e.preventDefault();\n      const formData = new FormData(passwordForm);\n      const currentPassword = formData.get('current_password') as string;\n      const newPassword = formData.get('new_password') as string;\n      const confirmPassword = formData.get('confirm_password') as string;\n\n      if (newPassword !== confirmPassword) {\n        toast.error('Passwords do not match');\n        return;\n      }\n\n      try {\n        await profileService.changePassword({\n          current_password: currentPassword,\n          new_password: newPassword,\n        });\n        toast.success('Password changed');\n        passwordForm.reset();\n      } catch (error) {\n        toast.error(error instanceof Error ? error.message : 'Failed to change password');\n      }\n    });\n  }\n\n  // Delete account\n  const deleteAccountBtn = container.querySelector('#delete-account-btn');\n  if (deleteAccountBtn) {\n    on(deleteAccountBtn as HTMLElement, 'click', async () => {\n      const password = prompt('Enter your password to confirm account deletion:');\n      if (!password) return;\n\n      if (!confirm('Are you sure? This action cannot be undone.')) return;\n\n      try {\n        await profileService.deleteAccount(password);\n        closeModal(MODAL_ID);\n        toast.success('Account deleted');\n        window.location.reload();\n      } catch {\n        toast.error('Failed to delete account');\n      }\n    });\n  }\n\n  // Revoke all sessions\n  const revokeAllBtn = container.querySelector('#revoke-all-btn');\n  if (revokeAllBtn) {\n    on(revokeAllBtn as HTMLElement, 'click', async () => {\n      if (!confirm('Sign out from all other devices?')) return;\n\n      try {\n        await profileService.revokeAllSessions();\n        toast.success('All other sessions signed out');\n        loadSessions();\n      } catch {\n        toast.error('Failed to revoke sessions');\n      }\n    });\n  }\n}\n\n/**\n * Load sessions\n */\nasync function loadSessions(): Promise<void> {\n  const container = document.querySelector('#sessions-list');\n  if (!container) return;\n\n  try {\n    const sessions = await profileService.getSessions();\n\n    if (!sessions || sessions.length === 0) {\n      container.innerHTML = `\n        <div class=\"empty-state\">\n          <svg fill=\"none\" viewBox=\"0 0 24 24\" stroke=\"currentColor\">\n            <path stroke-linecap=\"round\" stroke-linejoin=\"round\" stroke-width=\"2\" d=\"M9.75 17L9 20l-1 1h8l-1-1-.75-3M3 13h18M5 17h14a2 2 0 002-2V5a2 2 0 00-2-2H5a2 2 0 00-2 2v10a2 2 0 002 2z\"/>\n          </svg>\n          <p>No active sessions found</p>\n        </div>\n      `;\n      return;\n    }\n\n    container.innerHTML = sessions.map(session => `\n      <div class=\"session-card ${session.is_current ? 'current' : ''}\">\n        <div class=\"session-info\">\n          <div class=\"session-icon\">\n            <svg fill=\"none\" viewBox=\"0 0 24 24\" stroke=\"currentColor\">\n              ${session.device?.toLowerCase().includes('mobile')\n        ? '<path stroke-linecap=\"round\" stroke-linejoin=\"round\" stroke-width=\"2\" d=\"M12 18h.01M8 21h8a2 2 0 002-2V5a2 2 0 00-2-2H8a2 2 0 00-2 2v14a2 2 0 002 2z\"/>'\n        : '<path stroke-linecap=\"round\" stroke-linejoin=\"round\" stroke-width=\"2\" d=\"M9.75 17L9 20l-1 1h8l-1-1-.75-3M3 13h18M5 17h14a2 2 0 002-2V5a2 2 0 00-2-2H5a2 2 0 00-2 2v10a2 2 0 002 2z\"/>'\n      }\n            </svg>\n          </div>\n          <div class=\"session-details\">\n            <h4>${escapeHtml(session.device || 'Unknown device')}</h4>\n            <p>${session.location ? `${escapeHtml(session.location)}  ` : ''}${escapeHtml(session.ip_address || 'Unknown IP')}  Last active: ${formatDate(session.last_active)}</p>\n          </div>\n        </div>\n        ${session.is_current\n        ? '<span class=\"session-badge\">Current</span>'\n        : `<button class=\"btn-sota secondary revoke-session-btn\" data-id=\"${session.id}\">Revoke</button>`\n      }\n      </div>\n    `).join('');\n\n    // Bind revoke buttons\n    container.querySelectorAll('.revoke-session-btn').forEach(btn => {\n      on(btn as HTMLElement, 'click', async () => {\n        const sessionId = btn.getAttribute('data-id');\n        if (!sessionId) return;\n\n        try {\n          await profileService.revokeSession(sessionId);\n          toast.success('Session revoked');\n          loadSessions();\n        } catch {\n          toast.error('Failed to revoke session');\n        }\n      });\n    });\n  } catch {\n    container.innerHTML = `\n      <div class=\"empty-state\">\n        <svg fill=\"none\" viewBox=\"0 0 24 24\" stroke=\"currentColor\">\n          <path stroke-linecap=\"round\" stroke-linejoin=\"round\" stroke-width=\"2\" d=\"M12 8v4m0 4h.01M21 12a9 9 0 11-18 0 9 9 0 0118 0z\"/>\n        </svg>\n        <p>Session management requires authentication</p>\n      </div>\n    `;\n  }\n}\n\n/**\n * Helper functions\n */\nfunction getInitials(name: string): string {\n  return name.split(' ').map(n => n[0]).join('').toUpperCase().slice(0, 2);\n}\n\n/**\n * Generate a fallback avatar URL using UI Avatars\n */\nfunction generateFallbackAvatar(name: string): string {\n  const encoded = encodeURIComponent(name || 'User');\n  return `https://ui-avatars.com/api/?name=${encoded}&background=e11d48&color=fff&size=200&font-size=0.4&bold=true`;\n}\n\n/**\n * Load timezones from API\n */\nasync function loadTimezones(): Promise<Timezone[]> {\n  if (cachedTimezones) {\n    return cachedTimezones;\n  }\n\n  try {\n    const response = await http.get<{ timezones: Timezone[] }>('/api/timezones');\n    cachedTimezones = response.data.timezones;\n    return cachedTimezones;\n  } catch {\n    // Fallback to minimal list\n    return [\n      { code: 'UTC', name: 'Coordinated Universal Time', utc_offset: '+00:00' },\n      { code: 'Europe/Lisbon', name: 'Lisbon, Portugal', utc_offset: '+00:00' },\n      { code: 'Europe/London', name: 'London, United Kingdom', utc_offset: '+00:00' },\n    ];\n  }\n}\n\n/**\n * Generate timezone options HTML - uses cached timezones or fallback\n */\nfunction generateTimezoneOptions(selected?: string, timezones?: Timezone[]): string {\n  const tzList = timezones || cachedTimezones || [\n    { code: 'UTC', name: 'Coordinated Universal Time', utc_offset: '+00:00' },\n  ];\n\n  // Group by region for better UX\n  const grouped = tzList.reduce((acc, tz) => {\n    const region = tz.region || 'Other';\n    if (!acc[region]) acc[region] = [];\n    acc[region].push(tz);\n    return acc;\n  }, {} as Record<string, Timezone[]>);\n\n  // Sort regions\n  const regionOrder = ['Europe', 'Americas', 'Asia', 'Oceania', 'Africa', 'Atlantic', 'UTC', 'Other'];\n  const sortedRegions = Object.keys(grouped).sort((a, b) => {\n    const aIdx = regionOrder.indexOf(a);\n    const bIdx = regionOrder.indexOf(b);\n    return (aIdx === -1 ? 999 : aIdx) - (bIdx === -1 ? 999 : bIdx);\n  });\n\n  let html = '';\n  for (const region of sortedRegions) {\n    html += `<optgroup label=\"${region}\">`;\n    for (const tz of grouped[region]) {\n      const label = `${tz.name} (${tz.utc_offset})`;\n      html += `<option value=\"${tz.code}\" ${selected === tz.code ? 'selected' : ''}>${label}</option>`;\n    }\n    html += '</optgroup>';\n  }\n\n  return html;\n}\n\nfunction formatDate(dateStr: string): string {\n  const date = new Date(dateStr);\n  const now = new Date();\n  const diff = now.getTime() - date.getTime();\n\n  if (diff < 60000) return 'Just now';\n  if (diff < 3600000) return `${Math.floor(diff / 60000)} min ago`;\n  if (diff < 86400000) return `${Math.floor(diff / 3600000)} hours ago`;\n  if (diff < 604800000) return `${Math.floor(diff / 86400000)} days ago`;\n\n  return date.toLocaleDateString();\n}\n\nfunction escapeHtml(text: string): string {\n  const div = document.createElement('div');\n  div.textContent = text;\n  return div.innerHTML;\n}\n\n/**\n * Load Krisp integration content\n */\nasync function loadKrispIntegration(container: HTMLElement): Promise<void> {\n  const contentEl = container.querySelector('#krisp-integration-content');\n  if (!contentEl) return;\n\n  // Check if user is superadmin (has MCP access)\n  const currentUser = appStore.getState().currentUser;\n  const isSuperAdmin = currentUser?.role === 'superadmin';\n\n  try {\n    const webhook = await krispService.getWebhook();\n    const summary = await krispService.getTranscriptsSummary();\n\n    if (!webhook) {\n      contentEl.innerHTML = `\n        <div class=\"krisp-not-configured\">\n          <p>Krisp integration is not configured yet.</p>\n          <button type=\"button\" class=\"btn-sota primary\" id=\"enable-krisp-btn\">\n            <svg width=\"16\" height=\"16\" fill=\"none\" viewBox=\"0 0 24 24\" stroke=\"currentColor\">\n              <path stroke-linecap=\"round\" stroke-linejoin=\"round\" stroke-width=\"2\" d=\"M12 6v6m0 0v6m0-6h6m-6 0H6\"/>\n            </svg>\n            Enable Krisp Integration\n          </button>\n        </div>\n      `;\n\n      const enableBtn = contentEl.querySelector('#enable-krisp-btn');\n      if (enableBtn) {\n        on(enableBtn as HTMLElement, 'click', async () => {\n          try {\n            await krispService.getWebhook(); // This creates the webhook if it doesn't exist\n            loadKrispIntegration(container);\n            toast.success('Krisp integration enabled');\n          } catch {\n            toast.error('Failed to enable Krisp integration');\n          }\n        });\n      }\n      return;\n    }\n\n    // Show webhook configuration\n    contentEl.innerHTML = `\n      <div class=\"krisp-config\">\n        ${isSuperAdmin ? `\n        <div class=\"krisp-mcp-banner\">\n          <div class=\"mcp-icon\">\n            <svg width=\"20\" height=\"20\" fill=\"none\" viewBox=\"0 0 24 24\" stroke=\"currentColor\">\n              <path stroke-linecap=\"round\" stroke-linejoin=\"round\" stroke-width=\"2\" d=\"M13 10V3L4 14h7v7l9-11h-7z\"/>\n            </svg>\n          </div>\n          <div class=\"mcp-info\">\n            <strong>MCP Direct Access</strong>\n            <span>As a Super Admin, you can import meetings directly via MCP without webhook configuration.</span>\n          </div>\n          <button type=\"button\" class=\"btn-sota primary\" id=\"mcp-import-btn\">\n            Import via MCP\n          </button>\n        </div>\n        ` : ''}\n        \n        <div class=\"krisp-status\">\n          <span class=\"status-indicator ${webhook.is_active ? 'active' : 'inactive'}\"></span>\n          <span>${webhook.is_active ? 'Active' : 'Inactive'}</span>\n          <button type=\"button\" class=\"btn-sota small ${webhook.is_active ? 'secondary' : 'primary'}\" id=\"toggle-krisp-btn\">\n            ${webhook.is_active ? 'Disable' : 'Enable'}\n          </button>\n        </div>\n\n        <div class=\"form-field\">\n          <label>Webhook URL</label>\n          <div class=\"input-with-copy\">\n            <input type=\"text\" value=\"${escapeHtml(webhook.webhook_url)}\" readonly>\n            <button type=\"button\" class=\"btn-copy\" data-copy=\"${escapeHtml(webhook.webhook_url)}\" title=\"Copy URL\">\n              <svg width=\"16\" height=\"16\" fill=\"none\" viewBox=\"0 0 24 24\" stroke=\"currentColor\">\n                <path stroke-linecap=\"round\" stroke-linejoin=\"round\" stroke-width=\"2\" d=\"M8 16H6a2 2 0 01-2-2V6a2 2 0 012-2h8a2 2 0 012 2v2m-6 12h8a2 2 0 002-2v-8a2 2 0 00-2-2h-8a2 2 0 00-2 2v8a2 2 0 002 2z\"/>\n              </svg>\n            </button>\n          </div>\n        </div>\n\n        <div class=\"form-field\">\n          <label>Authorization Token</label>\n          <div class=\"input-with-copy\">\n            <input type=\"password\" value=\"${escapeHtml(webhook.webhook_secret)}\" readonly id=\"krisp-secret-input\">\n            <button type=\"button\" class=\"btn-toggle-visibility\" id=\"toggle-secret-btn\" title=\"Show/Hide\">\n              <svg width=\"16\" height=\"16\" fill=\"none\" viewBox=\"0 0 24 24\" stroke=\"currentColor\">\n                <path stroke-linecap=\"round\" stroke-linejoin=\"round\" stroke-width=\"2\" d=\"M15 12a3 3 0 11-6 0 3 3 0 016 0z\"/>\n                <path stroke-linecap=\"round\" stroke-linejoin=\"round\" stroke-width=\"2\" d=\"M2.458 12C3.732 7.943 7.523 5 12 5c4.478 0 8.268 2.943 9.542 7-1.274 4.057-5.064 7-9.542 7-4.477 0-8.268-2.943-9.542-7z\"/>\n              </svg>\n            </button>\n            <button type=\"button\" class=\"btn-copy\" data-copy=\"${escapeHtml(webhook.webhook_secret)}\" title=\"Copy Token\">\n              <svg width=\"16\" height=\"16\" fill=\"none\" viewBox=\"0 0 24 24\" stroke=\"currentColor\">\n                <path stroke-linecap=\"round\" stroke-linejoin=\"round\" stroke-width=\"2\" d=\"M8 16H6a2 2 0 01-2-2V6a2 2 0 012-2h8a2 2 0 012 2v2m-6 12h8a2 2 0 002-2v-8a2 2 0 00-2-2h-8a2 2 0 00-2 2v8a2 2 0 002 2z\"/>\n              </svg>\n            </button>\n          </div>\n          <span class=\"form-hint\">Use this token in the Authorization header when configuring Krisp webhook.</span>\n        </div>\n\n        <div class=\"krisp-stats\">\n          <div class=\"stat\">\n            <span class=\"stat-value\">${summary?.total_count || 0}</span>\n            <span class=\"stat-label\">Total Transcripts</span>\n          </div>\n          <div class=\"stat\">\n            <span class=\"stat-value\">${summary?.processed_count || 0}</span>\n            <span class=\"stat-label\">Processed</span>\n          </div>\n          <div class=\"stat ${(summary?.quarantine_count || 0) + (summary?.ambiguous_count || 0) > 0 ? 'warning' : ''}\">\n            <span class=\"stat-value\">${(summary?.quarantine_count || 0) + (summary?.ambiguous_count || 0)}</span>\n            <span class=\"stat-label\">Need Attention</span>\n          </div>\n        </div>\n\n        <div class=\"form-actions\">\n          <button type=\"button\" class=\"btn-sota secondary\" id=\"regenerate-krisp-btn\">\n            <svg width=\"16\" height=\"16\" fill=\"none\" viewBox=\"0 0 24 24\" stroke=\"currentColor\">\n              <path stroke-linecap=\"round\" stroke-linejoin=\"round\" stroke-width=\"2\" d=\"M4 4v5h.582m15.356 2A8.001 8.001 0 004.582 9m0 0H9m11 11v-5h-.581m0 0a8.003 8.003 0 01-15.357-2m15.357 2H15\"/>\n            </svg>\n            Regenerate Credentials\n          </button>\n          <a href=\"#\" class=\"btn-sota primary\" id=\"view-transcripts-btn\">\n            View Transcripts\n          </a>\n        </div>\n      </div>\n      \n      <style>\n        .krisp-config { padding: 16px 0; }\n        .krisp-status { display: flex; align-items: center; gap: 8px; margin-bottom: 16px; }\n        .status-indicator { width: 8px; height: 8px; border-radius: 50%; }\n        .status-indicator.active { background: #22c55e; }\n        .status-indicator.inactive { background: #94a3b8; }\n        .input-with-copy { display: flex; gap: 8px; }\n        .input-with-copy input { flex: 1; }\n        .btn-copy, .btn-toggle-visibility { padding: 8px; background: var(--bg-secondary, #f1f5f9); border: 1px solid var(--border-color, #e2e8f0); border-radius: 6px; cursor: pointer; }\n        .btn-copy:hover, .btn-toggle-visibility:hover { background: var(--bg-tertiary, #e2e8f0); }\n        .krisp-stats { display: flex; gap: 16px; margin: 24px 0; padding: 16px; background: var(--bg-secondary, #f8fafc); border-radius: 12px; }\n        .stat { flex: 1; text-align: center; }\n        .stat-value { display: block; font-size: 24px; font-weight: 600; color: var(--text-primary, #1e293b); }\n        .stat-label { font-size: 12px; color: var(--text-secondary, #64748b); }\n        .stat.warning .stat-value { color: #f59e0b; }\n        .btn-sota.small { padding: 4px 12px; font-size: 12px; }\n        .krisp-not-configured { text-align: center; padding: 32px; }\n        .krisp-not-configured p { margin-bottom: 16px; color: var(--text-secondary, #64748b); }\n        .krisp-mcp-banner {\n          display: flex;\n          align-items: center;\n          gap: 12px;\n          padding: 16px;\n          background: linear-gradient(135deg, #dbeafe 0%, #e0f2fe 100%);\n          border: 1px solid #93c5fd;\n          border-radius: 12px;\n          margin-bottom: 20px;\n        }\n        .mcp-icon {\n          width: 40px;\n          height: 40px;\n          background: linear-gradient(135deg, #3b82f6 0%, #1d4ed8 100%);\n          border-radius: 10px;\n          display: flex;\n          align-items: center;\n          justify-content: center;\n          flex-shrink: 0;\n        }\n        .mcp-icon svg { color: white; }\n        .mcp-info {\n          flex: 1;\n          display: flex;\n          flex-direction: column;\n          gap: 2px;\n        }\n        .mcp-info strong {\n          font-size: 14px;\n          color: #1e40af;\n        }\n        .mcp-info span {\n          font-size: 12px;\n          color: #3b82f6;\n        }\n        .krisp-mcp-banner .btn-sota {\n          flex-shrink: 0;\n        }\n        [data-theme=\"dark\"] .krisp-mcp-banner {\n          background: linear-gradient(135deg, rgba(59,130,246,0.15) 0%, rgba(29,78,216,0.1) 100%);\n          border-color: rgba(59,130,246,0.3);\n        }\n        [data-theme=\"dark\"] .mcp-info strong { color: #93c5fd; }\n        [data-theme=\"dark\"] .mcp-info span { color: #60a5fa; }\n        [data-theme=\"dark\"] .krisp-stats { background: rgba(30,41,59,0.5); }\n        [data-theme=\"dark\"] .btn-copy, [data-theme=\"dark\"] .btn-toggle-visibility { background: rgba(30,41,59,0.8); border-color: rgba(255,255,255,0.1); }\n      </style>\n    `;\n\n    // Bind copy buttons\n    contentEl.querySelectorAll('.btn-copy').forEach(btn => {\n      on(btn as HTMLElement, 'click', () => {\n        const text = btn.getAttribute('data-copy') || '';\n        navigator.clipboard.writeText(text);\n        toast.success('Copied to clipboard');\n      });\n    });\n\n    // Toggle secret visibility\n    const toggleSecretBtn = contentEl.querySelector('#toggle-secret-btn');\n    const secretInput = contentEl.querySelector('#krisp-secret-input') as HTMLInputElement;\n    if (toggleSecretBtn && secretInput) {\n      on(toggleSecretBtn as HTMLElement, 'click', () => {\n        secretInput.type = secretInput.type === 'password' ? 'text' : 'password';\n      });\n    }\n\n    // MCP Import button (superadmin only)\n    const mcpImportBtn = contentEl.querySelector('#mcp-import-btn');\n    if (mcpImportBtn) {\n      on(mcpImportBtn as HTMLElement, 'click', async () => {\n        closeModal(MODAL_ID);\n        // Open KrispManager directly on the Import tab\n        const { showKrispManager } = await import('./KrispManager');\n        showKrispManager('import');\n      });\n    }\n\n    // Toggle webhook\n    const toggleBtn = contentEl.querySelector('#toggle-krisp-btn');\n    if (toggleBtn) {\n      on(toggleBtn as HTMLElement, 'click', async () => {\n        const newState = !webhook.is_active;\n        const success = await krispService.toggleWebhook(newState);\n        if (success) {\n          toast.success(newState ? 'Krisp integration enabled' : 'Krisp integration disabled');\n          loadKrispIntegration(container);\n        } else {\n          toast.error('Failed to update integration');\n        }\n      });\n    }\n\n    // Regenerate credentials\n    const regenerateBtn = contentEl.querySelector('#regenerate-krisp-btn');\n    if (regenerateBtn) {\n      on(regenerateBtn as HTMLElement, 'click', async () => {\n        if (!confirm('Are you sure? You will need to update the webhook URL in Krisp.')) return;\n\n        const newWebhook = await krispService.regenerateWebhook();\n        if (newWebhook) {\n          toast.success('Credentials regenerated');\n          loadKrispIntegration(container);\n        } else {\n          toast.error('Failed to regenerate credentials');\n        }\n      });\n    }\n\n    // View transcripts link\n    const viewTranscriptsBtn = contentEl.querySelector('#view-transcripts-btn');\n    if (viewTranscriptsBtn) {\n      on(viewTranscriptsBtn as HTMLElement, 'click', async (e) => {\n        e.preventDefault();\n        closeModal(MODAL_ID);\n        // Open KrispManager modal\n        const { showKrispManager } = await import('./KrispManager');\n        showKrispManager();\n      });\n    }\n\n  } catch (error) {\n    console.error('[ProfileModal] Krisp integration error:', error);\n    contentEl.innerHTML = `\n      <div class=\"error-message\">\n        <p>Failed to load Krisp integration. Please try again.</p>\n        <button type=\"button\" class=\"btn-sota secondary\" id=\"retry-krisp-btn\">Retry</button>\n      </div>\n    `;\n\n    const retryBtn = contentEl.querySelector('#retry-krisp-btn');\n    if (retryBtn) {\n      on(retryBtn as HTMLElement, 'click', () => loadKrispIntegration(container));\n    }\n  }\n}\n\nexport function closeProfileModal(): void {\n  closeModal(MODAL_ID);\n}\n\n/**\n * Create the profile view root element (same content as modal, no wrapper).\n * Used for embedding profile in a tab/page.\n */\nexport function createProfileView(): HTMLElement {\n  return createModalContent();\n}\n\n/**\n * Initialize profile as a full page inside the given container (no modal).\n * Use when showing Profile in a tab; close button will call onBack.\n */\nexport function initProfilePage(container: HTMLElement, options: { onBack?: () => void } = {}): void {\n  container.innerHTML = '';\n  const view = createModalContent();\n  container.appendChild(view);\n  loadProfile(view, { onBack: options.onBack });\n}\n","/**\r\n * Fact Modal\r\n * CRUD modal for facts\r\n */\r\n\r\nimport { createModal, openModal, closeModal } from '@components/Modal';\r\nimport { createElement, on } from '@lib/dom';\r\nimport { factsService, Fact, CreateFactRequest } from '@services/facts';\r\nimport { toast } from '@services/toast';\r\n\r\nconst MODAL_ID = 'fact-modal';\r\n\r\nexport interface FactModalProps {\r\n  mode: 'view' | 'create' | 'edit';\r\n  fact?: Fact;\r\n  onSave?: (fact: Fact) => void;\r\n  onDelete?: (factId: string | number) => void;\r\n  onClose?: () => void;\r\n}\r\n\r\nlet currentProps: FactModalProps = { mode: 'create' };\r\n\r\n/**\r\n * Show fact modal\r\n */\r\nexport function showFactModal(props: FactModalProps): void {\r\n  currentProps = props;\r\n\r\n  const title = props.mode === 'create'\r\n    ? 'Add Fact'\r\n    : props.mode === 'edit'\r\n      ? 'Edit Fact'\r\n      : 'View Fact';\r\n\r\n  const modal = createModal({\r\n    id: MODAL_ID,\r\n    title,\r\n    size: 'md',\r\n    content: createModalContent(props),\r\n    onClose: props.onClose,\r\n  });\r\n\r\n  document.body.appendChild(modal);\r\n  openModal(MODAL_ID);\r\n}\r\n\r\n/**\r\n * Create modal content\r\n */\r\nfunction createModalContent(props: FactModalProps): HTMLElement {\r\n  const container = createElement('div', { className: 'fact-modal-content' });\r\n  const fact = props.fact;\r\n  const isViewMode = props.mode === 'view';\r\n\r\n  container.innerHTML = `\r\n    <form id=\"fact-form\" class=\"fact-form\">\r\n      <div class=\"form-group\">\r\n        <label for=\"content\">Fact Content *</label>\r\n        <textarea id=\"content\" name=\"content\" rows=\"4\" required \r\n                  ${isViewMode ? 'disabled' : ''}\r\n                  placeholder=\"Enter the fact...\">${escapeHtml(fact?.content || '')}</textarea>\r\n      </div>\r\n\r\n      <div class=\"form-row\">\r\n        <div class=\"form-group\">\r\n          <label for=\"source\">Source</label>\r\n          <input type=\"text\" id=\"source\" name=\"source\" \r\n                 ${isViewMode ? 'disabled' : ''}\r\n                 value=\"${escapeHtml(fact?.source || '')}\"\r\n                 placeholder=\"Document, conversation, etc.\">\r\n        </div>\r\n        <div class=\"form-group\">\r\n          <label for=\"category\">Category</label>\r\n          <input type=\"text\" id=\"category\" name=\"category\" \r\n                 ${isViewMode ? 'disabled' : ''}\r\n                 value=\"${escapeHtml(fact?.category || '')}\"\r\n                 placeholder=\"Technical, Business, etc.\">\r\n        </div>\r\n      </div>\r\n\r\n      ${fact?.verified ? `\r\n        <div class=\"verified-info\">\r\n          <span class=\"verified-badge\"> Verified</span>\r\n          ${fact.verified_by ? `<span>by ${escapeHtml(fact.verified_by)}</span>` : ''}\r\n          ${fact.verified_at ? `<span>on ${formatDate(fact.verified_at)}</span>` : ''}\r\n        </div>\r\n      ` : ''}\r\n\r\n      ${fact?.source_file ? `\r\n        <div class=\"source-file\">\r\n          <span class=\"label\">Source File:</span>\r\n          <span class=\"value\">${escapeHtml(fact.source_file)}</span>\r\n        </div>\r\n      ` : ''}\r\n\r\n      ${fact ? `\r\n        <div class=\"metadata\">\r\n          <span>Created: ${formatDate(fact.created_at)}</span>\r\n          ${fact.updated_at ? `<span>Updated: ${formatDate(fact.updated_at)}</span>` : ''}\r\n        </div>\r\n      ` : ''}\r\n\r\n      <div class=\"form-actions\">\r\n        ${props.mode === 'view' ? `\r\n          <button type=\"button\" class=\"btn btn-secondary\" id=\"edit-btn\">Edit</button>\r\n          ${!fact?.verified ? `<button type=\"button\" class=\"btn btn-success\" id=\"verify-btn\">Verify</button>` : ''}\r\n          <button type=\"button\" class=\"btn btn-danger\" id=\"delete-btn\">Delete</button>\r\n        ` : `\r\n          <button type=\"button\" class=\"btn btn-secondary\" id=\"cancel-btn\">Cancel</button>\r\n          <button type=\"submit\" class=\"btn btn-primary\">\r\n            ${props.mode === 'create' ? 'Add Fact' : 'Save Changes'}\r\n          </button>\r\n        `}\r\n      </div>\r\n    </form>\r\n  `;\r\n\r\n  bindEvents(container, props);\r\n  return container;\r\n}\r\n\r\n/**\r\n * Bind event handlers\r\n */\r\nfunction bindEvents(container: HTMLElement, props: FactModalProps): void {\r\n  const form = container.querySelector('#fact-form') as HTMLFormElement;\r\n\r\n  // Form submit\r\n  if (form) {\r\n    on(form, 'submit', async (e) => {\r\n      e.preventDefault();\r\n\r\n      const formData = new FormData(form);\r\n      const data: CreateFactRequest = {\r\n        content: formData.get('content') as string,\r\n        source: formData.get('source') as string || undefined,\r\n        category: formData.get('category') as string || undefined,\r\n      };\r\n\r\n      if (!data.content.trim()) {\r\n        toast.error('Fact content is required');\r\n        return;\r\n      }\r\n\r\n      try {\r\n        let savedFact: Fact;\r\n\r\n        if (props.mode === 'create') {\r\n          savedFact = await factsService.create(data);\r\n          toast.success('Fact added');\r\n        } else {\r\n          savedFact = await factsService.update(props.fact!.id, data);\r\n          toast.success('Fact updated');\r\n        }\r\n\r\n        closeModal(MODAL_ID);\r\n        props.onSave?.(savedFact);\r\n      } catch {\r\n        toast.error('Failed to save fact');\r\n      }\r\n    });\r\n  }\r\n\r\n  // Cancel button\r\n  const cancelBtn = container.querySelector('#cancel-btn');\r\n  if (cancelBtn) {\r\n    on(cancelBtn as HTMLElement, 'click', () => {\r\n      closeModal(MODAL_ID);\r\n    });\r\n  }\r\n\r\n  // Edit button (in view mode)\r\n  const editBtn = container.querySelector('#edit-btn');\r\n  if (editBtn) {\r\n    on(editBtn as HTMLElement, 'click', () => {\r\n      closeModal(MODAL_ID);\r\n      showFactModal({\r\n        ...props,\r\n        mode: 'edit',\r\n      });\r\n    });\r\n  }\r\n\r\n  // Verify button\r\n  const verifyBtn = container.querySelector('#verify-btn');\r\n  if (verifyBtn && props.fact) {\r\n    on(verifyBtn as HTMLElement, 'click', async () => {\r\n      try {\r\n        const verifiedFact = await factsService.verify(props.fact!.id);\r\n        toast.success('Fact verified');\r\n        closeModal(MODAL_ID);\r\n        props.onSave?.(verifiedFact);\r\n      } catch {\r\n        toast.error('Failed to verify fact');\r\n      }\r\n    });\r\n  }\r\n\r\n  // Delete button\r\n  const deleteBtn = container.querySelector('#delete-btn');\r\n  if (deleteBtn && props.fact) {\r\n    on(deleteBtn as HTMLElement, 'click', async () => {\r\n      if (!confirm('Are you sure you want to delete this fact?')) return;\r\n\r\n      try {\r\n        await factsService.delete(props.fact!.id);\r\n        toast.success('Fact deleted');\r\n        closeModal(MODAL_ID);\r\n        props.onDelete?.(props.fact!.id);\r\n      } catch {\r\n        toast.error('Failed to delete fact');\r\n      }\r\n    });\r\n  }\r\n}\r\n\r\n/**\r\n * Format date\r\n */\r\nfunction formatDate(dateStr: string): string {\r\n  const date = new Date(dateStr);\r\n  return date.toLocaleDateString();\r\n}\r\n\r\n/**\r\n * Escape HTML\r\n */\r\nfunction escapeHtml(text: string): string {\r\n  const div = document.createElement('div');\r\n  div.textContent = text;\r\n  return div.innerHTML;\r\n}\r\n\r\nexport function closeFactModal(): void {\r\n  closeModal(MODAL_ID);\r\n}\r\n","/**\r\n * Briefing Panel Component\r\n * Displays daily AI-generated briefing with history\r\n */\r\n\r\nimport { createElement, on } from '@lib/dom';\r\nimport { chatService, Briefing, BriefingHistoryItem } from '@services/chat';\r\nimport { toast } from '@services/toast';\r\nimport { formatRelativeTime } from '@lib/format';\r\n\r\nexport interface BriefingPanelProps {\r\n  onActionClick?: (action: { type: string; id: string }) => void;\r\n}\r\n\r\nlet currentBriefing: Briefing | null = null;\r\nlet showHistory = false;\r\n\r\n/**\r\n * Create briefing panel\r\n */\r\nexport function createBriefingPanel(props: BriefingPanelProps = {}): HTMLElement {\r\n  const panel = createElement('div', { className: 'briefing-panel' });\r\n\r\n  panel.innerHTML = `\r\n    <div class=\"briefing-header\">\r\n      <h2>Daily Briefing</h2>\r\n      <div class=\"briefing-actions\">\r\n        <button class=\"btn btn-sm\" id=\"toggle-history-btn\">History</button>\r\n        <button class=\"btn btn-sm btn-primary\" id=\"refresh-briefing-btn\">Refresh</button>\r\n      </div>\r\n    </div>\r\n    <div class=\"briefing-content\" id=\"briefing-content\">\r\n      <div class=\"loading\">Generating briefing...</div>\r\n    </div>\r\n    <div class=\"briefing-history hidden\" id=\"briefing-history\"></div>\r\n  `;\r\n\r\n  // Bind events\r\n  const refreshBtn = panel.querySelector('#refresh-briefing-btn');\r\n  if (refreshBtn) {\r\n    on(refreshBtn as HTMLElement, 'click', () => loadBriefing(panel, true, props));\r\n  }\r\n\r\n  const historyBtn = panel.querySelector('#toggle-history-btn');\r\n  if (historyBtn) {\r\n    on(historyBtn as HTMLElement, 'click', () => {\r\n      showHistory = !showHistory;\r\n      const historyContainer = panel.querySelector('#briefing-history') as HTMLElement;\r\n      historyContainer.classList.toggle('hidden', !showHistory);\r\n      if (showHistory) {\r\n        loadHistory(historyContainer);\r\n      }\r\n    });\r\n  }\r\n\r\n  // Initial load\r\n  loadBriefing(panel, false, props);\r\n\r\n  return panel;\r\n}\r\n\r\n/**\r\n * Load briefing\r\n */\r\nasync function loadBriefing(\r\n  panel: HTMLElement,\r\n  refresh: boolean,\r\n  props: BriefingPanelProps\r\n): Promise<void> {\r\n  const content = panel.querySelector('#briefing-content') as HTMLElement;\r\n  content.innerHTML = '<div class=\"loading\">Generating briefing...</div>';\r\n\r\n  try {\r\n    const briefing = await chatService.getBriefing(refresh);\r\n    currentBriefing = briefing;\r\n    renderBriefing(content, briefing, props);\r\n  } catch {\r\n    content.innerHTML = '<div class=\"error\">Failed to generate briefing</div>';\r\n  }\r\n}\r\n\r\n/**\r\n * Render briefing content\r\n */\r\nfunction renderBriefing(\r\n  container: HTMLElement,\r\n  briefing: Briefing,\r\n  props: BriefingPanelProps\r\n): void {\r\n  container.innerHTML = `\r\n    <div class=\"briefing-meta\">\r\n      <span class=\"briefing-date\">${formatDate(briefing.generated_at)}</span>\r\n      ${briefing.cached ? `<span class=\"cached-badge\">Cached</span>` : ''}\r\n    </div>\r\n\r\n    <div class=\"briefing-text\">\r\n      ${renderMarkdown(briefing.briefing)}\r\n    </div>\r\n\r\n    ${briefing.analysis ? `\r\n      <div class=\"briefing-analysis\">\r\n        <h4>Analysis</h4>\r\n        <div class=\"analysis-content\">${renderMarkdown(briefing.analysis)}</div>\r\n      </div>\r\n    ` : ''}\r\n\r\n  `;\r\n}\r\n\r\n/**\r\n * Load briefing history\r\n */\r\nasync function loadHistory(container: HTMLElement): Promise<void> {\r\n  container.innerHTML = '<div class=\"loading\">Loading history...</div>';\r\n\r\n  try {\r\n    const history = await chatService.getBriefingHistory(10);\r\n\r\n    if (!history || history.length === 0) {\r\n      container.innerHTML = '<p class=\"empty\">No previous briefings</p>';\r\n      return;\r\n    }\r\n\r\n    container.innerHTML = `\r\n      <h4>Previous Briefings</h4>\r\n      <div class=\"history-list\">\r\n        ${history.map((item: BriefingHistoryItem) => `\r\n          <div class=\"history-item\" data-id=\"${item.id}\">\r\n            <div class=\"history-date\">${formatDate(item.generated_at)}</div>\r\n            <div class=\"history-preview\">${escapeHtml(item.briefing.substring(0, 150))}...</div>\r\n          </div>\r\n        `).join('')}\r\n      </div>\r\n    `;\r\n\r\n    // Bind click events\r\n    container.querySelectorAll('.history-item').forEach(item => {\r\n      on(item as HTMLElement, 'click', () => {\r\n        const id = item.getAttribute('data-id');\r\n        const historyItem = history.find((h: BriefingHistoryItem) => h.id === id);\r\n        if (historyItem) {\r\n          showHistoryDetail(container.closest('.briefing-panel') as HTMLElement, historyItem);\r\n        }\r\n      });\r\n    });\r\n  } catch {\r\n    container.innerHTML = '<div class=\"error\">Failed to load history</div>';\r\n  }\r\n}\r\n\r\n/**\r\n * Show history detail\r\n */\r\nfunction showHistoryDetail(panel: HTMLElement, item: BriefingHistoryItem): void {\r\n  const content = panel.querySelector('#briefing-content') as HTMLElement;\r\n\r\n  content.innerHTML = `\r\n    <div class=\"history-detail\">\r\n      <button class=\"btn btn-sm back-btn\" id=\"back-to-current\"> Back to current</button>\r\n      <div class=\"briefing-meta\">\r\n        <span class=\"briefing-date\">${formatDate(item.generated_at)}</span>\r\n        <span class=\"history-badge\">Historical</span>\r\n      </div>\r\n      <div class=\"briefing-text\">${renderMarkdown(item.briefing)}</div>\r\n    </div>\r\n  `;\r\n\r\n  const backBtn = content.querySelector('#back-to-current');\r\n  if (backBtn && currentBriefing) {\r\n    on(backBtn as HTMLElement, 'click', () => {\r\n      renderBriefing(content, currentBriefing!, {});\r\n    });\r\n  }\r\n}\r\n\r\n/**\r\n * Simple markdown renderer\r\n */\r\nfunction renderMarkdown(text: string): string {\r\n  return text\r\n    .replace(/\\*\\*(.*?)\\*\\*/g, '<strong>$1</strong>')\r\n    .replace(/\\*(.*?)\\*/g, '<em>$1</em>')\r\n    .replace(/^### (.*$)/gm, '<h5>$1</h5>')\r\n    .replace(/^## (.*$)/gm, '<h4>$1</h4>')\r\n    .replace(/^# (.*$)/gm, '<h3>$1</h3>')\r\n    .replace(/^- (.*$)/gm, '<li>$1</li>')\r\n    .replace(/(<li>.*<\\/li>)/gs, '<ul>$1</ul>')\r\n    .replace(/\\n\\n/g, '</p><p>')\r\n    .replace(/^(.+)$/gm, '<p>$1</p>')\r\n    .replace(/<p><\\/p>/g, '')\r\n    .replace(/<p>(<[hul])/g, '$1')\r\n    .replace(/(<\\/[hul][^>]*>)<\\/p>/g, '$1');\r\n}\r\n\r\n/**\r\n * Format date\r\n */\r\nfunction formatDate(dateStr: string): string {\r\n  const date = new Date(dateStr);\r\n  return date.toLocaleDateString(undefined, {\r\n    weekday: 'long',\r\n    year: 'numeric',\r\n    month: 'long',\r\n    day: 'numeric',\r\n    hour: '2-digit',\r\n    minute: '2-digit',\r\n  });\r\n}\r\n\r\n/**\r\n * Format label\r\n */\r\nfunction formatLabel(key: string): string {\r\n  return key\r\n    .replace(/_/g, ' ')\r\n    .replace(/([A-Z])/g, ' $1')\r\n    .replace(/^./, str => str.toUpperCase());\r\n}\r\n\r\n/**\r\n * Escape HTML\r\n */\r\nfunction escapeHtml(text: string): string {\r\n  const div = document.createElement('div');\r\n  div.textContent = text;\r\n  return div.innerHTML;\r\n}\r\n\r\nexport default createBriefingPanel;\r\n","/**\r\n * Notifications Dropdown Component\r\n * Bell icon with notification list in header\r\n */\r\n\r\nimport { createElement, on } from '@lib/dom';\r\nimport { notificationsService, Notification } from '@services/notifications';\r\nimport { toast } from '@services/toast';\r\nimport { formatRelativeTime } from '@lib/format';\r\n\r\nexport interface NotificationsDropdownProps {\r\n  onNotificationClick?: (notification: Notification) => void;\r\n}\r\n\r\nlet isOpen = false;\r\nlet unreadCount = 0;\r\n\r\n/**\r\n * Create notifications dropdown\r\n */\r\nexport function createNotificationsDropdown(props: NotificationsDropdownProps = {}): HTMLElement {\r\n  const container = createElement('div', { className: 'notifications-dropdown' });\r\n\r\n  container.innerHTML = `\r\n    <button class=\"notifications-trigger\" id=\"notifications-trigger\">\r\n      <span class=\"bell-icon\"></span>\r\n      <span class=\"notification-badge hidden\" id=\"notification-badge\">0</span>\r\n    </button>\r\n    <div class=\"notifications-panel hidden\" id=\"notifications-panel\">\r\n      <div class=\"notifications-header\">\r\n        <h3>Notifications</h3>\r\n        <button class=\"btn-link\" id=\"mark-all-read\">Mark all read</button>\r\n      </div>\r\n      <div class=\"notifications-list\" id=\"notifications-list\">\r\n        <div class=\"loading\">Loading...</div>\r\n      </div>\r\n    </div>\r\n  `;\r\n\r\n  // Bind trigger click\r\n  const trigger = container.querySelector('#notifications-trigger');\r\n  if (trigger) {\r\n    on(trigger as HTMLElement, 'click', (e) => {\r\n      e.stopPropagation();\r\n      toggleDropdown(container, props);\r\n    });\r\n  }\r\n\r\n  // Mark all as read\r\n  const markAllBtn = container.querySelector('#mark-all-read');\r\n  if (markAllBtn) {\r\n    on(markAllBtn as HTMLElement, 'click', async () => {\r\n      try {\r\n        await notificationsService.markAllRead();\r\n        toast.success('All notifications marked as read');\r\n        loadNotifications(container, props);\r\n        updateBadge(container, 0);\r\n      } catch {\r\n        toast.error('Failed to mark notifications as read');\r\n      }\r\n    });\r\n  }\r\n\r\n  // Close on outside click\r\n  document.addEventListener('click', () => {\r\n    closeDropdown(container);\r\n  });\r\n\r\n  // Initial count load\r\n  loadUnreadCount(container);\r\n\r\n  // Periodic refresh\r\n  setInterval(() => loadUnreadCount(container), 60000);\r\n\r\n  return container;\r\n}\r\n\r\n/**\r\n * Toggle dropdown\r\n */\r\nfunction toggleDropdown(container: HTMLElement, props: NotificationsDropdownProps): void {\r\n  isOpen = !isOpen;\r\n  const panel = container.querySelector('#notifications-panel');\r\n\r\n  if (panel) {\r\n    panel.classList.toggle('hidden', !isOpen);\r\n\r\n    if (isOpen) {\r\n      loadNotifications(container, props);\r\n    }\r\n  }\r\n}\r\n\r\n/**\r\n * Close dropdown\r\n */\r\nfunction closeDropdown(container: HTMLElement): void {\r\n  isOpen = false;\r\n  const panel = container.querySelector('#notifications-panel');\r\n  if (panel) {\r\n    panel.classList.add('hidden');\r\n  }\r\n}\r\n\r\n/**\r\n * Load unread count\r\n */\r\nasync function loadUnreadCount(container: HTMLElement): Promise<void> {\r\n  try {\r\n    const count = await notificationsService.getUnreadCount();\r\n    unreadCount = count;\r\n    updateBadge(container, count);\r\n  } catch {\r\n    // Ignore\r\n  }\r\n}\r\n\r\n/**\r\n * Update badge\r\n */\r\nfunction updateBadge(container: HTMLElement, count: number): void {\r\n  const badge = container.querySelector('#notification-badge') as HTMLElement;\r\n  if (badge) {\r\n    badge.textContent = count > 99 ? '99+' : String(count);\r\n    badge.classList.toggle('hidden', count === 0);\r\n  }\r\n}\r\n\r\n/**\r\n * Load notifications\r\n */\r\nasync function loadNotifications(container: HTMLElement, props: NotificationsDropdownProps): Promise<void> {\r\n  const list = container.querySelector('#notifications-list') as HTMLElement;\r\n  list.innerHTML = '<div class=\"loading\">Loading...</div>';\r\n\r\n  try {\r\n    const notifications = await notificationsService.getAll({ limit: 20 });\r\n    renderNotifications(list, notifications, container, props);\r\n  } catch {\r\n    list.innerHTML = '<div class=\"error\">Failed to load</div>';\r\n  }\r\n}\r\n\r\n/**\r\n * Render notifications\r\n */\r\nfunction renderNotifications(\r\n  container: HTMLElement,\r\n  notifications: Notification[],\r\n  dropdown: HTMLElement,\r\n  props: NotificationsDropdownProps\r\n): void {\r\n  if (notifications.length === 0) {\r\n    container.innerHTML = '<div class=\"empty\">No notifications</div>';\r\n    return;\r\n  }\r\n\r\n  container.innerHTML = notifications.map(n => `\r\n    <div class=\"notification-item ${n.read ? '' : 'unread'}\" data-id=\"${n.id}\">\r\n      <div class=\"notification-icon\">${getIcon(n.type)}</div>\r\n      <div class=\"notification-content\">\r\n        <div class=\"notification-title\">${escapeHtml(n.title)}</div>\r\n        ${n.message ? `<div class=\"notification-message\">${escapeHtml(n.message)}</div>` : ''}\r\n        <div class=\"notification-time\">${formatRelativeTime(n.created_at)}</div>\r\n      </div>\r\n      <button class=\"btn-icon dismiss-btn\" title=\"Dismiss\"></button>\r\n    </div>\r\n  `).join('');\r\n\r\n  // Bind click events\r\n  container.querySelectorAll('.notification-item').forEach(item => {\r\n    on(item as HTMLElement, 'click', async (e) => {\r\n      if ((e.target as HTMLElement).closest('.dismiss-btn')) return;\r\n\r\n      const id = item.getAttribute('data-id');\r\n      const notification = notifications.find(n => n.id === id);\r\n      if (notification) {\r\n        // Mark as read\r\n        if (!notification.read) {\r\n          await notificationsService.markRead(id!);\r\n          item.classList.remove('unread');\r\n          unreadCount = Math.max(0, unreadCount - 1);\r\n          updateBadge(dropdown, unreadCount);\r\n        }\r\n\r\n        closeDropdown(dropdown);\r\n        props.onNotificationClick?.(notification);\r\n      }\r\n    });\r\n\r\n    // Dismiss button\r\n    const dismissBtn = item.querySelector('.dismiss-btn');\r\n    if (dismissBtn) {\r\n      on(dismissBtn as HTMLElement, 'click', async (e) => {\r\n        e.stopPropagation();\r\n        const id = item.getAttribute('data-id');\r\n        if (!id) return;\r\n\r\n        try {\r\n          await notificationsService.delete(id);\r\n          item.remove();\r\n          if (!item.classList.contains('unread')) return;\r\n          unreadCount = Math.max(0, unreadCount - 1);\r\n          updateBadge(dropdown, unreadCount);\r\n        } catch {\r\n          // Ignore\r\n        }\r\n      });\r\n    }\r\n  });\r\n}\r\n\r\n/**\r\n * Get icon by type\r\n */\r\nfunction getIcon(type: string): string {\r\n  switch (type) {\r\n    case 'question': return '';\r\n    case 'risk': return '';\r\n    case 'action': return '';\r\n    case 'decision': return '';\r\n    case 'mention': return '@';\r\n    case 'comment': return '';\r\n    case 'assignment': return '';\r\n    default: return '';\r\n  }\r\n}\r\n\r\n/**\r\n * Escape HTML\r\n */\r\nfunction escapeHtml(text: string): string {\r\n  const div = document.createElement('div');\r\n  div.textContent = text;\r\n  return div.innerHTML;\r\n}\r\n\r\n/**\r\n * Initialize notifications in header\r\n */\r\nexport function initNotificationsDropdown(\r\n  container: HTMLElement,\r\n  props: NotificationsDropdownProps = {}\r\n): HTMLElement {\r\n  const dropdown = createNotificationsDropdown(props);\r\n  container.appendChild(dropdown);\r\n  return dropdown;\r\n}\r\n\r\nexport default createNotificationsDropdown;\r\n","/**\n * Members Panel Component\n * Project members management with invites\n */\n\nimport { createElement, on } from '@lib/dom';\nimport { membersService, ProjectMember } from '@services/notifications';\nimport { appStore } from '@stores/app';\nimport { showInviteModal } from './modals/InviteModal';\nimport { showMemberPermissionsModal } from './modals/MemberPermissionsModal';\nimport { toast } from '@services/toast';\nimport { formatRelativeTime } from '@lib/format';\n\nexport interface MembersPanelProps {\n  projectId?: string;\n  onMemberClick?: (member: ProjectMember) => void;\n}\n\n/**\n * Create members panel\n */\nexport function createMembersPanel(props: MembersPanelProps = {}): HTMLElement {\n  const panel = createElement('div', { className: 'members-panel' });\n\n  panel.innerHTML = `\n    <div class=\"panel-header\">\n      <div class=\"panel-title\">\n        <h2>Team Members</h2>\n        <span class=\"panel-count\" id=\"members-count\">0</span>\n      </div>\n      <div class=\"panel-actions\">\n        <button class=\"btn btn-primary btn-sm\" id=\"invite-member-btn\">+ Invite</button>\n      </div>\n    </div>\n    <div class=\"panel-content\" id=\"members-content\">\n      <div class=\"loading\">Loading members...</div>\n    </div>\n    <div class=\"pending-invites\" id=\"pending-invites\"></div>\n  `;\n\n  // Bind invite button\n  const inviteBtn = panel.querySelector('#invite-member-btn');\n  if (inviteBtn) {\n    on(inviteBtn as HTMLElement, 'click', () => {\n      const projectId = props.projectId || appStore.getState().currentProject?.id;\n      if (!projectId) {\n        toast.error('No project selected');\n        return;\n      }\n      showInviteModal({\n        projectId,\n        onInvite: () => loadPendingInvites(panel, projectId),\n      });\n    });\n  }\n\n  // Initial load\n  const projectId = props.projectId || appStore.getState().currentProject?.id;\n  if (projectId) {\n    loadMembers(panel, projectId, props);\n    loadPendingInvites(panel, projectId);\n  }\n\n  return panel;\n}\n\n/**\n * Load members\n */\nasync function loadMembers(\n  panel: HTMLElement,\n  projectId: string,\n  props: MembersPanelProps\n): Promise<void> {\n  const content = panel.querySelector('#members-content') as HTMLElement;\n  content.innerHTML = '<div class=\"loading\">Loading...</div>';\n\n  try {\n    const members = await membersService.getAll(projectId);\n    renderMembers(content, members, projectId, props);\n    updateCount(panel, members.length);\n  } catch {\n    content.innerHTML = '<div class=\"error\">Failed to load members</div>';\n  }\n}\n\n/**\n * Render members\n */\nfunction renderMembers(\n  container: HTMLElement,\n  members: ProjectMember[],\n  projectId: string,\n  props: MembersPanelProps\n): void {\n  if (members.length === 0) {\n    container.innerHTML = '<div class=\"empty\">No team members</div>';\n    return;\n  }\n\n  const currentUser = appStore.getState().currentUser;\n\n  container.innerHTML = `\n    <div class=\"members-list\">\n      ${members.map(member => `\n        <div class=\"member-card\" data-id=\"${member.user_id}\">\n          <div class=\"member-avatar\">\n            ${member.avatar_url\n      ? `<img src=\"${member.avatar_url}\" alt=\"\">`\n      : `<span>${getInitials(member.name || member.email)}</span>`\n    }\n          </div>\n          <div class=\"member-info\">\n            <div class=\"member-name\">${escapeHtml(member.name || member.email)}</div>\n            <div class=\"member-email\">${escapeHtml(member.email)}</div>\n          </div>\n          <div class=\"member-role\">\n            <select class=\"role-select\" data-user-id=\"${member.user_id}\" ${member.user_id === currentUser?.id ? 'disabled' : ''}>\n              <option value=\"viewer\" ${member.role === 'viewer' ? 'selected' : ''}>Viewer</option>\n              <option value=\"editor\" ${member.role === 'editor' ? 'selected' : ''}>Editor</option>\n              <option value=\"admin\" ${member.role === 'admin' ? 'selected' : ''}>Admin</option>\n              <option value=\"owner\" ${member.role === 'owner' ? 'selected' : ''}>Owner</option>\n            </select>\n          </div>\n          <button class=\"btn-icon permissions-btn permissions-btn-icon\" data-user-id=\"${member.user_id}\" title=\"Permissions\"></button>\n          ${member.user_id !== currentUser?.id ? `\n            <button class=\"btn-icon remove-member-btn\" data-user-id=\"${member.user_id}\" title=\"Remove\"></button>\n          ` : ''}\n        </div>\n      `).join('')}\n    </div>\n  `;\n\n  // Bind role change\n  container.querySelectorAll('.role-select').forEach(select => {\n    on(select as HTMLElement, 'change', async () => {\n      const userId = select.getAttribute('data-user-id');\n      const role = (select as HTMLSelectElement).value as 'admin' | 'editor' | 'viewer';\n      if (!userId) return;\n\n      try {\n        await membersService.updateRole(userId, role, projectId);\n        toast.success('Role updated');\n      } catch {\n        toast.error('Failed to update role');\n        loadMembers(container.closest('.members-panel') as HTMLElement, projectId, props);\n      }\n    });\n  });\n\n  // Bind remove buttons\n  container.querySelectorAll('.remove-member-btn').forEach(btn => {\n    on(btn as HTMLElement, 'click', async () => {\n      const userId = btn.getAttribute('data-user-id');\n      if (!userId || !confirm('Remove this member from the project?')) return;\n\n      try {\n        await membersService.remove(projectId, userId);\n        toast.success('Member removed');\n        loadMembers(container.closest('.members-panel') as HTMLElement, projectId, props);\n      } catch {\n        toast.error('Failed to remove member');\n      }\n    });\n  });\n\n  // Bind permissions buttons\n  container.querySelectorAll('.permissions-btn').forEach(btn => {\n    on(btn as HTMLElement, 'click', () => {\n      const userId = btn.getAttribute('data-user-id');\n      const member = members.find(m => m.user_id === userId);\n      if (!member) return;\n\n      showMemberPermissionsModal({\n        projectId,\n        userId: member.user_id,\n        userName: member.name || '',\n        userEmail: member.email,\n        avatarUrl: member.avatar_url,\n        currentRole: member.role,\n        currentPermissions: (member as { permissions?: string[] }).permissions,\n        onSave: () => {\n          loadMembers(container.closest('.members-panel') as HTMLElement, projectId, props);\n        },\n      });\n    });\n  });\n\n  // Bind member clicks\n  container.querySelectorAll('.member-card').forEach(card => {\n    on(card as HTMLElement, 'click', (e) => {\n      if ((e.target as HTMLElement).closest('.role-select, .remove-member-btn')) return;\n\n      const userId = card.getAttribute('data-id');\n      const member = members.find(m => m.user_id === userId);\n      if (member && props.onMemberClick) {\n        props.onMemberClick(member);\n      }\n    });\n  });\n}\n\n/**\n * Load pending invites\n */\nasync function loadPendingInvites(panel: HTMLElement, projectId: string): Promise<void> {\n  const container = panel.querySelector('#pending-invites') as HTMLElement;\n\n  try {\n    const invites = await membersService.getInvites(projectId);\n\n    if (invites.length === 0) {\n      container.innerHTML = '';\n      return;\n    }\n\n    container.innerHTML = `\n      <div class=\"invites-section\">\n        <h4>Pending Invites</h4>\n        <div class=\"invites-list\">\n          ${invites.map(invite => `\n            <div class=\"invite-card\" data-id=\"${invite.id}\">\n              <div class=\"invite-info\">\n                <span class=\"invite-email\">${escapeHtml(invite.email)}</span>\n                <span class=\"invite-role\">${invite.role}</span>\n                <span class=\"invite-time\">Sent ${formatRelativeTime(invite.invited_at || invite.created_at || new Date().toISOString())}</span>\n              </div>\n              <button class=\"btn btn-sm cancel-invite-btn\" data-id=\"${invite.id}\">Cancel</button>\n            </div>\n          `).join('')}\n        </div>\n      </div>\n    `;\n\n    // Bind cancel buttons\n    container.querySelectorAll('.cancel-invite-btn').forEach(btn => {\n      on(btn as HTMLElement, 'click', async () => {\n        const inviteId = btn.getAttribute('data-id');\n        if (!inviteId) return;\n\n        try {\n          // TODO: Implement cancel invite in service\n          toast.info('Invite cancellation not implemented');\n        } catch {\n          toast.error('Failed to cancel invite');\n        }\n      });\n    });\n  } catch {\n    // Ignore\n  }\n}\n\n/**\n * Update count\n */\nfunction updateCount(panel: HTMLElement, count: number): void {\n  const countEl = panel.querySelector('#members-count');\n  if (countEl) countEl.textContent = String(count);\n}\n\n/**\n * Get initials\n */\nfunction getInitials(name: string): string {\n  return name\n    .split(' ')\n    .map(n => n[0])\n    .join('')\n    .toUpperCase()\n    .slice(0, 2);\n}\n\n/**\n * Escape HTML\n */\nfunction escapeHtml(text: string): string {\n  const div = document.createElement('div');\n  div.textContent = text;\n  return div.innerHTML;\n}\n\nexport default createMembersPanel;\n","/**\r\n * Global Error Boundary\r\n * Catches unhandled errors and promise rejections to prevent \"Zombie App\" state.\r\n * Displays a friendly \"Toast of Death\" or recovery UI.\r\n */\r\nimport { toast } from '@services/toast';\r\n\r\nexport class ErrorBoundary {\r\n  private static isInitialized = false;\r\n\r\n  static init(): void {\r\n    if (this.isInitialized) return;\r\n\r\n    window.addEventListener('error', this.handleError);\r\n    window.addEventListener('unhandledrejection', this.handleRejection);\r\n\r\n    this.isInitialized = true;\r\n    console.log('[ErrorBoundary] Initialized global error handling.');\r\n  }\r\n\r\n  private static handleError(event: ErrorEvent): void {\r\n    console.error('[ErrorBoundary] Uncaught Exception:', event.error);\r\n    ErrorBoundary.showErrorUI('An unexpected error occurred.', event.error?.message);\r\n  }\r\n\r\n  private static handleRejection(event: PromiseRejectionEvent): void {\r\n    console.error('[ErrorBoundary] Unhandled Promise Rejection:', event.reason);\r\n    // Extract meaningful message from various rejection types\r\n    const message = event.reason?.message || (typeof event.reason === 'string' ? event.reason : 'Unknown failure');\r\n    ErrorBoundary.showErrorUI('Async operation failed.', message);\r\n  }\r\n\r\n  private static showErrorUI(title: string, details?: string): void {\r\n    // We use a persistent, strictly styled toast or overlay here\r\n    // For now, we reuse the toast service but force it to be persistent if possible,\r\n    // or just show an error toast.\r\n\r\n    // In a SOTA app, this might replace the root element with a \"Crash Screen\" \r\n    // if the error is catastrophic (determined by heuristics), but for now we warn the user.\r\n\r\n    const msg = `${title} ${details ? `(${details})` : ''}`;\r\n    toast.error(msg); // Assuming toast has a way to stick, or we just show it.\r\n\r\n    // Optional: Send to telemetry service\r\n    // Telemetry.trackError(...) \r\n  }\r\n}\r\n","/**\r\n * Team Analysis Store\r\n * State management for behavioral profiles and team dynamics\r\n */\r\n\r\nimport { fetchWithProject } from '../services/api';\r\n\r\n// Types\r\nexport interface BehavioralProfile {\r\n    id: string;\r\n    person_id: string;\r\n    person?: {\r\n        id: string;\r\n        name: string;\r\n        role?: string;\r\n        organization?: string;\r\n        email?: string;\r\n    };\r\n    profile_data: ProfileData;\r\n    confidence_level: 'low' | 'medium' | 'high' | 'very_high';\r\n    communication_style?: string;\r\n    dominant_motivation?: string;\r\n    risk_tolerance?: 'low' | 'medium' | 'high';\r\n    influence_score: number;\r\n    transcripts_analyzed: string[];\r\n    transcript_count: number;\r\n    total_speaking_time_seconds: number;\r\n    limitations: string[];\r\n    recommended_update_after?: string;\r\n    last_analysis_at: string;\r\n    created_at: string;\r\n    updated_at: string;\r\n}\r\n\r\nexport interface ProfileData {\r\n    target_name?: string;\r\n    analysis_date?: string;\r\n    confidence_level?: string;\r\n    communication_identity?: {\r\n        dominant_style?: string;\r\n        intervention_rhythm?: string;\r\n        textual_body_language?: string;\r\n        evidence?: Evidence[];\r\n    };\r\n    motivations_and_priorities?: {\r\n        values_most?: string[];\r\n        avoids?: string[];\r\n        based_on?: string;\r\n        confidence?: string;\r\n        evidence?: Evidence[];\r\n    };\r\n    behavior_under_pressure?: PressureBehavior[];\r\n    influence_tactics?: InfluenceTactic[];\r\n    vulnerabilities?: {\r\n        discourse_action_inconsistencies?: { description: string; evidence: string }[];\r\n        defense_triggers?: { trigger: string; evidence: string }[];\r\n        blind_spots?: { description: string; evidence: string }[];\r\n        risk_patterns?: { pattern: string; evidence: string }[];\r\n    };\r\n    interaction_strategy?: {\r\n        ideal_format?: {\r\n            channel?: string;\r\n            structure?: string;\r\n            timing?: string;\r\n        };\r\n        framing_that_works?: string[];\r\n        what_to_avoid?: string[];\r\n        cooperation_triggers?: string[];\r\n    };\r\n    early_warning_signs?: EarlyWarningSign[];\r\n    power_analysis?: PowerAnalysis[];\r\n    limitations?: string[];\r\n    recommended_update_after?: string;\r\n}\r\n\r\nexport interface Evidence {\r\n    timestamp?: string;\r\n    quote?: string;\r\n    observation?: string;\r\n}\r\n\r\nexport interface PressureBehavior {\r\n    situation: string;\r\n    observed_behavior: string;\r\n    timestamp?: string;\r\n    quote?: string;\r\n}\r\n\r\nexport interface InfluenceTactic {\r\n    objective: string;\r\n    tactic: string;\r\n    timestamp?: string;\r\n    example?: string;\r\n}\r\n\r\nexport interface EarlyWarningSign {\r\n    signal: string;\r\n    indicates: string;\r\n    comparison_evidence?: string;\r\n}\r\n\r\nexport interface PowerAnalysis {\r\n    factor: string;\r\n    assessment: string;\r\n    strategic_implication?: string;\r\n}\r\n\r\nexport interface TeamAnalysis {\r\n    id: string;\r\n    project_id: string;\r\n    analysis_data: TeamAnalysisData;\r\n    team_size: number;\r\n    cohesion_score: number;\r\n    tension_level: 'low' | 'medium' | 'high';\r\n    dominant_communication_pattern?: string;\r\n    influence_map: InfluenceRelation[];\r\n    alliances: Alliance[];\r\n    tensions: Tension[];\r\n    members_included: string[];\r\n    transcripts_analyzed: string[];\r\n    last_analysis_at: string;\r\n}\r\n\r\nexport interface TeamAnalysisData {\r\n    analysis_date?: string;\r\n    team_size?: number;\r\n    cohesion_score?: number;\r\n    tension_level?: string;\r\n    dominant_communication_pattern?: string;\r\n    power_centers?: PowerCenter[];\r\n    communication_flow?: {\r\n        central_nodes?: string[];\r\n        bottlenecks?: string[];\r\n        isolated_members?: string[];\r\n        information_brokers?: string[];\r\n    };\r\n    recommendations?: string[];\r\n    risk_factors?: string[];\r\n}\r\n\r\nexport interface InfluenceRelation {\r\n    from_person?: string;\r\n    to_person?: string;\r\n    influence_type?: string;\r\n    strength?: number;\r\n    evidence?: string;\r\n}\r\n\r\nexport interface Alliance {\r\n    members?: string[];\r\n    alliance_type?: string;\r\n    shared_values?: string[];\r\n    strength?: number;\r\n    evidence?: string;\r\n}\r\n\r\nexport interface Tension {\r\n    between?: string[];\r\n    tension_type?: string;\r\n    level?: string;\r\n    triggers?: string[];\r\n    evidence?: string;\r\n}\r\n\r\nexport interface PowerCenter {\r\n    person?: string;\r\n    power_type?: string;\r\n    influence_reach?: number;\r\n    dependencies?: string[];\r\n}\r\n\r\nexport interface BehavioralRelationship {\r\n    id: string;\r\n    from_person_id: string;\r\n    to_person_id: string;\r\n    from_person?: { id: string; name: string };\r\n    to_person?: { id: string; name: string };\r\n    relationship_type: string;\r\n    strength: number;\r\n    confidence: string;\r\n    evidence: any[];\r\n    evidence_count: number;\r\n}\r\n\r\nexport interface GraphNode {\r\n    id: string;\r\n    label: string;\r\n    group: string;\r\n    size: number;\r\n    title?: string;\r\n    color?: string;\r\n    properties?: Record<string, any>;\r\n}\r\n\r\nexport interface GraphEdge {\r\n    from: string;\r\n    to: string;\r\n    type: string;\r\n    label?: string;\r\n    width?: number;\r\n    dashes?: boolean;\r\n    color?: string;\r\n    arrows?: string;\r\n    title?: string;\r\n    properties?: Record<string, any>;\r\n}\r\n\r\nexport interface TeamAnalysisState {\r\n    profiles: BehavioralProfile[];\r\n    selectedProfile: BehavioralProfile | null;\r\n    teamAnalysis: TeamAnalysis | null;\r\n    relationships: BehavioralRelationship[];\r\n    graphData: { nodes: GraphNode[]; edges: GraphEdge[] } | null;\r\n    loading: boolean;\r\n    analyzing: boolean;\r\n    error: string | null;\r\n    currentSubtab: 'profiles' | 'team' | 'graph';\r\n}\r\n\r\n// Initial state\r\nconst initialState: TeamAnalysisState = {\r\n    profiles: [],\r\n    selectedProfile: null,\r\n    teamAnalysis: null,\r\n    relationships: [],\r\n    graphData: null,\r\n    loading: false,\r\n    analyzing: false,\r\n    error: null,\r\n    currentSubtab: 'profiles',\r\n};\r\n\r\n// State\r\nlet state: TeamAnalysisState = { ...initialState };\r\n\r\n// Listeners\r\nconst listeners: Set<(state: TeamAnalysisState) => void> = new Set();\r\n\r\n/**\r\n * Notify all listeners\r\n */\r\nfunction notify(): void {\r\n    listeners.forEach(fn => fn(state));\r\n}\r\n\r\n/**\r\n * Get current state\r\n */\r\nexport function getState(): TeamAnalysisState {\r\n    return state;\r\n}\r\n\r\n/**\r\n * Subscribe to state changes\r\n */\r\nexport function subscribe(callback: (state: TeamAnalysisState) => void): () => void {\r\n    listeners.add(callback);\r\n    return () => listeners.delete(callback);\r\n}\r\n\r\n/**\r\n * Set loading state\r\n */\r\nexport function setLoading(loading: boolean): void {\r\n    state = { ...state, loading };\r\n    notify();\r\n}\r\n\r\n/**\r\n * Set analyzing state\r\n */\r\nexport function setAnalyzing(analyzing: boolean): void {\r\n    state = { ...state, analyzing };\r\n    notify();\r\n}\r\n\r\n/**\r\n * Set error\r\n */\r\nexport function setError(error: string | null): void {\r\n    state = { ...state, error };\r\n    notify();\r\n}\r\n\r\n/**\r\n * Set profiles\r\n */\r\nexport function setProfiles(profiles: BehavioralProfile[]): void {\r\n    state = { ...state, profiles };\r\n    notify();\r\n}\r\n\r\n/**\r\n * Set selected profile\r\n */\r\nexport function setSelectedProfile(profile: BehavioralProfile | null): void {\r\n    state = { ...state, selectedProfile: profile };\r\n    notify();\r\n}\r\n\r\n/**\r\n * Set team analysis\r\n */\r\nexport function setTeamAnalysis(analysis: TeamAnalysis | null): void {\r\n    state = { ...state, teamAnalysis: analysis };\r\n    notify();\r\n}\r\n\r\n/**\r\n * Set relationships\r\n */\r\nexport function setRelationships(relationships: BehavioralRelationship[]): void {\r\n    state = { ...state, relationships };\r\n    notify();\r\n}\r\n\r\n/**\r\n * Set graph data\r\n */\r\nexport function setGraphData(data: { nodes: GraphNode[]; edges: GraphEdge[] } | null): void {\r\n    state = { ...state, graphData: data };\r\n    notify();\r\n}\r\n\r\n/**\r\n * Set current subtab\r\n */\r\nexport function setSubtab(subtab: 'profiles' | 'team' | 'graph'): void {\r\n    state = { ...state, currentSubtab: subtab };\r\n    notify();\r\n}\r\n\r\n/**\r\n * Load profiles from API\r\n */\r\nexport async function loadProfiles(): Promise<void> {\r\n    setLoading(true);\r\n    setError(null);\r\n    \r\n    try {\r\n        const response = await fetchWithProject('/api/team-analysis/profiles');\r\n        const data = await response.json();\r\n        \r\n        if (data.ok) {\r\n            setProfiles(data.profiles || []);\r\n        } else {\r\n            setError(data.error || 'Failed to load profiles');\r\n        }\r\n    } catch (error: any) {\r\n        setError(error.message || 'Failed to load profiles');\r\n    } finally {\r\n        setLoading(false);\r\n    }\r\n}\r\n\r\n/**\r\n * Load a specific profile\r\n */\r\nexport async function loadProfile(personId: string): Promise<BehavioralProfile | null> {\r\n    setLoading(true);\r\n    setError(null);\r\n    \r\n    try {\r\n        const response = await fetchWithProject(`/api/team-analysis/profiles/${personId}`);\r\n        const data = await response.json();\r\n        \r\n        if (data.ok && data.profile) {\r\n            setSelectedProfile(data.profile);\r\n            return data.profile;\r\n        } else {\r\n            setError(data.error || 'Profile not found');\r\n            return null;\r\n        }\r\n    } catch (error: any) {\r\n        setError(error.message || 'Failed to load profile');\r\n        return null;\r\n    } finally {\r\n        setLoading(false);\r\n    }\r\n}\r\n\r\n/**\r\n * Analyze a person's profile\r\n */\r\nexport async function analyzeProfile(personId: string, options: {\r\n    relationshipContext?: string;\r\n    objective?: string;\r\n    forceReanalysis?: boolean;\r\n} = {}): Promise<BehavioralProfile | null> {\r\n    setAnalyzing(true);\r\n    setError(null);\r\n    \r\n    try {\r\n        const response = await fetchWithProject(`/api/team-analysis/profiles/${personId}/analyze`, {\r\n            method: 'POST',\r\n            headers: { 'Content-Type': 'application/json' },\r\n            body: JSON.stringify(options)\r\n        });\r\n        const data = await response.json();\r\n        \r\n        if (data.ok && data.profile) {\r\n            // Update profiles list\r\n            const updatedProfiles = state.profiles.map(p => \r\n                p.person_id === personId ? data.profile : p\r\n            );\r\n            if (!updatedProfiles.find(p => p.person_id === personId)) {\r\n                updatedProfiles.push(data.profile);\r\n            }\r\n            setProfiles(updatedProfiles);\r\n            setSelectedProfile(data.profile);\r\n            return data.profile;\r\n        } else {\r\n            setError(data.error || 'Failed to analyze profile');\r\n            return null;\r\n        }\r\n    } catch (error: any) {\r\n        setError(error.message || 'Failed to analyze profile');\r\n        return null;\r\n    } finally {\r\n        setAnalyzing(false);\r\n    }\r\n}\r\n\r\n/**\r\n * Load team analysis\r\n */\r\nexport async function loadTeamAnalysis(): Promise<void> {\r\n    setLoading(true);\r\n    setError(null);\r\n    \r\n    try {\r\n        console.log('[TeamAnalysisStore] Loading team analysis...');\r\n        const response = await fetchWithProject('/api/team-analysis/team');\r\n        const data = await response.json();\r\n        console.log('[TeamAnalysisStore] Team analysis response:', data);\r\n        \r\n        if (data.ok) {\r\n            console.log('[TeamAnalysisStore] Setting team analysis:', data.analysis);\r\n            setTeamAnalysis(data.analysis);\r\n        } else {\r\n            console.error('[TeamAnalysisStore] Error:', data.error);\r\n            setError(data.error || 'Failed to load team analysis');\r\n        }\r\n    } catch (error: any) {\r\n        console.error('[TeamAnalysisStore] Exception:', error);\r\n        setError(error.message || 'Failed to load team analysis');\r\n    } finally {\r\n        setLoading(false);\r\n    }\r\n}\r\n\r\n/**\r\n * Analyze team dynamics\r\n */\r\nexport async function analyzeTeam(forceReanalysis: boolean = false): Promise<TeamAnalysis | null> {\r\n    setAnalyzing(true);\r\n    setError(null);\r\n    \r\n    try {\r\n        const response = await fetchWithProject('/api/team-analysis/team/analyze', {\r\n            method: 'POST',\r\n            headers: { 'Content-Type': 'application/json' },\r\n            body: JSON.stringify({ forceReanalysis })\r\n        });\r\n        const data = await response.json();\r\n        \r\n        if (data.ok && data.analysis) {\r\n            setTeamAnalysis(data.analysis);\r\n            return data.analysis;\r\n        } else {\r\n            setError(data.error || 'Failed to analyze team');\r\n            return null;\r\n        }\r\n    } catch (error: any) {\r\n        setError(error.message || 'Failed to analyze team');\r\n        return null;\r\n    } finally {\r\n        setAnalyzing(false);\r\n    }\r\n}\r\n\r\n/**\r\n * Load relationships\r\n */\r\nexport async function loadRelationships(): Promise<void> {\r\n    try {\r\n        const response = await fetchWithProject('/api/team-analysis/relationships');\r\n        const data = await response.json();\r\n        \r\n        if (data.ok) {\r\n            setRelationships(data.relationships || []);\r\n        }\r\n    } catch (error) {\r\n        console.error('Failed to load relationships:', error);\r\n    }\r\n}\r\n\r\n/**\r\n * Load graph visualization data\r\n */\r\nexport async function loadGraphData(): Promise<void> {\r\n    try {\r\n        console.log('[TeamAnalysisStore] Loading graph data...');\r\n        const response = await fetchWithProject('/api/team-analysis/graph');\r\n        const data = await response.json();\r\n        console.log('[TeamAnalysisStore] Graph data response:', data);\r\n        \r\n        if (data.ok) {\r\n            console.log('[TeamAnalysisStore] Setting graph data:', data.nodes?.length, 'nodes,', data.edges?.length, 'edges');\r\n            setGraphData({ nodes: data.nodes || [], edges: data.edges || [] });\r\n        }\r\n    } catch (error) {\r\n        console.error('[TeamAnalysisStore] Failed to load graph data:', error);\r\n    }\r\n}\r\n\r\n/**\r\n * Load all data\r\n */\r\nexport async function loadAll(): Promise<void> {\r\n    await Promise.all([\r\n        loadProfiles(),\r\n        loadTeamAnalysis(),\r\n        loadRelationships(),\r\n        loadGraphData()\r\n    ]);\r\n}\r\n\r\n/**\r\n * Reset to initial state\r\n */\r\nexport function reset(): void {\r\n    state = { ...initialState };\r\n    notify();\r\n}\r\n\r\n// Export as namespace\r\nexport const teamAnalysisStore = {\r\n    getState,\r\n    subscribe,\r\n    setLoading,\r\n    setAnalyzing,\r\n    setError,\r\n    setProfiles,\r\n    setSelectedProfile,\r\n    setTeamAnalysis,\r\n    setRelationships,\r\n    setGraphData,\r\n    setSubtab,\r\n    loadProfiles,\r\n    loadProfile,\r\n    analyzeProfile,\r\n    loadTeamAnalysis,\r\n    analyzeTeam,\r\n    loadRelationships,\r\n    loadGraphData,\r\n    loadAll,\r\n    reset,\r\n};\r\n","/**\r\n * Legacy Bridge\r\n * Provides compatibility layer for legacy index.html code\r\n * \r\n * This module exposes the new modular services and stores as global\r\n * variables that match the original monolithic code's expectations.\r\n */\r\n\r\nimport { appStore, Project, User } from '../stores/app';\r\nimport { uiStore } from '../stores/ui';\r\nimport { dataStore, Question, Risk, Action, Decision, Contact } from '../stores/data';\r\nimport { chartsStore } from '../stores/charts';\r\nimport { http, api } from '../services/api';\r\nimport type { ChatMessage } from '../stores/data';\r\nimport type { MainTab } from '../stores/ui';\r\nimport { toast } from '../services/toast';\r\nimport { theme } from '../services/theme';\r\nimport { storage } from '../services/storage';\r\nimport { shortcuts } from '../services/shortcuts';\r\nimport { undoManager } from '../services/undo';\r\n\r\n// ============================================================================\r\n// Global Variable Compatibility\r\n// ============================================================================\r\n\r\n/**\r\n * Legacy global variable getters/setters\r\n * These provide compatibility with code that expects global variables\r\n */\r\n\r\n// Current project (was: currentProject)\r\nObject.defineProperty(window, 'currentProject', {\r\n  get: () => appStore.getState().currentProject,\r\n  set: (value: Project | null) => appStore.setCurrentProject(value),\r\n  configurable: true,\r\n});\r\n\r\n// Current project ID (was: currentProjectId)\r\nObject.defineProperty(window, 'currentProjectId', {\r\n  get: () => appStore.getState().currentProjectId,\r\n  set: (value: string | null) => appStore.setCurrentProjectId(value),\r\n  configurable: true,\r\n});\r\n\r\n// Current user (was: currentUser)\r\nObject.defineProperty(window, 'currentUser', {\r\n  get: () => appStore.getState().currentUser,\r\n  set: (value: User | null) => appStore.setCurrentUser(value),\r\n  configurable: true,\r\n});\r\n\r\n// Auth configured (was: authConfigured)\r\nObject.defineProperty(window, 'authConfigured', {\r\n  get: () => appStore.getState().authConfigured,\r\n  set: (value: boolean) => appStore.setAuthConfigured(value),\r\n  configurable: true,\r\n});\r\n\r\n// Current tab (was: currentTab)\r\nObject.defineProperty(window, 'currentTab', {\r\n  get: () => uiStore.getState().currentTab,\r\n  set: (value: MainTab) => uiStore.setTab(value),\r\n  configurable: true,\r\n});\r\n\r\n// Questions (was: questions)\r\nObject.defineProperty(window, 'questions', {\r\n  get: () => dataStore.getState().questions,\r\n  set: (value: Question[]) => dataStore.setQuestions(value),\r\n  configurable: true,\r\n});\r\n\r\n// Risks (was: risks)\r\nObject.defineProperty(window, 'risks', {\r\n  get: () => dataStore.getState().risks,\r\n  set: (value: Risk[]) => dataStore.setRisks(value),\r\n  configurable: true,\r\n});\r\n\r\n// Actions (was: actions)\r\nObject.defineProperty(window, 'actions', {\r\n  get: () => dataStore.getState().actions,\r\n  set: (value: Action[]) => dataStore.setActions(value),\r\n  configurable: true,\r\n});\r\n\r\n// Decisions (was: decisions)\r\nObject.defineProperty(window, 'decisions', {\r\n  get: () => dataStore.getState().decisions,\r\n  set: (value: Decision[]) => dataStore.setDecisions(value),\r\n  configurable: true,\r\n});\r\n\r\n// Contacts (was: contacts)\r\nObject.defineProperty(window, 'contacts', {\r\n  get: () => dataStore.getState().contacts,\r\n  set: (value: Contact[]) => dataStore.setContacts(value),\r\n  configurable: true,\r\n});\r\n\r\n// Chat history (was: chatHistory)\r\nObject.defineProperty(window, 'chatHistory', {\r\n  get: () => dataStore.getState().chatHistory,\r\n  set: (value: ChatMessage[]) => dataStore.setChatHistory(value),\r\n  configurable: true,\r\n});\r\n\r\n// ============================================================================\r\n// Legacy Function Compatibility\r\n// ============================================================================\r\n\r\n/**\r\n * Legacy API function\r\n * Maps to new http service\r\n */\r\n(window as unknown as Record<string, unknown>).api = async function legacyApi(\r\n  endpoint: string,\r\n  method = 'GET',\r\n  body?: unknown\r\n): Promise<unknown> {\r\n  try {\r\n    let response;\r\n    switch (method.toUpperCase()) {\r\n      case 'GET':\r\n        response = await http.get(endpoint);\r\n        break;\r\n      case 'POST':\r\n        response = await http.post(endpoint, body);\r\n        break;\r\n      case 'PUT':\r\n        response = await http.put(endpoint, body);\r\n        break;\r\n      case 'PATCH':\r\n        response = await http.patch(endpoint, body);\r\n        break;\r\n      case 'DELETE':\r\n        response = await http.delete(endpoint);\r\n        break;\r\n      default:\r\n        response = await api(endpoint, { method, body: body ? JSON.stringify(body) : undefined });\r\n    }\r\n    return response.data;\r\n  } catch (error) {\r\n    console.error('API Error:', error);\r\n    throw error;\r\n  }\r\n};\r\n\r\n/**\r\n * Legacy showToast function\r\n */\r\n(window as unknown as Record<string, unknown>).showToast = function legacyShowToast(\r\n  message: string,\r\n  type: 'success' | 'error' | 'warning' | 'info' = 'info'\r\n): void {\r\n  toast[type](message);\r\n};\r\n\r\n/**\r\n * Legacy setTheme function\r\n */\r\n(window as unknown as Record<string, unknown>).setTheme = function legacySetTheme(\r\n  newTheme: 'light' | 'dark' | 'system'\r\n): void {\r\n  theme.set(newTheme);\r\n};\r\n\r\n/**\r\n * Legacy toggleTheme function\r\n */\r\n(window as unknown as Record<string, unknown>).toggleTheme = function legacyToggleTheme(): void {\r\n  theme.toggle();\r\n};\r\n\r\n/**\r\n * Legacy localStorage wrappers\r\n */\r\n(window as unknown as Record<string, unknown>).getStorageItem = function legacyGetItem(\r\n  key: string,\r\n  defaultValue: unknown = null\r\n): unknown {\r\n  return storage.get(key, defaultValue);\r\n};\r\n\r\n(window as unknown as Record<string, unknown>).setStorageItem = function legacySetItem(\r\n  key: string,\r\n  value: unknown\r\n): void {\r\n  storage.set(key, value);\r\n};\r\n\r\n/**\r\n * Legacy switchTab function\r\n */\r\n(window as unknown as Record<string, unknown>).switchTab = function legacySwitchTab(\r\n  tabName: MainTab\r\n): void {\r\n  uiStore.setTab(tabName);\r\n};\r\n\r\n/**\r\n * Legacy refreshData function\r\n */\r\n(window as unknown as Record<string, unknown>).refreshData = async function legacyRefreshData(): Promise<void> {\r\n  const projectId = appStore.getState().currentProjectId;\r\n  if (!projectId) return;\r\n\r\n  try {\r\n    const [questionsRes, risksRes, actionsRes, decisionsRes, contactsRes] = await Promise.all([\r\n      http.get<Question[]>(`/api/projects/${projectId}/questions`),\r\n      http.get<Risk[]>(`/api/projects/${projectId}/risks`),\r\n      http.get<Action[]>(`/api/projects/${projectId}/actions`),\r\n      http.get<Decision[]>(`/api/projects/${projectId}/decisions`),\r\n      http.get<Contact[]>(`/api/projects/${projectId}/contacts`),\r\n    ]);\r\n\r\n    dataStore.setQuestions(questionsRes.data);\r\n    dataStore.setRisks(risksRes.data);\r\n    dataStore.setActions(actionsRes.data);\r\n    dataStore.setDecisions(decisionsRes.data);\r\n    dataStore.setContacts(contactsRes.data);\r\n  } catch (error) {\r\n    console.error('Failed to refresh data:', error);\r\n  }\r\n};\r\n\r\n// ============================================================================\r\n// Chart Compatibility\r\n// ============================================================================\r\n\r\n/**\r\n * Legacy chart management\r\n */\r\n(window as unknown as Record<string, unknown>).registerChart = function(\r\n  id: string,\r\n  // eslint-disable-next-line @typescript-eslint/no-explicit-any\r\n  chart: any,\r\n  selector: string,\r\n  type: 'bar' | 'line' | 'pie' | 'doughnut' | 'radar' = 'bar'\r\n): void {\r\n  chartsStore.registerChart(id, chart, selector, type);\r\n};\r\n\r\n(window as unknown as Record<string, unknown>).destroyChart = function(id: string): void {\r\n  chartsStore.destroyChart(id);\r\n};\r\n\r\n(window as unknown as Record<string, unknown>).getChart = function(id: string): unknown {\r\n  return chartsStore.getChart(id);\r\n};\r\n\r\n// ============================================================================\r\n// Keyboard Shortcuts Compatibility\r\n// ============================================================================\r\n\r\n/**\r\n * Legacy keyboard shortcut registration\r\n */\r\n(window as unknown as Record<string, unknown>).registerShortcut = function(\r\n  key: string,\r\n  callback: () => void,\r\n  options: { ctrl?: boolean; shift?: boolean; alt?: boolean; description?: string } = {}\r\n): void {\r\n  shortcuts.register({\r\n    key,\r\n    ctrl: options.ctrl,\r\n    shift: options.shift,\r\n    alt: options.alt,\r\n    handler: callback,\r\n    description: options.description || 'Custom shortcut',\r\n  });\r\n};\r\n\r\n// ============================================================================\r\n// Undo/Redo Compatibility\r\n// ============================================================================\r\n\r\n/**\r\n * Legacy undo/redo\r\n */\r\n(window as unknown as Record<string, unknown>).pushUndoAction = function(\r\n  description: string,\r\n  undo: () => void | Promise<void>,\r\n  redo: () => void | Promise<void>\r\n): void {\r\n  undoManager.push({\r\n    id: `undo-${Date.now()}-${Math.random().toString(36).slice(2, 8)}`,\r\n    description,\r\n    undo,\r\n    redo,\r\n  });\r\n};\r\n\r\n(window as unknown as Record<string, unknown>).undoLastAction = function(): Promise<boolean> {\r\n  return undoManager.undo();\r\n};\r\n\r\n(window as unknown as Record<string, unknown>).redoLastAction = function(): Promise<boolean> {\r\n  return undoManager.redo();\r\n};\r\n\r\n// ============================================================================\r\n// Export for direct imports\r\n// ============================================================================\r\n\r\nexport function initLegacyBridge(): void {\r\n  console.log('[GodMode] Legacy bridge initialized');\r\n  \r\n  // Initialize app store listeners\r\n  appStore.init();\r\n  \r\n  // Log compatibility mode\r\n  if (process.env.NODE_ENV === 'development') {\r\n    console.log('[GodMode] Running in compatibility mode for legacy code');\r\n  }\r\n}\r\n\r\nexport default initLegacyBridge;\r\n","/**\r\n * SOTA View Transitions Utility\r\n * Wraps DOM updates in document.startViewTransition if supported.\r\n */\r\n\r\nexport function startViewTransition(callback: () => void | Promise<void>): void {\r\n    // Check browser support\r\n    if (!document.startViewTransition) {\r\n        callback();\r\n        return;\r\n    }\r\n\r\n    // Start transition\r\n    const transition = document.startViewTransition(async () => {\r\n        await callback();\r\n    });\r\n\r\n    // Optional: Handle cleanup or logging\r\n    transition.finished.then(() => {\r\n        // Transition complete\r\n        document.documentElement.classList.remove('vt-slide', 'vt-slide-back');\r\n    });\r\n}\r\n\r\n/**\r\n * Trigger a back navigation transition\r\n */\r\nexport function navigateBack(callback: () => void | Promise<void>): void {\r\n    document.documentElement.classList.add('vt-slide-back');\r\n    startViewTransition(callback);\r\n}\r\n\r\n/**\r\n * Trigger a forward navigation transition\r\n */\r\nexport function navigateForward(callback: () => void | Promise<void>): void {\r\n    document.documentElement.classList.add('vt-slide');\r\n    startViewTransition(callback);\r\n}\r\n","/**\n * GodMode Frontend - Main Entry Point\n * \n * This file initializes the application and loads all necessary modules.\n * Currently in transition phase - gradually migrating from monolithic\n * index.html to modular TypeScript structure.\n */\n\n// Import styles\nimport './styles/main.css';\nimport './styles/graph.css';\n\n// Import services\nimport {\n  theme, toast, shortcuts, undoManager, storage, http, api, configureApi, auth, projects,\n  addRequestInterceptor, setProjectIdGetter,\n  dashboardService, questionsService, risksService, actionsService, decisionsService,\n  chatService, contactsService, teamsService, documentsService, knowledgeService,\n  emailsService, graphService, timelineService, costsService, notificationsService,\n  commentsService, membersService, profileService, userSettingsService, projectSettingsService,\n  apiKeysService, webhooksService, auditService, factsService\n} from './services';\n\n// Import components\nimport { initGlobalSearch, initNotificationsDropdown, initCommandPalette } from './components';\n\nimport * as components from './components';\nimport { createQuestionDetailView } from './components/questions/QuestionDetailView';\nimport { createQuestionsPanel, createFactsPanel, createDecisionsPanel, createRisksPanel, createActionsPanel } from './components/sot';\nimport { ErrorBoundary } from './components/ErrorBoundary';\n\n// Initialize Global Error Boundary ASAP\nErrorBoundary.init();\n\n// Import stores\nimport { appStore, uiStore, dataStore, chartsStore, teamAnalysisStore } from './stores';\nimport type { Question } from './stores/data';\n\n// Import legacy bridge for backwards compatibility\nimport { initLegacyBridge } from './lib/legacy-bridge';\n\n// SOTA View Transitions\nimport { startViewTransition } from './lib/transitions';\n\n// Make services and stores available globally for gradual migration\ndeclare global {\n  interface Window {\n    godmode: {\n      // Core Services\n      theme: typeof theme;\n      toast: typeof toast;\n      shortcuts: typeof shortcuts;\n      undo: typeof undoManager;\n      storage: typeof storage;\n      http: typeof http;\n      api: typeof api;\n      configureApi: typeof configureApi;\n      auth: typeof auth;\n      projects: typeof projects;\n      // Domain Services\n      dashboard: typeof dashboardService;\n      questions: typeof questionsService;\n      risks: typeof risksService;\n      actions: typeof actionsService;\n      decisions: typeof decisionsService;\n      chat: typeof chatService;\n      contacts: typeof contactsService;\n      teams: typeof teamsService;\n      documents: typeof documentsService;\n      knowledge: typeof knowledgeService;\n      emails: typeof emailsService;\n      graph: typeof graphService;\n      timeline: typeof timelineService;\n      costs: typeof costsService;\n      notifications: typeof notificationsService;\n      comments: typeof commentsService;\n      members: typeof membersService;\n      profile: typeof profileService;\n      userSettings: typeof userSettingsService;\n      projectSettings: typeof projectSettingsService;\n      apiKeys: typeof apiKeysService;\n      webhooks: typeof webhooksService;\n      audit: typeof auditService;\n      facts: typeof factsService;\n      // Stores\n      appStore: typeof appStore;\n      uiStore: typeof uiStore;\n      dataStore: typeof dataStore;\n      chartsStore: typeof chartsStore;\n      // Version\n      version: string;\n    };\n  }\n}\n\nwindow.godmode = {\n  // Core Services\n  theme,\n  toast,\n  shortcuts,\n  undo: undoManager,\n  storage,\n  http,\n  api,\n  configureApi,\n  auth,\n  projects,\n  // Domain Services\n  dashboard: dashboardService,\n  questions: questionsService,\n  risks: risksService,\n  actions: actionsService,\n  decisions: decisionsService,\n  chat: chatService,\n  contacts: contactsService,\n  teams: teamsService,\n  documents: documentsService,\n  knowledge: knowledgeService,\n  emails: emailsService,\n  graph: graphService,\n  timeline: timelineService,\n  costs: costsService,\n  notifications: notificationsService,\n  comments: commentsService,\n  members: membersService,\n  profile: profileService,\n  userSettings: userSettingsService,\n  projectSettings: projectSettingsService,\n  apiKeys: apiKeysService,\n  webhooks: webhooksService,\n  audit: auditService,\n  facts: factsService,\n  // Stores\n  appStore,\n  uiStore,\n  dataStore,\n  chartsStore,\n  // Version\n  version: '2.0.0',\n};\n\n// Ensure API requests include current project ID for project-scoped endpoints\nsetProjectIdGetter(() => appStore.getState().currentProjectId);\naddRequestInterceptor((opts) => {\n  const projectId = appStore.getState().currentProjectId;\n  if (projectId && opts.headers) {\n    (opts.headers as Record<string, string>)['X-Project-Id'] = projectId;\n  }\n  return opts;\n});\n\n/**\n * Register default keyboard shortcuts\n */\nfunction registerShortcuts(): void {\n  // Undo: Ctrl+Z\n  shortcuts.register({\n    key: 'z',\n    ctrl: true,\n    description: 'Undo last action',\n    handler: async () => {\n      if (undoManager.canUndo()) {\n        await undoManager.undo();\n        toast.info('Undo: ' + (undoManager.getRedoDescription() || 'Action undone'));\n      }\n    },\n  });\n\n  // Redo: Ctrl+Shift+Z or Ctrl+Y\n  shortcuts.register({\n    key: 'z',\n    ctrl: true,\n    shift: true,\n    description: 'Redo last action',\n    handler: async () => {\n      if (undoManager.canRedo()) {\n        await undoManager.redo();\n        toast.info('Redo: ' + (undoManager.getUndoDescription() || 'Action redone'));\n      }\n    },\n  });\n\n  // Theme toggle: Ctrl+Shift+T\n  shortcuts.register({\n    key: 't',\n    ctrl: true,\n    shift: true,\n    description: 'Cycle theme (light/dark/system)',\n    handler: () => {\n      const newMode = theme.cycle();\n      toast.info(`Theme: ${theme.getLabel()}`);\n    },\n  });\n\n  // Help: ?\n  shortcuts.register({\n    key: '?',\n    description: 'Show keyboard shortcuts',\n    handler: () => {\n      shortcuts.showHelp();\n    },\n  });\n}\n\n/**\n * Configure API client\n */\nfunction configureApiClient(): void {\n  // Setup 401 handler for auth redirect\n  configureApi({\n    onUnauthorized: () => {\n      appStore.setCurrentUser(null);\n      toast.error('Session expired. Please log in again.');\n      // Trigger auth modal via event\n      window.dispatchEvent(new CustomEvent('godmode:auth-required'));\n    },\n    onForbidden: () => {\n      toast.error('You do not have permission to perform this action.');\n    },\n  });\n}\n\n/**\n * Initialize UI event handlers\n */\nfunction initializeUI(): void {\n  // Theme toggle button\n  const themeToggle = document.getElementById('theme-toggle');\n  if (themeToggle) {\n    themeToggle.addEventListener('click', () => {\n      theme.cycle();\n      updateThemeButton();\n      toast.info(`Theme: ${theme.getLabel()}`);\n    });\n\n    updateThemeButton();\n  }\n\n  // Initialize Command Palette (SOTA Feature)\n  initCommandPalette();\n\n  // User menu dropdown\n  const userAvatar = document.getElementById('user-avatar');\n  const userDropdown = document.getElementById('user-dropdown');\n  if (userAvatar && userDropdown) {\n    userAvatar.addEventListener('click', (e) => {\n      e.stopPropagation();\n      userDropdown.classList.toggle('hidden');\n    });\n    document.addEventListener('click', () => {\n      userDropdown.classList.add('hidden');\n    });\n  }\n\n  // Login button\n  const loginBtn = document.getElementById('login-btn');\n  if (loginBtn) {\n    loginBtn.addEventListener('click', () => {\n      components.showAuthModal({\n        onSuccess: () => {\n          updateAuthUI();\n          refreshData();\n        }\n      });\n    });\n  }\n\n  // Logout button\n  const logoutBtn = document.getElementById('logout-btn');\n  if (logoutBtn) {\n    logoutBtn.addEventListener('click', async () => {\n      await auth.logout();\n\n      // Clear all project-scoped data and project list\n      clearProjectScopedState();\n      dataStore.setProjects([]);\n      appStore.setCurrentProject(null);\n      appStore.setCurrentProjectId(null);\n\n      // Update UI\n      updateAuthUI();\n      updateDashboard();\n\n      // Redirect to landing page if auth is configured\n      if (appStore.getState().authConfigured) {\n        toast.info('Signed out successfully');\n        window.location.href = '/';\n      } else {\n        toast.info('Signed out');\n      }\n    });\n  }\n\n  // Settings button  open Settings tab (content area), never modal\n  const settingsBtn = document.getElementById('settings-btn');\n  if (settingsBtn) {\n    settingsBtn.addEventListener('click', () => {\n      switchTab('settings');\n    });\n  }\n\n  // Shortcuts button\n  const shortcutsBtn = document.getElementById('shortcuts-btn');\n  if (shortcutsBtn) {\n    shortcutsBtn.addEventListener('click', () => {\n      components.showShortcutsModal();\n    });\n  }\n\n  // Dev tools button\n  const devToolsBtn = document.getElementById('dev-tools-btn');\n  if (devToolsBtn) {\n    devToolsBtn.addEventListener('click', () => {\n      components.showDeveloperModal();\n    });\n  }\n\n  // Profile button  open Profile tab (direct view, no modal)\n  const profileBtn = document.getElementById('profile-btn');\n  if (profileBtn) {\n    profileBtn.addEventListener('click', () => {\n      userDropdown?.classList.add('hidden');\n      switchTab('profile');\n    });\n  }\n\n  // Initialize notifications dropdown in header\n  const notificationsContainer = document.getElementById('notifications-container');\n  if (notificationsContainer) {\n    initNotificationsDropdown(notificationsContainer, {\n      onNotificationClick: (notification) => {\n        console.log('Notification clicked:', notification);\n        // Navigate based on notification type\n        if (notification.entity_type && notification.entity_id) {\n          window.dispatchEvent(new CustomEvent('godmode:navigate', {\n            detail: { type: notification.entity_type, id: notification.entity_id }\n          }));\n        }\n      }\n    });\n  }\n\n  // Sidebar navigation\n  const navItems = document.querySelectorAll('.nav-item[data-tab]');\n  navItems.forEach(item => {\n    item.addEventListener('click', () => {\n      const tab = item.getAttribute('data-tab');\n      if (tab) {\n        switchTab(tab);\n      }\n    });\n  });\n\n  // SOT tabs\n  const sotTabs = document.querySelectorAll('.sot-tab');\n  sotTabs.forEach(tab => {\n    tab.addEventListener('click', () => {\n      const view = tab.getAttribute('data-view');\n      if (view) {\n        sotTabs.forEach(t => t.classList.remove('active'));\n        tab.classList.add('active');\n        uiStore.setSotView(view as 'questions' | 'facts' | 'risks' | 'actions' | 'decisions');\n        loadSotContent(view);\n      }\n    });\n  });\n\n  // Mobile menu toggle\n  const menuToggle = document.getElementById('menu-toggle');\n  const sidebar = document.getElementById('app-sidebar');\n  if (menuToggle && sidebar) {\n    menuToggle.addEventListener('click', () => {\n      sidebar.classList.toggle('open');\n    });\n  }\n\n  // Chat panel is mounted in initializePanels\n\n  // New contact button\n  const newContactBtn = document.getElementById('new-contact-btn');\n  if (newContactBtn) {\n    newContactBtn.addEventListener('click', () => {\n      components.showContactModal({ mode: 'create' });\n    });\n  }\n\n  // Upload buttons\n  const uploadBtns = document.querySelectorAll('#new-upload-btn, #upload-files-btn');\n  uploadBtns.forEach(btn => {\n    btn.addEventListener('click', () => {\n      components.showFileUploadModal();\n    });\n  });\n\n  // Initialize sidebar action buttons\n  initializeSidebarActions();\n\n  // Project selector\n  const projectSelector = document.getElementById('project-selector') as HTMLSelectElement;\n  const newProjectBtn = document.getElementById('new-project-btn');\n  const editProjectBtn = document.getElementById('edit-project-btn');\n\n  if (projectSelector) {\n    projectSelector.addEventListener('change', async () => {\n      const projectId = projectSelector.value;\n      console.log(' Project selector changed, value:', projectId);\n\n      if (projectId) {\n        await selectProject(projectId);\n        if (editProjectBtn) editProjectBtn.classList.remove('hidden');\n      } else {\n        console.log(' Clearing project - starting...');\n\n        // No project selected - clear everything IMMEDIATELY\n        if (editProjectBtn) editProjectBtn.classList.add('hidden');\n\n        // Clear current project in store\n        appStore.setCurrentProject(null);\n        appStore.setCurrentProjectId(null);\n        console.log(' Store cleared');\n\n        // Clear all project-scoped data (no reference to previous project)\n        clearProjectScopedState();\n        console.log(' Data store cleared');\n\n        // IMMEDIATELY show empty state (no async import needed)\n        console.log(' Calling showNoProjectState...');\n        showNoProjectState();\n        console.log(' showNoProjectState called');\n\n        // Switch to Dashboard tab so user sees the empty state\n        switchTab('dashboard');\n\n        loadSotContent(uiStore.getState().sotCurrentView);\n\n        // Also deactivate on server side (fire and forget)\n        http.post('/api/projects/deactivate').catch(() => { });\n\n        console.log(' Project deselected - ALL DONE');\n      }\n    });\n    loadProjects();\n  }\n\n  // New project button  open Projects tab and show create form inline\n  if (newProjectBtn) {\n    newProjectBtn.addEventListener('click', () => {\n      (window as unknown as { __godmodeProjectsOpen?: string })['__godmodeProjectsOpen'] = 'create';\n      switchTab('projects');\n    });\n  }\n\n  // Edit project button  open Projects tab and show edit form inline\n  if (editProjectBtn) {\n    editProjectBtn.addEventListener('click', () => {\n      const currentProject = appStore.getState().currentProject;\n      if (currentProject) {\n        (window as unknown as { __godmodeProjectsOpen?: string })['__godmodeProjectsOpen'] = 'edit:' + currentProject.id;\n        switchTab('projects');\n      }\n    });\n  }\n\n  // Contacts subtabs\n  const contactsSubtabs = document.querySelectorAll('#contacts-subtabs .subtab');\n  contactsSubtabs.forEach(tab => {\n    tab.addEventListener('click', () => {\n      contactsSubtabs.forEach(t => t.classList.remove('active'));\n      tab.classList.add('active');\n      const subtab = tab.getAttribute('data-subtab');\n      document.querySelectorAll('[id^=\"contacts-subtab-\"]').forEach(content => {\n        content.classList.toggle('hidden', content.id !== `contacts-subtab-${subtab}`);\n      });\n    });\n  });\n\n  // Refresh dashboard button\n  const refreshDashboardBtn = document.getElementById('refresh-dashboard-btn');\n  if (refreshDashboardBtn) {\n    refreshDashboardBtn.addEventListener('click', () => {\n      initializePanels();\n      toast.info('Dashboard refreshed');\n    });\n  }\n\n  // Mount panels on tab switch\n  initializePanels();\n\n  // Initialize drop zones\n  initializeDropZones();\n}\n\n/**\n * Show \"No Project Selected\" state immediately (sync, no imports)\n */\nfunction showNoProjectState(): void {\n  console.log(' showNoProjectState() called');\n  const dashboardContainer = document.getElementById('dashboard-container');\n  console.log(' dashboardContainer:', dashboardContainer ? 'FOUND' : 'NOT FOUND');\n  if (!dashboardContainer) return;\n\n  console.log(' Setting innerHTML NOW...');\n\n  dashboardContainer.innerHTML = `\n    <div class=\"dashboard gm-p-5\">\n      <div class=\"no-project-state gm-empty-state\">\n        <svg class=\"gm-empty-state-icon\" width=\"96\" height=\"96\" fill=\"none\" viewBox=\"0 0 24 24\" stroke=\"currentColor\" aria-hidden=\"true\">\n          <path stroke-linecap=\"round\" stroke-linejoin=\"round\" stroke-width=\"1.5\" d=\"M3 7v10a2 2 0 002 2h14a2 2 0 002-2V9a2 2 0 00-2-2h-6l-2-2H5a2 2 0 00-2 2z\"/>\n        </svg>\n        <h2 class=\"gm-empty-state-title\">No Project Selected</h2>\n        <p class=\"gm-empty-state-desc\">\n          Select a project from the dropdown above, or create a new one to get started with your data management.\n        </p>\n        <button id=\"create-project-empty-cta\" class=\"btn btn-primary gm-empty-state-cta\">\n          <svg width=\"20\" height=\"20\" fill=\"none\" viewBox=\"0 0 24 24\" stroke=\"currentColor\" aria-hidden=\"true\">\n            <path stroke-linecap=\"round\" stroke-linejoin=\"round\" stroke-width=\"2\" d=\"M12 4v16m8-8H4\"/>\n          </svg>\n          Create New Project\n        </button>\n      </div>\n    </div>\n  `;\n\n  console.log(' innerHTML SET! Container visible:', dashboardContainer.offsetParent !== null);\n  console.log(' Container display:', window.getComputedStyle(dashboardContainer).display);\n\n  // Bind create project button  open Projects tab with create form inline\n  const createBtn = document.getElementById('create-project-empty-cta');\n  if (createBtn) {\n    createBtn.addEventListener('click', () => {\n      (window as unknown as { __godmodeProjectsOpen?: string })['__godmodeProjectsOpen'] = 'create';\n      switchTab('projects');\n    });\n  }\n}\n\n/**\n * Refresh/recreate the dashboard\n */\nasync function refreshDashboardPanel(): Promise<void> {\n  const dashboardContainer = document.getElementById('dashboard-container');\n  if (!dashboardContainer) return;\n\n  // Check if project is selected - if not, show empty state immediately\n  const currentProject = appStore.getState().currentProject;\n  const currentProjectId = appStore.getState().currentProjectId;\n\n  if (!currentProject && !currentProjectId) {\n    showNoProjectState();\n    return;\n  }\n\n  // Clear and recreate with loading state\n  dashboardContainer.innerHTML = '<div class=\"gm-loading-placeholder\">Loading dashboard...</div>';\n\n  try {\n    const { createDashboard } = await import('./pages/Dashboard');\n    dashboardContainer.innerHTML = '';\n    const dashboard = createDashboard({\n      onStatClick: (statId) => {\n        console.log('Stat clicked:', statId);\n        // Navigate to appropriate view\n        if (statId === 'questions') switchTab('sot');\n        else if (statId === 'facts') {\n          switchTab('sot');\n          uiStore.setSotView('facts');\n          document.querySelectorAll('.sot-tab').forEach(t => {\n            t.classList.toggle('active', t.getAttribute('data-view') === 'facts');\n          });\n          loadSotContent('facts');\n        }\n        else if (statId === 'risks') { switchTab('sot'); uiStore.setSotView('risks'); document.querySelectorAll('.sot-tab').forEach(t => { t.classList.toggle('active', t.getAttribute('data-view') === 'risks'); }); loadSotContent('risks'); }\n        else if (statId === 'actions') { switchTab('sot'); uiStore.setSotView('actions'); document.querySelectorAll('.sot-tab').forEach(t => { t.classList.toggle('active', t.getAttribute('data-view') === 'actions'); }); loadSotContent('actions'); }\n        else if (statId === 'decisions') { switchTab('sot'); uiStore.setSotView('decisions'); document.querySelectorAll('.sot-tab').forEach(t => { t.classList.toggle('active', t.getAttribute('data-view') === 'decisions'); }); loadSotContent('decisions'); }\n        else if (statId === 'contacts') switchTab('contacts');\n      }\n    });\n    dashboardContainer.appendChild(dashboard);\n  } catch (err) {\n    console.error('Failed to load Dashboard:', err);\n    dashboardContainer.innerHTML = '<div class=\"gm-error-placeholder\">Failed to load dashboard</div>';\n  }\n}\n\n/**\n * Initialize and mount panels\n */\nfunction initializePanels(): void {\n  // Dashboard - Main dashboard with all widgets\n  refreshDashboardPanel();\n\n  // Chat panel (sessions, contact pills, RAG)\n  const chatContainer = document.getElementById('chat-panel-container');\n  if (chatContainer && chatContainer.children.length === 0) {\n    import('./pages/ChatPage').then(({ createChat }) => {\n      const panel = createChat({ showSources: true, showSessions: true });\n      chatContainer.appendChild(panel);\n    }).catch((err) => {\n      console.error('[Chat] Failed to load Chat:', err);\n      chatContainer.innerHTML = '<div class=\"gm-loading-placeholder gm-text-secondary\">Failed to load chat</div>';\n    });\n  }\n\n  // EmailsPanel\n  const emailsContainer = document.getElementById('emails-panel-container');\n  if (emailsContainer && emailsContainer.children.length === 0) {\n    import('./pages/EmailsPage').then(({ createEmailsPanel }) => {\n      const panel = createEmailsPanel();\n      emailsContainer.appendChild(panel);\n    });\n  }\n\n  // ContactsPanel\n  const contactsContainer = document.getElementById('contacts-panel-container');\n  if (contactsContainer && contactsContainer.querySelectorAll('.contacts-panel-sota').length === 0) {\n    import('./pages/ContactsPage').then(({ createContactsPanel }) => {\n      contactsContainer.innerHTML = ''; // Clear comments and whitespace\n      const panel = createContactsPanel();\n      contactsContainer.appendChild(panel);\n    });\n  }\n\n  // TeamsPanel\n  const teamsContainer = document.getElementById('teams-panel-container');\n  if (teamsContainer && teamsContainer.children.length === 0) {\n    import('./pages/TeamsPage').then(({ createTeamsPanel }) => {\n      const panel = createTeamsPanel();\n      teamsContainer.appendChild(panel);\n    });\n  }\n\n  // RolesPanel\n  const rolesContainer = document.getElementById('roles-panel-container');\n  if (rolesContainer && rolesContainer.children.length === 0) {\n    import('./pages/RolesPage').then(({ renderRolesPanel }) => {\n      renderRolesPanel(rolesContainer);\n    });\n  }\n\n  // FilesPanel (DocumentsPanel)\n  const filesContainer = document.getElementById('files-panel-container');\n  if (filesContainer && filesContainer.querySelectorAll('.documents-panel-minimal').length === 0) {\n    filesContainer.innerHTML = ''; // Clear comments and whitespace\n    import('./pages/DocumentsPage').then(({ default: createDocumentsPanel }) => {\n      const panel = createDocumentsPanel({\n        onDocumentClick: async (doc) => {\n          // Open document preview modal\n          const { showDocumentPreviewModal } = await import('./components/modals/DocumentPreviewModal');\n          showDocumentPreviewModal({ document: doc });\n        }\n      });\n      filesContainer.appendChild(panel);\n    }).catch(err => {\n      console.error('[FilesPanel] Failed to load DocumentsPanel:', err);\n      filesContainer.innerHTML = '<div class=\"gm-loading-placeholder gm-text-secondary\">Failed to load files panel</div>';\n    });\n  }\n\n  // OrgChart\n  const orgChartContainer = document.getElementById('org-chart-container');\n  if (orgChartContainer && orgChartContainer.children.length === 0) {\n    import('./pages/OrgChartPage').then(({ createOrgChart }) => {\n      const panel = createOrgChart();\n      orgChartContainer.appendChild(panel);\n    });\n  }\n\n  // CostsDashboard (mount if no element children; container may have comment nodes)\n  const costsContainer = document.getElementById('costs-container');\n  if (costsContainer && costsContainer.children.length === 0) {\n    import('./pages/CostsPage').then(({ createCostsDashboard }) => {\n      const panel = createCostsDashboard();\n      costsContainer.appendChild(panel);\n    });\n  }\n\n  // HistoryPanel\n  const historyContainer = document.getElementById('history-container');\n  if (historyContainer && historyContainer.children.length === 0) {\n    import('./pages/HistoryPage').then(({ createHistoryPanel, exportHistory }) => {\n      const panel = createHistoryPanel({\n        onRestore: (entry) => {\n          toast.info(`Restoring ${entry.entityType} \"${entry.entityName || entry.entityId}\"`);\n          // Trigger restore via API\n        }\n      });\n      historyContainer.appendChild(panel);\n\n      // Bind export button\n      const exportBtn = document.getElementById('export-history-btn');\n      if (exportBtn) {\n        exportBtn.addEventListener('click', () => exportHistory('json'));\n      }\n    });\n  }\n}\n\n\n/**\n * Initialize sidebar drop zones\n */\nfunction initializeDropZones(): void {\n  const dropzones = document.querySelectorAll('.dropzone-card[data-type]');\n  console.log('[DropZones] Found', dropzones.length, 'dropzones');\n\n  dropzones.forEach(zone => {\n    const type = zone.getAttribute('data-type');\n    console.log('[DropZones] Adding click handler for:', type);\n\n    // Click handler - open appropriate modal or file picker\n    zone.addEventListener('click', async (e) => {\n      console.log('[DropZones] Click on:', type);\n      e.preventDefault();\n      e.stopPropagation();\n\n      try {\n        switch (type) {\n          case 'emails':\n            // Open EmailComposer modal\n            console.log('[DropZones] Opening EmailComposer...');\n            const { showEmailComposer } = await import('./components/EmailComposer');\n            showEmailComposer({\n              onSave: () => {\n                toast.success('Email imported');\n              }\n            });\n            return;\n\n          case 'conversations':\n            // Open ConversationComposer modal\n            console.log('[DropZones] Opening ConversationComposer...');\n            const { showConversationComposer } = await import('./components/ConversationComposer');\n            showConversationComposer({\n              onImport: () => {\n                toast.success('Conversation imported');\n              }\n            });\n            return;\n\n          case 'transcripts':\n            // Open TranscriptComposer modal\n            console.log('[DropZones] Opening TranscriptComposer...');\n            const { showTranscriptComposer } = await import('./components/TranscriptComposer');\n            showTranscriptComposer({\n              onImport: () => {\n                toast.success('Transcript imported');\n              }\n            });\n            return;\n\n          case 'documents':\n          default:\n            // Open file picker for documents\n            console.log('[DropZones] Opening file picker for documents...');\n            const input = document.createElement('input');\n            input.type = 'file';\n            input.multiple = true;\n            input.accept = '.pdf,.doc,.docx,.txt,.md,.rtf,.odt,.xls,.xlsx,.ppt,.pptx,.csv,.json';\n\n            input.onchange = () => {\n              if (input.files && input.files.length > 0) {\n                handleDroppedFiles(Array.from(input.files), 'documents');\n              }\n            };\n\n            input.click();\n            return;\n        }\n      } catch (err) {\n        console.error('[DropZones] Error:', err);\n        toast.error('Failed to open import dialog');\n      }\n    });\n\n    // Drag and drop handlers\n    zone.addEventListener('dragover', (e) => {\n      e.preventDefault();\n      zone.classList.add('drag-over');\n    });\n\n    zone.addEventListener('dragleave', () => {\n      zone.classList.remove('drag-over');\n    });\n\n    zone.addEventListener('drop', (e) => {\n      e.preventDefault();\n      zone.classList.remove('drag-over');\n\n      const dataTransfer = (e as DragEvent).dataTransfer;\n      if (dataTransfer?.files && dataTransfer.files.length > 0) {\n        handleDroppedFiles(Array.from(dataTransfer.files), type || 'documents');\n      }\n    });\n  });\n}\n\n/**\n * Handle dropped or selected files\n */\nasync function handleDroppedFiles(files: File[], type: string): Promise<void> {\n  // Add files to pending list\n  addPendingFiles(files);\n\n  const fileNames = files.map(f => f.name).join(', ');\n  toast.info(`Added ${files.length} ${type} to queue: ${fileNames.substring(0, 50)}${fileNames.length > 50 ? '...' : ''}`);\n}\n\n/**\n * Update theme button icon\n */\nfunction updateThemeButton(): void {\n  const themeToggle = document.getElementById('theme-toggle');\n  if (themeToggle) {\n    themeToggle.textContent = theme.getIcon();\n    themeToggle.title = `Theme: ${theme.getLabel()}`;\n  }\n}\n\n// ==================== CLIENT-SIDE ROUTING ====================\n\n/** Valid tab names for routing */\nconst VALID_TABS = ['dashboard', 'chat', 'sot', 'timeline', 'contacts', 'team-analysis', 'files', 'graph', 'emails', 'costs', 'history', 'roles', 'profile', 'settings', 'admin', 'org', 'projects'];\n\n/**\n * Get current tab from URL pathname\n */\nfunction getTabFromUrl(): string {\n  const pathname = window.location.pathname;\n  // Match /app/tabname or /app/tabname/\n  const match = pathname.match(/^\\/app\\/([^/]+)/);\n  if (match && VALID_TABS.includes(match[1])) {\n    return match[1];\n  }\n  // Default to dashboard for /app or /app/\n  return 'dashboard';\n}\n\n/**\n * Update browser URL for current tab (without page reload)\n */\nfunction updateUrlForTab(tabName: string, replace = false): void {\n  const newPath = tabName === 'dashboard' ? '/app' : `/app/${tabName}`;\n  const currentPath = window.location.pathname;\n\n  // Only update if path is different\n  if (currentPath !== newPath) {\n    if (replace) {\n      window.history.replaceState({ tab: tabName }, '', newPath);\n    } else {\n      window.history.pushState({ tab: tabName }, '', newPath);\n    }\n  }\n}\n\n/**\n * Initialize URL-based routing\n */\nfunction initRouting(): void {\n  // Handle browser back/forward buttons\n  window.addEventListener('popstate', (event) => {\n    const tab = event.state?.tab || getTabFromUrl();\n    switchTab(tab, false); // false = don't update URL again\n  });\n\n  // On initial load, read tab from URL\n  const initialTab = getTabFromUrl();\n  if (initialTab !== 'dashboard') {\n    // If URL has a specific tab, switch to it (will happen after UI init)\n    setTimeout(() => switchTab(initialTab, true), 0); // true = replace URL state\n  }\n}\n\n/**\n * Switch to a tab\n * @param tabName - The tab to switch to\n * @param updateUrl - Whether to update the browser URL (default: true)\n */\nfunction switchTab(tabName: string, updateUrl = true): void {\n  // Use SOTA View Transitions API\n  startViewTransition(() => {\n    // Update sidebar nav items\n    document.querySelectorAll('.nav-item[data-tab]').forEach(item => {\n      item.classList.toggle('active', item.getAttribute('data-tab') === tabName);\n    });\n\n    // Update tab content\n    document.querySelectorAll('.tab-content').forEach(tab => {\n      tab.classList.toggle('active', tab.id === `tab-${tabName}`);\n      tab.classList.toggle('hidden', tab.id !== `tab-${tabName}`);\n    });\n\n    // Close mobile sidebar\n    const sidebar = document.getElementById('app-sidebar');\n    if (sidebar) {\n      sidebar.classList.remove('open');\n    }\n\n    // Update browser URL (client-side routing)\n    if (updateUrl) {\n      updateUrlForTab(tabName);\n    }\n\n    // Update store\n    uiStore.setTab(tabName as 'dashboard' | 'chat' | 'sot' | 'timeline' | 'contacts' | 'team-analysis' | 'files' | 'graph' | 'emails' | 'costs' | 'history' | 'roles' | 'profile' | 'settings' | 'admin' | 'org' | 'projects');\n\n    // Load profile page when switching to profile tab (direct view, no modal)\n    if (tabName === 'profile') {\n      const profileContainer = document.getElementById('profile-page-container');\n      if (profileContainer) {\n        import('./components/modals/ProfileModal').then(({ initProfilePage }) => {\n          initProfilePage(profileContainer, {\n            onBack: () => switchTab('dashboard'),\n          });\n        });\n      }\n    }\n\n    // Load projects page when switching to projects tab (list + inline form, no modal)\n    if (tabName === 'projects') {\n      const projectsContainer = document.getElementById('projects-page-container');\n      if (projectsContainer) {\n        import('./pages/ProjectsPage').then(({ initProjectsPage }) => {\n          initProjectsPage(projectsContainer, {\n            onBack: () => switchTab('dashboard'),\n          });\n        });\n      }\n    }\n\n    // Load settings page when switching to settings tab\n    if (tabName === 'settings') {\n      const settingsContainer = document.getElementById('settings-page-container');\n      if (settingsContainer) {\n        import('./pages/SettingsPage').then(({ initSettingsPage }) => {\n          initSettingsPage(settingsContainer, {\n            onBack: () => switchTab('dashboard'),\n          });\n        });\n      }\n    }\n\n    // Load admin panel when switching to admin tab\n    if (tabName === 'admin') {\n      const adminContainer = document.getElementById('tab-admin');\n      if (adminContainer) {\n        import('./pages/AdminPage').then(({ initAdminPanel }) => {\n          initAdminPanel(adminContainer);\n        });\n      }\n    }\n\n    // Load Graph Explorer when switching to graph tab\n    if (tabName === 'graph') {\n      const graphContainer = document.getElementById('graph-container');\n      // Check for actual element children, not just comments or text nodes\n      const hasContent = graphContainer?.querySelector('.graph-explorer');\n      if (graphContainer && !hasContent) {\n        console.log('[Graph] Loading GraphExplorer...');\n        import('./components/graph/GraphExplorer').then(({ createGraphExplorer }) => {\n          graphContainer.innerHTML = ''; // Clear any placeholder\n          const explorer = createGraphExplorer({\n            onNodeSelect: (node) => {\n              console.log('Graph node selected:', node);\n            },\n            onQueryExecute: (cypher) => {\n              console.log('Query executed:', cypher);\n            },\n          });\n          graphContainer.appendChild(explorer);\n          console.log('[Graph] GraphExplorer loaded successfully');\n        }).catch(err => {\n          console.error('[Graph] Failed to load GraphExplorer:', err);\n          graphContainer.innerHTML = '<div class=\"gm-loading-placeholder gm-text-center\">Failed to load Graph Explorer</div>';\n        });\n      }\n    }\n\n    // Load Timeline Panel when switching to timeline tab\n    if (tabName === 'timeline') {\n      const timelineContainer = document.getElementById('timeline-content');\n      const hasContent = timelineContainer?.querySelector('.timeline-panel');\n      if (timelineContainer && !hasContent) {\n        console.log('[Timeline] Loading TimelinePanel...');\n        import('./pages/TimelinePage').then(({ createTimelinePanel }) => {\n          timelineContainer.innerHTML = ''; // Clear any placeholder\n          const panel = createTimelinePanel({\n            onEventClick: (event) => {\n              console.log('Timeline event clicked:', event);\n              // Navigate to entity if possible\n              if (event.entity_type && event.entity_id) {\n                const entityType = event.entity_type;\n                if (entityType === 'question') {\n                  if (entityType === 'question') {\n                    import('./components/questions/QuestionDetailView').then(async ({ createQuestionDetailView }) => {\n                      const container = document.getElementById('timeline-content');\n                      if (container && event.entity_id) {\n                        try {\n                          // Fetch question data first to satisfy props interface\n                          const question = await window.godmode.questions.get(event.entity_id);\n                          if (!question) throw new Error('Question not found');\n\n                          container.innerHTML = '';\n                          const detailView = createQuestionDetailView({\n                            question: question,\n                            onClose: () => switchTab('timeline'), // Map onBack to onClose\n                          });\n                          container.appendChild(detailView);\n                        } catch (err) {\n                          console.error('Failed to load question details:', err);\n                          toast.error('Failed to load question details');\n                        }\n                      }\n                    });\n                  } else if (entityType === 'decision') {\n                    import('./components/decisions/DecisionDetailView').then(async ({ createDecisionDetailView }) => {\n                      const container = document.getElementById('timeline-content');\n                      if (container && event.entity_id) {\n                        try {\n                          const decision = await window.godmode.decisions.get(event.entity_id);\n                          if (!decision) throw new Error('Decision not found');\n\n                          container.innerHTML = '';\n                          const detailView = createDecisionDetailView({\n                            decision: decision,\n                            onClose: () => switchTab('timeline'),\n                          });\n                          container.appendChild(detailView);\n                        } catch (err) {\n                          console.error('Failed to load decision details:', err);\n                          toast.error('Failed to load decision details');\n                        }\n                      }\n                    });\n                  } else if (entityType === 'fact') {\n                    import('./components/facts/FactDetailView').then(async ({ createFactDetailView }) => {\n                      const container = document.getElementById('timeline-content');\n                      if (container && event.entity_id) {\n                        try {\n                          const fact = await window.godmode.facts.get(event.entity_id);\n                          if (!fact) throw new Error('Fact not found');\n\n                          container.innerHTML = '';\n                          const detailView = createFactDetailView({\n                            fact: fact,\n                            onClose: () => switchTab('timeline'),\n                          });\n                          container.appendChild(detailView);\n                        } catch (err) {\n                          console.error('Failed to load fact details:', err);\n                          toast.error('Failed to load fact details');\n                        }\n                      }\n                    });\n                  } else if (entityType === 'risk') {\n                    import('./components/risks/RiskDetailView').then(async ({ createRiskDetailView }) => {\n                      const container = document.getElementById('timeline-content');\n                      if (container && event.entity_id) {\n                        try {\n                          const risk = await window.godmode.risks.get(event.entity_id);\n                          if (!risk) throw new Error('Risk not found');\n\n                          container.innerHTML = '';\n                          const detailView = createRiskDetailView({\n                            risk: risk,\n                            onClose: () => switchTab('timeline'),\n                          });\n                          container.appendChild(detailView);\n                        } catch (err) {\n                          console.error('Failed to load risk details:', err);\n                          toast.error('Failed to load risk details');\n                        }\n                      }\n                    });\n                  } else if (entityType === 'action') {\n                    import('./components/actions/ActionDetailView').then(async ({ createActionDetailView }) => {\n                      const container = document.getElementById('timeline-content');\n                      if (container && event.entity_id) {\n                        try {\n                          // SOTA: Fetch action data first to satisfy strict props\n                          const action = await window.godmode.actions.get(event.entity_id);\n                          if (!action) throw new Error('Action not found');\n\n                          container.innerHTML = '';\n                          const detailView = createActionDetailView({\n                            action: action,\n                            onClose: () => switchTab('timeline'),\n                          });\n                          container.appendChild(detailView);\n                        } catch (err) {\n                          console.error('Failed to load action details:', err);\n                          toast.error('Failed to load action details');\n                        }\n                      }\n                    });\n                  }\n                } else {\n                  toast.info(`Event: ${event.title}`);\n                }\n              }\n            },\n          });\n          timelineContainer.appendChild(panel);\n          console.log('[Timeline] TimelinePanel loaded successfully');\n        }).catch(err => {\n          console.error('[Timeline] Failed to load TimelinePanel:', err);\n          timelineContainer.innerHTML = '<div class=\"gm-loading-placeholder gm-text-center\">Failed to load Timeline</div>';\n        });\n      }\n    }\n\n    // Load Team Analysis when switching to team-analysis tab\n    if (tabName === 'team-analysis') {\n      const teamAnalysisContainer = document.getElementById('team-analysis-container');\n      const hasContent = teamAnalysisContainer?.querySelector('.team-analysis-panel');\n      if (teamAnalysisContainer && !hasContent) {\n        console.log('[TeamAnalysis] Loading TeamAnalysis component...');\n        import('./pages/TeamAnalysisPage').then(({ createTeamAnalysis }) => {\n          teamAnalysisContainer.innerHTML = ''; // Clear any placeholder\n          const panel = createTeamAnalysis();\n          teamAnalysisContainer.appendChild(panel);\n          console.log('[TeamAnalysis] TeamAnalysis loaded successfully');\n\n          // Setup subtab switching after component is loaded\n          setupTeamAnalysisSubtabs();\n        }).catch(err => {\n          console.error('[TeamAnalysis] Failed to load TeamAnalysis:', err);\n          teamAnalysisContainer.innerHTML = '<div class=\"gm-loading-placeholder gm-text-center\">Failed to load Team Analysis</div>';\n        });\n      } else {\n        // Component already loaded, just setup subtabs\n        setupTeamAnalysisSubtabs();\n      }\n    }\n  });\n}\n\n/**\n * Setup Team Analysis subtab switching\n */\nfunction setupTeamAnalysisSubtabs(): void {\n  // Import the store to control subtab switching\n  import('./stores/teamAnalysis').then(({ teamAnalysisStore }) => {\n    document.querySelectorAll('#team-analysis-subtabs .subtab').forEach(btn => {\n      // Remove existing listeners to prevent duplicates\n      const newBtn = btn.cloneNode(true);\n      btn.parentNode?.replaceChild(newBtn, btn);\n\n      newBtn.addEventListener('click', (e) => {\n        const subtab = (e.target as HTMLElement).dataset.subtab as 'profiles' | 'team' | 'graph';\n        if (subtab) {\n          console.log('[TeamAnalysis] Switching to subtab:', subtab);\n          // Update active state in UI\n          document.querySelectorAll('#team-analysis-subtabs .subtab').forEach(b => {\n            b.classList.toggle('active', b.getAttribute('data-subtab') === subtab);\n          });\n          // Update the store which triggers re-render\n          teamAnalysisStore.setSubtab(subtab);\n        }\n      });\n    });\n  });\n}\n\n/**\n * Load projects\n */\nasync function loadProjects(): Promise<void> {\n  const selector = document.getElementById('project-selector') as HTMLSelectElement;\n  if (!selector) return;\n\n  try {\n    const projectList = await projects.getAll();\n\n    selector.innerHTML = '<option value=\"\">Select Project...</option>';\n    projectList.forEach(project => {\n      const option = document.createElement('option');\n      option.value = project.id;\n      option.textContent = project.name + (project.isDefault ? ' (default)' : '');\n      selector.appendChild(option);\n    });\n\n    // Select current project if any; when none persisted (e.g. storage blocked), auto-select first or default\n    const currentProjectId = appStore.getState().currentProjectId;\n    const editProjectBtn = document.getElementById('edit-project-btn');\n\n    if (currentProjectId) {\n      selector.value = currentProjectId;\n      if (editProjectBtn) editProjectBtn.classList.remove('hidden');\n    } else if (projectList.length > 0) {\n      const firstOrDefault = projectList.find((p: { isDefault?: boolean }) => p.isDefault) || projectList[0];\n      selector.value = firstOrDefault.id;\n      appStore.setCurrentProject(firstOrDefault);\n      appStore.setCurrentProjectId(firstOrDefault.id);\n      if (editProjectBtn) editProjectBtn.classList.remove('hidden');\n    } else {\n      if (editProjectBtn) editProjectBtn.classList.add('hidden');\n    }\n  } catch (error) {\n    // Projects API may not be available yet\n    console.warn('Projects not available:', error);\n  }\n}\n\n/**\n * Clear all project-scoped state so no data from another project can leak into the UI.\n */\nfunction clearProjectScopedState(): void {\n  dataStore.setQuestions([]);\n  dataStore.setRisks([]);\n  dataStore.setActions([]);\n  dataStore.setDecisions([]);\n  dataStore.setFacts([]);\n  dataStore.setContacts([]);\n  dataStore.clearChatHistory();\n  teamAnalysisStore.reset();\n  chartsStore.destroyAll();\n  try {\n    localStorage.removeItem('copilot_session');\n  } catch {\n    // ignore if localStorage unavailable\n  }\n  // Clear URL hash and project-scoped query params so no ID from previous project remains\n  if (typeof window !== 'undefined' && (window.location.hash || window.location.search)) {\n    const base = window.location.pathname || '/app';\n    window.history.replaceState(null, '', base);\n  }\n}\n\n/**\n * Select a project\n */\nasync function selectProject(projectId: string): Promise<void> {\n  try {\n    clearProjectScopedState();\n    const project = await projects.activate(projectId);\n\n    if (project) {\n      toast.success(`Switched to: ${project.name}`);\n      await refreshData();\n    }\n  } catch {\n    toast.error('Failed to load project');\n  }\n}\n\n/**\n * Refresh all data for current project\n */\nasync function refreshData(): Promise<void> {\n  try {\n    // First, reload projects list (may auto-select first/default if store was empty)\n    await loadProjects();\n\n    let currentProject = appStore.getState().currentProject;\n    let currentProjectId = appStore.getState().currentProjectId;\n\n    // If store still empty but selector has a value (e.g. user picked one), sync store from selector\n    if (!currentProject && !currentProjectId) {\n      const selector = document.getElementById('project-selector') as HTMLSelectElement;\n      if (selector?.value) {\n        try {\n          const project = await projects.activate(selector.value);\n          if (project) {\n            appStore.setCurrentProject(project);\n            appStore.setCurrentProjectId(project.id);\n            currentProject = project;\n            currentProjectId = project.id;\n          }\n        } catch {\n          // ignore\n        }\n      }\n    }\n\n    if (!currentProject && !currentProjectId) {\n      // No project selected - show empty state and ensure dashboard tab is visible\n      console.log(' No project selected - showing empty state');\n      switchTab('dashboard');\n      clearProjectScopedState();\n      await refreshDashboardPanel();\n      loadSotContent(uiStore.getState().sotCurrentView);\n      return;\n    }\n\n    // API endpoints don't use projectId in path - project context is server-side\n    const [questionsRes, risksRes, actionsRes, decisionsRes, contactsRes] = await Promise.all([\n      http.get<{ questions: unknown[] }>('/api/questions').catch(() => ({ data: { questions: [] } })),\n      http.get<{ risks: unknown[] }>('/api/risks').catch(() => ({ data: { risks: [] } })),\n      http.get<{ actions: unknown[] }>('/api/actions').catch(() => ({ data: { actions: [] } })),\n      http.get<{ decisions: unknown[] }>('/api/decisions').catch(() => ({ data: { decisions: [] } })),\n      http.get<{ contacts: unknown[] }>('/api/contacts').catch(() => ({ data: { contacts: [] } })),\n    ]);\n\n    dataStore.setQuestions((questionsRes.data.questions || []) as []);\n    dataStore.setRisks((risksRes.data.risks || []) as []);\n    dataStore.setActions((actionsRes.data.actions || []) as []);\n    dataStore.setDecisions((decisionsRes.data.decisions || []) as []);\n    dataStore.setContacts((contactsRes.data.contacts || []) as []);\n\n    // Re-render dashboard with new data\n    await refreshDashboardPanel();\n    loadSotContent(uiStore.getState().sotCurrentView);\n  } catch {\n    console.error('Failed to refresh data');\n  }\n}\n\n/**\n * Update dashboard stats\n */\nfunction updateDashboard(): void {\n  const statsGrid = document.getElementById('dashboard-stats');\n  const dashboardContent = document.getElementById('dashboard-content');\n  if (!statsGrid) return;\n\n  // Check if project is selected\n  const currentProject = appStore.getState().currentProject;\n  const currentProjectId = appStore.getState().currentProjectId;\n\n  if (!currentProject && !currentProjectId) {\n    // No project selected - show empty state\n    statsGrid.innerHTML = `\n      <div class=\"no-project-message gm-grid-col-all gm-empty-state gm-p-6\">\n        <svg class=\"gm-empty-state-icon\" width=\"64\" height=\"64\" fill=\"none\" viewBox=\"0 0 24 24\" stroke=\"currentColor\" aria-hidden=\"true\">\n          <path stroke-linecap=\"round\" stroke-linejoin=\"round\" stroke-width=\"1.5\" d=\"M3 7v10a2 2 0 002 2h14a2 2 0 002-2V9a2 2 0 00-2-2h-6l-2-2H5a2 2 0 00-2 2z\"/>\n        </svg>\n        <h3 class=\"gm-empty-state-title gm-text-lg\">No Project Selected</h3>\n        <p class=\"gm-empty-state-desc\">\n          Select an existing project from the dropdown above or create a new one to start managing your data.\n        </p>\n        <button id=\"create-project-cta\" class=\"btn btn-primary gm-empty-state-cta\">\n          <svg width=\"16\" height=\"16\" fill=\"none\" viewBox=\"0 0 24 24\" stroke=\"currentColor\" aria-hidden=\"true\">\n            <path stroke-linecap=\"round\" stroke-linejoin=\"round\" stroke-width=\"2\" d=\"M12 4v16m8-8H4\"/>\n          </svg>\n          Create New Project\n        </button>\n      </div>\n    `;\n\n    if (dashboardContent) {\n      dashboardContent.classList.add('gm-none');\n    }\n\n    // Bind create project button  open Projects tab with create form inline\n    const createBtn = document.getElementById('create-project-cta');\n    if (createBtn) {\n      createBtn.addEventListener('click', () => {\n        (window as unknown as { __godmodeProjectsOpen?: string })['__godmodeProjectsOpen'] = 'create';\n        switchTab('projects');\n      });\n    }\n\n    return;\n  }\n\n  if (dashboardContent) {\n    dashboardContent.classList.remove('gm-none');\n  }\n\n  const state = dataStore.getState();\n\n  // Count only active questions (exclude dismissed/resolved/answered)\n  const activeQuestions = state.questions.filter(q =>\n    q.status !== 'dismissed' && q.status !== 'resolved' && q.status !== 'answered'\n  );\n\n  statsGrid.innerHTML = `\n    <div class=\"stat-card\">\n      <div class=\"stat-value\">${activeQuestions.length}</div>\n      <div class=\"stat-label\">Questions</div>\n    </div>\n    <div class=\"stat-card\">\n      <div class=\"stat-value\">${state.risks.length}</div>\n      <div class=\"stat-label\">Risks</div>\n    </div>\n    <div class=\"stat-card\">\n      <div class=\"stat-value\">${state.actions.length}</div>\n      <div class=\"stat-label\">Actions</div>\n    </div>\n    <div class=\"stat-card\">\n      <div class=\"stat-value\">${state.decisions.length}</div>\n      <div class=\"stat-label\">Decisions</div>\n    </div>\n    <div class=\"stat-card\">\n      <div class=\"stat-value\">${state.contacts.length}</div>\n      <div class=\"stat-label\">Contacts</div>\n    </div>\n  `;\n}\n\n/**\n * Load SOT content\n */\nfunction loadSotContent(view: string): void {\n  const container = document.getElementById('sot-content');\n  if (!container) return;\n\n  const state = dataStore.getState();\n  let items: Array<{ id: string;[key: string]: unknown }> = [];\n  let template: (item: { id: string;[key: string]: unknown }) => string;\n\n  switch (view) {\n    case 'questions':\n      // Use the full QuestionsPanel with Generate button, filters and detail view\n      container.innerHTML = '';\n      const questionsPanel = createQuestionsPanel({\n        useDetailView: true,\n        containerElement: container\n      });\n      container.appendChild(questionsPanel);\n      return; // Exit early since we're using the full component\n    case 'facts':\n      container.innerHTML = '';\n      const factsPanel = createFactsPanel({\n        useDetailView: true,\n        containerElement: container\n      });\n      container.appendChild(factsPanel);\n      return;\n    case 'decisions':\n      container.innerHTML = '';\n      const decisionsPanel = createDecisionsPanel({\n        useDetailView: true,\n        containerElement: container\n      });\n      container.appendChild(decisionsPanel);\n      return;\n    case 'risks':\n      container.innerHTML = '';\n      const risksPanel = createRisksPanel({\n        useDetailView: true,\n        containerElement: container\n      });\n      container.appendChild(risksPanel);\n      return;\n    case 'actions':\n      container.innerHTML = '';\n      const actionsPanel = createActionsPanel({\n        useDetailView: true,\n        containerElement: container\n      });\n      container.appendChild(actionsPanel);\n      return;\n    default:\n      container.innerHTML = '<p class=\"text-muted\">Select a view</p>';\n      return;\n  }\n}\n\n/**\n * Show question detail view\n */\nfunction showQuestionDetail(question: Question, container: HTMLElement): void {\n  // Store original content for restoration\n  const originalContent = container.innerHTML;\n\n  // Transform question to match the expected interface\n  const questionData = {\n    id: question.id,\n    content: String(question.content || question.question || ''),\n    context: question.context as string | undefined,\n    priority: (question.priority || 'medium') as 'low' | 'medium' | 'high' | 'critical',\n    status: (question.status || 'pending') as 'pending' | 'assigned' | 'resolved' | 'reopened' | 'dismissed',\n    assigned_to: question.assigned_to as string | undefined,\n    answer: question.answer as string | undefined,\n    answer_source: question.answer_source as 'manual' | 'manual-edit' | 'auto-detected' | 'document' | 'ai' | undefined,\n    category: question.category as string | undefined,\n    source_file: question.source_file as string | undefined,\n    created_at: String(question.created_at || question.createdAt || new Date().toISOString()),\n    updated_at: question.updated_at as string | undefined,\n    follow_up_to: question.follow_up_to as string | undefined,\n    answered_by_contact_id: question.answered_by_contact_id as string | undefined,\n    answered_by_name: question.answered_by_name as string | undefined,\n    sla_hours: question.sla_hours as number | undefined,\n    sla_breached: question.sla_breached as boolean | undefined,\n    extracted_entities: question.extracted_entities as Array<{ type: string; name: string }> | undefined,\n    extracted_topics: question.extracted_topics as Array<{ name: string }> | undefined,\n  };\n\n  // Create detail view\n  const detailView = createQuestionDetailView({\n    question: questionData,\n    onClose: () => {\n      // Restore original content\n      container.innerHTML = originalContent;\n      // Re-bind click handlers\n      loadSotContent('questions');\n    },\n    onUpdate: (updatedQuestion) => {\n      // Update question in data store\n      const state = dataStore.getState();\n      const updatedQuestions = state.questions.map((q) =>\n        q.id === updatedQuestion.id ? { ...q, ...updatedQuestion } as Question : q\n      );\n      dataStore.setQuestions(updatedQuestions);\n    },\n    onNavigateToQuestion: (questionId) => {\n      // Find and show the target question\n      const state = dataStore.getState();\n      const targetQuestion = state.questions.find((q) => q.id === questionId);\n      if (targetQuestion) {\n        showQuestionDetail(targetQuestion, container);\n      }\n    }\n  });\n\n  // Replace content with detail view\n  container.innerHTML = '';\n  container.appendChild(detailView);\n}\n\n/**\n * Escape HTML\n */\nfunction escapeHtml(text: string): string {\n  const div = document.createElement('div');\n  div.textContent = text;\n  return div.innerHTML;\n}\n\n/**\n * Format markdown (basic)\n */\nfunction formatMarkdown(text: string): string {\n  return escapeHtml(text)\n    .replace(/\\*\\*(.*?)\\*\\*/g, '<strong>$1</strong>')\n    .replace(/\\*(.*?)\\*/g, '<em>$1</em>')\n    .replace(/`(.*?)`/g, '<code>$1</code>')\n    .replace(/\\n/g, '<br>');\n}\n\n/**\n * Pending files manager\n */\nconst pendingFiles: File[] = [];\n\nfunction updatePendingFilesUI(): void {\n  const countEl = document.getElementById('pending-count');\n  const listEl = document.getElementById('pending-files-list');\n\n  if (countEl) {\n    countEl.textContent = `${pendingFiles.length} file${pendingFiles.length !== 1 ? 's' : ''}`;\n  }\n\n  if (listEl) {\n    if (pendingFiles.length === 0) {\n      listEl.innerHTML = '<div class=\"empty-hint\">No files pending</div>';\n    } else {\n      listEl.innerHTML = pendingFiles.map((file, index) => `\n        <div class=\"pending-file-item\" data-index=\"${index}\">\n          <div class=\"pending-file-info\">\n            <div class=\"pending-file-name\" title=\"${escapeHtml(file.name)}\">${escapeHtml(file.name)}</div>\n            <div class=\"pending-file-size\">${formatFileSize(file.size)}</div>\n          </div>\n          <button class=\"pending-file-remove\" data-index=\"${index}\" title=\"Remove\"></button>\n        </div>\n      `).join('');\n\n      // Bind remove buttons\n      listEl.querySelectorAll('.pending-file-remove').forEach(btn => {\n        btn.addEventListener('click', (e) => {\n          e.stopPropagation();\n          const idx = parseInt((btn as HTMLElement).dataset.index || '0');\n          pendingFiles.splice(idx, 1);\n          updatePendingFilesUI();\n        });\n      });\n    }\n  }\n}\n\nfunction formatFileSize(bytes: number): string {\n  if (bytes < 1024) return bytes + ' B';\n  if (bytes < 1024 * 1024) return (bytes / 1024).toFixed(1) + ' KB';\n  return (bytes / (1024 * 1024)).toFixed(1) + ' MB';\n}\n\nfunction addPendingFiles(files: FileList | File[]): void {\n  Array.from(files).forEach(file => {\n    if (!pendingFiles.some(f => f.name === file.name && f.size === file.size)) {\n      pendingFiles.push(file);\n    }\n  });\n  updatePendingFilesUI();\n}\n\n/**\n * Initialize sidebar action buttons\n */\nfunction initializeSidebarActions(): void {\n  // Process Files button\n  const processBtn = document.getElementById('process-files-btn');\n  if (processBtn) {\n    processBtn.addEventListener('click', async () => {\n      if (pendingFiles.length === 0) {\n        toast.warning('No files to process. Add files first.');\n        return;\n      }\n\n      processBtn.setAttribute('disabled', 'true');\n      processBtn.innerHTML = '<span class=\"btn-icon\"></span> Processing...';\n\n      try {\n        const result = await documentsService.upload(pendingFiles);\n        if (result.success) {\n          toast.success(`Processed ${result.files.length} files successfully`);\n          pendingFiles.length = 0; // Clear array\n          updatePendingFilesUI();\n          refreshData();\n        }\n      } catch (error) {\n        toast.error('Failed to process files');\n        console.error('Process error:', error);\n      } finally {\n        processBtn.removeAttribute('disabled');\n        processBtn.innerHTML = '<span class=\"btn-icon\"></span> Process Files';\n      }\n    });\n  }\n\n  // Export Knowledge button\n  const exportKnowledgeBtn = document.getElementById('export-knowledge-btn');\n  if (exportKnowledgeBtn) {\n    exportKnowledgeBtn.addEventListener('click', async () => {\n      try {\n        const data = dataStore.getState();\n        const knowledge = {\n          facts: data.facts || [],\n          decisions: data.decisions || [],\n          exportedAt: new Date().toISOString()\n        };\n\n        const blob = new Blob([JSON.stringify(knowledge, null, 2)], { type: 'application/json' });\n        const url = URL.createObjectURL(blob);\n        const a = document.createElement('a');\n        a.href = url;\n        a.download = 'godmode-knowledge-export.json';\n        a.click();\n        URL.revokeObjectURL(url);\n\n        toast.success('Knowledge exported');\n      } catch (error) {\n        toast.error('Export failed');\n      }\n    });\n  }\n\n  // Export Knowledge to clipboard\n  const exportKnowledgeClipboard = document.getElementById('export-knowledge-clipboard');\n  if (exportKnowledgeClipboard) {\n    exportKnowledgeClipboard.addEventListener('click', async () => {\n      try {\n        const data = dataStore.getState();\n        const knowledge = {\n          facts: data.facts || [],\n          decisions: data.decisions || []\n        };\n        await navigator.clipboard.writeText(JSON.stringify(knowledge, null, 2));\n        toast.success('Copied to clipboard');\n      } catch (error) {\n        toast.error('Copy failed');\n      }\n    });\n  }\n\n  // Export Questions button\n  const exportQuestionsBtn = document.getElementById('export-questions-btn');\n  if (exportQuestionsBtn) {\n    exportQuestionsBtn.addEventListener('click', async () => {\n      try {\n        const data = dataStore.getState();\n        const questions = data.questions || [];\n\n        const blob = new Blob([JSON.stringify(questions, null, 2)], { type: 'application/json' });\n        const url = URL.createObjectURL(blob);\n        const a = document.createElement('a');\n        a.href = url;\n        a.download = 'godmode-questions-export.json';\n        a.click();\n        URL.revokeObjectURL(url);\n\n        toast.success('Questions exported');\n      } catch (error) {\n        toast.error('Export failed');\n      }\n    });\n  }\n\n  // Export Questions to clipboard\n  const exportQuestionsClipboard = document.getElementById('export-questions-clipboard');\n  if (exportQuestionsClipboard) {\n    exportQuestionsClipboard.addEventListener('click', async () => {\n      try {\n        const data = dataStore.getState();\n        const questions = data.questions || [];\n        await navigator.clipboard.writeText(JSON.stringify(questions, null, 2));\n        toast.success('Copied to clipboard');\n      } catch (error) {\n        toast.error('Copy failed');\n      }\n    });\n  }\n\n  // Copy Overdue Items button\n  const copyOverdueBtn = document.getElementById('copy-overdue-btn');\n  if (copyOverdueBtn) {\n    copyOverdueBtn.addEventListener('click', async () => {\n      try {\n        const data = dataStore.getState();\n        const now = new Date();\n\n        const overdueActions = (data.actions || []).filter(a => {\n          if (a.status === 'completed') return false;\n          const dueDate = a.dueDate;\n          if (!dueDate) return false;\n          return new Date(dueDate) < now;\n        });\n\n        const overdueQuestions = (data.questions || []).filter(q => {\n          if (q.status === 'resolved') return false;\n          const createdAt = q.created_at || q.createdAt;\n          if (!createdAt) return false;\n          const created = new Date(createdAt);\n          const sevenDaysAgo = new Date(now.getTime() - 7 * 24 * 60 * 60 * 1000);\n          return created < sevenDaysAgo;\n        });\n\n        const overdue = {\n          actions: overdueActions,\n          questions: overdueQuestions,\n          exportedAt: now.toISOString()\n        };\n\n        await navigator.clipboard.writeText(JSON.stringify(overdue, null, 2));\n        toast.success(`Copied ${overdueActions.length} actions and ${overdueQuestions.length} questions`);\n      } catch (error) {\n        toast.error('Copy failed');\n      }\n    });\n  }\n\n  // Clean Orphan Data button\n  const cleanOrphanBtn = document.getElementById('clean-orphan-btn');\n  if (cleanOrphanBtn) {\n    cleanOrphanBtn.addEventListener('click', async () => {\n      const confirmed = await components.confirm(\n        'This will remove orphaned data entries that are not linked to any documents. Continue?',\n        { title: 'Clean Orphan Data', confirmText: 'Clean', confirmClass: 'btn-warning' }\n      );\n\n      if (confirmed) {\n        try {\n          const response = await http.post('/api/cleanup/orphans');\n          toast.success('Orphan data cleaned');\n          refreshData();\n        } catch (error) {\n          toast.error('Cleanup failed');\n        }\n      }\n    });\n  }\n\n  // Reset Data button (clears knowledge; keeps team, contacts, cost)\n  const resetDataBtn = document.getElementById('reset-data-btn');\n  if (resetDataBtn) {\n    resetDataBtn.addEventListener('click', async () => {\n      const confirmed = await components.confirm(\n        'This will clear all knowledge data (facts, decisions, questions, risks, actions, documents, etc.) for the current project. Team, contacts, and cost data will be kept. Continue?',\n        { title: 'Reset Project Data', confirmText: 'Reset Knowledge Data', confirmClass: 'btn-danger' }\n      );\n\n      if (confirmed) {\n        try {\n          await http.post('/api/reset');\n          toast.success('Project data reset; team, contacts and cost preserved.');\n          refreshData();\n        } catch (error) {\n          toast.error('Reset failed');\n        }\n      }\n    });\n  }\n\n  // Initialize pending files UI\n  updatePendingFilesUI();\n}\n\n/**\n * Initialize the application\n */\nasync function init(): Promise<void> {\n  console.log(' GodMode Frontend initializing...');\n\n  // Initialize legacy bridge for backwards compatibility\n  initLegacyBridge();\n  console.log(' Legacy bridge initialized');\n\n  // Configure API client\n  configureApiClient();\n  console.log(' API client configured');\n\n  // Initialize authentication\n  await initAuth();\n  console.log(' Auth initialized');\n\n  // Theme is already initialized via its constructor\n  console.log(` Theme: ${theme.getMode()} (effective: ${theme.getEffective()})`);\n\n  // Register keyboard shortcuts\n  registerShortcuts();\n  console.log(' Keyboard shortcuts registered');\n\n  // Initialize global search (Cmd+K / Ctrl+K)\n  initGlobalSearch({\n    onResultClick: (result) => {\n      console.log('Search result clicked:', result);\n      // Navigate to the result based on type\n      window.dispatchEvent(new CustomEvent('godmode:navigate', { detail: result }));\n    }\n  });\n  console.log(' Global search initialized');\n\n  // Listen for projects list changed (e.g. from Projects tab create/edit/delete)\n  window.addEventListener('godmode:projects-changed', () => {\n    loadProjects();\n  });\n\n  // Listen for godmode:navigate (e.g. \"View source document\" from Fact/Decision/Risk detail)\n  window.addEventListener('godmode:navigate', async (e: Event) => {\n    const d = (e as CustomEvent).detail;\n    if (!d || d.tab !== 'files' || !d.documentId) return;\n    switchTab('files');\n    await new Promise(r => setTimeout(r, 400)); // allow Files panel to mount\n    const doc = await documentsService.get(d.documentId);\n    if (doc) {\n      const { showDocumentPreviewModal } = await import('./components/modals/DocumentPreviewModal');\n      showDocumentPreviewModal({ document: doc });\n    }\n  });\n\n  // Initialize UI\n  initializeUI();\n  console.log(' UI initialized');\n\n  // Initialize client-side routing (reads URL and activates correct tab)\n  initRouting();\n  console.log(' Client-side routing initialized');\n\n  // Load initial data (only if authenticated or auth not required)\n  if (auth.isAuthenticated()) {\n    refreshData();\n    console.log(' Data loading started');\n  } else if (appStore.getState().authConfigured) {\n    // Auth required but not logged in - redirect to landing page\n    console.log(' Authentication required - redirecting to landing page');\n    window.location.href = '/';\n    return;\n  } else {\n    // Auth not configured - guest mode\n    console.log(' Guest mode - loading data');\n    refreshData();\n  }\n\n  const loading = document.getElementById('app-loading');\n  if (loading) {\n    loading.classList.add('fade-out');\n    setTimeout(() => loading.classList.add('hidden'), 300);\n  }\n\n  // Log successful initialization\n  console.log(' GodMode Frontend ready');\n  console.log(` Version: ${window.godmode.version}`);\n  console.log(' Press ? for keyboard shortcuts');\n}\n\n/**\n * Initialize authentication\n */\nasync function initAuth(): Promise<void> {\n  // Check auth status and session\n  const isAuthenticated = await auth.init();\n\n  // Update UI based on auth state\n  updateAuthUI();\n\n  // Listen for auth required events (e.g., 401 from API)\n  auth.onAuthRequired(() => {\n    components.showAuthModal({\n      required: true, // Session expired, must re-authenticate\n      onSuccess: () => {\n        updateAuthUI();\n        refreshData();\n        toast.success('Session restored! Refreshing data...');\n      }\n    });\n  });\n\n  // Listen for auth success to refresh data\n  window.addEventListener('godmode:auth-success', () => {\n    updateAuthUI();\n    refreshData();\n  });\n}\n\n/**\n * Show full-screen authentication blocker with integrated login form\n * Completely blocks access to the app until login\n */\nfunction showAuthRequiredMessage(): void {\n  // Remove any existing overlay\n  const existing = document.getElementById('auth-blocker-overlay');\n  if (existing) existing.remove();\n\n  // Create full-screen blocker overlay\n  const authBlocker = document.createElement('div');\n  authBlocker.id = 'auth-blocker-overlay';\n  authBlocker.innerHTML = `\n    <div class=\"auth-card\">\n      <div class=\"auth-logo\">\n        <svg width=\"32\" height=\"32\" viewBox=\"0 0 24 24\" fill=\"none\" stroke=\"white\" stroke-width=\"2\" stroke-linecap=\"round\" stroke-linejoin=\"round\">\n          <path d=\"M12 2L2 7l10 5 10-5-10-5z\"/>\n          <path d=\"M2 17l10 5 10-5\"/>\n          <path d=\"M2 12l10 5 10-5\"/>\n        </svg>\n      </div>\n      <h1 class=\"auth-title\">Welcome to GodMode</h1>\n      <p class=\"auth-subtitle\">Your AI-powered knowledge management platform</p>\n      \n      <div class=\"auth-tabs\">\n        <button class=\"auth-tab active\" data-tab=\"login\">Sign In</button>\n        <button class=\"auth-tab\" data-tab=\"register\">Create Account</button>\n      </div>\n      \n      <!-- Login Form -->\n      <form id=\"login-form\" class=\"auth-form\">\n        <div class=\"form-group\">\n          <label class=\"form-label\">Email</label>\n          <input type=\"email\" class=\"form-input\" id=\"login-email\" placeholder=\"you@example.com\" required autocomplete=\"email\">\n        </div>\n        <div class=\"form-group\">\n          <label class=\"form-label\">Password</label>\n          <div class=\"input-wrapper\">\n            <input type=\"password\" class=\"form-input\" id=\"login-password\" placeholder=\"Enter your password\" required autocomplete=\"current-password\">\n          </div>\n        </div>\n        <div class=\"form-error\" id=\"login-error\"></div>\n        <button type=\"submit\" class=\"auth-submit\" id=\"login-submit\">Sign In</button>\n        <div class=\"auth-footer\">\n          <button type=\"button\" class=\"auth-link\" id=\"forgot-link\">Forgot your password?</button>\n        </div>\n      </form>\n      \n      <!-- Register Form -->\n      <form id=\"register-form\" class=\"auth-form hidden\">\n        <div class=\"form-group\">\n          <label class=\"form-label\">Email *</label>\n          <input type=\"email\" class=\"form-input\" id=\"register-email\" placeholder=\"you@example.com\" required autocomplete=\"email\">\n        </div>\n        <div class=\"form-group\">\n          <label class=\"form-label\">Display Name</label>\n          <input type=\"text\" class=\"form-input\" id=\"register-name\" placeholder=\"Your name (optional)\" autocomplete=\"name\">\n        </div>\n        <div class=\"form-group\">\n          <label class=\"form-label\">Password *</label>\n          <input type=\"password\" class=\"form-input\" id=\"register-password\" placeholder=\"Min. 12 characters\" required minlength=\"12\" autocomplete=\"new-password\">\n          <span class=\"form-hint\">Use at least 12 characters with mixed case, numbers, and symbols</span>\n        </div>\n        <div class=\"form-group\">\n          <label class=\"form-label\">Confirm Password *</label>\n          <input type=\"password\" class=\"form-input\" id=\"register-confirm\" placeholder=\"Confirm your password\" required autocomplete=\"new-password\">\n        </div>\n        <div class=\"form-error\" id=\"register-error\"></div>\n        <button type=\"submit\" class=\"auth-submit\" id=\"register-submit\">Create Account</button>\n      </form>\n      \n      <!-- Forgot Password Form -->\n      <form id=\"forgot-form\" class=\"auth-form hidden\">\n        <p class=\"auth-forgot-intro\">\n          Enter your email and we'll send you a link to reset your password.\n        </p>\n        <div class=\"form-group\">\n          <label class=\"form-label\">Email</label>\n          <input type=\"email\" class=\"form-input\" id=\"forgot-email\" placeholder=\"you@example.com\" required autocomplete=\"email\">\n        </div>\n        <div class=\"form-error\" id=\"forgot-error\"></div>\n        <button type=\"submit\" class=\"auth-submit\">Send Reset Link</button>\n        <div class=\"auth-footer\">\n          <button type=\"button\" class=\"auth-link\" id=\"back-to-login\">Back to Sign In</button>\n        </div>\n      </form>\n    </div>\n  `;\n\n  document.body.appendChild(authBlocker);\n\n  // Tab switching\n  const tabs = authBlocker.querySelectorAll('.auth-tab');\n  const loginForm = authBlocker.querySelector('#login-form') as HTMLFormElement;\n  const registerForm = authBlocker.querySelector('#register-form') as HTMLFormElement;\n  const forgotForm = authBlocker.querySelector('#forgot-form') as HTMLFormElement;\n\n  tabs.forEach(tab => {\n    tab.addEventListener('click', () => {\n      tabs.forEach(t => t.classList.remove('active'));\n      tab.classList.add('active');\n\n      const tabId = tab.getAttribute('data-tab');\n      loginForm.classList.toggle('hidden', tabId !== 'login');\n      registerForm.classList.toggle('hidden', tabId !== 'register');\n      forgotForm.classList.add('hidden');\n    });\n  });\n\n  // Forgot password link\n  const forgotLink = authBlocker.querySelector('#forgot-link');\n  forgotLink?.addEventListener('click', () => {\n    loginForm.classList.add('hidden');\n    registerForm.classList.add('hidden');\n    forgotForm.classList.remove('hidden');\n    tabs.forEach(t => t.classList.remove('active'));\n  });\n\n  // Back to login\n  const backToLogin = authBlocker.querySelector('#back-to-login');\n  backToLogin?.addEventListener('click', () => {\n    forgotForm.classList.add('hidden');\n    loginForm.classList.remove('hidden');\n    tabs[0].classList.add('active');\n  });\n\n  // Handle Login\n  loginForm.addEventListener('submit', async (e) => {\n    e.preventDefault();\n    const email = (authBlocker.querySelector('#login-email') as HTMLInputElement).value;\n    const password = (authBlocker.querySelector('#login-password') as HTMLInputElement).value;\n    const errorEl = authBlocker.querySelector('#login-error') as HTMLElement;\n    const submitBtn = authBlocker.querySelector('#login-submit') as HTMLButtonElement;\n\n    submitBtn.disabled = true;\n    submitBtn.textContent = 'Signing in...';\n    errorEl.classList.remove('visible');\n\n    try {\n      await auth.login({ email, password });\n      authBlocker.remove();\n      updateAuthUI();\n      refreshData();\n      toast.success('Welcome back!');\n    } catch (err) {\n      errorEl.textContent = err instanceof Error ? err.message : 'Login failed. Please try again.';\n      errorEl.classList.add('visible');\n    } finally {\n      submitBtn.disabled = false;\n      submitBtn.textContent = 'Sign In';\n    }\n  });\n\n  // Handle Register\n  registerForm.addEventListener('submit', async (e) => {\n    e.preventDefault();\n    const email = (authBlocker.querySelector('#register-email') as HTMLInputElement).value;\n    const name = (authBlocker.querySelector('#register-name') as HTMLInputElement).value;\n    const password = (authBlocker.querySelector('#register-password') as HTMLInputElement).value;\n    const confirm = (authBlocker.querySelector('#register-confirm') as HTMLInputElement).value;\n    const errorEl = authBlocker.querySelector('#register-error') as HTMLElement;\n    const submitBtn = authBlocker.querySelector('#register-submit') as HTMLButtonElement;\n\n    if (password !== confirm) {\n      errorEl.textContent = 'Passwords do not match';\n      errorEl.classList.add('visible');\n      return;\n    }\n\n    if (password.length < 12) {\n      errorEl.textContent = 'Password must be at least 12 characters';\n      errorEl.classList.add('visible');\n      return;\n    }\n\n    submitBtn.disabled = true;\n    submitBtn.textContent = 'Creating account...';\n    errorEl.classList.remove('visible');\n\n    try {\n      const result = await auth.register({ email, password, display_name: name || undefined });\n\n      if (result.needsEmailVerification) {\n        toast.success('Account created! Check your email to verify.');\n        // Switch to login tab\n        tabs.forEach(t => t.classList.remove('active'));\n        tabs[0].classList.add('active');\n        registerForm.classList.add('hidden');\n        loginForm.classList.remove('hidden');\n      } else {\n        authBlocker.remove();\n        updateAuthUI();\n        refreshData();\n        toast.success('Account created! Welcome to GodMode.');\n      }\n    } catch (err) {\n      errorEl.textContent = err instanceof Error ? err.message : 'Registration failed. Please try again.';\n      errorEl.classList.add('visible');\n    } finally {\n      submitBtn.disabled = false;\n      submitBtn.textContent = 'Create Account';\n    }\n  });\n\n  // Handle Forgot Password\n  forgotForm.addEventListener('submit', async (e) => {\n    e.preventDefault();\n    const email = (authBlocker.querySelector('#forgot-email') as HTMLInputElement).value;\n    const submitBtn = forgotForm.querySelector('.auth-submit') as HTMLButtonElement;\n\n    submitBtn.disabled = true;\n    submitBtn.textContent = 'Sending...';\n\n    try {\n      await auth.forgotPassword(email);\n      toast.success('If an account exists, you will receive a reset link.');\n      // Go back to login\n      forgotForm.classList.add('hidden');\n      loginForm.classList.remove('hidden');\n      tabs[0].classList.add('active');\n    } catch {\n      toast.success('If an account exists, you will receive a reset link.');\n    } finally {\n      submitBtn.disabled = false;\n      submitBtn.textContent = 'Send Reset Link';\n    }\n  });\n\n  // Focus email input\n  setTimeout(() => {\n    const emailInput = authBlocker.querySelector('#login-email') as HTMLInputElement;\n    emailInput?.focus();\n  }, 100);\n}\n\n/**\n * Update UI based on auth state\n */\nfunction updateAuthUI(): void {\n  const user = auth.getCurrentUser();\n  const userAvatar = document.getElementById('user-avatar');\n  const userDropdown = document.getElementById('user-dropdown');\n  const loginBtn = document.getElementById('login-btn');\n\n  // Remove auth blocker if it exists\n  const authBlocker = document.getElementById('auth-blocker-overlay');\n  if (authBlocker && user) {\n    authBlocker.remove();\n  }\n\n  // Admin nav button - only visible for superadmin\n  const adminNavBtn = document.getElementById('nav-admin-btn');\n\n  if (user) {\n    // Show user info\n    if (userAvatar) {\n      const displayName = user.name || user.email.split('@')[0] || 'User';\n      const initials = (user.name?.[0] || user.email[0]).toUpperCase();\n\n      // Generate fallback avatar URL using UI Avatars\n      const fallbackAvatar = `https://ui-avatars.com/api/?name=${encodeURIComponent(displayName)}&background=e11d48&color=fff&size=80&font-size=0.4&bold=true`;\n      const avatarUrl = user.avatar || fallbackAvatar;\n\n      // Use image for avatar\n      userAvatar.innerHTML = `<img src=\"${avatarUrl}\" alt=\"${escapeHtml(initials)}\" class=\"gm-avatar-img\" onerror=\"this.classList.add('gm-none');this.parentElement.textContent=this.alt\">`;\n      userAvatar.title = user.name || user.email;\n      userAvatar.classList.remove('hidden');\n    }\n    if (loginBtn) {\n      loginBtn.classList.add('hidden');\n    }\n    // Update dropdown content\n    if (userDropdown) {\n      const userName = userDropdown.querySelector('.user-name');\n      const userEmail = userDropdown.querySelector('.user-email');\n      if (userName) userName.textContent = user.name || 'User';\n      if (userEmail) userEmail.textContent = user.email;\n    }\n\n    // Show/hide Admin nav based on role\n    if (adminNavBtn) {\n      if (user.role === 'superadmin') {\n        adminNavBtn.classList.remove('hidden');\n        console.log(' Admin nav enabled for superadmin:', user.email);\n      } else {\n        adminNavBtn.classList.add('hidden');\n      }\n    }\n  } else {\n    // Show login button\n    if (userAvatar) {\n      userAvatar.classList.add('hidden');\n    }\n    if (loginBtn) {\n      loginBtn.classList.remove('hidden');\n    }\n    // Hide admin nav when logged out\n    if (adminNavBtn) {\n      adminNavBtn.classList.add('hidden');\n    }\n  }\n}\n\n// Initialize when DOM is ready\nif (document.readyState === 'loading') {\n  document.addEventListener('DOMContentLoaded', init);\n} else {\n  init();\n}\n\n// Add components to global\nObject.assign(window.godmode, { components });\n\n// Export for potential use in other modules\nexport {\n  theme, toast, shortcuts, undoManager, storage, http, api, configureApi, auth, projects,\n  dashboardService, questionsService, risksService, actionsService, decisionsService,\n  chatService, contactsService, teamsService, documentsService, knowledgeService,\n  emailsService, graphService, timelineService, costsService, notificationsService,\n  commentsService, membersService, profileService, userSettingsService, projectSettingsService,\n  apiKeysService, webhooksService, auditService\n};\nexport { appStore, uiStore, dataStore, chartsStore };\nexport { components };\n"],"file":"main-v_cFye9p.js"}