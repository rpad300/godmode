{"version":3,"file":"billing-CSo_L-5s.js","sources":["../../frontend/src/services/billing.ts"],"sourcesContent":["/**\r\n * Billing Service\r\n * API client for project billing and cost control\r\n */\r\n\r\nimport { http } from './api';\r\n\r\n// ============================================\r\n// TYPES\r\n// ============================================\r\n\r\nexport interface ProjectBillingSummary {\r\n  balance_eur: number;\r\n  unlimited_balance: boolean;\r\n  period_key: string;\r\n  tokens_this_period: number;\r\n  provider_cost_this_period: number;\r\n  billable_cost_this_period: number;\r\n  requests_this_period: number;\r\n  current_tier_name: string | null;\r\n  current_markup_percent: number;\r\n  balance_percent_used: number;\r\n}\r\n\r\nexport interface ProjectBillingOverview {\r\n  project_id: string;\r\n  project_name: string;\r\n  balance_eur: number;\r\n  unlimited_balance: boolean;\r\n  tokens_this_period: number;\r\n  billable_cost_this_period: number;\r\n  is_blocked: boolean;\r\n  current_tier_name: string | null;\r\n}\r\n\r\nexport interface PricingConfig {\r\n  id: string;\r\n  scope: 'global' | 'project';\r\n  project_id: string | null;\r\n  fixed_markup_percent: number;\r\n  period_type: 'monthly' | 'weekly';\r\n  usd_to_eur_rate: number;\r\n  is_active: boolean;\r\n  created_at: string;\r\n  updated_at: string;\r\n  pricing_tiers?: PricingTier[];\r\n}\r\n\r\nexport interface PricingTier {\r\n  id: string;\r\n  pricing_config_id: string;\r\n  token_limit: number | null;\r\n  markup_percent: number;\r\n  name: string | null;\r\n  tier_order: number;\r\n}\r\n\r\nexport interface BalanceTransaction {\r\n  id: string;\r\n  project_id: string;\r\n  transaction_type: 'credit' | 'debit' | 'adjustment' | 'refund';\r\n  amount_eur: number;\r\n  balance_before: number;\r\n  balance_after: number;\r\n  llm_request_id: string | null;\r\n  description: string | null;\r\n  performed_by: string | null;\r\n  created_at: string;\r\n}\r\n\r\nexport interface BalanceCheckResult {\r\n  allowed: boolean;\r\n  reason?: string;\r\n  balance_eur: number;\r\n  unlimited: boolean;\r\n  tokens_in_period: number;\r\n  current_tier_name?: string;\r\n  current_markup_percent: number;\r\n}\r\n\r\n// ============================================\r\n// ADMIN FUNCTIONS (Superadmin only)\r\n// ============================================\r\n\r\n/**\r\n * Get billing overview for all projects\r\n */\r\nexport async function getAllProjectsBilling(): Promise<ProjectBillingOverview[]> {\r\n  try {\r\n    const response = await http.get<{ success: boolean; projects: ProjectBillingOverview[] }>(\r\n      '/api/admin/billing/projects'\r\n    );\r\n    return response.data?.projects || [];\r\n  } catch (error) {\r\n    console.error('[Billing] Error getting all projects billing:', error);\r\n    return [];\r\n  }\r\n}\r\n\r\n/**\r\n * Get global pricing config\r\n */\r\nexport async function getGlobalPricingConfig(): Promise<PricingConfig | null> {\r\n  try {\r\n    const response = await http.get<{ success: boolean; config: PricingConfig }>(\r\n      '/api/admin/billing/pricing'\r\n    );\r\n    return response.data?.config || null;\r\n  } catch (error) {\r\n    console.error('[Billing] Error getting global pricing config:', error);\r\n    return null;\r\n  }\r\n}\r\n\r\n/**\r\n * Set global pricing config\r\n */\r\nexport async function setGlobalPricingConfig(config: {\r\n  fixed_markup_percent?: number;\r\n  period_type?: 'monthly' | 'weekly';\r\n  usd_to_eur_rate?: number;\r\n}): Promise<{ success: boolean; error?: string }> {\r\n  try {\r\n    const response = await http.post<{ success: boolean; error?: string }>(\r\n      '/api/admin/billing/pricing',\r\n      config\r\n    );\r\n    return response.data || { success: false };\r\n  } catch (error) {\r\n    console.error('[Billing] Error setting global pricing config:', error);\r\n    return { success: false, error: String(error) };\r\n  }\r\n}\r\n\r\n/**\r\n * Get global pricing tiers\r\n */\r\nexport async function getGlobalPricingTiers(): Promise<{ tiers: PricingTier[]; config_id: string | null }> {\r\n  try {\r\n    const response = await http.get<{ success: boolean; tiers: PricingTier[]; config_id: string }>(\r\n      '/api/admin/billing/pricing/tiers'\r\n    );\r\n    return { \r\n      tiers: response.data?.tiers || [], \r\n      config_id: response.data?.config_id || null \r\n    };\r\n  } catch (error) {\r\n    console.error('[Billing] Error getting global pricing tiers:', error);\r\n    return { tiers: [], config_id: null };\r\n  }\r\n}\r\n\r\n/**\r\n * Set global pricing tiers\r\n */\r\nexport async function setGlobalPricingTiers(tiers: Array<{\r\n  token_limit: number | null;\r\n  markup_percent: number;\r\n  name?: string;\r\n}>): Promise<{ success: boolean; error?: string }> {\r\n  try {\r\n    const response = await http.post<{ success: boolean; error?: string }>(\r\n      '/api/admin/billing/pricing/tiers',\r\n      { tiers }\r\n    );\r\n    return response.data || { success: false };\r\n  } catch (error) {\r\n    console.error('[Billing] Error setting global pricing tiers:', error);\r\n    return { success: false, error: String(error) };\r\n  }\r\n}\r\n\r\n/**\r\n * Get project billing summary (admin)\r\n */\r\nexport async function getProjectBillingSummaryAdmin(projectId: string): Promise<ProjectBillingSummary | null> {\r\n  try {\r\n    const response = await http.get<{ success: boolean; summary: ProjectBillingSummary }>(\r\n      `/api/admin/billing/projects/${projectId}`\r\n    );\r\n    return response.data?.summary || null;\r\n  } catch (error) {\r\n    console.error('[Billing] Error getting project billing summary:', error);\r\n    return null;\r\n  }\r\n}\r\n\r\n/**\r\n * Get project balance (admin)\r\n */\r\nexport async function getProjectBalance(projectId: string): Promise<BalanceCheckResult | null> {\r\n  try {\r\n    const response = await http.get<BalanceCheckResult & { success: boolean }>(\r\n      `/api/admin/billing/projects/${projectId}/balance`\r\n    );\r\n    if (response.data?.success) {\r\n      return response.data;\r\n    }\r\n    return null;\r\n  } catch (error) {\r\n    console.error('[Billing] Error getting project balance:', error);\r\n    return null;\r\n  }\r\n}\r\n\r\n/**\r\n * Credit project balance (admin)\r\n */\r\nexport async function creditProjectBalance(\r\n  projectId: string, \r\n  amount: number, \r\n  description?: string\r\n): Promise<{ success: boolean; new_balance?: number; error?: string }> {\r\n  try {\r\n    const response = await http.post<{ success: boolean; new_balance: number; reason?: string }>(\r\n      `/api/admin/billing/projects/${projectId}/balance`,\r\n      { amount, description }\r\n    );\r\n    return {\r\n      success: response.data?.success || false,\r\n      new_balance: response.data?.new_balance,\r\n      error: response.data?.reason\r\n    };\r\n  } catch (error) {\r\n    console.error('[Billing] Error crediting project balance:', error);\r\n    return { success: false, error: String(error) };\r\n  }\r\n}\r\n\r\n/**\r\n * Set project unlimited mode (admin)\r\n */\r\nexport async function setProjectUnlimited(\r\n  projectId: string, \r\n  unlimited: boolean\r\n): Promise<{ success: boolean; error?: string }> {\r\n  try {\r\n    const response = await http.post<{ success: boolean; unlimited: boolean }>(\r\n      `/api/admin/billing/projects/${projectId}/balance`,\r\n      { unlimited }\r\n    );\r\n    return { success: response.data?.success || false };\r\n  } catch (error) {\r\n    console.error('[Billing] Error setting project unlimited:', error);\r\n    return { success: false, error: String(error) };\r\n  }\r\n}\r\n\r\n/**\r\n * Get project balance transactions (admin)\r\n */\r\nexport async function getBalanceTransactions(\r\n  projectId: string, \r\n  limit = 50\r\n): Promise<BalanceTransaction[]> {\r\n  try {\r\n    const response = await http.get<{ success: boolean; transactions: BalanceTransaction[] }>(\r\n      `/api/admin/billing/projects/${projectId}/transactions?limit=${limit}`\r\n    );\r\n    return response.data?.transactions || [];\r\n  } catch (error) {\r\n    console.error('[Billing] Error getting balance transactions:', error);\r\n    return [];\r\n  }\r\n}\r\n\r\n/**\r\n * Get project pricing override (admin)\r\n */\r\nexport async function getProjectPricingOverride(projectId: string): Promise<{\r\n  override: PricingConfig | null;\r\n  using_global: boolean;\r\n  global_config: PricingConfig | null;\r\n}> {\r\n  try {\r\n    const response = await http.get<{\r\n      success: boolean;\r\n      override: PricingConfig | null;\r\n      using_global: boolean;\r\n      global_config: PricingConfig | null;\r\n    }>(`/api/admin/billing/projects/${projectId}/pricing`);\r\n    return {\r\n      override: response.data?.override || null,\r\n      using_global: response.data?.using_global ?? true,\r\n      global_config: response.data?.global_config || null\r\n    };\r\n  } catch (error) {\r\n    console.error('[Billing] Error getting project pricing override:', error);\r\n    return { override: null, using_global: true, global_config: null };\r\n  }\r\n}\r\n\r\n/**\r\n * Set project pricing override (admin)\r\n */\r\nexport async function setProjectPricingOverride(projectId: string, config: {\r\n  fixed_markup_percent?: number;\r\n  period_type?: 'monthly' | 'weekly';\r\n  usd_to_eur_rate?: number;\r\n  tiers?: Array<{\r\n    token_limit: number | null;\r\n    markup_percent: number;\r\n    name?: string;\r\n  }>;\r\n}): Promise<{ success: boolean; config_id?: string; error?: string }> {\r\n  try {\r\n    const response = await http.post<{ success: boolean; config_id?: string; error?: string }>(\r\n      `/api/admin/billing/projects/${projectId}/pricing`,\r\n      config\r\n    );\r\n    return response.data || { success: false };\r\n  } catch (error) {\r\n    console.error('[Billing] Error setting project pricing override:', error);\r\n    return { success: false, error: String(error) };\r\n  }\r\n}\r\n\r\n/**\r\n * Delete project pricing override (admin)\r\n */\r\nexport async function deleteProjectPricingOverride(projectId: string): Promise<boolean> {\r\n  try {\r\n    const response = await http.delete<{ success: boolean }>(\r\n      `/api/admin/billing/projects/${projectId}/pricing`\r\n    );\r\n    return response.data?.success || false;\r\n  } catch (error) {\r\n    console.error('[Billing] Error deleting project pricing override:', error);\r\n    return false;\r\n  }\r\n}\r\n\r\n// ============================================\r\n// PROJECT FUNCTIONS (For project members)\r\n// ============================================\r\n\r\n/**\r\n * Get billing summary for current project\r\n */\r\nexport async function getProjectBillingSummary(projectId: string): Promise<ProjectBillingSummary | null> {\r\n  try {\r\n    const response = await http.get<{ success: boolean; summary: ProjectBillingSummary }>(\r\n      `/api/projects/${projectId}/billing`\r\n    );\r\n    return response.data?.summary || null;\r\n  } catch (error) {\r\n    console.error('[Billing] Error getting project billing summary:', error);\r\n    return null;\r\n  }\r\n}\r\n\r\n// ============================================\r\n// UTILITIES\r\n// ============================================\r\n\r\n/**\r\n * Format currency in EUR\r\n */\r\nexport function formatEur(amount: number): string {\r\n  return new Intl.NumberFormat('pt-PT', {\r\n    style: 'currency',\r\n    currency: 'EUR',\r\n    minimumFractionDigits: 2,\r\n    maximumFractionDigits: 2\r\n  }).format(amount);\r\n}\r\n\r\n/**\r\n * Format large numbers (tokens)\r\n */\r\nexport function formatTokens(count: number): string {\r\n  if (count >= 1_000_000) {\r\n    return `${(count / 1_000_000).toFixed(1)}M`;\r\n  }\r\n  if (count >= 1_000) {\r\n    return `${(count / 1_000).toFixed(1)}K`;\r\n  }\r\n  return count.toString();\r\n}\r\n\r\n/**\r\n * Get tier display info\r\n */\r\nexport function getTierDisplayInfo(tiers: PricingTier[]): string {\r\n  if (!tiers || tiers.length === 0) {\r\n    return 'No tiers configured';\r\n  }\r\n  \r\n  return tiers.map((tier, index) => {\r\n    const prevLimit = index > 0 ? tiers[index - 1].token_limit : 0;\r\n    const fromStr = formatTokens(prevLimit || 0);\r\n    const toStr = tier.token_limit ? formatTokens(tier.token_limit) : 'âˆž';\r\n    return `${fromStr}-${toStr}: +${tier.markup_percent}%`;\r\n  }).join(' | ');\r\n}\r\n\r\n// ============================================\r\n// SERVICE EXPORT\r\n// ============================================\r\n\r\n// ============================================\r\n// EXCHANGE RATE\r\n// ============================================\r\n\r\nexport interface ExchangeRateConfig {\r\n  auto: boolean;\r\n  manualRate: number;\r\n  currentRate: number;\r\n  source: string;\r\n  lastUpdated: string | null;\r\n  defaultRate: number;\r\n}\r\n\r\n/**\r\n * Get exchange rate configuration\r\n */\r\nexport async function getExchangeRateConfig(): Promise<ExchangeRateConfig | null> {\r\n  try {\r\n    const response = await http.get<{ success: boolean } & ExchangeRateConfig>(\r\n      '/api/admin/billing/exchange-rate'\r\n    );\r\n    if (!response.data?.success) return null;\r\n    return {\r\n      auto: response.data.auto,\r\n      manualRate: response.data.manualRate,\r\n      currentRate: response.data.currentRate,\r\n      source: response.data.source,\r\n      lastUpdated: response.data.lastUpdated,\r\n      defaultRate: response.data.defaultRate\r\n    };\r\n  } catch (error) {\r\n    console.error('[Billing] Error getting exchange rate config:', error);\r\n    return null;\r\n  }\r\n}\r\n\r\n/**\r\n * Set exchange rate mode\r\n */\r\nexport async function setExchangeRateMode(\r\n  auto: boolean,\r\n  manualRate?: number\r\n): Promise<{ success: boolean; error?: string }> {\r\n  try {\r\n    const response = await http.post<{ success: boolean; error?: string }>(\r\n      '/api/admin/billing/exchange-rate',\r\n      { auto, manualRate }\r\n    );\r\n    return response.data || { success: false };\r\n  } catch (error) {\r\n    console.error('[Billing] Error setting exchange rate mode:', error);\r\n    return { success: false, error: String(error) };\r\n  }\r\n}\r\n\r\n/**\r\n * Refresh exchange rate from API\r\n */\r\nexport async function refreshExchangeRate(): Promise<{ \r\n  success: boolean; \r\n  rate?: number; \r\n  source?: string;\r\n  error?: string \r\n}> {\r\n  try {\r\n    const response = await http.post<{ \r\n      success: boolean; \r\n      rate: number; \r\n      source: string;\r\n      error?: string \r\n    }>(\r\n      '/api/admin/billing/exchange-rate/refresh',\r\n      {}\r\n    );\r\n    return response.data || { success: false };\r\n  } catch (error) {\r\n    console.error('[Billing] Error refreshing exchange rate:', error);\r\n    return { success: false, error: String(error) };\r\n  }\r\n}\r\n\r\nexport const billingService = {\r\n  // Admin functions\r\n  getAllProjectsBilling,\r\n  getGlobalPricingConfig,\r\n  setGlobalPricingConfig,\r\n  getGlobalPricingTiers,\r\n  setGlobalPricingTiers,\r\n  getProjectBillingSummaryAdmin,\r\n  getProjectBalance,\r\n  creditProjectBalance,\r\n  setProjectUnlimited,\r\n  getBalanceTransactions,\r\n  getProjectPricingOverride,\r\n  setProjectPricingOverride,\r\n  deleteProjectPricingOverride,\r\n  \r\n  // Exchange rate\r\n  getExchangeRateConfig,\r\n  setExchangeRateMode,\r\n  refreshExchangeRate,\r\n  \r\n  // Project functions\r\n  getProjectBillingSummary,\r\n  \r\n  // Utilities\r\n  formatEur,\r\n  formatTokens,\r\n  getTierDisplayInfo\r\n};\r\n\r\nexport default billingService;\r\n"],"names":["getAllProjectsBilling","http","error","getGlobalPricingConfig","setGlobalPricingConfig","config","getGlobalPricingTiers","response","setGlobalPricingTiers","tiers","getProjectBillingSummaryAdmin","projectId","getProjectBalance","creditProjectBalance","amount","description","setProjectUnlimited","unlimited","getBalanceTransactions","limit","getProjectPricingOverride","setProjectPricingOverride","deleteProjectPricingOverride","getProjectBillingSummary","formatEur","formatTokens","count","getTierDisplayInfo","tier","index","prevLimit","fromStr","toStr","getExchangeRateConfig","setExchangeRateMode","auto","manualRate","refreshExchangeRate","billingService"],"mappings":"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"}