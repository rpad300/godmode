{"version":3,"file":"RolesPage--fJeoR4I.js","sources":["../../frontend/src/pages/RolesPage.ts"],"sourcesContent":["/**\r\n * Roles Panel - SOTA Design\r\n * Manage role templates with AI-enhanced context\r\n * Note: User permissions are managed separately per member in MembersPanel\r\n */\r\n\r\nimport { on } from '@lib/dom';\r\nimport { http } from '@services/api';\r\nimport { toast } from '@services/toast';\r\n\r\ninterface Role {\r\n  id: string;\r\n  name: string;\r\n  display_name?: string;\r\n  description?: string;\r\n  role_context?: string;\r\n  color?: string;\r\n  category?: string;\r\n  is_template?: boolean;\r\n  is_system?: boolean;\r\n  created_at?: string;\r\n}\r\n\r\nconst ROLE_CATEGORIES = [\r\n  { id: 'project', name: 'Project', icon: 'üìã', examples: 'Project Manager, Scrum Master, Product Owner' },\r\n  { id: 'technical', name: 'Technical', icon: 'üíª', examples: 'Developer, Architect, DevOps, QA' },\r\n  { id: 'management', name: 'Management', icon: 'üëî', examples: 'Director, VP, C-Level' },\r\n  { id: 'stakeholder', name: 'Stakeholder', icon: 'ü§ù', examples: 'Client, Sponsor, External Partner' },\r\n  { id: 'custom', name: 'Custom', icon: '‚ú®', examples: 'Custom roles for your team' },\r\n];\r\n\r\nlet currentRoles: Role[] = [];\r\nlet editingRole: Role | null = null;\r\n\r\n/**\r\n * Render Roles Panel\r\n */\r\nexport async function renderRolesPanel(container: HTMLElement): Promise<void> {\r\n  container.innerHTML = `\r\n    <style>\r\n      .roles-panel-sota {\r\n        padding: 24px;\r\n        max-width: 1200px;\r\n        margin: 0 auto;\r\n      }\r\n      \r\n      .roles-header {\r\n        display: flex;\r\n        align-items: center;\r\n        justify-content: space-between;\r\n        margin-bottom: 24px;\r\n      }\r\n      \r\n      .roles-header h2 {\r\n        margin: 0;\r\n        font-size: 24px;\r\n        font-weight: 700;\r\n        color: var(--text-primary);\r\n        display: flex;\r\n        align-items: center;\r\n        gap: 12px;\r\n      }\r\n      \r\n      .roles-header h2 svg {\r\n        width: 28px;\r\n        height: 28px;\r\n        color: #e11d48;\r\n      }\r\n      \r\n      .roles-header-subtitle {\r\n        font-size: 14px;\r\n        color: var(--text-secondary);\r\n        margin-top: 4px;\r\n        font-weight: 400;\r\n      }\r\n      \r\n      .btn-create-role {\r\n        display: inline-flex;\r\n        align-items: center;\r\n        gap: 8px;\r\n        padding: 12px 24px;\r\n        background: linear-gradient(135deg, #e11d48 0%, #be123c 100%);\r\n        color: white;\r\n        border: none;\r\n        border-radius: 12px;\r\n        font-size: 14px;\r\n        font-weight: 600;\r\n        cursor: pointer;\r\n        transition: all 0.2s;\r\n        box-shadow: 0 4px 14px rgba(225, 29, 72, 0.3);\r\n      }\r\n      \r\n      .btn-create-role:hover {\r\n        transform: translateY(-2px);\r\n        box-shadow: 0 6px 20px rgba(225, 29, 72, 0.4);\r\n      }\r\n      \r\n      .roles-layout {\r\n        display: grid;\r\n        grid-template-columns: 320px 1fr;\r\n        gap: 24px;\r\n      }\r\n      \r\n      @media (max-width: 900px) {\r\n        .roles-layout {\r\n          grid-template-columns: 1fr;\r\n        }\r\n      }\r\n      \r\n      .roles-list {\r\n        display: flex;\r\n        flex-direction: column;\r\n        gap: 12px;\r\n      }\r\n      \r\n      .role-card {\r\n        background: var(--bg-primary);\r\n        border: 1px solid var(--border-color);\r\n        border-radius: 16px;\r\n        padding: 16px;\r\n        cursor: pointer;\r\n        transition: all 0.2s;\r\n        position: relative;\r\n      }\r\n      \r\n      .role-card:hover {\r\n        border-color: #e11d48;\r\n        transform: translateX(4px);\r\n      }\r\n      \r\n      .role-card.active {\r\n        border-color: #e11d48;\r\n        background: linear-gradient(135deg, rgba(225,29,72,0.08) 0%, rgba(225,29,72,0.03) 100%);\r\n      }\r\n      \r\n      .role-card-header {\r\n        display: flex;\r\n        align-items: center;\r\n        gap: 12px;\r\n        margin-bottom: 8px;\r\n      }\r\n      \r\n      .role-color-dot {\r\n        width: 12px;\r\n        height: 12px;\r\n        border-radius: 50%;\r\n        flex-shrink: 0;\r\n      }\r\n      \r\n      .role-card-name {\r\n        font-weight: 600;\r\n        color: var(--text-primary);\r\n        flex: 1;\r\n      }\r\n      \r\n      .role-card-badges {\r\n        display: flex;\r\n        gap: 4px;\r\n      }\r\n      \r\n      .role-badge {\r\n        font-size: 10px;\r\n        padding: 2px 6px;\r\n        border-radius: 4px;\r\n        font-weight: 500;\r\n      }\r\n      \r\n      .role-badge.template {\r\n        background: #dbeafe;\r\n        color: #1d4ed8;\r\n      }\r\n      \r\n      .role-badge.system {\r\n        background: #fef3c7;\r\n        color: #92400e;\r\n      }\r\n      \r\n      .role-card-category {\r\n        font-size: 11px;\r\n        color: var(--text-muted);\r\n        margin-bottom: 4px;\r\n      }\r\n      \r\n      .role-card-desc {\r\n        font-size: 13px;\r\n        color: var(--text-secondary);\r\n        line-height: 1.5;\r\n        display: -webkit-box;\r\n        -webkit-line-clamp: 2;\r\n        -webkit-box-orient: vertical;\r\n        overflow: hidden;\r\n      }\r\n      \r\n      /* Editor Panel */\r\n      .role-editor {\r\n        background: var(--bg-primary);\r\n        border: 1px solid var(--border-color);\r\n        border-radius: 20px;\r\n        overflow: hidden;\r\n      }\r\n      \r\n      .role-editor-header {\r\n        background: linear-gradient(135deg, #e11d48 0%, #be123c 100%);\r\n        padding: 24px;\r\n        color: white;\r\n      }\r\n      \r\n      .role-editor-header h3 {\r\n        margin: 0;\r\n        font-size: 20px;\r\n        font-weight: 700;\r\n      }\r\n      \r\n      .role-editor-body {\r\n        padding: 24px;\r\n      }\r\n      \r\n      .form-row {\r\n        display: flex;\r\n        gap: 16px;\r\n        margin-bottom: 20px;\r\n      }\r\n      \r\n      .form-group {\r\n        flex: 1;\r\n      }\r\n      \r\n      .form-group label {\r\n        display: block;\r\n        font-size: 13px;\r\n        font-weight: 600;\r\n        color: var(--text-secondary);\r\n        margin-bottom: 8px;\r\n      }\r\n      \r\n      .form-group input,\r\n      .form-group textarea,\r\n      .form-group select {\r\n        width: 100%;\r\n        padding: 12px 16px;\r\n        border: 1px solid var(--border-color);\r\n        border-radius: 12px;\r\n        font-size: 14px;\r\n        background: var(--bg-secondary);\r\n        color: var(--text-primary);\r\n        transition: all 0.2s;\r\n        box-sizing: border-box;\r\n      }\r\n      \r\n      .form-group input:focus,\r\n      .form-group textarea:focus,\r\n      .form-group select:focus {\r\n        outline: none;\r\n        border-color: #e11d48;\r\n        box-shadow: 0 0 0 3px rgba(225, 29, 72, 0.1);\r\n      }\r\n      \r\n      .form-group textarea {\r\n        resize: vertical;\r\n        min-height: 80px;\r\n      }\r\n      \r\n      .form-hint {\r\n        font-size: 12px;\r\n        color: var(--text-muted);\r\n        margin-top: 6px;\r\n      }\r\n      \r\n      .ai-enhance-section {\r\n        display: flex;\r\n        gap: 12px;\r\n        align-items: flex-start;\r\n        margin-top: 12px;\r\n      }\r\n      \r\n      .ai-enhance-btn {\r\n        display: inline-flex;\r\n        align-items: center;\r\n        gap: 6px;\r\n        padding: 10px 16px;\r\n        background: linear-gradient(135deg, #8b5cf6 0%, #7c3aed 100%);\r\n        color: white;\r\n        border: none;\r\n        border-radius: 10px;\r\n        font-size: 13px;\r\n        font-weight: 600;\r\n        cursor: pointer;\r\n        transition: all 0.2s;\r\n        white-space: nowrap;\r\n      }\r\n      \r\n      .ai-enhance-btn:hover {\r\n        transform: translateY(-1px);\r\n        box-shadow: 0 4px 12px rgba(139, 92, 246, 0.3);\r\n      }\r\n      \r\n      .ai-enhance-btn:disabled {\r\n        opacity: 0.6;\r\n        cursor: not-allowed;\r\n        transform: none;\r\n      }\r\n      \r\n      .ai-enhance-btn svg {\r\n        width: 14px;\r\n        height: 14px;\r\n      }\r\n      \r\n      @keyframes spin {\r\n        from { transform: rotate(0deg); }\r\n        to { transform: rotate(360deg); }\r\n      }\r\n      \r\n      .spin {\r\n        animation: spin 1s linear infinite;\r\n      }\r\n      \r\n      /* Actions */\r\n      .role-editor-actions {\r\n        display: flex;\r\n        gap: 12px;\r\n        justify-content: flex-end;\r\n        margin-top: 24px;\r\n        padding-top: 24px;\r\n        border-top: 1px solid var(--border-color);\r\n      }\r\n      \r\n      .btn {\r\n        padding: 12px 24px;\r\n        border-radius: 10px;\r\n        font-size: 14px;\r\n        font-weight: 600;\r\n        cursor: pointer;\r\n        transition: all 0.2s;\r\n        border: none;\r\n      }\r\n      \r\n      .btn-secondary {\r\n        background: var(--bg-secondary);\r\n        color: var(--text-primary);\r\n        border: 1px solid var(--border-color);\r\n      }\r\n      \r\n      .btn-secondary:hover {\r\n        background: var(--bg-tertiary);\r\n      }\r\n      \r\n      .btn-primary {\r\n        background: linear-gradient(135deg, #e11d48 0%, #be123c 100%);\r\n        color: white;\r\n        box-shadow: 0 4px 14px rgba(225, 29, 72, 0.3);\r\n      }\r\n      \r\n      .btn-primary:hover {\r\n        transform: translateY(-1px);\r\n        box-shadow: 0 6px 20px rgba(225, 29, 72, 0.4);\r\n      }\r\n      \r\n      .btn-danger {\r\n        background: #fee2e2;\r\n        color: #dc2626;\r\n      }\r\n      \r\n      .btn-danger:hover {\r\n        background: #fecaca;\r\n      }\r\n      \r\n      .template-toggle {\r\n        display: flex;\r\n        align-items: center;\r\n        gap: 8px;\r\n        margin-top: 20px;\r\n        padding: 14px 16px;\r\n        background: linear-gradient(135deg, #f0fdf4 0%, #dcfce7 100%);\r\n        border: 1px solid #86efac;\r\n        border-radius: 12px;\r\n      }\r\n      \r\n      .template-toggle label {\r\n        margin: 0;\r\n        font-size: 13px;\r\n        color: #166534;\r\n        font-weight: 500;\r\n      }\r\n      \r\n      .template-toggle input {\r\n        accent-color: #16a34a;\r\n        width: 18px;\r\n        height: 18px;\r\n      }\r\n      \r\n      .empty-state {\r\n        text-align: center;\r\n        padding: 48px;\r\n        color: var(--text-muted);\r\n      }\r\n      \r\n      .empty-state svg {\r\n        width: 64px;\r\n        height: 64px;\r\n        opacity: 0.3;\r\n        margin-bottom: 16px;\r\n      }\r\n      \r\n      .info-card {\r\n        background: linear-gradient(135deg, #eff6ff 0%, #dbeafe 100%);\r\n        border: 1px solid #93c5fd;\r\n        border-radius: 12px;\r\n        padding: 16px;\r\n        margin-bottom: 20px;\r\n      }\r\n      \r\n      .info-card h4 {\r\n        margin: 0 0 8px;\r\n        font-size: 14px;\r\n        color: #1e40af;\r\n        display: flex;\r\n        align-items: center;\r\n        gap: 6px;\r\n      }\r\n      \r\n      .info-card p {\r\n        margin: 0;\r\n        font-size: 13px;\r\n        color: #3b82f6;\r\n        line-height: 1.5;\r\n      }\r\n    </style>\r\n    \r\n    <div class=\"roles-panel-sota\">\r\n      <div class=\"roles-header\">\r\n        <div>\r\n          <h2>\r\n            <svg fill=\"none\" viewBox=\"0 0 24 24\" stroke=\"currentColor\">\r\n              <path stroke-linecap=\"round\" stroke-linejoin=\"round\" stroke-width=\"2\" d=\"M12 4.354a4 4 0 110 5.292M15 21H3v-1a6 6 0 0112 0v1zm0 0h6v-1a6 6 0 00-9-5.197m13.5-9a2.5 2.5 0 11-5 0 2.5 2.5 0 015 0z\"/>\r\n            </svg>\r\n            Role Templates\r\n          </h2>\r\n          <div class=\"roles-header-subtitle\">Define roles to assign to team members and contacts. The AI uses role context to adapt responses.</div>\r\n        </div>\r\n        <button class=\"btn-create-role\" id=\"btn-create-role\">\r\n          <svg width=\"16\" height=\"16\" fill=\"none\" viewBox=\"0 0 24 24\" stroke=\"currentColor\">\r\n            <path stroke-linecap=\"round\" stroke-linejoin=\"round\" stroke-width=\"2\" d=\"M12 4v16m8-8H4\"/>\r\n          </svg>\r\n          Create Role\r\n        </button>\r\n      </div>\r\n      \r\n      <div class=\"roles-layout\">\r\n        <div class=\"roles-list\" id=\"roles-list\">\r\n          <div class=\"empty-state\">Loading roles...</div>\r\n        </div>\r\n        \r\n        <div class=\"role-editor hidden\" id=\"role-editor\">\r\n          <!-- Editor content will be rendered here -->\r\n        </div>\r\n      </div>\r\n    </div>\r\n  `;\r\n\r\n  // Load roles\r\n  await loadRoles(container);\r\n\r\n  // Bind create button\r\n  const createBtn = container.querySelector('#btn-create-role');\r\n  if (createBtn) {\r\n    on(createBtn as HTMLElement, 'click', () => {\r\n      editingRole = null;\r\n      showRoleEditor(container, null);\r\n    });\r\n  }\r\n}\r\n\r\n/**\r\n * Load roles from API\r\n */\r\nasync function loadRoles(container: HTMLElement): Promise<void> {\r\n  const listEl = container.querySelector('#roles-list') as HTMLElement;\r\n  if (!listEl) return;\r\n\r\n  try {\r\n    // Load role templates\r\n    const response = await http.get<{ roles: Role[] }>('/api/role-templates');\r\n    currentRoles = response.data.roles || [];\r\n\r\n    if (currentRoles.length === 0) {\r\n      listEl.innerHTML = `\r\n        <div class=\"empty-state\">\r\n          <svg fill=\"none\" viewBox=\"0 0 24 24\" stroke=\"currentColor\">\r\n            <path stroke-linecap=\"round\" stroke-linejoin=\"round\" stroke-width=\"2\" d=\"M12 4.354a4 4 0 110 5.292M15 21H3v-1a6 6 0 0112 0v1zm0 0h6v-1a6 6 0 00-9-5.197\"/>\r\n          </svg>\r\n          <p>No roles defined yet</p>\r\n          <p class=\"empty-state-hint\">Click \"Create Role\" to get started</p>\r\n        </div>\r\n      `;\r\n      return;\r\n    }\r\n\r\n    renderRolesList(listEl, container);\r\n  } catch (error) {\r\n    console.error('[RolesPanel] Failed to load roles:', error);\r\n    listEl.innerHTML = `<div class=\"empty-state\">Failed to load roles</div>`;\r\n  }\r\n}\r\n\r\n/**\r\n * Render roles list\r\n */\r\nfunction renderRolesList(listEl: HTMLElement, container: HTMLElement): void {\r\n  const categoryMap = Object.fromEntries(ROLE_CATEGORIES.map(c => [c.id, c]));\r\n\r\n  listEl.innerHTML = currentRoles.map(role => {\r\n    const cat = categoryMap[role.category || 'custom'];\r\n    return `\r\n      <div class=\"role-card${editingRole?.id === role.id ? ' active' : ''}\" data-id=\"${role.id}\">\r\n        <div class=\"role-card-header\">\r\n          <div class=\"role-color-dot\" style=\"--role-color: ${role.color || '#e11d48'}\"></div>\r\n          <div class=\"role-card-name\">${escapeHtml(role.display_name || role.name)}</div>\r\n          <div class=\"role-card-badges\">\r\n            ${role.is_template ? '<span class=\"role-badge template\">Template</span>' : ''}\r\n            ${role.is_system ? '<span class=\"role-badge system\">System</span>' : ''}\r\n          </div>\r\n        </div>\r\n        <div class=\"role-card-category\">${cat?.icon || '‚ú®'} ${cat?.name || 'Custom'}</div>\r\n        ${role.description ? `<div class=\"role-card-desc\">${escapeHtml(role.description)}</div>` : ''}\r\n      </div>\r\n    `;\r\n  }).join('');\r\n\r\n  // Bind click events\r\n  listEl.querySelectorAll('.role-card').forEach(card => {\r\n    on(card as HTMLElement, 'click', () => {\r\n      const roleId = card.getAttribute('data-id');\r\n      const role = currentRoles.find(r => r.id === roleId);\r\n      if (role) {\r\n        editingRole = role;\r\n        listEl.querySelectorAll('.role-card').forEach(c => c.classList.remove('active'));\r\n        card.classList.add('active');\r\n        showRoleEditor(container, role);\r\n      }\r\n    });\r\n  });\r\n}\r\n\r\n/**\r\n * Show role editor\r\n */\r\nfunction showRoleEditor(container: HTMLElement, role: Role | null): void {\r\n  const editorEl = container.querySelector('#role-editor') as HTMLElement;\r\n  if (!editorEl) return;\r\n\r\n  editorEl.classList.remove('hidden');\r\n\r\n  const isNew = !role;\r\n\r\n  editorEl.innerHTML = `\r\n    <div class=\"role-editor-header\">\r\n      <h3>${isNew ? 'Create New Role' : 'Edit Role'}</h3>\r\n    </div>\r\n    \r\n    <div class=\"role-editor-body\">\r\n      <div class=\"info-card\">\r\n        <h4>üí° How Role Templates Work</h4>\r\n        <p>Role templates define job titles and context that helps the AI understand each person's perspective. When you assign a role to a team member or contact, the AI adapts its responses to be more relevant to their responsibilities.</p>\r\n      </div>\r\n      \r\n      <form id=\"role-form\">\r\n        <div class=\"form-row\">\r\n          <div class=\"form-group role-form-flex-2\">\r\n            <label>Role Name *</label>\r\n            <input type=\"text\" id=\"role-name\" required value=\"${escapeHtml(role?.display_name || role?.name || '')}\" placeholder=\"e.g., Project Manager, Senior Developer\">\r\n          </div>\r\n          <div class=\"form-group role-form-flex-1\">\r\n            <label>Category</label>\r\n            <select id=\"role-category\">\r\n              ${ROLE_CATEGORIES.map(cat => `\r\n                <option value=\"${cat.id}\" ${role?.category === cat.id ? 'selected' : ''}>${cat.icon} ${cat.name}</option>\r\n              `).join('')}\r\n            </select>\r\n          </div>\r\n          <div class=\"form-group role-form-w-80\">\r\n            <label>Color</label>\r\n            <input type=\"color\" id=\"role-color\" class=\"role-color-input\" value=\"${role?.color || '#e11d48'}\">\r\n          </div>\r\n        </div>\r\n        \r\n        <div class=\"form-group\">\r\n          <label>Description</label>\r\n          <textarea id=\"role-description\" rows=\"2\" placeholder=\"Brief description of this role's main responsibilities...\">${escapeHtml(role?.description || '')}</textarea>\r\n          <div class=\"form-hint\">A short summary shown in role lists and dropdowns.</div>\r\n        </div>\r\n        \r\n        <div class=\"form-group\">\r\n          <label>Role Context (for AI)</label>\r\n          <textarea id=\"role-context\" rows=\"6\" placeholder=\"Describe this role in detail for the AI:&#10;&#10;‚Ä¢ What are their main responsibilities?&#10;‚Ä¢ What decisions do they typically make?&#10;‚Ä¢ What information is most relevant to them?&#10;‚Ä¢ How should the AI adapt its tone and detail level?\">${escapeHtml(role?.role_context || '')}</textarea>\r\n          <div class=\"form-hint\">This context helps the AI provide more relevant and targeted responses when interacting with people in this role.</div>\r\n          <div class=\"ai-enhance-section\">\r\n            <button type=\"button\" class=\"ai-enhance-btn\" id=\"btn-ai-enhance\">\r\n              <svg fill=\"none\" viewBox=\"0 0 24 24\" stroke=\"currentColor\">\r\n                <path stroke-linecap=\"round\" stroke-linejoin=\"round\" stroke-width=\"2\" d=\"M13 10V3L4 14h7v7l9-11h-7z\"/>\r\n              </svg>\r\n              Enhance with AI\r\n            </button>\r\n            <span class=\"form-hint role-form-hint-ai\">Let AI generate or improve the role context based on the role name.</span>\r\n          </div>\r\n        </div>\r\n        \r\n        <div class=\"template-toggle\">\r\n          <input type=\"checkbox\" id=\"is-template\" ${role?.is_template !== false ? 'checked' : ''}>\r\n          <label for=\"is-template\">Save as template (reusable across all projects)</label>\r\n        </div>\r\n        \r\n        <div class=\"role-editor-actions\">\r\n          ${!isNew && !role?.is_system ? `\r\n            <button type=\"button\" class=\"btn btn-danger\" id=\"btn-delete-role\">Delete</button>\r\n          ` : ''}\r\n          <button type=\"button\" class=\"btn btn-secondary\" id=\"btn-cancel\">Cancel</button>\r\n          <button type=\"submit\" class=\"btn btn-primary\">${isNew ? 'Create Role' : 'Save Changes'}</button>\r\n        </div>\r\n      </form>\r\n    </div>\r\n  `;\r\n\r\n  bindEditorEvents(container, role);\r\n}\r\n\r\n/**\r\n * Bind editor events\r\n */\r\nfunction bindEditorEvents(container: HTMLElement, role: Role | null): void {\r\n  const editorEl = container.querySelector('#role-editor') as HTMLElement;\r\n  if (!editorEl) return;\r\n\r\n  // Cancel button\r\n  const cancelBtn = editorEl.querySelector('#btn-cancel');\r\n  if (cancelBtn) {\r\n    on(cancelBtn as HTMLElement, 'click', () => {\r\n      editorEl.classList.add('hidden');\r\n      editingRole = null;\r\n      const listEl = container.querySelector('#roles-list') as HTMLElement;\r\n      if (listEl) {\r\n        listEl.querySelectorAll('.role-card').forEach(c => c.classList.remove('active'));\r\n      }\r\n    });\r\n  }\r\n\r\n  // Delete button\r\n  const deleteBtn = editorEl.querySelector('#btn-delete-role');\r\n  if (deleteBtn && role) {\r\n    on(deleteBtn as HTMLElement, 'click', async () => {\r\n      if (!confirm(`Are you sure you want to delete \"${role.display_name || role.name}\"?`)) return;\r\n\r\n      try {\r\n        await http.delete(`/api/role-templates/${role.id}`);\r\n        toast.success('Role deleted');\r\n        editorEl.classList.add('hidden');\r\n        editingRole = null;\r\n        await loadRoles(container);\r\n      } catch {\r\n        toast.error('Failed to delete role');\r\n      }\r\n    });\r\n  }\r\n\r\n  // AI Enhance button\r\n  const aiBtn = editorEl.querySelector('#btn-ai-enhance');\r\n  if (aiBtn) {\r\n    on(aiBtn as HTMLElement, 'click', async () => {\r\n      const nameInput = editorEl.querySelector('#role-name') as HTMLInputElement;\r\n      const contextInput = editorEl.querySelector('#role-context') as HTMLTextAreaElement;\r\n      const descInput = editorEl.querySelector('#role-description') as HTMLTextAreaElement;\r\n\r\n      const roleName = nameInput.value.trim();\r\n      if (!roleName) {\r\n        toast.error('Please enter a role name first');\r\n        return;\r\n      }\r\n\r\n      (aiBtn as HTMLButtonElement).disabled = true;\r\n      aiBtn.innerHTML = `<svg class=\"spin\" fill=\"none\" viewBox=\"0 0 24 24\" stroke=\"currentColor\"><path stroke-linecap=\"round\" stroke-linejoin=\"round\" stroke-width=\"2\" d=\"M4 4v5h.582m15.356 2A8.001 8.001 0 004.582 9m0 0H9m11 11v-5h-.581m0 0a8.003 8.003 0 01-15.357-2m15.357 2H15\"/></svg> Enhancing...`;\r\n\r\n      try {\r\n        const response = await http.post<{ prompt: string; description?: string }>('/api/roles/generate', {\r\n          title: roleName,\r\n          currentContext: contextInput.value,\r\n        });\r\n\r\n        if (response.data.prompt) {\r\n          contextInput.value = response.data.prompt;\r\n        }\r\n        if (response.data.description && !descInput.value) {\r\n          descInput.value = response.data.description;\r\n        }\r\n        toast.success('Role context enhanced with AI');\r\n      } catch {\r\n        toast.error('Failed to enhance with AI');\r\n      } finally {\r\n        (aiBtn as HTMLButtonElement).disabled = false;\r\n        aiBtn.innerHTML = `<svg fill=\"none\" viewBox=\"0 0 24 24\" stroke=\"currentColor\"><path stroke-linecap=\"round\" stroke-linejoin=\"round\" stroke-width=\"2\" d=\"M13 10V3L4 14h7v7l9-11h-7z\"/></svg> Enhance with AI`;\r\n      }\r\n    });\r\n  }\r\n\r\n  // Form submit\r\n  const form = editorEl.querySelector('#role-form') as HTMLFormElement;\r\n  if (form) {\r\n    on(form, 'submit', async (e) => {\r\n      e.preventDefault();\r\n\r\n      const name = (editorEl.querySelector('#role-name') as HTMLInputElement).value.trim();\r\n      const category = (editorEl.querySelector('#role-category') as HTMLSelectElement).value;\r\n      const color = (editorEl.querySelector('#role-color') as HTMLInputElement).value;\r\n      const description = (editorEl.querySelector('#role-description') as HTMLTextAreaElement).value.trim();\r\n      const roleContext = (editorEl.querySelector('#role-context') as HTMLTextAreaElement).value.trim();\r\n      const isTemplate = (editorEl.querySelector('#is-template') as HTMLInputElement).checked;\r\n\r\n      const roleData = {\r\n        name: name.toLowerCase().replace(/\\s+/g, '_'),\r\n        display_name: name,\r\n        description,\r\n        role_context: roleContext,\r\n        category,\r\n        color,\r\n        is_template: isTemplate,\r\n      };\r\n\r\n      try {\r\n        if (role) {\r\n          await http.put(`/api/role-templates/${role.id}`, roleData);\r\n          toast.success('Role updated');\r\n        } else {\r\n          await http.post('/api/role-templates', roleData);\r\n          toast.success('Role created');\r\n        }\r\n\r\n        editorEl.classList.add('hidden');\r\n        editingRole = null;\r\n        await loadRoles(container);\r\n      } catch {\r\n        toast.error('Failed to save role');\r\n      }\r\n    });\r\n  }\r\n}\r\n\r\n/**\r\n * Escape HTML\r\n */\r\nfunction escapeHtml(text: string): string {\r\n  const div = document.createElement('div');\r\n  div.textContent = text;\r\n  return div.innerHTML;\r\n}\r\n\r\nexport default renderRolesPanel;\r\n"],"names":["ROLE_CATEGORIES","currentRoles","editingRole","renderRolesPanel","container","loadRoles","createBtn","on","showRoleEditor","listEl","http","renderRolesList","error","categoryMap","c","role","cat","escapeHtml","card","roleId","r","editorEl","isNew","bindEditorEvents","cancelBtn","deleteBtn","toast","aiBtn","nameInput","contextInput","descInput","roleName","response","form","e","name","category","color","description","roleContext","isTemplate","roleData","text","div"],"mappings":"kGAuBA,MAAMA,EAAkB,CACtB,CAAE,GAAI,UAAW,KAAM,UAAW,KAAM,KAAM,SAAU,8CAAA,EACxD,CAAE,GAAI,YAAa,KAAM,YAAa,KAAM,KAAM,SAAU,kCAAA,EAC5D,CAAE,GAAI,aAAc,KAAM,aAAc,KAAM,KAAM,SAAU,uBAAA,EAC9D,CAAE,GAAI,cAAe,KAAM,cAAe,KAAM,KAAM,SAAU,mCAAA,EAChE,CAAE,GAAI,SAAU,KAAM,SAAU,KAAM,IAAK,SAAU,4BAAA,CACvD,EAEA,IAAIC,EAAuB,CAAA,EACvBC,EAA2B,KAK/B,eAAsBC,EAAiBC,EAAuC,CAC5EA,EAAU,UAAY;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AA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"}