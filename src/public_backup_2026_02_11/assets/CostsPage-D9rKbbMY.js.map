{"version":3,"file":"CostsPage-D9rKbbMY.js","sources":["../../frontend/src/pages/CostsPage.ts"],"sourcesContent":["/**\n * Costs Dashboard Component\n * LLM costs tracking and visualization\n */\n\nimport { createElement, on } from '@lib/dom';\nimport { createModal, openModal, closeModal } from '@components/Modal';\nimport { costsService, CostSummary, RecentCostRequest } from '@services/graph';\nimport { formatCurrency, formatNumber } from '@lib/format';\nimport { toast } from '@services/toast';\nimport { billingService, type ProjectBillingSummary, formatEur, formatTokens } from '@services/billing';\nimport { appStore } from '@stores/app';\nimport { fetchWithProject } from '@services/api';\n\n// Billing state\nlet billingSummary: ProjectBillingSummary | null = null;\n\nconst BUDGET_MODAL_ID = 'costs-budget-modal';\n\nexport interface CostsDashboardProps {\n  period?: 'day' | 'week' | 'month' | 'all';\n}\n\n/**\n * Create costs dashboard component\n */\nexport function createCostsDashboard(props: CostsDashboardProps = {}): HTMLElement {\n  const { period = 'month' } = props;\n\n  const container = createElement('div', { className: 'costs-dashboard' });\n\n  container.innerHTML = `\n    <div class=\"costs-header\">\n      <div class=\"costs-header-title\">\n        <h3>LLM Costs</h3>\n        <span class=\"costs-period-range\" id=\"costs-period-range\" aria-live=\"polite\"></span>\n      </div>\n      <div class=\"costs-header-actions\">\n        <select id=\"costs-period\" class=\"filter-select\" aria-label=\"Time period\">\n          <option value=\"day\" ${period === 'day' ? 'selected' : ''}>Today</option>\n          <option value=\"week\" ${period === 'week' ? 'selected' : ''}>This Week</option>\n          <option value=\"month\" ${period === 'month' ? 'selected' : ''}>This Month</option>\n          <option value=\"all\" ${period === 'all' ? 'selected' : ''}>All Time</option>\n        </select>\n        <button type=\"button\" class=\"btn btn-secondary btn-sm\" id=\"costs-export-btn\" title=\"Export CSV or JSON\">Export</button>\n        <button type=\"button\" class=\"btn btn-secondary btn-sm\" id=\"costs-pricing-btn\" title=\"View pricing table\">Pricing</button>\n        <button type=\"button\" class=\"btn btn-secondary btn-sm\" id=\"costs-budget-btn\" title=\"Set budget and alert\">Budget</button>\n      </div>\n    </div>\n    <div class=\"costs-content\" id=\"costs-content\">\n      <div class=\"loading\">Loading costs...</div>\n    </div>\n    <div id=\"costs-pricing-panel\" class=\"costs-pricing-panel hidden\" aria-hidden=\"true\"></div>\n  `;\n\n  // Bind events\n  const periodSelect = container.querySelector('#costs-period') as HTMLSelectElement;\n  on(periodSelect, 'change', () => {\n    loadCosts(container, periodSelect.value as 'day' | 'week' | 'month' | 'all');\n  });\n  const exportBtn = container.querySelector('#costs-export-btn');\n  if (exportBtn) {\n    on(exportBtn as HTMLElement, 'click', () => handleExport(periodSelect.value as 'day' | 'week' | 'month' | 'all'));\n  }\n  const pricingBtn = container.querySelector('#costs-pricing-btn');\n  const pricingPanel = container.querySelector('#costs-pricing-panel') as HTMLElement;\n  if (pricingBtn && pricingPanel) {\n    on(pricingBtn as HTMLElement, 'click', () => togglePricingPanel(pricingPanel));\n  }\n  on(container, 'click', (e: Event) => {\n    if ((e.target as HTMLElement).id === 'costs-pricing-close') {\n      pricingPanel?.classList.add('hidden');\n      pricingPanel?.setAttribute('aria-hidden', 'true');\n    }\n  });\n  const budgetBtn = container.querySelector('#costs-budget-btn');\n  if (budgetBtn) {\n    on(budgetBtn as HTMLElement, 'click', () => showBudgetModal(container, periodSelect));\n  }\n\n  // Initial load\n  loadCosts(container, period);\n\n  return container;\n}\n\n/**\n * Load costs data\n */\nasync function loadCosts(container: HTMLElement, period: 'day' | 'week' | 'month' | 'all'): Promise<void> {\n  const content = container.querySelector('#costs-content') as HTMLElement;\n  content.innerHTML = '<div class=\"loading\">Loading...</div>';\n\n  try {\n    // Get current project ID\n    const state = appStore.getState();\n    const projectId = state.currentProject?.id;\n\n    const [data, recentRequests, billing] = await Promise.all([\n      costsService.getSummary(period),\n      costsService.getRecentRequests(20),\n      projectId ? billingService.getProjectBillingSummary(projectId) : Promise.resolve(null)\n    ]);\n\n    billingSummary = billing;\n    renderCosts(content, data, recentRequests);\n    const periodRangeEl = container.querySelector('#costs-period-range');\n    if (periodRangeEl) periodRangeEl.textContent = formatPeriod(data.period ?? { start: '', end: '' });\n  } catch {\n    content.innerHTML = '<div class=\"error\">Failed to load costs</div>';\n  }\n}\n\n/**\n * Render costs\n */\nfunction renderCosts(\n  container: HTMLElement,\n  data: CostSummary,\n  recentRequests: RecentCostRequest[] = []\n): void {\n  const dailyBreakdown = data.dailyBreakdown ?? [];\n  const byProvider = data.byProvider ?? {};\n  const byModel = data.byModel ?? {};\n  const totalCalls = dailyBreakdown.reduce((sum, d) => sum + (d.calls ?? 0), 0);\n  const avgPerCall = totalCalls > 0 ? data.total / totalCalls : 0;\n\n  // Convert records to arrays for rendering (normalize empty operation keys to \"other\")\n  const byProviderArray = Object.entries(byProvider)\n    .map(([provider, cost]) => ({ provider, cost }))\n    .sort((a, b) => b.cost - a.cost);\n  const byModelArray = Object.entries(byModel)\n    .map(([model, cost]) => ({ model, cost }))\n    .sort((a, b) => b.cost - a.cost);\n  const byOperationMap = new Map<string, number>();\n  for (const [op, cost] of Object.entries(data.byOperation || {})) {\n    const key = (op && String(op).trim()) ? String(op).trim() : 'other';\n    byOperationMap.set(key, (byOperationMap.get(key) ?? 0) + cost);\n  }\n  const byOperationArray = Array.from(byOperationMap.entries())\n    .map(([operation, cost]) => ({ operation, cost }))\n    .sort((a, b) => b.cost - a.cost);\n  // By context: sort by cost desc, show \"unknown\" as \"Other\"\n  const byContextArray = Object.entries(data.byContext || {})\n    .map(([ctx, cost]) => ({ context: (ctx === 'unknown' || !ctx?.trim()) ? 'Other' : ctx, cost }))\n    .sort((a, b) => b.cost - a.cost);\n  const totalInput = data.totalInputTokens ?? 0;\n  const totalOutput = data.totalOutputTokens ?? 0;\n  const hasNoData =\n    (data.total ?? 0) === 0 &&\n    dailyBreakdown.length === 0 &&\n    Object.keys(byProvider).length === 0 &&\n    Object.keys(byModel).length === 0;\n  const periodChangeHtml =\n    data.previousPeriodCost != null && data.percentChange != null\n      ? `<div class=\"card-sub period-change ${data.percentChange >= 0 ? 'up' : 'down'}\">vs previous period: ${data.percentChange >= 0 ? '+' : ''}${data.percentChange.toFixed(1)}%</div>`\n      : '';\n\n  const budgetHtml =\n    data.budgetLimit != null && data.budgetUsedPercent != null\n      ? `\n    <div class=\"costs-budget-bar ${data.budgetAlertTriggered ? 'alert' : ''}\">\n      <div class=\"costs-budget-bar-fill\" style=\"--budget-width: ${Math.min(100, data.budgetUsedPercent)}%\"></div>\n      <span class=\"costs-budget-label\">${formatCurrency(data.total)} / ${formatCurrency(data.budgetLimit)} (${data.budgetUsedPercent}%)</span>\n      ${data.budgetAlertTriggered ? '<span class=\"costs-budget-alert\">Alert threshold reached</span>' : ''}\n    </div>`\n      : !hasNoData\n        ? '<div class=\"costs-budget-bar costs-budget-bar-empty\"><span class=\"costs-budget-label\">No budget set</span><span class=\"costs-budget-set-hint\">Use the Budget button above to set a limit.</span></div>'\n        : '';\n\n  const emptyStateHtml =\n    hasNoData\n      ? '<div class=\"costs-empty-state\">No cost data for this period. LLM usage from Chat, document processing, and other features will appear here.</div>'\n      : '';\n\n  // Build billing banner HTML\n  let billingBannerHtml = '';\n  if (billingSummary) {\n    const balanceDisplay = billingSummary.unlimited_balance\n      ? '<span class=\"costs-unlimited\">∞ Unlimited</span>'\n      : formatEur(billingSummary.balance_eur);\n\n    const statusBadge = billingSummary.unlimited_balance\n      ? '<span class=\"badge badge-success costs-badge-sm\">Unlimited</span>'\n      : billingSummary.balance_eur <= 0\n        ? '<span class=\"badge badge-danger costs-badge-sm\">Blocked</span>'\n        : billingSummary.balance_percent_used >= 80\n          ? '<span class=\"badge badge-warning costs-badge-sm\">Low Balance</span>'\n          : '<span class=\"badge badge-primary costs-badge-sm\">Active</span>';\n\n    billingBannerHtml = `\n      <div class=\"billing-summary-banner\">\n        <div class=\"billing-summary-row\">\n          <div>\n            <div class=\"billing-summary-label\">Project Balance</div>\n            <div class=\"billing-summary-value\">${balanceDisplay}</div>\n          </div>\n          <div>\n            <div class=\"billing-summary-label\">Status</div>\n            <div>${statusBadge}</div>\n          </div>\n          ${billingSummary.current_tier_name ? `\n          <div>\n            <div class=\"billing-summary-label\">Current Tier</div>\n            <div class=\"billing-summary-tier\">${billingSummary.current_tier_name} (+${billingSummary.current_markup_percent}%)</div>\n          </div>\n          ` : ''}\n        </div>\n        <div class=\"billing-summary-meta\">\n          <div>\n            <strong>${formatTokens(billingSummary.tokens_this_period)}</strong> tokens this period\n          </div>\n          <div>\n            <strong>${formatEur(billingSummary.billable_cost_this_period)}</strong> billed (${billingSummary.period_key})\n          </div>\n        </div>\n      </div>\n    `;\n  }\n\n  container.innerHTML = `\n    ${billingBannerHtml}\n    <div class=\"costs-dashboard-row\">\n      <div class=\"costs-stats-grid stats-grid\">\n        <div class=\"costs-stat-card stat-card\" data-stat-id=\"cost-total\">\n          <div class=\"stat-value\">${formatCurrency(data.total)}</div>\n          <div class=\"stat-label\">Total Cost</div>\n          ${periodChangeHtml}\n        </div>\n        <div class=\"costs-stat-card stat-card\" data-stat-id=\"cost-calls\">\n          <div class=\"stat-value\">${formatNumber(totalCalls)}</div>\n          <div class=\"stat-label\">API Calls</div>\n        </div>\n        <div class=\"costs-stat-card stat-card\" data-stat-id=\"cost-avg\">\n          <div class=\"stat-value\">${formatCurrency(avgPerCall)}</div>\n          <div class=\"stat-label\">Avg per Call</div>\n        </div>\n        <div class=\"costs-stat-card stat-card\" data-stat-id=\"cost-input\">\n          <div class=\"stat-value\">${formatNumber(totalInput)}</div>\n          <div class=\"stat-label\">Input Tokens</div>\n        </div>\n        <div class=\"costs-stat-card stat-card\" data-stat-id=\"cost-output\">\n          <div class=\"stat-value\">${formatNumber(totalOutput)}</div>\n          <div class=\"stat-label\">Output Tokens</div>\n        </div>\n      </div>\n    </div>\n    ${budgetHtml}\n    ${emptyStateHtml}\n\n    <div class=\"costs-chart-section chart-container\">\n      <h4 class=\"costs-chart-title\">Daily Costs</h4>\n      <div class=\"costs-chart-inner\">\n        ${renderDailyChart(dailyBreakdown, data.period ?? { start: '', end: '' })}\n      </div>\n    </div>\n\n    <div class=\"costs-breakdown\">\n      <div class=\"breakdown-section\">\n        <h4>By Provider</h4>\n        <div class=\"breakdown-list\">\n          ${byProviderArray.length > 0 ? byProviderArray.map(p => `\n            <div class=\"breakdown-item\">\n              <span class=\"item-name\">${escapeHtml(p.provider)}</span>\n              <span class=\"item-value\">${formatCurrency(p.cost)}</span>\n            </div>\n          `).join('') : '<div class=\"empty\">No data</div>'}\n        </div>\n      </div>\n\n      <div class=\"breakdown-section\">\n        <h4>By Model</h4>\n        <div class=\"breakdown-list\">\n          ${byModelArray.length > 0 ? byModelArray.map(m => `\n            <div class=\"breakdown-item\">\n              <span class=\"item-name\">${escapeHtml(m.model)}</span>\n              <span class=\"item-value\">${formatCurrency(m.cost)}</span>\n            </div>\n          `).join('') : '<div class=\"empty\">No data</div>'}\n        </div>\n      </div>\n\n      <div class=\"breakdown-section\">\n        <h4>By Operation</h4>\n        <div class=\"breakdown-list\">\n          ${byOperationArray.length > 0 ? byOperationArray.map(o => `\n            <div class=\"breakdown-item\">\n              <span class=\"item-name\">${escapeHtml(o.operation)}</span>\n              <span class=\"item-value\">${formatCurrency(o.cost)}</span>\n            </div>\n          `).join('') : '<div class=\"empty\">No data</div>'}\n        </div>\n      </div>\n\n      ${byContextArray.length > 0 ? `\n      <div class=\"breakdown-section\">\n        <h4>By Context</h4>\n        <div class=\"breakdown-list\">\n          ${byContextArray.map(c => `\n            <div class=\"breakdown-item\">\n              <span class=\"item-name\">${escapeHtml(c.context)}</span>\n              <span class=\"item-value\">${formatCurrency(c.cost)}</span>\n            </div>\n          `).join('')}\n        </div>\n      </div>\n      ` : ''}\n    </div>\n\n    <div class=\"costs-recent-section\">\n      <h4>Recent Requests <span class=\"costs-recent-caption\">(last 20, all time)</span></h4>\n      ${renderRecentRequests(recentRequests)}\n    </div>\n  `;\n}\n\n/**\n * Render recent requests table\n */\nfunction renderRecentRequests(requests: RecentCostRequest[]): string {\n  if (!requests.length) {\n    return '<div class=\"empty-recent\">No recent requests</div>';\n  }\n  return `\n    <div class=\"costs-recent-table-wrap\">\n      <table class=\"costs-recent-table\" aria-label=\"Recent LLM requests\">\n        <thead>\n          <tr>\n            <th>Time</th>\n            <th>Provider / Model</th>\n            <th>Operation</th>\n            <th>Tokens</th>\n            <th>Cost</th>\n            <th>Latency</th>\n          </tr>\n        </thead>\n        <tbody>\n          ${requests\n      .slice(0, 20)\n      .map(\n        (r) => `\n            <tr>\n              <td>${formatRequestTime(r.timestamp)}</td>\n              <td>${escapeHtml(r.provider)} / ${escapeHtml(r.model)}</td>\n              <td>${escapeHtml(r.request_type || r.operation || '—')}</td>\n              <td>${(r.input_tokens ?? 0)}+${r.output_tokens ?? 0}</td>\n              <td>${r.cost != null ? formatCurrency(r.cost) : '—'}</td>\n              <td>${r.latency_ms != null ? `${r.latency_ms}ms` : '—'}</td>\n            </tr>\n          `\n      )\n      .join('')}\n        </tbody>\n      </table>\n    </div>\n  `;\n}\n\nfunction formatRequestTime(iso: string): string {\n  const d = new Date(iso);\n  const now = new Date();\n  const diffMs = now.getTime() - d.getTime();\n  if (diffMs < 60000) return 'Just now';\n  if (diffMs < 3600000) return `${Math.floor(diffMs / 60000)}m ago`;\n  if (diffMs < 86400000) return `${Math.floor(diffMs / 3600000)}h ago`;\n  return d.toLocaleDateString(undefined, { month: 'short', day: 'numeric', hour: '2-digit', minute: '2-digit' });\n}\n\n/**\n * Export costs as CSV or JSON (user chooses via prompt)\n */\nasync function handleExport(period: 'day' | 'week' | 'month' | 'all'): Promise<void> {\n  const format = window.confirm('Download as JSON?\\n\\nCancel = CSV, OK = JSON') ? 'json' : 'csv';\n  const ext = format === 'json' ? 'json' : 'csv';\n  const url = `/api/costs/export?period=${period}&format=${format}`;\n  try {\n    const res = await fetchWithProject(url);\n    if (!res.ok) throw new Error(res.statusText);\n    const blob = await res.blob();\n    const name = `llm-costs-${period}-${new Date().toISOString().split('T')[0]}.${ext}`;\n    const a = document.createElement('a');\n    a.href = URL.createObjectURL(blob);\n    a.download = name;\n    a.click();\n    URL.revokeObjectURL(a.href);\n  } catch (e) {\n    console.error('Export failed:', e);\n    alert('Export failed. Try again.');\n  }\n}\n\n/**\n * Toggle pricing panel (fetch on first open)\n */\nasync function togglePricingPanel(panel: HTMLElement): Promise<void> {\n  const isHidden = panel.classList.contains('hidden');\n  if (isHidden && !panel.innerHTML.trim()) {\n    panel.innerHTML = '<div class=\"loading\">Loading pricing...</div>';\n    panel.classList.remove('hidden');\n    panel.setAttribute('aria-hidden', 'false');\n    try {\n      const pricing = await costsService.getPricing();\n      panel.innerHTML = renderPricingTable(pricing);\n    } catch {\n      panel.innerHTML = '<div class=\"error\">Failed to load pricing</div>';\n    }\n  } else {\n    panel.classList.toggle('hidden');\n    panel.setAttribute('aria-hidden', String(panel.classList.contains('hidden')));\n  }\n}\n\nasync function showBudgetModal(container: HTMLElement, periodSelect: HTMLSelectElement): Promise<void> {\n  const period = periodSelect.value as 'day' | 'week' | 'month' | 'all';\n  const budgetPeriod: 'week' | 'month' =\n    period === 'week' ? 'week' : period === 'month' ? 'month' : 'month';\n\n  const existing = document.querySelector(`[data-modal-id=\"${BUDGET_MODAL_ID}\"]`);\n  if (existing) existing.remove();\n\n  let currentLimit = 100;\n  let currentThreshold = 80;\n  try {\n    const budget = await costsService.getBudget(budgetPeriod);\n    if (budget?.limitUsd != null && budget.limitUsd > 0) currentLimit = budget.limitUsd;\n    if (budget?.alertThresholdPercent != null) currentThreshold = Math.min(100, Math.max(0, budget.alertThresholdPercent));\n  } catch {\n    // use defaults\n  }\n\n  const body = createElement('div', { className: 'costs-budget-modal-body' });\n  body.innerHTML = `\n    <p class=\"costs-budget-modal-desc\">Set a ${budgetPeriod}ly spending limit and get an alert when usage reaches a percentage of that limit.</p>\n    <div class=\"form-group\">\n      <label for=\"costs-budget-limit\">Budget limit (USD)</label>\n      <input type=\"number\" id=\"costs-budget-limit\" class=\"form-input\" min=\"1\" max=\"999999\" step=\"0.01\" value=\"${currentLimit}\" placeholder=\"e.g. 100\" aria-label=\"Budget limit in USD\">\n      <span class=\"form-hint\">Min 1 USD</span>\n    </div>\n    <div class=\"form-group\">\n      <label for=\"costs-budget-threshold\">Alert when usage reaches (%)</label>\n      <input type=\"number\" id=\"costs-budget-threshold\" class=\"form-input\" min=\"0\" max=\"100\" value=\"${currentThreshold}\" placeholder=\"e.g. 80\" aria-label=\"Alert threshold percentage\">\n      <span class=\"form-hint\">0–100%</span>\n    </div>\n    <p class=\"costs-budget-modal-hint\" role=\"status\">You will be notified when LLM costs reach this percentage of your budget.</p>\n  `;\n\n  const footer = createElement('div', { className: 'modal-footer' });\n  const cancelBtn = createElement('button', { className: 'btn btn-secondary', textContent: 'Cancel' });\n  const saveBtn = createElement('button', { className: 'btn btn-primary', textContent: 'Save budget' });\n\n  const modal = createModal({\n    id: BUDGET_MODAL_ID,\n    title: `Set ${budgetPeriod === 'week' ? 'weekly' : 'monthly'} budget`,\n    content: body,\n    size: 'md',\n    closable: true,\n    footer,\n  });\n\n  modal.classList.add('costs-budget-modal');\n\n  const hintEl = body.querySelector('.costs-budget-modal-hint') as HTMLElement;\n\n  on(cancelBtn, 'click', () => closeModal(BUDGET_MODAL_ID));\n  on(saveBtn, 'click', async () => {\n    const limitEl = body.querySelector('#costs-budget-limit') as HTMLInputElement;\n    const thresholdEl = body.querySelector('#costs-budget-threshold') as HTMLInputElement;\n    const limitUsd = limitEl ? parseFloat(limitEl.value) : NaN;\n    const thresholdRaw = thresholdEl != null ? parseInt(thresholdEl.value, 10) : NaN;\n    const threshold = Number.isFinite(thresholdRaw) ? Math.min(100, Math.max(0, thresholdRaw)) : 80;\n\n    hintEl.textContent = 'You will be notified when LLM costs reach this percentage of your budget.';\n    if (!Number.isFinite(limitUsd) || limitUsd < 1) {\n      hintEl.textContent = 'Enter a valid budget (min 1 USD).';\n      hintEl.classList.add('costs-budget-modal-hint-error');\n      limitEl?.focus();\n      return;\n    }\n    if (!Number.isFinite(thresholdRaw) || thresholdRaw < 0 || thresholdRaw > 100) {\n      hintEl.textContent = 'Alert threshold must be between 0 and 100%.';\n      hintEl.classList.add('costs-budget-modal-hint-error');\n      thresholdEl?.focus();\n      return;\n    }\n    hintEl.classList.remove('costs-budget-modal-hint-error');\n    saveBtn.setAttribute('disabled', 'true');\n    saveBtn.textContent = 'Saving…';\n    try {\n      await costsService.setBudget(budgetPeriod, limitUsd, threshold);\n      closeModal(BUDGET_MODAL_ID);\n      loadCosts(container, periodSelect.value as 'day' | 'week' | 'month' | 'all');\n      toast.success('Budget saved');\n    } catch (e) {\n      console.error('Set budget failed:', e);\n      hintEl.textContent = 'Failed to save. Please try again.';\n      hintEl.classList.add('costs-budget-modal-hint-error');\n      toast.error('Failed to save budget');\n    } finally {\n      saveBtn.removeAttribute('disabled');\n      saveBtn.textContent = 'Save budget';\n    }\n  });\n\n  footer.append(cancelBtn, saveBtn);\n  document.body.appendChild(modal);\n  openModal(BUDGET_MODAL_ID);\n}\n\nfunction renderPricingTable(rows: Array<{ model: string; inputPer1M: number; outputPer1M: number }>): string {\n  if (!rows.length) return '<div class=\"empty\">No pricing data</div>';\n  return `\n    <div class=\"costs-pricing-header\">\n      <h4>Model pricing (USD per 1M tokens)</h4>\n      <button type=\"button\" class=\"btn btn-sm\" id=\"costs-pricing-close\" aria-label=\"Close\">×</button>\n    </div>\n    <div class=\"costs-pricing-table-wrap\">\n      <table class=\"costs-pricing-table\">\n        <thead>\n          <tr>\n            <th>Model</th>\n            <th>Input</th>\n            <th>Output</th>\n          </tr>\n        </thead>\n        <tbody>\n          ${rows\n      .map(\n        (r) => `\n            <tr>\n              <td>${escapeHtml(r.model)}</td>\n              <td>$${r.inputPer1M.toFixed(2)}</td>\n              <td>$${r.outputPer1M.toFixed(2)}</td>\n            </tr>\n          `\n      )\n      .join('')}\n        </tbody>\n      </table>\n    </div>\n  `;\n}\n\n/**\n * Build skeleton daily array for period so chart always shows structure\n */\nfunction skeletonDailyForPeriod(period: { start: string; end: string }): Array<{ date: string; cost: number; calls: number }> {\n  const days = 14;\n  const result: Array<{ date: string; cost: number; calls: number }> = [];\n  const d = new Date();\n  for (let i = days - 1; i >= 0; i--) {\n    const date = new Date(d);\n    date.setDate(date.getDate() - i);\n    result.push({\n      date: date.toISOString().split('T')[0],\n      cost: 0,\n      calls: 0,\n    });\n  }\n  return result;\n}\n\n/**\n * Render daily costs chart. When no data, show skeleton bars so chart area is visible.\n */\nfunction renderDailyChart(\n  daily: Array<{ date: string; cost: number; calls: number }>,\n  period?: { start: string; end: string }\n): string {\n  const chartDaily = daily.length > 0 ? daily : skeletonDailyForPeriod(period ?? { start: '', end: '' });\n  const maxCost = Math.max(1e-9, ...chartDaily.map(d => d.cost));\n  const isPlaceholder = daily.length === 0;\n\n  return `\n    <div class=\"daily-chart\">\n      <div class=\"chart-bars\">\n        ${chartDaily.map(d => {\n    const height = maxCost > 0 ? Math.max(2, (d.cost / maxCost) * 100) : 2;\n    return `\n            <div class=\"bar-column\" title=\"${d.date}: ${formatCurrency(d.cost)} (${d.calls} calls)\">\n              <div class=\"bar ${isPlaceholder && d.cost === 0 ? 'bar-placeholder' : ''}\" style=\"--bar-height: ${height}%\"></div>\n              <div class=\"bar-label\">${formatDateShort(d.date)}</div>\n            </div>\n          `;\n  }).join('')}\n      </div>\n      ${isPlaceholder ? '<p class=\"chart-placeholder-hint\">No cost data for this period. Usage will appear here as you use LLM features.</p>' : ''}\n    </div>\n  `;\n}\n\n/**\n * Format period display\n */\nfunction formatPeriod(period: { start: string; end: string }): string {\n  if (!period.start || !period.end) return 'All time';\n\n  const start = new Date(period.start);\n  const end = new Date(period.end);\n\n  const formatDate = (d: Date) => d.toLocaleDateString(undefined, {\n    month: 'short',\n    day: 'numeric'\n  });\n\n  return `${formatDate(start)} - ${formatDate(end)}`;\n}\n\n/**\n * Format date short\n */\nfunction formatDateShort(dateStr: string): string {\n  const date = new Date(dateStr);\n  return date.toLocaleDateString(undefined, { month: 'short', day: 'numeric' });\n}\n\n/**\n * Escape HTML\n */\nfunction escapeHtml(text: string): string {\n  const div = document.createElement('div');\n  div.textContent = text;\n  return div.innerHTML;\n}\n\nexport default createCostsDashboard;\n"],"names":["billingSummary","BUDGET_MODAL_ID","createCostsDashboard","props","period","container","createElement","periodSelect","on","loadCosts","exportBtn","handleExport","pricingBtn","pricingPanel","togglePricingPanel","e","budgetBtn","showBudgetModal","content","projectId","appStore","data","recentRequests","billing","costsService","billingService","renderCosts","periodRangeEl","formatPeriod","dailyBreakdown","byProvider","byModel","totalCalls","sum","d","avgPerCall","byProviderArray","provider","cost","a","b","byModelArray","model","byOperationMap","op","key","byOperationArray","operation","byContextArray","ctx","totalInput","totalOutput","hasNoData","periodChangeHtml","budgetHtml","formatCurrency","emptyStateHtml","billingBannerHtml","balanceDisplay","formatEur","statusBadge","formatTokens","formatNumber","renderDailyChart","p","escapeHtml","m","o","c","renderRecentRequests","requests","r","formatRequestTime","iso","diffMs","format","ext","url","res","fetchWithProject","blob","name","panel","pricing","renderPricingTable","budgetPeriod","existing","currentLimit","currentThreshold","budget","body","footer","cancelBtn","saveBtn","modal","createModal","hintEl","closeModal","limitEl","thresholdEl","limitUsd","thresholdRaw","threshold","toast","openModal","rows","skeletonDailyForPeriod","result","i","date","daily","chartDaily","maxCost","isPlaceholder","height","formatDateShort","start","end","formatDate","dateStr","text","div"],"mappings":"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"}